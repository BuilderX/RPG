{"version":3,"sources":["src/GameArea.js"],"names":[],"mappings":"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","file":"src/GameArea.js","sourcesContent":["/*\n\nA-RPG Game, Built using Node.js + JavaScript + ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n(function () {\n  \"use strict\";\n\n  function fixPosition (obj) {\n    obj.x = obj.x * 32 + 16;\n    obj.y = obj.y * 32;\n  }\n\n  // 加载区域，把括地图，角色，物品\n  Game.loadArea = function (id, callback) {\n\n    var preloadItems = [\"bag\", \"gold\"];\n    var itemLoader = new Sprite.Loader();\n    preloadItems.forEach(function (element) {\n      itemLoader.add(`/item/${element}.json`);\n    });\n    itemLoader.start();\n    itemLoader.on(\"complete\", function (event) {\n      preloadItems.forEach(function (element, index) {\n        var itemData = event.data[index];\n        Game.items[element] = new Game.ItemClass(itemData);\n      })\n    });\n\n    var loader = new Sprite.Loader();\n    loader.add(`map/${id}.json`,\n      `map/${id}_extra.json`);\n    loader.start();\n    loader.on(\"complete\", function (event) {\n      var mapData = event.data[0];\n      var mapExtra = event.data[1];\n\n      for (var key in mapExtra) {\n        mapData[key] = mapExtra[key];\n      }\n\n      var mapObj = new Game.MapClass(mapData);\n      mapObj.on(\"complete\", function () {\n        var area = {\n          actors: {},\n          bags: {},\n          doors: [],\n          chests: [],\n          hints: [],\n          map: mapObj\n        };\n\n        var completeCount = -1;\n        var Complete = () => {\n          completeCount++;\n          if (completeCount >= 0) {\n            callback(area);\n          }\n        };\n\n        if (mapExtra.actors) {\n          mapExtra.actors.forEach(function (element) {\n            var actorLoader = new Sprite.Loader();\n            actorLoader.add(`actor/${element.id}.json`);\n            actorLoader.start();\n            actorLoader.on(\"complete\", function (event) {\n              var actorData = Sprite.Util.copy(event.data[0]);\n              if (actorData.type == \"monster\")\n                actorData.id = actorData.id + \"_\" + Sprite.Util.id();\n              actorData.x = element.x;\n              actorData.y = element.y;\n              fixPosition(actorData);\n              actorData.mode = element.mode;\n              var actorObj = new Game.ActorClass(actorData);\n              actorObj.on(\"complete\", function () {\n                area.actors[actorObj.id] = actorObj;\n                actorObj.draw(Game.actorLayer);\n                Complete();\n              });\n            });\n          });\n        }\n\n        if (mapExtra.door) {\n          mapExtra.door.forEach(function (element) {\n            var door = Sprite.Util.copy(element);\n            fixPosition(door);\n            door.destx = door.destx * 32 + 16;\n            door.desty = door.desty * 32 + 16;\n            door.type = \"door\";\n            area.doors.push(door);\n          });\n        }\n\n        if (mapExtra.chest) {\n          mapExtra.chest.forEach(function (element) {\n            var chest = Sprite.Util.copy(element);\n            fixPosition(chest);\n            chest.destx = chest.destx * 32 + 16;\n            chest.desty = chest.desty * 32 + 16;\n            chest.type = \"chest\";\n            area.chests.push(chest);\n          });\n        }\n\n        if (mapExtra.hint) {\n          mapExtra.hint.forEach(function (element) {\n            var hint = Sprite.Util.copy(element);\n            fixPosition(hint);\n            hint.type = \"hint\";\n            area.hints.push(hint);\n          });\n        }\n\n        Complete();\n      });\n    });\n  };\n\n})();\n"]}