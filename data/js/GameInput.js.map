{"version":3,"sources":["src/GameInput.js"],"names":[],"mappings":"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","file":"src/GameInput.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n\n  Game.initInput = function () {\n\n    var mousePressed = false;\n\n    Game.stage.on(\"stagemousedown\", function (event) {\n      mousePressed = true;\n      //Game.hero.gotoXY(x, y);\n      //console.log();\n    });\n\n    Game.stage.on(\"stagemouseup\", function (event) {\n      mousePressed = false;\n    });\n\n    Game.stage.on(\"mouseleave\", function (event) { // mouse leave canvas\n      mousePressed = false;\n    });\n\n    Sprite.Ticker.on(\"tick\", function () {\n\n      if (!Game.hero) return;\n      if (!Game.area) return;\n      if (!Game.area.map) return;\n\n      var speed = Game.config.walk;\n      var skew = Game.config.walk / 1.4;\n\n      if (Sprite.Input.isPressed(\"shift\")) { // run key\n        speed = Game.config.run;\n        skew = Game.config.run / 1.4;\n      }\n\n      var state;\n      if (Sprite.Input.isPressed(\"shift\"))\n        state = \"run\";\n      else\n        state = \"walk\";\n\n      // 计算八个方向角色的动画和面向\n      if (Sprite.Input.isPressed(\"up\") && Sprite.Input.isPressed(\"right\")) {\n        Game.hero.go(state, \"upright\", skew);\n      } else if (Sprite.Input.isPressed(\"down\") && Sprite.Input.isPressed(\"right\")) {\n        Game.hero.go(state, \"downright\", skew);\n      } else if (Sprite.Input.isPressed(\"down\") && Sprite.Input.isPressed(\"left\")) {\n        Game.hero.go(state, \"downleft\", skew);\n      } else if (Sprite.Input.isPressed(\"up\") && Sprite.Input.isPressed(\"left\")) {\n        Game.hero.go(state, \"upleft\", skew);\n      } else if (Sprite.Input.isPressed(\"left\")) {\n        Game.hero.go(state, \"left\", speed);\n      } else if (Sprite.Input.isPressed(\"up\")) {\n        Game.hero.go(state, \"up\", speed);\n      } else if (Sprite.Input.isPressed(\"right\")) {\n        Game.hero.go(state, \"right\", speed);\n      } else if (Sprite.Input.isPressed(\"down\")) {\n        Game.hero.go(state, \"down\", speed);\n      } else if (mousePressed) {\n        //var x = Game.stage.center.x + Game.stage.mouseX / Game.stage.scaleX;\n        //var y = Game.stage.center.y + Game.stage.mouseY / Game.stage.scaleY;\n        //if (Game.uiLayer.hitTest(x, y)) {\n        //  return;\n        //}\n        var x = Game.stage.mouseX;\n        var y = Game.stage.mouseY;\n        x -= Game.stage.width/2;\n        y -= Game.stage.height/2;\n\n        //console.log(Game.stage.mouseX, Game.stage.mouseY, x, y, Game.stage.width, Game.stage.height);\n\n        if (Math.abs(Math.abs(x) - Math.abs(y)) < 40) {\n          if (x < 0 && y < 0) { // left up\n            Game.hero.go(state, \"upleft\", skew);\n          } else if (x > 0 && y < 0) { // right up\n            Game.hero.go(state, \"upright\", skew);\n          } else if (x < 0 && y > 0) { // left down\n            Game.hero.go(state, \"downleft\", skew);\n          } else if (x > 0 && y > 0) { // right down\n            Game.hero.go(state, \"downright\", skew);\n          }\n        } else if (Math.abs(x) > Math.abs(y)) { // left or right\n          if (x < 0) { // left\n            Game.hero.go(state, \"left\", speed);\n          } else { // right\n            Game.hero.go(state, \"right\", speed);\n          }\n        } else if (Math.abs(x) < Math.abs(y)) { // up or down\n          if (y < 0) { // up\n            Game.hero.go(state, \"up\", speed);\n          } else { // down\n            Game.hero.go(state, \"down\", speed);\n          }\n        }\n      } else {\n        Game.hero.stop();\n      }\n\n      Game.hero.focus();\n    });\n  }; // Game.oninit\n\n})();\n"]}