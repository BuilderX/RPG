{"version":3,"sources":["src/GameWindowPickup.js"],"names":[],"mappings":"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","file":"src/GameWindowPickup.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  var win = Game.windows.pickup = new Game.Window(\"pickupWindow\");\n\n  win.html(`\n    <div class=\"window-box\">\n      <button id=\"pickupWindowClose\">关闭</button>\n      <button id=\"pickupWindowAll\">全部</button>\n      <table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n        <thead>\n          <tr>\n            <td style=\"width: 40px;\"></td>\n            <td style=\"width: 120px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td></td>\n            <td style=\"width: 60px;\"></td>\n          </tr>\n        </thead>\n        <tbody id=\"pickupWindowTable\"></tbody>\n      </table>\n    </div>\n  `);\n\n  win.css(`\n    #pickupWindow table {\n      width: 100%;\n    }\n\n    #pickupWindow table img {\n      width: 100%;\n      height: 100%;\n    }\n\n    #pickupWindow button {\n      width: 60px;\n      height: 40px;\n      font-size: 16;\n    }\n\n    #pickupWindowClose {\n\n    }\n\n    #pickupWindowAll {\n\n    }\n  `);\n\n  document.querySelector(\"button#pickupWindowClose\").addEventListener(\"click\", function (event) {\n    Game.windows.pickup.hide();\n  });\n\n  var currentItemObj = null;\n\n  document.querySelector(\"button#pickupWindowAll\").addEventListener(\"click\", function (event) {\n    var itemObj = currentItemObj;\n    if (itemObj && itemObj.inner && Object.keys(itemObj.inner).length > 0) {\n      Sprite.Util.each(itemObj.inner, function (itemCount, itemId, inner) {\n        if (Game.hero.data.items[itemId]) {\n          Game.hero.data.items[itemId] += itemCount;\n        } else {\n          Game.hero.data.items[itemId] = itemCount;\n        }\n        delete inner[itemId];\n      });\n      Game.windows.pickup.execute(\"pickup\", itemObj);\n    }\n  });\n\n  win.register(\"pickup\", function (itemObj) {\n    if (!itemObj.inner || Object.keys(itemObj.inner).length <= 0) {\n      for (var key in Game.area.bags) {\n        if (Game.area.bags[key] == itemObj) {\n          delete Game.area.bags[key];\n          itemObj.erase(Game.layers.itemLayer);\n        }\n      }\n      Game.windows.pickup.hide();\n      return;\n    }\n\n    currentItemObj = itemObj;\n\n    var tableBody = document.getElementById(\"pickupWindowTable\");\n    while (tableBody.hasChildNodes()) {\n      tableBody.removeChild(tableBody.lastChild);\n    }\n\n    Sprite.Util.each(itemObj.inner, function (itemCount, itemId, inner) {\n      var item = Game.items[itemId];\n\n      var line = document.createElement(\"tr\");\n\n      var icon = document.createElement(\"td\");\n      line.appendChild(icon);\n\n      var name = document.createElement(\"td\");\n      line.appendChild(name);\n\n      var count = document.createElement(\"td\");\n      count.style.textAlign = \"center\";\n      line.appendChild(count);\n\n      var description = document.createElement(\"td\");\n      line.appendChild(description);\n\n      var pickup = document.createElement(\"td\");\n      line.appendChild(pickup);\n\n      icon.appendChild(item.icon);\n      name.textContent = item.data.name;\n      count.textContent = itemCount;\n      description.textContent = item.data.description;\n\n      var pickupButton = document.createElement(\"button\");\n      pickupButton.textContent = \"捡取\";\n      pickupButton.addEventListener(\"click\", function () {\n        if (Game.hero.data.items[itemId]) {\n          Game.hero.data.items[itemId] += itemCount;\n        } else {\n          Game.hero.data.items[itemId] = itemCount;\n        }\n        delete inner[itemId];\n        Game.windows.pickup.execute(\"pickup\", itemObj);\n      });\n      pickup.appendChild(pickupButton);\n\n      tableBody.appendChild(line);\n    });\n\n    Game.windows.pickup.show();\n  });\n\n}());\n"]}