{"version":3,"sources":["src/SpriteStage.js"],"names":[],"mappings":"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","file":"src/SpriteStage.js","sourcesContent":["/*\n\n2D Game Sprite Library, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n/// @file SpriteStage.js\n/// @namespace Sprite\n/// class Sprite.Stage\n\n(function () {\n  \"use strict\";\n\n  /// @class Sprite.Stage\n  /// inherit the Sprite.Container\n  Sprite.Stage = class Stage extends Sprite.Container {\n\n    /// @function Sprite.Stage.constructor\n    /// consturct a Sprite.Stage with width and height\n    /// @param width, the width of stage you need\n    /// @param height, the height of stage you need\n    constructor (width, height) {\n      super();\n\n      if (Sprite.Webgl.support()) {\n        this._renderer = new Sprite.Webgl(width, height);\n      } else if (Sprite.Canvas.support()) {\n        this._renderer = new Sprite.Canvas(width, height);\n      } else {\n        throw new Error(\"Sprite.Stage all renderer not support\");\n      }\n\n      var mousedown = false;\n\n      var ConvertMouseEvent = (event) => {\n        var x;\n        var y;\n        var type;\n        var rect = this.canvas.getBoundingClientRect();\n\n        if (event.targetTouches && event.targetTouches.length == 1) {\n          var touch = event.targetTouches[0];\n          x = touch.pageX - rect.left;\n          y = touch.pageX - rect.top;\n          type = \"touch\";\n        } else {\n          x = event.pageX - rect.left;\n          y = event.pageY - rect.top;\n          type = \"mouse\";\n        }\n\n        var scaleX = rect.width / this.width;\n        var scaleY = rect.height / this.height;\n\n        x = Math.floor(x / scaleX);\n        y = Math.floor(y / scaleY);\n\n        if (x >= 0 && y >= 0) {\n          this.mouseX = x;\n          this.mouseY = y;\n          this.mouseType = type;\n          return true;\n        } else {\n          return false;\n        }\n      }\n\n      this.canvas.addEventListener(\"mousedown\", (event) => {\n        if (ConvertMouseEvent(event))\n          this.pressdown();\n      });\n\n      this.canvas.addEventListener(\"mousemove\", (event) => {\n        if (ConvertMouseEvent(event))\n          this.pressmove();\n      });\n\n      this.canvas.addEventListener(\"mouseup\", (event) => {\n        if (ConvertMouseEvent(event))\n          this.pressup();\n      });\n\n      this.canvas.addEventListener(\"touchstart\", (event) => {\n        event.preventDefault();\n        if (ConvertMouseEvent(event))\n          this.pressdown();\n      });\n\n      this.canvas.addEventListener(\"touchmove\", (event) => {\n        event.preventDefault();\n        if (ConvertMouseEvent(event))\n          this.pressmove();\n      });\n\n      this.canvas.addEventListener(\"touchend\", (event) => {\n        event.preventDefault();\n        if (ConvertMouseEvent(event))\n          this.pressup();\n      });\n\n      this.canvas.addEventListener(\"touchleave\", (event) => {\n        event.preventDefault();\n        if (ConvertMouseEvent(event))\n          this.pressup();\n      });\n\n      this.pressdownElement = null;\n\n    }\n\n    findHit (event) {\n      var hitted = super.hitTest(this.mouseX, this.mouseY);\n      hitted.reverse();\n      if (hitted.length)\n        return hitted;\n      return null;\n    }\n\n    pressdown () {\n      var hit = this.findHit(\"pressdown\");\n      if (hit) {\n        hit.forEach((element) => {\n          element.emit(\"pressdown\", false);\n        });\n      }\n\n      hit = this.findHit(\"click\");\n      if (hit) {\n        this.pressdownElement = hit;\n      }\n\n      this.emit(\"stagemousedown\");\n    }\n\n    pressmove (mouse) {\n      var hit = this.findHit(\"pressmove\");\n      if (hit) {\n        hit.forEach((element) => {\n          element.emit(\"pressmove\", false);\n        });\n      }\n    }\n\n    pressup (mouse) {\n      var hit = this.findHit(\"pressup\");\n      if (hit) {\n        hit.forEach((element) => {\n          element.emit(\"pressup\", false);\n        });\n      }\n\n      hit = this.findHit(\"click\");\n      if (hit) {\n        hit.forEach((element) => {\n          if (this.pressdownElement && this.pressdownElement.indexOf(element) != -1) {\n            element.emit(\"click\");\n          }\n        });\n      }\n\n      this.pressdownElement = null;\n\n      this.emit(\"stagemouseup\");\n    }\n\n    get width () {\n      return this._renderer.width;\n    }\n\n    set width (value) {\n      this._renderer.width = value;\n      this._stageCacheCanvas.width = this._renderer.width;\n    }\n\n    get height () {\n      return this._renderer.height;\n    }\n\n    set height (value) {\n      this._renderer.height = value;\n      this._stageCacheCanvas.height = this._renderer.height;\n    }\n\n    get color () {\n      return this._color;\n    }\n\n    set color (value) {\n      if (this._color != value) {\n        this._color = value;\n        this.update();\n      }\n    }\n\n    get canvas () {\n      return this._renderer.canvas;\n    }\n\n    set canvas (value) {\n      throw new Error(\"Sprite.Stage.canvas readonly\")\n    }\n\n    /// @function Sprite.Stage.clear\n    /// clear the stage\n    clear () {\n      this._context.fillStyle = \"white\";\n      this._context.fillRect(0, 0, this._renderer.width, this._renderer.height);\n      //this._context.clearRect(0, 0, this._renderer.width, this._renderer.height);\n    }\n\n    update () {\n      this.draw();\n    }\n\n    draw () {\n      this.emit(\"drawStart\");\n\n      if (this._children.length <= 0) return false;\n\n      this._renderer.clear();\n\n      this._children.forEach((element) => {\n        element.draw(this._renderer);\n      });\n\n      this.emit(\"drawEnd\");\n    }\n  };\n\n})();\n"]}