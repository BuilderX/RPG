(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = setTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    clearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        setTimeout(drainQueue, 0);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],2:[function(require,module,exports){
(function (global){
"use strict";

require("core-js/shim");

require("regenerator/runtime");

if (global._babelPolyfill) {
  throw new Error("only one instance of babel/polyfill is allowed");
}
global._babelPolyfill = true;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"core-js/shim":181,"regenerator/runtime":182}],3:[function(require,module,exports){
module.exports = function(it){
  if(typeof it != 'function')throw TypeError(it + ' is not a function!');
  return it;
};
},{}],4:[function(require,module,exports){
var isObject = require('./$.is-object');
module.exports = function(it){
  if(!isObject(it))throw TypeError(it + ' is not an object!');
  return it;
};
},{"./$.is-object":34}],5:[function(require,module,exports){
// false -> Array#indexOf
// true  -> Array#includes
var toIObject = require('./$.to-iobject')
  , toLength  = require('./$.to-length')
  , toIndex   = require('./$.to-index');
module.exports = function(IS_INCLUDES){
  return function($this, el, fromIndex){
    var O      = toIObject($this)
      , length = toLength(O.length)
      , index  = toIndex(fromIndex, length)
      , value;
    // Array#includes uses SameValueZero equality algorithm
    if(IS_INCLUDES && el != el)while(length > index){
      value = O[index++];
      if(value != value)return true;
    // Array#toIndex ignores holes, Array#includes - not
    } else for(;length > index; index++)if(IS_INCLUDES || index in O){
      if(O[index] === el)return IS_INCLUDES || index;
    } return !IS_INCLUDES && -1;
  };
};
},{"./$.to-index":69,"./$.to-iobject":71,"./$.to-length":72}],6:[function(require,module,exports){
// 0 -> Array#forEach
// 1 -> Array#map
// 2 -> Array#filter
// 3 -> Array#some
// 4 -> Array#every
// 5 -> Array#find
// 6 -> Array#findIndex
var ctx      = require('./$.ctx')
  , IObject  = require('./$.iobject')
  , toObject = require('./$.to-object')
  , toLength = require('./$.to-length');
module.exports = function(TYPE){
  var IS_MAP        = TYPE == 1
    , IS_FILTER     = TYPE == 2
    , IS_SOME       = TYPE == 3
    , IS_EVERY      = TYPE == 4
    , IS_FIND_INDEX = TYPE == 6
    , NO_HOLES      = TYPE == 5 || IS_FIND_INDEX;
  return function($this, callbackfn, that){
    var O      = toObject($this)
      , self   = IObject(O)
      , f      = ctx(callbackfn, that, 3)
      , length = toLength(self.length)
      , index  = 0
      , result = IS_MAP ? Array(length) : IS_FILTER ? [] : undefined
      , val, res;
    for(;length > index; index++)if(NO_HOLES || index in self){
      val = self[index];
      res = f(val, index, O);
      if(TYPE){
        if(IS_MAP)result[index] = res;            // map
        else if(res)switch(TYPE){
          case 3: return true;                    // some
          case 5: return val;                     // find
          case 6: return index;                   // findIndex
          case 2: result.push(val);               // filter
        } else if(IS_EVERY)return false;          // every
      }
    }
    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : result;
  };
};
},{"./$.ctx":15,"./$.iobject":31,"./$.to-length":72,"./$.to-object":73}],7:[function(require,module,exports){
// 19.1.2.1 Object.assign(target, source, ...)
var toObject = require('./$.to-object')
  , IObject  = require('./$.iobject')
  , enumKeys = require('./$.enum-keys');

module.exports = require('./$.fails')(function(){
  return Symbol() in Object.assign({}); // Object.assign available and Symbol is native
}) ? function assign(target, source){   // eslint-disable-line no-unused-vars
  var T = toObject(target)
    , l = arguments.length
    , i = 1;
  while(l > i){
    var S      = IObject(arguments[i++])
      , keys   = enumKeys(S)
      , length = keys.length
      , j      = 0
      , key;
    while(length > j)T[key = keys[j++]] = S[key];
  }
  return T;
} : Object.assign;
},{"./$.enum-keys":19,"./$.fails":21,"./$.iobject":31,"./$.to-object":73}],8:[function(require,module,exports){
// getting tag from 19.1.3.6 Object.prototype.toString()
var cof = require('./$.cof')
  , TAG = require('./$.wks')('toStringTag')
  // ES3 wrong here
  , ARG = cof(function(){ return arguments; }()) == 'Arguments';

module.exports = function(it){
  var O, T, B;
  return it === undefined ? 'Undefined' : it === null ? 'Null'
    // @@toStringTag case
    : typeof (T = (O = Object(it))[TAG]) == 'string' ? T
    // builtinTag case
    : ARG ? cof(O)
    // ES3 arguments fallback
    : (B = cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;
};
},{"./$.cof":9,"./$.wks":76}],9:[function(require,module,exports){
var toString = {}.toString;

module.exports = function(it){
  return toString.call(it).slice(8, -1);
};
},{}],10:[function(require,module,exports){
'use strict';
var $            = require('./$')
  , hide         = require('./$.hide')
  , ctx          = require('./$.ctx')
  , species      = require('./$.species')
  , strictNew    = require('./$.strict-new')
  , defined      = require('./$.defined')
  , forOf        = require('./$.for-of')
  , step         = require('./$.iter-step')
  , ID           = require('./$.uid')('id')
  , $has         = require('./$.has')
  , isObject     = require('./$.is-object')
  , isExtensible = Object.isExtensible || isObject
  , SUPPORT_DESC = require('./$.support-desc')
  , SIZE         = SUPPORT_DESC ? '_s' : 'size'
  , id           = 0;

var fastKey = function(it, create){
  // return primitive with prefix
  if(!isObject(it))return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;
  if(!$has(it, ID)){
    // can't set id to frozen object
    if(!isExtensible(it))return 'F';
    // not necessary to add id
    if(!create)return 'E';
    // add missing object id
    hide(it, ID, ++id);
  // return object id with prefix
  } return 'O' + it[ID];
};

var getEntry = function(that, key){
  // fast case
  var index = fastKey(key), entry;
  if(index !== 'F')return that._i[index];
  // frozen object case
  for(entry = that._f; entry; entry = entry.n){
    if(entry.k == key)return entry;
  }
};

module.exports = {
  getConstructor: function(wrapper, NAME, IS_MAP, ADDER){
    var C = wrapper(function(that, iterable){
      strictNew(that, C, NAME);
      that._i = $.create(null); // index
      that._f = undefined;      // first entry
      that._l = undefined;      // last entry
      that[SIZE] = 0;           // size
      if(iterable != undefined)forOf(iterable, IS_MAP, that[ADDER], that);
    });
    require('./$.mix')(C.prototype, {
      // 23.1.3.1 Map.prototype.clear()
      // 23.2.3.2 Set.prototype.clear()
      clear: function clear(){
        for(var that = this, data = that._i, entry = that._f; entry; entry = entry.n){
          entry.r = true;
          if(entry.p)entry.p = entry.p.n = undefined;
          delete data[entry.i];
        }
        that._f = that._l = undefined;
        that[SIZE] = 0;
      },
      // 23.1.3.3 Map.prototype.delete(key)
      // 23.2.3.4 Set.prototype.delete(value)
      'delete': function(key){
        var that  = this
          , entry = getEntry(that, key);
        if(entry){
          var next = entry.n
            , prev = entry.p;
          delete that._i[entry.i];
          entry.r = true;
          if(prev)prev.n = next;
          if(next)next.p = prev;
          if(that._f == entry)that._f = next;
          if(that._l == entry)that._l = prev;
          that[SIZE]--;
        } return !!entry;
      },
      // 23.2.3.6 Set.prototype.forEach(callbackfn, thisArg = undefined)
      // 23.1.3.5 Map.prototype.forEach(callbackfn, thisArg = undefined)
      forEach: function forEach(callbackfn /*, that = undefined */){
        var f = ctx(callbackfn, arguments[1], 3)
          , entry;
        while(entry = entry ? entry.n : this._f){
          f(entry.v, entry.k, this);
          // revert to the last existing entry
          while(entry && entry.r)entry = entry.p;
        }
      },
      // 23.1.3.7 Map.prototype.has(key)
      // 23.2.3.7 Set.prototype.has(value)
      has: function has(key){
        return !!getEntry(this, key);
      }
    });
    if(SUPPORT_DESC)$.setDesc(C.prototype, 'size', {
      get: function(){
        return defined(this[SIZE]);
      }
    });
    return C;
  },
  def: function(that, key, value){
    var entry = getEntry(that, key)
      , prev, index;
    // change existing entry
    if(entry){
      entry.v = value;
    // create new entry
    } else {
      that._l = entry = {
        i: index = fastKey(key, true), // <- index
        k: key,                        // <- key
        v: value,                      // <- value
        p: prev = that._l,             // <- previous entry
        n: undefined,                  // <- next entry
        r: false                       // <- removed
      };
      if(!that._f)that._f = entry;
      if(prev)prev.n = entry;
      that[SIZE]++;
      // add to index
      if(index !== 'F')that._i[index] = entry;
    } return that;
  },
  getEntry: getEntry,
  setStrong: function(C, NAME, IS_MAP){
    // add .keys, .values, .entries, [@@iterator]
    // 23.1.3.4, 23.1.3.8, 23.1.3.11, 23.1.3.12, 23.2.3.5, 23.2.3.8, 23.2.3.10, 23.2.3.11
    require('./$.iter-define')(C, NAME, function(iterated, kind){
      this._t = iterated;  // target
      this._k = kind;      // kind
      this._l = undefined; // previous
    }, function(){
      var that  = this
        , kind  = that._k
        , entry = that._l;
      // revert to the last existing entry
      while(entry && entry.r)entry = entry.p;
      // get next entry
      if(!that._t || !(that._l = entry = entry ? entry.n : that._t._f)){
        // or finish the iteration
        that._t = undefined;
        return step(1);
      }
      // return step by kind
      if(kind == 'keys'  )return step(0, entry.k);
      if(kind == 'values')return step(0, entry.v);
      return step(0, [entry.k, entry.v]);
    }, IS_MAP ? 'entries' : 'values' , !IS_MAP, true);

    // add [@@species], 23.1.2.2, 23.2.2.2
    species(C);
    species(require('./$.core')[NAME]); // for wrapper
  }
};
},{"./$":41,"./$.core":14,"./$.ctx":15,"./$.defined":17,"./$.for-of":24,"./$.has":27,"./$.hide":28,"./$.is-object":34,"./$.iter-define":37,"./$.iter-step":39,"./$.mix":46,"./$.species":59,"./$.strict-new":60,"./$.support-desc":66,"./$.uid":74}],11:[function(require,module,exports){
// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var forOf   = require('./$.for-of')
  , classof = require('./$.classof');
module.exports = function(NAME){
  return function toJSON(){
    if(classof(this) != NAME)throw TypeError(NAME + "#toJSON isn't generic");
    var arr = [];
    forOf(this, false, arr.push, arr);
    return arr;
  };
};
},{"./$.classof":8,"./$.for-of":24}],12:[function(require,module,exports){
'use strict';
var hide         = require('./$.hide')
  , anObject     = require('./$.an-object')
  , strictNew    = require('./$.strict-new')
  , forOf        = require('./$.for-of')
  , method       = require('./$.array-methods')
  , WEAK         = require('./$.uid')('weak')
  , isObject     = require('./$.is-object')
  , $has         = require('./$.has')
  , isExtensible = Object.isExtensible || isObject
  , find         = method(5)
  , findIndex    = method(6)
  , id           = 0;

// fallback for frozen keys
var frozenStore = function(that){
  return that._l || (that._l = new FrozenStore);
};
var FrozenStore = function(){
  this.a = [];
};
var findFrozen = function(store, key){
  return find(store.a, function(it){
    return it[0] === key;
  });
};
FrozenStore.prototype = {
  get: function(key){
    var entry = findFrozen(this, key);
    if(entry)return entry[1];
  },
  has: function(key){
    return !!findFrozen(this, key);
  },
  set: function(key, value){
    var entry = findFrozen(this, key);
    if(entry)entry[1] = value;
    else this.a.push([key, value]);
  },
  'delete': function(key){
    var index = findIndex(this.a, function(it){
      return it[0] === key;
    });
    if(~index)this.a.splice(index, 1);
    return !!~index;
  }
};

module.exports = {
  getConstructor: function(wrapper, NAME, IS_MAP, ADDER){
    var C = wrapper(function(that, iterable){
      strictNew(that, C, NAME);
      that._i = id++;      // collection id
      that._l = undefined; // leak store for frozen objects
      if(iterable != undefined)forOf(iterable, IS_MAP, that[ADDER], that);
    });
    require('./$.mix')(C.prototype, {
      // 23.3.3.2 WeakMap.prototype.delete(key)
      // 23.4.3.3 WeakSet.prototype.delete(value)
      'delete': function(key){
        if(!isObject(key))return false;
        if(!isExtensible(key))return frozenStore(this)['delete'](key);
        return $has(key, WEAK) && $has(key[WEAK], this._i) && delete key[WEAK][this._i];
      },
      // 23.3.3.4 WeakMap.prototype.has(key)
      // 23.4.3.4 WeakSet.prototype.has(value)
      has: function has(key){
        if(!isObject(key))return false;
        if(!isExtensible(key))return frozenStore(this).has(key);
        return $has(key, WEAK) && $has(key[WEAK], this._i);
      }
    });
    return C;
  },
  def: function(that, key, value){
    if(!isExtensible(anObject(key))){
      frozenStore(that).set(key, value);
    } else {
      $has(key, WEAK) || hide(key, WEAK, {});
      key[WEAK][that._i] = value;
    } return that;
  },
  frozenStore: frozenStore,
  WEAK: WEAK
};
},{"./$.an-object":4,"./$.array-methods":6,"./$.for-of":24,"./$.has":27,"./$.hide":28,"./$.is-object":34,"./$.mix":46,"./$.strict-new":60,"./$.uid":74}],13:[function(require,module,exports){
'use strict';
var global     = require('./$.global')
  , $def       = require('./$.def')
  , forOf      = require('./$.for-of')
  , strictNew  = require('./$.strict-new');

module.exports = function(NAME, wrapper, methods, common, IS_MAP, IS_WEAK){
  var Base  = global[NAME]
    , C     = Base
    , ADDER = IS_MAP ? 'set' : 'add'
    , proto = C && C.prototype
    , O     = {};
  var fixMethod = function(KEY){
    var fn = proto[KEY];
    require('./$.redef')(proto, KEY,
      KEY == 'delete' ? function(a){ return fn.call(this, a === 0 ? 0 : a); }
      : KEY == 'has' ? function has(a){ return fn.call(this, a === 0 ? 0 : a); }
      : KEY == 'get' ? function get(a){ return fn.call(this, a === 0 ? 0 : a); }
      : KEY == 'add' ? function add(a){ fn.call(this, a === 0 ? 0 : a); return this; }
      : function set(a, b){ fn.call(this, a === 0 ? 0 : a, b); return this; }
    );
  };
  if(typeof C != 'function' || !(IS_WEAK || proto.forEach && !require('./$.fails')(function(){
    new C().entries().next();
  }))){
    // create collection constructor
    C = common.getConstructor(wrapper, NAME, IS_MAP, ADDER);
    require('./$.mix')(C.prototype, methods);
  } else {
    var inst  = new C
      , chain = inst[ADDER](IS_WEAK ? {} : -0, 1)
      , buggyZero;
    // wrap for init collections from iterable
    if(!require('./$.iter-detect')(function(iter){ new C(iter); })){ // eslint-disable-line no-new
      C = wrapper(function(target, iterable){
        strictNew(target, C, NAME);
        var that = new Base;
        if(iterable != undefined)forOf(iterable, IS_MAP, that[ADDER], that);
        return that;
      });
      C.prototype = proto;
      proto.constructor = C;
    }
    IS_WEAK || inst.forEach(function(val, key){
      buggyZero = 1 / key === -Infinity;
    });
    // fix converting -0 key to +0
    if(buggyZero){
      fixMethod('delete');
      fixMethod('has');
      IS_MAP && fixMethod('get');
    }
    // + fix .add & .set for chaining
    if(buggyZero || chain !== inst)fixMethod(ADDER);
    // weak collections should not contains .clear method
    if(IS_WEAK && proto.clear)delete proto.clear;
  }

  require('./$.tag')(C, NAME);

  O[NAME] = C;
  $def($def.G + $def.W + $def.F * (C != Base), O);

  if(!IS_WEAK)common.setStrong(C, NAME, IS_MAP);

  return C;
};
},{"./$.def":16,"./$.fails":21,"./$.for-of":24,"./$.global":26,"./$.iter-detect":38,"./$.mix":46,"./$.redef":53,"./$.strict-new":60,"./$.tag":67}],14:[function(require,module,exports){
var core = module.exports = {};
if(typeof __e == 'number')__e = core; // eslint-disable-line no-undef
},{}],15:[function(require,module,exports){
// optional / simple context binding
var aFunction = require('./$.a-function');
module.exports = function(fn, that, length){
  aFunction(fn);
  if(that === undefined)return fn;
  switch(length){
    case 1: return function(a){
      return fn.call(that, a);
    };
    case 2: return function(a, b){
      return fn.call(that, a, b);
    };
    case 3: return function(a, b, c){
      return fn.call(that, a, b, c);
    };
  } return function(/* ...args */){
      return fn.apply(that, arguments);
    };
};
},{"./$.a-function":3}],16:[function(require,module,exports){
var global     = require('./$.global')
  , core       = require('./$.core')
  , hide       = require('./$.hide')
  , $redef     = require('./$.redef')
  , PROTOTYPE  = 'prototype';
var ctx = function(fn, that){
  return function(){
    return fn.apply(that, arguments);
  };
};
var $def = function(type, name, source){
  var key, own, out, exp
    , isGlobal = type & $def.G
    , isProto  = type & $def.P
    , target   = isGlobal ? global : type & $def.S
        ? global[name] || (global[name] = {}) : (global[name] || {})[PROTOTYPE]
    , exports  = isGlobal ? core : core[name] || (core[name] = {});
  if(isGlobal)source = name;
  for(key in source){
    // contains in native
    own = !(type & $def.F) && target && key in target;
    // export native or passed
    out = (own ? target : source)[key];
    // bind timers to global for call from export context
    if(type & $def.B && own)exp = ctx(out, global);
    else exp = isProto && typeof out == 'function' ? ctx(Function.call, out) : out;
    // extend global
    if(target && !own)$redef(target, key, out);
    // export
    if(exports[key] != out)hide(exports, key, exp);
    if(isProto)(exports[PROTOTYPE] || (exports[PROTOTYPE] = {}))[key] = out;
  }
};
global.core = core;
// type bitmap
$def.F = 1;  // forced
$def.G = 2;  // global
$def.S = 4;  // static
$def.P = 8;  // proto
$def.B = 16; // bind
$def.W = 32; // wrap
module.exports = $def;
},{"./$.core":14,"./$.global":26,"./$.hide":28,"./$.redef":53}],17:[function(require,module,exports){
// 7.2.1 RequireObjectCoercible(argument)
module.exports = function(it){
  if(it == undefined)throw TypeError("Can't call method on  " + it);
  return it;
};
},{}],18:[function(require,module,exports){
var isObject = require('./$.is-object')
  , document = require('./$.global').document
  // in old IE typeof document.createElement is 'object'
  , is = isObject(document) && isObject(document.createElement);
module.exports = function(it){
  return is ? document.createElement(it) : {};
};
},{"./$.global":26,"./$.is-object":34}],19:[function(require,module,exports){
// all enumerable object keys, includes symbols
var $ = require('./$');
module.exports = function(it){
  var keys       = $.getKeys(it)
    , getSymbols = $.getSymbols;
  if(getSymbols){
    var symbols = getSymbols(it)
      , isEnum  = $.isEnum
      , i       = 0
      , key;
    while(symbols.length > i)if(isEnum.call(it, key = symbols[i++]))keys.push(key);
  }
  return keys;
};
},{"./$":41}],20:[function(require,module,exports){
// 20.2.2.14 Math.expm1(x)
module.exports = Math.expm1 || function expm1(x){
  return (x = +x) == 0 ? x : x > -1e-6 && x < 1e-6 ? x + x * x / 2 : Math.exp(x) - 1;
};
},{}],21:[function(require,module,exports){
module.exports = function(exec){
  try {
    return !!exec();
  } catch(e){
    return true;
  }
};
},{}],22:[function(require,module,exports){
'use strict';
module.exports = function(KEY, length, exec){
  var defined  = require('./$.defined')
    , SYMBOL   = require('./$.wks')(KEY)
    , original = ''[KEY];
  if(require('./$.fails')(function(){
    var O = {};
    O[SYMBOL] = function(){ return 7; };
    return ''[KEY](O) != 7;
  })){
    require('./$.redef')(String.prototype, KEY, exec(defined, SYMBOL, original));
    require('./$.hide')(RegExp.prototype, SYMBOL, length == 2
      // 21.2.5.8 RegExp.prototype[@@replace](string, replaceValue)
      // 21.2.5.11 RegExp.prototype[@@split](string, limit)
      ? function(string, arg){ return original.call(string, this, arg); }
      // 21.2.5.6 RegExp.prototype[@@match](string)
      // 21.2.5.9 RegExp.prototype[@@search](string)
      : function(string){ return original.call(string, this); }
    );
  }
};
},{"./$.defined":17,"./$.fails":21,"./$.hide":28,"./$.redef":53,"./$.wks":76}],23:[function(require,module,exports){
'use strict';
// 21.2.5.3 get RegExp.prototype.flags
var anObject = require('./$.an-object');
module.exports = function(){
  var that   = anObject(this)
    , result = '';
  if(that.global)result += 'g';
  if(that.ignoreCase)result += 'i';
  if(that.multiline)result += 'm';
  if(that.unicode)result += 'u';
  if(that.sticky)result += 'y';
  return result;
};
},{"./$.an-object":4}],24:[function(require,module,exports){
var ctx         = require('./$.ctx')
  , call        = require('./$.iter-call')
  , isArrayIter = require('./$.is-array-iter')
  , anObject    = require('./$.an-object')
  , toLength    = require('./$.to-length')
  , getIterFn   = require('./core.get-iterator-method');
module.exports = function(iterable, entries, fn, that){
  var iterFn = getIterFn(iterable)
    , f      = ctx(fn, that, entries ? 2 : 1)
    , index  = 0
    , length, step, iterator;
  if(typeof iterFn != 'function')throw TypeError(iterable + ' is not iterable!');
  // fast case for arrays with default iterator
  if(isArrayIter(iterFn))for(length = toLength(iterable.length); length > index; index++){
    entries ? f(anObject(step = iterable[index])[0], step[1]) : f(iterable[index]);
  } else for(iterator = iterFn.call(iterable); !(step = iterator.next()).done; ){
    call(iterator, f, step.value, entries);
  }
};
},{"./$.an-object":4,"./$.ctx":15,"./$.is-array-iter":32,"./$.iter-call":35,"./$.to-length":72,"./core.get-iterator-method":77}],25:[function(require,module,exports){
// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window
var toString  = {}.toString
  , toIObject = require('./$.to-iobject')
  , getNames  = require('./$').getNames;

var windowNames = typeof window == 'object' && Object.getOwnPropertyNames
  ? Object.getOwnPropertyNames(window) : [];

var getWindowNames = function(it){
  try {
    return getNames(it);
  } catch(e){
    return windowNames.slice();
  }
};

module.exports.get = function getOwnPropertyNames(it){
  if(windowNames && toString.call(it) == '[object Window]')return getWindowNames(it);
  return getNames(toIObject(it));
};
},{"./$":41,"./$.to-iobject":71}],26:[function(require,module,exports){
// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028
var UNDEFINED = 'undefined';
var global = module.exports = typeof window != UNDEFINED && window.Math == Math
  ? window : typeof self != UNDEFINED && self.Math == Math ? self : Function('return this')();
if(typeof __g == 'number')__g = global; // eslint-disable-line no-undef
},{}],27:[function(require,module,exports){
var hasOwnProperty = {}.hasOwnProperty;
module.exports = function(it, key){
  return hasOwnProperty.call(it, key);
};
},{}],28:[function(require,module,exports){
var $          = require('./$')
  , createDesc = require('./$.property-desc');
module.exports = require('./$.support-desc') ? function(object, key, value){
  return $.setDesc(object, key, createDesc(1, value));
} : function(object, key, value){
  object[key] = value;
  return object;
};
},{"./$":41,"./$.property-desc":52,"./$.support-desc":66}],29:[function(require,module,exports){
module.exports = require('./$.global').document && document.documentElement;
},{"./$.global":26}],30:[function(require,module,exports){
// fast apply, http://jsperf.lnkit.com/fast-apply/5
module.exports = function(fn, args, that){
  var un = that === undefined;
  switch(args.length){
    case 0: return un ? fn()
                      : fn.call(that);
    case 1: return un ? fn(args[0])
                      : fn.call(that, args[0]);
    case 2: return un ? fn(args[0], args[1])
                      : fn.call(that, args[0], args[1]);
    case 3: return un ? fn(args[0], args[1], args[2])
                      : fn.call(that, args[0], args[1], args[2]);
    case 4: return un ? fn(args[0], args[1], args[2], args[3])
                      : fn.call(that, args[0], args[1], args[2], args[3]);
  } return              fn.apply(that, args);
};
},{}],31:[function(require,module,exports){
// indexed object, fallback for non-array-like ES3 strings
var cof = require('./$.cof');
module.exports = 0 in Object('z') ? Object : function(it){
  return cof(it) == 'String' ? it.split('') : Object(it);
};
},{"./$.cof":9}],32:[function(require,module,exports){
// check on default Array iterator
var Iterators = require('./$.iterators')
  , ITERATOR  = require('./$.wks')('iterator');
module.exports = function(it){
  return (Iterators.Array || Array.prototype[ITERATOR]) === it;
};
},{"./$.iterators":40,"./$.wks":76}],33:[function(require,module,exports){
// 20.1.2.3 Number.isInteger(number)
var isObject = require('./$.is-object')
  , floor    = Math.floor;
module.exports = function isInteger(it){
  return !isObject(it) && isFinite(it) && floor(it) === it;
};
},{"./$.is-object":34}],34:[function(require,module,exports){
// http://jsperf.com/core-js-isobject
module.exports = function(it){
  return it !== null && (typeof it == 'object' || typeof it == 'function');
};
},{}],35:[function(require,module,exports){
// call something on iterator step with safe closing on error
var anObject = require('./$.an-object');
module.exports = function(iterator, fn, value, entries){
  try {
    return entries ? fn(anObject(value)[0], value[1]) : fn(value);
  // 7.4.6 IteratorClose(iterator, completion)
  } catch(e){
    var ret = iterator['return'];
    if(ret !== undefined)anObject(ret.call(iterator));
    throw e;
  }
};
},{"./$.an-object":4}],36:[function(require,module,exports){
'use strict';
var $ = require('./$')
  , IteratorPrototype = {};

// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()
require('./$.hide')(IteratorPrototype, require('./$.wks')('iterator'), function(){ return this; });

module.exports = function(Constructor, NAME, next){
  Constructor.prototype = $.create(IteratorPrototype, {next: require('./$.property-desc')(1,next)});
  require('./$.tag')(Constructor, NAME + ' Iterator');
};
},{"./$":41,"./$.hide":28,"./$.property-desc":52,"./$.tag":67,"./$.wks":76}],37:[function(require,module,exports){
'use strict';
var LIBRARY         = require('./$.library')
  , $def            = require('./$.def')
  , $redef          = require('./$.redef')
  , hide            = require('./$.hide')
  , has             = require('./$.has')
  , SYMBOL_ITERATOR = require('./$.wks')('iterator')
  , Iterators       = require('./$.iterators')
  , BUGGY           = !([].keys && 'next' in [].keys()) // Safari has buggy iterators w/o `next`
  , FF_ITERATOR     = '@@iterator'
  , KEYS            = 'keys'
  , VALUES          = 'values';
var returnThis = function(){ return this; };
module.exports = function(Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCE){
  require('./$.iter-create')(Constructor, NAME, next);
  var createMethod = function(kind){
    switch(kind){
      case KEYS: return function keys(){ return new Constructor(this, kind); };
      case VALUES: return function values(){ return new Constructor(this, kind); };
    } return function entries(){ return new Constructor(this, kind); };
  };
  var TAG      = NAME + ' Iterator'
    , proto    = Base.prototype
    , _native  = proto[SYMBOL_ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT]
    , _default = _native || createMethod(DEFAULT)
    , methods, key;
  // Fix native
  if(_native){
    var IteratorPrototype = require('./$').getProto(_default.call(new Base));
    // Set @@toStringTag to native iterators
    require('./$.tag')(IteratorPrototype, TAG, true);
    // FF fix
    if(!LIBRARY && has(proto, FF_ITERATOR))hide(IteratorPrototype, SYMBOL_ITERATOR, returnThis);
  }
  // Define iterator
  if(!LIBRARY || FORCE)hide(proto, SYMBOL_ITERATOR, _default);
  // Plug for library
  Iterators[NAME] = _default;
  Iterators[TAG]  = returnThis;
  if(DEFAULT){
    methods = {
      keys:    IS_SET            ? _default : createMethod(KEYS),
      values:  DEFAULT == VALUES ? _default : createMethod(VALUES),
      entries: DEFAULT != VALUES ? _default : createMethod('entries')
    };
    if(FORCE)for(key in methods){
      if(!(key in proto))$redef(proto, key, methods[key]);
    } else $def($def.P + $def.F * BUGGY, NAME, methods);
  }
};
},{"./$":41,"./$.def":16,"./$.has":27,"./$.hide":28,"./$.iter-create":36,"./$.iterators":40,"./$.library":43,"./$.redef":53,"./$.tag":67,"./$.wks":76}],38:[function(require,module,exports){
var SYMBOL_ITERATOR = require('./$.wks')('iterator')
  , SAFE_CLOSING    = false;
try {
  var riter = [7][SYMBOL_ITERATOR]();
  riter['return'] = function(){ SAFE_CLOSING = true; };
  Array.from(riter, function(){ throw 2; });
} catch(e){ /* empty */ }
module.exports = function(exec){
  if(!SAFE_CLOSING)return false;
  var safe = false;
  try {
    var arr  = [7]
      , iter = arr[SYMBOL_ITERATOR]();
    iter.next = function(){ safe = true; };
    arr[SYMBOL_ITERATOR] = function(){ return iter; };
    exec(arr);
  } catch(e){ /* empty */ }
  return safe;
};
},{"./$.wks":76}],39:[function(require,module,exports){
module.exports = function(done, value){
  return {value: value, done: !!done};
};
},{}],40:[function(require,module,exports){
module.exports = {};
},{}],41:[function(require,module,exports){
var $Object = Object;
module.exports = {
  create:     $Object.create,
  getProto:   $Object.getPrototypeOf,
  isEnum:     {}.propertyIsEnumerable,
  getDesc:    $Object.getOwnPropertyDescriptor,
  setDesc:    $Object.defineProperty,
  setDescs:   $Object.defineProperties,
  getKeys:    $Object.keys,
  getNames:   $Object.getOwnPropertyNames,
  getSymbols: $Object.getOwnPropertySymbols,
  each:       [].forEach
};
},{}],42:[function(require,module,exports){
var $         = require('./$')
  , toIObject = require('./$.to-iobject');
module.exports = function(object, el){
  var O      = toIObject(object)
    , keys   = $.getKeys(O)
    , length = keys.length
    , index  = 0
    , key;
  while(length > index)if(O[key = keys[index++]] === el)return key;
};
},{"./$":41,"./$.to-iobject":71}],43:[function(require,module,exports){
module.exports = false;
},{}],44:[function(require,module,exports){
// 20.2.2.20 Math.log1p(x)
module.exports = Math.log1p || function log1p(x){
  return (x = +x) > -1e-8 && x < 1e-8 ? x - x * x / 2 : Math.log(1 + x);
};
},{}],45:[function(require,module,exports){
var global    = require('./$.global')
  , macrotask = require('./$.task').set
  , Observer  = global.MutationObserver || global.WebKitMutationObserver
  , process   = global.process
  , isNode    = require('./$.cof')(process) == 'process'
  , head, last, notify;

var flush = function(){
  var parent, domain;
  if(isNode && (parent = process.domain)){
    process.domain = null;
    parent.exit();
  }
  while(head){
    domain = head.domain;
    if(domain)domain.enter();
    head.fn.call(); // <- currently we use it only for Promise - try / catch not required
    if(domain)domain.exit();
    head = head.next;
  } last = undefined;
  if(parent)parent.enter();
}

// Node.js
if(isNode){
  notify = function(){
    process.nextTick(flush);
  };
// browsers with MutationObserver
} else if(Observer){
  var toggle = 1
    , node   = document.createTextNode('');
  new Observer(flush).observe(node, {characterData: true}); // eslint-disable-line no-new
  notify = function(){
    node.data = toggle = -toggle;
  };
// for other environments - macrotask based on:
// - setImmediate
// - MessageChannel
// - window.postMessag
// - onreadystatechange
// - setTimeout
} else {
  notify = function(){
    // strange IE + webpack dev server bug - use .call(global)
    macrotask.call(global, flush);
  };
}

module.exports = function asap(fn){
  var task = {fn: fn, next: undefined, domain: isNode && process.domain};
  if(last)last.next = task;
  if(!head){
    head = task;
    notify();
  } last = task;
};
},{"./$.cof":9,"./$.global":26,"./$.task":68}],46:[function(require,module,exports){
var $redef = require('./$.redef');
module.exports = function(target, src){
  for(var key in src)$redef(target, key, src[key]);
  return target;
};
},{"./$.redef":53}],47:[function(require,module,exports){
// most Object methods by ES6 should accept primitives
module.exports = function(KEY, exec){
  var $def = require('./$.def')
    , fn   = (require('./$.core').Object || {})[KEY] || Object[KEY]
    , exp  = {};
  exp[KEY] = exec(fn);
  $def($def.S + $def.F * require('./$.fails')(function(){ fn(1); }), 'Object', exp);
};
},{"./$.core":14,"./$.def":16,"./$.fails":21}],48:[function(require,module,exports){
var $         = require('./$')
  , toIObject = require('./$.to-iobject');
module.exports = function(isEntries){
  return function(it){
    var O      = toIObject(it)
      , keys   = $.getKeys(O)
      , length = keys.length
      , i      = 0
      , result = Array(length)
      , key;
    if(isEntries)while(length > i)result[i] = [key = keys[i++], O[key]];
    else while(length > i)result[i] = O[keys[i++]];
    return result;
  };
};
},{"./$":41,"./$.to-iobject":71}],49:[function(require,module,exports){
// all object keys, includes non-enumerable and symbols
var $        = require('./$')
  , anObject = require('./$.an-object')
  , Reflect  = require('./$.global').Reflect;
module.exports = Reflect && Reflect.ownKeys || function ownKeys(it){
  var keys       = $.getNames(anObject(it))
    , getSymbols = $.getSymbols;
  return getSymbols ? keys.concat(getSymbols(it)) : keys;
};
},{"./$":41,"./$.an-object":4,"./$.global":26}],50:[function(require,module,exports){
'use strict';
var path      = require('./$.path')
  , invoke    = require('./$.invoke')
  , aFunction = require('./$.a-function');
module.exports = function(/* ...pargs */){
  var fn     = aFunction(this)
    , length = arguments.length
    , pargs  = Array(length)
    , i      = 0
    , _      = path._
    , holder = false;
  while(length > i)if((pargs[i] = arguments[i++]) === _)holder = true;
  return function(/* ...args */){
    var that    = this
      , _length = arguments.length
      , j = 0, k = 0, args;
    if(!holder && !_length)return invoke(fn, pargs, that);
    args = pargs.slice();
    if(holder)for(;length > j; j++)if(args[j] === _)args[j] = arguments[k++];
    while(_length > k)args.push(arguments[k++]);
    return invoke(fn, args, that);
  };
};
},{"./$.a-function":3,"./$.invoke":30,"./$.path":51}],51:[function(require,module,exports){
module.exports = require('./$.global');
},{"./$.global":26}],52:[function(require,module,exports){
module.exports = function(bitmap, value){
  return {
    enumerable  : !(bitmap & 1),
    configurable: !(bitmap & 2),
    writable    : !(bitmap & 4),
    value       : value
  };
};
},{}],53:[function(require,module,exports){
// add fake Function#toString
// for correct work wrapped methods / constructors with methods like LoDash isNative
var global    = require('./$.global')
  , hide      = require('./$.hide')
  , SRC       = require('./$.uid')('src')
  , TO_STRING = 'toString'
  , $toString = Function[TO_STRING]
  , TPL       = ('' + $toString).split(TO_STRING);

require('./$.core').inspectSource = function(it){
  return $toString.call(it);
};

(module.exports = function(O, key, val, safe){
  if(typeof val == 'function'){
    hide(val, SRC, O[key] ? '' + O[key] : TPL.join(String(key)));
    if(!('name' in val))val.name = key;
  }
  if(O === global){
    O[key] = val;
  } else {
    if(!safe)delete O[key];
    hide(O, key, val);
  }
})(Function.prototype, TO_STRING, function toString(){
  return typeof this == 'function' && this[SRC] || $toString.call(this);
});
},{"./$.core":14,"./$.global":26,"./$.hide":28,"./$.uid":74}],54:[function(require,module,exports){
module.exports = function(regExp, replace){
  var replacer = replace === Object(replace) ? function(part){
    return replace[part];
  } : replace;
  return function(it){
    return String(it).replace(regExp, replacer);
  };
};
},{}],55:[function(require,module,exports){
module.exports = Object.is || function is(x, y){
  return x === y ? x !== 0 || 1 / x === 1 / y : x != x && y != y;
};
},{}],56:[function(require,module,exports){
// Works with __proto__ only. Old v8 can't work with null proto objects.
/* eslint-disable no-proto */
var getDesc  = require('./$').getDesc
  , isObject = require('./$.is-object')
  , anObject = require('./$.an-object');
var check = function(O, proto){
  anObject(O);
  if(!isObject(proto) && proto !== null)throw TypeError(proto + ": can't set as prototype!");
};
module.exports = {
  set: Object.setPrototypeOf || ('__proto__' in {} // eslint-disable-line
    ? function(buggy, set){
        try {
          set = require('./$.ctx')(Function.call, getDesc(Object.prototype, '__proto__').set, 2);
          set({}, []);
        } catch(e){ buggy = true; }
        return function setPrototypeOf(O, proto){
          check(O, proto);
          if(buggy)O.__proto__ = proto;
          else set(O, proto);
          return O;
        };
      }()
    : undefined),
  check: check
};
},{"./$":41,"./$.an-object":4,"./$.ctx":15,"./$.is-object":34}],57:[function(require,module,exports){
var global = require('./$.global')
  , SHARED = '__core-js_shared__'
  , store  = global[SHARED] || (global[SHARED] = {});
module.exports = function(key){
  return store[key] || (store[key] = {});
};
},{"./$.global":26}],58:[function(require,module,exports){
// 20.2.2.28 Math.sign(x)
module.exports = Math.sign || function sign(x){
  return (x = +x) == 0 || x != x ? x : x < 0 ? -1 : 1;
};
},{}],59:[function(require,module,exports){
'use strict';
var $       = require('./$')
  , SPECIES = require('./$.wks')('species');
module.exports = function(C){
  if(require('./$.support-desc') && !(SPECIES in C))$.setDesc(C, SPECIES, {
    configurable: true,
    get: function(){ return this; }
  });
};
},{"./$":41,"./$.support-desc":66,"./$.wks":76}],60:[function(require,module,exports){
module.exports = function(it, Constructor, name){
  if(!(it instanceof Constructor))throw TypeError(name + ": use the 'new' operator!");
  return it;
};
},{}],61:[function(require,module,exports){
// true  -> String#at
// false -> String#codePointAt
var toInteger = require('./$.to-integer')
  , defined   = require('./$.defined');
module.exports = function(TO_STRING){
  return function(that, pos){
    var s = String(defined(that))
      , i = toInteger(pos)
      , l = s.length
      , a, b;
    if(i < 0 || i >= l)return TO_STRING ? '' : undefined;
    a = s.charCodeAt(i);
    return a < 0xd800 || a > 0xdbff || i + 1 === l
      || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff
        ? TO_STRING ? s.charAt(i) : a
        : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;
  };
};
},{"./$.defined":17,"./$.to-integer":70}],62:[function(require,module,exports){
// helper for String#{startsWith, endsWith, includes}
var defined = require('./$.defined')
  , cof     = require('./$.cof');

module.exports = function(that, searchString, NAME){
  if(cof(searchString) == 'RegExp')throw TypeError('String#' + NAME + " doesn't accept regex!");
  return String(defined(that));
};
},{"./$.cof":9,"./$.defined":17}],63:[function(require,module,exports){
// https://github.com/ljharb/proposal-string-pad-left-right
var toLength = require('./$.to-length')
  , repeat   = require('./$.string-repeat')
  , defined  = require('./$.defined');

module.exports = function(that, maxLength, fillString, left){
  var S            = String(defined(that))
    , stringLength = S.length
    , fillStr      = fillString === undefined ? ' ' : String(fillString)
    , intMaxLength = toLength(maxLength);
  if(intMaxLength <= stringLength)return S;
  if(fillStr == '')fillStr = ' ';
  var fillLen = intMaxLength - stringLength
    , stringFiller = repeat.call(fillStr, Math.ceil(fillLen / fillStr.length));
  if(stringFiller.length > fillLen)stringFiller = left
    ? stringFiller.slice(stringFiller.length - fillLen)
    : stringFiller.slice(0, fillLen);
  return left ? stringFiller + S : S + stringFiller;
};
},{"./$.defined":17,"./$.string-repeat":64,"./$.to-length":72}],64:[function(require,module,exports){
'use strict';
var toInteger = require('./$.to-integer')
  , defined   = require('./$.defined');

module.exports = function repeat(count){
  var str = String(defined(this))
    , res = ''
    , n   = toInteger(count);
  if(n < 0 || n == Infinity)throw RangeError("Count can't be negative");
  for(;n > 0; (n >>>= 1) && (str += str))if(n & 1)res += str;
  return res;
};
},{"./$.defined":17,"./$.to-integer":70}],65:[function(require,module,exports){
// 1 -> String#trimLeft
// 2 -> String#trimRight
// 3 -> String#trim
var trim = function(string, TYPE){
  string = String(defined(string));
  if(TYPE & 1)string = string.replace(ltrim, '');
  if(TYPE & 2)string = string.replace(rtrim, '');
  return string;
};

var $def    = require('./$.def')
  , defined = require('./$.defined')
  , spaces  = '\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003' +
      '\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF'
  , space   = '[' + spaces + ']'
  , non     = '\u200b\u0085'
  , ltrim   = RegExp('^' + space + space + '*')
  , rtrim   = RegExp(space + space + '*$');

module.exports = function(KEY, exec){
  var exp  = {};
  exp[KEY] = exec(trim);
  $def($def.P + $def.F * require('./$.fails')(function(){
    return !!spaces[KEY]() || non[KEY]() != non;
  }), 'String', exp);
};
},{"./$.def":16,"./$.defined":17,"./$.fails":21}],66:[function(require,module,exports){
// Thank's IE8 for his funny defineProperty
module.exports = !require('./$.fails')(function(){
  return Object.defineProperty({}, 'a', {get: function(){ return 7; }}).a != 7;
});
},{"./$.fails":21}],67:[function(require,module,exports){
var has  = require('./$.has')
  , hide = require('./$.hide')
  , TAG  = require('./$.wks')('toStringTag');

module.exports = function(it, tag, stat){
  if(it && !has(it = stat ? it : it.prototype, TAG))hide(it, TAG, tag);
};
},{"./$.has":27,"./$.hide":28,"./$.wks":76}],68:[function(require,module,exports){
'use strict';
var ctx                = require('./$.ctx')
  , invoke             = require('./$.invoke')
  , html               = require('./$.html')
  , cel                = require('./$.dom-create')
  , global             = require('./$.global')
  , process            = global.process
  , setTask            = global.setImmediate
  , clearTask          = global.clearImmediate
  , MessageChannel     = global.MessageChannel
  , counter            = 0
  , queue              = {}
  , ONREADYSTATECHANGE = 'onreadystatechange'
  , defer, channel, port;
var run = function(){
  var id = +this;
  if(queue.hasOwnProperty(id)){
    var fn = queue[id];
    delete queue[id];
    fn();
  }
};
var listner = function(event){
  run.call(event.data);
};
// Node.js 0.9+ & IE10+ has setImmediate, otherwise:
if(!setTask || !clearTask){
  setTask = function setImmediate(fn){
    var args = [], i = 1;
    while(arguments.length > i)args.push(arguments[i++]);
    queue[++counter] = function(){
      invoke(typeof fn == 'function' ? fn : Function(fn), args);
    };
    defer(counter);
    return counter;
  };
  clearTask = function clearImmediate(id){
    delete queue[id];
  };
  // Node.js 0.8-
  if(require('./$.cof')(process) == 'process'){
    defer = function(id){
      process.nextTick(ctx(run, id, 1));
    };
  // Browsers with MessageChannel, includes WebWorkers
  } else if(MessageChannel){
    channel = new MessageChannel;
    port    = channel.port2;
    channel.port1.onmessage = listner;
    defer = ctx(port.postMessage, port, 1);
  // Browsers with postMessage, skip WebWorkers
  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'
  } else if(global.addEventListener && typeof postMessage == 'function' && !global.importScript){
    defer = function(id){
      global.postMessage(id + '', '*');
    };
    global.addEventListener('message', listner, false);
  // IE8-
  } else if(ONREADYSTATECHANGE in cel('script')){
    defer = function(id){
      html.appendChild(cel('script'))[ONREADYSTATECHANGE] = function(){
        html.removeChild(this);
        run.call(id);
      };
    };
  // Rest old browsers
  } else {
    defer = function(id){
      setTimeout(ctx(run, id, 1), 0);
    };
  }
}
module.exports = {
  set:   setTask,
  clear: clearTask
};
},{"./$.cof":9,"./$.ctx":15,"./$.dom-create":18,"./$.global":26,"./$.html":29,"./$.invoke":30}],69:[function(require,module,exports){
var toInteger = require('./$.to-integer')
  , max       = Math.max
  , min       = Math.min;
module.exports = function(index, length){
  index = toInteger(index);
  return index < 0 ? max(index + length, 0) : min(index, length);
};
},{"./$.to-integer":70}],70:[function(require,module,exports){
// 7.1.4 ToInteger
var ceil  = Math.ceil
  , floor = Math.floor;
module.exports = function(it){
  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);
};
},{}],71:[function(require,module,exports){
// to indexed object, toObject with fallback for non-array-like ES3 strings
var IObject = require('./$.iobject')
  , defined = require('./$.defined');
module.exports = function(it){
  return IObject(defined(it));
};
},{"./$.defined":17,"./$.iobject":31}],72:[function(require,module,exports){
// 7.1.15 ToLength
var toInteger = require('./$.to-integer')
  , min       = Math.min;
module.exports = function(it){
  return it > 0 ? min(toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991
};
},{"./$.to-integer":70}],73:[function(require,module,exports){
// 7.1.13 ToObject(argument)
var defined = require('./$.defined');
module.exports = function(it){
  return Object(defined(it));
};
},{"./$.defined":17}],74:[function(require,module,exports){
var id = 0
  , px = Math.random();
module.exports = function(key){
  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));
};
},{}],75:[function(require,module,exports){
// 22.1.3.31 Array.prototype[@@unscopables]
var UNSCOPABLES = require('./$.wks')('unscopables');
if(!(UNSCOPABLES in []))require('./$.hide')(Array.prototype, UNSCOPABLES, {});
module.exports = function(key){
  [][UNSCOPABLES][key] = true;
};
},{"./$.hide":28,"./$.wks":76}],76:[function(require,module,exports){
var store  = require('./$.shared')('wks')
  , Symbol = require('./$.global').Symbol;
module.exports = function(name){
  return store[name] || (store[name] =
    Symbol && Symbol[name] || (Symbol || require('./$.uid'))('Symbol.' + name));
};
},{"./$.global":26,"./$.shared":57,"./$.uid":74}],77:[function(require,module,exports){
var classof   = require('./$.classof')
  , ITERATOR  = require('./$.wks')('iterator')
  , Iterators = require('./$.iterators');
module.exports = require('./$.core').getIteratorMethod = function(it){
  if(it != undefined)return it[ITERATOR] || it['@@iterator'] || Iterators[classof(it)];
};
},{"./$.classof":8,"./$.core":14,"./$.iterators":40,"./$.wks":76}],78:[function(require,module,exports){
'use strict';
var $                = require('./$')
  , SUPPORT_DESC     = require('./$.support-desc')
  , createDesc       = require('./$.property-desc')
  , html             = require('./$.html')
  , cel              = require('./$.dom-create')
  , has              = require('./$.has')
  , cof              = require('./$.cof')
  , $def             = require('./$.def')
  , invoke           = require('./$.invoke')
  , arrayMethod      = require('./$.array-methods')
  , IE_PROTO         = require('./$.uid')('__proto__')
  , isObject         = require('./$.is-object')
  , anObject         = require('./$.an-object')
  , aFunction        = require('./$.a-function')
  , toObject         = require('./$.to-object')
  , toIObject        = require('./$.to-iobject')
  , toInteger        = require('./$.to-integer')
  , toIndex          = require('./$.to-index')
  , toLength         = require('./$.to-length')
  , IObject          = require('./$.iobject')
  , fails            = require('./$.fails')
  , ObjectProto      = Object.prototype
  , A                = []
  , _slice           = A.slice
  , _join            = A.join
  , defineProperty   = $.setDesc
  , getOwnDescriptor = $.getDesc
  , defineProperties = $.setDescs
  , $indexOf         = require('./$.array-includes')(false)
  , factories        = {}
  , IE8_DOM_DEFINE;

if(!SUPPORT_DESC){
  IE8_DOM_DEFINE = !fails(function(){
    return defineProperty(cel('div'), 'a', {get: function(){ return 7; }}).a != 7;
  });
  $.setDesc = function(O, P, Attributes){
    if(IE8_DOM_DEFINE)try {
      return defineProperty(O, P, Attributes);
    } catch(e){ /* empty */ }
    if('get' in Attributes || 'set' in Attributes)throw TypeError('Accessors not supported!');
    if('value' in Attributes)anObject(O)[P] = Attributes.value;
    return O;
  };
  $.getDesc = function(O, P){
    if(IE8_DOM_DEFINE)try {
      return getOwnDescriptor(O, P);
    } catch(e){ /* empty */ }
    if(has(O, P))return createDesc(!ObjectProto.propertyIsEnumerable.call(O, P), O[P]);
  };
  $.setDescs = defineProperties = function(O, Properties){
    anObject(O);
    var keys   = $.getKeys(Properties)
      , length = keys.length
      , i = 0
      , P;
    while(length > i)$.setDesc(O, P = keys[i++], Properties[P]);
    return O;
  };
}
$def($def.S + $def.F * !SUPPORT_DESC, 'Object', {
  // 19.1.2.6 / 15.2.3.3 Object.getOwnPropertyDescriptor(O, P)
  getOwnPropertyDescriptor: $.getDesc,
  // 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)
  defineProperty: $.setDesc,
  // 19.1.2.3 / 15.2.3.7 Object.defineProperties(O, Properties)
  defineProperties: defineProperties
});

  // IE 8- don't enum bug keys
var keys1 = ('constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,' +
            'toLocaleString,toString,valueOf').split(',')
  // Additional keys for getOwnPropertyNames
  , keys2 = keys1.concat('length', 'prototype')
  , keysLen1 = keys1.length;

// Create object with `null` prototype: use iframe Object with cleared prototype
var createDict = function(){
  // Thrash, waste and sodomy: IE GC bug
  var iframe = cel('iframe')
    , i      = keysLen1
    , gt     = '>'
    , iframeDocument;
  iframe.style.display = 'none';
  html.appendChild(iframe);
  iframe.src = 'javascript:'; // eslint-disable-line no-script-url
  // createDict = iframe.contentWindow.Object;
  // html.removeChild(iframe);
  iframeDocument = iframe.contentWindow.document;
  iframeDocument.open();
  iframeDocument.write('<script>document.F=Object</script' + gt);
  iframeDocument.close();
  createDict = iframeDocument.F;
  while(i--)delete createDict.prototype[keys1[i]];
  return createDict();
};
var createGetKeys = function(names, length){
  return function(object){
    var O      = toIObject(object)
      , i      = 0
      , result = []
      , key;
    for(key in O)if(key != IE_PROTO)has(O, key) && result.push(key);
    // Don't enum bug & hidden keys
    while(length > i)if(has(O, key = names[i++])){
      ~$indexOf(result, key) || result.push(key);
    }
    return result;
  };
};
var Empty = function(){};
$def($def.S, 'Object', {
  // 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)
  getPrototypeOf: $.getProto = $.getProto || function(O){
    O = toObject(O);
    if(has(O, IE_PROTO))return O[IE_PROTO];
    if(typeof O.constructor == 'function' && O instanceof O.constructor){
      return O.constructor.prototype;
    } return O instanceof Object ? ObjectProto : null;
  },
  // 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)
  getOwnPropertyNames: $.getNames = $.getNames || createGetKeys(keys2, keys2.length, true),
  // 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])
  create: $.create = $.create || function(O, /*?*/Properties){
    var result;
    if(O !== null){
      Empty.prototype = anObject(O);
      result = new Empty();
      Empty.prototype = null;
      // add "__proto__" for Object.getPrototypeOf shim
      result[IE_PROTO] = O;
    } else result = createDict();
    return Properties === undefined ? result : defineProperties(result, Properties);
  },
  // 19.1.2.14 / 15.2.3.14 Object.keys(O)
  keys: $.getKeys = $.getKeys || createGetKeys(keys1, keysLen1, false)
});

var construct = function(F, len, args){
  if(!(len in factories)){
    for(var n = [], i = 0; i < len; i++)n[i] = 'a[' + i + ']';
    factories[len] = Function('F,a', 'return new F(' + n.join(',') + ')');
  }
  return factories[len](F, args);
};

// 19.2.3.2 / 15.3.4.5 Function.prototype.bind(thisArg, args...)
$def($def.P, 'Function', {
  bind: function bind(that /*, args... */){
    var fn       = aFunction(this)
      , partArgs = _slice.call(arguments, 1);
    var bound = function(/* args... */){
      var args = partArgs.concat(_slice.call(arguments));
      return this instanceof bound ? construct(fn, args.length, args) : invoke(fn, args, that);
    };
    if(isObject(fn.prototype))bound.prototype = fn.prototype;
    return bound;
  }
});

// fallback for not array-like ES3 strings and DOM objects
var buggySlice = fails(function(){
  if(html)_slice.call(html);
});

$def($def.P + $def.F * buggySlice, 'Array', {
  slice: function(begin, end){
    var len   = toLength(this.length)
      , klass = cof(this);
    end = end === undefined ? len : end;
    if(klass == 'Array')return _slice.call(this, begin, end);
    var start  = toIndex(begin, len)
      , upTo   = toIndex(end, len)
      , size   = toLength(upTo - start)
      , cloned = Array(size)
      , i      = 0;
    for(; i < size; i++)cloned[i] = klass == 'String'
      ? this.charAt(start + i)
      : this[start + i];
    return cloned;
  }
});
$def($def.P + $def.F * (IObject != Object), 'Array', {
  join: function(){
    return _join.apply(IObject(this), arguments);
  }
});

// 22.1.2.2 / 15.4.3.2 Array.isArray(arg)
$def($def.S, 'Array', {isArray: function(arg){ return cof(arg) == 'Array'; }});

var createArrayReduce = function(isRight){
  return function(callbackfn, memo){
    aFunction(callbackfn);
    var O      = IObject(this)
      , length = toLength(O.length)
      , index  = isRight ? length - 1 : 0
      , i      = isRight ? -1 : 1;
    if(arguments.length < 2)for(;;){
      if(index in O){
        memo = O[index];
        index += i;
        break;
      }
      index += i;
      if(isRight ? index < 0 : length <= index){
        throw TypeError('Reduce of empty array with no initial value');
      }
    }
    for(;isRight ? index >= 0 : length > index; index += i)if(index in O){
      memo = callbackfn(memo, O[index], index, this);
    }
    return memo;
  };
};
var methodize = function($fn){
  return function(arg1/*, arg2 = undefined */){
    return $fn(this, arg1, arguments[1]);
  };
};
$def($def.P, 'Array', {
  // 22.1.3.10 / 15.4.4.18 Array.prototype.forEach(callbackfn [, thisArg])
  forEach: $.each = $.each || methodize(arrayMethod(0)),
  // 22.1.3.15 / 15.4.4.19 Array.prototype.map(callbackfn [, thisArg])
  map: methodize(arrayMethod(1)),
  // 22.1.3.7 / 15.4.4.20 Array.prototype.filter(callbackfn [, thisArg])
  filter: methodize(arrayMethod(2)),
  // 22.1.3.23 / 15.4.4.17 Array.prototype.some(callbackfn [, thisArg])
  some: methodize(arrayMethod(3)),
  // 22.1.3.5 / 15.4.4.16 Array.prototype.every(callbackfn [, thisArg])
  every: methodize(arrayMethod(4)),
  // 22.1.3.18 / 15.4.4.21 Array.prototype.reduce(callbackfn [, initialValue])
  reduce: createArrayReduce(false),
  // 22.1.3.19 / 15.4.4.22 Array.prototype.reduceRight(callbackfn [, initialValue])
  reduceRight: createArrayReduce(true),
  // 22.1.3.11 / 15.4.4.14 Array.prototype.indexOf(searchElement [, fromIndex])
  indexOf: methodize($indexOf),
  // 22.1.3.14 / 15.4.4.15 Array.prototype.lastIndexOf(searchElement [, fromIndex])
  lastIndexOf: function(el, fromIndex /* = @[*-1] */){
    var O      = toIObject(this)
      , length = toLength(O.length)
      , index  = length - 1;
    if(arguments.length > 1)index = Math.min(index, toInteger(fromIndex));
    if(index < 0)index = toLength(length + index);
    for(;index >= 0; index--)if(index in O)if(O[index] === el)return index;
    return -1;
  }
});

// 20.3.3.1 / 15.9.4.4 Date.now()
$def($def.S, 'Date', {now: function(){ return +new Date; }});

var lz = function(num){
  return num > 9 ? num : '0' + num;
};

// 20.3.4.36 / 15.9.5.43 Date.prototype.toISOString()
// PhantomJS and old webkit had a broken Date implementation.
var date       = new Date(-5e13 - 1)
  , brokenDate = !(date.toISOString && date.toISOString() == '0385-07-25T07:06:39.999Z'
      && fails(function(){ new Date(NaN).toISOString(); }));
$def($def.P + $def.F * brokenDate, 'Date', {
  toISOString: function toISOString(){
    if(!isFinite(this))throw RangeError('Invalid time value');
    var d = this
      , y = d.getUTCFullYear()
      , m = d.getUTCMilliseconds()
      , s = y < 0 ? '-' : y > 9999 ? '+' : '';
    return s + ('00000' + Math.abs(y)).slice(s ? -6 : -4) +
      '-' + lz(d.getUTCMonth() + 1) + '-' + lz(d.getUTCDate()) +
      'T' + lz(d.getUTCHours()) + ':' + lz(d.getUTCMinutes()) +
      ':' + lz(d.getUTCSeconds()) + '.' + (m > 99 ? m : '0' + lz(m)) + 'Z';
  }
});
},{"./$":41,"./$.a-function":3,"./$.an-object":4,"./$.array-includes":5,"./$.array-methods":6,"./$.cof":9,"./$.def":16,"./$.dom-create":18,"./$.fails":21,"./$.has":27,"./$.html":29,"./$.invoke":30,"./$.iobject":31,"./$.is-object":34,"./$.property-desc":52,"./$.support-desc":66,"./$.to-index":69,"./$.to-integer":70,"./$.to-iobject":71,"./$.to-length":72,"./$.to-object":73,"./$.uid":74}],79:[function(require,module,exports){
'use strict';
var $def     = require('./$.def')
  , toObject = require('./$.to-object')
  , toIndex  = require('./$.to-index')
  , toLength = require('./$.to-length');
$def($def.P, 'Array', {
  // 22.1.3.3 Array.prototype.copyWithin(target, start, end = this.length)
  copyWithin: function copyWithin(target/* = 0 */, start /* = 0, end = @length */){
    var O     = toObject(this)
      , len   = toLength(O.length)
      , to    = toIndex(target, len)
      , from  = toIndex(start, len)
      , end   = arguments[2]
      , fin   = end === undefined ? len : toIndex(end, len)
      , count = Math.min(fin - from, len - to)
      , inc   = 1;
    if(from < to && to < from + count){
      inc  = -1;
      from = from + count - 1;
      to   = to   + count - 1;
    }
    while(count-- > 0){
      if(from in O)O[to] = O[from];
      else delete O[to];
      to   += inc;
      from += inc;
    } return O;
  }
});
require('./$.unscope')('copyWithin');
},{"./$.def":16,"./$.to-index":69,"./$.to-length":72,"./$.to-object":73,"./$.unscope":75}],80:[function(require,module,exports){
'use strict';
var $def     = require('./$.def')
  , toObject = require('./$.to-object')
  , toIndex  = require('./$.to-index')
  , toLength = require('./$.to-length');
$def($def.P, 'Array', {
  // 22.1.3.6 Array.prototype.fill(value, start = 0, end = this.length)
  fill: function fill(value /*, start = 0, end = @length */){
    var O      = toObject(this, true)
      , length = toLength(O.length)
      , index  = toIndex(arguments[1], length)
      , end    = arguments[2]
      , endPos = end === undefined ? length : toIndex(end, length);
    while(endPos > index)O[index++] = value;
    return O;
  }
});
require('./$.unscope')('fill');
},{"./$.def":16,"./$.to-index":69,"./$.to-length":72,"./$.to-object":73,"./$.unscope":75}],81:[function(require,module,exports){
'use strict';
// 22.1.3.9 Array.prototype.findIndex(predicate, thisArg = undefined)
var KEY    = 'findIndex'
  , $def   = require('./$.def')
  , forced = true
  , $find  = require('./$.array-methods')(6);
// Shouldn't skip holes
if(KEY in [])Array(1)[KEY](function(){ forced = false; });
$def($def.P + $def.F * forced, 'Array', {
  findIndex: function findIndex(callbackfn/*, that = undefined */){
    return $find(this, callbackfn, arguments[1]);
  }
});
require('./$.unscope')(KEY);
},{"./$.array-methods":6,"./$.def":16,"./$.unscope":75}],82:[function(require,module,exports){
'use strict';
// 22.1.3.8 Array.prototype.find(predicate, thisArg = undefined)
var KEY    = 'find'
  , $def   = require('./$.def')
  , forced = true
  , $find  = require('./$.array-methods')(5);
// Shouldn't skip holes
if(KEY in [])Array(1)[KEY](function(){ forced = false; });
$def($def.P + $def.F * forced, 'Array', {
  find: function find(callbackfn/*, that = undefined */){
    return $find(this, callbackfn, arguments[1]);
  }
});
require('./$.unscope')(KEY);
},{"./$.array-methods":6,"./$.def":16,"./$.unscope":75}],83:[function(require,module,exports){
'use strict';
var ctx         = require('./$.ctx')
  , $def        = require('./$.def')
  , toObject    = require('./$.to-object')
  , call        = require('./$.iter-call')
  , isArrayIter = require('./$.is-array-iter')
  , toLength    = require('./$.to-length')
  , getIterFn   = require('./core.get-iterator-method');
$def($def.S + $def.F * !require('./$.iter-detect')(function(iter){ Array.from(iter); }), 'Array', {
  // 22.1.2.1 Array.from(arrayLike, mapfn = undefined, thisArg = undefined)
  from: function from(arrayLike/*, mapfn = undefined, thisArg = undefined*/){
    var O       = toObject(arrayLike)
      , C       = typeof this == 'function' ? this : Array
      , mapfn   = arguments[1]
      , mapping = mapfn !== undefined
      , index   = 0
      , iterFn  = getIterFn(O)
      , length, result, step, iterator;
    if(mapping)mapfn = ctx(mapfn, arguments[2], 2);
    // if object isn't iterable or it's array with default iterator - use simple case
    if(iterFn != undefined && !(C == Array && isArrayIter(iterFn))){
      for(iterator = iterFn.call(O), result = new C; !(step = iterator.next()).done; index++){
        result[index] = mapping ? call(iterator, mapfn, [step.value, index], true) : step.value;
      }
    } else {
      for(result = new C(length = toLength(O.length)); length > index; index++){
        result[index] = mapping ? mapfn(O[index], index) : O[index];
      }
    }
    result.length = index;
    return result;
  }
});
},{"./$.ctx":15,"./$.def":16,"./$.is-array-iter":32,"./$.iter-call":35,"./$.iter-detect":38,"./$.to-length":72,"./$.to-object":73,"./core.get-iterator-method":77}],84:[function(require,module,exports){
'use strict';
var setUnscope = require('./$.unscope')
  , step       = require('./$.iter-step')
  , Iterators  = require('./$.iterators')
  , toIObject  = require('./$.to-iobject');

// 22.1.3.4 Array.prototype.entries()
// 22.1.3.13 Array.prototype.keys()
// 22.1.3.29 Array.prototype.values()
// 22.1.3.30 Array.prototype[@@iterator]()
require('./$.iter-define')(Array, 'Array', function(iterated, kind){
  this._t = toIObject(iterated); // target
  this._i = 0;                   // next index
  this._k = kind;                // kind
// 22.1.5.2.1 %ArrayIteratorPrototype%.next()
}, function(){
  var O     = this._t
    , kind  = this._k
    , index = this._i++;
  if(!O || index >= O.length){
    this._t = undefined;
    return step(1);
  }
  if(kind == 'keys'  )return step(0, index);
  if(kind == 'values')return step(0, O[index]);
  return step(0, [index, O[index]]);
}, 'values');

// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)
Iterators.Arguments = Iterators.Array;

setUnscope('keys');
setUnscope('values');
setUnscope('entries');
},{"./$.iter-define":37,"./$.iter-step":39,"./$.iterators":40,"./$.to-iobject":71,"./$.unscope":75}],85:[function(require,module,exports){
'use strict';
var $def = require('./$.def');

// WebKit Array.of isn't generic
$def($def.S + $def.F * require('./$.fails')(function(){
  function F(){}
  return !(Array.of.call(F) instanceof F);
}), 'Array', {
  // 22.1.2.3 Array.of( ...items)
  of: function of(/* ...args */){
    var index  = 0
      , length = arguments.length
      , result = new (typeof this == 'function' ? this : Array)(length);
    while(length > index)result[index] = arguments[index++];
    result.length = length;
    return result;
  }
});
},{"./$.def":16,"./$.fails":21}],86:[function(require,module,exports){
require('./$.species')(Array);
},{"./$.species":59}],87:[function(require,module,exports){
'use strict';
var $             = require('./$')
  , isObject      = require('./$.is-object')
  , HAS_INSTANCE  = require('./$.wks')('hasInstance')
  , FunctionProto = Function.prototype;
// 19.2.3.6 Function.prototype[@@hasInstance](V)
if(!(HAS_INSTANCE in FunctionProto))$.setDesc(FunctionProto, HAS_INSTANCE, {value: function(O){
  if(typeof this != 'function' || !isObject(O))return false;
  if(!isObject(this.prototype))return O instanceof this;
  // for environment w/o native `@@hasInstance` logic enough `instanceof`, but add this:
  while(O = $.getProto(O))if(this.prototype === O)return true;
  return false;
}});
},{"./$":41,"./$.is-object":34,"./$.wks":76}],88:[function(require,module,exports){
var setDesc    = require('./$').setDesc
  , createDesc = require('./$.property-desc')
  , has        = require('./$.has')
  , FProto     = Function.prototype
  , nameRE     = /^\s*function ([^ (]*)/
  , NAME       = 'name';
// 19.2.4.2 name
NAME in FProto || require('./$.support-desc') && setDesc(FProto, NAME, {
  configurable: true,
  get: function(){
    var match = ('' + this).match(nameRE)
      , name  = match ? match[1] : '';
    has(this, NAME) || setDesc(this, NAME, createDesc(5, name));
    return name;
  }
});
},{"./$":41,"./$.has":27,"./$.property-desc":52,"./$.support-desc":66}],89:[function(require,module,exports){
'use strict';
var strong = require('./$.collection-strong');

// 23.1 Map Objects
require('./$.collection')('Map', function(get){
  return function Map(){ return get(this, arguments[0]); };
}, {
  // 23.1.3.6 Map.prototype.get(key)
  get: function get(key){
    var entry = strong.getEntry(this, key);
    return entry && entry.v;
  },
  // 23.1.3.9 Map.prototype.set(key, value)
  set: function set(key, value){
    return strong.def(this, key === 0 ? 0 : key, value);
  }
}, strong, true);
},{"./$.collection":13,"./$.collection-strong":10}],90:[function(require,module,exports){
// 20.2.2.3 Math.acosh(x)
var $def   = require('./$.def')
  , log1p  = require('./$.log1p')
  , sqrt   = Math.sqrt
  , $acosh = Math.acosh;

// V8 bug https://code.google.com/p/v8/issues/detail?id=3509 
$def($def.S + $def.F * !($acosh && Math.floor($acosh(Number.MAX_VALUE)) == 710), 'Math', {
  acosh: function acosh(x){
    return (x = +x) < 1 ? NaN : x > 94906265.62425156
      ? Math.log(x) + Math.LN2
      : log1p(x - 1 + sqrt(x - 1) * sqrt(x + 1));
  }
});
},{"./$.def":16,"./$.log1p":44}],91:[function(require,module,exports){
// 20.2.2.5 Math.asinh(x)
var $def = require('./$.def');

function asinh(x){
  return !isFinite(x = +x) || x == 0 ? x : x < 0 ? -asinh(-x) : Math.log(x + Math.sqrt(x * x + 1));
}

$def($def.S, 'Math', {asinh: asinh});
},{"./$.def":16}],92:[function(require,module,exports){
// 20.2.2.7 Math.atanh(x)
var $def = require('./$.def');

$def($def.S, 'Math', {
  atanh: function atanh(x){
    return (x = +x) == 0 ? x : Math.log((1 + x) / (1 - x)) / 2;
  }
});
},{"./$.def":16}],93:[function(require,module,exports){
// 20.2.2.9 Math.cbrt(x)
var $def = require('./$.def')
  , sign = require('./$.sign');

$def($def.S, 'Math', {
  cbrt: function cbrt(x){
    return sign(x = +x) * Math.pow(Math.abs(x), 1 / 3);
  }
});
},{"./$.def":16,"./$.sign":58}],94:[function(require,module,exports){
// 20.2.2.11 Math.clz32(x)
var $def = require('./$.def');

$def($def.S, 'Math', {
  clz32: function clz32(x){
    return (x >>>= 0) ? 31 - Math.floor(Math.log(x + 0.5) * Math.LOG2E) : 32;
  }
});
},{"./$.def":16}],95:[function(require,module,exports){
// 20.2.2.12 Math.cosh(x)
var $def = require('./$.def')
  , exp  = Math.exp;

$def($def.S, 'Math', {
  cosh: function cosh(x){
    return (exp(x = +x) + exp(-x)) / 2;
  }
});
},{"./$.def":16}],96:[function(require,module,exports){
// 20.2.2.14 Math.expm1(x)
var $def = require('./$.def');

$def($def.S, 'Math', {expm1: require('./$.expm1')});
},{"./$.def":16,"./$.expm1":20}],97:[function(require,module,exports){
// 20.2.2.16 Math.fround(x)
var $def  = require('./$.def')
  , sign  = require('./$.sign')
  , pow   = Math.pow
  , EPSILON   = pow(2, -52)
  , EPSILON32 = pow(2, -23)
  , MAX32     = pow(2, 127) * (2 - EPSILON32)
  , MIN32     = pow(2, -126);

var roundTiesToEven = function(n){
  return n + 1 / EPSILON - 1 / EPSILON;
};


$def($def.S, 'Math', {
  fround: function fround(x){
    var $abs  = Math.abs(x)
      , $sign = sign(x)
      , a, result;
    if($abs < MIN32)return $sign * roundTiesToEven($abs / MIN32 / EPSILON32) * MIN32 * EPSILON32;
    a = (1 + EPSILON32 / EPSILON) * $abs;
    result = a - (a - $abs);
    if(result > MAX32 || result != result)return $sign * Infinity;
    return $sign * result;
  }
});
},{"./$.def":16,"./$.sign":58}],98:[function(require,module,exports){
// 20.2.2.17 Math.hypot([value1[, value2[, … ]]])
var $def = require('./$.def')
  , abs  = Math.abs;

$def($def.S, 'Math', {
  hypot: function hypot(value1, value2){ // eslint-disable-line no-unused-vars
    var sum  = 0
      , i    = 0
      , len  = arguments.length
      , larg = 0
      , arg, div;
    while(i < len){
      arg = abs(arguments[i++]);
      if(larg < arg){
        div  = larg / arg;
        sum  = sum * div * div + 1;
        larg = arg;
      } else if(arg > 0){
        div  = arg / larg;
        sum += div * div;
      } else sum += arg;
    }
    return larg === Infinity ? Infinity : larg * Math.sqrt(sum);
  }
});
},{"./$.def":16}],99:[function(require,module,exports){
// 20.2.2.18 Math.imul(x, y)
var $def = require('./$.def');

// WebKit fails with big numbers
$def($def.S + $def.F * require('./$.fails')(function(){
  return Math.imul(0xffffffff, 5) != -5;
}), 'Math', {
  imul: function imul(x, y){
    var UINT16 = 0xffff
      , xn = +x
      , yn = +y
      , xl = UINT16 & xn
      , yl = UINT16 & yn;
    return 0 | xl * yl + ((UINT16 & xn >>> 16) * yl + xl * (UINT16 & yn >>> 16) << 16 >>> 0);
  }
});
},{"./$.def":16,"./$.fails":21}],100:[function(require,module,exports){
// 20.2.2.21 Math.log10(x)
var $def = require('./$.def');

$def($def.S, 'Math', {
  log10: function log10(x){
    return Math.log(x) / Math.LN10;
  }
});
},{"./$.def":16}],101:[function(require,module,exports){
// 20.2.2.20 Math.log1p(x)
var $def = require('./$.def');

$def($def.S, 'Math', {log1p: require('./$.log1p')});
},{"./$.def":16,"./$.log1p":44}],102:[function(require,module,exports){
// 20.2.2.22 Math.log2(x)
var $def = require('./$.def');

$def($def.S, 'Math', {
  log2: function log2(x){
    return Math.log(x) / Math.LN2;
  }
});
},{"./$.def":16}],103:[function(require,module,exports){
// 20.2.2.28 Math.sign(x)
var $def = require('./$.def');

$def($def.S, 'Math', {sign: require('./$.sign')});
},{"./$.def":16,"./$.sign":58}],104:[function(require,module,exports){
// 20.2.2.30 Math.sinh(x)
var $def  = require('./$.def')
  , expm1 = require('./$.expm1')
  , exp   = Math.exp;

$def($def.S, 'Math', {
  sinh: function sinh(x){
    return Math.abs(x = +x) < 1
      ? (expm1(x) - expm1(-x)) / 2
      : (exp(x - 1) - exp(-x - 1)) * (Math.E / 2);
  }
});
},{"./$.def":16,"./$.expm1":20}],105:[function(require,module,exports){
// 20.2.2.33 Math.tanh(x)
var $def  = require('./$.def')
  , expm1 = require('./$.expm1')
  , exp   = Math.exp;

$def($def.S, 'Math', {
  tanh: function tanh(x){
    var a = expm1(x = +x)
      , b = expm1(-x);
    return a == Infinity ? 1 : b == Infinity ? -1 : (a - b) / (exp(x) + exp(-x));
  }
});
},{"./$.def":16,"./$.expm1":20}],106:[function(require,module,exports){
// 20.2.2.34 Math.trunc(x)
var $def = require('./$.def');

$def($def.S, 'Math', {
  trunc: function trunc(it){
    return (it > 0 ? Math.floor : Math.ceil)(it);
  }
});
},{"./$.def":16}],107:[function(require,module,exports){
'use strict';
var $          = require('./$')
  , global     = require('./$.global')
  , has        = require('./$.has')
  , cof        = require('./$.cof')
  , isObject   = require('./$.is-object')
  , fails      = require('./$.fails')
  , NUMBER     = 'Number'
  , $Number    = global[NUMBER]
  , Base       = $Number
  , proto      = $Number.prototype
  // Opera ~12 has broken Object#toString
  , BROKEN_COF = cof($.create(proto)) == NUMBER;
var toPrimitive = function(it){
  var fn, val;
  if(typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it)))return val;
  if(typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it)))return val;
  throw TypeError("Can't convert object to number");
};
var toNumber = function(it){
  if(isObject(it))it = toPrimitive(it);
  if(typeof it == 'string' && it.length > 2 && it.charCodeAt(0) == 48){
    var binary = false;
    switch(it.charCodeAt(1)){
      case 66 : case 98  : binary = true;
      case 79 : case 111 : return parseInt(it.slice(2), binary ? 2 : 8);
    }
  } return +it;
};
if(!($Number('0o1') && $Number('0b1'))){
  $Number = function Number(it){
    var that = this;
    return that instanceof $Number
      // check on 1..constructor(foo) case
      && (BROKEN_COF ? fails(function(){ proto.valueOf.call(that); }) : cof(that) != NUMBER)
        ? new Base(toNumber(it)) : toNumber(it);
  };
  $.each.call(require('./$.support-desc') ? $.getNames(Base) : (
      // ES3:
      'MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,' +
      // ES6 (in case, if modules with ES6 Number statics required before):
      'EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,' +
      'MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger'
    ).split(','), function(key){
      if(has(Base, key) && !has($Number, key)){
        $.setDesc($Number, key, $.getDesc(Base, key));
      }
    }
  );
  $Number.prototype = proto;
  proto.constructor = $Number;
  require('./$.redef')(global, NUMBER, $Number);
}
},{"./$":41,"./$.cof":9,"./$.fails":21,"./$.global":26,"./$.has":27,"./$.is-object":34,"./$.redef":53,"./$.support-desc":66}],108:[function(require,module,exports){
// 20.1.2.1 Number.EPSILON
var $def = require('./$.def');

$def($def.S, 'Number', {EPSILON: Math.pow(2, -52)});
},{"./$.def":16}],109:[function(require,module,exports){
// 20.1.2.2 Number.isFinite(number)
var $def      = require('./$.def')
  , _isFinite = require('./$.global').isFinite;

$def($def.S, 'Number', {
  isFinite: function isFinite(it){
    return typeof it == 'number' && _isFinite(it);
  }
});
},{"./$.def":16,"./$.global":26}],110:[function(require,module,exports){
// 20.1.2.3 Number.isInteger(number)
var $def = require('./$.def');

$def($def.S, 'Number', {isInteger: require('./$.is-integer')});
},{"./$.def":16,"./$.is-integer":33}],111:[function(require,module,exports){
// 20.1.2.4 Number.isNaN(number)
var $def = require('./$.def');

$def($def.S, 'Number', {
  isNaN: function isNaN(number){
    return number != number;
  }
});
},{"./$.def":16}],112:[function(require,module,exports){
// 20.1.2.5 Number.isSafeInteger(number)
var $def      = require('./$.def')
  , isInteger = require('./$.is-integer')
  , abs       = Math.abs;

$def($def.S, 'Number', {
  isSafeInteger: function isSafeInteger(number){
    return isInteger(number) && abs(number) <= 0x1fffffffffffff;
  }
});
},{"./$.def":16,"./$.is-integer":33}],113:[function(require,module,exports){
// 20.1.2.6 Number.MAX_SAFE_INTEGER
var $def = require('./$.def');

$def($def.S, 'Number', {MAX_SAFE_INTEGER: 0x1fffffffffffff});
},{"./$.def":16}],114:[function(require,module,exports){
// 20.1.2.10 Number.MIN_SAFE_INTEGER
var $def = require('./$.def');

$def($def.S, 'Number', {MIN_SAFE_INTEGER: -0x1fffffffffffff});
},{"./$.def":16}],115:[function(require,module,exports){
// 20.1.2.12 Number.parseFloat(string)
var $def = require('./$.def');

$def($def.S, 'Number', {parseFloat: parseFloat});
},{"./$.def":16}],116:[function(require,module,exports){
// 20.1.2.13 Number.parseInt(string, radix)
var $def = require('./$.def');

$def($def.S, 'Number', {parseInt: parseInt});
},{"./$.def":16}],117:[function(require,module,exports){
// 19.1.3.1 Object.assign(target, source)
var $def = require('./$.def');

$def($def.S + $def.F, 'Object', {assign: require('./$.assign')});
},{"./$.assign":7,"./$.def":16}],118:[function(require,module,exports){
// 19.1.2.5 Object.freeze(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('freeze', function($freeze){
  return function freeze(it){
    return $freeze && isObject(it) ? $freeze(it) : it;
  };
});
},{"./$.is-object":34,"./$.object-sap":47}],119:[function(require,module,exports){
// 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
var toIObject = require('./$.to-iobject');

require('./$.object-sap')('getOwnPropertyDescriptor', function($getOwnPropertyDescriptor){
  return function getOwnPropertyDescriptor(it, key){
    return $getOwnPropertyDescriptor(toIObject(it), key);
  };
});
},{"./$.object-sap":47,"./$.to-iobject":71}],120:[function(require,module,exports){
// 19.1.2.7 Object.getOwnPropertyNames(O)
require('./$.object-sap')('getOwnPropertyNames', function(){
  return require('./$.get-names').get;
});
},{"./$.get-names":25,"./$.object-sap":47}],121:[function(require,module,exports){
// 19.1.2.9 Object.getPrototypeOf(O)
var toObject = require('./$.to-object');

require('./$.object-sap')('getPrototypeOf', function($getPrototypeOf){
  return function getPrototypeOf(it){
    return $getPrototypeOf(toObject(it));
  };
});
},{"./$.object-sap":47,"./$.to-object":73}],122:[function(require,module,exports){
// 19.1.2.11 Object.isExtensible(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('isExtensible', function($isExtensible){
  return function isExtensible(it){
    return isObject(it) ? $isExtensible ? $isExtensible(it) : true : false;
  };
});
},{"./$.is-object":34,"./$.object-sap":47}],123:[function(require,module,exports){
// 19.1.2.12 Object.isFrozen(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('isFrozen', function($isFrozen){
  return function isFrozen(it){
    return isObject(it) ? $isFrozen ? $isFrozen(it) : false : true;
  };
});
},{"./$.is-object":34,"./$.object-sap":47}],124:[function(require,module,exports){
// 19.1.2.13 Object.isSealed(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('isSealed', function($isSealed){
  return function isSealed(it){
    return isObject(it) ? $isSealed ? $isSealed(it) : false : true;
  };
});
},{"./$.is-object":34,"./$.object-sap":47}],125:[function(require,module,exports){
// 19.1.3.10 Object.is(value1, value2)
var $def = require('./$.def');
$def($def.S, 'Object', {
  is: require('./$.same')
});
},{"./$.def":16,"./$.same":55}],126:[function(require,module,exports){
// 19.1.2.14 Object.keys(O)
var toObject = require('./$.to-object');

require('./$.object-sap')('keys', function($keys){
  return function keys(it){
    return $keys(toObject(it));
  };
});
},{"./$.object-sap":47,"./$.to-object":73}],127:[function(require,module,exports){
// 19.1.2.15 Object.preventExtensions(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('preventExtensions', function($preventExtensions){
  return function preventExtensions(it){
    return $preventExtensions && isObject(it) ? $preventExtensions(it) : it;
  };
});
},{"./$.is-object":34,"./$.object-sap":47}],128:[function(require,module,exports){
// 19.1.2.17 Object.seal(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('seal', function($seal){
  return function seal(it){
    return $seal && isObject(it) ? $seal(it) : it;
  };
});
},{"./$.is-object":34,"./$.object-sap":47}],129:[function(require,module,exports){
// 19.1.3.19 Object.setPrototypeOf(O, proto)
var $def = require('./$.def');
$def($def.S, 'Object', {setPrototypeOf: require('./$.set-proto').set});
},{"./$.def":16,"./$.set-proto":56}],130:[function(require,module,exports){
'use strict';
// 19.1.3.6 Object.prototype.toString()
var classof = require('./$.classof')
  , test    = {};
test[require('./$.wks')('toStringTag')] = 'z';
if(test + '' != '[object z]'){
  require('./$.redef')(Object.prototype, 'toString', function toString(){
    return '[object ' + classof(this) + ']';
  }, true);
}
},{"./$.classof":8,"./$.redef":53,"./$.wks":76}],131:[function(require,module,exports){
'use strict';
var $          = require('./$')
  , LIBRARY    = require('./$.library')
  , global     = require('./$.global')
  , ctx        = require('./$.ctx')
  , classof    = require('./$.classof')
  , $def       = require('./$.def')
  , isObject   = require('./$.is-object')
  , anObject   = require('./$.an-object')
  , aFunction  = require('./$.a-function')
  , strictNew  = require('./$.strict-new')
  , forOf      = require('./$.for-of')
  , setProto   = require('./$.set-proto').set
  , same       = require('./$.same')
  , species    = require('./$.species')
  , SPECIES    = require('./$.wks')('species')
  , RECORD     = require('./$.uid')('record')
  , asap       = require('./$.microtask')
  , PROMISE    = 'Promise'
  , process    = global.process
  , isNode     = classof(process) == 'process'
  , P          = global[PROMISE]
  , Wrapper;

var testResolve = function(sub){
  var test = new P(function(){});
  if(sub)test.constructor = Object;
  return P.resolve(test) === test;
};

var useNative = function(){
  var works = false;
  function P2(x){
    var self = new P(x);
    setProto(self, P2.prototype);
    return self;
  }
  try {
    works = P && P.resolve && testResolve();
    setProto(P2, P);
    P2.prototype = $.create(P.prototype, {constructor: {value: P2}});
    // actual Firefox has broken subclass support, test that
    if(!(P2.resolve(5).then(function(){}) instanceof P2)){
      works = false;
    }
    // actual V8 bug, https://code.google.com/p/v8/issues/detail?id=4162
    if(works && require('./$.support-desc')){
      var thenableThenGotten = false;
      P.resolve($.setDesc({}, 'then', {
        get: function(){ thenableThenGotten = true; }
      }));
      works = thenableThenGotten;
    }
  } catch(e){ works = false; }
  return works;
}();

// helpers
var isPromise = function(it){
  return isObject(it) && (useNative ? classof(it) == 'Promise' : RECORD in it);
};
var sameConstructor = function(a, b){
  // library wrapper special case
  if(LIBRARY && a === P && b === Wrapper)return true;
  return same(a, b);
};
var getConstructor = function(C){
  var S = anObject(C)[SPECIES];
  return S != undefined ? S : C;
};
var isThenable = function(it){
  var then;
  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;
};
var notify = function(record, isReject){
  if(record.n)return;
  record.n = true;
  var chain = record.c;
  asap(function(){
    var value = record.v
      , ok    = record.s == 1
      , i     = 0;
    var run = function(react){
      var cb = ok ? react.ok : react.fail
        , ret, then;
      try {
        if(cb){
          if(!ok)record.h = true;
          ret = cb === true ? value : cb(value);
          if(ret === react.P){
            react.rej(TypeError('Promise-chain cycle'));
          } else if(then = isThenable(ret)){
            then.call(ret, react.res, react.rej);
          } else react.res(ret);
        } else react.rej(value);
      } catch(err){
        react.rej(err);
      }
    };
    while(chain.length > i)run(chain[i++]); // variable length - can't use forEach
    chain.length = 0;
    record.n = false;
    if(isReject)setTimeout(function(){
      if(isUnhandled(record.p)){
        if(isNode){
          process.emit('unhandledRejection', value, record.p);
        } else if(global.console && console.error){
          console.error('Unhandled promise rejection', value);
        }
      } record.a = undefined;
    }, 1);
  });
};
var isUnhandled = function(promise){
  var record = promise[RECORD]
    , chain  = record.a || record.c
    , i      = 0
    , react;
  if(record.h)return false;
  while(chain.length > i){
    react = chain[i++];
    if(react.fail || !isUnhandled(react.P))return false;
  } return true;
};
var $reject = function(value){
  var record = this;
  if(record.d)return;
  record.d = true;
  record = record.r || record; // unwrap
  record.v = value;
  record.s = 2;
  record.a = record.c.slice();
  notify(record, true);
};
var $resolve = function(value){
  var record = this
    , then;
  if(record.d)return;
  record.d = true;
  record = record.r || record; // unwrap
  try {
    if(then = isThenable(value)){
      asap(function(){
        var wrapper = {r: record, d: false}; // wrap
        try {
          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));
        } catch(e){
          $reject.call(wrapper, e);
        }
      });
    } else {
      record.v = value;
      record.s = 1;
      notify(record, false);
    }
  } catch(e){
    $reject.call({r: record, d: false}, e); // wrap
  }
};

// constructor polyfill
if(!useNative){
  // 25.4.3.1 Promise(executor)
  P = function Promise(executor){
    aFunction(executor);
    var record = {
      p: strictNew(this, P, PROMISE),         // <- promise
      c: [],                                  // <- awaiting reactions
      a: undefined,                           // <- checked in isUnhandled reactions
      s: 0,                                   // <- state
      d: false,                               // <- done
      v: undefined,                           // <- value
      h: false,                               // <- handled rejection
      n: false                                // <- notify
    };
    this[RECORD] = record;
    try {
      executor(ctx($resolve, record, 1), ctx($reject, record, 1));
    } catch(err){
      $reject.call(record, err);
    }
  };
  require('./$.mix')(P.prototype, {
    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)
    then: function then(onFulfilled, onRejected){
      var S = anObject(anObject(this).constructor)[SPECIES];
      var react = {
        ok:   typeof onFulfilled == 'function' ? onFulfilled : true,
        fail: typeof onRejected == 'function'  ? onRejected  : false
      };
      var promise = react.P = new (S != undefined ? S : P)(function(res, rej){
        react.res = aFunction(res);
        react.rej = aFunction(rej);
      });
      var record = this[RECORD];
      record.c.push(react);
      if(record.a)record.a.push(react);
      if(record.s)notify(record, false);
      return promise;
    },
    // 25.4.5.1 Promise.prototype.catch(onRejected)
    'catch': function(onRejected){
      return this.then(undefined, onRejected);
    }
  });
}

// export
$def($def.G + $def.W + $def.F * !useNative, {Promise: P});
require('./$.tag')(P, PROMISE);
species(P);
species(Wrapper = require('./$.core')[PROMISE]);

// statics
$def($def.S + $def.F * !useNative, PROMISE, {
  // 25.4.4.5 Promise.reject(r)
  reject: function reject(r){
    return new this(function(res, rej){ rej(r); });
  }
});
$def($def.S + $def.F * (!useNative || testResolve(true)), PROMISE, {
  // 25.4.4.6 Promise.resolve(x)
  resolve: function resolve(x){
    return isPromise(x) && sameConstructor(x.constructor, this)
      ? x : new this(function(res){ res(x); });
  }
});
$def($def.S + $def.F * !(useNative && require('./$.iter-detect')(function(iter){
  P.all(iter)['catch'](function(){});
})), PROMISE, {
  // 25.4.4.1 Promise.all(iterable)
  all: function all(iterable){
    var C      = getConstructor(this)
      , values = [];
    return new C(function(res, rej){
      forOf(iterable, false, values.push, values);
      var remaining = values.length
        , results   = Array(remaining);
      if(remaining)$.each.call(values, function(promise, index){
        C.resolve(promise).then(function(value){
          results[index] = value;
          --remaining || res(results);
        }, rej);
      });
      else res(results);
    });
  },
  // 25.4.4.4 Promise.race(iterable)
  race: function race(iterable){
    var C = getConstructor(this);
    return new C(function(res, rej){
      forOf(iterable, false, function(promise){
        C.resolve(promise).then(res, rej);
      });
    });
  }
});
},{"./$":41,"./$.a-function":3,"./$.an-object":4,"./$.classof":8,"./$.core":14,"./$.ctx":15,"./$.def":16,"./$.for-of":24,"./$.global":26,"./$.is-object":34,"./$.iter-detect":38,"./$.library":43,"./$.microtask":45,"./$.mix":46,"./$.same":55,"./$.set-proto":56,"./$.species":59,"./$.strict-new":60,"./$.support-desc":66,"./$.tag":67,"./$.uid":74,"./$.wks":76}],132:[function(require,module,exports){
// 26.1.1 Reflect.apply(target, thisArgument, argumentsList)
var $def   = require('./$.def')
  , _apply = Function.apply;

$def($def.S, 'Reflect', {
  apply: function apply(target, thisArgument, argumentsList){
    return _apply.call(target, thisArgument, argumentsList);
  }
});
},{"./$.def":16}],133:[function(require,module,exports){
// 26.1.2 Reflect.construct(target, argumentsList [, newTarget])
var $         = require('./$')
  , $def      = require('./$.def')
  , aFunction = require('./$.a-function')
  , anObject  = require('./$.an-object')
  , isObject  = require('./$.is-object')
  , bind      = Function.bind || require('./$.core').Function.prototype.bind;

// MS Edge supports only 2 arguments
// FF Nightly sets third argument as `new.target`, but does not create `this` from it
$def($def.S + $def.F * require('./$.fails')(function(){
  function F(){}
  return !(Reflect.construct(function(){}, [], F) instanceof F);
}), 'Reflect', {
  construct: function construct(Target, args /*, newTarget*/){
    aFunction(Target);
    var newTarget = arguments.length < 3 ? Target : aFunction(arguments[2]);
    if(Target == newTarget){
      // w/o altered newTarget, optimization for 0-4 arguments
      if(args != undefined)switch(anObject(args).length){
        case 0: return new Target;
        case 1: return new Target(args[0]);
        case 2: return new Target(args[0], args[1]);
        case 3: return new Target(args[0], args[1], args[2]);
        case 4: return new Target(args[0], args[1], args[2], args[3]);
      }
      // w/o altered newTarget, lot of arguments case
      var $args = [null];
      $args.push.apply($args, args);
      return new (bind.apply(Target, $args));
    }
    // with altered newTarget, not support built-in constructors
    var proto    = newTarget.prototype
      , instance = $.create(isObject(proto) ? proto : Object.prototype)
      , result   = Function.apply.call(Target, instance, args);
    return isObject(result) ? result : instance;
  }
});
},{"./$":41,"./$.a-function":3,"./$.an-object":4,"./$.core":14,"./$.def":16,"./$.fails":21,"./$.is-object":34}],134:[function(require,module,exports){
// 26.1.3 Reflect.defineProperty(target, propertyKey, attributes)
var $        = require('./$')
  , $def     = require('./$.def')
  , anObject = require('./$.an-object');

// MS Edge has broken Reflect.defineProperty - throwing instead of returning false
$def($def.S + $def.F * require('./$.fails')(function(){
  Reflect.defineProperty($.setDesc({}, 1, {value: 1}), 1, {value: 2});
}), 'Reflect', {
  defineProperty: function defineProperty(target, propertyKey, attributes){
    anObject(target);
    try {
      $.setDesc(target, propertyKey, attributes);
      return true;
    } catch(e){
      return false;
    }
  }
});
},{"./$":41,"./$.an-object":4,"./$.def":16,"./$.fails":21}],135:[function(require,module,exports){
// 26.1.4 Reflect.deleteProperty(target, propertyKey)
var $def     = require('./$.def')
  , getDesc  = require('./$').getDesc
  , anObject = require('./$.an-object');

$def($def.S, 'Reflect', {
  deleteProperty: function deleteProperty(target, propertyKey){
    var desc = getDesc(anObject(target), propertyKey);
    return desc && !desc.configurable ? false : delete target[propertyKey];
  }
});
},{"./$":41,"./$.an-object":4,"./$.def":16}],136:[function(require,module,exports){
'use strict';
// 26.1.5 Reflect.enumerate(target)
var $def     = require('./$.def')
  , anObject = require('./$.an-object');
var Enumerate = function(iterated){
  this._t = anObject(iterated); // target
  this._i = 0;                  // next index
  var keys = this._k = []       // keys
    , key;
  for(key in iterated)keys.push(key);
};
require('./$.iter-create')(Enumerate, 'Object', function(){
  var that = this
    , keys = that._k
    , key;
  do {
    if(that._i >= keys.length)return {value: undefined, done: true};
  } while(!((key = keys[that._i++]) in that._t));
  return {value: key, done: false};
});

$def($def.S, 'Reflect', {
  enumerate: function enumerate(target){
    return new Enumerate(target);
  }
});
},{"./$.an-object":4,"./$.def":16,"./$.iter-create":36}],137:[function(require,module,exports){
// 26.1.7 Reflect.getOwnPropertyDescriptor(target, propertyKey)
var $        = require('./$')
  , $def     = require('./$.def')
  , anObject = require('./$.an-object');

$def($def.S, 'Reflect', {
  getOwnPropertyDescriptor: function getOwnPropertyDescriptor(target, propertyKey){
    return $.getDesc(anObject(target), propertyKey);
  }
});
},{"./$":41,"./$.an-object":4,"./$.def":16}],138:[function(require,module,exports){
// 26.1.8 Reflect.getPrototypeOf(target)
var $def     = require('./$.def')
  , getProto = require('./$').getProto
  , anObject = require('./$.an-object');

$def($def.S, 'Reflect', {
  getPrototypeOf: function getPrototypeOf(target){
    return getProto(anObject(target));
  }
});
},{"./$":41,"./$.an-object":4,"./$.def":16}],139:[function(require,module,exports){
// 26.1.6 Reflect.get(target, propertyKey [, receiver])
var $        = require('./$')
  , has      = require('./$.has')
  , $def     = require('./$.def')
  , isObject = require('./$.is-object')
  , anObject = require('./$.an-object');

function get(target, propertyKey/*, receiver*/){
  var receiver = arguments.length < 3 ? target : arguments[2]
    , desc, proto;
  if(anObject(target) === receiver)return target[propertyKey];
  if(desc = $.getDesc(target, propertyKey))return has(desc, 'value')
    ? desc.value
    : desc.get !== undefined
      ? desc.get.call(receiver)
      : undefined;
  if(isObject(proto = $.getProto(target)))return get(proto, propertyKey, receiver);
}

$def($def.S, 'Reflect', {get: get});
},{"./$":41,"./$.an-object":4,"./$.def":16,"./$.has":27,"./$.is-object":34}],140:[function(require,module,exports){
// 26.1.9 Reflect.has(target, propertyKey)
var $def = require('./$.def');

$def($def.S, 'Reflect', {
  has: function has(target, propertyKey){
    return propertyKey in target;
  }
});
},{"./$.def":16}],141:[function(require,module,exports){
// 26.1.10 Reflect.isExtensible(target)
var $def          = require('./$.def')
  , anObject      = require('./$.an-object')
  , $isExtensible = Object.isExtensible;

$def($def.S, 'Reflect', {
  isExtensible: function isExtensible(target){
    anObject(target);
    return $isExtensible ? $isExtensible(target) : true;
  }
});
},{"./$.an-object":4,"./$.def":16}],142:[function(require,module,exports){
// 26.1.11 Reflect.ownKeys(target)
var $def = require('./$.def');

$def($def.S, 'Reflect', {ownKeys: require('./$.own-keys')});
},{"./$.def":16,"./$.own-keys":49}],143:[function(require,module,exports){
// 26.1.12 Reflect.preventExtensions(target)
var $def               = require('./$.def')
  , anObject           = require('./$.an-object')
  , $preventExtensions = Object.preventExtensions;

$def($def.S, 'Reflect', {
  preventExtensions: function preventExtensions(target){
    anObject(target);
    try {
      if($preventExtensions)$preventExtensions(target);
      return true;
    } catch(e){
      return false;
    }
  }
});
},{"./$.an-object":4,"./$.def":16}],144:[function(require,module,exports){
// 26.1.14 Reflect.setPrototypeOf(target, proto)
var $def     = require('./$.def')
  , setProto = require('./$.set-proto');

if(setProto)$def($def.S, 'Reflect', {
  setPrototypeOf: function setPrototypeOf(target, proto){
    setProto.check(target, proto);
    try {
      setProto.set(target, proto);
      return true;
    } catch(e){
      return false;
    }
  }
});
},{"./$.def":16,"./$.set-proto":56}],145:[function(require,module,exports){
// 26.1.13 Reflect.set(target, propertyKey, V [, receiver])
var $          = require('./$')
  , has        = require('./$.has')
  , $def       = require('./$.def')
  , createDesc = require('./$.property-desc')
  , anObject   = require('./$.an-object')
  , isObject   = require('./$.is-object');

function set(target, propertyKey, V/*, receiver*/){
  var receiver = arguments.length < 4 ? target : arguments[3]
    , ownDesc  = $.getDesc(anObject(target), propertyKey)
    , existingDescriptor, proto;
  if(!ownDesc){
    if(isObject(proto = $.getProto(target))){
      return set(proto, propertyKey, V, receiver);
    }
    ownDesc = createDesc(0);
  }
  if(has(ownDesc, 'value')){
    if(ownDesc.writable === false || !isObject(receiver))return false;
    existingDescriptor = $.getDesc(receiver, propertyKey) || createDesc(0);
    existingDescriptor.value = V;
    $.setDesc(receiver, propertyKey, existingDescriptor);
    return true;
  }
  return ownDesc.set === undefined ? false : (ownDesc.set.call(receiver, V), true);
}

$def($def.S, 'Reflect', {set: set});
},{"./$":41,"./$.an-object":4,"./$.def":16,"./$.has":27,"./$.is-object":34,"./$.property-desc":52}],146:[function(require,module,exports){
var $       = require('./$')
  , global  = require('./$.global')
  , cof     = require('./$.cof')
  , $flags  = require('./$.flags')
  , $RegExp = global.RegExp
  , Base    = $RegExp
  , proto   = $RegExp.prototype
  , re      = /a/g
  // "new" creates a new object
  , CORRECT_NEW = new $RegExp(re) !== re
  // RegExp allows a regex with flags as the pattern
  , ALLOWS_RE_WITH_FLAGS = function(){
    try {
      return $RegExp(re, 'i') == '/a/i';
    } catch(e){ /* empty */ }
  }();

if(require('./$.support-desc')){
  if(!CORRECT_NEW || !ALLOWS_RE_WITH_FLAGS){
    $RegExp = function RegExp(pattern, flags){
      var patternIsRegExp  = cof(pattern) == 'RegExp'
        , flagsIsUndefined = flags === undefined;
      if(!(this instanceof $RegExp) && patternIsRegExp && flagsIsUndefined)return pattern;
      return CORRECT_NEW
        ? new Base(patternIsRegExp && !flagsIsUndefined ? pattern.source : pattern, flags)
        : new Base(patternIsRegExp ? pattern.source : pattern
          , patternIsRegExp && flagsIsUndefined ? $flags.call(pattern) : flags);
    };
    $.each.call($.getNames(Base), function(key){
      key in $RegExp || $.setDesc($RegExp, key, {
        configurable: true,
        get: function(){ return Base[key]; },
        set: function(it){ Base[key] = it; }
      });
    });
    proto.constructor = $RegExp;
    $RegExp.prototype = proto;
    require('./$.redef')(global, 'RegExp', $RegExp);
  }
}

require('./$.species')($RegExp);
},{"./$":41,"./$.cof":9,"./$.flags":23,"./$.global":26,"./$.redef":53,"./$.species":59,"./$.support-desc":66}],147:[function(require,module,exports){
// 21.2.5.3 get RegExp.prototype.flags()
var $ = require('./$');
if(require('./$.support-desc') && /./g.flags != 'g')$.setDesc(RegExp.prototype, 'flags', {
  configurable: true,
  get: require('./$.flags')
});
},{"./$":41,"./$.flags":23,"./$.support-desc":66}],148:[function(require,module,exports){
// @@match logic
require('./$.fix-re-wks')('match', 1, function(defined, MATCH){
  // 21.1.3.11 String.prototype.match(regexp)
  return function match(regexp){
    'use strict';
    var O  = defined(this)
      , fn = regexp == undefined ? undefined : regexp[MATCH];
    return fn !== undefined ? fn.call(regexp, O) : new RegExp(regexp)[MATCH](String(O));
  };
});
},{"./$.fix-re-wks":22}],149:[function(require,module,exports){
// @@replace logic
require('./$.fix-re-wks')('replace', 2, function(defined, REPLACE, $replace){
  // 21.1.3.14 String.prototype.replace(searchValue, replaceValue)
  return function replace(searchValue, replaceValue){
    'use strict';
    var O  = defined(this)
      , fn = searchValue == undefined ? undefined : searchValue[REPLACE];
    return fn !== undefined
      ? fn.call(searchValue, O, replaceValue)
      : $replace.call(String(O), searchValue, replaceValue);
  };
});
},{"./$.fix-re-wks":22}],150:[function(require,module,exports){
// @@search logic
require('./$.fix-re-wks')('search', 1, function(defined, SEARCH){
  // 21.1.3.15 String.prototype.search(regexp)
  return function search(regexp){
    'use strict';
    var O  = defined(this)
      , fn = regexp == undefined ? undefined : regexp[SEARCH];
    return fn !== undefined ? fn.call(regexp, O) : new RegExp(regexp)[SEARCH](String(O));
  };
});
},{"./$.fix-re-wks":22}],151:[function(require,module,exports){
// @@split logic
require('./$.fix-re-wks')('split', 2, function(defined, SPLIT, $split){
  // 21.1.3.17 String.prototype.split(separator, limit)
  return function split(separator, limit){
    'use strict';
    var O  = defined(this)
      , fn = separator == undefined ? undefined : separator[SPLIT];
    return fn !== undefined
      ? fn.call(separator, O, limit)
      : $split.call(String(O), separator, limit);
  };
});
},{"./$.fix-re-wks":22}],152:[function(require,module,exports){
'use strict';
var strong = require('./$.collection-strong');

// 23.2 Set Objects
require('./$.collection')('Set', function(get){
  return function Set(){ return get(this, arguments[0]); };
}, {
  // 23.2.3.1 Set.prototype.add(value)
  add: function add(value){
    return strong.def(this, value = value === 0 ? 0 : value, value);
  }
}, strong);
},{"./$.collection":13,"./$.collection-strong":10}],153:[function(require,module,exports){
'use strict';
var $def = require('./$.def')
  , $at  = require('./$.string-at')(false);
$def($def.P, 'String', {
  // 21.1.3.3 String.prototype.codePointAt(pos)
  codePointAt: function codePointAt(pos){
    return $at(this, pos);
  }
});
},{"./$.def":16,"./$.string-at":61}],154:[function(require,module,exports){
'use strict';
var $def     = require('./$.def')
  , toLength = require('./$.to-length')
  , context  = require('./$.string-context');

// should throw error on regex
$def($def.P + $def.F * !require('./$.fails')(function(){ 'q'.endsWith(/./); }), 'String', {
  // 21.1.3.6 String.prototype.endsWith(searchString [, endPosition])
  endsWith: function endsWith(searchString /*, endPosition = @length */){
    var that = context(this, searchString, 'endsWith')
      , endPosition = arguments[1]
      , len    = toLength(that.length)
      , end    = endPosition === undefined ? len : Math.min(toLength(endPosition), len)
      , search = String(searchString);
    return that.slice(end - search.length, end) === search;
  }
});
},{"./$.def":16,"./$.fails":21,"./$.string-context":62,"./$.to-length":72}],155:[function(require,module,exports){
var $def    = require('./$.def')
  , toIndex = require('./$.to-index')
  , fromCharCode = String.fromCharCode
  , $fromCodePoint = String.fromCodePoint;

// length should be 1, old FF problem
$def($def.S + $def.F * (!!$fromCodePoint && $fromCodePoint.length != 1), 'String', {
  // 21.1.2.2 String.fromCodePoint(...codePoints)
  fromCodePoint: function fromCodePoint(x){ // eslint-disable-line no-unused-vars
    var res = []
      , len = arguments.length
      , i   = 0
      , code;
    while(len > i){
      code = +arguments[i++];
      if(toIndex(code, 0x10ffff) !== code)throw RangeError(code + ' is not a valid code point');
      res.push(code < 0x10000
        ? fromCharCode(code)
        : fromCharCode(((code -= 0x10000) >> 10) + 0xd800, code % 0x400 + 0xdc00)
      );
    } return res.join('');
  }
});
},{"./$.def":16,"./$.to-index":69}],156:[function(require,module,exports){
'use strict';
var $def    = require('./$.def')
  , context = require('./$.string-context');

$def($def.P, 'String', {
  // 21.1.3.7 String.prototype.includes(searchString, position = 0)
  includes: function includes(searchString /*, position = 0 */){
    return !!~context(this, searchString, 'includes').indexOf(searchString, arguments[1]);
  }
});
},{"./$.def":16,"./$.string-context":62}],157:[function(require,module,exports){
'use strict';
var $at  = require('./$.string-at')(true);

// 21.1.3.27 String.prototype[@@iterator]()
require('./$.iter-define')(String, 'String', function(iterated){
  this._t = String(iterated); // target
  this._i = 0;                // next index
// 21.1.5.2.1 %StringIteratorPrototype%.next()
}, function(){
  var O     = this._t
    , index = this._i
    , point;
  if(index >= O.length)return {value: undefined, done: true};
  point = $at(O, index);
  this._i += point.length;
  return {value: point, done: false};
});
},{"./$.iter-define":37,"./$.string-at":61}],158:[function(require,module,exports){
var $def      = require('./$.def')
  , toIObject = require('./$.to-iobject')
  , toLength  = require('./$.to-length');

$def($def.S, 'String', {
  // 21.1.2.4 String.raw(callSite, ...substitutions)
  raw: function raw(callSite){
    var tpl = toIObject(callSite.raw)
      , len = toLength(tpl.length)
      , sln = arguments.length
      , res = []
      , i   = 0;
    while(len > i){
      res.push(String(tpl[i++]));
      if(i < sln)res.push(String(arguments[i]));
    } return res.join('');
  }
});
},{"./$.def":16,"./$.to-iobject":71,"./$.to-length":72}],159:[function(require,module,exports){
var $def = require('./$.def');

$def($def.P, 'String', {
  // 21.1.3.13 String.prototype.repeat(count)
  repeat: require('./$.string-repeat')
});
},{"./$.def":16,"./$.string-repeat":64}],160:[function(require,module,exports){
'use strict';
var $def     = require('./$.def')
  , toLength = require('./$.to-length')
  , context  = require('./$.string-context');

// should throw error on regex
$def($def.P + $def.F * !require('./$.fails')(function(){ 'q'.startsWith(/./); }), 'String', {
  // 21.1.3.18 String.prototype.startsWith(searchString [, position ])
  startsWith: function startsWith(searchString /*, position = 0 */){
    var that   = context(this, searchString, 'startsWith')
      , index  = toLength(Math.min(arguments[1], that.length))
      , search = String(searchString);
    return that.slice(index, index + search.length) === search;
  }
});
},{"./$.def":16,"./$.fails":21,"./$.string-context":62,"./$.to-length":72}],161:[function(require,module,exports){
'use strict';
// 21.1.3.25 String.prototype.trim()
require('./$.string-trim')('trim', function($trim){
  return function trim(){
    return $trim(this, 3);
  };
});
},{"./$.string-trim":65}],162:[function(require,module,exports){
'use strict';
// ECMAScript 6 symbols shim
var $              = require('./$')
  , global         = require('./$.global')
  , has            = require('./$.has')
  , SUPPORT_DESC   = require('./$.support-desc')
  , $def           = require('./$.def')
  , $redef         = require('./$.redef')
  , shared         = require('./$.shared')
  , setTag         = require('./$.tag')
  , uid            = require('./$.uid')
  , wks            = require('./$.wks')
  , keyOf          = require('./$.keyof')
  , $names         = require('./$.get-names')
  , enumKeys       = require('./$.enum-keys')
  , isObject       = require('./$.is-object')
  , anObject       = require('./$.an-object')
  , toIObject      = require('./$.to-iobject')
  , createDesc     = require('./$.property-desc')
  , getDesc        = $.getDesc
  , setDesc        = $.setDesc
  , _create        = $.create
  , getNames       = $names.get
  , $Symbol        = global.Symbol
  , setter         = false
  , HIDDEN         = wks('_hidden')
  , isEnum         = $.isEnum
  , SymbolRegistry = shared('symbol-registry')
  , AllSymbols     = shared('symbols')
  , useNative      = typeof $Symbol == 'function'
  , ObjectProto    = Object.prototype;

var setSymbolDesc = SUPPORT_DESC ? function(){ // fallback for old Android
  try {
    return _create(setDesc({}, HIDDEN, {
      get: function(){
        return setDesc(this, HIDDEN, {value: false})[HIDDEN];
      }
    }))[HIDDEN] || setDesc;
  } catch(e){
    return function(it, key, D){
      var protoDesc = getDesc(ObjectProto, key);
      if(protoDesc)delete ObjectProto[key];
      setDesc(it, key, D);
      if(protoDesc && it !== ObjectProto)setDesc(ObjectProto, key, protoDesc);
    };
  }
}() : setDesc;

var wrap = function(tag){
  var sym = AllSymbols[tag] = _create($Symbol.prototype);
  sym._k = tag;
  SUPPORT_DESC && setter && setSymbolDesc(ObjectProto, tag, {
    configurable: true,
    set: function(value){
      if(has(this, HIDDEN) && has(this[HIDDEN], tag))this[HIDDEN][tag] = false;
      setSymbolDesc(this, tag, createDesc(1, value));
    }
  });
  return sym;
};

var $defineProperty = function defineProperty(it, key, D){
  if(D && has(AllSymbols, key)){
    if(!D.enumerable){
      if(!has(it, HIDDEN))setDesc(it, HIDDEN, createDesc(1, {}));
      it[HIDDEN][key] = true;
    } else {
      if(has(it, HIDDEN) && it[HIDDEN][key])it[HIDDEN][key] = false;
      D = _create(D, {enumerable: createDesc(0, false)});
    } return setSymbolDesc(it, key, D);
  } return setDesc(it, key, D);
};
var $defineProperties = function defineProperties(it, P){
  anObject(it);
  var keys = enumKeys(P = toIObject(P))
    , i    = 0
    , l = keys.length
    , key;
  while(l > i)$defineProperty(it, key = keys[i++], P[key]);
  return it;
};
var $create = function create(it, P){
  return P === undefined ? _create(it) : $defineProperties(_create(it), P);
};
var $propertyIsEnumerable = function propertyIsEnumerable(key){
  var E = isEnum.call(this, key);
  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key]
    ? E : true;
};
var $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key){
  var D = getDesc(it = toIObject(it), key);
  if(D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key]))D.enumerable = true;
  return D;
};
var $getOwnPropertyNames = function getOwnPropertyNames(it){
  var names  = getNames(toIObject(it))
    , result = []
    , i      = 0
    , key;
  while(names.length > i)if(!has(AllSymbols, key = names[i++]) && key != HIDDEN)result.push(key);
  return result;
};
var $getOwnPropertySymbols = function getOwnPropertySymbols(it){
  var names  = getNames(toIObject(it))
    , result = []
    , i      = 0
    , key;
  while(names.length > i)if(has(AllSymbols, key = names[i++]))result.push(AllSymbols[key]);
  return result;
};

// 19.4.1.1 Symbol([description])
if(!useNative){
  $Symbol = function Symbol(){
    if(this instanceof $Symbol)throw TypeError('Symbol is not a constructor');
    return wrap(uid(arguments[0]));
  };
  $redef($Symbol.prototype, 'toString', function toString(){
    return this._k;
  });

  $.create     = $create;
  $.isEnum     = $propertyIsEnumerable;
  $.getDesc    = $getOwnPropertyDescriptor;
  $.setDesc    = $defineProperty;
  $.setDescs   = $defineProperties;
  $.getNames   = $names.get = $getOwnPropertyNames;
  $.getSymbols = $getOwnPropertySymbols;

  if(SUPPORT_DESC && !require('./$.library')){
    $redef(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);
  }
}

// MS Edge converts symbol values to JSON as {}
// WebKit converts symbol values in objects to JSON as null
if(!useNative || require('./$.fails')(function(){
  return JSON.stringify([{a: $Symbol()}, [$Symbol()]]) != '[{},[null]]';
}))$redef($Symbol.prototype, 'toJSON', function toJSON(){
  if(useNative && isObject(this))return this;
});

var symbolStatics = {
  // 19.4.2.1 Symbol.for(key)
  'for': function(key){
    return has(SymbolRegistry, key += '')
      ? SymbolRegistry[key]
      : SymbolRegistry[key] = $Symbol(key);
  },
  // 19.4.2.5 Symbol.keyFor(sym)
  keyFor: function keyFor(key){
    return keyOf(SymbolRegistry, key);
  },
  useSetter: function(){ setter = true; },
  useSimple: function(){ setter = false; }
};
// 19.4.2.2 Symbol.hasInstance
// 19.4.2.3 Symbol.isConcatSpreadable
// 19.4.2.4 Symbol.iterator
// 19.4.2.6 Symbol.match
// 19.4.2.8 Symbol.replace
// 19.4.2.9 Symbol.search
// 19.4.2.10 Symbol.species
// 19.4.2.11 Symbol.split
// 19.4.2.12 Symbol.toPrimitive
// 19.4.2.13 Symbol.toStringTag
// 19.4.2.14 Symbol.unscopables
$.each.call((
    'hasInstance,isConcatSpreadable,iterator,match,replace,search,' +
    'species,split,toPrimitive,toStringTag,unscopables'
  ).split(','), function(it){
    var sym = wks(it);
    symbolStatics[it] = useNative ? sym : wrap(sym);
  }
);

setter = true;

$def($def.G + $def.W, {Symbol: $Symbol});

$def($def.S, 'Symbol', symbolStatics);

$def($def.S + $def.F * !useNative, 'Object', {
  // 19.1.2.2 Object.create(O [, Properties])
  create: $create,
  // 19.1.2.4 Object.defineProperty(O, P, Attributes)
  defineProperty: $defineProperty,
  // 19.1.2.3 Object.defineProperties(O, Properties)
  defineProperties: $defineProperties,
  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,
  // 19.1.2.7 Object.getOwnPropertyNames(O)
  getOwnPropertyNames: $getOwnPropertyNames,
  // 19.1.2.8 Object.getOwnPropertySymbols(O)
  getOwnPropertySymbols: $getOwnPropertySymbols
});

// 19.4.3.5 Symbol.prototype[@@toStringTag]
setTag($Symbol, 'Symbol');
// 20.2.1.9 Math[@@toStringTag]
setTag(Math, 'Math', true);
// 24.3.3 JSON[@@toStringTag]
setTag(global.JSON, 'JSON', true);
},{"./$":41,"./$.an-object":4,"./$.def":16,"./$.enum-keys":19,"./$.fails":21,"./$.get-names":25,"./$.global":26,"./$.has":27,"./$.is-object":34,"./$.keyof":42,"./$.library":43,"./$.property-desc":52,"./$.redef":53,"./$.shared":57,"./$.support-desc":66,"./$.tag":67,"./$.to-iobject":71,"./$.uid":74,"./$.wks":76}],163:[function(require,module,exports){
'use strict';
var $            = require('./$')
  , weak         = require('./$.collection-weak')
  , isObject     = require('./$.is-object')
  , has          = require('./$.has')
  , frozenStore  = weak.frozenStore
  , WEAK         = weak.WEAK
  , isExtensible = Object.isExtensible || isObject
  , tmp          = {};

// 23.3 WeakMap Objects
var $WeakMap = require('./$.collection')('WeakMap', function(get){
  return function WeakMap(){ return get(this, arguments[0]); };
}, {
  // 23.3.3.3 WeakMap.prototype.get(key)
  get: function get(key){
    if(isObject(key)){
      if(!isExtensible(key))return frozenStore(this).get(key);
      if(has(key, WEAK))return key[WEAK][this._i];
    }
  },
  // 23.3.3.5 WeakMap.prototype.set(key, value)
  set: function set(key, value){
    return weak.def(this, key, value);
  }
}, weak, true, true);

// IE11 WeakMap frozen keys fix
if(new $WeakMap().set((Object.freeze || Object)(tmp), 7).get(tmp) != 7){
  $.each.call(['delete', 'has', 'get', 'set'], function(key){
    var proto  = $WeakMap.prototype
      , method = proto[key];
    require('./$.redef')(proto, key, function(a, b){
      // store frozen objects on leaky map
      if(isObject(a) && !isExtensible(a)){
        var result = frozenStore(this)[key](a, b);
        return key == 'set' ? this : result;
      // store all the rest on native weakmap
      } return method.call(this, a, b);
    });
  });
}
},{"./$":41,"./$.collection":13,"./$.collection-weak":12,"./$.has":27,"./$.is-object":34,"./$.redef":53}],164:[function(require,module,exports){
'use strict';
var weak = require('./$.collection-weak');

// 23.4 WeakSet Objects
require('./$.collection')('WeakSet', function(get){
  return function WeakSet(){ return get(this, arguments[0]); };
}, {
  // 23.4.3.1 WeakSet.prototype.add(value)
  add: function add(value){
    return weak.def(this, value, true);
  }
}, weak, false, true);
},{"./$.collection":13,"./$.collection-weak":12}],165:[function(require,module,exports){
'use strict';
var $def      = require('./$.def')
  , $includes = require('./$.array-includes')(true);
$def($def.P, 'Array', {
  // https://github.com/domenic/Array.prototype.includes
  includes: function includes(el /*, fromIndex = 0 */){
    return $includes(this, el, arguments[1]);
  }
});
require('./$.unscope')('includes');
},{"./$.array-includes":5,"./$.def":16,"./$.unscope":75}],166:[function(require,module,exports){
// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var $def  = require('./$.def');

$def($def.P, 'Map', {toJSON: require('./$.collection-to-json')('Map')});
},{"./$.collection-to-json":11,"./$.def":16}],167:[function(require,module,exports){
// http://goo.gl/XkBrjD
var $def     = require('./$.def')
  , $entries = require('./$.object-to-array')(true);

$def($def.S, 'Object', {
  entries: function entries(it){
    return $entries(it);
  }
});
},{"./$.def":16,"./$.object-to-array":48}],168:[function(require,module,exports){
// https://gist.github.com/WebReflection/9353781
var $          = require('./$')
  , $def       = require('./$.def')
  , ownKeys    = require('./$.own-keys')
  , toIObject  = require('./$.to-iobject')
  , createDesc = require('./$.property-desc');

$def($def.S, 'Object', {
  getOwnPropertyDescriptors: function getOwnPropertyDescriptors(object){
    var O       = toIObject(object)
      , setDesc = $.setDesc
      , getDesc = $.getDesc
      , keys    = ownKeys(O)
      , result  = {}
      , i       = 0
      , key, D;
    while(keys.length > i){
      D = getDesc(O, key = keys[i++]);
      if(key in result)setDesc(result, key, createDesc(0, D));
      else result[key] = D;
    } return result;
  }
});
},{"./$":41,"./$.def":16,"./$.own-keys":49,"./$.property-desc":52,"./$.to-iobject":71}],169:[function(require,module,exports){
// http://goo.gl/XkBrjD
var $def    = require('./$.def')
  , $values = require('./$.object-to-array')(false);

$def($def.S, 'Object', {
  values: function values(it){
    return $values(it);
  }
});
},{"./$.def":16,"./$.object-to-array":48}],170:[function(require,module,exports){
// https://github.com/benjamingr/RexExp.escape
var $def = require('./$.def')
  , $re  = require('./$.replacer')(/[\\^$*+?.()|[\]{}]/g, '\\$&');
$def($def.S, 'RegExp', {escape: function escape(it){ return $re(it); }});

},{"./$.def":16,"./$.replacer":54}],171:[function(require,module,exports){
// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var $def  = require('./$.def');

$def($def.P, 'Set', {toJSON: require('./$.collection-to-json')('Set')});
},{"./$.collection-to-json":11,"./$.def":16}],172:[function(require,module,exports){
// https://github.com/mathiasbynens/String.prototype.at
'use strict';
var $def = require('./$.def')
  , $at  = require('./$.string-at')(true);
$def($def.P, 'String', {
  at: function at(pos){
    return $at(this, pos);
  }
});
},{"./$.def":16,"./$.string-at":61}],173:[function(require,module,exports){
'use strict';
var $def = require('./$.def')
  , $pad = require('./$.string-pad');
$def($def.P, 'String', {
  padLeft: function padLeft(maxLength /*, fillString = ' ' */){
    return $pad(this, maxLength, arguments[1], true);
  }
});
},{"./$.def":16,"./$.string-pad":63}],174:[function(require,module,exports){
'use strict';
var $def = require('./$.def')
  , $pad = require('./$.string-pad');
$def($def.P, 'String', {
  padRight: function padRight(maxLength /*, fillString = ' ' */){
    return $pad(this, maxLength, arguments[1], false);
  }
});
},{"./$.def":16,"./$.string-pad":63}],175:[function(require,module,exports){
'use strict';
// https://github.com/sebmarkbage/ecmascript-string-left-right-trim
require('./$.string-trim')('trimLeft', function($trim){
  return function trimLeft(){
    return $trim(this, 1);
  };
});
},{"./$.string-trim":65}],176:[function(require,module,exports){
'use strict';
// https://github.com/sebmarkbage/ecmascript-string-left-right-trim
require('./$.string-trim')('trimRight', function($trim){
  return function trimRight(){
    return $trim(this, 2);
  };
});
},{"./$.string-trim":65}],177:[function(require,module,exports){
// JavaScript 1.6 / Strawman array statics shim
var $       = require('./$')
  , $def    = require('./$.def')
  , $Array  = require('./$.core').Array || Array
  , statics = {};
var setStatics = function(keys, length){
  $.each.call(keys.split(','), function(key){
    if(length == undefined && key in $Array)statics[key] = $Array[key];
    else if(key in [])statics[key] = require('./$.ctx')(Function.call, [][key], length);
  });
};
setStatics('pop,reverse,shift,keys,values,entries', 1);
setStatics('indexOf,every,some,forEach,map,filter,find,findIndex,includes', 3);
setStatics('join,slice,concat,push,splice,unshift,sort,lastIndexOf,' +
           'reduce,reduceRight,copyWithin,fill');
$def($def.S, 'Array', statics);
},{"./$":41,"./$.core":14,"./$.ctx":15,"./$.def":16}],178:[function(require,module,exports){
require('./es6.array.iterator');
var global      = require('./$.global')
  , hide        = require('./$.hide')
  , Iterators   = require('./$.iterators')
  , ITERATOR    = require('./$.wks')('iterator')
  , NL          = global.NodeList
  , HTC         = global.HTMLCollection
  , NLProto     = NL && NL.prototype
  , HTCProto    = HTC && HTC.prototype
  , ArrayValues = Iterators.NodeList = Iterators.HTMLCollection = Iterators.Array;
if(NL && !(ITERATOR in NLProto))hide(NLProto, ITERATOR, ArrayValues);
if(HTC && !(ITERATOR in HTCProto))hide(HTCProto, ITERATOR, ArrayValues);
},{"./$.global":26,"./$.hide":28,"./$.iterators":40,"./$.wks":76,"./es6.array.iterator":84}],179:[function(require,module,exports){
var $def  = require('./$.def')
  , $task = require('./$.task');
$def($def.G + $def.B, {
  setImmediate:   $task.set,
  clearImmediate: $task.clear
});
},{"./$.def":16,"./$.task":68}],180:[function(require,module,exports){
// ie9- setTimeout & setInterval additional parameters fix
var global     = require('./$.global')
  , $def       = require('./$.def')
  , invoke     = require('./$.invoke')
  , partial    = require('./$.partial')
  , navigator  = global.navigator
  , MSIE       = !!navigator && /MSIE .\./.test(navigator.userAgent); // <- dirty ie9- check
var wrap = function(set){
  return MSIE ? function(fn, time /*, ...args */){
    return set(invoke(
      partial,
      [].slice.call(arguments, 2),
      typeof fn == 'function' ? fn : Function(fn)
    ), time);
  } : set;
};
$def($def.G + $def.B + $def.F * MSIE, {
  setTimeout:  wrap(global.setTimeout),
  setInterval: wrap(global.setInterval)
});
},{"./$.def":16,"./$.global":26,"./$.invoke":30,"./$.partial":50}],181:[function(require,module,exports){
require('./modules/es5');
require('./modules/es6.symbol');
require('./modules/es6.object.assign');
require('./modules/es6.object.is');
require('./modules/es6.object.set-prototype-of');
require('./modules/es6.object.to-string');
require('./modules/es6.object.freeze');
require('./modules/es6.object.seal');
require('./modules/es6.object.prevent-extensions');
require('./modules/es6.object.is-frozen');
require('./modules/es6.object.is-sealed');
require('./modules/es6.object.is-extensible');
require('./modules/es6.object.get-own-property-descriptor');
require('./modules/es6.object.get-prototype-of');
require('./modules/es6.object.keys');
require('./modules/es6.object.get-own-property-names');
require('./modules/es6.function.name');
require('./modules/es6.function.has-instance');
require('./modules/es6.number.constructor');
require('./modules/es6.number.epsilon');
require('./modules/es6.number.is-finite');
require('./modules/es6.number.is-integer');
require('./modules/es6.number.is-nan');
require('./modules/es6.number.is-safe-integer');
require('./modules/es6.number.max-safe-integer');
require('./modules/es6.number.min-safe-integer');
require('./modules/es6.number.parse-float');
require('./modules/es6.number.parse-int');
require('./modules/es6.math.acosh');
require('./modules/es6.math.asinh');
require('./modules/es6.math.atanh');
require('./modules/es6.math.cbrt');
require('./modules/es6.math.clz32');
require('./modules/es6.math.cosh');
require('./modules/es6.math.expm1');
require('./modules/es6.math.fround');
require('./modules/es6.math.hypot');
require('./modules/es6.math.imul');
require('./modules/es6.math.log10');
require('./modules/es6.math.log1p');
require('./modules/es6.math.log2');
require('./modules/es6.math.sign');
require('./modules/es6.math.sinh');
require('./modules/es6.math.tanh');
require('./modules/es6.math.trunc');
require('./modules/es6.string.from-code-point');
require('./modules/es6.string.raw');
require('./modules/es6.string.trim');
require('./modules/es6.string.iterator');
require('./modules/es6.string.code-point-at');
require('./modules/es6.string.ends-with');
require('./modules/es6.string.includes');
require('./modules/es6.string.repeat');
require('./modules/es6.string.starts-with');
require('./modules/es6.array.from');
require('./modules/es6.array.of');
require('./modules/es6.array.iterator');
require('./modules/es6.array.species');
require('./modules/es6.array.copy-within');
require('./modules/es6.array.fill');
require('./modules/es6.array.find');
require('./modules/es6.array.find-index');
require('./modules/es6.regexp.constructor');
require('./modules/es6.regexp.flags');
require('./modules/es6.regexp.match');
require('./modules/es6.regexp.replace');
require('./modules/es6.regexp.search');
require('./modules/es6.regexp.split');
require('./modules/es6.promise');
require('./modules/es6.map');
require('./modules/es6.set');
require('./modules/es6.weak-map');
require('./modules/es6.weak-set');
require('./modules/es6.reflect.apply');
require('./modules/es6.reflect.construct');
require('./modules/es6.reflect.define-property');
require('./modules/es6.reflect.delete-property');
require('./modules/es6.reflect.enumerate');
require('./modules/es6.reflect.get');
require('./modules/es6.reflect.get-own-property-descriptor');
require('./modules/es6.reflect.get-prototype-of');
require('./modules/es6.reflect.has');
require('./modules/es6.reflect.is-extensible');
require('./modules/es6.reflect.own-keys');
require('./modules/es6.reflect.prevent-extensions');
require('./modules/es6.reflect.set');
require('./modules/es6.reflect.set-prototype-of');
require('./modules/es7.array.includes');
require('./modules/es7.string.at');
require('./modules/es7.string.pad-left');
require('./modules/es7.string.pad-right');
require('./modules/es7.string.trim-left');
require('./modules/es7.string.trim-right');
require('./modules/es7.regexp.escape');
require('./modules/es7.object.get-own-property-descriptors');
require('./modules/es7.object.values');
require('./modules/es7.object.entries');
require('./modules/es7.map.to-json');
require('./modules/es7.set.to-json');
require('./modules/js.array.statics');
require('./modules/web.timers');
require('./modules/web.immediate');
require('./modules/web.dom.iterable');
module.exports = require('./modules/$.core');
},{"./modules/$.core":14,"./modules/es5":78,"./modules/es6.array.copy-within":79,"./modules/es6.array.fill":80,"./modules/es6.array.find":82,"./modules/es6.array.find-index":81,"./modules/es6.array.from":83,"./modules/es6.array.iterator":84,"./modules/es6.array.of":85,"./modules/es6.array.species":86,"./modules/es6.function.has-instance":87,"./modules/es6.function.name":88,"./modules/es6.map":89,"./modules/es6.math.acosh":90,"./modules/es6.math.asinh":91,"./modules/es6.math.atanh":92,"./modules/es6.math.cbrt":93,"./modules/es6.math.clz32":94,"./modules/es6.math.cosh":95,"./modules/es6.math.expm1":96,"./modules/es6.math.fround":97,"./modules/es6.math.hypot":98,"./modules/es6.math.imul":99,"./modules/es6.math.log10":100,"./modules/es6.math.log1p":101,"./modules/es6.math.log2":102,"./modules/es6.math.sign":103,"./modules/es6.math.sinh":104,"./modules/es6.math.tanh":105,"./modules/es6.math.trunc":106,"./modules/es6.number.constructor":107,"./modules/es6.number.epsilon":108,"./modules/es6.number.is-finite":109,"./modules/es6.number.is-integer":110,"./modules/es6.number.is-nan":111,"./modules/es6.number.is-safe-integer":112,"./modules/es6.number.max-safe-integer":113,"./modules/es6.number.min-safe-integer":114,"./modules/es6.number.parse-float":115,"./modules/es6.number.parse-int":116,"./modules/es6.object.assign":117,"./modules/es6.object.freeze":118,"./modules/es6.object.get-own-property-descriptor":119,"./modules/es6.object.get-own-property-names":120,"./modules/es6.object.get-prototype-of":121,"./modules/es6.object.is":125,"./modules/es6.object.is-extensible":122,"./modules/es6.object.is-frozen":123,"./modules/es6.object.is-sealed":124,"./modules/es6.object.keys":126,"./modules/es6.object.prevent-extensions":127,"./modules/es6.object.seal":128,"./modules/es6.object.set-prototype-of":129,"./modules/es6.object.to-string":130,"./modules/es6.promise":131,"./modules/es6.reflect.apply":132,"./modules/es6.reflect.construct":133,"./modules/es6.reflect.define-property":134,"./modules/es6.reflect.delete-property":135,"./modules/es6.reflect.enumerate":136,"./modules/es6.reflect.get":139,"./modules/es6.reflect.get-own-property-descriptor":137,"./modules/es6.reflect.get-prototype-of":138,"./modules/es6.reflect.has":140,"./modules/es6.reflect.is-extensible":141,"./modules/es6.reflect.own-keys":142,"./modules/es6.reflect.prevent-extensions":143,"./modules/es6.reflect.set":145,"./modules/es6.reflect.set-prototype-of":144,"./modules/es6.regexp.constructor":146,"./modules/es6.regexp.flags":147,"./modules/es6.regexp.match":148,"./modules/es6.regexp.replace":149,"./modules/es6.regexp.search":150,"./modules/es6.regexp.split":151,"./modules/es6.set":152,"./modules/es6.string.code-point-at":153,"./modules/es6.string.ends-with":154,"./modules/es6.string.from-code-point":155,"./modules/es6.string.includes":156,"./modules/es6.string.iterator":157,"./modules/es6.string.raw":158,"./modules/es6.string.repeat":159,"./modules/es6.string.starts-with":160,"./modules/es6.string.trim":161,"./modules/es6.symbol":162,"./modules/es6.weak-map":163,"./modules/es6.weak-set":164,"./modules/es7.array.includes":165,"./modules/es7.map.to-json":166,"./modules/es7.object.entries":167,"./modules/es7.object.get-own-property-descriptors":168,"./modules/es7.object.values":169,"./modules/es7.regexp.escape":170,"./modules/es7.set.to-json":171,"./modules/es7.string.at":172,"./modules/es7.string.pad-left":173,"./modules/es7.string.pad-right":174,"./modules/es7.string.trim-left":175,"./modules/es7.string.trim-right":176,"./modules/js.array.statics":177,"./modules/web.dom.iterable":178,"./modules/web.immediate":179,"./modules/web.timers":180}],182:[function(require,module,exports){
(function (process,global){
/**
 * Copyright (c) 2014, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * https://raw.github.com/facebook/regenerator/master/LICENSE file. An
 * additional grant of patent rights can be found in the PATENTS file in
 * the same directory.
 */

!(function(global) {
  "use strict";

  var hasOwn = Object.prototype.hasOwnProperty;
  var undefined; // More compressible than void 0.
  var iteratorSymbol =
    typeof Symbol === "function" && Symbol.iterator || "@@iterator";

  var inModule = typeof module === "object";
  var runtime = global.regeneratorRuntime;
  if (runtime) {
    if (inModule) {
      // If regeneratorRuntime is defined globally and we're in a module,
      // make the exports object identical to regeneratorRuntime.
      module.exports = runtime;
    }
    // Don't bother evaluating the rest of this file if the runtime was
    // already defined globally.
    return;
  }

  // Define the runtime globally (as expected by generated code) as either
  // module.exports (if we're in a module) or a new, empty object.
  runtime = global.regeneratorRuntime = inModule ? module.exports : {};

  function wrap(innerFn, outerFn, self, tryLocsList) {
    // If outerFn provided, then outerFn.prototype instanceof Generator.
    var generator = Object.create((outerFn || Generator).prototype);

    generator._invoke = makeInvokeMethod(
      innerFn, self || null,
      new Context(tryLocsList || [])
    );

    return generator;
  }
  runtime.wrap = wrap;

  // Try/catch helper to minimize deoptimizations. Returns a completion
  // record like context.tryEntries[i].completion. This interface could
  // have been (and was previously) designed to take a closure to be
  // invoked without arguments, but in all the cases we care about we
  // already have an existing method we want to call, so there's no need
  // to create a new function object. We can even get away with assuming
  // the method takes exactly one argument, since that happens to be true
  // in every case, so we don't have to touch the arguments object. The
  // only additional allocation required is the completion record, which
  // has a stable shape and so hopefully should be cheap to allocate.
  function tryCatch(fn, obj, arg) {
    try {
      return { type: "normal", arg: fn.call(obj, arg) };
    } catch (err) {
      return { type: "throw", arg: err };
    }
  }

  var GenStateSuspendedStart = "suspendedStart";
  var GenStateSuspendedYield = "suspendedYield";
  var GenStateExecuting = "executing";
  var GenStateCompleted = "completed";

  // Returning this object from the innerFn has the same effect as
  // breaking out of the dispatch switch statement.
  var ContinueSentinel = {};

  // Dummy constructor functions that we use as the .constructor and
  // .constructor.prototype properties for functions that return Generator
  // objects. For full spec compliance, you may wish to configure your
  // minifier not to mangle the names of these two functions.
  function Generator() {}
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}

  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype;
  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;
  GeneratorFunctionPrototype.constructor = GeneratorFunction;
  GeneratorFunction.displayName = "GeneratorFunction";

  // Helper for defining the .next, .throw, and .return methods of the
  // Iterator interface in terms of a single ._invoke method.
  function defineIteratorMethods(prototype) {
    ["next", "throw", "return"].forEach(function(method) {
      prototype[method] = function(arg) {
        return this._invoke(method, arg);
      };
    });
  }

  runtime.isGeneratorFunction = function(genFun) {
    var ctor = typeof genFun === "function" && genFun.constructor;
    return ctor
      ? ctor === GeneratorFunction ||
        // For the native GeneratorFunction constructor, the best we can
        // do is to check its .name property.
        (ctor.displayName || ctor.name) === "GeneratorFunction"
      : false;
  };

  runtime.mark = function(genFun) {
    genFun.__proto__ = GeneratorFunctionPrototype;
    genFun.prototype = Object.create(Gp);
    return genFun;
  };

  // Within the body of any async function, `await x` is transformed to
  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
  // `value instanceof AwaitArgument` to determine if the yielded value is
  // meant to be awaited. Some may consider the name of this method too
  // cutesy, but they are curmudgeons.
  runtime.awrap = function(arg) {
    return new AwaitArgument(arg);
  };

  function AwaitArgument(arg) {
    this.arg = arg;
  }

  function AsyncIterator(generator) {
    // This invoke function is written in a style that assumes some
    // calling function (or Promise) will handle exceptions.
    function invoke(method, arg) {
      var result = generator[method](arg);
      var value = result.value;
      return value instanceof AwaitArgument
        ? Promise.resolve(value.arg).then(invokeNext, invokeThrow)
        : Promise.resolve(value).then(function(unwrapped) {
            // When a yielded Promise is resolved, its final value becomes
            // the .value of the Promise<{value,done}> result for the
            // current iteration. If the Promise is rejected, however, the
            // result for this iteration will be rejected with the same
            // reason. Note that rejections of yielded Promises are not
            // thrown back into the generator function, as is the case
            // when an awaited Promise is rejected. This difference in
            // behavior between yield and await is important, because it
            // allows the consumer to decide what to do with the yielded
            // rejection (swallow it and continue, manually .throw it back
            // into the generator, abandon iteration, whatever). With
            // await, by contrast, there is no opportunity to examine the
            // rejection reason outside the generator function, so the
            // only option is to throw it from the await expression, and
            // let the generator function handle the exception.
            result.value = unwrapped;
            return result;
          });
    }

    if (typeof process === "object" && process.domain) {
      invoke = process.domain.bind(invoke);
    }

    var invokeNext = invoke.bind(generator, "next");
    var invokeThrow = invoke.bind(generator, "throw");
    var invokeReturn = invoke.bind(generator, "return");
    var previousPromise;

    function enqueue(method, arg) {
      var enqueueResult =
        // If enqueue has been called before, then we want to wait until
        // all previous Promises have been resolved before calling invoke,
        // so that results are always delivered in the correct order. If
        // enqueue has not been called before, then it is important to
        // call invoke immediately, without waiting on a callback to fire,
        // so that the async generator function has the opportunity to do
        // any necessary setup in a predictable way. This predictability
        // is why the Promise constructor synchronously invokes its
        // executor callback, and why async functions synchronously
        // execute code before the first await. Since we implement simple
        // async functions in terms of async generators, it is especially
        // important to get this right, even though it requires care.
        previousPromise ? previousPromise.then(function() {
          return invoke(method, arg);
        }) : new Promise(function(resolve) {
          resolve(invoke(method, arg));
        });

      // Avoid propagating enqueueResult failures to Promises returned by
      // later invocations of the iterator.
      previousPromise = enqueueResult["catch"](function(ignored){});

      return enqueueResult;
    }

    // Define the unified helper method that is used to implement .next,
    // .throw, and .return (see defineIteratorMethods).
    this._invoke = enqueue;
  }

  defineIteratorMethods(AsyncIterator.prototype);

  // Note that simple async functions are implemented on top of
  // AsyncIterator objects; they just return a Promise for the value of
  // the final result produced by the iterator.
  runtime.async = function(innerFn, outerFn, self, tryLocsList) {
    var iter = new AsyncIterator(
      wrap(innerFn, outerFn, self, tryLocsList)
    );

    return runtime.isGeneratorFunction(outerFn)
      ? iter // If outerFn is a generator, return the full iterator.
      : iter.next().then(function(result) {
          return result.done ? result.value : iter.next();
        });
  };

  function makeInvokeMethod(innerFn, self, context) {
    var state = GenStateSuspendedStart;

    return function invoke(method, arg) {
      if (state === GenStateExecuting) {
        throw new Error("Generator is already running");
      }

      if (state === GenStateCompleted) {
        if (method === "throw") {
          throw arg;
        }

        // Be forgiving, per 25.3.3.3.3 of the spec:
        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
        return doneResult();
      }

      while (true) {
        var delegate = context.delegate;
        if (delegate) {
          if (method === "return" ||
              (method === "throw" && delegate.iterator[method] === undefined)) {
            // A return or throw (when the delegate iterator has no throw
            // method) always terminates the yield* loop.
            context.delegate = null;

            // If the delegate iterator has a return method, give it a
            // chance to clean up.
            var returnMethod = delegate.iterator["return"];
            if (returnMethod) {
              var record = tryCatch(returnMethod, delegate.iterator, arg);
              if (record.type === "throw") {
                // If the return method threw an exception, let that
                // exception prevail over the original return or throw.
                method = "throw";
                arg = record.arg;
                continue;
              }
            }

            if (method === "return") {
              // Continue with the outer return, now that the delegate
              // iterator has been terminated.
              continue;
            }
          }

          var record = tryCatch(
            delegate.iterator[method],
            delegate.iterator,
            arg
          );

          if (record.type === "throw") {
            context.delegate = null;

            // Like returning generator.throw(uncaught), but without the
            // overhead of an extra function call.
            method = "throw";
            arg = record.arg;
            continue;
          }

          // Delegate generator ran and handled its own exceptions so
          // regardless of what the method was, we continue as if it is
          // "next" with an undefined arg.
          method = "next";
          arg = undefined;

          var info = record.arg;
          if (info.done) {
            context[delegate.resultName] = info.value;
            context.next = delegate.nextLoc;
          } else {
            state = GenStateSuspendedYield;
            return info;
          }

          context.delegate = null;
        }

        if (method === "next") {
          if (state === GenStateSuspendedYield) {
            context.sent = arg;
          } else {
            context.sent = undefined;
          }

        } else if (method === "throw") {
          if (state === GenStateSuspendedStart) {
            state = GenStateCompleted;
            throw arg;
          }

          if (context.dispatchException(arg)) {
            // If the dispatched exception was caught by a catch block,
            // then let that catch block handle the exception normally.
            method = "next";
            arg = undefined;
          }

        } else if (method === "return") {
          context.abrupt("return", arg);
        }

        state = GenStateExecuting;

        var record = tryCatch(innerFn, self, context);
        if (record.type === "normal") {
          // If an exception is thrown from innerFn, we leave state ===
          // GenStateExecuting and loop back for another invocation.
          state = context.done
            ? GenStateCompleted
            : GenStateSuspendedYield;

          var info = {
            value: record.arg,
            done: context.done
          };

          if (record.arg === ContinueSentinel) {
            if (context.delegate && method === "next") {
              // Deliberately forget the last sent value so that we don't
              // accidentally pass it on to the delegate.
              arg = undefined;
            }
          } else {
            return info;
          }

        } else if (record.type === "throw") {
          state = GenStateCompleted;
          // Dispatch the exception by looping back around to the
          // context.dispatchException(arg) call above.
          method = "throw";
          arg = record.arg;
        }
      }
    };
  }

  // Define Generator.prototype.{next,throw,return} in terms of the
  // unified ._invoke helper method.
  defineIteratorMethods(Gp);

  Gp[iteratorSymbol] = function() {
    return this;
  };

  Gp.toString = function() {
    return "[object Generator]";
  };

  function pushTryEntry(locs) {
    var entry = { tryLoc: locs[0] };

    if (1 in locs) {
      entry.catchLoc = locs[1];
    }

    if (2 in locs) {
      entry.finallyLoc = locs[2];
      entry.afterLoc = locs[3];
    }

    this.tryEntries.push(entry);
  }

  function resetTryEntry(entry) {
    var record = entry.completion || {};
    record.type = "normal";
    delete record.arg;
    entry.completion = record;
  }

  function Context(tryLocsList) {
    // The root entry object (effectively a try statement without a catch
    // or a finally block) gives us a place to store values thrown from
    // locations where there is no enclosing try statement.
    this.tryEntries = [{ tryLoc: "root" }];
    tryLocsList.forEach(pushTryEntry, this);
    this.reset(true);
  }

  runtime.keys = function(object) {
    var keys = [];
    for (var key in object) {
      keys.push(key);
    }
    keys.reverse();

    // Rather than returning an object with a next method, we keep
    // things simple and return the next function itself.
    return function next() {
      while (keys.length) {
        var key = keys.pop();
        if (key in object) {
          next.value = key;
          next.done = false;
          return next;
        }
      }

      // To avoid creating an additional object, we just hang the .value
      // and .done properties off the next function object itself. This
      // also ensures that the minifier will not anonymize the function.
      next.done = true;
      return next;
    };
  };

  function values(iterable) {
    if (iterable) {
      var iteratorMethod = iterable[iteratorSymbol];
      if (iteratorMethod) {
        return iteratorMethod.call(iterable);
      }

      if (typeof iterable.next === "function") {
        return iterable;
      }

      if (!isNaN(iterable.length)) {
        var i = -1, next = function next() {
          while (++i < iterable.length) {
            if (hasOwn.call(iterable, i)) {
              next.value = iterable[i];
              next.done = false;
              return next;
            }
          }

          next.value = undefined;
          next.done = true;

          return next;
        };

        return next.next = next;
      }
    }

    // Return an iterator with no values.
    return { next: doneResult };
  }
  runtime.values = values;

  function doneResult() {
    return { value: undefined, done: true };
  }

  Context.prototype = {
    constructor: Context,

    reset: function(skipTempReset) {
      this.prev = 0;
      this.next = 0;
      this.sent = undefined;
      this.done = false;
      this.delegate = null;

      this.tryEntries.forEach(resetTryEntry);

      if (!skipTempReset) {
        for (var name in this) {
          // Not sure about the optimal order of these conditions:
          if (name.charAt(0) === "t" &&
              hasOwn.call(this, name) &&
              !isNaN(+name.slice(1))) {
            this[name] = undefined;
          }
        }
      }
    },

    stop: function() {
      this.done = true;

      var rootEntry = this.tryEntries[0];
      var rootRecord = rootEntry.completion;
      if (rootRecord.type === "throw") {
        throw rootRecord.arg;
      }

      return this.rval;
    },

    dispatchException: function(exception) {
      if (this.done) {
        throw exception;
      }

      var context = this;
      function handle(loc, caught) {
        record.type = "throw";
        record.arg = exception;
        context.next = loc;
        return !!caught;
      }

      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        var record = entry.completion;

        if (entry.tryLoc === "root") {
          // Exception thrown outside of any try block that could handle
          // it, so set the completion value of the entire function to
          // throw the exception.
          return handle("end");
        }

        if (entry.tryLoc <= this.prev) {
          var hasCatch = hasOwn.call(entry, "catchLoc");
          var hasFinally = hasOwn.call(entry, "finallyLoc");

          if (hasCatch && hasFinally) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            } else if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else if (hasCatch) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            }

          } else if (hasFinally) {
            if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else {
            throw new Error("try statement without catch or finally");
          }
        }
      }
    },

    abrupt: function(type, arg) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc <= this.prev &&
            hasOwn.call(entry, "finallyLoc") &&
            this.prev < entry.finallyLoc) {
          var finallyEntry = entry;
          break;
        }
      }

      if (finallyEntry &&
          (type === "break" ||
           type === "continue") &&
          finallyEntry.tryLoc <= arg &&
          arg <= finallyEntry.finallyLoc) {
        // Ignore the finally entry if control is not jumping to a
        // location outside the try/catch block.
        finallyEntry = null;
      }

      var record = finallyEntry ? finallyEntry.completion : {};
      record.type = type;
      record.arg = arg;

      if (finallyEntry) {
        this.next = finallyEntry.finallyLoc;
      } else {
        this.complete(record);
      }

      return ContinueSentinel;
    },

    complete: function(record, afterLoc) {
      if (record.type === "throw") {
        throw record.arg;
      }

      if (record.type === "break" ||
          record.type === "continue") {
        this.next = record.arg;
      } else if (record.type === "return") {
        this.rval = record.arg;
        this.next = "end";
      } else if (record.type === "normal" && afterLoc) {
        this.next = afterLoc;
      }
    },

    finish: function(finallyLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.finallyLoc === finallyLoc) {
          this.complete(entry.completion, entry.afterLoc);
          resetTryEntry(entry);
          return ContinueSentinel;
        }
      }
    },

    "catch": function(tryLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc === tryLoc) {
          var record = entry.completion;
          if (record.type === "throw") {
            var thrown = record.arg;
            resetTryEntry(entry);
          }
          return thrown;
        }
      }

      // The context.catch method must only be called with a location
      // argument that corresponds to a known catch block.
      throw new Error("illegal catch attempt");
    },

    delegateYield: function(iterable, resultName, nextLoc) {
      this.delegate = {
        iterator: values(iterable),
        resultName: resultName,
        nextLoc: nextLoc
      };

      return ContinueSentinel;
    }
  };
})(
  // Among the various tricks for obtaining a reference to the global
  // object, this seems to be the most reliable technique that does not
  // use indirect eval (which violates Content Security Policy).
  typeof global === "object" ? global :
  typeof window === "object" ? window :
  typeof self === "object" ? self : this
);

}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"_process":1}]},{},[2]);

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Define the Sprite in window, declare the Sprite.Base
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  var SpriteCore = (function () {
    function SpriteCore() {
      _classCallCheck(this, SpriteCore);
    }

    _createClass(SpriteCore, [{
      key: "assign",
      value: function assign(name, object) {
        Object.defineProperty(this, name, {
          enumerable: false,
          configurable: false,
          writable: false,
          value: object
        });
        return this;
      }
    }]);

    return SpriteCore;
  })();

  ;

  var Sprite = window.Sprite = new SpriteCore();

  /**
   * Function Sprite.Namespace, return an unique Private-Properties function
   * for javascript private properties need, for es6
   */
  Sprite.assign("Namespace", function () {
    /**
     * Using closure variable store private properties
     * and different file have different "privateProperties"
     */
    var privates = new WeakMap();
    return function (object) {
      if (privates.has(object) == false) {
        privates.set(object, {});
      }
      return privates.get(object);
    };
  });

  /**
   * @param {number} N The min number
   * @param {number} M The max number
   * @return {number} A random integer N <= return < M, aka. [N, M)
   */
  Sprite.assign("rand", function (N, M) {
    var r = M - N;
    r *= Math.random();
    return N + Math.floor(r);
  });

  /**
   * @param {Object} object The object we require copy
   * @return {Object} A deep copy of object
   */
  Sprite.assign("copy", function (object) {
    return JSON.parse(JSON.stringify(object));
  });

  Sprite.assign("each", function (obj, functional) {
    if (obj.forEach) {
      obj.forEach(functional);
    } else {
      for (var key in obj) {
        functional(obj[key], key, obj);
      }
    }
  });

  Sprite.assign("uuid", function () {
    // generate a UUID
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/x|y/g, function (c) {
      var r = Math.floor(Math.random() * 16);
      if (c == "x") {
        return r.toString(16);
      } else {
        return (r & 0x03 | 0x08).toString(16);
      }
    });
  });

  Sprite.assign("btoa", function (str) {
    // convert str to base64
    return window.btoa(unescape(encodeURIComponent(str)));
  });

  Sprite.assign("atob", function (str) {
    // convert base64 str to original
    return decodeURIComponent(escape(window.atob(str)));
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5QkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztNQUVQLFVBQVU7YUFBVixVQUFVOzRCQUFWLFVBQVU7OztpQkFBVixVQUFVOzthQUNQLGdCQUFDLElBQUksRUFBRSxNQUFNLEVBQUU7QUFDcEIsY0FBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFO0FBQ2hDLG9CQUFVLEVBQUUsS0FBSztBQUNqQixzQkFBWSxFQUFFLEtBQUs7QUFDbkIsa0JBQVEsRUFBRSxLQUFLO0FBQ2YsZUFBSyxFQUFFLE1BQU07U0FDZCxDQUFDLENBQUM7QUFDSCxlQUFPLElBQUksQ0FBQztPQUNiOzs7V0FURyxVQUFVOzs7QUFVZixHQUFDOztBQUVGLE1BQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQzs7Ozs7O0FBTTlDLFFBQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxFQUFFLFlBQVk7Ozs7O0FBS3JDLFFBQUksUUFBUSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7QUFDN0IsV0FBTyxVQUFVLE1BQU0sRUFBRTtBQUN2QixVQUFJLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxFQUFFO0FBQ2pDLGdCQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztPQUMxQjtBQUNELGFBQU8sUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztLQUM3QixDQUFDO0dBQ0gsQ0FBQyxDQUFDOzs7Ozs7O0FBT0gsUUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsVUFBVSxDQUFDLEVBQUUsQ0FBQyxFQUFFO0FBQ3BDLFFBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDZCxLQUFDLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ25CLFdBQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7R0FDMUIsQ0FBQyxDQUFDOzs7Ozs7QUFNSCxRQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxVQUFVLE1BQU0sRUFBRTtBQUN0QyxXQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0dBQzNDLENBQUMsQ0FBQzs7QUFFSCxRQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxVQUFVLEdBQUcsRUFBRSxVQUFVLEVBQUU7QUFDL0MsUUFBSSxHQUFHLENBQUMsT0FBTyxFQUFFO0FBQ2YsU0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztLQUN6QixNQUFNO0FBQ0wsV0FBSyxJQUFJLEdBQUcsSUFBSSxHQUFHLEVBQUU7QUFDbkIsa0JBQVUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO09BQ2hDO0tBQ0Y7R0FDRixDQUFDLENBQUM7O0FBRUgsUUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsWUFBWTs7QUFFaEMsV0FBTyxzQ0FBc0MsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxFQUFFO0FBQ3pFLFVBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZDLFVBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRTtBQUNaLGVBQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztPQUN2QixNQUFNO0FBQ0wsZUFBTyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFBLENBQUUsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO09BQ3ZDO0tBQ0YsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDOztBQUVILFFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLFVBQVUsR0FBRyxFQUFFOztBQUVuQyxXQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztHQUN2RCxDQUFDLENBQUM7O0FBRUgsUUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsVUFBVSxHQUFHLEVBQUU7O0FBRW5DLFdBQU8sa0JBQWtCLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0dBQ3JELENBQUMsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IlNwcml0ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbjJEIEdhbWUgU3ByaXRlIExpYnJhcnksIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBEZWZpbmUgdGhlIFNwcml0ZSBpbiB3aW5kb3csIGRlY2xhcmUgdGhlIFNwcml0ZS5CYXNlXG4gKiBAYXV0aG9yIG1haWxAcWhkdWFuLmNvbSAoUUggRHVhbilcbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBjbGFzcyBTcHJpdGVDb3JlIHtcbiAgICBhc3NpZ24gKG5hbWUsIG9iamVjdCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIG5hbWUsIHtcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IG9iamVjdFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH07XG5cbiAgbGV0IFNwcml0ZSA9IHdpbmRvdy5TcHJpdGUgPSBuZXcgU3ByaXRlQ29yZSgpO1xuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiBTcHJpdGUuTmFtZXNwYWNlLCByZXR1cm4gYW4gdW5pcXVlIFByaXZhdGUtUHJvcGVydGllcyBmdW5jdGlvblxuICAgKiBmb3IgamF2YXNjcmlwdCBwcml2YXRlIHByb3BlcnRpZXMgbmVlZCwgZm9yIGVzNlxuICAgKi9cbiAgU3ByaXRlLmFzc2lnbihcIk5hbWVzcGFjZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgLyoqXG4gICAgICogVXNpbmcgY2xvc3VyZSB2YXJpYWJsZSBzdG9yZSBwcml2YXRlIHByb3BlcnRpZXNcbiAgICAgKiBhbmQgZGlmZmVyZW50IGZpbGUgaGF2ZSBkaWZmZXJlbnQgXCJwcml2YXRlUHJvcGVydGllc1wiXG4gICAgICovXG4gICAgbGV0IHByaXZhdGVzID0gbmV3IFdlYWtNYXAoKTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgICAgaWYgKHByaXZhdGVzLmhhcyhvYmplY3QpID09IGZhbHNlKSB7XG4gICAgICAgIHByaXZhdGVzLnNldChvYmplY3QsIHt9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwcml2YXRlcy5nZXQob2JqZWN0KTtcbiAgICB9O1xuICB9KTtcblxuICAvKipcbiAgICogQHBhcmFtIHtudW1iZXJ9IE4gVGhlIG1pbiBudW1iZXJcbiAgICogQHBhcmFtIHtudW1iZXJ9IE0gVGhlIG1heCBudW1iZXJcbiAgICogQHJldHVybiB7bnVtYmVyfSBBIHJhbmRvbSBpbnRlZ2VyIE4gPD0gcmV0dXJuIDwgTSwgYWthLiBbTiwgTSlcbiAgICovXG4gIFNwcml0ZS5hc3NpZ24oXCJyYW5kXCIsIGZ1bmN0aW9uIChOLCBNKSB7XG4gICAgbGV0IHIgPSBNIC0gTjtcbiAgICByICo9IE1hdGgucmFuZG9tKCk7XG4gICAgcmV0dXJuIE4gKyBNYXRoLmZsb29yKHIpO1xuICB9KTtcblxuICAvKipcbiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHdlIHJlcXVpcmUgY29weVxuICAgKiBAcmV0dXJuIHtPYmplY3R9IEEgZGVlcCBjb3B5IG9mIG9iamVjdFxuICAgKi9cbiAgU3ByaXRlLmFzc2lnbihcImNvcHlcIiwgZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iamVjdCkpO1xuICB9KTtcblxuICBTcHJpdGUuYXNzaWduKFwiZWFjaFwiLCBmdW5jdGlvbiAob2JqLCBmdW5jdGlvbmFsKSB7XG4gICAgaWYgKG9iai5mb3JFYWNoKSB7XG4gICAgICBvYmouZm9yRWFjaChmdW5jdGlvbmFsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChsZXQga2V5IGluIG9iaikge1xuICAgICAgICBmdW5jdGlvbmFsKG9ialtrZXldLCBrZXksIG9iaik7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBTcHJpdGUuYXNzaWduKFwidXVpZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgLy8gZ2VuZXJhdGUgYSBVVUlEXG4gICAgcmV0dXJuIFwieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4XCIucmVwbGFjZSgveHx5L2csIGZ1bmN0aW9uIChjKSB7XG4gICAgICBsZXQgciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2KTtcbiAgICAgIGlmIChjID09IFwieFwiKSB7XG4gICAgICAgIHJldHVybiByLnRvU3RyaW5nKDE2KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAociAmIDB4MDMgfCAweDA4KS50b1N0cmluZygxNik7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIFNwcml0ZS5hc3NpZ24oXCJidG9hXCIsIGZ1bmN0aW9uIChzdHIpIHtcbiAgICAvLyBjb252ZXJ0IHN0ciB0byBiYXNlNjRcbiAgICByZXR1cm4gd2luZG93LmJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHN0cikpKTtcbiAgfSk7XG5cbiAgU3ByaXRlLmFzc2lnbihcImF0b2JcIiwgZnVuY3Rpb24gKHN0cikge1xuICAgIC8vIGNvbnZlcnQgYmFzZTY0IHN0ciB0byBvcmlnaW5hbFxuICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHdpbmRvdy5hdG9iKHN0cikpKTtcbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Class Sprite.Display
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
   * Class Sprite.Canvas, an renderer using canvas.getContext("2d")
   * @class
   */
  Sprite.assign("Canvas", (function () {
    _createClass(SpriteCanvas, null, [{
      key: "support",

      /**
       * @static
       * @return {boolean} The browser whether or not support HTML5 canvas
       */
      value: function support() {
        var canvas = document.createElement("canvas");
        var context = canvas.getContext("2d");
        if (context) {
          return true;
        }
        return false;
      }

      /**
       * Construct a renderer width certain width and height
       * @constructor
       */
    }]);

    function SpriteCanvas(width, height) {
      _classCallCheck(this, SpriteCanvas);

      var privates = internal(this);
      var canvas = document.createElement("canvas");
      canvas.width = width || 640;
      canvas.height = height || 480;
      var context = canvas.getContext("2d");

      if (!context) {
        throw new Error("Sprite.Canvas canvas is not supported");
      }

      console.log("canvas inited");

      /**
       * Color after clear canvas
       */
      privates.color = "#000000";
      /**
       * The canvas object
       */
      privates.canvas = canvas;
      /**
       * Context of canvas
       */
      privates.context = context;
      /**
       * Global alpha
       */
      privates.alpha = 1;
      /**
       * Save some filter paramters, eg. brightness/contrast
       */
      privates.filter = new Map();
      this.filter("brightness", 0);
      this.filter("contrast", 0);
    }

    /**
     * @param {string} name The name of filter you want get or set
     * @param {number} value Number or undefined, if undefined ,return current value
     */

    _createClass(SpriteCanvas, [{
      key: "filter",
      value: function filter(name, value) {
        var privates = internal(this);
        if (Number.isFinite(value)) {
          if (name == "brightness") {
            value += 1;
          }
          if (name == "contrast") {
            value += 1;
          }
          if (privates.filter.get(name) != value) {
            (function () {
              privates.filter.set(name, value);
              var filter = [];
              privates.filter.forEach(function (value, key, object) {
                filter.push(key + "(" + value + ")");
              });
              filter = filter.join(" ");
              privates.canvas.style.filter = filter;
              privates.canvas.style.webkitFilter = filter;
            })();
          }
        } else {
          return privates.filter.get(name);
        }
      }

      /**
       * Draw an image on the canvas
       * arguments same as canvas.getContext("2d")
       */
    }, {
      key: "drawImage",
      value: function drawImage() {
        var privates = internal(this);
        privates.context.globalAlpha = this.alpha;
        privates.context.drawImage.apply(privates.context, arguments);
      }
    }, {
      key: "release",
      value: function release() {}
      // nothing

      /**
       * Remove everything on canvas but a single color
       */

    }, {
      key: "clear",
      value: function clear() {
        var privates = internal(this);
        privates.context.fillStyle = privates.color;
        privates.context.fillRect(0, 0, this.width, this.height);
      }

      /**
       * @return {string} The color, eg "#00ff00"
       */
    }, {
      key: "color",
      get: function get() {
        return internal(this).color;
      },

      /**
       * @param {string} value The new color, eg "#00ff00"
       */
      set: function set(value) {
        if (value.match(/^#([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])$/)) {
          internal(this).color = value;
        } else {
          console.error(value, this);
          throw new Error("Sprite.Canvas invalid color value");
        }
      }

      /**
       * @return {number} The alpha, 0 to 1
       */
    }, {
      key: "alpha",
      get: function get() {
        return internal(this).alpha;
      },

      /**
       * @param {number} value The new alpha number
       */
      set: function set(value) {
        if (Number.isFinite(value) && value >= 0 && value <= 1) {
          internal(this).alpha = value;
        } else {
          console.error(value, this);
          throw new Error("Sprite.Canvas got invalid alpha number");
        }
      }

      /**
       * @return {number} Width of canvas
       */
    }, {
      key: "width",
      get: function get() {
        return internal(this).canvas.width;
      },

      /**
       * @param {number} value New width
       */
      set: function set(value) {
        if (Number.isFinite(value) && value > 0 && value < 10000) {
          internal(this).canvas.width = value;
        } else {
          console.error(value, this);
          throw new Error("Sprite.Canvas got invalid width number");
        }
      }

      /**
       * @return {number} Height of canvas
       */
    }, {
      key: "height",
      get: function get() {
        return internal(this).canvas.height;
      },

      /**
       * @param {number} value New height
       */
      set: function set(value) {
        var privates = internal(this);
        if (Number.isFinite(value) && value > 0 && value < 10000) {
          if (value != privates.canvas.height) {
            privates.canvas.height = value;
          }
        } else {
          console.error(value, this);
          throw new Error("Sprite.Canvas got invalid height number");
        }
      }

      /**
       * @return {Object} Canvas
       */
    }, {
      key: "canvas",
      get: function get() {
        return internal(this).canvas;
      },
      set: function set(value) {
        throw new Error("Sprite.Canvas.canvas cannot write");
      }
    }]);

    return SpriteCanvas;
  })());
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlQ2FudmFzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5QkEsQ0FBQyxZQUFZO0FBQ1osY0FBWSxDQUFDOztBQUVaLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7Ozs7O0FBTWxDLFFBQU0sQ0FBQyxNQUFNLENBQUMsUUFBUTtpQkFBUSxZQUFZOzs7Ozs7O2FBTXpCLG1CQUFHO0FBQ2hCLFlBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDOUMsWUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN0QyxZQUFJLE9BQU8sRUFBRTtBQUNYLGlCQUFPLElBQUksQ0FBQztTQUNiO0FBQ0QsZUFBTyxLQUFLLENBQUM7T0FDZDs7Ozs7Ozs7QUFNVyxhQW5CZ0IsWUFBWSxDQW1CM0IsS0FBSyxFQUFFLE1BQU0sRUFBRTs0QkFuQkEsWUFBWTs7QUFvQnRDLFVBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM5QixVQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzlDLFlBQU0sQ0FBQyxLQUFLLEdBQUcsS0FBSyxJQUFJLEdBQUcsQ0FBQztBQUM1QixZQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sSUFBSSxHQUFHLENBQUM7QUFDOUIsVUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQzs7QUFFdEMsVUFBSSxDQUFDLE9BQU8sRUFBRTtBQUNaLGNBQU0sSUFBSSxLQUFLLENBQUMsdUNBQXVDLENBQUMsQ0FBQztPQUMxRDs7QUFFRCxhQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxDQUFDOzs7OztBQUs3QixjQUFRLENBQUMsS0FBSyxH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QVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDOUIsWUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUN4QixLQUFLLEdBQUcsQ0FBQyxJQUNULEtBQUssR0FBRyxLQUFLLEVBQ2I7QUFDQSxjQUFJLEtBQUssSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtBQUNuQyxvQkFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1dBQ2hDO1NBQ0YsTUFBTTtBQUNMLGlCQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztBQUMzQixnQkFBTSxJQUFJLEtBQUssQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO1NBQzVEO09BQ0Y7Ozs7Ozs7V0FJVSxlQUFHO0FBQ1osZUFBTyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDO09BQzlCO1dBRVUsYUFBQyxLQUFLLEVBQUU7QUFDakIsY0FBTSxJQUFJLEtBQUssQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO09BQ3REOzs7V0F0TTJCLFlBQVk7T0F3TXhDLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJTcHJpdGVDYW52YXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ2xhc3MgU3ByaXRlLkRpc3BsYXlcbiAqIEBhdXRob3IgbWFpbEBxaGR1YW4uY29tIChRSCBEdWFuKVxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gIC8qKlxuICAgKiBDbGFzcyBTcHJpdGUuQ2FudmFzLCBhbiByZW5kZXJlciB1c2luZyBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpXG4gICAqIEBjbGFzc1xuICAgKi9cbiAgU3ByaXRlLmFzc2lnbihcIkNhbnZhc1wiLCBjbGFzcyBTcHJpdGVDYW52YXMge1xuXG4gICAgLyoqXG4gICAgICogQHN0YXRpY1xuICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IFRoZSBicm93c2VyIHdoZXRoZXIgb3Igbm90IHN1cHBvcnQgSFRNTDUgY2FudmFzXG4gICAgICovXG4gICAgc3RhdGljIHN1cHBvcnQgKCkge1xuICAgICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICBsZXQgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICBpZiAoY29udGV4dCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3QgYSByZW5kZXJlciB3aWR0aCBjZXJ0YWluIHdpZHRoIGFuZCBoZWlnaHRcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAod2lkdGgsIGhlaWdodCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoIHx8IDY0MDtcbiAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQgfHwgNDgwO1xuICAgICAgbGV0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuXG4gICAgICBpZiAoIWNvbnRleHQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLkNhbnZhcyBjYW52YXMgaXMgbm90IHN1cHBvcnRlZFwiKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coXCJjYW52YXMgaW5pdGVkXCIpO1xuXG4gICAgICAvKipcbiAgICAgICAqIENvbG9yIGFmdGVyIGNsZWFyIGNhbnZhc1xuICAgICAgICovXG4gICAgICBwcml2YXRlcy5jb2xvciA9IFwiIzAwMDAwMFwiO1xuICAgICAgLyoqXG4gICAgICAgKiBUaGUgY2FudmFzIG9iamVjdFxuICAgICAgICovXG4gICAgICBwcml2YXRlcy5jYW52YXMgPSBjYW52YXM7XG4gICAgICAvKipcbiAgICAgICAqIENvbnRleHQgb2YgY2FudmFzXG4gICAgICAgKi9cbiAgICAgIHByaXZhdGVzLmNvbnRleHQgPSBjb250ZXh0O1xuICAgICAgLyoqXG4gICAgICAgKiBHbG9iYWwgYWxwaGFcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuYWxwaGEgPSAxO1xuICAgICAgLyoqXG4gICAgICAgKiBTYXZlIHNvbWUgZmlsdGVyIHBhcmFtdGVycywgZWcuIGJyaWdodG5lc3MvY29udHJhc3RcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuZmlsdGVyID0gbmV3IE1hcCgpO1xuICAgICAgdGhpcy5maWx0ZXIoXCJicmlnaHRuZXNzXCIsIDApO1xuICAgICAgdGhpcy5maWx0ZXIoXCJjb250cmFzdFwiLCAwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiBmaWx0ZXIgeW91IHdhbnQgZ2V0IG9yIHNldFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBOdW1iZXIgb3IgdW5kZWZpbmVkLCBpZiB1bmRlZmluZWQgLHJldHVybiBjdXJyZW50IHZhbHVlXG4gICAgICovXG4gICAgZmlsdGVyIChuYW1lLCB2YWx1ZSkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKHZhbHVlKSkge1xuICAgICAgICBpZiAobmFtZSA9PSBcImJyaWdodG5lc3NcIikge1xuICAgICAgICAgIHZhbHVlICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5hbWUgPT0gXCJjb250cmFzdFwiKSB7XG4gICAgICAgICAgdmFsdWUgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJpdmF0ZXMuZmlsdGVyLmdldChuYW1lKSAhPSB2YWx1ZSkge1xuICAgICAgICAgIHByaXZhdGVzLmZpbHRlci5zZXQobmFtZSwgdmFsdWUpO1xuICAgICAgICAgIGxldCBmaWx0ZXIgPSBbXTtcbiAgICAgICAgICBwcml2YXRlcy5maWx0ZXIuZm9yRWFjaCgodmFsdWUsIGtleSwgb2JqZWN0KSA9PiB7XG4gICAgICAgICAgICBmaWx0ZXIucHVzaChgJHtrZXl9KCR7dmFsdWV9KWApO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGZpbHRlciA9IGZpbHRlci5qb2luKFwiIFwiKTtcbiAgICAgICAgICBwcml2YXRlcy5jYW52YXMuc3R5bGUuZmlsdGVyID0gZmlsdGVyO1xuICAgICAgICAgIHByaXZhdGVzLmNhbnZhcy5zdHlsZS53ZWJraXRGaWx0ZXIgPSBmaWx0ZXI7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBwcml2YXRlcy5maWx0ZXIuZ2V0KG5hbWUpO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBEcmF3IGFuIGltYWdlIG9uIHRoZSBjYW52YXNcbiAgICAgKiBhcmd1bWVudHMgc2FtZSBhcyBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpXG4gICAgICovXG4gICAgZHJhd0ltYWdlICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgcHJpdmF0ZXMuY29udGV4dC5nbG9iYWxBbHBoYSA9IHRoaXMuYWxwaGE7XG4gICAgICBwcml2YXRlcy5jb250ZXh0LmRyYXdJbWFnZS5hcHBseShwcml2YXRlcy5jb250ZXh0LCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIHJlbGVhc2UgKCkge1xuICAgICAgLy8gbm90aGluZ1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBldmVyeXRoaW5nIG9uIGNhbnZhcyBidXQgYSBzaW5nbGUgY29sb3JcbiAgICAgKi9cbiAgICBjbGVhciAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHByaXZhdGVzLmNvbnRleHQuZmlsbFN0eWxlID0gcHJpdmF0ZXMuY29sb3I7XG4gICAgICBwcml2YXRlcy5jb250ZXh0LmZpbGxSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBjb2xvciwgZWcgXCIjMDBmZjAwXCJcbiAgICAgKi9cbiAgICBnZXQgY29sb3IgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmNvbG9yO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgVGhlIG5ldyBjb2xvciwgZWcgXCIjMDBmZjAwXCJcbiAgICAgKi9cbiAgICBzZXQgY29sb3IgKHZhbHVlKSB7XG4gICAgICBpZiAodmFsdWUubWF0Y2goL14jKFtcXGRhLWZBLUZdW1xcZGEtZkEtRl0pKFtcXGRhLWZBLUZdW1xcZGEtZkEtRl0pKFtcXGRhLWZBLUZdW1xcZGEtZkEtRl0pJC8pKSB7XG4gICAgICAgIGludGVybmFsKHRoaXMpLmNvbG9yID0gdmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKHZhbHVlLCB0aGlzKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLkNhbnZhcyBpbnZhbGlkIGNvbG9yIHZhbHVlXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFscGhhLCAwIHRvIDFcbiAgICAgKi9cbiAgICBnZXQgYWxwaGEgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmFscGhhO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIG5ldyBhbHBoYSBudW1iZXJcbiAgICAgKi9cbiAgICBzZXQgYWxwaGEgKHZhbHVlKSB7XG4gICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKHZhbHVlKSAmJlxuICAgICAgICB2YWx1ZSA+PSAwICYmXG4gICAgICAgIHZhbHVlIDw9IDFcbiAgICAgICkge1xuICAgICAgICBpbnRlcm5hbCh0aGlzKS5hbHBoYSA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5DYW52YXMgZ290IGludmFsaWQgYWxwaGEgbnVtYmVyXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gV2lkdGggb2YgY2FudmFzXG4gICAgICovXG4gICAgZ2V0IHdpZHRoICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5jYW52YXMud2lkdGg7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBOZXcgd2lkdGhcbiAgICAgKi9cbiAgICBzZXQgd2lkdGggKHZhbHVlKSB7XG4gICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKHZhbHVlKSAmJlxuICAgICAgICB2YWx1ZSA+IDAgJiZcbiAgICAgICAgdmFsdWUgPCAxMDAwMFxuICAgICAgKSB7XG4gICAgICAgIGludGVybmFsKHRoaXMpLmNhbnZhcy53aWR0aCA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5DYW52YXMgZ290IGludmFsaWQgd2lkdGggbnVtYmVyXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gSGVpZ2h0IG9mIGNhbnZhc1xuICAgICAqL1xuICAgIGdldCBoZWlnaHQgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmNhbnZhcy5oZWlnaHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBOZXcgaGVpZ2h0XG4gICAgICovXG4gICAgc2V0IGhlaWdodCAodmFsdWUpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkgJiZcbiAgICAgICAgdmFsdWUgPiAwICYmXG4gICAgICAgIHZhbHVlIDwgMTAwMDBcbiAgICAgICkge1xuICAgICAgICBpZiAodmFsdWUgIT0gcHJpdmF0ZXMuY2FudmFzLmhlaWdodCkge1xuICAgICAgICAgIHByaXZhdGVzLmNhbnZhcy5oZWlnaHQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5DYW52YXMgZ290IGludmFsaWQgaGVpZ2h0IG51bWJlclwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybiB7T2JqZWN0fSBDYW52YXNcbiAgICAgKi9cbiAgICBnZXQgY2FudmFzICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5jYW52YXM7XG4gICAgfVxuXG4gICAgc2V0IGNhbnZhcyAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5DYW52YXMuY2FudmFzIGNhbm5vdCB3cml0ZVwiKTtcbiAgICB9XG5cbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Define the Sprite.Webgl, a renderer, other choice from Sprite.Canvas
 * @author mail@qhduan.com (QH Duan)
 */
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  function isPOT(value) {
    return value > 0 && (value - 1 & value) === 0;
  }

  /**
    Use mediump precision in WebGL when possible
    Highp in fragment shaders is an optional part of the OpenGL ES 2.0 spec,
    so not all hardware supports it
    lowp mediump highp
    https://developers.google.com/web/updates/2011/12/Use-mediump-precision-in-WebGL-when-possible?hl=en
     brightness and contrast's formular from https://github.com/evanw/glfx.js
  */
  var vertexShaderSrc = "\n  precision mediump float;\n  attribute vec2 a_texCoord;\n  varying vec2 v_texCoord;\n\n  attribute vec2 aVertex;\n  uniform vec2 resolution;\n\n  uniform vec4 position;\n\n  void main(void) {\n     vec2 a = aVertex * (position.zw / resolution) + (position.xy / resolution);\n     vec2 b = a * 2.0 - 1.0;\n\n     gl_Position = vec4(b * vec2(1.0, -1.0), 0.0, 1.0);\n     v_texCoord = a_texCoord;\n  }";

  var fragmentShaderSrc = "\n  precision mediump float;\n\n  uniform vec4 crop;\n  uniform float brightness;\n  uniform float alpha;\n  uniform float contrast;\n\n  uniform sampler2D image;\n\n  // the texCoords passed in from the vertex shader.\n  varying vec2 v_texCoord;\n\n  void main(void) {\n\n    vec2 t = v_texCoord;\n    t.x *= crop.z;\n    t.y *= crop.w;\n    t += crop.xy;\n\n     vec4 color = texture2D(image, t).rgba;\n\n     if (contrast != 0.0) {\n       if (contrast > 0.0) {\n         color.xyz = (color.xyz - 0.5) / (1.0 - contrast) + 0.5;\n       } else {\n         color.xyz = (color.xyz - 0.5) * (1.0 + contrast) + 0.5;\n       }\n     }\n\n     if (brightness != 0.0) {\n       color.xyz += brightness;\n     }\n\n     if (alpha != 1.0) {\n       color.a *=  alpha;\n     }\n\n     gl_FragColor = color;\n  }";

  /**
   * Renderer using webgl
   * @class
   */
  Sprite.assign("Webgl", (function () {
    _createClass(SpriteWebgl, null, [{
      key: "support",

      /**
       * @static
       * @return {boolean} The browser whether or not support WebGL
       */
      value: function support() {
        var canvas = document.createElement("canvas");
        var gl = canvas.getContext("webgl");
        if (!gl) {
          canvas.getContext("experimental-webgl");
        }
        if (!gl) {
          return false;
        }
        return true;
      }

      /**
       * Construct a renderer width certain width and height
       * @constructor
       */
    }]);

    function SpriteWebgl(width, height) {
      _classCallCheck(this, SpriteWebgl);

      var privates = internal(this);

      var canvas = document.createElement("canvas");
      canvas.width = width || 640;
      canvas.height = height || 480;

      var options = {
        antialias: false,
        preserveDrawingBuffer: true
      };

      var gl = canvas.getContext("webgl", options);
      if (!gl) {
        gl = canvas.getContext("experimental-webgl", options);
      }
      privates.gl = gl;

      if (!gl) {
        throw new Error("Sprite.Webgl webgl is not supported");
      }

      privates.color = [0, 0, 0];
      privates.filter = new Map();
      privates.textureCache = new Map();
      privates.canvas = canvas;
      privates.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);

      gl.viewport(0, 0, canvas.width, canvas.height);

      var vertShaderObj = gl.createShader(gl.VERTEX_SHADER);
      var fragShaderObj = gl.createShader(gl.FRAGMENT_SHADER);
      gl.shaderSource(vertShaderObj, vertexShaderSrc);
      gl.shaderSource(fragShaderObj, fragmentShaderSrc);
      gl.compileShader(vertShaderObj);
      gl.compileShader(fragShaderObj);

      var program = gl.createProgram();
      gl.attachShader(program, vertShaderObj);
      gl.attachShader(program, fragShaderObj);

      gl.linkProgram(program);
      gl.useProgram(program);

      gl.cullFace(gl.BACK);
      gl.frontFace(gl.CW);
      gl.enable(gl.CULL_FACE);
      gl.enable(gl.BLEND);
      gl.disable(gl.DEPTH_TEST);
      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);

      privates.cropLoc = gl.getUniformLocation(program, "crop");
      privates.brightnessLoc = gl.getUniformLocation(program, "brightness");
      privates.contrastLoc = gl.getUniformLocation(program, "contrast");
      privates.alphaLoc = gl.getUniformLocation(program, "alpha");
      privates.resolutionLoc = gl.getUniformLocation(program, "resolution");
      gl.uniform2f(privates.resolutionLoc, canvas.width, canvas.height);

      privates.positionLoc = gl.getUniformLocation(program, "position");

      privates.tLoc = gl.getAttribLocation(program, "a_texCoord");
      gl.enableVertexAttribArray(privates.tLoc);
      privates.texCoordBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, privates.texCoordBuffer);
      gl.vertexAttribPointer(privates.tLoc, 2, gl.FLOAT, false, 0, 0);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 1, 0, 0, 1, 0, 1, 1]), gl.STATIC_DRAW);

      privates.vLoc = gl.getAttribLocation(program, "aVertex");
      gl.enableVertexAttribArray(privates.vLoc);
      privates.vertexBuff = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, privates.vertexBuff);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 1, 0, 0, 1, 0, 1, 1]), gl.STATIC_DRAW);
      gl.enableVertexAttribArray(privates.vLoc);
      gl.vertexAttribPointer(privates.vLoc, 2, gl.FLOAT, false, 0, 0);

      privates.currentTexture = null;

      // setting, don't move
      this.filter("brightness", 0);
      this.filter("contrast", 0);
      this.alpha = 1;

      console.log("webgl inited. max texture size: %d", gl.getParameter(gl.MAX_TEXTURE_SIZE));
    }

    _createClass(SpriteWebgl, [{
      key: "drawImage9",
      value: function drawImage9(image, sx, sy, sw, sh, dx, dy, dw, dh) {
        var privates = internal(this);
        var gl = privates.gl;

        var texture = this.createTexture(gl, image);
        if (privates.currentTexture != texture) {
          gl.bindTexture(gl.TEXTURE_2D, texture);
          privates.currentTexture = texture;
        }

        gl.uniform4f(privates.cropLoc, sx / image.width, sy / image.height, sw / image.width, sh / image.height);
        gl.uniform4f(privates.positionLoc, dx, dy, dw, dh);

        gl.drawArrays(gl.TRIANGLE_FAN, 0, 4);
      }
    }, {
      key: "release",
      value: function release() {
        var privates = internal(this);
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = privates.textureCache.values()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var texture = _step.value;

            privates.gl.deleteTexture(texture);
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator["return"]) {
              _iterator["return"]();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        privates.textureCache = new Map();
      }
    }, {
      key: "createTexture",
      value: function createTexture(gl, image) {
        var privates = internal(this);
        if (privates.textureCache.has(image)) {
          return privates.textureCache.get(image);
        } else {
          gl.activeTexture(gl.TEXTURE0);
          var texture = gl.createTexture();
          gl.bindTexture(gl.TEXTURE_2D, texture);
          gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);
          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
          gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);

          // test width&height is power of 2, eg. 256, 512, 1024
          // may speed up
          if (isPOT(image.width) && isPOT(image.height)) {
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);
            gl.generateMipmap(gl.TEXTURE_2D);
          } else {
            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
          }

          gl.bindTexture(gl.TEXTURE_2D, null);
          privates.textureCache.set(image, texture);
          return texture;
        }
      }
    }, {
      key: "drawImage",
      value: function drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh) {
        if (arguments.length == 9) {
          // all right
        } else if (arguments.length == 5) {
            // drawImage (image, dx, dy, dw, dh);
            dx = sx;
            dy = sy;
            dw = sw;
            dh = sh;
            sx = 0;
            sy = 0;
            sw = image.width;
            sh = image.height;
          } else if (arguments.length == 3) {
            // drawImage (image, dx, dy);
            dx = sx;
            dy = sy;
            dw = image.width;
            dh = image.height;
            sx = 0;
            sy = 0;
            sw = image.width;
            sh = image.height;
          } else {
            console.error(arguments, this);
            throw new Error("Sprite.Webgl.drawImage invalid arguments");
          }

        /*
        if (dx > this.width || dy > this.height) {
          return;
        }
         if ((dx + dw) < 0 || (dy + dh) < 0) {
          return;
        }
         if (
          !Number.isInteger(image.width) ||
          !Number.isInteger(image.height) ||
          image.width <= 0 ||
          image.height <= 0 ||
          image.width > privates.maxTextureSize ||
          image.height > privates.maxTextureSize
        ) {
          console.error(image, privates, this);
          throw new Error("Sprite.Webgl.drawImage invalid image");
        }
        */

        this.drawImage9(image, sx, sy, sw, sh, dx, dy, dw, dh);
      }
    }, {
      key: "filter",

      /**
       * @param {string} name The name of filter you want get or set
       * @param {number} value Number or undefined, if undefined ,return current value
       */
      value: function filter(name, value) {
        var privates = internal(this);
        var gl = privates.gl;
        if (Number.isFinite(value)) {
          privates.filter.set(name, value);
          gl.uniform1f(privates.brightnessLoc, privates.filter.get("brightness"));
          gl.uniform1f(privates.contrastLoc, privates.filter.get("contrast"));
        } else {
          return privates.get(name);
        }
      }
    }, {
      key: "clear",
      value: function clear() {
        var privates = internal(this);
        var gl = privates.gl;
        var color = privates.color;
        gl.clearColor(color[0], color[1], color[2], 1); // black
        gl.clear(gl.COLOR_BUFFER_BIT);
      }
    }, {
      key: "alpha",
      get: function get() {
        var privates = internal(this);
        return privates.alpha;
      },
      set: function set(value) {
        var privates = internal(this);
        var gl = privates.gl;
        if (Number.isFinite(value) && !isNaN(value) && value >= 0 && value <= 1) {
          if (value != privates.alpha) {
            privates.alpha = value;
            gl.uniform1f(privates.alphaLoc, privates.alpha);
          }
        } else {
          console.error(value, this);
          throw new Error("Sprite.Webgl got invalid alpha number");
        }
      }

      /**
       * @return {string} The color, eg "#00ff00"
       */
    }, {
      key: "color",
      get: function get() {
        var privates = internal(this);
        var color = privates.color;
        var r = color[0].toString(16);
        var g = color[1].toString(16);
        var b = color[2].toString(16);
        if (r.length < 2) r = "0" + r;
        if (g.length < 2) g = "0" + g;
        if (b.length < 2) b = "0" + b;
        return "#" + r + g + b;
      },

      /**
       * @param {string} value The new color, eg "#00ff00"
       */
      set: function set(value) {
        var privates = internal(this);
        var m = value.match(/^#([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])$/);
        if (m) {
          var r = m[1];
          var g = m[2];
          var b = m[3];
          privates.color[0] = parseInt(r, 16);
          privates.color[1] = parseInt(g, 16);
          privates.color[2] = parseInt(b, 16);
        } else {
          console.error(value, this);
          throw new Error("Sprite.Webgl.color invalid color format");
        }
      }
    }, {
      key: "width",
      get: function get() {
        var privates = internal(this);
        return privates.canvas.width;
      },
      set: function set(value) {
        var privates = internal(this);
        if (Number.isFinite(value) && !isNaN(value) && value > 0 && value <= 4096) {
          if (value != privates.canvas.width) {
            privates.canvas.width = value;
            privates.gl.viewport(0, 0, privates.canvas.width, privates.canvas.height);
            privates.gl.uniform2f(privates.resolutionLoc, privates.canvas.width, privates.canvas.height);
          }
        } else {
          console.error(value, this);
          throw new Error("Sprite.Webgl got invalid width number");
        }
      }
    }, {
      key: "height",
      get: function get() {
        var privates = internal(this);
        return privates.canvas.height;
      },
      set: function set(value) {
        var privates = internal(this);
        if (Number.isFinite(value) && !isNaN(value) && value > 0 && value <= 4096) {
          if (value != privates.canvas.height) {
            privates.canvas.height = value;
            privates.gl.viewport(0, 0, privates.canvas.width, privates.canvas.height);
            privates.gl.uniform2f(resolutionLoc, privates.canvas.width, privates.canvas.height);
          }
        } else {
          console.error(value, this);
          throw new Error("Sprite.Webgl got invalid height number");
        }
      }
    }, {
      key: "canvas",
      get: function get() {
        return internal(this).canvas;
      },
      set: function set(value) {
        console.error(value, this);
        throw new Error("Sprite.Webgl.canvas cannot write");
      }
    }]);

    return SpriteWebgl;
  })());
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlV2ViZ2wuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0JBLENBQUMsWUFBWTtBQUNaLGNBQVksQ0FBQzs7QUFFWixNQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7O0FBR2xDLFdBQVMsS0FBSyxDQUFFLEtBQUssRUFBRTtBQUNyQixXQUFPLEtBQUssR0FBRyxDQUFDLElBQUksQ0FBQyxBQUFDLEtBQUssR0FBRyxDQUFDLEdBQUksS0FBSyxDQUFBLEtBQU0sQ0FBQyxDQUFDO0dBQ2pEOzs7Ozs7Ozs7O0FBV0QsTUFBSSxlQUFlLHNaQWdCakIsQ0FBQzs7QUFFSCxNQUFJLGlCQUFpQix3eUJBdUNuQixDQUFDOzs7Ozs7QUFNSCxRQUFNLENBQUMsTUFBTSxDQUFDLE9BQU87aUJBQVEsV0FBVzs7Ozs7OzthQU12QixtQkFBRztBQUNoQixZQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzlDLFlBQUksRUFBRSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDcEMsWUFBSSxDQUFDLEVBQUUsRUFBRTtBQUNQLGdCQUFNLENBQUMsVUFBVSxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDekM7QUFDRCxZQUFJLENBQUMsRUFBRSxFQUFFO0FBQ1AsaUJBQU8sS0FBSyxDQUFDO1NBQ2Q7QUFDRCxlQUFPLElBQUksQ0FBQztPQUNiOzs7Ozs7OztBQU1XLGFBdEJlLFdBQVcsQ0FzQnpCLEtBQUssRUFBRSxNQUFNLEVBQUU7NEJBdEJELFdBQVc7O0FBdUJwQyxVQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7O0FBRTlCLFVBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDOUMsWUFBTSxDQUFDLEtBQUss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QUFDLE1BQU0sQ0FBQyxDQUFDO1dBQ3JGO1NBQ0YsTUFBTTtBQUNMLGlCQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztBQUMzQixnQkFBTSxJQUFJLEtBQUssQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1NBQzNEO09BQ0Y7OztXQUVVLGVBQUc7QUFDWixlQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUM7T0FDOUI7V0FFVSxhQUFDLEtBQUssRUFBRTtBQUNqQixlQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztBQUMzQixjQUFNLElBQUksS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7T0FDckQ7OztXQW5YMEIsV0FBVztPQXFYdEMsQ0FBQztDQUlKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IlNwcml0ZVdlYmdsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuMkQgR2FtZSBTcHJpdGUgTGlicmFyeSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IERlZmluZSB0aGUgU3ByaXRlLldlYmdsLCBhIHJlbmRlcmVyLCBvdGhlciBjaG9pY2UgZnJvbSBTcHJpdGUuQ2FudmFzXG4gKiBAYXV0aG9yIG1haWxAcWhkdWFuLmNvbSAoUUggRHVhbilcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgaW50ZXJuYWwgPSBTcHJpdGUuTmFtZXNwYWNlKCk7XG5cblxuICBmdW5jdGlvbiBpc1BPVCAodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgPiAwICYmICgodmFsdWUgLSAxKSAmIHZhbHVlKSA9PT0gMDtcbiAgfVxuXG4gIC8qKlxuICAgIFVzZSBtZWRpdW1wIHByZWNpc2lvbiBpbiBXZWJHTCB3aGVuIHBvc3NpYmxlXG4gICAgSGlnaHAgaW4gZnJhZ21lbnQgc2hhZGVycyBpcyBhbiBvcHRpb25hbCBwYXJ0IG9mIHRoZSBPcGVuR0wgRVMgMi4wIHNwZWMsXG4gICAgc28gbm90IGFsbCBoYXJkd2FyZSBzdXBwb3J0cyBpdFxuICAgIGxvd3AgbWVkaXVtcCBoaWdocFxuICAgIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL3dlYi91cGRhdGVzLzIwMTEvMTIvVXNlLW1lZGl1bXAtcHJlY2lzaW9uLWluLVdlYkdMLXdoZW4tcG9zc2libGU/aGw9ZW5cblxuICAgIGJyaWdodG5lc3MgYW5kIGNvbnRyYXN0J3MgZm9ybXVsYXIgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZXZhbncvZ2xmeC5qc1xuICAqL1xuICBsZXQgdmVydGV4U2hhZGVyU3JjID0gYFxuICBwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDtcbiAgYXR0cmlidXRlIHZlYzIgYV90ZXhDb29yZDtcbiAgdmFyeWluZyB2ZWMyIHZfdGV4Q29vcmQ7XG5cbiAgYXR0cmlidXRlIHZlYzIgYVZlcnRleDtcbiAgdW5pZm9ybSB2ZWMyIHJlc29sdXRpb247XG5cbiAgdW5pZm9ybSB2ZWM0IHBvc2l0aW9uO1xuXG4gIHZvaWQgbWFpbih2b2lkKSB7XG4gICAgIHZlYzIgYSA9IGFWZXJ0ZXggKiAocG9zaXRpb24uencgLyByZXNvbHV0aW9uKSArIChwb3NpdGlvbi54eSAvIHJlc29sdXRpb24pO1xuICAgICB2ZWMyIGIgPSBhICogMi4wIC0gMS4wO1xuXG4gICAgIGdsX1Bvc2l0aW9uID0gdmVjNChiICogdmVjMigxLjAsIC0xLjApLCAwLjAsIDEuMCk7XG4gICAgIHZfdGV4Q29vcmQgPSBhX3RleENvb3JkO1xuICB9YDtcblxuICBsZXQgZnJhZ21lbnRTaGFkZXJTcmMgPSBgXG4gIHByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xuXG4gIHVuaWZvcm0gdmVjNCBjcm9wO1xuICB1bmlmb3JtIGZsb2F0IGJyaWdodG5lc3M7XG4gIHVuaWZvcm0gZmxvYXQgYWxwaGE7XG4gIHVuaWZvcm0gZmxvYXQgY29udHJhc3Q7XG5cbiAgdW5pZm9ybSBzYW1wbGVyMkQgaW1hZ2U7XG5cbiAgLy8gdGhlIHRleENvb3JkcyBwYXNzZWQgaW4gZnJvbSB0aGUgdmVydGV4IHNoYWRlci5cbiAgdmFyeWluZyB2ZWMyIHZfdGV4Q29vcmQ7XG5cbiAgdm9pZCBtYWluKHZvaWQpIHtcblxuICAgIHZlYzIgdCA9IHZfdGV4Q29vcmQ7XG4gICAgdC54ICo9IGNyb3AuejtcbiAgICB0LnkgKj0gY3JvcC53O1xuICAgIHQgKz0gY3JvcC54eTtcblxuICAgICB2ZWM0IGNvbG9yID0gdGV4dHVyZTJEKGltYWdlLCB0KS5yZ2JhO1xuXG4gICAgIGlmIChjb250cmFzdCAhPSAwLjApIHtcbiAgICAgICBpZiAoY29udHJhc3QgPiAwLjApIHtcbiAgICAgICAgIGNvbG9yLnh5eiA9IChjb2xvci54eXogLSAwLjUpIC8gKDEuMCAtIGNvbnRyYXN0KSArIDAuNTtcbiAgICAgICB9IGVsc2Uge1xuICAgICAgICAgY29sb3IueHl6ID0gKGNvbG9yLnh5eiAtIDAuNSkgKiAoMS4wICsgY29udHJhc3QpICsgMC41O1xuICAgICAgIH1cbiAgICAgfVxuXG4gICAgIGlmIChicmlnaHRuZXNzICE9IDAuMCkge1xuICAgICAgIGNvbG9yLnh5eiArPSBicmlnaHRuZXNzO1xuICAgICB9XG5cbiAgICAgaWYgKGFscGhhICE9IDEuMCkge1xuICAgICAgIGNvbG9yLmEgKj0gIGFscGhhO1xuICAgICB9XG5cbiAgICAgZ2xfRnJhZ0NvbG9yID0gY29sb3I7XG4gIH1gO1xuXG4gIC8qKlxuICAgKiBSZW5kZXJlciB1c2luZyB3ZWJnbFxuICAgKiBAY2xhc3NcbiAgICovXG4gIFNwcml0ZS5hc3NpZ24oXCJXZWJnbFwiLCBjbGFzcyBTcHJpdGVXZWJnbCB7XG5cbiAgICAvKipcbiAgICAgKiBAc3RhdGljXG4gICAgICogQHJldHVybiB7Ym9vbGVhbn0gVGhlIGJyb3dzZXIgd2hldGhlciBvciBub3Qgc3VwcG9ydCBXZWJHTFxuICAgICAqL1xuICAgIHN0YXRpYyBzdXBwb3J0ICgpIHtcbiAgICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgbGV0IGdsID0gY2FudmFzLmdldENvbnRleHQoXCJ3ZWJnbFwiKTtcbiAgICAgIGlmICghZ2wpIHtcbiAgICAgICAgY2FudmFzLmdldENvbnRleHQoXCJleHBlcmltZW50YWwtd2ViZ2xcIik7XG4gICAgICB9XG4gICAgICBpZiAoIWdsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdCBhIHJlbmRlcmVyIHdpZHRoIGNlcnRhaW4gd2lkdGggYW5kIGhlaWdodFxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yICh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcblxuICAgICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICBjYW52YXMud2lkdGggPSB3aWR0aCB8fCA2NDA7XG4gICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0IHx8IDQ4MDtcblxuICAgICAgbGV0IG9wdGlvbnMgPSB7XG4gICAgICAgIGFudGlhbGlhczogZmFsc2UsXG4gICAgICAgIHByZXNlcnZlRHJhd2luZ0J1ZmZlcjogdHJ1ZVxuICAgICAgfTtcblxuICAgICAgbGV0IGdsID0gY2FudmFzLmdldENvbnRleHQoXCJ3ZWJnbFwiLCBvcHRpb25zKTtcbiAgICAgIGlmICghZ2wpIHtcbiAgICAgICAgZ2wgPSBjYW52YXMuZ2V0Q29udGV4dChcImV4cGVyaW1lbnRhbC13ZWJnbFwiLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIHByaXZhdGVzLmdsID0gZ2w7XG5cbiAgICAgIGlmICghZ2wpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLldlYmdsIHdlYmdsIGlzIG5vdCBzdXBwb3J0ZWRcIik7XG4gICAgICB9XG5cbiAgICAgIHByaXZhdGVzLmNvbG9yID0gWzAsIDAsIDBdO1xuICAgICAgcHJpdmF0ZXMuZmlsdGVyID0gbmV3IE1hcCgpO1xuICAgICAgcHJpdmF0ZXMudGV4dHVyZUNhY2hlID0gbmV3IE1hcCgpO1xuICAgICAgcHJpdmF0ZXMuY2FudmFzID0gY2FudmFzO1xuICAgICAgcHJpdmF0ZXMubWF4VGV4dHVyZVNpemUgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuTUFYX1RFWFRVUkVfU0laRSk7XG5cbiAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cbiAgICAgIGxldCB2ZXJ0U2hhZGVyT2JqID0gZ2wuY3JlYXRlU2hhZGVyKGdsLlZFUlRFWF9TSEFERVIpO1xuICAgICAgbGV0IGZyYWdTaGFkZXJPYmogPSBnbC5jcmVhdGVTaGFkZXIoZ2wuRlJBR01FTlRfU0hBREVSKTtcbiAgICAgIGdsLnNoYWRlclNvdXJjZSh2ZXJ0U2hhZGVyT2JqLCB2ZXJ0ZXhTaGFkZXJTcmMpO1xuICAgICAgZ2wuc2hhZGVyU291cmNlKGZyYWdTaGFkZXJPYmosIGZyYWdtZW50U2hhZGVyU3JjKTtcbiAgICAgIGdsLmNvbXBpbGVTaGFkZXIodmVydFNoYWRlck9iaik7XG4gICAgICBnbC5jb21waWxlU2hhZGVyKGZyYWdTaGFkZXJPYmopO1xuXG4gICAgICBsZXQgcHJvZ3JhbSA9IGdsLmNyZWF0ZVByb2dyYW0oKTtcbiAgICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCB2ZXJ0U2hhZGVyT2JqKTtcbiAgICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCBmcmFnU2hhZGVyT2JqKTtcblxuICAgICAgZ2wubGlua1Byb2dyYW0ocHJvZ3JhbSk7XG4gICAgICBnbC51c2VQcm9ncmFtKHByb2dyYW0pO1xuXG4gICAgICBnbC5jdWxsRmFjZShnbC5CQUNLKTtcbiAgICAgIGdsLmZyb250RmFjZShnbC5DVyk7XG4gICAgICBnbC5lbmFibGUoZ2wuQ1VMTF9GQUNFKTtcbiAgICAgIGdsLmVuYWJsZShnbC5CTEVORCk7XG4gICAgICBnbC5kaXNhYmxlKGdsLkRFUFRIX1RFU1QpO1xuICAgICAgZ2wuYmxlbmRGdW5jKGdsLlNSQ19BTFBIQSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSk7XG5cbiAgICAgIHByaXZhdGVzLmNyb3BMb2MgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgXCJjcm9wXCIpO1xuICAgICAgcHJpdmF0ZXMuYnJpZ2h0bmVzc0xvYyA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBcImJyaWdodG5lc3NcIik7XG4gICAgICBwcml2YXRlcy5jb250cmFzdExvYyA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBcImNvbnRyYXN0XCIpO1xuICAgICAgcHJpdmF0ZXMuYWxwaGFMb2MgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgXCJhbHBoYVwiKTtcbiAgICAgIHByaXZhdGVzLnJlc29sdXRpb25Mb2MgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgXCJyZXNvbHV0aW9uXCIpO1xuICAgICAgZ2wudW5pZm9ybTJmKHByaXZhdGVzLnJlc29sdXRpb25Mb2MsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cbiAgICAgIHByaXZhdGVzLnBvc2l0aW9uTG9jID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sIFwicG9zaXRpb25cIik7XG5cblxuICAgICAgcHJpdmF0ZXMudExvYyA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIFwiYV90ZXhDb29yZFwiKTtcbiAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHByaXZhdGVzLnRMb2MpO1xuICAgICAgcHJpdmF0ZXMudGV4Q29vcmRCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcbiAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBwcml2YXRlcy50ZXhDb29yZEJ1ZmZlcik7XG4gICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHByaXZhdGVzLnRMb2MsIDIsIGdsLkZMT0FULCBmYWxzZSwgMCwgMCk7XG4gICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUixcbiAgICAgICAgbmV3IEZsb2F0MzJBcnJheShcbiAgICAgICAgICBbXG4gICAgICAgICAgICAwLCAxLFxuICAgICAgICAgICAgMCwgMCxcbiAgICAgICAgICAgIDEsIDAsXG4gICAgICAgICAgICAxLCAxXG4gICAgICAgICAgXVxuICAgICAgICApLFxuICAgICAgICBnbC5TVEFUSUNfRFJBV1xuICAgICAgKTtcblxuICAgICAgcHJpdmF0ZXMudkxvYyA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIFwiYVZlcnRleFwiKTtcbiAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHByaXZhdGVzLnZMb2MpO1xuICAgICAgcHJpdmF0ZXMudmVydGV4QnVmZiA9IGdsLmNyZWF0ZUJ1ZmZlcigpO1xuICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHByaXZhdGVzLnZlcnRleEJ1ZmYpO1xuICAgICAgZ2wuYnVmZmVyRGF0YShcbiAgICAgICAgZ2wuQVJSQVlfQlVGRkVSLFxuICAgICAgICBuZXcgRmxvYXQzMkFycmF5KFtcbiAgICAgICAgICAwLCAxLFxuICAgICAgICAgIDAsIDAsXG4gICAgICAgICAgMSwgMCxcbiAgICAgICAgICAxLCAxXG4gICAgICAgIF0pLFxuICAgICAgICBnbC5TVEFUSUNfRFJBV1xuICAgICAgKTtcbiAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHByaXZhdGVzLnZMb2MpO1xuICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihwcml2YXRlcy52TG9jLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDAsIDApO1xuXG4gICAgICBwcml2YXRlcy5jdXJyZW50VGV4dHVyZSA9IG51bGw7XG5cbiAgICAgIC8vIHNldHRpbmcsIGRvbid0IG1vdmVcbiAgICAgIHRoaXMuZmlsdGVyKFwiYnJpZ2h0bmVzc1wiLCAwKTtcbiAgICAgIHRoaXMuZmlsdGVyKFwiY29udHJhc3RcIiwgMCk7XG4gICAgICB0aGlzLmFscGhhID0gMTtcblxuICAgICAgY29uc29sZS5sb2coXCJ3ZWJnbCBpbml0ZWQuIG1heCB0ZXh0dXJlIHNpemU6ICVkXCIsXG4gICAgICAgIGdsLmdldFBhcmFtZXRlcihnbC5NQVhfVEVYVFVSRV9TSVpFKSk7XG4gICAgfVxuXG4gICAgZHJhd0ltYWdlOSAoaW1hZ2UsIHN4LCBzeSwgc3csIHNoLCBkeCwgZHksIGR3LCBkaCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBsZXQgZ2wgPSBwcml2YXRlcy5nbDtcblxuICAgICAgbGV0IHRleHR1cmUgPSB0aGlzLmNyZWF0ZVRleHR1cmUoZ2wsIGltYWdlKTtcbiAgICAgIGlmIChwcml2YXRlcy5jdXJyZW50VGV4dHVyZSAhPSB0ZXh0dXJlKSB7XG4gICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRleHR1cmUpO1xuICAgICAgICBwcml2YXRlcy5jdXJyZW50VGV4dHVyZSA9IHRleHR1cmU7XG4gICAgICB9XG5cbiAgICAgIGdsLnVuaWZvcm00Zihwcml2YXRlcy5jcm9wTG9jLFxuICAgICAgICBzeC9pbWFnZS53aWR0aCwgc3kvaW1hZ2UuaGVpZ2h0LCBzdy9pbWFnZS53aWR0aCwgc2gvaW1hZ2UuaGVpZ2h0KTtcbiAgICAgIGdsLnVuaWZvcm00Zihwcml2YXRlcy5wb3NpdGlvbkxvYywgZHgsIGR5LCBkdywgZGgpO1xuXG4gICAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFX0ZBTiwgMCwgNCk7XG4gICAgfVxuXG4gICAgcmVsZWFzZSAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGZvciAobGV0IHRleHR1cmUgb2YgcHJpdmF0ZXMudGV4dHVyZUNhY2hlLnZhbHVlcygpKSB7XG4gICAgICAgIHByaXZhdGVzLmdsLmRlbGV0ZVRleHR1cmUodGV4dHVyZSk7XG4gICAgICB9XG4gICAgICBwcml2YXRlcy50ZXh0dXJlQ2FjaGUgPSBuZXcgTWFwKCk7XG4gICAgfVxuXG4gICAgY3JlYXRlVGV4dHVyZSAoZ2wsIGltYWdlKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmIChwcml2YXRlcy50ZXh0dXJlQ2FjaGUuaGFzKGltYWdlKSkge1xuICAgICAgICByZXR1cm4gcHJpdmF0ZXMudGV4dHVyZUNhY2hlLmdldChpbWFnZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcbiAgICAgICAgbGV0IHRleHR1cmUgPSBnbC5jcmVhdGVUZXh0dXJlKCk7XG4gICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRleHR1cmUpO1xuICAgICAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsICBnbC5SR0JBLCAgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgaW1hZ2UpO1xuICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5DTEFNUF9UT19FREdFKTtcbiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuQ0xBTVBfVE9fRURHRSk7XG4gICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5ORUFSRVNUKTtcblxuICAgICAgICAvLyB0ZXN0IHdpZHRoJmhlaWdodCBpcyBwb3dlciBvZiAyLCBlZy4gMjU2LCA1MTIsIDEwMjRcbiAgICAgICAgLy8gbWF5IHNwZWVkIHVwXG4gICAgICAgIGlmIChpc1BPVChpbWFnZS53aWR0aCkgJiYgaXNQT1QoaW1hZ2UuaGVpZ2h0KSkge1xuICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5MSU5FQVJfTUlQTUFQX0xJTkVBUik7XG4gICAgICAgICAgZ2wuZ2VuZXJhdGVNaXBtYXAoZ2wuVEVYVFVSRV8yRCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QpO1xuICAgICAgICB9XG5cbiAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgbnVsbCk7XG4gICAgICAgIHByaXZhdGVzLnRleHR1cmVDYWNoZS5zZXQoaW1hZ2UsIHRleHR1cmUpO1xuICAgICAgICByZXR1cm4gdGV4dHVyZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkcmF3SW1hZ2UgKGltYWdlLCBzeCwgc3ksIHN3LCBzaCwgZHgsIGR5LCBkdywgZGgpIHtcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDkpIHtcbiAgICAgICAgLy8gYWxsIHJpZ2h0XG4gICAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gNSkge1xuICAgICAgICAvLyBkcmF3SW1hZ2UgKGltYWdlLCBkeCwgZHksIGR3LCBkaCk7XG4gICAgICAgIGR4ID0gc3g7XG4gICAgICAgIGR5ID0gc3k7XG4gICAgICAgIGR3ID0gc3c7XG4gICAgICAgIGRoID0gc2g7XG4gICAgICAgIHN4ID0gMDtcbiAgICAgICAgc3kgPSAwO1xuICAgICAgICBzdyA9IGltYWdlLndpZHRoO1xuICAgICAgICBzaCA9IGltYWdlLmhlaWdodDtcbiAgICAgIH0gZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAzKSB7XG4gICAgICAgIC8vIGRyYXdJbWFnZSAoaW1hZ2UsIGR4LCBkeSk7XG4gICAgICAgIGR4ID0gc3g7XG4gICAgICAgIGR5ID0gc3k7XG4gICAgICAgIGR3ID0gaW1hZ2Uud2lkdGg7XG4gICAgICAgIGRoID0gaW1hZ2UuaGVpZ2h0O1xuICAgICAgICBzeCA9IDA7XG4gICAgICAgIHN5ID0gMDtcbiAgICAgICAgc3cgPSBpbWFnZS53aWR0aDtcbiAgICAgICAgc2ggPSBpbWFnZS5oZWlnaHQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKGFyZ3VtZW50cywgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5XZWJnbC5kcmF3SW1hZ2UgaW52YWxpZCBhcmd1bWVudHNcIik7XG4gICAgICB9XG5cbiAgICAgIC8qXG4gICAgICBpZiAoZHggPiB0aGlzLndpZHRoIHx8IGR5ID4gdGhpcy5oZWlnaHQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoKGR4ICsgZHcpIDwgMCB8fCAoZHkgKyBkaCkgPCAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICAhTnVtYmVyLmlzSW50ZWdlcihpbWFnZS53aWR0aCkgfHxcbiAgICAgICAgIU51bWJlci5pc0ludGVnZXIoaW1hZ2UuaGVpZ2h0KSB8fFxuICAgICAgICBpbWFnZS53aWR0aCA8PSAwIHx8XG4gICAgICAgIGltYWdlLmhlaWdodCA8PSAwIHx8XG4gICAgICAgIGltYWdlLndpZHRoID4gcHJpdmF0ZXMubWF4VGV4dHVyZVNpemUgfHxcbiAgICAgICAgaW1hZ2UuaGVpZ2h0ID4gcHJpdmF0ZXMubWF4VGV4dHVyZVNpemVcbiAgICAgICkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGltYWdlLCBwcml2YXRlcywgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5XZWJnbC5kcmF3SW1hZ2UgaW52YWxpZCBpbWFnZVwiKTtcbiAgICAgIH1cbiAgICAgICovXG5cbiAgICAgIHRoaXMuZHJhd0ltYWdlOShpbWFnZSwgc3gsIHN5LCBzdywgc2gsIGR4LCBkeSwgZHcsIGRoKTtcbiAgICB9XG5cbiAgICBnZXQgYWxwaGEgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICByZXR1cm4gcHJpdmF0ZXMuYWxwaGE7XG4gICAgfVxuXG4gICAgc2V0IGFscGhhICh2YWx1ZSkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBsZXQgZ2wgPSBwcml2YXRlcy5nbDtcbiAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUodmFsdWUpICYmXG4gICAgICAgICFpc05hTih2YWx1ZSkgJiZcbiAgICAgICAgdmFsdWUgPj0gMCAmJlxuICAgICAgICB2YWx1ZSA8PSAxXG4gICAgICApIHtcbiAgICAgICAgaWYgKHZhbHVlICE9IHByaXZhdGVzLmFscGhhKSB7XG4gICAgICAgICAgcHJpdmF0ZXMuYWxwaGEgPSB2YWx1ZTtcbiAgICAgICAgICBnbC51bmlmb3JtMWYocHJpdmF0ZXMuYWxwaGFMb2MsIHByaXZhdGVzLmFscGhhKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5XZWJnbCBnb3QgaW52YWxpZCBhbHBoYSBudW1iZXJcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgY29sb3IsIGVnIFwiIzAwZmYwMFwiXG4gICAgICovXG4gICAgZ2V0IGNvbG9yICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgbGV0IGNvbG9yID0gcHJpdmF0ZXMuY29sb3I7XG4gICAgICBsZXQgciA9IGNvbG9yWzBdLnRvU3RyaW5nKDE2KTtcbiAgICAgIGxldCBnID0gY29sb3JbMV0udG9TdHJpbmcoMTYpO1xuICAgICAgbGV0IGIgPSBjb2xvclsyXS50b1N0cmluZygxNik7XG4gICAgICBpZiAoci5sZW5ndGggPCAyKSByID0gXCIwXCIgKyByO1xuICAgICAgaWYgKGcubGVuZ3RoIDwgMikgZyA9IFwiMFwiICsgZztcbiAgICAgIGlmIChiLmxlbmd0aCA8IDIpIGIgPSBcIjBcIiArIGI7XG4gICAgICByZXR1cm4gXCIjXCIgKyByICsgZyArIGI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSBUaGUgbmV3IGNvbG9yLCBlZyBcIiMwMGZmMDBcIlxuICAgICAqL1xuICAgIHNldCBjb2xvciAodmFsdWUpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgbGV0IG0gPSB2YWx1ZS5tYXRjaCgvXiMoW1xcZGEtZkEtRl1bXFxkYS1mQS1GXSkoW1xcZGEtZkEtRl1bXFxkYS1mQS1GXSkoW1xcZGEtZkEtRl1bXFxkYS1mQS1GXSkkLyk7XG4gICAgICBpZiAobSkge1xuICAgICAgICBsZXQgciA9IG1bMV07XG4gICAgICAgIGxldCBnID0gbVsyXTtcbiAgICAgICAgbGV0IGIgPSBtWzNdO1xuICAgICAgICBwcml2YXRlcy5jb2xvclswXSA9IHBhcnNlSW50KHIsIDE2KTtcbiAgICAgICAgcHJpdmF0ZXMuY29sb3JbMV0gPSBwYXJzZUludChnLCAxNik7XG4gICAgICAgIHByaXZhdGVzLmNvbG9yWzJdID0gcGFyc2VJbnQoYiwgMTYpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5XZWJnbC5jb2xvciBpbnZhbGlkIGNvbG9yIGZvcm1hdFwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiBmaWx0ZXIgeW91IHdhbnQgZ2V0IG9yIHNldFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSBOdW1iZXIgb3IgdW5kZWZpbmVkLCBpZiB1bmRlZmluZWQgLHJldHVybiBjdXJyZW50IHZhbHVlXG4gICAgICovXG4gICAgZmlsdGVyIChuYW1lLCB2YWx1ZSkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBsZXQgZ2wgPSBwcml2YXRlcy5nbDtcbiAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUodmFsdWUpKSB7XG4gICAgICAgIHByaXZhdGVzLmZpbHRlci5zZXQobmFtZSwgdmFsdWUpO1xuICAgICAgICBnbC51bmlmb3JtMWYocHJpdmF0ZXMuYnJpZ2h0bmVzc0xvYywgcHJpdmF0ZXMuZmlsdGVyLmdldChcImJyaWdodG5lc3NcIikpO1xuICAgICAgICBnbC51bmlmb3JtMWYocHJpdmF0ZXMuY29udHJhc3RMb2MsIHByaXZhdGVzLmZpbHRlci5nZXQoXCJjb250cmFzdFwiKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcHJpdmF0ZXMuZ2V0KG5hbWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNsZWFyICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgbGV0IGdsID0gcHJpdmF0ZXMuZ2w7XG4gICAgICBsZXQgY29sb3IgPSBwcml2YXRlcy5jb2xvcjtcbiAgICAgIGdsLmNsZWFyQ29sb3IoY29sb3JbMF0sIGNvbG9yWzFdLCBjb2xvclsyXSwgMSk7IC8vIGJsYWNrXG4gICAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUKTtcbiAgICB9XG5cbiAgICBnZXQgd2lkdGggKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICByZXR1cm4gcHJpdmF0ZXMuY2FudmFzLndpZHRoO1xuICAgIH1cblxuICAgIHNldCB3aWR0aCAodmFsdWUpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkgJiZcbiAgICAgICAgIWlzTmFOKHZhbHVlKSAmJlxuICAgICAgICB2YWx1ZSA+IDAgJiZcbiAgICAgICAgdmFsdWUgPD0gNDA5NlxuICAgICAgKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPSBwcml2YXRlcy5jYW52YXMud2lkdGgpIHtcbiAgICAgICAgICBwcml2YXRlcy5jYW52YXMud2lkdGggPSB2YWx1ZTtcbiAgICAgICAgICBwcml2YXRlcy5nbC52aWV3cG9ydCgwLCAwLCBwcml2YXRlcy5jYW52YXMud2lkdGgsIHByaXZhdGVzLmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICAgIHByaXZhdGVzLmdsLnVuaWZvcm0yZihcbiAgICAgICAgICAgIHByaXZhdGVzLnJlc29sdXRpb25Mb2MsXG4gICAgICAgICAgICBwcml2YXRlcy5jYW52YXMud2lkdGgsXG4gICAgICAgICAgICBwcml2YXRlcy5jYW52YXMuaGVpZ2h0XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5XZWJnbCBnb3QgaW52YWxpZCB3aWR0aCBudW1iZXJcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGhlaWdodCAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHJldHVybiBwcml2YXRlcy5jYW52YXMuaGVpZ2h0O1xuICAgIH1cblxuICAgIHNldCBoZWlnaHQgKHZhbHVlKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUodmFsdWUpICYmXG4gICAgICAgICFpc05hTih2YWx1ZSkgJiZcbiAgICAgICAgdmFsdWUgPiAwICYmXG4gICAgICAgIHZhbHVlIDw9IDQwOTZcbiAgICAgICkge1xuICAgICAgICBpZiAodmFsdWUgIT0gcHJpdmF0ZXMuY2FudmFzLmhlaWdodCkge1xuICAgICAgICAgIHByaXZhdGVzLmNhbnZhcy5oZWlnaHQgPSB2YWx1ZTtcbiAgICAgICAgICBwcml2YXRlcy5nbC52aWV3cG9ydCgwLCAwLCBwcml2YXRlcy5jYW52YXMud2lkdGgsIHByaXZhdGVzLmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICAgIHByaXZhdGVzLmdsLnVuaWZvcm0yZihyZXNvbHV0aW9uTG9jLCBwcml2YXRlcy5jYW52YXMud2lkdGgsIHByaXZhdGVzLmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKHZhbHVlLCB0aGlzKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLldlYmdsIGdvdCBpbnZhbGlkIGhlaWdodCBudW1iZXJcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGNhbnZhcyAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuY2FudmFzO1xuICAgIH1cblxuICAgIHNldCBjYW52YXMgKHZhbHVlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKHZhbHVlLCB0aGlzKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5XZWJnbC5jYW52YXMgY2Fubm90IHdyaXRlXCIpO1xuICAgIH1cblxuICB9KTtcblxuXG5cbn0pKCk7XG4iXX0=

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Class Sprite.Event
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
   * Class Sprite.Event, hold all events emit, bubble
   * @class
   */
  Sprite.assign("Event", (function () {
    /**
     * construct Sprite.Event
     * @constructor
     */

    function SpriteEvent() {
      _classCallCheck(this, SpriteEvent);

      var privates = internal(this);
      /**
       * Contain all event and its' listeners
       @type {Object}
       @private
       */
      privates.listeners = new Map();
      /**
       * Contain an event is once or not
       * @type {Object}
       * @private
       */
      privates.once = new Map();
      /**
       * Parent of this object
       * @type {Object}
       */
      privates.parent = null;
    }

    /**
     * @return {Object} parent we hold, an object or null
     */

    _createClass(SpriteEvent, [{
      key: "on",

      /**
       * Register an event
       * @param {string} event The event type, eg. "click"
       * @param {function} listener The callback function when event fired
       */
      value: function on(event, listener) {
        var privates = internal(this);
        // If event is an once event, when some client register this event after event fired, we just return it
        if (privates.once.has(event)) {
          listener({
            type: event,
            target: this,
            data: privates.once.get(event)
          });
          return null;
        } else {
          if (privates.listeners.has(event) == false) {
            privates.listeners.set(event, new Map());
          }

          var id = Sprite.uuid();
          privates.listeners.get(event).set(id, listener);
          return id;
        }
      }

      /**
       * Remove an event Register
       * @param {string} event The event type you want to remove. eg. "click"
       * @param {string} id The id of event, the id is what returned by "on" function
       */
    }, {
      key: "off",
      value: function off(event, id) {
        var privates = internal(this);
        if (privates.listeners.has(event) && privates.listeners.get(event).has(id)) {
          privates.listeners.get(event)["delete"](id);
          if (privates.listeners.get(event).size <= 0) {
            privates.listeners["delete"](event);
          }
          return true;
        }
        return false;
      }

      /**
       * Fire an event from children
       * @param {string} event Event type
       * @param {Object} target Event target
       * @param {Object} data Data
       */
    }, {
      key: "emitBubble",
      value: function emitBubble(event, target, data) {
        var privates = internal(this);
        var bubble = true;

        if (privates.listeners.has(event)) {
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = privates.listeners.get(event).values()[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var listener = _step.value;

              if (listener({ type: event, target: target, data: data }) === false) {
                // If client return just "false", stop propagation
                bubble = false;
              }
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator["return"]) {
                _iterator["return"]();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }
        }

        if (privates.parent && bubble == true) {
          privates.parent.emitBubble(event, target, data);
        }
      }

      /**
       * Fire an event
       * @param {string} event The event type you want to fire
       * @param {boolean} once Whether or not the event is once, if true, the event fire should only once, like "complete"
       * @param {Object} data The data to listener, undefined or null is OK
       */
    }, {
      key: "emit",
      value: function emit(event, once, data) {
        var privates = internal(this);
        if (once) {
          if (typeof data != "undefined") {
            privates.once.set(event, data);
          } else {
            privates.once.set(event, null);
          }
        }

        // wheter or not bubble the event, default true
        var bubble = true;

        if (privates.listeners.has(event)) {
          var _iteratorNormalCompletion2 = true;
          var _didIteratorError2 = false;
          var _iteratorError2 = undefined;

          try {
            for (var _iterator2 = privates.listeners.get(event).values()[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              var listener = _step2.value;

              if (listener({ type: event, target: this, data: data }) === false) {
                // If client return just "false", stop propagation
                bubble = false;
              }
            }
          } catch (err) {
            _didIteratorError2 = true;
            _iteratorError2 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
                _iterator2["return"]();
              }
            } finally {
              if (_didIteratorError2) {
                throw _iteratorError2;
              }
            }
          }
        }

        if (privates.parent && bubble == true) {
          privates.parent.emitBubble(event, this, data);
        }
      }
    }, {
      key: "parent",
      get: function get() {
        var privates = internal(this);
        return privates.parent;
      },

      /**
       * Set parent of object
       * @param {Object} value New parent value, or null
       */
      set: function set(value) {
        var privates = internal(this);
        privates.parent = value;
      }
    }]);

    return SpriteEvent;
  })());
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlRXZlbnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQSxDQUFDLFlBQVk7QUFDWixjQUFZLENBQUM7O0FBRVosTUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDOzs7Ozs7QUFNbEMsUUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPOzs7Ozs7QUFLUCxhQUxlLFdBQVcsR0FLdkI7NEJBTFksV0FBVzs7QUFNcEMsVUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDOzs7Ozs7QUFNOUIsY0FBUSxDQUFDLFNBQVMsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDOzs7Ozs7QUFNL0IsY0FBUSxDQUFDLElBQUksR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDOzs7OztBQUsxQixjQUFRLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztLQUN4Qjs7Ozs7O2lCQXhCMEIsV0FBVzs7Ozs7Ozs7YUE2Q25DLFlBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRTtBQUNuQixZQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7O0FBRTlCLFlBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFDNUIsa0JBQVEsQ0FBQztBQUNQLGdCQUFJLEVBQUUsS0FBSztBQUNYLGtCQUFNLEVBQUUsSUFBSTtBQUNaLGdCQUFJLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO1dBQy9CLENBQUMsQ0FBQztBQUNILGlCQUFPLElBQUksQ0FBQztTQUNiLE1BQU07QUFDTCxjQUFJLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssRUFBRTtBQUMxQyxvQkFBUSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLElBQUks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QUFLLEVBQUU7O0FBRWpFLHNCQUFNLEdBQUcsS0FBSyxDQUFDO2VBQ2hCO2FBQ0Y7Ozs7Ozs7Ozs7Ozs7OztTQUNGOztBQUVELFlBQUksUUFBUSxDQUFDLE1BQU0sSUFBSSxNQUFNLElBQUksSUFBSSxFQUFFO0FBQ3JDLGtCQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQy9DO09BQ0Y7OztXQTNHVSxlQUFHO0FBQ1osWUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlCLGVBQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQztPQUN4Qjs7Ozs7O1dBS1UsYUFBQyxLQUFLLEVBQUU7QUFDakIsWUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlCLGdCQUFRLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztPQUN6Qjs7O1dBdkMwQixXQUFXO09Bd0l0QyxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiU3ByaXRlRXZlbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ2xhc3MgU3ByaXRlLkV2ZW50XG4gKiBAYXV0aG9yIG1haWxAcWhkdWFuLmNvbSAoUUggRHVhbilcbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCBpbnRlcm5hbCA9IFNwcml0ZS5OYW1lc3BhY2UoKTtcblxuICAvKipcbiAgICogQ2xhc3MgU3ByaXRlLkV2ZW50LCBob2xkIGFsbCBldmVudHMgZW1pdCwgYnViYmxlXG4gICAqIEBjbGFzc1xuICAgKi9cbiAgU3ByaXRlLmFzc2lnbihcIkV2ZW50XCIsIGNsYXNzIFNwcml0ZUV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBjb25zdHJ1Y3QgU3ByaXRlLkV2ZW50XG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICAvKipcbiAgICAgICAqIENvbnRhaW4gYWxsIGV2ZW50IGFuZCBpdHMnIGxpc3RlbmVyc1xuICAgICAgIEB0eXBlIHtPYmplY3R9XG4gICAgICAgQHByaXZhdGVcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMubGlzdGVuZXJzID0gbmV3IE1hcCgpO1xuICAgICAgLyoqXG4gICAgICAgKiBDb250YWluIGFuIGV2ZW50IGlzIG9uY2Ugb3Igbm90XG4gICAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAgICogQHByaXZhdGVcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMub25jZSA9IG5ldyBNYXAoKTtcbiAgICAgIC8qKlxuICAgICAgICogUGFyZW50IG9mIHRoaXMgb2JqZWN0XG4gICAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAgICovXG4gICAgICBwcml2YXRlcy5wYXJlbnQgPSBudWxsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IHBhcmVudCB3ZSBob2xkLCBhbiBvYmplY3Qgb3IgbnVsbFxuICAgICAqL1xuICAgIGdldCBwYXJlbnQgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICByZXR1cm4gcHJpdmF0ZXMucGFyZW50O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgcGFyZW50IG9mIG9iamVjdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZSBOZXcgcGFyZW50IHZhbHVlLCBvciBudWxsXG4gICAgICovXG4gICAgc2V0IHBhcmVudCAodmFsdWUpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgcHJpdmF0ZXMucGFyZW50ID0gdmFsdWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlZ2lzdGVyIGFuIGV2ZW50XG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGV2ZW50IFRoZSBldmVudCB0eXBlLCBlZy4gXCJjbGlja1wiXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gbGlzdGVuZXIgVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gZXZlbnQgZmlyZWRcbiAgICAgKi9cbiAgICBvbiAoZXZlbnQsIGxpc3RlbmVyKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIC8vIElmIGV2ZW50IGlzIGFuIG9uY2UgZXZlbnQsIHdoZW4gc29tZSBjbGllbnQgcmVnaXN0ZXIgdGhpcyBldmVudCBhZnRlciBldmVudCBmaXJlZCwgd2UganVzdCByZXR1cm4gaXRcbiAgICAgIGlmIChwcml2YXRlcy5vbmNlLmhhcyhldmVudCkpIHtcbiAgICAgICAgbGlzdGVuZXIoe1xuICAgICAgICAgIHR5cGU6IGV2ZW50LFxuICAgICAgICAgIHRhcmdldDogdGhpcyxcbiAgICAgICAgICBkYXRhOiBwcml2YXRlcy5vbmNlLmdldChldmVudClcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHByaXZhdGVzLmxpc3RlbmVycy5oYXMoZXZlbnQpID09IGZhbHNlKSB7XG4gICAgICAgICAgcHJpdmF0ZXMubGlzdGVuZXJzLnNldChldmVudCwgbmV3IE1hcCgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBpZCA9IFNwcml0ZS51dWlkKCk7XG4gICAgICAgIHByaXZhdGVzLmxpc3RlbmVycy5nZXQoZXZlbnQpLnNldChpZCwgbGlzdGVuZXIpO1xuICAgICAgICByZXR1cm4gaWQ7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhbiBldmVudCBSZWdpc3RlclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudCBUaGUgZXZlbnQgdHlwZSB5b3Ugd2FudCB0byByZW1vdmUuIGVnLiBcImNsaWNrXCJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaWQgVGhlIGlkIG9mIGV2ZW50LCB0aGUgaWQgaXMgd2hhdCByZXR1cm5lZCBieSBcIm9uXCIgZnVuY3Rpb25cbiAgICAgKi9cbiAgICBvZmYgKGV2ZW50LCBpZCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAocHJpdmF0ZXMubGlzdGVuZXJzLmhhcyhldmVudCkgJiYgcHJpdmF0ZXMubGlzdGVuZXJzLmdldChldmVudCkuaGFzKGlkKSkge1xuICAgICAgICBwcml2YXRlcy5saXN0ZW5lcnMuZ2V0KGV2ZW50KS5kZWxldGUoaWQpO1xuICAgICAgICBpZiAocHJpdmF0ZXMubGlzdGVuZXJzLmdldChldmVudCkuc2l6ZSA8PSAwKSB7XG4gICAgICAgICAgcHJpdmF0ZXMubGlzdGVuZXJzLmRlbGV0ZShldmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZpcmUgYW4gZXZlbnQgZnJvbSBjaGlsZHJlblxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudCBFdmVudCB0eXBlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBFdmVudCB0YXJnZXRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBEYXRhXG4gICAgICovXG4gICAgZW1pdEJ1YmJsZSAoZXZlbnQsIHRhcmdldCwgZGF0YSkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBsZXQgYnViYmxlID0gdHJ1ZTtcblxuICAgICAgaWYgKHByaXZhdGVzLmxpc3RlbmVycy5oYXMoZXZlbnQpKSB7XG4gICAgICAgIGZvciAobGV0IGxpc3RlbmVyIG9mIHByaXZhdGVzLmxpc3RlbmVycy5nZXQoZXZlbnQpLnZhbHVlcygpKSB7XG4gICAgICAgICAgaWYgKGxpc3RlbmVyKHsgdHlwZTogZXZlbnQsIHRhcmdldDogdGFyZ2V0LCBkYXRhOiBkYXRhIH0pID09PSBmYWxzZSkge1xuICAgICAgICAgICAgLy8gSWYgY2xpZW50IHJldHVybiBqdXN0IFwiZmFsc2VcIiwgc3RvcCBwcm9wYWdhdGlvblxuICAgICAgICAgICAgYnViYmxlID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChwcml2YXRlcy5wYXJlbnQgJiYgYnViYmxlID09IHRydWUpIHtcbiAgICAgICAgcHJpdmF0ZXMucGFyZW50LmVtaXRCdWJibGUoZXZlbnQsIHRhcmdldCwgZGF0YSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZpcmUgYW4gZXZlbnRcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnQgVGhlIGV2ZW50IHR5cGUgeW91IHdhbnQgdG8gZmlyZVxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gb25jZSBXaGV0aGVyIG9yIG5vdCB0aGUgZXZlbnQgaXMgb25jZSwgaWYgdHJ1ZSwgdGhlIGV2ZW50IGZpcmUgc2hvdWxkIG9ubHkgb25jZSwgbGlrZSBcImNvbXBsZXRlXCJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSB0byBsaXN0ZW5lciwgdW5kZWZpbmVkIG9yIG51bGwgaXMgT0tcbiAgICAgKi9cbiAgICBlbWl0IChldmVudCwgb25jZSwgZGF0YSkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAob25jZSkge1xuICAgICAgICBpZiAodHlwZW9mIGRhdGEgIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgIHByaXZhdGVzLm9uY2Uuc2V0KGV2ZW50LCBkYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwcml2YXRlcy5vbmNlLnNldChldmVudCwgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gd2hldGVyIG9yIG5vdCBidWJibGUgdGhlIGV2ZW50LCBkZWZhdWx0IHRydWVcbiAgICAgIGxldCBidWJibGUgPSB0cnVlO1xuXG4gICAgICBpZiAocHJpdmF0ZXMubGlzdGVuZXJzLmhhcyhldmVudCkpIHtcbiAgICAgICAgZm9yIChsZXQgbGlzdGVuZXIgb2YgcHJpdmF0ZXMubGlzdGVuZXJzLmdldChldmVudCkudmFsdWVzKCkpIHtcbiAgICAgICAgICBpZiAobGlzdGVuZXIoeyB0eXBlOiBldmVudCwgdGFyZ2V0OiB0aGlzLCBkYXRhOiBkYXRhIH0pID09PSBmYWxzZSkge1xuICAgICAgICAgICAgLy8gSWYgY2xpZW50IHJldHVybiBqdXN0IFwiZmFsc2VcIiwgc3RvcCBwcm9wYWdhdGlvblxuICAgICAgICAgICAgYnViYmxlID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChwcml2YXRlcy5wYXJlbnQgJiYgYnViYmxlID09IHRydWUpIHtcbiAgICAgICAgcHJpdmF0ZXMucGFyZW50LmVtaXRCdWJibGUoZXZlbnQsIHRoaXMsIGRhdGEpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/*

Sprite.Tween.get(Game.hero)
.promise(function () {
  return new Promise(function (resolve) {
    Game.hero.goto(Game.hero.x, Game.hero.y + 5,"walk", resolve);
  })
})
.wait(2000)
.promise(function () {
  return new Promise(function (resolve) {
    Game.hero.goto(Game.hero.x + 5, Game.hero.y, "walk", resolve);
  })
})
.to({alpha: 0}, 500)
.wait(500)
.to({alpha: 1}, 500)
.call(function () {
  Game.popup(Game.hero.sprite, "hello", 0, -50);
})
.wait(2000)
.call(function () {
  console.log("ok");
});


*/

/**
 * @fileoverview Sprite.Tween
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  Sprite.assign("Tween", (function (_Sprite$Event) {
    _inherits(SpriteTween, _Sprite$Event);

    _createClass(SpriteTween, null, [{
      key: "get",
      value: function get(object) {
        return new Sprite.Tween(object);
      }
    }]);

    function SpriteTween(object) {
      _classCallCheck(this, SpriteTween);

      _get(Object.getPrototypeOf(SpriteTween.prototype), "constructor", this).call(this);
      var privates = internal(this);
      privates.object = object;
      privates.callback = null;
      privates.action = [];
      privates.doing = false;
    }

    _createClass(SpriteTween, [{
      key: "nextAction",
      value: function nextAction() {
        var privates = internal(this);
        if (privates.doing == false && privates.action.length > 0) {
          var action = privates.action[0];
          privates.action.splice(0, 1);
          switch (action.type) {
            case "to":
              this.toAction(action.attributes, action.time);
              break;
            case "wait":
              this.waitAction(action.time);
              break;
            case "call":
              this.callAction(action.callback);
              break;
            case "promise":
              this.promiseAction(action.callback);
              break;
            default:
              console.error(action);
              throw new Error("Sprite.Tween got invalid action");
          }
        }
      }
    }, {
      key: "toAction",
      value: function toAction(attributes, time) {
        var _this = this;

        var privates = internal(this);
        privates.doing = true;

        var splice = Math.min(100, time);
        var t = time / splice;
        var step = {};

        for (var key in attributes) {
          if (Number.isFinite(attributes[key])) {
            step[key] = attributes[key] - privates.object[key];
            step[key] /= splice;
          }
        }

        var count = 0;
        var inter = setInterval(function () {
          count++;
          if (count >= splice) {
            for (var key in attributes) {
              privates.object[key] = attributes[key];
            }
            clearInterval(inter);
            privates.doing = false;
            _this.nextAction();
          } else {
            for (var key in step) {
              privates.object[key] += step[key];
            }
          }
        }, t);
      }
    }, {
      key: "to",
      value: function to(attributes, time) {
        internal(this).action.push({
          type: "to",
          attributes: attributes,
          time: time
        });
        this.nextAction();
        return this;
      }
    }, {
      key: "promiseAction",
      value: function promiseAction(callback) {
        var _this2 = this;

        this.doing = true;
        callback().then(function () {
          _this2.doing = false;
          _this2.nextAction();
        });
      }
    }, {
      key: "promise",
      value: function promise(callback) {
        internal(this).action.push({
          type: "promise",
          callback: callback
        });
        this.nextAction();
        return this;
      }
    }, {
      key: "callAction",
      value: function callAction(callback) {
        this.doing = true;
        callback();
        this.doing = false;
        this.nextAction();
      }
    }, {
      key: "call",
      value: function call(callback) {
        internal(this).action.push({
          type: "call",
          callback: callback
        });
        this.nextAction();
        return this;
      }
    }, {
      key: "waitAction",
      value: function waitAction(time) {
        var _this3 = this;

        var privates = internal(this);
        privates.doing = true;
        setTimeout(function () {
          privates.doing = false;
          _this3.nextAction();
        }, time);
      }
    }, {
      key: "wait",
      value: function wait(time) {
        internal(this).action.push({
          type: "wait",
          time: time
        });
        this.nextAction();
        return this;
      }
    }]);

    return SpriteTween;
  })(Sprite.Event));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlVHdlZW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0RBLENBQUMsWUFBWTtBQUNaLGNBQVksQ0FBQzs7QUFFWixNQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7O0FBRWxDLFFBQU0sQ0FBQyxNQUFNLENBQUMsT0FBTztjQUFRLFdBQVc7O2lCQUFYLFdBQVc7O2FBRTNCLGFBQUMsTUFBTSxFQUFFO0FBQ2xCLGVBQU8sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO09BQ2pDOzs7QUFFVyxhQU5lLFdBQVcsQ0FNekIsTUFBTSxFQUFFOzRCQU5NLFdBQVc7O0FBT3BDLGlDQVB5QixXQUFXLDZDQU81QjtBQUNSLFVBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM5QixjQUFRLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztBQUN6QixjQUFRLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztBQUN6QixjQUFRLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztBQUNyQixjQUFRLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztLQUN4Qjs7aUJBYjBCLFdBQVc7O2FBZTNCLHNCQUFHO0FBQ1osWUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlCLFlBQUksUUFBUSxDQUFDLEtBQUssSUFBSSxLQUFLLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQ3pELGNBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEMsa0JBQVEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUM3Qixr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RSxNQUFNO0FBQ1osY0FBSSxFQUFFLElBQUk7U0FDWCxDQUFDLENBQUM7QUFDSCxZQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7QUFDbEIsZUFBTyxJQUFJLENBQUM7T0FDYjs7O1dBcEkwQixXQUFXO0tBQVMsTUFBTSxDQUFDLEtBQUssRUFxSTNELENBQUM7Q0FFSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJTcHJpdGVUd2Vlbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbjJEIEdhbWUgU3ByaXRlIExpYnJhcnksIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbi8qXG5cblNwcml0ZS5Ud2Vlbi5nZXQoR2FtZS5oZXJvKVxuLnByb21pc2UoZnVuY3Rpb24gKCkge1xuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICBHYW1lLmhlcm8uZ290byhHYW1lLmhlcm8ueCwgR2FtZS5oZXJvLnkgKyA1LFwid2Fsa1wiLCByZXNvbHZlKTtcbiAgfSlcbn0pXG4ud2FpdCgyMDAwKVxuLnByb21pc2UoZnVuY3Rpb24gKCkge1xuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICBHYW1lLmhlcm8uZ290byhHYW1lLmhlcm8ueCArIDUsIEdhbWUuaGVyby55LCBcIndhbGtcIiwgcmVzb2x2ZSk7XG4gIH0pXG59KVxuLnRvKHthbHBoYTogMH0sIDUwMClcbi53YWl0KDUwMClcbi50byh7YWxwaGE6IDF9LCA1MDApXG4uY2FsbChmdW5jdGlvbiAoKSB7XG4gIEdhbWUucG9wdXAoR2FtZS5oZXJvLnNwcml0ZSwgXCJoZWxsb1wiLCAwLCAtNTApO1xufSlcbi53YWl0KDIwMDApXG4uY2FsbChmdW5jdGlvbiAoKSB7XG4gIGNvbnNvbGUubG9nKFwib2tcIik7XG59KTtcblxuXG4qL1xuXG5cbi8qKlxuICogQGZpbGVvdmVydmlldyBTcHJpdGUuVHdlZW5cbiAqIEBhdXRob3IgbWFpbEBxaGR1YW4uY29tIChRSCBEdWFuKVxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gIFNwcml0ZS5hc3NpZ24oXCJUd2VlblwiLCBjbGFzcyBTcHJpdGVUd2VlbiBleHRlbmRzIFNwcml0ZS5FdmVudCB7XG5cbiAgICBzdGF0aWMgZ2V0IChvYmplY3QpIHtcbiAgICAgIHJldHVybiBuZXcgU3ByaXRlLlR3ZWVuKG9iamVjdCk7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IgKG9iamVjdCkge1xuICAgICAgc3VwZXIoKTtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgcHJpdmF0ZXMub2JqZWN0ID0gb2JqZWN0O1xuICAgICAgcHJpdmF0ZXMuY2FsbGJhY2sgPSBudWxsO1xuICAgICAgcHJpdmF0ZXMuYWN0aW9uID0gW107XG4gICAgICBwcml2YXRlcy5kb2luZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIG5leHRBY3Rpb24gKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAocHJpdmF0ZXMuZG9pbmcgPT0gZmFsc2UgJiYgcHJpdmF0ZXMuYWN0aW9uLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IGFjdGlvbiA9IHByaXZhdGVzLmFjdGlvblswXTtcbiAgICAgICAgcHJpdmF0ZXMuYWN0aW9uLnNwbGljZSgwLCAxKTtcbiAgICAgICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgICAgICAgIGNhc2UgXCJ0b1wiOlxuICAgICAgICAgICAgdGhpcy50b0FjdGlvbihhY3Rpb24uYXR0cmlidXRlcywgYWN0aW9uLnRpbWUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcIndhaXRcIjpcbiAgICAgICAgICAgIHRoaXMud2FpdEFjdGlvbihhY3Rpb24udGltZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiY2FsbFwiOlxuICAgICAgICAgICAgdGhpcy5jYWxsQWN0aW9uKGFjdGlvbi5jYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwicHJvbWlzZVwiOlxuICAgICAgICAgICAgdGhpcy5wcm9taXNlQWN0aW9uKGFjdGlvbi5jYWxsYmFjayk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihhY3Rpb24pO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLlR3ZWVuIGdvdCBpbnZhbGlkIGFjdGlvblwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRvQWN0aW9uIChhdHRyaWJ1dGVzLCB0aW1lKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHByaXZhdGVzLmRvaW5nID0gdHJ1ZTtcblxuICAgICAgbGV0IHNwbGljZSA9IE1hdGgubWluKDEwMCwgdGltZSk7XG4gICAgICBsZXQgdCA9IHRpbWUgLyBzcGxpY2U7XG4gICAgICBsZXQgc3RlcCA9IHt9O1xuXG4gICAgICBmb3IgKGxldCBrZXkgaW4gYXR0cmlidXRlcykge1xuICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKGF0dHJpYnV0ZXNba2V5XSkpIHtcbiAgICAgICAgICBzdGVwW2tleV0gPSBhdHRyaWJ1dGVzW2tleV0gLSBwcml2YXRlcy5vYmplY3Rba2V5XTtcbiAgICAgICAgICBzdGVwW2tleV0gLz0gc3BsaWNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICBsZXQgaW50ZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIGNvdW50Kys7XG4gICAgICAgIGlmIChjb3VudCA+PSBzcGxpY2UpIHtcbiAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gYXR0cmlidXRlcykge1xuICAgICAgICAgICAgcHJpdmF0ZXMub2JqZWN0W2tleV0gPSBhdHRyaWJ1dGVzW2tleV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXIpO1xuICAgICAgICAgIHByaXZhdGVzLmRvaW5nID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5uZXh0QWN0aW9uKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZm9yIChsZXQga2V5IGluIHN0ZXApIHtcbiAgICAgICAgICAgIHByaXZhdGVzLm9iamVjdFtrZXldICs9IHN0ZXBba2V5XTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sIHQpO1xuICAgIH1cblxuICAgIHRvIChhdHRyaWJ1dGVzLCB0aW1lKSB7XG4gICAgICBpbnRlcm5hbCh0aGlzKS5hY3Rpb24ucHVzaCh7XG4gICAgICAgIHR5cGU6IFwidG9cIixcbiAgICAgICAgYXR0cmlidXRlczogYXR0cmlidXRlcyxcbiAgICAgICAgdGltZTogdGltZVxuICAgICAgfSk7XG4gICAgICB0aGlzLm5leHRBY3Rpb24oKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHByb21pc2VBY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICB0aGlzLmRvaW5nID0gdHJ1ZTtcbiAgICAgIGNhbGxiYWNrKCkudGhlbigoKSA9PiB7XG4gICAgICAgIHRoaXMuZG9pbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZXh0QWN0aW9uKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBwcm9taXNlIChjYWxsYmFjaykge1xuICAgICAgaW50ZXJuYWwodGhpcykuYWN0aW9uLnB1c2goe1xuICAgICAgICB0eXBlOiBcInByb21pc2VcIixcbiAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrXG4gICAgICB9KTtcbiAgICAgIHRoaXMubmV4dEFjdGlvbigpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgY2FsbEFjdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgIHRoaXMuZG9pbmcgPSB0cnVlO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICAgIHRoaXMuZG9pbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMubmV4dEFjdGlvbigpO1xuICAgIH1cblxuICAgIGNhbGwgKGNhbGxiYWNrKSB7XG4gICAgICBpbnRlcm5hbCh0aGlzKS5hY3Rpb24ucHVzaCh7XG4gICAgICAgIHR5cGU6IFwiY2FsbFwiLFxuICAgICAgICBjYWxsYmFjazogY2FsbGJhY2tcbiAgICAgIH0pO1xuICAgICAgdGhpcy5uZXh0QWN0aW9uKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICB3YWl0QWN0aW9uICh0aW1lKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHByaXZhdGVzLmRvaW5nID0gdHJ1ZTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBwcml2YXRlcy5kb2luZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5leHRBY3Rpb24oKTtcbiAgICAgIH0sIHRpbWUpO1xuICAgIH1cblxuICAgIHdhaXQgKHRpbWUpIHtcbiAgICAgIGludGVybmFsKHRoaXMpLmFjdGlvbi5wdXNoKHtcbiAgICAgICAgdHlwZTogXCJ3YWl0XCIsXG4gICAgICAgIHRpbWU6IHRpbWVcbiAgICAgIH0pO1xuICAgICAgdGhpcy5uZXh0QWN0aW9uKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH0pO1xuXG59KSgpO1xuIl19

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Sprite.Loader, fetch resource
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
   * Cache all url and element
   */
  var Cache = new Map();
  /**
   * When some url in Downloading, the url is downloading,
   * and other thread want it have to wait
   */
  var Downloading = new Map();

  function Fetch(url, callback, timeout) {

    var type = null;
    if (url.match(/js$/)) {
      type = "js";
    } else if (url.match(/jpg$|jpeg$|png$|bmp$|gif$/i)) {
      type = "image";
    } else if (url.match(/wav$|mp3$|ogg$/i)) {
      type = "audio";
    } else if (url.match(/json$/i)) {
      type = "json";
    } else {
      console.error(url);
      throw new Error("Fetch got an invalid url");
    }

    // finished
    var Finish = function Finish(obj) {
      Cache.set(url, obj);

      if (type == "json") {
        obj = Sprite.copy(obj);
      }

      if (callback) {
        callback(obj);
      }
      if (Downloading.has(url)) {
        var callbacks = Downloading.get(url);
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = callbacks[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var _callback = _step.value;

            if (_callback) {
              _callback(obj);
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator["return"]) {
              _iterator["return"]();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        Downloading["delete"](url);
      }
    };

    if (Cache.has(url)) {
      Finish(Cache.get(url));
      return;
    }

    if (Downloading.has(url)) {
      Downloading.get(url).push(callback);
      return;
    }

    Downloading.set(url, []);

    var req = new XMLHttpRequest();
    req.open("GET", url, true);
    req.timeout = 15000; // 15 seconds

    switch (type) {
      case "js":
        req.responseType = "text";
        break;
      case "image":
        req.responseType = "blob";
        break;
      case "audio":
        req.responseType = "blob";
        break;
      case "json":
        req.responseType = "json";
        break;
      default:
        console.error(type, url);
        throw new Error("Fetch something wrong");
    }

    if (typeof callback != "function") callback = function () {};

    req.ontimeout = function () {
      if (timeout) {
        console.error(url);
        throw new Error("Sprite.Loader.Fetch timeout twice");
      } else {
        Fetch(url, callback, true);
      }
    };

    var done = false;
    req.onreadystatechange = function () {
      if (req.readyState == 4 && !done) {
        done = true;
        if (req.response) {
          if (type == "js") {
            var fun = null;
            try {
              fun = new Function(req.response);
            } catch (e) {
              console.error(req.response, url);
              throw e;
            }
            Finish(fun);
          } else if (type == "image") {
            (function () {
              var blob = req.response;
              var image = new Image();
              image.onload = function () {
                // window.URL.revokeObjectURL(image.src);
                image.onload = null;
                Finish(image);
              };
              image.src = window.URL.createObjectURL(blob);
            })();
          } else if (type == "audio") {
            (function () {
              var blob = req.response;
              var audio = new Audio();
              audio.oncanplay = function () {
                // 如果reoke掉audio，那么audio.load()方法则不能用了
                // window.URL.revokeObjectURL(audio.src);
                audio.oncanplay = null;
                Finish(audio);
              };
              audio.src = window.URL.createObjectURL(blob);
            })();
          } else if (type == "json") {
            var json = req.response;
            if (!json) {
              console.error(url);
              throw new Error("Sprite.Loader invalid json");
            }
            Finish(json);
          }
        } else {
          console.error("url: ", url);
          console.error("response: ", req.response, " readyState: ", req.readyState, " status: ", req.status, " statusText: ", req.statusText);
          throw new Error("Sprite.Loader.Fetch Error");
        }
      }
    };
    req.send();
  }

  Sprite.assign("load", function () {
    var args = Array.prototype.slice.call(arguments);
    return new Promise(function (resolve, reject) {
      var urls = [];

      var _iteratorNormalCompletion2 = true;
      var _didIteratorError2 = false;
      var _iteratorError2 = undefined;

      try {
        for (var _iterator2 = args[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
          var element = _step2.value;

          if (typeof element == "string") {
            urls.push(element);
          } else if (element instanceof Array) {
            var _iteratorNormalCompletion3 = true;
            var _didIteratorError3 = false;
            var _iteratorError3 = undefined;

            try {
              for (var _iterator3 = element[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                var url = _step3.value;

                urls.push(url);
              }
            } catch (err) {
              _didIteratorError3 = true;
              _iteratorError3 = err;
            } finally {
              try {
                if (!_iteratorNormalCompletion3 && _iterator3["return"]) {
                  _iterator3["return"]();
                }
              } finally {
                if (_didIteratorError3) {
                  throw _iteratorError3;
                }
              }
            }
          } else {
            console.error(element, args);
            throw new Error("Sprite.load got invalid argument");
          }
        }
      } catch (err) {
        _didIteratorError2 = true;
        _iteratorError2 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
            _iterator2["return"]();
          }
        } finally {
          if (_didIteratorError2) {
            throw _iteratorError2;
          }
        }
      }

      var done = 0;
      var ret = [];
      ret.length = urls.length;

      var Done = function Done() {
        done++;

        if (done >= ret.length) {
          resolve(ret);
        }
      };

      urls.forEach(function (element, index) {
        Fetch(element, function (result) {
          ret[index] = result;
          Done();
        });
      });
    });
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlTG9hZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5QkEsQ0FBQyxZQUFZO0FBQ1osY0FBWSxDQUFDOztBQUVaLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7Ozs7QUFLbEMsTUFBSSxLQUFLLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQzs7Ozs7QUFLdEIsTUFBSSxXQUFXLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQzs7QUFFNUIsV0FBUyxLQUFLLENBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUU7O0FBRXRDLFFBQUksSUFBSSxHQUFHLElBQUksQ0FBQztBQUNoQixRQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFDcEIsVUFBSSxHQUFHLElBQUksQ0FBQztLQUNiLE1BQU0sSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLDRCQUE0QixDQUFDLEVBQUU7QUFDbEQsVUFBSSxHQUFHLE9BQU8sQ0FBQztLQUNoQixNQUFNLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFO0FBQ3ZDLFVBQUksR0FBRyxPQUFPLENBQUM7S0FDaEIsTUFBTSxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUU7QUFDOUIsVUFBSSxHQUFHLE1BQU0sQ0FBQztLQUNmLE1BQU07QUFDTCxhQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ25CLFlBQU0sSUFBSSxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQztLQUM3Qzs7O0FBR0QsUUFBSSxNQUFNLEdBQUcsU0FBVCxNQUFNLENBQUksR0FBRyxFQUFLO0FBQ3BCLFdBQUssQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDOztBQUVwQixVQUFJLElBQUksSUFBSSxNQUFNLEVBQUU7QUFD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LENBQUMsQ0FBQztBQUM3QixrQkFBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1dBQ3JEO1NBQ0Y7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFRCxVQUFJLElBQUksR0FBRyxDQUFDLENBQUM7QUFDYixVQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7QUFDYixTQUFHLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7O0FBRXpCLFVBQUksSUFBSSxHQUFHLFNBQVAsSUFBSSxHQUFTO0FBQ2YsWUFBSSxFQUFFLENBQUM7O0FBRVAsWUFBSSxJQUFJLElBQUksR0FBRyxDQUFDLE1BQU0sRUFBRTtBQUN0QixpQkFBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ2Q7T0FDRixDQUFBOztBQUVELFVBQUksQ0FBQyxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsS0FBSyxFQUFLO0FBQy9CLGFBQUssQ0FBQyxPQUFPLEVBQUUsVUFBQyxNQUFNLEVBQUs7QUFDekIsYUFBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLE1BQU0sQ0FBQztBQUNwQixjQUFJLEVBQUUsQ0FBQztTQUNSLENBQUMsQ0FBQztPQUNKLENBQUMsQ0FBQztLQUVKLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUVKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IlNwcml0ZUxvYWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU3ByaXRlLkxvYWRlciwgZmV0Y2ggcmVzb3VyY2VcbiAqIEBhdXRob3IgbWFpbEBxaGR1YW4uY29tIChRSCBEdWFuKVxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gIC8qKlxuICAgKiBDYWNoZSBhbGwgdXJsIGFuZCBlbGVtZW50XG4gICAqL1xuICBsZXQgQ2FjaGUgPSBuZXcgTWFwKCk7XG4gIC8qKlxuICAgKiBXaGVuIHNvbWUgdXJsIGluIERvd25sb2FkaW5nLCB0aGUgdXJsIGlzIGRvd25sb2FkaW5nLFxuICAgKiBhbmQgb3RoZXIgdGhyZWFkIHdhbnQgaXQgaGF2ZSB0byB3YWl0XG4gICAqL1xuICBsZXQgRG93bmxvYWRpbmcgPSBuZXcgTWFwKCk7XG5cbiAgZnVuY3Rpb24gRmV0Y2ggKHVybCwgY2FsbGJhY2ssIHRpbWVvdXQpIHtcblxuICAgIGxldCB0eXBlID0gbnVsbDtcbiAgICBpZiAodXJsLm1hdGNoKC9qcyQvKSkge1xuICAgICAgdHlwZSA9IFwianNcIjtcbiAgICB9IGVsc2UgaWYgKHVybC5tYXRjaCgvanBnJHxqcGVnJHxwbmckfGJtcCR8Z2lmJC9pKSkge1xuICAgICAgdHlwZSA9IFwiaW1hZ2VcIjtcbiAgICB9IGVsc2UgaWYgKHVybC5tYXRjaCgvd2F2JHxtcDMkfG9nZyQvaSkpIHtcbiAgICAgIHR5cGUgPSBcImF1ZGlvXCI7XG4gICAgfSBlbHNlIGlmICh1cmwubWF0Y2goL2pzb24kL2kpKSB7XG4gICAgICB0eXBlID0gXCJqc29uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IodXJsKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkZldGNoIGdvdCBhbiBpbnZhbGlkIHVybFwiKTtcbiAgICB9XG5cbiAgICAvLyBmaW5pc2hlZFxuICAgIGxldCBGaW5pc2ggPSAob2JqKSA9PiB7XG4gICAgICBDYWNoZS5zZXQodXJsLCBvYmopO1xuXG4gICAgICBpZiAodHlwZSA9PSBcImpzb25cIikge1xuICAgICAgICBvYmogPSBTcHJpdGUuY29weShvYmopO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2sob2JqKTtcbiAgICAgIH1cbiAgICAgIGlmIChEb3dubG9hZGluZy5oYXModXJsKSkge1xuICAgICAgICBsZXQgY2FsbGJhY2tzID0gRG93bmxvYWRpbmcuZ2V0KHVybCk7XG4gICAgICAgIGZvciAobGV0IGNhbGxiYWNrIG9mIGNhbGxiYWNrcykge1xuICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2sob2JqKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgRG93bmxvYWRpbmcuZGVsZXRlKHVybCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKENhY2hlLmhhcyh1cmwpKSB7XG4gICAgICBGaW5pc2goQ2FjaGUuZ2V0KHVybCkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChEb3dubG9hZGluZy5oYXModXJsKSkge1xuICAgICAgRG93bmxvYWRpbmcuZ2V0KHVybCkucHVzaChjYWxsYmFjayk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgRG93bmxvYWRpbmcuc2V0KHVybCwgW10pO1xuXG4gICAgbGV0IHJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIHJlcS5vcGVuKFwiR0VUXCIsIHVybCwgdHJ1ZSk7XG4gICAgcmVxLnRpbWVvdXQgPSAxNTAwMDsgLy8gMTUgc2Vjb25kc1xuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFwianNcIjpcbiAgICAgICAgcmVxLnJlc3BvbnNlVHlwZSA9IFwidGV4dFwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJpbWFnZVwiOlxuICAgICAgICByZXEucmVzcG9uc2VUeXBlID0gXCJibG9iXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImF1ZGlvXCI6XG4gICAgICAgIHJlcS5yZXNwb25zZVR5cGUgPSBcImJsb2JcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwianNvblwiOlxuICAgICAgICByZXEucmVzcG9uc2VUeXBlID0gXCJqc29uXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29uc29sZS5lcnJvcih0eXBlLCB1cmwpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGZXRjaCBzb21ldGhpbmcgd3JvbmdcIik7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPSBcImZ1bmN0aW9uXCIpXG4gICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHt9O1xuXG4gICAgcmVxLm9udGltZW91dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IodXJsKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLkxvYWRlci5GZXRjaCB0aW1lb3V0IHR3aWNlXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgRmV0Y2godXJsLCBjYWxsYmFjaywgdHJ1ZSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGxldCBkb25lID0gZmFsc2U7XG4gICAgcmVxLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChyZXEucmVhZHlTdGF0ZSA9PSA0ICYmICFkb25lKSB7XG4gICAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgICBpZiAocmVxLnJlc3BvbnNlKSB7XG4gICAgICAgICAgaWYgKHR5cGUgPT0gXCJqc1wiKSB7XG4gICAgICAgICAgICBsZXQgZnVuID0gbnVsbDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGZ1biA9IG5ldyBGdW5jdGlvbihyZXEucmVzcG9uc2UpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlcS5yZXNwb25zZSwgdXJsKTtcbiAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEZpbmlzaChmdW4pO1xuICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcImltYWdlXCIpIHtcbiAgICAgICAgICAgIGxldCBibG9iID0gcmVxLnJlc3BvbnNlO1xuICAgICAgICAgICAgbGV0IGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICBpbWFnZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIC8vIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKGltYWdlLnNyYyk7XG4gICAgICAgICAgICAgIGltYWdlLm9ubG9hZCA9IG51bGw7XG4gICAgICAgICAgICAgIEZpbmlzaChpbWFnZSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaW1hZ2Uuc3JjID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09IFwiYXVkaW9cIikge1xuICAgICAgICAgICAgbGV0IGJsb2IgPSByZXEucmVzcG9uc2U7XG4gICAgICAgICAgICBsZXQgYXVkaW8gPSBuZXcgQXVkaW8oKTtcbiAgICAgICAgICAgIGF1ZGlvLm9uY2FucGxheSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgLy8g5aaC5p6ccmVva2XmjolhdWRpb++8jOmCo+S5iGF1ZGlvLmxvYWQoKeaWueazleWImeS4jeiDveeUqOS6hlxuICAgICAgICAgICAgICAvLyB3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTChhdWRpby5zcmMpO1xuICAgICAgICAgICAgICBhdWRpby5vbmNhbnBsYXkgPSBudWxsO1xuICAgICAgICAgICAgICBGaW5pc2goYXVkaW8pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGF1ZGlvLnNyYyA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcImpzb25cIikge1xuICAgICAgICAgICAgbGV0IGpzb24gPSByZXEucmVzcG9uc2U7XG4gICAgICAgICAgICBpZiAoIWpzb24pIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih1cmwpO1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuTG9hZGVyIGludmFsaWQganNvblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEZpbmlzaChqc29uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcInVybDogXCIsIHVybCk7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcInJlc3BvbnNlOiBcIiwgcmVxLnJlc3BvbnNlLFxuICAgICAgICAgIFwiIHJlYWR5U3RhdGU6IFwiLCByZXEucmVhZHlTdGF0ZSxcbiAgICAgICAgICBcIiBzdGF0dXM6IFwiLCByZXEuc3RhdHVzLFxuICAgICAgICAgIFwiIHN0YXR1c1RleHQ6IFwiLCByZXEuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLkxvYWRlci5GZXRjaCBFcnJvclwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgcmVxLnNlbmQoKTtcbiAgfVxuXG4gIFNwcml0ZS5hc3NpZ24oXCJsb2FkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGxldCB1cmxzID0gW107XG5cbiAgICAgIGZvciAobGV0IGVsZW1lbnQgb2YgYXJncykge1xuICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIHVybHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50IGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICBmb3IgKGxldCB1cmwgb2YgZWxlbWVudCkge1xuICAgICAgICAgICAgdXJscy5wdXNoKHVybCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZWxlbWVudCwgYXJncyk7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLmxvYWQgZ290IGludmFsaWQgYXJndW1lbnRcIik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbGV0IGRvbmUgPSAwO1xuICAgICAgbGV0IHJldCA9IFtdO1xuICAgICAgcmV0Lmxlbmd0aCA9IHVybHMubGVuZ3RoO1xuXG4gICAgICBsZXQgRG9uZSA9ICgpID0+IHtcbiAgICAgICAgZG9uZSsrO1xuXG4gICAgICAgIGlmIChkb25lID49IHJldC5sZW5ndGgpIHtcbiAgICAgICAgICByZXNvbHZlKHJldCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdXJscy5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgICBGZXRjaChlbGVtZW50LCAocmVzdWx0KSA9PiB7XG4gICAgICAgICAgcmV0W2luZGV4XSA9IHJlc3VsdDtcbiAgICAgICAgICBEb25lKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICB9KTtcbiAgfSk7XG5cbn0pKCk7XG4iXX0=

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Sprite.Ticker
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var tickerCount = 0;

  var SpriteTicker = (function (_Sprite$Event) {
    _inherits(SpriteTicker, _Sprite$Event);

    function SpriteTicker() {
      _classCallCheck(this, SpriteTicker);

      _get(Object.getPrototypeOf(SpriteTicker.prototype), "constructor", this).call(this);
      this.tick();
    }

    _createClass(SpriteTicker, [{
      key: "tick",
      value: function tick() {
        var _this = this;

        tickerCount++;
        this.emit("tick", false, tickerCount);
        window.requestAnimationFrame(function () {
          _this.tick();
        });
      }
    }, {
      key: "after",
      value: function after(times, callback) {
        var _this2 = this;

        var count = 0;
        var id = this.on("tick", function () {
          count++;
          if (count >= times) {
            _this2.off("tick", id);
            if (callback) {
              callback();
            }
          }
        });
        return id;
      }
    }, {
      key: "clearAfter",
      value: function clearAfter(id) {
        this.off("tick", id);
      }
    }, {
      key: "whiles",
      value: function whiles(times, callback) {
        var _this3 = this;

        var count = 0;
        var id = this.on("tick", function () {
          count++;
          if (count >= times) {
            if (callback) {
              callback(true);
            }
            _this3.off("tick", id);
          } else {
            if (callback) {
              callback(false);
            }
          }
        });
        return id;
      }
    }, {
      key: "clearWhiles",
      value: function clearWhiles(id) {
        this.off("tick", id);
      }
    }]);

    return SpriteTicker;
  })(Sprite.Event);

  ;

  Sprite.assign("Ticker", new SpriteTicker());
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlVGlja2VyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBLENBQUMsWUFBWTtBQUNaLGNBQVksQ0FBQzs7QUFFWixNQUFJLFdBQVcsR0FBRyxDQUFDLENBQUM7O01BRWQsWUFBWTtjQUFaLFlBQVk7O0FBQ0osYUFEUixZQUFZLEdBQ0Q7NEJBRFgsWUFBWTs7QUFFZCxpQ0FGRSxZQUFZLDZDQUVOO0FBQ1IsVUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0tBQ2I7O2lCQUpHLFlBQVk7O2FBTVgsZ0JBQUc7OztBQUNOLG1CQUFXLEVBQUUsQ0FBQztBQUNkLFlBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxXQUFXLENBQUMsQ0FBQztBQUN0QyxjQUFNLENBQUMscUJBQXFCLENBQUMsWUFBTTtBQUNqQyxnQkFBSyxJQUFJLEVBQUUsQ0FBQztTQUNiLENBQUMsQ0FBQztPQUNKOzs7YUFFSyxlQUFDLEtBQUssRUFBRSxRQUFRLEVBQUU7OztBQUN0QixZQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7QUFDZCxZQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxZQUFNO0FBQzdCLGVBQUssRUFBRSxDQUFDO0FBQ1IsY0FBSSxLQUFLLElBQUksS0FBSyxFQUFFO0FBQ2xCLG1CQUFLLEdBQUcsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDckIsZ0JBQUksUUFBUSxFQUFFO0FBQ1osc0JBQVEsRUFBRSxDQUFDO2FBQ1o7V0FDRjtTQUNGLENBQUMsQ0FBQztBQUNILGVBQU8sRUFBRSxDQUFDO09BQ1g7OzthQUVVLG9CQUFDLEVBQUUsRUFBRTtBQUNkLFlBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO09BQ3RCOzs7YUFFTSxnQkFBQyxLQUFLLEVBQUUsUUFBUSxFQUFFOzs7QUFDdkIsWUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0FBQ2QsWUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsWUFBTTtBQUM3QixlQUFLLEVBQUUsQ0FBQztBQUNSLGNBQUksS0FBSyxJQUFJLEtBQUssRUFBRTtBQUNsQixnQkFBSSxRQUFRLEVBQUU7QUFDWixzQkFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ2hCO0FBQ0QsbUJBQUssR0FBRyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztXQUN0QixNQUFNO0FBQ0wsZ0JBQUksUUFBUSxFQUFFO0FBQ1osc0JBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUNqQjtXQUNGO1NBQ0YsQ0FBQyxDQUFDO0FBQ0gsZUFBTyxFQUFFLENBQUM7T0FDWDs7O2FBRVcscUJBQUMsRUFBRSxFQUFFO0FBQ2YsWUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7T0FDdEI7OztXQXBERyxZQUFZO0tBQVMsTUFBTSxDQUFDLEtBQUs7O0FBc0R0QyxHQUFDOztBQUVGLFFBQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLElBQUksWUFBWSxFQUFFLENBQUMsQ0FBQztDQUU3QyxDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJTcHJpdGVUaWNrZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU3ByaXRlLlRpY2tlclxuICogQGF1dGhvciBtYWlsQHFoZHVhbi5jb20gKFFIIER1YW4pXG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcbiBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgdGlja2VyQ291bnQgPSAwO1xuXG4gIGNsYXNzIFNwcml0ZVRpY2tlciBleHRlbmRzIFNwcml0ZS5FdmVudCB7XG4gICAgY29uc3RydWN0b3IgKCkge1xuICAgICAgc3VwZXIoKTtcbiAgICAgIHRoaXMudGljaygpO1xuICAgIH1cblxuICAgIHRpY2sgKCkge1xuICAgICAgdGlja2VyQ291bnQrKztcbiAgICAgIHRoaXMuZW1pdChcInRpY2tcIiwgZmFsc2UsIHRpY2tlckNvdW50KTtcbiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgICB0aGlzLnRpY2soKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGFmdGVyICh0aW1lcywgY2FsbGJhY2spIHtcbiAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICBsZXQgaWQgPSB0aGlzLm9uKFwidGlja1wiLCAoKSA9PiB7XG4gICAgICAgIGNvdW50Kys7XG4gICAgICAgIGlmIChjb3VudCA+PSB0aW1lcykge1xuICAgICAgICAgIHRoaXMub2ZmKFwidGlja1wiLCBpZCk7XG4gICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gaWQ7XG4gICAgfVxuXG4gICAgY2xlYXJBZnRlciAoaWQpIHtcbiAgICAgIHRoaXMub2ZmKFwidGlja1wiLCBpZCk7XG4gICAgfVxuXG4gICAgd2hpbGVzICh0aW1lcywgY2FsbGJhY2spIHtcbiAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICBsZXQgaWQgPSB0aGlzLm9uKFwidGlja1wiLCAoKSA9PiB7XG4gICAgICAgIGNvdW50Kys7XG4gICAgICAgIGlmIChjb3VudCA+PSB0aW1lcykge1xuICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2sodHJ1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMub2ZmKFwidGlja1wiLCBpZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhmYWxzZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBpZDtcbiAgICB9XG5cbiAgICBjbGVhcldoaWxlcyAoaWQpIHtcbiAgICAgIHRoaXMub2ZmKFwidGlja1wiLCBpZCk7XG4gICAgfVxuXG4gIH07XG5cbiAgU3ByaXRlLmFzc2lnbihcIlRpY2tlclwiLCBuZXcgU3ByaXRlVGlja2VyKCkpO1xuXG59KSgpO1xuIl19

/*
2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

/**
 * @fileoverview Class Sprite.Display
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  var hitCanvas = document.createElement("canvas");
  hitCanvas.width = 1;
  hitCanvas.height = 1;
  var hitContext = hitCanvas.getContext("2d");
  hitContext.clearRect(0, 0, 1, 1);
  var hitData = hitContext.getImageData(0, 0, 1, 1).data;

  /**
   * Class Sprite.Display, base class for all other classes
   * @class
   * @extends Sprite.Event
   */
  Sprite.assign("Display", (function (_Sprite$Event) {
    _inherits(SpriteDisplay, _Sprite$Event);

    /**
     * construct Sprite.Display
     * @constructor
     */

    function SpriteDisplay() {
      _classCallCheck(this, SpriteDisplay);

      _get(Object.getPrototypeOf(SpriteDisplay.prototype), "constructor", this).call(this);
      var privates = internal(this);
      /**
       * x position of object
       @type {number}
       */
      privates.x = 0;
      /**
       * y position of object
       @type {number}
       */
      privates.y = 0;
      /**
       * object's center x
       @type {number}
       */
      privates.centerX = 0;
      /**
       * object's center y
       @type {number}
       */
      privates.centerY = 0;
      /**
       * object's alpha, from 0 to 1, when alpha is 0, object is invisible
       @type {number}
       */
      privates.alpha = 1;
      /**
       * object's visibility
       @type {boolean}
       */
      privates.visible = true;

      privates.width = 0;
      privates.height = 0;
    }

    _createClass(SpriteDisplay, [{
      key: "draw",

      /**
       * Interface, sub-class should overload this method
       * @param {Object} renderer
       */
      value: function draw(renderer) {
        console.error("sub-class should override this function");
        throw new Error("Invalid call Sprite.Display.draw");
      }

      /**
       * Check if the x,y hit this object or not
       * @param {number} x the x position of screen (may 0 to 640) for test
       * @param {number} y the y position of screen (may 0 to 480) for test
       */
    }, {
      key: "hitTest",
      value: function hitTest(x, y) {
        hitContext.clearRect(0, 0, 1, 1);
        hitContext.save();
        hitContext.translate(-x, -y);
        this.draw(hitContext);
        hitContext.restore();
        var newData = hitContext.getImageData(0, 0, 1, 1).data;

        if (hitData[0] != newData[0] || hitData[1] != newData[1] || hitData[2] != newData[2]) {
          return true;
        }
        return false;
      }
    }, {
      key: "drawPosition",
      value: function drawPosition() {

        var centerX = this.centerX;
        var centerY = this.centerY;
        var x = this.x;
        var y = this.y;
        var alpha = this.alpha;

        var parent = this.parent;
        while (parent) {
          centerX += parent.centerX;
          centerY += parent.centerY;
          x += parent.x;
          y += parent.y;
          alpha *= parent.alpha;
          if (alpha <= 0.001) {
            return null;
          }
          if (parent.visible == false) {
            return null;
          }
          parent = parent.parent;
        }

        return {
          x: x - centerX,
          y: y - centerY,
          alpha: alpha
        };
      }

      /**
       * Draw an image to renderer
       * x, y-----------------------------------------
       * -                                           -
       * -    sx.sy------------                      -
       * -    -               -                      -
       * -    ---swidth,sheight                      -
       * -                                           -
       * ---------------------------------------------image.width, image.height
       * Crop image with sx, sy, swidth and sheight, draw it on renderer
       * x, y will be calculated by this.x, this.y, this.centerX, this.centerY and some parents' attributes
       * @param {Object} renderer A object who has drawImage method, eg. Sprite.Webgl
       * @param {Object} image
       * @param {number} sx
       * @param {number} sy
       * @param {number} swidth
       * @param {number} sheight
       */
    }, {
      key: "drawImage",
      value: function drawImage(renderer, image, sx, sy, swidth, sheight) {
        if (this.visible != true || this.alpha < 0.01) {
          return;
        }

        var d = this.drawPosition();
        if (!d) {
          return;
        }
        renderer.alpha = d.alpha;

        try {
          renderer.drawImage(image, sx, sy, swidth, sheight, d.x, d.y, swidth, sheight);
        } catch (e) {
          console.error(image, sx, sy, swidth, sheight, d.x, d.y, swidth, sheight);
          throw e;
        }
      }
    }, {
      key: "width",
      get: function get() {
        return internal(this).width;
      },
      set: function set(value) {
        internal(this).width = value;
      }
    }, {
      key: "height",
      get: function get() {
        return internal(this).height;
      },
      set: function set(value) {
        internal(this).height = value;
      }

      /**
       * @return {number} return x position
       */
    }, {
      key: "x",
      get: function get() {
        return internal(this).x;
      },

      /**
       * @param {number} value new x position
       */
      set: function set(value) {
        var privates = internal(this);
        if (Number.isFinite(value)) {
          if (value != privates.x) {
            privates.x = Math.floor(value);
            this.emit("change");
          }
        } else {
          console.error(value, this);
          throw new Error("Sprite.Display.set x : invalid argument");
        }
      }

      /**
       * @return {number} return y position
       */
    }, {
      key: "y",
      get: function get() {
        return internal(this).y;
      },

      /**
       * @param {number} value new y position
       */
      set: function set(value) {
        var privates = internal(this);
        if (Number.isFinite(value)) {
          if (value != privates.y) {
            privates.y = Math.floor(value);
            this.emit("change");
          }
        } else {
          console.error(value, this);
          throw new Error("Sprite.Display.set y : invalid argument");
        }
      }

      /**
       * @return {number} return center x
       */
    }, {
      key: "centerX",
      get: function get() {
        return internal(this).centerX;
      },

      /**
       * @param {number} value new center x
       */
      set: function set(value) {
        var privates = internal(this);
        if (Number.isFinite(value)) {
          if (value != privates.centerX) {
            privates.centerX = Math.floor(value);
            this.emit("change");
          }
        } else {
          console.error(value, this);
          throw new Error("Sprite.Display.set centerX : invalid argument");
        }
      }

      /**
       * @return {number} return center y
       */
    }, {
      key: "centerY",
      get: function get() {
        return internal(this).centerY;
      },

      /**
       * @param {number} value new center y
       */
      set: function set(value) {
        var privates = internal(this);
        if (Number.isFinite(value)) {
          if (value != privates.centerY) {
            privates.centerY = Math.floor(value);
            this.emit("change");
          }
        } else {
          console.error(value, this);
          throw new Error("Sprite.Display.set centerY : invalid argument");
        }
      }

      /**
       * @return {number} return alpha
       */
    }, {
      key: "alpha",
      get: function get() {
        var privates = internal(this);
        return privates.alpha;
      },

      /**
       * @param {number} value new alpha
       */
      set: function set(value) {
        var privates = internal(this);
        if (Number.isFinite(value) && (value >= 0 || value <= 1)) {
          if (value != privates.alpha) {
            privates.alpha = value;
            this.emit("change");
          }
        } else {
          console.error(value, this);
          throw new Error("Sprite.Display.set alpha : invalid argument");
        }
      }

      /**
       * @return {boolean} return alpha
       */
    }, {
      key: "visible",
      get: function get() {
        var privates = internal(this);
        return privates.visible;
      },

      /**
       * @param {boolean} value new visible
       */
      set: function set(value) {
        var privates = internal(this);
        if (value != privates.visible) {
          privates.visible = value;
          this.emit("change");
        }
      }
    }]);

    return SpriteDisplay;
  })(Sprite.Event));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlRGlzcGxheS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFxQkEsQ0FBQyxZQUFZO0FBQ1osY0FBWSxDQUFDOztBQUVaLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7QUFFbEMsTUFBSSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNqRCxXQUFTLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztBQUNwQixXQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztBQUNyQixNQUFJLFVBQVUsR0FBRyxTQUFTLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzVDLFlBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDakMsTUFBSSxPQUFPLEdBQUcsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7Ozs7Ozs7QUFRdkQsUUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTO2NBQVEsYUFBYTs7Ozs7OztBQUs5QixhQUxpQixhQUFhLEdBSzNCOzRCQUxjLGFBQWE7O0FBTXhDLGlDQU4yQixhQUFhLDZDQU1oQztBQUNSLFVBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQzs7Ozs7QUFLOUIsY0FBUSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7Ozs7O0FBS2YsY0FBUSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7Ozs7O0FBS2YsY0FBUSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7Ozs7O0FBS3JCLGNBQVEsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDOzs7OztBQUtyQixjQUFRLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FB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SSxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsQ0FBQSxBQUFDLEVBQUU7QUFDeEQsY0FBSSxLQUFLLElBQUksUUFBUSxDQUFDLEtBQUssRUFBRTtBQUMzQixvQkFBUSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7QUFDdkIsZ0JBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7V0FDckI7U0FDRixNQUFNO0FBQ0wsaUJBQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzNCLGdCQUFNLElBQUksS0FBSyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7U0FDaEU7T0FDRjs7Ozs7OztXQUlXLGVBQUc7QUFDYixZQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDOUIsZUFBTyxRQUFRLENBQUMsT0FBTyxDQUFDO09BQ3pCOzs7OztXQUlXLGFBQUMsS0FBSyxFQUFFO0FBQ2xCLFlBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM5QixZQUFJLEtBQUssSUFBSSxRQUFRLENBQUMsT0FBTyxFQUFFO0FBQzdCLGtCQUFRLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztBQUN6QixjQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3JCO09BQ0Y7OztXQXJMNEIsYUFBYTtLQUFTLE1BQU0sQ0FBQyxLQUFLLEVBMlIvRCxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiU3ByaXRlRGlzcGxheS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IENsYXNzIFNwcml0ZS5EaXNwbGF5XG4gKiBAYXV0aG9yIG1haWxAcWhkdWFuLmNvbSAoUUggRHVhbilcbiAqL1xuXG5cbihmdW5jdGlvbiAoKSB7XG4gXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gIGxldCBoaXRDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICBoaXRDYW52YXMud2lkdGggPSAxO1xuICBoaXRDYW52YXMuaGVpZ2h0ID0gMTtcbiAgbGV0IGhpdENvbnRleHQgPSBoaXRDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICBoaXRDb250ZXh0LmNsZWFyUmVjdCgwLCAwLCAxLCAxKTtcbiAgbGV0IGhpdERhdGEgPSBoaXRDb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCAxLCAxKS5kYXRhO1xuXG5cbiAgLyoqXG4gICAqIENsYXNzIFNwcml0ZS5EaXNwbGF5LCBiYXNlIGNsYXNzIGZvciBhbGwgb3RoZXIgY2xhc3Nlc1xuICAgKiBAY2xhc3NcbiAgICogQGV4dGVuZHMgU3ByaXRlLkV2ZW50XG4gICAqL1xuICBTcHJpdGUuYXNzaWduKFwiRGlzcGxheVwiLCBjbGFzcyBTcHJpdGVEaXNwbGF5IGV4dGVuZHMgU3ByaXRlLkV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBjb25zdHJ1Y3QgU3ByaXRlLkRpc3BsYXlcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgICBzdXBlcigpO1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICAvKipcbiAgICAgICAqIHggcG9zaXRpb24gb2Ygb2JqZWN0XG4gICAgICAgQHR5cGUge251bWJlcn1cbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMueCA9IDA7XG4gICAgICAvKipcbiAgICAgICAqIHkgcG9zaXRpb24gb2Ygb2JqZWN0XG4gICAgICAgQHR5cGUge251bWJlcn1cbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMueSA9IDA7XG4gICAgICAvKipcbiAgICAgICAqIG9iamVjdCdzIGNlbnRlciB4XG4gICAgICAgQHR5cGUge251bWJlcn1cbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuY2VudGVyWCA9IDA7XG4gICAgICAvKipcbiAgICAgICAqIG9iamVjdCdzIGNlbnRlciB5XG4gICAgICAgQHR5cGUge251bWJlcn1cbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuY2VudGVyWSA9IDA7XG4gICAgICAvKipcbiAgICAgICAqIG9iamVjdCdzIGFscGhhLCBmcm9tIDAgdG8gMSwgd2hlbiBhbHBoYSBpcyAwLCBvYmplY3QgaXMgaW52aXNpYmxlXG4gICAgICAgQHR5cGUge251bWJlcn1cbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuYWxwaGEgPSAxO1xuICAgICAgLyoqXG4gICAgICAgKiBvYmplY3QncyB2aXNpYmlsaXR5XG4gICAgICAgQHR5cGUge2Jvb2xlYW59XG4gICAgICAgKi9cbiAgICAgIHByaXZhdGVzLnZpc2libGUgPSB0cnVlO1xuXG4gICAgICBwcml2YXRlcy53aWR0aCA9IDA7XG4gICAgICBwcml2YXRlcy5oZWlnaHQgPSAwO1xuICAgIH1cblxuICAgIGdldCB3aWR0aCAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykud2lkdGg7XG4gICAgfVxuXG4gICAgc2V0IHdpZHRoICh2YWx1ZSkge1xuICAgICAgaW50ZXJuYWwodGhpcykud2lkdGggPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgaGVpZ2h0ICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5oZWlnaHQ7XG4gICAgfVxuXG4gICAgc2V0IGhlaWdodCAodmFsdWUpIHtcbiAgICAgIGludGVybmFsKHRoaXMpLmhlaWdodCA9IHZhbHVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gcmV0dXJuIHggcG9zaXRpb25cbiAgICAgKi9cbiAgICBnZXQgeCAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykueDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIG5ldyB4IHBvc2l0aW9uXG4gICAgICovXG4gICAgc2V0IHggKHZhbHVlKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUodmFsdWUpKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPSBwcml2YXRlcy54KSB7XG4gICAgICAgICAgcHJpdmF0ZXMueCA9IE1hdGguZmxvb3IodmFsdWUpO1xuICAgICAgICAgIHRoaXMuZW1pdChcImNoYW5nZVwiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5EaXNwbGF5LnNldCB4IDogaW52YWxpZCBhcmd1bWVudFwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybiB7bnVtYmVyfSByZXR1cm4geSBwb3NpdGlvblxuICAgICAqL1xuICAgIGdldCB5ICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS55O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgbmV3IHkgcG9zaXRpb25cbiAgICAgKi9cbiAgICBzZXQgeSAodmFsdWUpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkpIHtcbiAgICAgICAgaWYgKHZhbHVlICE9IHByaXZhdGVzLnkpIHtcbiAgICAgICAgICBwcml2YXRlcy55ID0gTWF0aC5mbG9vcih2YWx1ZSk7XG4gICAgICAgICAgdGhpcy5lbWl0KFwiY2hhbmdlXCIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKHZhbHVlLCB0aGlzKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLkRpc3BsYXkuc2V0IHkgOiBpbnZhbGlkIGFyZ3VtZW50XCIpO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IHJldHVybiBjZW50ZXIgeFxuICAgICAqL1xuICAgIGdldCBjZW50ZXJYICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5jZW50ZXJYO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgbmV3IGNlbnRlciB4XG4gICAgICovXG4gICAgc2V0IGNlbnRlclggKHZhbHVlKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUodmFsdWUpKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPSBwcml2YXRlcy5jZW50ZXJYKSB7XG4gICAgICAgICAgcHJpdmF0ZXMuY2VudGVyWCA9IE1hdGguZmxvb3IodmFsdWUpO1xuICAgICAgICAgIHRoaXMuZW1pdChcImNoYW5nZVwiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5EaXNwbGF5LnNldCBjZW50ZXJYIDogaW52YWxpZCBhcmd1bWVudFwiKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybiB7bnVtYmVyfSByZXR1cm4gY2VudGVyIHlcbiAgICAgKi9cbiAgICBnZXQgY2VudGVyWSAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuY2VudGVyWTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIG5ldyBjZW50ZXIgeVxuICAgICAqL1xuICAgIHNldCBjZW50ZXJZICh2YWx1ZSkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKHZhbHVlKSkge1xuICAgICAgICBpZiAodmFsdWUgIT0gcHJpdmF0ZXMuY2VudGVyWSkge1xuICAgICAgICAgIHByaXZhdGVzLmNlbnRlclkgPSBNYXRoLmZsb29yKHZhbHVlKTtcbiAgICAgICAgICB0aGlzLmVtaXQoXCJjaGFuZ2VcIik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IodmFsdWUsIHRoaXMpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuRGlzcGxheS5zZXQgY2VudGVyWSA6IGludmFsaWQgYXJndW1lbnRcIik7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gcmV0dXJuIGFscGhhXG4gICAgICovXG4gICAgZ2V0IGFscGhhICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgcmV0dXJuIHByaXZhdGVzLmFscGhhO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgbmV3IGFscGhhXG4gICAgICovXG4gICAgc2V0IGFscGhhICh2YWx1ZSkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKHZhbHVlKSAmJiAodmFsdWUgPj0gMCB8fCB2YWx1ZSA8PSAxKSkge1xuICAgICAgICBpZiAodmFsdWUgIT0gcHJpdmF0ZXMuYWxwaGEpIHtcbiAgICAgICAgICBwcml2YXRlcy5hbHBoYSA9IHZhbHVlO1xuICAgICAgICAgIHRoaXMuZW1pdChcImNoYW5nZVwiKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5EaXNwbGF5LnNldCBhbHBoYSA6IGludmFsaWQgYXJndW1lbnRcIik7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge2Jvb2xlYW59IHJldHVybiBhbHBoYVxuICAgICAqL1xuICAgIGdldCB2aXNpYmxlICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgcmV0dXJuIHByaXZhdGVzLnZpc2libGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUgbmV3IHZpc2libGVcbiAgICAgKi9cbiAgICBzZXQgdmlzaWJsZSAodmFsdWUpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgaWYgKHZhbHVlICE9IHByaXZhdGVzLnZpc2libGUpIHtcbiAgICAgICAgcHJpdmF0ZXMudmlzaWJsZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmVtaXQoXCJjaGFuZ2VcIik7XG4gICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEludGVyZmFjZSwgc3ViLWNsYXNzIHNob3VsZCBvdmVybG9hZCB0aGlzIG1ldGhvZFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZW5kZXJlclxuICAgICAqL1xuICAgIGRyYXcgKHJlbmRlcmVyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwic3ViLWNsYXNzIHNob3VsZCBvdmVycmlkZSB0aGlzIGZ1bmN0aW9uXCIpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBjYWxsIFNwcml0ZS5EaXNwbGF5LmRyYXdcIik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIHRoZSB4LHkgaGl0IHRoaXMgb2JqZWN0IG9yIG5vdFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB4IHRoZSB4IHBvc2l0aW9uIG9mIHNjcmVlbiAobWF5IDAgdG8gNjQwKSBmb3IgdGVzdFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB5IHRoZSB5IHBvc2l0aW9uIG9mIHNjcmVlbiAobWF5IDAgdG8gNDgwKSBmb3IgdGVzdFxuICAgICAqL1xuICAgIGhpdFRlc3QgKHgsIHkpIHtcbiAgICAgIGhpdENvbnRleHQuY2xlYXJSZWN0KDAsIDAsIDEsIDEpO1xuICAgICAgaGl0Q29udGV4dC5zYXZlKCk7XG4gICAgICBoaXRDb250ZXh0LnRyYW5zbGF0ZSgteCwgLXkpO1xuICAgICAgdGhpcy5kcmF3KGhpdENvbnRleHQpO1xuICAgICAgaGl0Q29udGV4dC5yZXN0b3JlKCk7XG4gICAgICBsZXQgbmV3RGF0YSA9IGhpdENvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIDEsIDEpLmRhdGE7XG5cbiAgICAgIGlmIChoaXREYXRhWzBdICE9IG5ld0RhdGFbMF0gfHwgaGl0RGF0YVsxXSAhPSBuZXdEYXRhWzFdIHx8IGhpdERhdGFbMl0gIT0gbmV3RGF0YVsyXSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cblxuICAgIGRyYXdQb3NpdGlvbiAoKSB7XG5cbiAgICAgIGxldCBjZW50ZXJYID0gdGhpcy5jZW50ZXJYO1xuICAgICAgbGV0IGNlbnRlclkgPSB0aGlzLmNlbnRlclk7XG4gICAgICBsZXQgeCA9IHRoaXMueDtcbiAgICAgIGxldCB5ID0gdGhpcy55O1xuICAgICAgbGV0IGFscGhhID0gdGhpcy5hbHBoYTtcblxuICAgICAgbGV0IHBhcmVudCA9IHRoaXMucGFyZW50O1xuICAgICAgd2hpbGUgKHBhcmVudCkge1xuICAgICAgICBjZW50ZXJYICs9IHBhcmVudC5jZW50ZXJYO1xuICAgICAgICBjZW50ZXJZICs9IHBhcmVudC5jZW50ZXJZO1xuICAgICAgICB4ICs9IHBhcmVudC54O1xuICAgICAgICB5ICs9IHBhcmVudC55O1xuICAgICAgICBhbHBoYSAqPSBwYXJlbnQuYWxwaGE7XG4gICAgICAgIGlmIChhbHBoYSA8PSAwLjAwMSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJlbnQudmlzaWJsZSA9PSBmYWxzZSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHg6IHggLSBjZW50ZXJYLFxuICAgICAgICB5OiB5IC0gY2VudGVyWSxcbiAgICAgICAgYWxwaGE6IGFscGhhXG4gICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEcmF3IGFuIGltYWdlIHRvIHJlbmRlcmVyXG4gICAgICogeCwgeS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICogLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtXG4gICAgICogLSAgICBzeC5zeS0tLS0tLS0tLS0tLSAgICAgICAgICAgICAgICAgICAgICAtXG4gICAgICogLSAgICAtICAgICAgICAgICAgICAgLSAgICAgICAgICAgICAgICAgICAgICAtXG4gICAgICogLSAgICAtLS1zd2lkdGgsc2hlaWdodCAgICAgICAgICAgICAgICAgICAgICAtXG4gICAgICogLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtXG4gICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0taW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodFxuICAgICAqIENyb3AgaW1hZ2Ugd2l0aCBzeCwgc3ksIHN3aWR0aCBhbmQgc2hlaWdodCwgZHJhdyBpdCBvbiByZW5kZXJlclxuICAgICAqIHgsIHkgd2lsbCBiZSBjYWxjdWxhdGVkIGJ5IHRoaXMueCwgdGhpcy55LCB0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSBhbmQgc29tZSBwYXJlbnRzJyBhdHRyaWJ1dGVzXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlbmRlcmVyIEEgb2JqZWN0IHdobyBoYXMgZHJhd0ltYWdlIG1ldGhvZCwgZWcuIFNwcml0ZS5XZWJnbFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbWFnZVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzeFxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzeVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzd2lkdGhcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gc2hlaWdodFxuICAgICAqL1xuICAgIGRyYXdJbWFnZSAocmVuZGVyZXIsIGltYWdlLCBzeCwgc3ksIHN3aWR0aCwgc2hlaWdodCkge1xuICAgICAgaWYgKHRoaXMudmlzaWJsZSAhPSB0cnVlIHx8IHRoaXMuYWxwaGEgPCAwLjAxKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBsZXQgZCA9IHRoaXMuZHJhd1Bvc2l0aW9uKCk7XG4gICAgICBpZiAoIWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcmVuZGVyZXIuYWxwaGEgPSBkLmFscGhhO1xuXG4gICAgICB0cnkge1xuICAgICAgICByZW5kZXJlci5kcmF3SW1hZ2UoXG4gICAgICAgICAgaW1hZ2UsIHN4LCBzeSwgc3dpZHRoLCBzaGVpZ2h0LFxuICAgICAgICAgIGQueCwgZC55LCBzd2lkdGgsIHNoZWlnaHRcbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICBpbWFnZSwgc3gsIHN5LCBzd2lkdGgsIHNoZWlnaHQsXG4gICAgICAgICAgZC54LCBkLnksIHN3aWR0aCwgc2hlaWdodFxuICAgICAgICApO1xuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuXG4gICAgfVxuICB9KTtcblxuXG59KSgpO1xuIl19

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Class Sprite.Container, it's a general container
 * Contain Sprite.Sheet, Sprite.Bitmap, Sprite.Shape, Sprite.Text, Sprite.Frame or Sprite.Container
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
   * Contain everything which inherit from Sprite.Display
   * @class
   */
  Sprite.assign("Container", (function (_Sprite$Display) {
    _inherits(SpriteContainer, _Sprite$Display);

    /**
     * Construct Sprite.Container
     * @constructor
     */

    function SpriteContainer() {
      _classCallCheck(this, SpriteContainer);

      _get(Object.getPrototypeOf(SpriteContainer.prototype), "constructor", this).call(this);
      var privates = internal(this);
      /**
       * Contain all children element
       * @private
       */
      privates.children = [];
      /**
       * Cached canvas
       */
      privates.cacheCanvas = null;
    }

    /**
     * @return {Array} Children array
     */

    _createClass(SpriteContainer, [{
      key: "findMinMax",
      value: function findMinMax() {
        var minX = null,
            minY = null,
            maxX = null,
            maxY = null;

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this.children[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var child = _step.value;

            if (child.findMinMax) {
              var r = child.findMinMax();
              if (minX === null || minX > r.minX) {
                minX = r.minX;
              }
              if (minY === null || minY > r.minY) {
                minY = r.minY;
              }
              if (maxX === null || maxX < r.maxX) {
                maxX = r.maxX;
              }
              if (maxY === null || maxY < r.maxY) {
                maxY = r.maxY;
              }
            } else {
              if (minX === null || minX > child.x) {
                minX = child.x;
              }
              if (minY === null || minY > child.y) {
                minY = child.y;
              }
              if (child.width && child.height) {
                if (maxX === null || maxX < child.x + child.width) {
                  maxX = child.x + child.width;
                }
                if (maxY === null || maxY < child.y + child.height) {
                  maxY = child.y + child.height;
                }
              }
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator["return"]) {
              _iterator["return"]();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        return {
          minX: minX, minY: minY, maxX: maxX, maxY: maxY
        };
      }

      /**
       * Remove canvas cache
       */
    }, {
      key: "clearCache",
      value: function clearCache() {
        var privates = internal(this);
        privates.cacheCanvas = null;
        if (privates.cacheX) {
          delete privates.cacheX;
        }
        if (privates.cacheY) {
          delete privates.cacheY;
        }
        if (privates.cacheWidth) {
          delete privates.cacheWidth;
        }
        if (privates.cacheHeight) {
          delete privates.cacheHeight;
        }
      }

      /**
       * Prerender all children as cache
       * generate a just size cache
       */
    }, {
      key: "cache",
      value: function cache(x, y, width, height) {
        var privates = internal(this);
        if (privates.cacheCanvas) {
          this.clearCache();
        }
        var p = this.parent;
        this.parent = null;

        var r = this.findMinMax();
        if (r && Number.isFinite(r.minX) && Number.isFinite(r.minY) && Number.isFinite(r.maxX) && Number.isFinite(r.maxY)) {
          var _width = r.maxX - r.minX;
          var _height = r.maxY - r.minY;
          var canvas = document.createElement("canvas");
          canvas.width = _width;
          canvas.height = _height;
          var context = canvas.getContext("2d");
          context.save();
          context.translate(-r.minX, -r.minY);
          this.draw(context);
          context.restore();
          privates.cacheX = r.minX;
          privates.cacheY = r.minY;
          privates.cacheWidth = _width;
          privates.cacheHeight = _height;
          privates.cacheCanvas = canvas;
        } else {
          console.error(r);
          throw new Error("Sprite.Container.cache cannot work something wrong");
        }

        this.parent = p;
      }
    }, {
      key: "hitTest",

      /**
       * Hit test
       */
      value: function hitTest(x, y) {
        var privates = internal(this);
        if (this.cacheCanvas) {
          return _get(Object.getPrototypeOf(SpriteContainer.prototype), "hitTest", this).call(this, x, y);
        } else {
          var hitted = [];
          var _iteratorNormalCompletion2 = true;
          var _didIteratorError2 = false;
          var _iteratorError2 = undefined;

          try {
            for (var _iterator2 = this.children[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              var child = _step2.value;

              var ret = child.hitTest(x, y);
              if (ret instanceof Array) {
                hitted = hitted.concat(ret);
              } else if (ret === true) {
                hitted.push(child);
              }
            }
          } catch (err) {
            _didIteratorError2 = true;
            _iteratorError2 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
                _iterator2["return"]();
              }
            } finally {
              if (_didIteratorError2) {
                throw _iteratorError2;
              }
            }
          }

          return hitted;
        }
      }

      /**
       * Draw all children in this container on context
       * @param {Object} renderer Sprite.Webgl/Sprite.Canvas/Context
       */
    }, {
      key: "draw",
      value: function draw(renderer) {
        var privates = internal(this);
        if (this.alpha < 0.01 || this.visible != true) {
          return;
        }

        if (this.cacheCanvas) {
          var x = this.x;
          var y = this.y;
          this.x += privates.cacheX;
          this.y += privates.cacheY;
          this.drawImage(renderer, this.cacheCanvas, 0, 0, this.cacheCanvas.width, this.cacheCanvas.height);
          this.x = x;
          this.y = y;
        } else {
          if (this.children.length > 0) {
            var _iteratorNormalCompletion3 = true;
            var _didIteratorError3 = false;
            var _iteratorError3 = undefined;

            try {
              for (var _iterator3 = this.children[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                var child = _step3.value;

                if (child.visible == true && child.alpha >= 0.01) {
                  child.draw(renderer);
                }
              }
            } catch (err) {
              _didIteratorError3 = true;
              _iteratorError3 = err;
            } finally {
              try {
                if (!_iteratorNormalCompletion3 && _iterator3["return"]) {
                  _iterator3["return"]();
                }
              } finally {
                if (_didIteratorError3) {
                  throw _iteratorError3;
                }
              }
            }
          }
        }
      }

      /**
      */
    }, {
      key: "hasChild",
      value: function hasChild(element) {
        if (this.children.indexOf(element) != -1) {
          return true;
        }
        return false;
      }

      /**
       * Append one or more children into container
       * eg. c.appendChild(childA) c.appendChild(childA, childB)
       * @param one or more children
       */
    }, {
      key: "appendChild",
      value: function appendChild() {
        var args = Array.prototype.slice.call(arguments);

        if (args.length <= 0) {
          throw new Error("Sprite.Container.appendChild got an invalid arguments");
        }

        var _iteratorNormalCompletion4 = true;
        var _didIteratorError4 = false;
        var _iteratorError4 = undefined;

        try {
          for (var _iterator4 = args[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
            var element = _step4.value;

            if (element instanceof Sprite.Display == false) {
              console.error(element);
              throw new Error("Sprite.Container.appendChild only accept Sprite.Display or it's sub-class");
            }
            element.parent = this;
            this.children.push(element);
          }
        } catch (err) {
          _didIteratorError4 = true;
          _iteratorError4 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion4 && _iterator4["return"]) {
              _iterator4["return"]();
            }
          } finally {
            if (_didIteratorError4) {
              throw _iteratorError4;
            }
          }
        }

        this.emit("addedChildren");
      }

      /**
       * Append one or more children into container at certain position
       * eg. c.appendChildAt(0, childA) c.appendChildAt(0, childA, childB)
       * @param one or more children
       */
    }, {
      key: "appendChildAt",
      value: function appendChildAt() {
        var args = Array.prototype.slice.call(arguments);

        if (args.length <= 1) {
          console.log(arguments, this);
          throw new TypeError("Sprite.Container.appendChildAt has an invalid arguments");
        }

        var index = args[0];
        for (var i = 1, len = args.length; i < len; i++) {
          if (args[i] instanceof Sprite.Display == false) {
            console.error(args[i]);
            throw new Error("Sprite.Container.appendChildAt only can accept Sprite.Display or it's sub-class");
          }
          args[i].parent = this;
          this.children.splice(index, 0, args[i]);
        }

        this.emit("addedChildren");
      }

      /**
       * Remove one child from a container
       * eg. c.removeChild(childA)
       * @param {Object} element The child you want to remove
       * @return {boolean} If found and removed element, return true, otherwise, false
       */
    }, {
      key: "removeChild",
      value: function removeChild(element) {
        var index = this.children.indexOf(element);
        if (index != -1) {
          // found it
          this.children[index].parent = null;
          this.children.splice(index, 1);
          this.emit("removedChildren");
          return true;
        } else {
          // not found, element not a child
          return false;
        }
      }

      /**
       * remove all children of container
       */
    }, {
      key: "clear",
      value: function clear() {
        var privates = internal(this);
        var _iteratorNormalCompletion5 = true;
        var _didIteratorError5 = false;
        var _iteratorError5 = undefined;

        try {
          for (var _iterator5 = privates.children[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
            var child = _step5.value;

            child.parent = null;
          }
        } catch (err) {
          _didIteratorError5 = true;
          _iteratorError5 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion5 && _iterator5["return"]) {
              _iterator5["return"]();
            }
          } finally {
            if (_didIteratorError5) {
              throw _iteratorError5;
            }
          }
        }

        privates.children = [];
        this.clearCache();
        this.emit("removedChildren");
      }
    }, {
      key: "children",
      get: function get() {
        return internal(this).children;
      },
      set: function set(value) {
        throw new Error("Sprite.Container.children readonly");
      }

      /**
       * @return {Object} Cached canvas
       */
    }, {
      key: "cacheCanvas",
      get: function get() {
        return internal(this).cacheCanvas;
      },
      set: function set(value) {
        throw new Error("Sprite.Container.cacheCanvas readonly");
      }
    }, {
      key: "cacheX",
      get: function get() {
        return internal(this).cacheX;
      },
      set: function set(value) {
        throw new Error("Sprite.Container.cacheX readonly");
      }
    }, {
      key: "cacheY",
      get: function get() {
        return internal(this).cacheY;
      },
      set: function set(value) {
        throw new Error("Sprite.Container.cacheY readonly");
      }
    }]);

    return SpriteContainer;
  })(Sprite.Display));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlQ29udGFpbmVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBCQSxDQUFDLFlBQVk7QUFDWixjQUFZLENBQUM7O0FBRVosTUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDOzs7Ozs7QUFNbEMsUUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXO2NBQVEsZUFBZTs7Ozs7OztBQU1sQyxhQU5tQixlQUFlLEdBTS9COzRCQU5nQixlQUFlOztBQU81QyxpQ0FQNkIsZUFBZSw2Q0FPcEM7QUFDUixVQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7Ozs7O0FBSzlCLGNBQVEsQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDOzs7O0FBSXZCLGNBQVEsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO0tBQzdCOzs7Ozs7aUJBbEI4QixlQUFlOzthQTBDbkMsc0JBQUc7QUFDWixZQUFJLElBQUksR0FBRyxJQUFJO1lBQUUsSUFBSSxHQUFHLElBQUk7WUFBRSxJQUFJLEdBQUcsSUFBSTtZQUFFLElBQUksR0FBRyxJQUFJLENBQUM7Ozs7Ozs7QUFFdkQsK0JBQWtCLElBQUksQ0FBQyxRQUFRLDhIQUFFO2dCQUF4QixLQUFLOztBQUNaLGdCQUFJLEtBQUssQ0FBQyxVQUFVLEVBQUU7QUFDcEIsa0JBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQztBQUMzQixrQkFBSSxJQUFJLEtBQUssSUFBSSxJQUFJLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFO0FBQ2xDLG9CQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztlQUNmO0FBQ0Qsa0JBQUksSUFBSSxLQUFLLElBQUksSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRTtBQUNsQyxvQkFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7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dEIsY0FBTSxJQUFJLEtBQUssQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO09BQzFEOzs7V0F5R1UsZUFBRztBQUNaLGVBQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQztPQUM5QjtXQUVVLGFBQUMsS0FBSyxFQUFFO0FBQ2pCLGNBQU0sSUFBSSxLQUFLLENBQUMsa0NBQWtDLENBQUMsQ0FBQztPQUNyRDs7O1dBRVUsZUFBRztBQUNaLGVBQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQztPQUM5QjtXQUVVLGFBQUMsS0FBSyxFQUFFO0FBQ2pCLGNBQU0sSUFBSSxLQUFLLENBQUMsa0NBQWtDLENBQUMsQ0FBQztPQUNyRDs7O1dBL0o4QixlQUFlO0tBQVMsTUFBTSxDQUFDLE9BQU8sRUE4U3JFLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJTcHJpdGVDb250YWluZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ2xhc3MgU3ByaXRlLkNvbnRhaW5lciwgaXQncyBhIGdlbmVyYWwgY29udGFpbmVyXG4gKiBDb250YWluIFNwcml0ZS5TaGVldCwgU3ByaXRlLkJpdG1hcCwgU3ByaXRlLlNoYXBlLCBTcHJpdGUuVGV4dCwgU3ByaXRlLkZyYW1lIG9yIFNwcml0ZS5Db250YWluZXJcbiAqIEBhdXRob3IgbWFpbEBxaGR1YW4uY29tIChRSCBEdWFuKVxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gIC8qKlxuICAgKiBDb250YWluIGV2ZXJ5dGhpbmcgd2hpY2ggaW5oZXJpdCBmcm9tIFNwcml0ZS5EaXNwbGF5XG4gICAqIEBjbGFzc1xuICAgKi9cbiAgU3ByaXRlLmFzc2lnbihcIkNvbnRhaW5lclwiLCBjbGFzcyBTcHJpdGVDb250YWluZXIgZXh0ZW5kcyBTcHJpdGUuRGlzcGxheSB7XG5cbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3QgU3ByaXRlLkNvbnRhaW5lclxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yICgpIHtcbiAgICAgIHN1cGVyKCk7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIC8qKlxuICAgICAgICogQ29udGFpbiBhbGwgY2hpbGRyZW4gZWxlbWVudFxuICAgICAgICogQHByaXZhdGVcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuY2hpbGRyZW4gPSBbXTtcbiAgICAgIC8qKlxuICAgICAgICogQ2FjaGVkIGNhbnZhc1xuICAgICAgICovXG4gICAgICBwcml2YXRlcy5jYWNoZUNhbnZhcyA9IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybiB7QXJyYXl9IENoaWxkcmVuIGFycmF5XG4gICAgICovXG4gICAgZ2V0IGNoaWxkcmVuICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5jaGlsZHJlbjtcbiAgICB9XG5cbiAgICBzZXQgY2hpbGRyZW4gKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuQ29udGFpbmVyLmNoaWxkcmVuIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge09iamVjdH0gQ2FjaGVkIGNhbnZhc1xuICAgICAqL1xuICAgIGdldCBjYWNoZUNhbnZhcyAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuY2FjaGVDYW52YXM7XG4gICAgfVxuXG4gICAgc2V0IGNhY2hlQ2FudmFzICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLkNvbnRhaW5lci5jYWNoZUNhbnZhcyByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBmaW5kTWluTWF4ICgpIHtcbiAgICAgIGxldCBtaW5YID0gbnVsbCwgbWluWSA9IG51bGwsIG1heFggPSBudWxsLCBtYXhZID0gbnVsbDtcblxuICAgICAgZm9yIChsZXQgY2hpbGQgb2YgdGhpcy5jaGlsZHJlbikge1xuICAgICAgICBpZiAoY2hpbGQuZmluZE1pbk1heCkge1xuICAgICAgICAgIGxldCByID0gY2hpbGQuZmluZE1pbk1heCgpO1xuICAgICAgICAgIGlmIChtaW5YID09PSBudWxsIHx8IG1pblggPiByLm1pblgpIHtcbiAgICAgICAgICAgIG1pblggPSByLm1pblg7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtaW5ZID09PSBudWxsIHx8IG1pblkgPiByLm1pblkpIHtcbiAgICAgICAgICAgIG1pblkgPSByLm1pblk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtYXhYID09PSBudWxsIHx8IG1heFggPCByLm1heFgpIHtcbiAgICAgICAgICAgIG1heFggPSByLm1heFg7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtYXhZID09PSBudWxsIHx8IG1heFkgPCByLm1heFkpIHtcbiAgICAgICAgICAgIG1heFkgPSByLm1heFk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChtaW5YID09PSBudWxsIHx8IG1pblggPiBjaGlsZC54KSB7XG4gICAgICAgICAgICBtaW5YID0gY2hpbGQueDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1pblkgPT09IG51bGwgfHwgbWluWSA+IGNoaWxkLnkpIHtcbiAgICAgICAgICAgIG1pblkgPSBjaGlsZC55O1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2hpbGQud2lkdGggJiYgY2hpbGQuaGVpZ2h0KSB7XG4gICAgICAgICAgICBpZiAobWF4WCA9PT0gbnVsbCB8fCBtYXhYIDwgY2hpbGQueCArIGNoaWxkLndpZHRoKSB7XG4gICAgICAgICAgICAgIG1heFggPSBjaGlsZC54ICsgY2hpbGQud2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWF4WSA9PT0gbnVsbCB8fCBtYXhZIDwgY2hpbGQueSArIGNoaWxkLmhlaWdodCkge1xuICAgICAgICAgICAgICBtYXhZID0gY2hpbGQueSArIGNoaWxkLmhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1pblgsIG1pblksIG1heFgsIG1heFlcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGNhbnZhcyBjYWNoZVxuICAgICAqL1xuICAgIGNsZWFyQ2FjaGUgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBwcml2YXRlcy5jYWNoZUNhbnZhcyA9IG51bGw7XG4gICAgICBpZiAocHJpdmF0ZXMuY2FjaGVYKSB7XG4gICAgICAgIGRlbGV0ZSBwcml2YXRlcy5jYWNoZVg7XG4gICAgICB9XG4gICAgICBpZiAocHJpdmF0ZXMuY2FjaGVZKSB7XG4gICAgICAgIGRlbGV0ZSBwcml2YXRlcy5jYWNoZVk7XG4gICAgICB9XG4gICAgICBpZiAocHJpdmF0ZXMuY2FjaGVXaWR0aCkge1xuICAgICAgICBkZWxldGUgcHJpdmF0ZXMuY2FjaGVXaWR0aDtcbiAgICAgIH1cbiAgICAgIGlmIChwcml2YXRlcy5jYWNoZUhlaWdodCkge1xuICAgICAgICBkZWxldGUgcHJpdmF0ZXMuY2FjaGVIZWlnaHQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJlcmVuZGVyIGFsbCBjaGlsZHJlbiBhcyBjYWNoZVxuICAgICAqIGdlbmVyYXRlIGEganVzdCBzaXplIGNhY2hlXG4gICAgICovXG4gICAgY2FjaGUgKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgaWYgKHByaXZhdGVzLmNhY2hlQ2FudmFzKSB7XG4gICAgICAgIHRoaXMuY2xlYXJDYWNoZSgpO1xuICAgICAgfVxuICAgICAgbGV0IHAgPSB0aGlzLnBhcmVudDtcbiAgICAgIHRoaXMucGFyZW50ID0gbnVsbDtcblxuICAgICAgbGV0IHIgPSB0aGlzLmZpbmRNaW5NYXgoKTtcbiAgICAgIGlmIChcbiAgICAgICAgciAmJlxuICAgICAgICBOdW1iZXIuaXNGaW5pdGUoci5taW5YKSAmJlxuICAgICAgICBOdW1iZXIuaXNGaW5pdGUoci5taW5ZKSAmJlxuICAgICAgICBOdW1iZXIuaXNGaW5pdGUoci5tYXhYKSAmJlxuICAgICAgICBOdW1iZXIuaXNGaW5pdGUoci5tYXhZKVxuICAgICAgKSB7XG4gICAgICAgIGxldCB3aWR0aCA9IHIubWF4WCAtIHIubWluWDtcbiAgICAgICAgbGV0IGhlaWdodCA9IHIubWF4WSAtIHIubWluWTtcbiAgICAgICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICBsZXQgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgIGNvbnRleHQuc2F2ZSgpO1xuICAgICAgICBjb250ZXh0LnRyYW5zbGF0ZSgtci5taW5YLCAtci5taW5ZKTtcbiAgICAgICAgdGhpcy5kcmF3KGNvbnRleHQpO1xuICAgICAgICBjb250ZXh0LnJlc3RvcmUoKTtcbiAgICAgICAgcHJpdmF0ZXMuY2FjaGVYID0gci5taW5YO1xuICAgICAgICBwcml2YXRlcy5jYWNoZVkgPSByLm1pblk7XG4gICAgICAgIHByaXZhdGVzLmNhY2hlV2lkdGggPSB3aWR0aDtcbiAgICAgICAgcHJpdmF0ZXMuY2FjaGVIZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHByaXZhdGVzLmNhY2hlQ2FudmFzID0gY2FudmFzO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihyKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLkNvbnRhaW5lci5jYWNoZSBjYW5ub3Qgd29yayBzb21ldGhpbmcgd3JvbmdcIik7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucGFyZW50ID0gcDtcbiAgICB9XG5cbiAgICBnZXQgY2FjaGVYICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5jYWNoZVg7XG4gICAgfVxuXG4gICAgc2V0IGNhY2hlWCAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5Db250YWluZXIuY2FjaGVYIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGdldCBjYWNoZVkgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmNhY2hlWTtcbiAgICB9XG5cbiAgICBzZXQgY2FjaGVZICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLkNvbnRhaW5lci5jYWNoZVkgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGl0IHRlc3RcbiAgICAgKi9cbiAgICBoaXRUZXN0ICh4LCB5KSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmICh0aGlzLmNhY2hlQ2FudmFzKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5oaXRUZXN0KHgsIHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGhpdHRlZCA9IFtdO1xuICAgICAgICBmb3IgKGxldCBjaGlsZCBvZiB0aGlzLmNoaWxkcmVuKSB7XG4gICAgICAgICAgbGV0IHJldCA9IGNoaWxkLmhpdFRlc3QoeCwgeSk7XG4gICAgICAgICAgaWYgKHJldCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICBoaXR0ZWQgPSBoaXR0ZWQuY29uY2F0KHJldCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChyZXQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGhpdHRlZC5wdXNoKGNoaWxkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGhpdHRlZDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEcmF3IGFsbCBjaGlsZHJlbiBpbiB0aGlzIGNvbnRhaW5lciBvbiBjb250ZXh0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlbmRlcmVyIFNwcml0ZS5XZWJnbC9TcHJpdGUuQ2FudmFzL0NvbnRleHRcbiAgICAgKi9cbiAgICBkcmF3IChyZW5kZXJlcikge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAodGhpcy5hbHBoYSA8IDAuMDEgfHwgdGhpcy52aXNpYmxlICE9IHRydWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5jYWNoZUNhbnZhcykge1xuICAgICAgICBsZXQgeCA9IHRoaXMueDtcbiAgICAgICAgbGV0IHkgPSB0aGlzLnk7XG4gICAgICAgIHRoaXMueCArPSBwcml2YXRlcy5jYWNoZVg7XG4gICAgICAgIHRoaXMueSArPSBwcml2YXRlcy5jYWNoZVk7XG4gICAgICAgIHRoaXMuZHJhd0ltYWdlKHJlbmRlcmVyLCB0aGlzLmNhY2hlQ2FudmFzLFxuICAgICAgICAgIDAsIDAsIHRoaXMuY2FjaGVDYW52YXMud2lkdGgsIHRoaXMuY2FjaGVDYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy54ID0geDtcbiAgICAgICAgdGhpcy55ID0geTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBmb3IgKGxldCBjaGlsZCBvZiB0aGlzLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICBpZiAoY2hpbGQudmlzaWJsZSA9PSB0cnVlICYmIGNoaWxkLmFscGhhID49IDAuMDEpIHtcbiAgICAgICAgICAgICAgY2hpbGQuZHJhdyhyZW5kZXJlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKi9cbiAgICBoYXNDaGlsZCAoZWxlbWVudCkge1xuICAgICAgaWYgKHRoaXMuY2hpbGRyZW4uaW5kZXhPZihlbGVtZW50KSAhPSAtMSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBcHBlbmQgb25lIG9yIG1vcmUgY2hpbGRyZW4gaW50byBjb250YWluZXJcbiAgICAgKiBlZy4gYy5hcHBlbmRDaGlsZChjaGlsZEEpIGMuYXBwZW5kQ2hpbGQoY2hpbGRBLCBjaGlsZEIpXG4gICAgICogQHBhcmFtIG9uZSBvciBtb3JlIGNoaWxkcmVuXG4gICAgICovXG4gICAgYXBwZW5kQ2hpbGQgKCkge1xuICAgICAgbGV0IGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuXG4gICAgICBpZiAoYXJncy5sZW5ndGggPD0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuQ29udGFpbmVyLmFwcGVuZENoaWxkIGdvdCBhbiBpbnZhbGlkIGFyZ3VtZW50c1wiKTtcbiAgICAgIH1cblxuICAgICAgZm9yIChsZXQgZWxlbWVudCBvZiBhcmdzKSB7XG4gICAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgU3ByaXRlLkRpc3BsYXkgPT0gZmFsc2UpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVsZW1lbnQpO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5Db250YWluZXIuYXBwZW5kQ2hpbGQgb25seSBhY2NlcHQgU3ByaXRlLkRpc3BsYXkgb3IgaXQncyBzdWItY2xhc3NcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudC5wYXJlbnQgPSB0aGlzO1xuICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goZWxlbWVudCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZW1pdChcImFkZGVkQ2hpbGRyZW5cIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBwZW5kIG9uZSBvciBtb3JlIGNoaWxkcmVuIGludG8gY29udGFpbmVyIGF0IGNlcnRhaW4gcG9zaXRpb25cbiAgICAgKiBlZy4gYy5hcHBlbmRDaGlsZEF0KDAsIGNoaWxkQSkgYy5hcHBlbmRDaGlsZEF0KDAsIGNoaWxkQSwgY2hpbGRCKVxuICAgICAqIEBwYXJhbSBvbmUgb3IgbW9yZSBjaGlsZHJlblxuICAgICAqL1xuICAgIGFwcGVuZENoaWxkQXQgKCkge1xuICAgICAgbGV0IGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuXG4gICAgICBpZiAoYXJncy5sZW5ndGggPD0gMSkge1xuICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHMsIHRoaXMpO1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ByaXRlLkNvbnRhaW5lci5hcHBlbmRDaGlsZEF0IGhhcyBhbiBpbnZhbGlkIGFyZ3VtZW50c1wiKTtcbiAgICAgIH1cblxuICAgICAgbGV0IGluZGV4ID0gYXJnc1swXTtcbiAgICAgIGZvciAobGV0IGkgPSAxLCBsZW4gPSBhcmdzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmIChhcmdzW2ldIGluc3RhbmNlb2YgU3ByaXRlLkRpc3BsYXkgPT0gZmFsc2UpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGFyZ3NbaV0pO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5Db250YWluZXIuYXBwZW5kQ2hpbGRBdCBvbmx5IGNhbiBhY2NlcHQgU3ByaXRlLkRpc3BsYXkgb3IgaXQncyBzdWItY2xhc3NcIik7XG4gICAgICAgIH1cbiAgICAgICAgYXJnc1tpXS5wYXJlbnQgPSB0aGlzO1xuICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgYXJnc1tpXSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZW1pdChcImFkZGVkQ2hpbGRyZW5cIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIG9uZSBjaGlsZCBmcm9tIGEgY29udGFpbmVyXG4gICAgICogZWcuIGMucmVtb3ZlQ2hpbGQoY2hpbGRBKVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlbGVtZW50IFRoZSBjaGlsZCB5b3Ugd2FudCB0byByZW1vdmVcbiAgICAgKiBAcmV0dXJuIHtib29sZWFufSBJZiBmb3VuZCBhbmQgcmVtb3ZlZCBlbGVtZW50LCByZXR1cm4gdHJ1ZSwgb3RoZXJ3aXNlLCBmYWxzZVxuICAgICAqL1xuICAgIHJlbW92ZUNoaWxkIChlbGVtZW50KSB7XG4gICAgICBsZXQgaW5kZXggPSB0aGlzLmNoaWxkcmVuLmluZGV4T2YoZWxlbWVudCk7XG4gICAgICBpZiAoaW5kZXggIT0gLTEpIHsgLy8gZm91bmQgaXRcbiAgICAgICAgdGhpcy5jaGlsZHJlbltpbmRleF0ucGFyZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB0aGlzLmVtaXQoXCJyZW1vdmVkQ2hpbGRyZW5cIik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHsgLy8gbm90IGZvdW5kLCBlbGVtZW50IG5vdCBhIGNoaWxkXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiByZW1vdmUgYWxsIGNoaWxkcmVuIG9mIGNvbnRhaW5lclxuICAgICAqL1xuICAgIGNsZWFyICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgZm9yIChsZXQgY2hpbGQgb2YgcHJpdmF0ZXMuY2hpbGRyZW4pIHtcbiAgICAgICAgY2hpbGQucGFyZW50ID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHByaXZhdGVzLmNoaWxkcmVuID0gW107XG4gICAgICB0aGlzLmNsZWFyQ2FjaGUoKTtcbiAgICAgIHRoaXMuZW1pdChcInJlbW92ZWRDaGlsZHJlblwiKTtcbiAgICB9XG5cbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Class Sprite.Stage
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
   * Main Stage, display object
   * @class
   * @extends Sprite.Container
   */
  Sprite.assign("Stage", (function (_Sprite$Container) {
    _inherits(SpriteStage, _Sprite$Container);

    /** @function Sprite.Stage.constructor
     * consturct a Sprite.Stage with width and height
     * @constructor
     * @param width, the width of stage you need
     * @param height, the height of stage you need
     */

    function SpriteStage(width, height) {
      _classCallCheck(this, SpriteStage);

      _get(Object.getPrototypeOf(SpriteStage.prototype), "constructor", this).call(this);
      var privates = internal(this);

      if (!privates.renderer && Sprite.Webgl.support()) {
        privates.renderer = new Sprite.Webgl(width, height);
        privates.rendererType = "webgl";
      }

      // canvas 2d first
      if (!privates.renderer && Sprite.Canvas.support()) {
        privates.renderer = new Sprite.Canvas(width, height);
        privates.rendererType = "canvas";
      }

      if (!privates.renderer) {
        throw new Error("Sprite.Stage all renderer not support");
      }

      /**
      * color when stage is empty
      */
      privates.color = "#000000";
    }

    _createClass(SpriteStage, [{
      key: "releaseRenderer",
      value: function releaseRenderer() {
        internal(this).renderer.release();
      }
    }, {
      key: "filter",
      value: function filter(name, value) {
        return internal(this).renderer.filter(name, value);
      }
    }, {
      key: "findHit",
      value: function findHit(event) {
        var hitted = this.hitTest(this.mouseX, this.mouseY);
        hitted.reverse();
        if (hitted.length) return hitted;
        return null;
      }
    }, {
      key: "clear",

      /// @function Sprite.Stage.clear
      /// clear the stage
      value: function clear() {
        internal(this).renderer.clear();
      }
    }, {
      key: "update",
      value: function update() {
        this.emit("beforeDraw");
        this.draw(this.renderer);
        this.emit("afterDraw");
      }
    }, {
      key: "draw",
      value: function draw(renderer) {
        /** this.children, never privates.children, because children are super's */
        if (this.children.length <= 0) {
          return false;
        }

        this.clear();

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this.children[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var child = _step.value;

            child.draw(renderer);
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator["return"]) {
              _iterator["return"]();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      }
    }, {
      key: "renderer",
      get: function get() {
        return internal(this).renderer;
      },
      set: function set(value) {
        throw new Error("Sprite.Stage renderer readonly");
      }
    }, {
      key: "rendererType",
      get: function get() {
        return internal(this).rendererType;
      },
      set: function set(value) {
        throw new Error("Sprite.Stage.rendererType readonly");
      }
    }, {
      key: "width",
      get: function get() {
        return internal(this).renderer.width;
      },
      set: function set(value) {
        internal(this).renderer.width = value;
      }
    }, {
      key: "height",
      get: function get() {
        return internal(this).renderer.height;
      },
      set: function set(value) {
        internal(this).renderer.height = value;
      }
    }, {
      key: "color",
      get: function get() {
        return internal(this).renderer.color;
      },
      set: function set(value) {
        internal(this).renderer.color = value;
      }
    }, {
      key: "canvas",
      get: function get() {
        return this.renderer.canvas;
      },
      set: function set(value) {
        throw new Error("Sprite.Stage.canvas readonly");
      }
    }]);

    return SpriteStage;
  })(Sprite.Container));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlU3RhZ2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5QkEsQ0FBQyxZQUFZO0FBQ1osY0FBWSxDQUFDOztBQUVaLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7Ozs7OztBQU9sQyxRQUFNLENBQUMsTUFBTSxDQUFDLE9BQU87Y0FBUSxXQUFXOzs7Ozs7Ozs7QUFRMUIsYUFSZSxXQUFXLENBUXpCLEtBQUssRUFBRSxNQUFNLEVBQUU7NEJBUkQsV0FBVzs7QUFTcEMsaUNBVHlCLFdBQVcsNkNBUzVCO0FBQ1IsVUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUU5QixVQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxFQUFFO0FBQ2hELGdCQUFRLENBQUMsUUFBUSxHQUFHLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDcEQsZ0JBQVEsQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDO09BQ2pDOzs7QUFHRCxVQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFO0FBQ2pELGdCQUFRLENBQUMsUUFBUSxHQUFHLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDckQsZ0JBQVEsQ0FBQyxZQUFZLEdBQUcsUUFBUSxDQUFDO09BQ2xDOztBQUVELFVBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFO0FBQ3RCLGNBQU0sSUFBSSxLQUFLLENBQUMsdUNBQXVDLENBQUMsQ0FBQztPQUMxRDs7Ozs7QUFLRCxjQUFRLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQztLQUM1Qjs7aUJBL0IwQixX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QUFTLEVBMEgvRCxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiU3ByaXRlU3RhZ2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ2xhc3MgU3ByaXRlLlN0YWdlXG4gKiBAYXV0aG9yIG1haWxAcWhkdWFuLmNvbSAoUUggRHVhbilcbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCBpbnRlcm5hbCA9IFNwcml0ZS5OYW1lc3BhY2UoKTtcblxuICAvKipcbiAgICogTWFpbiBTdGFnZSwgZGlzcGxheSBvYmplY3RcbiAgICogQGNsYXNzXG4gICAqIEBleHRlbmRzIFNwcml0ZS5Db250YWluZXJcbiAgICovXG4gIFNwcml0ZS5hc3NpZ24oXCJTdGFnZVwiLCBjbGFzcyBTcHJpdGVTdGFnZSBleHRlbmRzIFNwcml0ZS5Db250YWluZXIge1xuXG4gICAgLyoqIEBmdW5jdGlvbiBTcHJpdGUuU3RhZ2UuY29uc3RydWN0b3JcbiAgICAgKiBjb25zdHVyY3QgYSBTcHJpdGUuU3RhZ2Ugd2l0aCB3aWR0aCBhbmQgaGVpZ2h0XG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHdpZHRoLCB0aGUgd2lkdGggb2Ygc3RhZ2UgeW91IG5lZWRcbiAgICAgKiBAcGFyYW0gaGVpZ2h0LCB0aGUgaGVpZ2h0IG9mIHN0YWdlIHlvdSBuZWVkXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgIHN1cGVyKCk7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcblxuICAgICAgaWYgKCFwcml2YXRlcy5yZW5kZXJlciAmJiBTcHJpdGUuV2ViZ2wuc3VwcG9ydCgpKSB7XG4gICAgICAgIHByaXZhdGVzLnJlbmRlcmVyID0gbmV3IFNwcml0ZS5XZWJnbCh3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgcHJpdmF0ZXMucmVuZGVyZXJUeXBlID0gXCJ3ZWJnbFwiO1xuICAgICAgfVxuXG4gICAgICAvLyBjYW52YXMgMmQgZmlyc3RcbiAgICAgIGlmICghcHJpdmF0ZXMucmVuZGVyZXIgJiYgU3ByaXRlLkNhbnZhcy5zdXBwb3J0KCkpIHtcbiAgICAgICAgcHJpdmF0ZXMucmVuZGVyZXIgPSBuZXcgU3ByaXRlLkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgcHJpdmF0ZXMucmVuZGVyZXJUeXBlID0gXCJjYW52YXNcIjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFwcml2YXRlcy5yZW5kZXJlcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuU3RhZ2UgYWxsIHJlbmRlcmVyIG5vdCBzdXBwb3J0XCIpO1xuICAgICAgfVxuXG4gICAgICAvKipcbiAgICAgICogY29sb3Igd2hlbiBzdGFnZSBpcyBlbXB0eVxuICAgICAgKi9cbiAgICAgIHByaXZhdGVzLmNvbG9yID0gXCIjMDAwMDAwXCI7XG4gICAgfVxuXG4gICAgcmVsZWFzZVJlbmRlcmVyICgpe1xuICAgICAgaW50ZXJuYWwodGhpcykucmVuZGVyZXIucmVsZWFzZSgpO1xuICAgIH1cblxuICAgIGdldCByZW5kZXJlciAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykucmVuZGVyZXI7XG4gICAgfVxuXG4gICAgc2V0IHJlbmRlcmVyICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLlN0YWdlIHJlbmRlcmVyIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGdldCByZW5kZXJlclR5cGUgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLnJlbmRlcmVyVHlwZTtcbiAgICB9XG5cbiAgICBzZXQgcmVuZGVyZXJUeXBlICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLlN0YWdlLnJlbmRlcmVyVHlwZSByZWFkb25seVwiKVxuICAgIH1cblxuICAgIGZpbHRlciAobmFtZSwgdmFsdWUpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5yZW5kZXJlci5maWx0ZXIobmFtZSwgdmFsdWUpO1xuICAgIH1cblxuICAgIGZpbmRIaXQgKGV2ZW50KSB7XG4gICAgICBsZXQgaGl0dGVkID0gdGhpcy5oaXRUZXN0KHRoaXMubW91c2VYLCB0aGlzLm1vdXNlWSk7XG4gICAgICBoaXR0ZWQucmV2ZXJzZSgpO1xuICAgICAgaWYgKGhpdHRlZC5sZW5ndGgpXG4gICAgICAgIHJldHVybiBoaXR0ZWQ7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBnZXQgd2lkdGggKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLnJlbmRlcmVyLndpZHRoO1xuICAgIH1cblxuICAgIHNldCB3aWR0aCAodmFsdWUpIHtcbiAgICAgIGludGVybmFsKHRoaXMpLnJlbmRlcmVyLndpZHRoID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IGhlaWdodCAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykucmVuZGVyZXIuaGVpZ2h0O1xuICAgIH1cblxuICAgIHNldCBoZWlnaHQgKHZhbHVlKSB7XG4gICAgICBpbnRlcm5hbCh0aGlzKS5yZW5kZXJlci5oZWlnaHQgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgY29sb3IgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLnJlbmRlcmVyLmNvbG9yO1xuICAgIH1cblxuICAgIHNldCBjb2xvciAodmFsdWUpIHtcbiAgICAgIGludGVybmFsKHRoaXMpLnJlbmRlcmVyLmNvbG9yID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IGNhbnZhcyAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5jYW52YXM7XG4gICAgfVxuXG4gICAgc2V0IGNhbnZhcyAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5TdGFnZS5jYW52YXMgcmVhZG9ubHlcIilcbiAgICB9XG5cbiAgICAvLy8gQGZ1bmN0aW9uIFNwcml0ZS5TdGFnZS5jbGVhclxuICAgIC8vLyBjbGVhciB0aGUgc3RhZ2VcbiAgICBjbGVhciAoKSB7XG4gICAgICBpbnRlcm5hbCh0aGlzKS5yZW5kZXJlci5jbGVhcigpO1xuICAgIH1cblxuICAgIHVwZGF0ZSAoKSB7XG4gICAgICB0aGlzLmVtaXQoXCJiZWZvcmVEcmF3XCIpO1xuICAgICAgdGhpcy5kcmF3KHRoaXMucmVuZGVyZXIpO1xuICAgICAgdGhpcy5lbWl0KFwiYWZ0ZXJEcmF3XCIpO1xuICAgIH1cblxuICAgIGRyYXcgKHJlbmRlcmVyKSB7XG4gICAgICAvKiogdGhpcy5jaGlsZHJlbiwgbmV2ZXIgcHJpdmF0ZXMuY2hpbGRyZW4sIGJlY2F1c2UgY2hpbGRyZW4gYXJlIHN1cGVyJ3MgKi9cbiAgICAgIGlmICh0aGlzLmNoaWxkcmVuLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jbGVhcigpO1xuXG4gICAgICBmb3IgKGxldCBjaGlsZCBvZiB0aGlzLmNoaWxkcmVuKSB7XG4gICAgICAgIGNoaWxkLmRyYXcocmVuZGVyZXIpO1xuICAgICAgfVxuICAgIH1cblxuICB9KTtcblxuXG59KSgpO1xuIl19

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Define the Sprite.Text to show text in game
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  var textCanvas = document.createElement("canvas");
  textCanvas.width = 1;
  textCanvas.height = 1;
  var textContext = textCanvas.getContext("2d");

  /**
   * Class Sprite.Text, contain text
   * @class
   * @extends Sprite.Display
   */
  Sprite.assign("Text", (function (_Sprite$Display) {
    _inherits(SpriteText, _Sprite$Display);

    /**
     * construct Sprite.Text
     * @constructor
     */

    function SpriteText(config) {
      _classCallCheck(this, SpriteText);

      _get(Object.getPrototypeOf(SpriteText.prototype), "constructor", this).call(this);
      var privates = internal(this);
      privates.text = config.text || "Invalid Text";
      privates.maxWidth = config.maxWidth || 1000;
      privates.color = config.color || "black";
      privates.fontSize = config.fontSize || 14;
      privates.fontFamily = config.fontFamily || "Ariel";
      privates.image = null;
      this.generate();
    }

    _createClass(SpriteText, [{
      key: "clone",
      value: function clone() {
        var privates = internal(this);
        var text = new Text({
          text: privates.text,
          maxWidth: privates.maxWidth,
          color: privates.color,
          fontSize: privates.fontSize,
          fontFamily: privates.fontFamily
        });
        text.x = this.x;
        text.y = this.y;
        text.centerX = this.centerX;
        text.centerY = this.centerY;
        text.alpha = this.alpha;
        text.visible = this.visible;
        return text;
      }
    }, {
      key: "generate",
      value: function generate() {
        var privates = internal(this);
        textContext.font = this.fontSize + "px " + privates.fontFamily;
        // "龍" is the max-width & max-height Chinese word I think
        var lineHeight = Math.ceil(textContext.measureText("龍").width * 1.2);
        this.width = 0;

        // find the real-maximum-width of multiline text, base user's maxWidth
        var lines = [];
        var lineText = "";
        for (var i = 0, len = this.text.length; i < len; i++) {
          if (textContext.measureText(lineText + this.text[i]).width > this.maxWidth) {
            lines.push(lineText);
            lineText = this.text[i];
          } else {
            lineText += this.text[i];
          }
          if (textContext.measureText(lineText).width > this.width) this.width = Math.ceil(textContext.measureText(lineText).width);
        }

        if (lineText.length) {
          lines.push(lineText);
        }

        this.height = lines.length * lineHeight;

        var canvas = document.createElement("canvas");
        canvas.width = this.width;
        canvas.height = this.height;
        var context = canvas.getContext("2d");
        context.font = this.fontSize + "px " + this.fontFamily;
        context.fillStyle = this.color;
        context.textAlign = "center";
        context.textBaseline = "top";
        // draw each line
        lines.forEach(function (element, index) {
          context.fillText(element, canvas.width / 2, index * lineHeight);
        });

        privates.image = null;
        privates.image = canvas;
      }
    }, {
      key: "draw",
      value: function draw(context) {
        var privates = internal(this);
        var image = privates.image;
        if (image && image.width > 0 && image.height > 0) {
          this.drawImage(context, image, 0, 0, image.width, image.height);
        }
      }
    }, {
      key: "text",
      get: function get() {
        var privates = internal(this);
        return privates.text;
      },
      set: function set(value) {
        var privates = internal(this);
        if (value != this.text) {
          privates.text = value;
          this.generate();
        }
      }
    }, {
      key: "color",
      get: function get() {
        var privates = internal(this);
        return privates.color;
      },
      set: function set(value) {
        var privates = internal(this);
        if (value != this.color) {
          privates.color = value;
          this.generate();
        }
      }
    }, {
      key: "fontSize",
      get: function get() {
        var privates = internal(this);
        return privates.fontSize;
      },
      set: function set(value) {
        var privates = internal(this);
        if (value != this.fontSize) {
          privates.fontSize = value;
          this.generate();
        }
      }
    }, {
      key: "fontFamily",
      get: function get() {
        return internal(this).fontFamily;
      },
      set: function set(value) {
        var privates = internal(this);
        if (value != privates.fontFamily) {
          privates.fontFamily = value;
          this.generate();
        }
      }
    }]);

    return SpriteText;
  })(Sprite.Display));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlVGV4dC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQyxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWQsTUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDOztBQUVsQyxNQUFJLFVBQVUsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ2xELFlBQVUsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0FBQ3JCLFlBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0FBQ3RCLE1BQUksV0FBVyxHQUFHLFVBQVUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7Ozs7Ozs7QUFPOUMsUUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNO2NBQVEsVUFBVTs7Ozs7OztBQUt4QixhQUxjLFVBQVUsQ0FLdkIsTUFBTSxFQUFFOzRCQUxLLFVBQVU7O0FBTWxDLGlDQU53QixVQUFVLDZDQU0xQjtBQUNSLFVBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM5QixjQUFRLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLElBQUksY0FBYyxDQUFDO0FBQzlDLGNBQVEsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUM7QUFDNUMsY0FBUSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQztBQUN6QyxjQUFRLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDO0FBQzFDLGNBQVEsQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDLFVBQVUsSUFBSSxPQUFPLENBQUM7QUFDbkQsY0FBUSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7QUFDdEIsVUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0tBQ2pC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SyxDQUFDO0FBQzVCLGNBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUNqQjtPQUNGOzs7V0FwRnlCLFVBQVU7S0FBUyxNQUFNLENBQUMsT0FBTyxFQWdKM0QsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IlNwcml0ZVRleHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgRGVmaW5lIHRoZSBTcHJpdGUuVGV4dCB0byBzaG93IHRleHQgaW4gZ2FtZVxuICogQGF1dGhvciBtYWlsQHFoZHVhbi5jb20gKFFIIER1YW4pXG4gKi9cblxuIChmdW5jdGlvbiAoKSB7XG4gICBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgaW50ZXJuYWwgPSBTcHJpdGUuTmFtZXNwYWNlKCk7XG5cbiAgbGV0IHRleHRDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICB0ZXh0Q2FudmFzLndpZHRoID0gMTtcbiAgdGV4dENhbnZhcy5oZWlnaHQgPSAxO1xuICBsZXQgdGV4dENvbnRleHQgPSB0ZXh0Q2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcblxuICAvKipcbiAgICogQ2xhc3MgU3ByaXRlLlRleHQsIGNvbnRhaW4gdGV4dFxuICAgKiBAY2xhc3NcbiAgICogQGV4dGVuZHMgU3ByaXRlLkRpc3BsYXlcbiAgICovXG4gIFNwcml0ZS5hc3NpZ24oXCJUZXh0XCIsIGNsYXNzIFNwcml0ZVRleHQgZXh0ZW5kcyBTcHJpdGUuRGlzcGxheSB7XG4gICAgLyoqXG4gICAgICogY29uc3RydWN0IFNwcml0ZS5UZXh0XG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKGNvbmZpZykge1xuICAgICAgc3VwZXIoKTtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgcHJpdmF0ZXMudGV4dCA9IGNvbmZpZy50ZXh0IHx8IFwiSW52YWxpZCBUZXh0XCI7XG4gICAgICBwcml2YXRlcy5tYXhXaWR0aCA9IGNvbmZpZy5tYXhXaWR0aCB8fCAxMDAwO1xuICAgICAgcHJpdmF0ZXMuY29sb3IgPSBjb25maWcuY29sb3IgfHwgXCJibGFja1wiO1xuICAgICAgcHJpdmF0ZXMuZm9udFNpemUgPSBjb25maWcuZm9udFNpemUgfHwgMTQ7XG4gICAgICBwcml2YXRlcy5mb250RmFtaWx5ID0gY29uZmlnLmZvbnRGYW1pbHkgfHwgXCJBcmllbFwiO1xuICAgICAgcHJpdmF0ZXMuaW1hZ2UgPSBudWxsO1xuICAgICAgdGhpcy5nZW5lcmF0ZSgpO1xuICAgIH1cblxuICAgIGNsb25lICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgbGV0IHRleHQgPSBuZXcgVGV4dCh7XG4gICAgICAgIHRleHQ6IHByaXZhdGVzLnRleHQsXG4gICAgICAgIG1heFdpZHRoOiBwcml2YXRlcy5tYXhXaWR0aCxcbiAgICAgICAgY29sb3I6IHByaXZhdGVzLmNvbG9yLFxuICAgICAgICBmb250U2l6ZTogcHJpdmF0ZXMuZm9udFNpemUsXG4gICAgICAgIGZvbnRGYW1pbHk6IHByaXZhdGVzLmZvbnRGYW1pbHlcbiAgICAgIH0pO1xuICAgICAgdGV4dC54ID0gdGhpcy54O1xuICAgICAgdGV4dC55ID0gdGhpcy55O1xuICAgICAgdGV4dC5jZW50ZXJYID0gdGhpcy5jZW50ZXJYO1xuICAgICAgdGV4dC5jZW50ZXJZID0gdGhpcy5jZW50ZXJZO1xuICAgICAgdGV4dC5hbHBoYSA9IHRoaXMuYWxwaGE7XG4gICAgICB0ZXh0LnZpc2libGUgPSB0aGlzLnZpc2libGU7XG4gICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG5cbiAgICBnZXQgdGV4dCAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHJldHVybiBwcml2YXRlcy50ZXh0O1xuICAgIH1cblxuICAgIHNldCB0ZXh0ICh2YWx1ZSkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAodmFsdWUgIT0gdGhpcy50ZXh0KSB7XG4gICAgICAgIHByaXZhdGVzLnRleHQgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5nZW5lcmF0ZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGdldCBjb2xvciAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHJldHVybiBwcml2YXRlcy5jb2xvcjtcbiAgICB9XG5cbiAgICBzZXQgY29sb3IgKHZhbHVlKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmICh2YWx1ZSAhPSB0aGlzLmNvbG9yKSB7XG4gICAgICAgIHByaXZhdGVzLmNvbG9yID0gdmFsdWU7XG4gICAgICAgIHRoaXMuZ2VuZXJhdGUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgZm9udFNpemUgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICByZXR1cm4gcHJpdmF0ZXMuZm9udFNpemU7XG4gICAgfVxuXG4gICAgc2V0IGZvbnRTaXplICh2YWx1ZSkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAodmFsdWUgIT0gdGhpcy5mb250U2l6ZSkge1xuICAgICAgICBwcml2YXRlcy5mb250U2l6ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmdlbmVyYXRlKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGZvbnRGYW1pbHkgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmZvbnRGYW1pbHk7XG4gICAgfVxuXG4gICAgc2V0IGZvbnRGYW1pbHkgKHZhbHVlKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmICh2YWx1ZSAhPSBwcml2YXRlcy5mb250RmFtaWx5KSB7XG4gICAgICAgIHByaXZhdGVzLmZvbnRGYW1pbHkgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5nZW5lcmF0ZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGdlbmVyYXRlICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgdGV4dENvbnRleHQuZm9udCA9IHRoaXMuZm9udFNpemUgKyBcInB4IFwiICsgcHJpdmF0ZXMuZm9udEZhbWlseTtcbiAgICAgIC8vIFwi6b6NXCIgaXMgdGhlIG1heC13aWR0aCAmIG1heC1oZWlnaHQgQ2hpbmVzZSB3b3JkIEkgdGhpbmtcbiAgICAgIGxldCBsaW5lSGVpZ2h0ID0gTWF0aC5jZWlsKHRleHRDb250ZXh0Lm1lYXN1cmVUZXh0KFwi6b6NXCIpLndpZHRoICogMS4yKTtcbiAgICAgIHRoaXMud2lkdGggPSAwO1xuXG4gICAgICAvLyBmaW5kIHRoZSByZWFsLW1heGltdW0td2lkdGggb2YgbXVsdGlsaW5lIHRleHQsIGJhc2UgdXNlcidzIG1heFdpZHRoXG4gICAgICBsZXQgbGluZXMgPSBbXTtcbiAgICAgIGxldCBsaW5lVGV4dCA9IFwiXCI7XG4gICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy50ZXh0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGlmICh0ZXh0Q29udGV4dC5tZWFzdXJlVGV4dChsaW5lVGV4dCArIHRoaXMudGV4dFtpXSkud2lkdGggPiB0aGlzLm1heFdpZHRoKSB7XG4gICAgICAgICAgbGluZXMucHVzaChsaW5lVGV4dCk7XG4gICAgICAgICAgbGluZVRleHQgPSB0aGlzLnRleHRbaV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGluZVRleHQgKz0gdGhpcy50ZXh0W2ldO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0ZXh0Q29udGV4dC5tZWFzdXJlVGV4dChsaW5lVGV4dCkud2lkdGggPiB0aGlzLndpZHRoKVxuICAgICAgICAgIHRoaXMud2lkdGggPSBNYXRoLmNlaWwodGV4dENvbnRleHQubWVhc3VyZVRleHQobGluZVRleHQpLndpZHRoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGxpbmVUZXh0Lmxlbmd0aCkge1xuICAgICAgICBsaW5lcy5wdXNoKGxpbmVUZXh0KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5oZWlnaHQgPSBsaW5lcy5sZW5ndGggKiBsaW5lSGVpZ2h0O1xuXG4gICAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgIGNhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICBjYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICBsZXQgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICBjb250ZXh0LmZvbnQgPSB0aGlzLmZvbnRTaXplICsgXCJweCBcIiArIHRoaXMuZm9udEZhbWlseTtcbiAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gdGhpcy5jb2xvcjtcbiAgICAgIGNvbnRleHQudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcbiAgICAgIGNvbnRleHQudGV4dEJhc2VsaW5lID0gXCJ0b3BcIjtcbiAgICAgIC8vIGRyYXcgZWFjaCBsaW5lXG4gICAgICBsaW5lcy5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgICBjb250ZXh0LmZpbGxUZXh0KGVsZW1lbnQsIGNhbnZhcy53aWR0aC8yLCBpbmRleCpsaW5lSGVpZ2h0KVxuICAgICAgfSk7XG5cbiAgICAgIHByaXZhdGVzLmltYWdlID0gbnVsbDtcbiAgICAgIHByaXZhdGVzLmltYWdlID0gY2FudmFzO1xuICAgIH1cblxuICAgIGRyYXcgKGNvbnRleHQpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgbGV0IGltYWdlID0gcHJpdmF0ZXMuaW1hZ2U7XG4gICAgICBpZiAoIGltYWdlICYmIGltYWdlLndpZHRoID4gMCAmJiBpbWFnZS5oZWlnaHQgPiAwKSB7XG4gICAgICAgIHRoaXMuZHJhd0ltYWdlKFxuICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgaW1hZ2UsXG4gICAgICAgICAgMCxcbiAgICAgICAgICAwLFxuICAgICAgICAgIGltYWdlLndpZHRoLFxuICAgICAgICAgIGltYWdlLmhlaWdodFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Class Sprite.Frame
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
   * Class Sprite.Frame, a frame of Sprite.Sheet
   * @class
   */
  Sprite.assign("Frame", (function (_Sprite$Display) {
    _inherits(SpriteFrame, _Sprite$Display);

    function SpriteFrame(image, sx, sy, width, height) {
      _classCallCheck(this, SpriteFrame);

      _get(Object.getPrototypeOf(SpriteFrame.prototype), "constructor", this).call(this);
      var privates = internal(this);
      privates.image = image;
      privates.sx = sx;
      privates.sy = sy;
      this.width = width;
      this.height = height;
    }

    /**
     * @return {Image} Return the image this Sprite.Frame hold
     */

    _createClass(SpriteFrame, [{
      key: "print",
      value: function print() {
        console.log(internal(this));
      }

      /**
       * @return {Object} Clone this Sprite.Frame
       */
    }, {
      key: "clone",
      value: function clone() {
        var frame = new Sprite.Frame(this.image, this.sx, this.sy, this.width, this.height);
        frame.x = this.x;
        frame.y = this.y;
        frame.parent = this.parent;
        return frame;
      }

      /**
       * @param {Object} renderer
       */
    }, {
      key: "draw",
      value: function draw(renderer) {
        this.drawImage(renderer, this.image, this.sx, this.sy, this.width, this.height);
      }
    }, {
      key: "image",
      get: function get() {
        var privates = internal(this);
        return privates.image;
      },
      set: function set(value) {
        throw new Error("Sprite.Frame.image readonly");
      }

      /**
       * @return {number} Return sx
       */
    }, {
      key: "sx",
      get: function get() {
        var privates = internal(this);
        return privates.sx;
      },
      set: function set(value) {
        throw new Error("Sprite.Frame.sx readonly");
      }

      /**
       * @return {number} Return sy
       */
    }, {
      key: "sy",
      get: function get() {
        var privates = internal(this);
        return privates.sy;
      },
      set: function set(value) {
        throw new Error("Sprite.Frame.sy readonly");
      }
    }]);

    return SpriteFrame;
  })(Sprite.Display));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlRnJhbWUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5QkEsQ0FBQyxZQUFZO0FBQ1osY0FBWSxDQUFDOztBQUVaLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7Ozs7O0FBTWxDLFFBQU0sQ0FBQyxNQUFNLENBQUMsT0FBTztjQUFRLFdBQVc7O0FBRTFCLGFBRmUsV0FBVyxDQUV6QixLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFOzRCQUZoQixXQUFXOztBQUdwQyxpQ0FIeUIsV0FBVyw2Q0FHNUI7QUFDUixVQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDOUIsY0FBUSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7QUFDdkIsY0FBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7QUFDakIsY0FBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7QUFDakIsVUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7QUFDbkIsVUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7S0FDdEI7Ozs7OztpQkFWMEIsV0FBVzs7YUErQ2hDLGlCQUFHO0FBQ1AsZUFBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztPQUM3Qjs7Ozs7OzthQUtLLGlCQUFHO0FBQ1AsWUFBSSxLQUFLLEdBQUcsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUMxQixJQUFJLENBQUMsS0FBSyxFQUNWLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFDaEIsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUN4QixDQUFDO0FBQ0YsYUFBSyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ2pCLGFBQUssQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNqQixhQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7QUFDM0IsZUFBTyxLQUFLLENBQUM7T0FDZDs7Ozs7OzthQUtJLGNBQUMsUUFBUSxFQUFFO0FBQ2QsWUFBSSxDQUFDLFNBQVMsQ0FDWixRQUFRLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFDcEIsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUNoQixJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQ3hCLENBQUM7T0FDSDs7O1dBN0RTLGVBQUc7QUFDWCxZQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDOUIsZUFBTyxRQUFRLENBQUMsS0FBSyxDQUFDO09BQ3ZCO1dBRVMsYUFBQyxLQUFLLEVBQUU7QUFDaEIsY0FBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO09BQ2hEOzs7Ozs7O1dBS00sZUFBRztBQUNSLFlBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM5QixlQUFPLFFBQVEsQ0FBQyxFQUFFLENBQUM7T0FDcEI7V0FFTSxhQUFDLEtBQUssRUFBRTtBQUNiLGNBQU0sSUFBSSxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQztPQUM3Qzs7Ozs7OztXQUtNLGVBQUc7QUFDUixZQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDOUIsZUFBTyxRQUFRLENBQUMsRUFBRSxDQUFDO09BQ3BCO1dBRU0sYUFBQyxLQUFLLEVBQUU7QUFDYixjQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQUM7T0FDN0M7OztXQTdDMEIsV0FBVztLQUFTLE1BQU0sQ0FBQyxPQUFPLEVBNkU3RCxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiU3ByaXRlRnJhbWUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ2xhc3MgU3ByaXRlLkZyYW1lXG4gKiBAYXV0aG9yIG1haWxAcWhkdWFuLmNvbSAoUUggRHVhbilcbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCBpbnRlcm5hbCA9IFNwcml0ZS5OYW1lc3BhY2UoKTtcblxuICAvKipcbiAgICogQ2xhc3MgU3ByaXRlLkZyYW1lLCBhIGZyYW1lIG9mIFNwcml0ZS5TaGVldFxuICAgKiBAY2xhc3NcbiAgICovXG4gIFNwcml0ZS5hc3NpZ24oXCJGcmFtZVwiLCBjbGFzcyBTcHJpdGVGcmFtZSBleHRlbmRzIFNwcml0ZS5EaXNwbGF5IHtcblxuICAgIGNvbnN0cnVjdG9yIChpbWFnZSwgc3gsIHN5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICBzdXBlcigpO1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBwcml2YXRlcy5pbWFnZSA9IGltYWdlO1xuICAgICAgcHJpdmF0ZXMuc3ggPSBzeDtcbiAgICAgIHByaXZhdGVzLnN5ID0gc3k7XG4gICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybiB7SW1hZ2V9IFJldHVybiB0aGUgaW1hZ2UgdGhpcyBTcHJpdGUuRnJhbWUgaG9sZFxuICAgICAqL1xuICAgIGdldCBpbWFnZSAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHJldHVybiBwcml2YXRlcy5pbWFnZTtcbiAgICB9XG5cbiAgICBzZXQgaW1hZ2UgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuRnJhbWUuaW1hZ2UgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybiB7bnVtYmVyfSBSZXR1cm4gc3hcbiAgICAgKi9cbiAgICBnZXQgc3ggKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICByZXR1cm4gcHJpdmF0ZXMuc3g7XG4gICAgfVxuXG4gICAgc2V0IHN4ICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLkZyYW1lLnN4IHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gUmV0dXJuIHN5XG4gICAgICovXG4gICAgZ2V0IHN5ICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgcmV0dXJuIHByaXZhdGVzLnN5O1xuICAgIH1cblxuICAgIHNldCBzeSAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5GcmFtZS5zeSByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBwcmludCAoKSB7XG4gICAgICBjb25zb2xlLmxvZyhpbnRlcm5hbCh0aGlzKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybiB7T2JqZWN0fSBDbG9uZSB0aGlzIFNwcml0ZS5GcmFtZVxuICAgICAqL1xuICAgIGNsb25lICgpIHtcbiAgICAgIGxldCBmcmFtZSA9IG5ldyBTcHJpdGUuRnJhbWUoXG4gICAgICAgIHRoaXMuaW1hZ2UsXG4gICAgICAgIHRoaXMuc3gsIHRoaXMuc3ksXG4gICAgICAgIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0XG4gICAgICApO1xuICAgICAgZnJhbWUueCA9IHRoaXMueDtcbiAgICAgIGZyYW1lLnkgPSB0aGlzLnk7XG4gICAgICBmcmFtZS5wYXJlbnQgPSB0aGlzLnBhcmVudDtcbiAgICAgIHJldHVybiBmcmFtZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVuZGVyZXJcbiAgICAgKi9cbiAgICBkcmF3IChyZW5kZXJlcikge1xuICAgICAgdGhpcy5kcmF3SW1hZ2UoXG4gICAgICAgIHJlbmRlcmVyLCB0aGlzLmltYWdlLFxuICAgICAgICB0aGlzLnN4LCB0aGlzLnN5LFxuICAgICAgICB0aGlzLndpZHRoLCB0aGlzLmhlaWdodFxuICAgICAgKTtcbiAgICB9XG5cbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*import "js/Sprite/SpriteDisplay";

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Class Sprite.Sheet, maybe the most importent class
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
   * Class Sprite.Sheet, contain sprite's sheet and it's animation
   * @class
   * @extends Sprite.Display
   */
  Sprite.assign("Sheet", (function (_Sprite$Display) {
    _inherits(SpriteSheet, _Sprite$Display);

    /**
     * construct Sprite.Sheet
     * @param config
     * @constructor
     */

    function SpriteSheet(config) {
      _classCallCheck(this, SpriteSheet);

      _get(Object.getPrototypeOf(SpriteSheet.prototype), "constructor", this).call(this);
      var privates = internal(this);

      if (!config.images || !config.images.length || !Number.isFinite(config.width) || config.width <= 0 || config.width > 4096 || !Number.isFinite(config.height) || config.height <= 0 || config.height > 4096) {
        console.error(config);
        throw new Error("Sprite.Sheet.constructor get invalid arguments");
      }

      /**
       * Contain one or more images
       @type {Array}
       @private
       */
      privates.images = config.images;
      /**
       * Width of each frame
       @type {number}
       @private
       */
      privates.tilewidth = config.width;
      this.width = config.width;
      /**
       * Height of each frame
       @type {number}
       @private
       */
      privates.tileheight = config.height;
      this.height = config.height;
      /**
       * Animations of this sprite sheet, eg. { "walkdown": [0, 2, "", 40], "walkup", [3, 5, "", 40] }
       @type {Object}
       @private
       */
      privates.animations = config.animations || {};
      /**
       * Current animation's name, eg. "walkdown", "attackright"
       @type {string}
       @private
       */
      privates.currentAnimation = null;
      /**
       * Current frame number, eg. 0, 1, 2, 3
       @type {number}
       @private
       */
      privates.currentFrame = 0;
      /**
       * If animationTimer is not null, it points an animation is running
       * it will be null or an handler from setInterval
       @type {Object}
       @private
       */
      privates.animationTimer = null;

      /**
       * The number of frames we have
       @type {number}
       @private
       */
      privates.frameCount = 0;

      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = privates.images[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var image = _step.value;

          if (!(image instanceof Image) && !(image.getContext && image.getContext("2d"))) {
            console.error(image, privates, this);
            throw new Error("Sprite.Sheet got invalid image, not Image or Canvas");
          }

          if (image.width <= 0 || !Number.isFinite(image.width) || image.height <= 0 || !Number.isFinite(image.height)) {
            console.error(image, privates, this);
            throw new Error("Sprite.Sheet got invalid image, invalid width or height");
          }

          var col = Math.floor(image.width / privates.tilewidth);
          var row = Math.floor(image.height / privates.tileheight);
          privates.frameCount += col * row;
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator["return"]) {
            _iterator["return"]();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    }

    /**
     * Clone Sprite.Sheet object itself
     * @return {Object} Return an copy of this
     */

    _createClass(SpriteSheet, [{
      key: "clone",
      value: function clone() {
        var privates = internal(this);
        var sheet = new Sprite.Sheet({
          images: privates.images,
          width: privates.tilewidth,
          height: privates.tileheight,
          animations: privates.animations
        });
        sheet.x = this.x;
        sheet.y = this.y;
        sheet.centerX = this.centerX;
        sheet.centerY = this.centerY;
        sheet.play(this.currentFrame);
        sheet.alpha = this.alpha;
        sheet.visible = this.visible;
        return sheet;
      }

      /**
       * @return {boolean} Return false if an animation is running
       */
    }, {
      key: "play",

      /**
       * Play a frame or an animation
       * @param {Object} choice frame number of animation name, eg. 0 for frame or "walkdown" for animation
       */
      value: function play(choice) {
        var _this = this;

        var privates = internal(this);
        if (privates.animationTimer) {
          clearInterval(privates.animationTimer);
          privates.animationTimer = null;
        }

        if (Number.isInteger(choice)) {
          // Argument points a frame
          privates.currentFrame = choice;
          this.emit("change");
        } else if (typeof choice == "string") {
          var _ret = (function () {
            // Argument points an animation name
            var animation = privates.animations[choice];

            if (!animation) {
              // if animation is not exist
              console.error(animation, privates.animations, choice);
              throw new Error("Sprite.Sheet.play invalid animation");
            }

            // if animation is single frame number
            if (Number.isFinite(animation)) {
              privates.currentAnimation = choice;
              return {
                v: _this.play(animation)
              };
            }

            // start frame number
            var begin = null;
            // finish frame number
            var end = null;
            // what action after animation finished
            var next = null;
            // the space between each frame, ms
            var time = null;

            if (animation instanceof Array) {
              // if animation format is like [begin, end, next, time]
              begin = animation[0];
              end = animation[1];
              next = animation[2];
              time = animation[3];
            } else if (animation.frames && animation.frames instanceof Array) {
              // if animation format is like { frames: [begin, end], next: "next", speed: "time" }
              begin = animation.frames[0];
              end = animation.frames[animation.frames.length - 1];
              next = animation.next;
              time = animation.speed;
            }

            if ( // Data ensure
            !Number.isFinite(begin) || begin < 0 || begin >= privates.frameCount || !Number.isFinite(end) || end < 0 || end >= privates.frameCount || !Number.isFinite(time) || time <= 0) {
              console.error(begin, end, time, _this);
              throw new Error("Sprite.Sheet.play Invalid animation data");
            }

            // Play first frame in animation
            privates.currentAnimation = choice;
            privates.currentFrame = begin;
            _this.emit("change");

            // Play other frame in animation
            privates.animationTimer = setInterval(function () {
              privates.currentFrame++;

              if (privates.currentFrame > end) {
                clearInterval(privates.animationTimer);
                privates.animationTimer = null;

                if (next && next.length && privates.animations[next]) {
                  _this.play(next);
                } else {
                  privates.currentFrame--;
                }
                _this.emit("animationend");
              }

              _this.emit("change");
            }, time);
          })();

          if (typeof _ret === "object") return _ret.v;
        } else {
          console.error(choice, internal(this).animations, this);
          throw new Error("Sprite.Sheet.play has an invalid argument");
        }
      }

      /**
       * Get a certain frame
       * @param {number} index The index of frame
       * @return {Object} An Sprite.Frame object
       */
    }, {
      key: "getFrame",
      value: function getFrame(index) {
        var privates = internal(this);
        if (!Number.isInteger(index)) {
          index = privates.currentFrame;
        }

        if (index < 0 || index >= privates.frameCount) {
          console.error(index, privates, this);
          throw new Error("Sprite.Sheet.getFrame index out of range");
        }

        var frame = null;
        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = privates.images[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var image = _step2.value;

            var col = Math.floor(image.width / privates.tilewidth);
            var row = Math.floor(image.height / privates.tileheight);
            if (index < col * row) {
              // which row
              var j = Math.floor(index / col);
              // which column
              var i = index - col * j;
              frame = new Sprite.Frame(image, i * privates.tilewidth, // x
              j * privates.tileheight, // y
              privates.tilewidth, privates.tileheight);
              frame.parent = this;
              break;
            }
            index -= col * row;
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
              _iterator2["return"]();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        if (!frame) {
          console.error(index, privates, this);
          throw new Error("Sprite.Sheet.getFrame unknown error");
        }

        return frame;
      }

      /**
       * Draw this sheet on certain renderer
       * @param {Object} renderer A renderer engine, eg. Sprite.Webgl
       */
    }, {
      key: "draw",
      value: function draw(renderer) {
        if (this.visible == false || this.alpha <= 0.01) {
          return;
        }

        var privates = internal(this);
        var frame = this.getFrame(this.currentFrame);

        if (!frame || !frame.image) {
          console.error(frame, this.currentFrame, this);
          throw new Error("Sprite.Sheet.draw invalid frame");
        }

        frame.draw(renderer);
      }
    }, {
      key: "paused",
      get: function get() {
        var privates = internal(this);
        if (privates.animationTimer) {
          return false;
        }
        return true;
      },
      set: function set(value) {
        throw new Error("Sprite.Sheet.paused readonly");
      }

      /**
       * @return {number} Return current frame number
       */
    }, {
      key: "currentFrame",
      get: function get() {
        var privates = internal(this);
        return privates.currentFrame;
      },
      set: function set(value) {
        throw new Error("Sprite.Sheet.currentFrame readonly");
      }

      /**
       * @return {string} Return
       */
    }, {
      key: "currentAnimation",
      get: function get() {
        var privates = internal(this);
        return privates.currentAnimation;
      },
      set: function set(value) {
        throw new Error("Sprite.Sheet.currentAnimation readonly");
      }
    }]);

    return SpriteSheet;
  })(Sprite.Display));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlU2hlZXQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5QkEsQ0FBQyxZQUFZO0FBQ1osY0FBWSxDQUFDOztBQUVaLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7Ozs7OztBQU9sQyxRQUFNLENBQUMsTUFBTSxDQUFDLE9BQU87Y0FBUSxXQUFXOzs7Ozs7OztBQU0xQixhQU5lLFdBQVcsQ0FNekIsTUFBTSxFQUFFOzRCQU5NLFdBQVc7O0FBT3BDLGlDQVB5QixXQUFXLDZDQU81QjtBQUNSLFVBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQzs7QUFFOUIsVUFDSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sSUFDdkMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxNQUFNLENBQUMsS0FBSyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksSUFDMUUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksRUFDN0U7QUFDRixlQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQ3JCLGNBQU0sSUFBSSxLQUFLLENBQUMsZ0RBQWdELENBQUMsQ0FBQztPQUNuRTs7Ozs7OztBQU9ELGNBQVEsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQzs7Ozs7O0FBTWhDLGNBQVEsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQztBQUNsQyxVQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7Ozs7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b0IsYUFBQyxLQUFLLEVBQUU7QUFDM0IsY0FBTSxJQUFJLEtBQUssQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO09BQzNEOzs7V0FuSjBCLFdBQVc7S0FBUyxNQUFNLENBQUMsT0FBTyxFQW1UN0QsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IlNwcml0ZVNoZWV0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyppbXBvcnQgXCJqcy9TcHJpdGUvU3ByaXRlRGlzcGxheVwiO1xuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ2xhc3MgU3ByaXRlLlNoZWV0LCBtYXliZSB0aGUgbW9zdCBpbXBvcnRlbnQgY2xhc3NcbiAqIEBhdXRob3IgbWFpbEBxaGR1YW4uY29tIChRSCBEdWFuKVxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gIC8qKlxuICAgKiBDbGFzcyBTcHJpdGUuU2hlZXQsIGNvbnRhaW4gc3ByaXRlJ3Mgc2hlZXQgYW5kIGl0J3MgYW5pbWF0aW9uXG4gICAqIEBjbGFzc1xuICAgKiBAZXh0ZW5kcyBTcHJpdGUuRGlzcGxheVxuICAgKi9cbiAgU3ByaXRlLmFzc2lnbihcIlNoZWV0XCIsIGNsYXNzIFNwcml0ZVNoZWV0IGV4dGVuZHMgU3ByaXRlLkRpc3BsYXkge1xuICAgIC8qKlxuICAgICAqIGNvbnN0cnVjdCBTcHJpdGUuU2hlZXRcbiAgICAgKiBAcGFyYW0gY29uZmlnXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKGNvbmZpZykge1xuICAgICAgc3VwZXIoKTtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuXG4gICAgICBpZiAoXG4gICAgICAgICAgIWNvbmZpZy5pbWFnZXMgfHwgIWNvbmZpZy5pbWFnZXMubGVuZ3RoIHx8XG4gICAgICAgICAgIU51bWJlci5pc0Zpbml0ZShjb25maWcud2lkdGgpIHx8IGNvbmZpZy53aWR0aCA8PSAwIHx8IGNvbmZpZy53aWR0aCA+IDQwOTYgfHxcbiAgICAgICAgICAhTnVtYmVyLmlzRmluaXRlKGNvbmZpZy5oZWlnaHQpIHx8IGNvbmZpZy5oZWlnaHQgPD0gMCB8fCBjb25maWcuaGVpZ2h0ID4gNDA5NlxuICAgICAgICApIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihjb25maWcpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5TaGVldC5jb25zdHJ1Y3RvciBnZXQgaW52YWxpZCBhcmd1bWVudHNcIik7XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogQ29udGFpbiBvbmUgb3IgbW9yZSBpbWFnZXNcbiAgICAgICBAdHlwZSB7QXJyYXl9XG4gICAgICAgQHByaXZhdGVcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuaW1hZ2VzID0gY29uZmlnLmltYWdlcztcbiAgICAgIC8qKlxuICAgICAgICogV2lkdGggb2YgZWFjaCBmcmFtZVxuICAgICAgIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgQHByaXZhdGVcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMudGlsZXdpZHRoID0gY29uZmlnLndpZHRoO1xuICAgICAgdGhpcy53aWR0aCA9IGNvbmZpZy53aWR0aDtcbiAgICAgIC8qKlxuICAgICAgICogSGVpZ2h0IG9mIGVhY2ggZnJhbWVcbiAgICAgICBAdHlwZSB7bnVtYmVyfVxuICAgICAgIEBwcml2YXRlXG4gICAgICAgKi9cbiAgICAgIHByaXZhdGVzLnRpbGVoZWlnaHQgPSBjb25maWcuaGVpZ2h0O1xuICAgICAgdGhpcy5oZWlnaHQgPSBjb25maWcuaGVpZ2h0O1xuICAgICAgLyoqXG4gICAgICAgKiBBbmltYXRpb25zIG9mIHRoaXMgc3ByaXRlIHNoZWV0LCBlZy4geyBcIndhbGtkb3duXCI6IFswLCAyLCBcIlwiLCA0MF0sIFwid2Fsa3VwXCIsIFszLCA1LCBcIlwiLCA0MF0gfVxuICAgICAgIEB0eXBlIHtPYmplY3R9XG4gICAgICAgQHByaXZhdGVcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuYW5pbWF0aW9ucyA9IGNvbmZpZy5hbmltYXRpb25zIHx8IHt9O1xuICAgICAgLyoqXG4gICAgICAgKiBDdXJyZW50IGFuaW1hdGlvbidzIG5hbWUsIGVnLiBcIndhbGtkb3duXCIsIFwiYXR0YWNrcmlnaHRcIlxuICAgICAgIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgQHByaXZhdGVcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuY3VycmVudEFuaW1hdGlvbiA9IG51bGw7XG4gICAgICAvKipcbiAgICAgICAqIEN1cnJlbnQgZnJhbWUgbnVtYmVyLCBlZy4gMCwgMSwgMiwgM1xuICAgICAgIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgQHByaXZhdGVcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuY3VycmVudEZyYW1lID0gMDtcbiAgICAgIC8qKlxuICAgICAgICogSWYgYW5pbWF0aW9uVGltZXIgaXMgbm90IG51bGwsIGl0IHBvaW50cyBhbiBhbmltYXRpb24gaXMgcnVubmluZ1xuICAgICAgICogaXQgd2lsbCBiZSBudWxsIG9yIGFuIGhhbmRsZXIgZnJvbSBzZXRJbnRlcnZhbFxuICAgICAgIEB0eXBlIHtPYmplY3R9XG4gICAgICAgQHByaXZhdGVcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuYW5pbWF0aW9uVGltZXIgPSBudWxsO1xuXG4gICAgICAvKipcbiAgICAgICAqIFRoZSBudW1iZXIgb2YgZnJhbWVzIHdlIGhhdmVcbiAgICAgICBAdHlwZSB7bnVtYmVyfVxuICAgICAgIEBwcml2YXRlXG4gICAgICAgKi9cbiAgICAgIHByaXZhdGVzLmZyYW1lQ291bnQgPSAwO1xuXG4gICAgICBmb3IgKGxldCBpbWFnZSBvZiBwcml2YXRlcy5pbWFnZXMpIHtcblxuICAgICAgICBpZiAoIShpbWFnZSBpbnN0YW5jZW9mIEltYWdlKSAmJiAhKGltYWdlLmdldENvbnRleHQgJiYgaW1hZ2UuZ2V0Q29udGV4dChcIjJkXCIpKSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoaW1hZ2UsIHByaXZhdGVzLCB0aGlzKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuU2hlZXQgZ290IGludmFsaWQgaW1hZ2UsIG5vdCBJbWFnZSBvciBDYW52YXNcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW1hZ2Uud2lkdGggPD0gMCB8fCAhTnVtYmVyLmlzRmluaXRlKGltYWdlLndpZHRoKSB8fCBpbWFnZS5oZWlnaHQgPD0gMCB8fCAhTnVtYmVyLmlzRmluaXRlKGltYWdlLmhlaWdodCkpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGltYWdlLCBwcml2YXRlcywgdGhpcyk7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLlNoZWV0IGdvdCBpbnZhbGlkIGltYWdlLCBpbnZhbGlkIHdpZHRoIG9yIGhlaWdodFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjb2wgPSBNYXRoLmZsb29yKGltYWdlLndpZHRoIC8gcHJpdmF0ZXMudGlsZXdpZHRoKTtcbiAgICAgICAgbGV0IHJvdyA9IE1hdGguZmxvb3IoaW1hZ2UuaGVpZ2h0IC8gcHJpdmF0ZXMudGlsZWhlaWdodCk7XG4gICAgICAgIHByaXZhdGVzLmZyYW1lQ291bnQgKz0gY29sICogcm93O1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbG9uZSBTcHJpdGUuU2hlZXQgb2JqZWN0IGl0c2VsZlxuICAgICAqIEByZXR1cm4ge09iamVjdH0gUmV0dXJuIGFuIGNvcHkgb2YgdGhpc1xuICAgICAqL1xuICAgIGNsb25lICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgbGV0IHNoZWV0ID0gbmV3IFNwcml0ZS5TaGVldCh7XG4gICAgICAgIGltYWdlczogcHJpdmF0ZXMuaW1hZ2VzLFxuICAgICAgICB3aWR0aDogcHJpdmF0ZXMudGlsZXdpZHRoLFxuICAgICAgICBoZWlnaHQ6IHByaXZhdGVzLnRpbGVoZWlnaHQsXG4gICAgICAgIGFuaW1hdGlvbnM6IHByaXZhdGVzLmFuaW1hdGlvbnNcbiAgICAgIH0pO1xuICAgICAgc2hlZXQueCA9IHRoaXMueDtcbiAgICAgIHNoZWV0LnkgPSB0aGlzLnk7XG4gICAgICBzaGVldC5jZW50ZXJYID0gdGhpcy5jZW50ZXJYO1xuICAgICAgc2hlZXQuY2VudGVyWSA9IHRoaXMuY2VudGVyWTtcbiAgICAgIHNoZWV0LnBsYXkodGhpcy5jdXJyZW50RnJhbWUpO1xuICAgICAgc2hlZXQuYWxwaGEgPSB0aGlzLmFscGhhO1xuICAgICAgc2hlZXQudmlzaWJsZSA9IHRoaXMudmlzaWJsZTtcbiAgICAgIHJldHVybiBzaGVldDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybiB7Ym9vbGVhbn0gUmV0dXJuIGZhbHNlIGlmIGFuIGFuaW1hdGlvbiBpcyBydW5uaW5nXG4gICAgICovXG4gICAgZ2V0IHBhdXNlZCAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmIChwcml2YXRlcy5hbmltYXRpb25UaW1lcikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBzZXQgcGF1c2VkICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLlNoZWV0LnBhdXNlZCByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IFJldHVybiBjdXJyZW50IGZyYW1lIG51bWJlclxuICAgICAqL1xuICAgIGdldCBjdXJyZW50RnJhbWUgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICByZXR1cm4gcHJpdmF0ZXMuY3VycmVudEZyYW1lO1xuICAgIH1cblxuICAgIHNldCBjdXJyZW50RnJhbWUgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuU2hlZXQuY3VycmVudEZyYW1lIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge3N0cmluZ30gUmV0dXJuXG4gICAgICovXG4gICAgZ2V0IGN1cnJlbnRBbmltYXRpb24gKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICByZXR1cm4gcHJpdmF0ZXMuY3VycmVudEFuaW1hdGlvbjtcbiAgICB9XG5cbiAgICBzZXQgY3VycmVudEFuaW1hdGlvbiAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5TaGVldC5jdXJyZW50QW5pbWF0aW9uIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFBsYXkgYSBmcmFtZSBvciBhbiBhbmltYXRpb25cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY2hvaWNlIGZyYW1lIG51bWJlciBvZiBhbmltYXRpb24gbmFtZSwgZWcuIDAgZm9yIGZyYW1lIG9yIFwid2Fsa2Rvd25cIiBmb3IgYW5pbWF0aW9uXG4gICAgICovXG4gICAgcGxheSAoY2hvaWNlKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmIChwcml2YXRlcy5hbmltYXRpb25UaW1lcikge1xuICAgICAgICBjbGVhckludGVydmFsKHByaXZhdGVzLmFuaW1hdGlvblRpbWVyKTtcbiAgICAgICAgcHJpdmF0ZXMuYW5pbWF0aW9uVGltZXIgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihjaG9pY2UpKSB7XG4gICAgICAgIC8vIEFyZ3VtZW50IHBvaW50cyBhIGZyYW1lXG4gICAgICAgIHByaXZhdGVzLmN1cnJlbnRGcmFtZSA9IGNob2ljZTtcbiAgICAgICAgdGhpcy5lbWl0KFwiY2hhbmdlXCIpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY2hvaWNlID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgLy8gQXJndW1lbnQgcG9pbnRzIGFuIGFuaW1hdGlvbiBuYW1lXG4gICAgICAgIGxldCBhbmltYXRpb24gPSBwcml2YXRlcy5hbmltYXRpb25zW2Nob2ljZV07XG5cbiAgICAgICAgaWYgKCFhbmltYXRpb24pIHsgLy8gaWYgYW5pbWF0aW9uIGlzIG5vdCBleGlzdFxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYW5pbWF0aW9uLCBwcml2YXRlcy5hbmltYXRpb25zLCBjaG9pY2UpO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5TaGVldC5wbGF5IGludmFsaWQgYW5pbWF0aW9uXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgYW5pbWF0aW9uIGlzIHNpbmdsZSBmcmFtZSBudW1iZXJcbiAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShhbmltYXRpb24pKSB7XG4gICAgICAgICAgcHJpdmF0ZXMuY3VycmVudEFuaW1hdGlvbiA9IGNob2ljZTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5wbGF5KGFuaW1hdGlvbik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBzdGFydCBmcmFtZSBudW1iZXJcbiAgICAgICAgbGV0IGJlZ2luID0gbnVsbDtcbiAgICAgICAgLy8gZmluaXNoIGZyYW1lIG51bWJlclxuICAgICAgICBsZXQgZW5kID0gbnVsbDtcbiAgICAgICAgLy8gd2hhdCBhY3Rpb24gYWZ0ZXIgYW5pbWF0aW9uIGZpbmlzaGVkXG4gICAgICAgIGxldCBuZXh0ID0gbnVsbDtcbiAgICAgICAgLy8gdGhlIHNwYWNlIGJldHdlZW4gZWFjaCBmcmFtZSwgbXNcbiAgICAgICAgbGV0IHRpbWUgPSBudWxsO1xuXG4gICAgICAgIGlmIChhbmltYXRpb24gaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgIC8vIGlmIGFuaW1hdGlvbiBmb3JtYXQgaXMgbGlrZSBbYmVnaW4sIGVuZCwgbmV4dCwgdGltZV1cbiAgICAgICAgICBiZWdpbiA9IGFuaW1hdGlvblswXTtcbiAgICAgICAgICBlbmQgPSBhbmltYXRpb25bMV07XG4gICAgICAgICAgbmV4dCA9IGFuaW1hdGlvblsyXTtcbiAgICAgICAgICB0aW1lID0gYW5pbWF0aW9uWzNdO1xuICAgICAgICB9IGVsc2UgaWYgKGFuaW1hdGlvbi5mcmFtZXMgJiYgYW5pbWF0aW9uLmZyYW1lcyBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgLy8gaWYgYW5pbWF0aW9uIGZvcm1hdCBpcyBsaWtlIHsgZnJhbWVzOiBbYmVnaW4sIGVuZF0sIG5leHQ6IFwibmV4dFwiLCBzcGVlZDogXCJ0aW1lXCIgfVxuICAgICAgICAgIGJlZ2luID0gYW5pbWF0aW9uLmZyYW1lc1swXTtcbiAgICAgICAgICBlbmQgPSBhbmltYXRpb24uZnJhbWVzW2FuaW1hdGlvbi5mcmFtZXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgbmV4dCA9IGFuaW1hdGlvbi5uZXh0O1xuICAgICAgICAgIHRpbWUgPSBhbmltYXRpb24uc3BlZWQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIC8vIERhdGEgZW5zdXJlXG4gICAgICAgICAgIU51bWJlci5pc0Zpbml0ZShiZWdpbikgfHwgYmVnaW4gPCAwIHx8IGJlZ2luID49IHByaXZhdGVzLmZyYW1lQ291bnQgfHxcbiAgICAgICAgICAhTnVtYmVyLmlzRmluaXRlKGVuZCkgfHwgZW5kIDwgMCB8fCBlbmQgPj0gcHJpdmF0ZXMuZnJhbWVDb3VudCB8fFxuICAgICAgICAgICFOdW1iZXIuaXNGaW5pdGUodGltZSkgfHwgdGltZSA8PSAwXG4gICAgICAgICkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYmVnaW4sIGVuZCwgdGltZSwgdGhpcyk7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLlNoZWV0LnBsYXkgSW52YWxpZCBhbmltYXRpb24gZGF0YVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBsYXkgZmlyc3QgZnJhbWUgaW4gYW5pbWF0aW9uXG4gICAgICAgIHByaXZhdGVzLmN1cnJlbnRBbmltYXRpb24gPSBjaG9pY2U7XG4gICAgICAgIHByaXZhdGVzLmN1cnJlbnRGcmFtZSA9IGJlZ2luO1xuICAgICAgICB0aGlzLmVtaXQoXCJjaGFuZ2VcIik7XG5cbiAgICAgICAgLy8gUGxheSBvdGhlciBmcmFtZSBpbiBhbmltYXRpb25cbiAgICAgICAgcHJpdmF0ZXMuYW5pbWF0aW9uVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgcHJpdmF0ZXMuY3VycmVudEZyYW1lKys7XG5cbiAgICAgICAgICBpZiAocHJpdmF0ZXMuY3VycmVudEZyYW1lID4gZW5kKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHByaXZhdGVzLmFuaW1hdGlvblRpbWVyKTtcbiAgICAgICAgICAgIHByaXZhdGVzLmFuaW1hdGlvblRpbWVyID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKG5leHQgJiYgbmV4dC5sZW5ndGggJiYgcHJpdmF0ZXMuYW5pbWF0aW9uc1tuZXh0XSkge1xuICAgICAgICAgICAgICB0aGlzLnBsYXkobmV4dCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwcml2YXRlcy5jdXJyZW50RnJhbWUtLTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZW1pdChcImFuaW1hdGlvbmVuZFwiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLmVtaXQoXCJjaGFuZ2VcIik7XG4gICAgICAgIH0sIHRpbWUpO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKGNob2ljZSwgaW50ZXJuYWwodGhpcykuYW5pbWF0aW9ucywgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5TaGVldC5wbGF5IGhhcyBhbiBpbnZhbGlkIGFyZ3VtZW50XCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhIGNlcnRhaW4gZnJhbWVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggVGhlIGluZGV4IG9mIGZyYW1lXG4gICAgICogQHJldHVybiB7T2JqZWN0fSBBbiBTcHJpdGUuRnJhbWUgb2JqZWN0XG4gICAgICovXG4gICAgZ2V0RnJhbWUgKGluZGV4KSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihpbmRleCkpIHtcbiAgICAgICAgaW5kZXggPSBwcml2YXRlcy5jdXJyZW50RnJhbWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gcHJpdmF0ZXMuZnJhbWVDb3VudCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGluZGV4LCBwcml2YXRlcywgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5TaGVldC5nZXRGcmFtZSBpbmRleCBvdXQgb2YgcmFuZ2VcIik7XG4gICAgICB9XG5cbiAgICAgIGxldCBmcmFtZSA9IG51bGw7XG4gICAgICBmb3IgKGxldCBpbWFnZSBvZiBwcml2YXRlcy5pbWFnZXMpIHtcbiAgICAgICAgbGV0IGNvbCA9IE1hdGguZmxvb3IoaW1hZ2Uud2lkdGggLyBwcml2YXRlcy50aWxld2lkdGgpO1xuICAgICAgICBsZXQgcm93ID0gTWF0aC5mbG9vcihpbWFnZS5oZWlnaHQgLyBwcml2YXRlcy50aWxlaGVpZ2h0KTtcbiAgICAgICAgaWYgKGluZGV4IDwgY29sICogcm93KSB7XG4gICAgICAgICAgLy8gd2hpY2ggcm93XG4gICAgICAgICAgbGV0IGogPSBNYXRoLmZsb29yKGluZGV4IC8gY29sKTtcbiAgICAgICAgICAvLyB3aGljaCBjb2x1bW5cbiAgICAgICAgICBsZXQgaSA9IGluZGV4IC0gY29sICogajtcbiAgICAgICAgICBmcmFtZSA9IG5ldyBTcHJpdGUuRnJhbWUgKFxuICAgICAgICAgICAgaW1hZ2UsXG4gICAgICAgICAgICBpICogcHJpdmF0ZXMudGlsZXdpZHRoLCAvLyB4XG4gICAgICAgICAgICBqICogcHJpdmF0ZXMudGlsZWhlaWdodCwgLy8geVxuICAgICAgICAgICAgcHJpdmF0ZXMudGlsZXdpZHRoLFxuICAgICAgICAgICAgcHJpdmF0ZXMudGlsZWhlaWdodFxuICAgICAgICAgICk7XG4gICAgICAgICAgZnJhbWUucGFyZW50ID0gdGhpcztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpbmRleCAtPSAoY29sICogcm93KTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFmcmFtZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGluZGV4LCBwcml2YXRlcywgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5TaGVldC5nZXRGcmFtZSB1bmtub3duIGVycm9yXCIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZnJhbWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRHJhdyB0aGlzIHNoZWV0IG9uIGNlcnRhaW4gcmVuZGVyZXJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVuZGVyZXIgQSByZW5kZXJlciBlbmdpbmUsIGVnLiBTcHJpdGUuV2ViZ2xcbiAgICAgKi9cbiAgICBkcmF3IChyZW5kZXJlcikge1xuICAgICAgaWYgKHRoaXMudmlzaWJsZSA9PSBmYWxzZSB8fCB0aGlzLmFscGhhIDw9IDAuMDEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGxldCBmcmFtZSA9IHRoaXMuZ2V0RnJhbWUodGhpcy5jdXJyZW50RnJhbWUpO1xuXG4gICAgICBpZiAoIWZyYW1lIHx8ICFmcmFtZS5pbWFnZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGZyYW1lLCB0aGlzLmN1cnJlbnRGcmFtZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5TaGVldC5kcmF3IGludmFsaWQgZnJhbWVcIik7XG4gICAgICB9XG5cbiAgICAgIGZyYW1lLmRyYXcocmVuZGVyZXIpO1xuICAgIH1cblxuICB9KTtcblxuXG59KSgpO1xuIl19

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Class Sprite.Input
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  var keyTable = {
    "tab": 9,
    "enter": 13,
    "shift": 16,
    "esc": 27,
    "space": 32,
    "left": 37,
    "up": 38,
    "right": 39,
    "down": 40,
    "0": 48,
    "1": 49,
    "2": 50,
    "3": 51,
    "4": 52,
    "5": 53,
    "6": 54,
    "7": 55,
    "8": 56,
    "9": 57,
    "A": 65, // A
    "B": 66,
    "C": 67,
    "D": 68,
    "E": 69,
    "F": 70,
    "G": 71,
    "H": 72,
    "I": 73,
    "J": 74,
    "K": 75,
    "L": 76,
    "M": 77,
    "N": 78,
    "O": 79,
    "P": 80,
    "Q": 81,
    "R": 82,
    "S": 83,
    "T": 84,
    "U": 85,
    "V": 86,
    "W": 87,
    "X": 88,
    "Y": 89,
    "Z": 90, // Z
    "a": 97, // a
    "b": 98,
    "c": 99,
    "d": 100,
    "e": 101,
    "f": 102,
    "g": 103,
    "h": 104,
    "i": 105,
    "j": 106,
    "k": 107,
    "l": 108,
    "m": 109,
    "n": 110,
    "o": 111,
    "p": 112,
    "q": 113,
    "r": 114,
    "s": 115,
    "t": 116,
    "u": 117,
    "v": 118,
    "w": 119,
    "x": 120,
    "y": 121,
    "z": 122 // z
  };

  var pressed = new Map();

  window.addEventListener("keydown", function (event) {
    event = event || window.event;
    var keyCode = event.keyCode;
    pressed.set(keyCode, true);
  });

  window.addEventListener("keyup", function (event) {
    event = event || window.event;
    var keyCode = event.keyCode;
    if (pressed.has(keyCode)) {
      pressed["delete"](keyCode);
    }
  });

  /**
   * Sprite.Input, only has static methods
   * @class
   */
  Sprite.assign("Input", (function () {
    function SpriteInput() {
      _classCallCheck(this, SpriteInput);
    }

    _createClass(SpriteInput, null, [{
      key: "isPressed",

      /**
       * @param {string} key Key-string ('A', 'a') or key-number (65, 97)
       * @return {boolean} If the key is pressing, return true, otherwise, false
       */
      value: function isPressed(key) {
        if (Number.isFinite(key)) {
          if (pressed.has(key)) {
            return true;
          }
          return false;
        } else if (typeof key == "string") {
          key = keyTable[key];
          if (pressed.has(key)) {
            return true;
          }
          return false;
        } else {
          console.error(key);
          throw new Error("Sprite.Input.isPressed got invalid argument");
        }
      }

      /**
       * @param {Array} keys Keys to monitor, eg. ["A", "B", "C", "a", "b", "c"]
       * @param {function} callback When key in keys is pressed, callback
       */
    }, {
      key: "whenPress",
      value: function whenPress(keys, callback) {
        if (callback) {
          window.addEventListener("keypress", function (event) {
            event = event || window.event;
            var keyCode = event.keyCode;
            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
              for (var _iterator = keys[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                var key = _step.value;

                var code = keyTable[key];
                if (code && code == keyCode) {
                  callback(key);
                }
              }
            } catch (err) {
              _didIteratorError = true;
              _iteratorError = err;
            } finally {
              try {
                if (!_iteratorNormalCompletion && _iterator["return"]) {
                  _iterator["return"]();
                }
              } finally {
                if (_didIteratorError) {
                  throw _iteratorError;
                }
              }
            }
          });
        } else {
          console.error(callback);
          throw new Error("Sprite.Input.whenPress got invalid arguments");
        }
      }

      /**
       * @param {Array} keys Keys to monitor, eg. ["A", "B", "C", "a", "b", "c"]
       * @param {function} callback When key in keys is pressed, callback
       */
    }, {
      key: "whenDown",
      value: function whenDown(keys, callback) {
        if (callback) {
          window.addEventListener("keydown", function (event) {
            event = event || window.event;
            var keyCode = event.keyCode;
            var _iteratorNormalCompletion2 = true;
            var _didIteratorError2 = false;
            var _iteratorError2 = undefined;

            try {
              for (var _iterator2 = keys[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                var key = _step2.value;

                var code = keyTable[key];
                if (code && code == keyCode) {
                  callback(key);
                }
              }
            } catch (err) {
              _didIteratorError2 = true;
              _iteratorError2 = err;
            } finally {
              try {
                if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
                  _iterator2["return"]();
                }
              } finally {
                if (_didIteratorError2) {
                  throw _iteratorError2;
                }
              }
            }
          });
        } else {
          console.error(callback);
          throw new Error("Sprite.Input.whenDown got invalid arguments");
        }
      }

      /**
       * @param {Array} keys Keys to monitor, eg. ["A", "B", "C", "a", "b", "c"]
       * @param {function} callback When key in keys is pressed, callback
       */
    }, {
      key: "whenUp",
      value: function whenUp(keys, callback) {
        if (callback) {
          window.addEventListener("keyup", function (event) {
            event = event || window.event;
            var keyCode = event.keyCode;
            var _iteratorNormalCompletion3 = true;
            var _didIteratorError3 = false;
            var _iteratorError3 = undefined;

            try {
              for (var _iterator3 = keys[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                var key = _step3.value;

                var code = keyTable[key];
                if (code && code == keyCode) {
                  callback(key);
                }
              }
            } catch (err) {
              _didIteratorError3 = true;
              _iteratorError3 = err;
            } finally {
              try {
                if (!_iteratorNormalCompletion3 && _iterator3["return"]) {
                  _iterator3["return"]();
                }
              } finally {
                if (_didIteratorError3) {
                  throw _iteratorError3;
                }
              }
            }
          });
        } else {
          console.error(callback);
          throw new Error("Sprite.Input.whenUp got invalid arguments");
        }
      }
    }]);

    return SpriteInput;
  })());
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlSW5wdXQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQSxDQUFDLFlBQVk7QUFDWixjQUFZLENBQUM7O0FBRVosTUFBSSxRQUFRLEdBQUc7QUFDYixTQUFLLEVBQUUsQ0FBQztBQUNSLFdBQU8sRUFBRSxFQUFFO0FBQ1gsV0FBTyxFQUFFLEVBQUU7QUFDWCxTQUFLLEVBQUUsRUFBRTtBQUNULFdBQU8sRUFBRSxFQUFFO0FBQ1gsVUFBTSxFQUFFLEVBQUU7QUFDVixRQUFJLEVBQUUsRUFBRTtBQUNSLFdBQU8sRUFBRSxFQUFFO0FBQ1gsVUFBTSxFQUFFLEVBQUU7QUFDVixPQUFHLEVBQUUsRUFBRTtBQUNQLE9BQUcsRUFBRSxFQUFFO0FBQ1AsT0FBRyxFQUFFLEVBQUU7QUFDUCxPQUFHLEVBQUUsRUFBRTtBQUNQLE9BQUcsRUFBRSxFQUFFO0FBQ1AsT0FBRyxFQUFFLEVBQUU7QUFDUCxPQUFHLEVBQUUsRUFBRTtBQUNQLE9BQUcsRUFBRSxFQUFFO0FBQ1AsT0FBRyxFQUFFLEVBQUU7QUFDUCxPQUFHLEVBQUUsRUFBRTtBQUNQLE9BQUcsRUFBRSxFQUFFO0FBQ1AsT0FBRyxFQUFFLEVBQUU7QUFDUCxPQUFHLEVBQUUsRUFBRTtBQUNQLE9BQUcsRUFBRSxFQUFFO0FBQ1AsT0FBRyxFQUFFLEVBQUU7QUFDUCxPQUFHLEVBQUUsRUFBRTtBQUNQLE9BQUcsRUFBRSxFQUFFO0FBQ1AsT0FBRyxFQUFFLEVBQUU7QUFDUCxPQUFHLEVBQUUsRUFBRTtBQUNQLE9BQUcsRUFBRSxFQUFFO0FBQ1AsT0FBRyxFQUFFLEVBQUU7QUFDUCxPQUFHLEVBQUUsRUFBRTtBQUNQLE9BQUcsRUFBRSxFQUFFO0FBQ1AsT0FBRyxFQUFFLEVBQUU7QUFDUCxPQUFHLEVBQUUsRUFBRTtBQUNQLE9BQUcsRUFBRSxFQUFFO0FBQ1AsT0FBRyxFQUFFLEVBQUU7QUFDUCxPQUFHLEVB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QTZDLENBQUMsQ0FBQztTQUNoRTtPQUNGOzs7Ozs7OzthQU1hLGdCQUFDLElBQUksRUFBRSxRQUFRLEVBQUU7QUFDN0IsWUFBSSxRQUFRLEVBQUU7QUFDWixnQkFBTSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUNoRCxpQkFBSyxHQUFHLEtBQUssSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQzlCLGdCQUFJLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDOzs7Ozs7QUFDNUIsb0NBQWdCLElBQUksbUlBQUU7b0JBQWIsR0FBRzs7QUFDVixvQkFBSSxJQUFJLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3pCLG9CQUFJLElBQUksSUFBSSxJQUFJLElBQUksT0FBTyxFQUFFO0FBQzNCLDBCQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7aUJBQ2Y7ZUFDRjs7Ozs7Ozs7Ozs7Ozs7O1dBQ0YsQ0FBQyxDQUFDO1NBQ0osTUFBTTtBQUNMLGlCQUFPLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ3hCLGdCQUFNLElBQUksS0FBSyxDQUFDLDJDQUEyQyxDQUFDLENBQUM7U0FDOUQ7T0FDRjs7O1dBeEYwQixXQUFXO09BeUZ0QyxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiU3ByaXRlSW5wdXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ2xhc3MgU3ByaXRlLklucHV0XG4gKiBAYXV0aG9yIG1haWxAcWhkdWFuLmNvbSAoUUggRHVhbilcbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCBrZXlUYWJsZSA9IHtcbiAgICBcInRhYlwiOiA5LFxuICAgIFwiZW50ZXJcIjogMTMsXG4gICAgXCJzaGlmdFwiOiAxNixcbiAgICBcImVzY1wiOiAyNyxcbiAgICBcInNwYWNlXCI6IDMyLFxuICAgIFwibGVmdFwiOiAzNyxcbiAgICBcInVwXCI6IDM4LFxuICAgIFwicmlnaHRcIjogMzksXG4gICAgXCJkb3duXCI6IDQwLFxuICAgIFwiMFwiOiA0OCxcbiAgICBcIjFcIjogNDksXG4gICAgXCIyXCI6IDUwLFxuICAgIFwiM1wiOiA1MSxcbiAgICBcIjRcIjogNTIsXG4gICAgXCI1XCI6IDUzLFxuICAgIFwiNlwiOiA1NCxcbiAgICBcIjdcIjogNTUsXG4gICAgXCI4XCI6IDU2LFxuICAgIFwiOVwiOiA1NyxcbiAgICBcIkFcIjogNjUsIC8vIEFcbiAgICBcIkJcIjogNjYsXG4gICAgXCJDXCI6IDY3LFxuICAgIFwiRFwiOiA2OCxcbiAgICBcIkVcIjogNjksXG4gICAgXCJGXCI6IDcwLFxuICAgIFwiR1wiOiA3MSxcbiAgICBcIkhcIjogNzIsXG4gICAgXCJJXCI6IDczLFxuICAgIFwiSlwiOiA3NCxcbiAgICBcIktcIjogNzUsXG4gICAgXCJMXCI6IDc2LFxuICAgIFwiTVwiOiA3NyxcbiAgICBcIk5cIjogNzgsXG4gICAgXCJPXCI6IDc5LFxuICAgIFwiUFwiOiA4MCxcbiAgICBcIlFcIjogODEsXG4gICAgXCJSXCI6IDgyLFxuICAgIFwiU1wiOiA4MyxcbiAgICBcIlRcIjogODQsXG4gICAgXCJVXCI6IDg1LFxuICAgIFwiVlwiOiA4NixcbiAgICBcIldcIjogODcsXG4gICAgXCJYXCI6IDg4LFxuICAgIFwiWVwiOiA4OSxcbiAgICBcIlpcIjogOTAsIC8vIFpcbiAgICBcImFcIjogOTcsIC8vIGFcbiAgICBcImJcIjogOTgsXG4gICAgXCJjXCI6IDk5LFxuICAgIFwiZFwiOiAxMDAsXG4gICAgXCJlXCI6IDEwMSxcbiAgICBcImZcIjogMTAyLFxuICAgIFwiZ1wiOiAxMDMsXG4gICAgXCJoXCI6IDEwNCxcbiAgICBcImlcIjogMTA1LFxuICAgIFwialwiOiAxMDYsXG4gICAgXCJrXCI6IDEwNyxcbiAgICBcImxcIjogMTA4LFxuICAgIFwibVwiOiAxMDksXG4gICAgXCJuXCI6IDExMCxcbiAgICBcIm9cIjogMTExLFxuICAgIFwicFwiOiAxMTIsXG4gICAgXCJxXCI6IDExMyxcbiAgICBcInJcIjogMTE0LFxuICAgIFwic1wiOiAxMTUsXG4gICAgXCJ0XCI6IDExNixcbiAgICBcInVcIjogMTE3LFxuICAgIFwidlwiOiAxMTgsXG4gICAgXCJ3XCI6IDExOSxcbiAgICBcInhcIjogMTIwLFxuICAgIFwieVwiOiAxMjEsXG4gICAgXCJ6XCI6IDEyMiAvLyB6XG4gIH07XG5cbiAgbGV0IHByZXNzZWQgPSBuZXcgTWFwKCk7XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50O1xuICAgIGxldCBrZXlDb2RlID0gZXZlbnQua2V5Q29kZTtcbiAgICBwcmVzc2VkLnNldChrZXlDb2RlLCB0cnVlKTtcbiAgfSk7XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBldmVudCA9IGV2ZW50IHx8IHdpbmRvdy5ldmVudDtcbiAgICBsZXQga2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7XG4gICAgaWYgKHByZXNzZWQuaGFzKGtleUNvZGUpKSB7XG4gICAgICBwcmVzc2VkLmRlbGV0ZShrZXlDb2RlKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBTcHJpdGUuSW5wdXQsIG9ubHkgaGFzIHN0YXRpYyBtZXRob2RzXG4gICAqIEBjbGFzc1xuICAgKi9cbiAgU3ByaXRlLmFzc2lnbihcIklucHV0XCIsIGNsYXNzIFNwcml0ZUlucHV0IHtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgS2V5LXN0cmluZyAoJ0EnLCAnYScpIG9yIGtleS1udW1iZXIgKDY1LCA5NylcbiAgICAgKiBAcmV0dXJuIHtib29sZWFufSBJZiB0aGUga2V5IGlzIHByZXNzaW5nLCByZXR1cm4gdHJ1ZSwgb3RoZXJ3aXNlLCBmYWxzZVxuICAgICAqL1xuICAgIHN0YXRpYyBpc1ByZXNzZWQgKGtleSkge1xuICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShrZXkpKSB7XG4gICAgICAgIGlmIChwcmVzc2VkLmhhcyhrZXkpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2Yga2V5ID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAga2V5ID0ga2V5VGFibGVba2V5XTtcbiAgICAgICAgaWYgKHByZXNzZWQuaGFzKGtleSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKGtleSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5JbnB1dC5pc1ByZXNzZWQgZ290IGludmFsaWQgYXJndW1lbnRcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtBcnJheX0ga2V5cyBLZXlzIHRvIG1vbml0b3IsIGVnLiBbXCJBXCIsIFwiQlwiLCBcIkNcIiwgXCJhXCIsIFwiYlwiLCBcImNcIl1cbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBXaGVuIGtleSBpbiBrZXlzIGlzIHByZXNzZWQsIGNhbGxiYWNrXG4gICAgICovXG4gICAgc3RhdGljIHdoZW5QcmVzcyAoa2V5cywgY2FsbGJhY2spIHtcbiAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleXByZXNzXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50O1xuICAgICAgICAgIGxldCBrZXlDb2RlID0gZXZlbnQua2V5Q29kZTtcbiAgICAgICAgICBmb3IgKGxldCBrZXkgb2Yga2V5cykge1xuICAgICAgICAgICAgbGV0IGNvZGUgPSBrZXlUYWJsZVtrZXldO1xuICAgICAgICAgICAgaWYgKGNvZGUgJiYgY29kZSA9PSBrZXlDb2RlKSB7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoY2FsbGJhY2spO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuSW5wdXQud2hlblByZXNzIGdvdCBpbnZhbGlkIGFyZ3VtZW50c1wiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBrZXlzIEtleXMgdG8gbW9uaXRvciwgZWcuIFtcIkFcIiwgXCJCXCIsIFwiQ1wiLCBcImFcIiwgXCJiXCIsIFwiY1wiXVxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIFdoZW4ga2V5IGluIGtleXMgaXMgcHJlc3NlZCwgY2FsbGJhY2tcbiAgICAgKi9cbiAgICBzdGF0aWMgd2hlbkRvd24gKGtleXMsIGNhbGxiYWNrKSB7XG4gICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50O1xuICAgICAgICAgIGxldCBrZXlDb2RlID0gZXZlbnQua2V5Q29kZTtcbiAgICAgICAgICBmb3IgKGxldCBrZXkgb2Yga2V5cykge1xuICAgICAgICAgICAgbGV0IGNvZGUgPSBrZXlUYWJsZVtrZXldO1xuICAgICAgICAgICAgaWYgKGNvZGUgJiYgY29kZSA9PSBrZXlDb2RlKSB7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoY2FsbGJhY2spO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuSW5wdXQud2hlbkRvd24gZ290IGludmFsaWQgYXJndW1lbnRzXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGtleXMgS2V5cyB0byBtb25pdG9yLCBlZy4gW1wiQVwiLCBcIkJcIiwgXCJDXCIsIFwiYVwiLCBcImJcIiwgXCJjXCJdXG4gICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgV2hlbiBrZXkgaW4ga2V5cyBpcyBwcmVzc2VkLCBjYWxsYmFja1xuICAgICAqL1xuICAgIHN0YXRpYyB3aGVuVXAgKGtleXMsIGNhbGxiYWNrKSB7XG4gICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICBldmVudCA9IGV2ZW50IHx8IHdpbmRvdy5ldmVudDtcbiAgICAgICAgICBsZXQga2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7XG4gICAgICAgICAgZm9yIChsZXQga2V5IG9mIGtleXMpIHtcbiAgICAgICAgICAgIGxldCBjb2RlID0ga2V5VGFibGVba2V5XTtcbiAgICAgICAgICAgIGlmIChjb2RlICYmIGNvZGUgPT0ga2V5Q29kZSkge1xuICAgICAgICAgICAgICBjYWxsYmFjayhrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKGNhbGxiYWNrKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLklucHV0LndoZW5VcCBnb3QgaW52YWxpZCBhcmd1bWVudHNcIik7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuXG59KSgpO1xuIl19

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Create a shape
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
   * Class Sprite.Shape
   * @class
   * @extends Sprite.Display
   */
  Sprite.assign("Shape", (function (_Sprite$Display) {
    _inherits(SpriteShape, _Sprite$Display);

    /**
     * construct Sprite.Shape
     * @constructor
     */

    function SpriteShape() {
      _classCallCheck(this, SpriteShape);

      _get(Object.getPrototypeOf(SpriteShape.prototype), "constructor", this).call(this);
      var privates = internal(this);
      privates.children = [];
      this.width = 0;
      this.height = 0;
      privates.image = null;
    }

    _createClass(SpriteShape, [{
      key: "clone",
      value: function clone() {
        var privates = internal(this);
        var shape = new Sprite.Shape();
        internal(shape).children = privates.children.slice();
        internal(shape).image = privates.image;
        shape.width = this.width;
        shape.height = this.height;
        shape.x = this.x;
        shape.y = this.y;
        shape.centerX = this.centerX;
        shape.centerY = this.centerY;
        return shape;
      }
    }, {
      key: "clear",
      value: function clear() {
        var privates = internal(this);
        privates.children = [];
        this.width = 0;
        this.height = 0;
        this.generate();
        return this;
      }
    }, {
      key: "makeConfig",
      value: function makeConfig(defaultConfig, userConfig) {
        if (userConfig) {
          for (var key in userConfig) {
            defaultConfig[key] = userConfig[key];
          }
        }
        var ret = [];
        for (var key in defaultConfig) {
          ret.push(key + "=\"" + defaultConfig[key] + "\"");
        }
        return ret.join(" ");
      }
    }, {
      key: "rect",
      value: function rect(userConfig) {
        var privates = internal(this);
        var config = {
          "x": 0,
          "y": 0,
          "width": 10,
          "height": 10,
          "stroke": "black",
          "stroke-width": 1,
          "fill": "white",
          "fill-opacity": 1,
          "stroke-opacity": 1,
          "opacity": 1
        };

        privates.children.push("<rect " + this.makeConfig(config, userConfig) + " />");

        if (config.x + config.width > this.width) {
          this.width = config.x + config.width;
        }
        if (config.y + config.height > this.height) {
          this.height = config.y + config.height;
        }
        this.generate();
      }
    }, {
      key: "circle",
      value: function circle(userConfig) {
        var privates = internal(this);
        var config = {
          "cx": 10,
          "cy": 10,
          "r": 10,
          "stroke": "black",
          "stroke-width": 1,
          "fill": "white",
          "fill-opacity": 1,
          "stroke-opacity": 1,
          "opacity": 1
        };

        privates.children.push("<circle " + this.makeConfig(config, userConfig) + " />");

        if (config.cx + config.r > this.width) {
          this.width = config.cx + config.r;
        }
        if (config.cy + config.r > this.height) {
          this.height = config.cy + config.r;
        }
        this.generate();
      }
    }, {
      key: "ellipse",
      value: function ellipse(userConfig) {
        var privates = internal(this);
        var config = {
          "cx": 10,
          "cy": 10,
          "rx": 5,
          "ry": 10,
          "stroke": "black",
          "stroke-width": 1,
          "fill": "white",
          "fill-opacity": 1,
          "stroke-opacity": 1,
          "opacity": 1
        };

        privates.children.push("<ellipse " + this.makeConfig(config, userConfig) + " />");

        if (config.cx + config.rx > this.width) {
          this.width = config.cx + config.rx;
        }
        if (config.cy + config.ry > this.height) {
          this.height = config.cy + config.ry;
        }
        this.generate();
      }
    }, {
      key: "line",
      value: function line(userConfig) {
        var privates = internal(this);
        var config = {
          "x1": 10,
          "y1": 10,
          "x2": 20,
          "y2": 20,
          "stroke": "black",
          "stroke-width": 1,
          "stroke-opacity": 1,
          "opacity": 1
        };

        privates.children.push("<line " + this.makeConfig(config, userConfig) + " />");

        if (Math.max(config.x1, config.x2) > this.width) {
          this.width = Math.max(config.x1, config.x2);
        }
        if (Math.max(config.y1, config.y2) > this.height) {
          this.height = Math.max(config.y1, config.y2);
        }
        this.generate();
      }
    }, {
      key: "polyline",
      value: function polyline(userConfig) {
        var privates = internal(this);
        var config = {
          "points": "20, 20, 30, 20, 30, 30, 20, 30",
          "stroke": "black",
          "stroke-width": 1,
          "fill": "white",
          "fill-opacity": 1,
          "stroke-opacity": 1,
          "opacity": 1
        };

        privates.children.push("<polyline " + this.makeConfig(config, userConfig) + " />");

        var max = -1;
        config.points.split(/, /).forEach(function (element) {
          var number = parseInt(element);
          if (!isNaN(number) && number > max) {
            max = number;
          }
        });

        if (max != -1 && max > this.width) {
          this.width = max;
        }
        if (max != -1 && max > this.height) {
          this.height = max;
        }
        this.generate();
      }
    }, {
      key: "polygon",
      value: function polygon(userConfig) {
        var privates = internal(this);
        var config = {
          "points": "20,20 30,20 30,30 20,30",
          "stroke": "black",
          "stroke-width": 1,
          "fill": "white",
          "fill-opacity": 1,
          "stroke-opacity": 1,
          "opacity": 1
        };

        privates.children.push("<polyline " + this.makeConfig(config, userConfig) + " />");

        var width = -1;
        var height = -1;
        // split points by comma or space
        config.points.split(/,| /).forEach(function (element, index) {
          var number = parseInt(element);
          if (index % 2 == 0) {
            // even
            if (number > width) width = number;
          } else {
            // odds
            if (number > height) height = number;
          }
        });

        if (width > 0 && width > this.width) this.width = width;
        if (height > 0 && height > this.height) this.height = height;
        this.generate();
      }
    }, {
      key: "generate",
      value: function generate() {
        var _this = this;

        var privates = internal(this);
        var svg = "<?xml version=\"1.0\"?>\n<svg width=\"" + this.width + "\" height=\"" + this.height + "\" " + ("style=\"width: " + this.width + "px; height: " + this.height + "px;\" ") + "xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">\n";

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = privates.children[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var child = _step.value;

            svg += "  " + child + "\n";
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator["return"]) {
              _iterator["return"]();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        svg += "</svg>";

        var blob = new Blob([svg], { type: "image/svg+xml;charset=utf-8" });
        var url = window.URL.createObjectURL(blob);
        var image = new Image();
        image.src = url;

        var Done = function Done() {
          privates.image = image;
          window.URL.revokeObjectURL(url);
          _this.emit("change");
        };

        if (image.complete) {
          Done();
        } else {
          image.onload = Done;
        }
      }
    }, {
      key: "draw",
      value: function draw(renderer) {
        var privates = internal(this);
        var image = privates.image;
        if (image instanceof Image && image.width > 0 && image.height > 0) {
          this.drawImage(renderer, image, 0, 0, image.width, image.height, 0, 0, image.width, image.height);
        }
      }
    }]);

    return SpriteShape;
  })(Sprite.Display));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlU2hhcGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5QkEsQ0FBQyxZQUFZO0FBQ1osY0FBWSxDQUFDOztBQUVaLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7Ozs7OztBQU9sQyxRQUFNLENBQUMsTUFBTSxDQUFDLE9BQU87Y0FBUSxXQUFXOzs7Ozs7O0FBSzFCLGFBTGUsV0FBVyxHQUt2Qjs0QkFMWSxXQUFXOztBQU1wQyxpQ0FOeUIsV0FBVyw2Q0FNNUI7QUFDUixVQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDOUIsY0FBUSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7QUFDdkIsVUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7QUFDZixVQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztBQUNoQixjQUFRLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztLQUN2Qjs7aUJBWjBCLFdBQVc7O2FBY2hDLGlCQUFHO0FBQ1AsWUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlCLFlBQUksS0FBSyxHQUFHLElBQUksTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0FBQy9CLGdCQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDckQsZ0JBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQztBQUN2QyxhQUFLLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7QUFDekIsYUFBSyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0FBQzNCLGFBQUssQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FB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LFFBQVEsRUFBRTtBQUNkLFlBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM5QixZQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDO0FBQzNCLFlBQUksS0FBSyxZQUFZLEtBQUssSUFBSSxLQUFLLENBQUMsS0FBSyxHQUFHLENBQUMsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtBQUNqRSxjQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQzVCLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsTUFBTSxFQUMvQixDQUFDLEVBQUUsQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FDaEMsQ0FBQztTQUNIO09BQ0Y7OztXQWpRMEIsV0FBVztLQUFTLE1BQU0sQ0FBQyxPQUFPLEVBa1E3RCxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiU3ByaXRlU2hhcGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG4yRCBHYW1lIFNwcml0ZSBMaWJyYXJ5LCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgQ3JlYXRlIGEgc2hhcGVcbiAqIEBhdXRob3IgbWFpbEBxaGR1YW4uY29tIChRSCBEdWFuKVxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gIC8qKlxuICAgKiBDbGFzcyBTcHJpdGUuU2hhcGVcbiAgICogQGNsYXNzXG4gICAqIEBleHRlbmRzIFNwcml0ZS5EaXNwbGF5XG4gICAqL1xuICBTcHJpdGUuYXNzaWduKFwiU2hhcGVcIiwgY2xhc3MgU3ByaXRlU2hhcGUgZXh0ZW5kcyBTcHJpdGUuRGlzcGxheSB7XG4gICAgLyoqXG4gICAgICogY29uc3RydWN0IFNwcml0ZS5TaGFwZVxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yICgpIHtcbiAgICAgIHN1cGVyKCk7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHByaXZhdGVzLmNoaWxkcmVuID0gW107XG4gICAgICB0aGlzLndpZHRoID0gMDtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gMDtcbiAgICAgIHByaXZhdGVzLmltYWdlID0gbnVsbDtcbiAgICB9XG5cbiAgICBjbG9uZSAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGxldCBzaGFwZSA9IG5ldyBTcHJpdGUuU2hhcGUoKTtcbiAgICAgIGludGVybmFsKHNoYXBlKS5jaGlsZHJlbiA9IHByaXZhdGVzLmNoaWxkcmVuLnNsaWNlKCk7XG4gICAgICBpbnRlcm5hbChzaGFwZSkuaW1hZ2UgPSBwcml2YXRlcy5pbWFnZTtcbiAgICAgIHNoYXBlLndpZHRoID0gdGhpcy53aWR0aDtcbiAgICAgIHNoYXBlLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgc2hhcGUueCA9IHRoaXMueDtcbiAgICAgIHNoYXBlLnkgPSB0aGlzLnk7XG4gICAgICBzaGFwZS5jZW50ZXJYID0gdGhpcy5jZW50ZXJYO1xuICAgICAgc2hhcGUuY2VudGVyWSA9IHRoaXMuY2VudGVyWTtcbiAgICAgIHJldHVybiBzaGFwZTtcbiAgICB9XG5cbiAgICBjbGVhciAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHByaXZhdGVzLmNoaWxkcmVuID0gW107XG4gICAgICB0aGlzLndpZHRoID0gMDtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gMDtcbiAgICAgIHRoaXMuZ2VuZXJhdGUoKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIG1ha2VDb25maWcgKGRlZmF1bHRDb25maWcsIHVzZXJDb25maWcpIHtcbiAgICAgIGlmICh1c2VyQ29uZmlnKSB7XG4gICAgICAgIGZvciAobGV0IGtleSBpbiB1c2VyQ29uZmlnKSB7XG4gICAgICAgICAgZGVmYXVsdENvbmZpZ1trZXldID0gdXNlckNvbmZpZ1trZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsZXQgcmV0ID0gW107XG4gICAgICBmb3IgKGxldCBrZXkgaW4gZGVmYXVsdENvbmZpZykge1xuICAgICAgICByZXQucHVzaChgJHtrZXl9PVwiJHtkZWZhdWx0Q29uZmlnW2tleV19XCJgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXQuam9pbihcIiBcIik7XG4gICAgfVxuXG4gICAgcmVjdCAodXNlckNvbmZpZykge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBsZXQgY29uZmlnID0ge1xuICAgICAgICBcInhcIjogMCxcbiAgICAgICAgXCJ5XCI6IDAsXG4gICAgICAgIFwid2lkdGhcIjogMTAsXG4gICAgICAgIFwiaGVpZ2h0XCI6IDEwLFxuICAgICAgICBcInN0cm9rZVwiOiBcImJsYWNrXCIsXG4gICAgICAgIFwic3Ryb2tlLXdpZHRoXCI6IDEsXG4gICAgICAgIFwiZmlsbFwiOiBcIndoaXRlXCIsXG4gICAgICAgIFwiZmlsbC1vcGFjaXR5XCI6IDEsXG4gICAgICAgIFwic3Ryb2tlLW9wYWNpdHlcIjogMSxcbiAgICAgICAgXCJvcGFjaXR5XCI6IDEsXG4gICAgICB9O1xuXG4gICAgICBwcml2YXRlcy5jaGlsZHJlbi5wdXNoKGA8cmVjdCAke3RoaXMubWFrZUNvbmZpZyhjb25maWcsIHVzZXJDb25maWcpfSAvPmApO1xuXG4gICAgICBpZiAoY29uZmlnLnggKyBjb25maWcud2lkdGggPiB0aGlzLndpZHRoKSB7XG4gICAgICAgIHRoaXMud2lkdGggPSBjb25maWcueCArIGNvbmZpZy53aWR0aDtcbiAgICAgIH1cbiAgICAgIGlmIChjb25maWcueSArIGNvbmZpZy5oZWlnaHQgPiB0aGlzLmhlaWdodCkge1xuICAgICAgICB0aGlzLmhlaWdodCA9IGNvbmZpZy55ICsgY29uZmlnLmhlaWdodDtcbiAgICAgIH1cbiAgICAgIHRoaXMuZ2VuZXJhdGUoKTtcbiAgICB9XG5cbiAgICBjaXJjbGUgKHVzZXJDb25maWcpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgXCJjeFwiOiAxMCxcbiAgICAgICAgXCJjeVwiOiAxMCxcbiAgICAgICAgXCJyXCI6IDEwLFxuICAgICAgICBcInN0cm9rZVwiOiBcImJsYWNrXCIsXG4gICAgICAgIFwic3Ryb2tlLXdpZHRoXCI6IDEsXG4gICAgICAgIFwiZmlsbFwiOiBcIndoaXRlXCIsXG4gICAgICAgIFwiZmlsbC1vcGFjaXR5XCI6IDEsXG4gICAgICAgIFwic3Ryb2tlLW9wYWNpdHlcIjogMSxcbiAgICAgICAgXCJvcGFjaXR5XCI6IDEsXG4gICAgICB9O1xuXG4gICAgICBwcml2YXRlcy5jaGlsZHJlbi5wdXNoKGA8Y2lyY2xlICR7dGhpcy5tYWtlQ29uZmlnKGNvbmZpZywgdXNlckNvbmZpZyl9IC8+YCk7XG5cbiAgICAgIGlmIChjb25maWcuY3ggKyBjb25maWcuciA+IHRoaXMud2lkdGgpIHtcbiAgICAgICAgdGhpcy53aWR0aCA9IGNvbmZpZy5jeCArIGNvbmZpZy5yO1xuICAgICAgfVxuICAgICAgaWYgKGNvbmZpZy5jeSArIGNvbmZpZy5yID4gdGhpcy5oZWlnaHQpIHtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBjb25maWcuY3kgKyBjb25maWcucjtcbiAgICAgIH1cbiAgICAgIHRoaXMuZ2VuZXJhdGUoKTtcbiAgICB9XG5cbiAgICBlbGxpcHNlICh1c2VyQ29uZmlnKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGxldCBjb25maWcgPSB7XG4gICAgICAgIFwiY3hcIjogMTAsXG4gICAgICAgIFwiY3lcIjogMTAsXG4gICAgICAgIFwicnhcIjogNSxcbiAgICAgICAgXCJyeVwiOiAxMCxcbiAgICAgICAgXCJzdHJva2VcIjogXCJibGFja1wiLFxuICAgICAgICBcInN0cm9rZS13aWR0aFwiOiAxLFxuICAgICAgICBcImZpbGxcIjogXCJ3aGl0ZVwiLFxuICAgICAgICBcImZpbGwtb3BhY2l0eVwiOiAxLFxuICAgICAgICBcInN0cm9rZS1vcGFjaXR5XCI6IDEsXG4gICAgICAgIFwib3BhY2l0eVwiOiAxLFxuICAgICAgfTtcblxuICAgICAgcHJpdmF0ZXMuY2hpbGRyZW4ucHVzaChgPGVsbGlwc2UgJHt0aGlzLm1ha2VDb25maWcoY29uZmlnLCB1c2VyQ29uZmlnKX0gLz5gKTtcblxuICAgICAgaWYgKGNvbmZpZy5jeCArIGNvbmZpZy5yeCA+IHRoaXMud2lkdGgpIHtcbiAgICAgICAgdGhpcy53aWR0aCA9IGNvbmZpZy5jeCArIGNvbmZpZy5yeDtcbiAgICAgIH1cbiAgICAgIGlmIChjb25maWcuY3kgKyBjb25maWcucnkgPiB0aGlzLmhlaWdodCkge1xuICAgICAgICB0aGlzLmhlaWdodCA9IGNvbmZpZy5jeSArIGNvbmZpZy5yeTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZ2VuZXJhdGUoKTtcbiAgICB9XG5cbiAgICBsaW5lICh1c2VyQ29uZmlnKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGxldCBjb25maWcgPSB7XG4gICAgICAgIFwieDFcIjogMTAsXG4gICAgICAgIFwieTFcIjogMTAsXG4gICAgICAgIFwieDJcIjogMjAsXG4gICAgICAgIFwieTJcIjogMjAsXG4gICAgICAgIFwic3Ryb2tlXCI6IFwiYmxhY2tcIixcbiAgICAgICAgXCJzdHJva2Utd2lkdGhcIjogMSxcbiAgICAgICAgXCJzdHJva2Utb3BhY2l0eVwiOiAxLFxuICAgICAgICBcIm9wYWNpdHlcIjogMSxcbiAgICAgIH07XG5cbiAgICAgIHByaXZhdGVzLmNoaWxkcmVuLnB1c2goYDxsaW5lICR7dGhpcy5tYWtlQ29uZmlnKGNvbmZpZywgdXNlckNvbmZpZyl9IC8+YCk7XG5cbiAgICAgIGlmIChNYXRoLm1heChjb25maWcueDEsIGNvbmZpZy54MikgPiB0aGlzLndpZHRoKSB7XG4gICAgICAgIHRoaXMud2lkdGggPSBNYXRoLm1heChjb25maWcueDEsIGNvbmZpZy54Mik7XG4gICAgICB9XG4gICAgICBpZiAoTWF0aC5tYXgoY29uZmlnLnkxLCBjb25maWcueTIpID4gdGhpcy5oZWlnaHQpIHtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBNYXRoLm1heChjb25maWcueTEsIGNvbmZpZy55Mik7XG4gICAgICB9XG4gICAgICB0aGlzLmdlbmVyYXRlKCk7XG4gICAgfVxuXG4gICAgcG9seWxpbmUgKHVzZXJDb25maWcpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgXCJwb2ludHNcIjogXCIyMCwgMjAsIDMwLCAyMCwgMzAsIDMwLCAyMCwgMzBcIixcbiAgICAgICAgXCJzdHJva2VcIjogXCJibGFja1wiLFxuICAgICAgICBcInN0cm9rZS13aWR0aFwiOiAxLFxuICAgICAgICBcImZpbGxcIjogXCJ3aGl0ZVwiLFxuICAgICAgICBcImZpbGwtb3BhY2l0eVwiOiAxLFxuICAgICAgICBcInN0cm9rZS1vcGFjaXR5XCI6IDEsXG4gICAgICAgIFwib3BhY2l0eVwiOiAxLFxuICAgICAgfTtcblxuICAgICAgcHJpdmF0ZXMuY2hpbGRyZW4ucHVzaChgPHBvbHlsaW5lICR7dGhpcy5tYWtlQ29uZmlnKGNvbmZpZywgdXNlckNvbmZpZyl9IC8+YCk7XG5cbiAgICAgIGxldCBtYXggPSAtMTtcbiAgICAgIGNvbmZpZy5wb2ludHMuc3BsaXQoLywgLykuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICBsZXQgbnVtYmVyID0gcGFyc2VJbnQoZWxlbWVudCk7XG4gICAgICAgIGlmICghaXNOYU4obnVtYmVyKSAmJiBudW1iZXIgPiBtYXgpIHtcbiAgICAgICAgICBtYXggPSBudW1iZXI7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAobWF4ICE9IC0xICYmIG1heCA+IHRoaXMud2lkdGgpIHtcbiAgICAgICAgdGhpcy53aWR0aCA9IG1heDtcbiAgICAgIH1cbiAgICAgIGlmIChtYXggIT0gLTEgJiYgbWF4ID4gdGhpcy5oZWlnaHQpIHtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBtYXg7XG4gICAgICB9XG4gICAgICB0aGlzLmdlbmVyYXRlKCk7XG4gICAgfVxuXG4gICAgcG9seWdvbiAodXNlckNvbmZpZykge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBsZXQgY29uZmlnID0ge1xuICAgICAgICBcInBvaW50c1wiOiBcIjIwLDIwIDMwLDIwIDMwLDMwIDIwLDMwXCIsXG4gICAgICAgIFwic3Ryb2tlXCI6IFwiYmxhY2tcIixcbiAgICAgICAgXCJzdHJva2Utd2lkdGhcIjogMSxcbiAgICAgICAgXCJmaWxsXCI6IFwid2hpdGVcIixcbiAgICAgICAgXCJmaWxsLW9wYWNpdHlcIjogMSxcbiAgICAgICAgXCJzdHJva2Utb3BhY2l0eVwiOiAxLFxuICAgICAgICBcIm9wYWNpdHlcIjogMSxcbiAgICAgIH07XG5cbiAgICAgIHByaXZhdGVzLmNoaWxkcmVuLnB1c2goYDxwb2x5bGluZSAke3RoaXMubWFrZUNvbmZpZyhjb25maWcsIHVzZXJDb25maWcpfSAvPmApO1xuXG4gICAgICBsZXQgd2lkdGggPSAtMTtcbiAgICAgIGxldCBoZWlnaHQgPSAtMTtcbiAgICAgIC8vIHNwbGl0IHBvaW50cyBieSBjb21tYSBvciBzcGFjZVxuICAgICAgY29uZmlnLnBvaW50cy5zcGxpdCgvLHwgLykuZm9yRWFjaCgoZWxlbWVudCwgaW5kZXgpID0+IHtcbiAgICAgICAgbGV0IG51bWJlciA9IHBhcnNlSW50KGVsZW1lbnQpO1xuICAgICAgICBpZiAoaW5kZXggJSAyID09IDApIHsgLy8gZXZlblxuICAgICAgICAgIGlmIChudW1iZXIgPiB3aWR0aClcbiAgICAgICAgICAgIHdpZHRoID0gbnVtYmVyO1xuICAgICAgICB9IGVsc2UgeyAvLyBvZGRzXG4gICAgICAgICAgaWYgKG51bWJlciA+IGhlaWdodClcbiAgICAgICAgICAgIGhlaWdodCA9IG51bWJlcjtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmICh3aWR0aCA+IDAgJiYgd2lkdGggPiB0aGlzLndpZHRoKVxuICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICBpZiAoaGVpZ2h0ID4gMCAmJiBoZWlnaHQgPiB0aGlzLmhlaWdodClcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICB0aGlzLmdlbmVyYXRlKCk7XG4gICAgfVxuXG4gICAgZ2VuZXJhdGUgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBsZXQgc3ZnID0gYDw/eG1sIHZlcnNpb249XCIxLjBcIj8+XFxuPHN2ZyB3aWR0aD1cIiR7dGhpcy53aWR0aH1cIiBoZWlnaHQ9XCIke3RoaXMuaGVpZ2h0fVwiIGAgK1xuICAgICAgICBgc3R5bGU9XCJ3aWR0aDogJHt0aGlzLndpZHRofXB4OyBoZWlnaHQ6ICR7dGhpcy5oZWlnaHR9cHg7XCIgYCArXG4gICAgICAgIGB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgdmVyc2lvbj1cIjEuMVwiPlxcbmA7XG5cbiAgICAgIGZvciAobGV0IGNoaWxkIG9mIHByaXZhdGVzLmNoaWxkcmVuKSB7XG4gICAgICAgIHN2ZyArPSBgICAke2NoaWxkfVxcbmA7XG4gICAgICB9XG5cbiAgICAgIHN2ZyArPSBcIjwvc3ZnPlwiO1xuXG4gICAgICBsZXQgYmxvYiA9IG5ldyBCbG9iKFtzdmddLCB7dHlwZTogXCJpbWFnZS9zdmcreG1sO2NoYXJzZXQ9dXRmLThcIn0pO1xuICAgICAgbGV0IHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgbGV0IGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICBpbWFnZS5zcmMgPSB1cmw7XG5cbiAgICAgIGxldCBEb25lID0gKCkgPT4ge1xuICAgICAgICBwcml2YXRlcy5pbWFnZSA9IGltYWdlO1xuICAgICAgICB3aW5kb3cuVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xuICAgICAgICB0aGlzLmVtaXQoXCJjaGFuZ2VcIik7XG4gICAgICB9O1xuXG4gICAgICBpZiAoaW1hZ2UuY29tcGxldGUpIHtcbiAgICAgICAgRG9uZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW1hZ2Uub25sb2FkID0gRG9uZTtcbiAgICAgIH1cblxuICAgIH1cblxuICAgIGRyYXcgKHJlbmRlcmVyKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGxldCBpbWFnZSA9IHByaXZhdGVzLmltYWdlO1xuICAgICAgaWYgKGltYWdlIGluc3RhbmNlb2YgSW1hZ2UgJiYgaW1hZ2Uud2lkdGggPiAwICYmIGltYWdlLmhlaWdodCA+IDApIHtcbiAgICAgICAgdGhpcy5kcmF3SW1hZ2UocmVuZGVyZXIsIGltYWdlLFxuICAgICAgICAgIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsXG4gICAgICAgICAgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

2D Game Sprite Library, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

/**
 * @fileoverview Define Sprite.Bitmap
 * @author mail@qhduan.com (QH Duan)
 */

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  Sprite.assign("Bitmap", (function (_Sprite$Display) {
    _inherits(SpriteBitmap, _Sprite$Display);

    /**
     * Sprite.Bitmap's constructor
     * @constructor
     */

    function SpriteBitmap(image) {
      _classCallCheck(this, SpriteBitmap);

      _get(Object.getPrototypeOf(SpriteBitmap.prototype), "constructor", this).call(this);

      if (!(image instanceof Image) && !(image.getContext && image.getContext("2d"))) {
        console.error(image, this);
        throw new Error("Sprite.Bitmap got invalid image, not Image or Canvas");
      }

      if (image.width <= 0 || !Number.isFinite(image.width) || image.height <= 0 || !Number.isFinite(image.height)) {
        console.error(image);
        throw new Error("Sprite.Bitmap got invalid image, invalid width or height");
      }

      internal(this).image = image;
    }

    _createClass(SpriteBitmap, [{
      key: "clone",
      value: function clone() {
        var bitmap = new Sprite.Bitmap(internal(this).image);
        bitmap.x = this.x;
        bitmap.y = this.y;
        bitmap.centerX = this.centerX;
        bitmap.centerY = this.centerY;
        bitmap.alpha = this.alpha;
        bitmap.visible = this.visible;
        return bitmap;
      }

      /**
       * @return {Image} Return Sprite.Bitmap's image
       */
    }, {
      key: "draw",

      /**
       * @param {Object} renderer Draw image on the renderer
       */
      value: function draw(renderer) {
        if (this.alpha <= 0.01 || this.visible != true) {
          return;
        }
        var image = internal(this).image;
        this.drawImage(renderer, image, 0, 0, image.width, image.height);
      }
    }, {
      key: "image",
      get: function get() {
        return internal(this).image;
      },
      set: function set(value) {
        console.error(this);
        throw new Error("Sprite.Bitmap.image readonly");
      }

      /**
       * @return {number} Return Sprite.Bitmap's width
       */
    }, {
      key: "width",
      get: function get() {
        return internal(this).image.width;
      },
      set: function set(value) {
        console.error(this);
        throw new Error("Sprite.Bitmap.width readonly");
      }

      /**
       * @return {number} Return Sprite.Bitmap's height
       */
    }, {
      key: "height",
      get: function get() {
        return internal(this).image.height;
      },
      set: function set(value) {
        console.error(this);
        throw new Error("Sprite.Bitmap.height readonly");
      }
    }]);

    return SpriteBitmap;
  })(Sprite.Display));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9TcHJpdGUvU3ByaXRlQml0bWFwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBLENBQUMsWUFBWTtBQUNaLGNBQVksQ0FBQzs7QUFFWixNQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7O0FBRWxDLFFBQU0sQ0FBQyxNQUFNLENBQUMsUUFBUTtjQUFRLFlBQVk7Ozs7Ozs7QUFLNUIsYUFMZ0IsWUFBWSxDQUszQixLQUFLLEVBQUU7NEJBTFEsWUFBWTs7QUFNdEMsaUNBTjBCLFlBQVksNkNBTTlCOztBQUVSLFVBQUksRUFBRSxLQUFLLFlBQVksS0FBSyxDQUFBLEFBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxVQUFVLElBQUksS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQSxBQUFDLEVBQUU7QUFDOUUsZUFBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDM0IsY0FBTSxJQUFJLEtBQUssQ0FBQyxzREFBc0QsQ0FBQyxDQUFDO09BQ3pFOztBQUVELFVBQUksS0FBSyxDQUFDLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFO0FBQzVHLGVBQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDckIsY0FBTSxJQUFJLEtBQUssQ0FBQywwREFBMEQsQ0FBQyxDQUFDO09BQzdFOztBQUVELGNBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0tBQzlCOztpQkFuQjJCLFlBQVk7O2FBcUJsQyxpQkFBRztBQUNQLFlBQUksTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDckQsY0FBTSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ2xCLGNBQU0sQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNsQixjQUFNLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7QUFDOUIsY0FBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO0FBQzlCLGNBQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztBQUMxQixjQUFNLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7QUFDOUIsZUFBTyxNQUFNLENBQUM7T0FDZjs7Ozs7Ozs7Ozs7YUF5Q0ksY0FBQyxRQUFRLEVBQUU7QUFDZCxZQUFJLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxFQUFFO0FBQzlDLGlCQUFPO1NBQ1I7QUFDRCxZQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDO0FBQ2pDLFlBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO09BQ2xFOzs7V0ExQ1MsZUFBRztBQUNYLGVBQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQztPQUM3QjtXQUVTLGFBQUMsS0FBSyxFQUFFO0FBQ2hCLGVBQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDcEIsY0FBTSxJQUFJLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO09BQ2pEOzs7Ozs7O1dBS1MsZUFBRztBQUNYLGVBQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7T0FDbkM7V0FFUyxhQUFDLEtBQUssRUFBRTtBQUNoQixlQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3BCLGNBQU0sSUFBSSxLQUFLLENBQUMsOEJBQThCLENBQUMsQ0FBQztPQUNqRDs7Ozs7OztXQUtVLGVBQUc7QUFDWixlQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO09BQ3BDO1dBRVUsYUFBQyxLQUFLLEVBQUU7QUFDakIsZUFBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNwQixjQUFNLElBQUksS0FBSyxDQUFDLCtCQUErQixDQUFDLENBQUM7T0FDbEQ7OztXQWxFMkIsWUFBWTtLQUFTLE1BQU0sQ0FBQyxPQUFPLEVBK0UvRCxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiU3ByaXRlQml0bWFwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuMkQgR2FtZSBTcHJpdGUgTGlicmFyeSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IERlZmluZSBTcHJpdGUuQml0bWFwXG4gKiBAYXV0aG9yIG1haWxAcWhkdWFuLmNvbSAoUUggRHVhbilcbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCBpbnRlcm5hbCA9IFNwcml0ZS5OYW1lc3BhY2UoKTtcblxuICBTcHJpdGUuYXNzaWduKFwiQml0bWFwXCIsIGNsYXNzIFNwcml0ZUJpdG1hcCBleHRlbmRzIFNwcml0ZS5EaXNwbGF5IHtcbiAgICAvKipcbiAgICAgKiBTcHJpdGUuQml0bWFwJ3MgY29uc3RydWN0b3JcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvciAoaW1hZ2UpIHtcbiAgICAgIHN1cGVyKCk7XG5cbiAgICAgIGlmICghKGltYWdlIGluc3RhbmNlb2YgSW1hZ2UpICYmICEoaW1hZ2UuZ2V0Q29udGV4dCAmJiBpbWFnZS5nZXRDb250ZXh0KFwiMmRcIikpKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoaW1hZ2UsIHRoaXMpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuQml0bWFwIGdvdCBpbnZhbGlkIGltYWdlLCBub3QgSW1hZ2Ugb3IgQ2FudmFzXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaW1hZ2Uud2lkdGggPD0gMCB8fCAhTnVtYmVyLmlzRmluaXRlKGltYWdlLndpZHRoKSB8fCBpbWFnZS5oZWlnaHQgPD0gMCB8fCAhTnVtYmVyLmlzRmluaXRlKGltYWdlLmhlaWdodCkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihpbWFnZSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5CaXRtYXAgZ290IGludmFsaWQgaW1hZ2UsIGludmFsaWQgd2lkdGggb3IgaGVpZ2h0XCIpO1xuICAgICAgfVxuXG4gICAgICBpbnRlcm5hbCh0aGlzKS5pbWFnZSA9IGltYWdlO1xuICAgIH1cblxuICAgIGNsb25lICgpIHtcbiAgICAgIGxldCBiaXRtYXAgPSBuZXcgU3ByaXRlLkJpdG1hcChpbnRlcm5hbCh0aGlzKS5pbWFnZSk7XG4gICAgICBiaXRtYXAueCA9IHRoaXMueDtcbiAgICAgIGJpdG1hcC55ID0gdGhpcy55O1xuICAgICAgYml0bWFwLmNlbnRlclggPSB0aGlzLmNlbnRlclg7XG4gICAgICBiaXRtYXAuY2VudGVyWSA9IHRoaXMuY2VudGVyWTtcbiAgICAgIGJpdG1hcC5hbHBoYSA9IHRoaXMuYWxwaGE7XG4gICAgICBiaXRtYXAudmlzaWJsZSA9IHRoaXMudmlzaWJsZTtcbiAgICAgIHJldHVybiBiaXRtYXA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybiB7SW1hZ2V9IFJldHVybiBTcHJpdGUuQml0bWFwJ3MgaW1hZ2VcbiAgICAgKi9cbiAgICBnZXQgaW1hZ2UgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmltYWdlO1xuICAgIH1cblxuICAgIHNldCBpbWFnZSAodmFsdWUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IodGhpcyk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcHJpdGUuQml0bWFwLmltYWdlIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEByZXR1cm4ge251bWJlcn0gUmV0dXJuIFNwcml0ZS5CaXRtYXAncyB3aWR0aFxuICAgICAqL1xuICAgIGdldCB3aWR0aCAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuaW1hZ2Uud2lkdGg7XG4gICAgfVxuXG4gICAgc2V0IHdpZHRoICh2YWx1ZSkge1xuICAgICAgY29uc29sZS5lcnJvcih0aGlzKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5CaXRtYXAud2lkdGggcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHJldHVybiB7bnVtYmVyfSBSZXR1cm4gU3ByaXRlLkJpdG1hcCdzIGhlaWdodFxuICAgICAqL1xuICAgIGdldCBoZWlnaHQgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmltYWdlLmhlaWdodDtcbiAgICB9XG5cbiAgICBzZXQgaGVpZ2h0ICh2YWx1ZSkge1xuICAgICAgY29uc29sZS5lcnJvcih0aGlzKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwcml0ZS5CaXRtYXAuaGVpZ2h0IHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZW5kZXJlciBEcmF3IGltYWdlIG9uIHRoZSByZW5kZXJlclxuICAgICAqL1xuICAgIGRyYXcgKHJlbmRlcmVyKSB7XG4gICAgICBpZiAodGhpcy5hbHBoYSA8PSAwLjAxIHx8IHRoaXMudmlzaWJsZSAhPSB0cnVlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGxldCBpbWFnZSA9IGludGVybmFsKHRoaXMpLmltYWdlO1xuICAgICAgdGhpcy5kcmF3SW1hZ2UocmVuZGVyZXIsIGltYWdlLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcbiAgICB9XG5cbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  // root级别api入口

  var GameCore = (function () {
    function GameCore() {
      _classCallCheck(this, GameCore);

      var privates = internal(this);
      privates.items = {};
      privates.skills = {};
      privates.sounds = {};
      privates.layers = {};
      privates.windows = {};
      privates.config = { // 保存所有设置（默认设置）
        width: 800, // 渲染窗口的原始大小
        height: 450,
        scale: true, // 如果不拉伸，那么无论浏览器窗口多大，都是原始大小；拉伸则按比例填满窗口
        fps: 35 };
      // 锁定fps到指定数值，如果设置为<=0，则不限制
      privates.paused = true;
      privates.stage = null;
    }

    _createClass(GameCore, [{
      key: "addBag",
      value: function addBag(x, y) {
        return new Promise(function (resolve, reject) {
          // 寻找已经存在的bag
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = Game.area.bags[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var bag = _step.value;

              if (bag.hitTest(x, y)) {
                return resolve(bag);
              }
            }
            // 如果没有已经存在的bag合适，新建一个
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator["return"]) {
                _iterator["return"]();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }

          Game.Item.load("bag").then(function (bag) {
            bag.x = x;
            bag.y = y;
            bag.inner = {};
            bag.draw();
            Game.area.bags.add(bag);
            resolve(bag);
          });
        });
      }
    }, {
      key: "assign",
      value: function assign(name, object) {
        Object.defineProperty(this, name, {
          enumerable: false,
          configurable: false,
          writable: false,
          value: object
        });
        return this;
      }

      /** 设置游戏暂停标志为false，启动游戏主循环，接受输入 */
    }, {
      key: "start",
      value: function start() {
        internal(this).paused = false;
      }

      /** 暂停游戏 */
    }, {
      key: "pause",
      value: function pause() {
        internal(this).paused = true;
      }
    }, {
      key: "clearStage",

      /** 清理舞台，即删除舞台上所有元素 */
      value: function clearStage() {
        if (Game.area) {
          var _iteratorNormalCompletion2 = true;
          var _didIteratorError2 = false;
          var _iteratorError2 = undefined;

          try {
            for (var _iterator2 = Game.area.actors[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              var actor = _step2.value;

              actor.erase();
            }
          } catch (err) {
            _didIteratorError2 = true;
            _iteratorError2 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
                _iterator2["return"]();
              }
            } finally {
              if (_didIteratorError2) {
                throw _iteratorError2;
              }
            }
          }

          var _iteratorNormalCompletion3 = true;
          var _didIteratorError3 = false;
          var _iteratorError3 = undefined;

          try {
            for (var _iterator3 = Game.area.bags[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
              var bag = _step3.value;

              bag.erase();
            }
          } catch (err) {
            _didIteratorError3 = true;
            _iteratorError3 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion3 && _iterator3["return"]) {
                _iterator3["return"]();
              }
            } finally {
              if (_didIteratorError3) {
                throw _iteratorError3;
              }
            }
          }
        }
        this.layers.mapLayer.clear();
        this.layers.mapHideLayer.clear();
        var _iteratorNormalCompletion4 = true;
        var _didIteratorError4 = false;
        var _iteratorError4 = undefined;

        try {
          for (var _iterator4 = this.stage.children[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
            var layer = _step4.value;

            layer.clear();
          }
        } catch (err) {
          _didIteratorError4 = true;
          _iteratorError4 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion4 && _iterator4["return"]) {
              _iterator4["return"]();
            }
          } finally {
            if (_didIteratorError4) {
              throw _iteratorError4;
            }
          }
        }

        this.stage.releaseRenderer();
      }

      /** 游戏初始化 */
    }, {
      key: "init",
      value: function init() {
        var privates = internal(this);
        // 舞台
        privates.stage = new Sprite.Stage(privates.config.width, privates.config.height);
        // 建立一个可以自动伸缩的窗口，并将舞台加入其中
        privates.windows.stage = Game.Window.create("stage").appendChild(privates.stage.canvas).show();

        // 地图层
        privates.layers.mapLayer = new Sprite.Container();
        privates.layers.mapLayer.name = "mapLayer";
        // 地图层 - 2
        privates.layers.mapHideLayer = new Sprite.Container();
        privates.layers.mapHideLayer.name = "mapHideLayer";
        // 物品层
        privates.layers.itemLayer = new Sprite.Container();
        privates.layers.itemLayer.name = "itemLayer";
        // 人物层，包括玩家
        privates.layers.actorLayer = new Sprite.Container();
        privates.layers.actorLayer.name = "actorLayer";
        // 信息层
        privates.layers.infoLayer = new Sprite.Container();
        privates.layers.infoLayer.name = "inforLayer";
        // 技能效果层
        privates.layers.skillLayer = new Sprite.Container();
        privates.layers.skillLayer.name = "skillLayer";
        // 对话层
        privates.layers.dialogueLayer = new Sprite.Container();
        privates.layers.dialogueLayer.name = "dialogueLayer";

        privates.stage.appendChild(privates.layers.mapLayer, privates.layers.mapHideLayer, privates.layers.itemLayer, privates.layers.actorLayer, privates.layers.infoLayer, privates.layers.skillLayer, privates.layers.dialogueLayer);

        // 调整人物层顺序，也就是上方的人物会被下方的人物遮盖，例如
        /**
         * AA BB
         * AA BB
         * 这样人物A和B都不干涉，但是A的位置如果在B的上面，并且紧挨着就变成了
         * AA
         * BB
         * BB
         * 这样人物A的下半身就被人物B遮盖，这就是进行排序，否则如果变成
         * AA
         * AA
         * BB
         * 这样就是B的上半身被人物A遮盖，这就很奇怪
         */
        privates.stage.on("beforeDraw", function () {
          if (Game.hero) {
            Game.layers.actorLayer.children.sort(function (a, b) {
              if (a.y < b.y) return -1;
              if (a.y > b.y) return 1;
              return 0;
            });
          }
        });

        /*
        setInterval(() => {
          if (Game.paused == false) {
            Game.stage.update();
          }
        }, 0);
        */
        Sprite.Ticker.on("tick", function () {
          if (Game.paused == false) {
            Game.stage.update();
          }
        });

        /*
        let updateNext = false;
        Game.stage.on("change", function () {
          updateNext = true;
        });
        Sprite.Ticker.on("tick", function () {
         if (Game.paused == false && updateNext) {
           Game.stage.update();
           updateNext = false;
         }
        });
        */

        var fpsElement = document.createElement("div");
        fpsElement.style.position = "absolute";
        fpsElement.style.left = "0";
        fpsElement.style.top = "0";
        fpsElement.style.color = "white";
        fpsElement.style.zIndex = 999999;
        document.body.appendChild(fpsElement);

        var fps = 0;
        var start = new Date().getTime();
        privates.stage.on("afterDraw", function () {
          fps++;
        });
        setInterval(function () {
          var now = new Date().getTime();
          var f = fps / ((now - start) / 1000);
          fps = 0;
          start = now;
          fpsElement.textContent = f.toFixed(1);
        }, 1000);

        console.log("RPG Game 0.1.1 Flying!");
      }
    }, {
      key: "paused",
      get: function get() {
        return internal(this).paused;
      },
      set: function set(value) {
        throw new Error("Game.paused readonly, use Game.pause() instead");
      }
    }, {
      key: "windows",
      get: function get() {
        return internal(this).windows;
      },
      set: function set(value) {
        throw new Error("Game.windows readonly");
      }
    }, {
      key: "config",
      get: function get() {
        return internal(this).config;
      },
      set: function set(value) {
        throw new Error("Game.config readonly");
      }
    }, {
      key: "items",
      get: function get() {
        return internal(this).items;
      },
      set: function set(value) {
        throw new Error("Game.items readonly");
      }
    }, {
      key: "skills",
      get: function get() {
        return internal(this).skills;
      },
      set: function set(value) {
        throw new Error("Game.skills readonly");
      }
    }, {
      key: "sounds",
      get: function get() {
        return internal(this).sounds;
      },
      set: function set(value) {
        throw new Error("Game.sounds readonly");
      }
    }, {
      key: "layers",
      get: function get() {
        return internal(this).layers;
      },
      set: function set(value) {
        throw new Error("Game.layers readonly");
      }
    }, {
      key: "stage",
      get: function get() {
        return internal(this).stage;
      },
      set: function set(value) {
        throw new Error("Game.stage readonly");
      }
    }]);

    return GameCore;
  })();

  ;

  var Game = window.Game = new GameCore();

  // under node-webkit
  if (window.require) {
    Game.config.scale = true;
  }

  function GameBootstrap() {
    if (document.readyState == "complete") {
      Game.init();
      Game.Input.init();
      Game.windows.main.show();
      return true;
    }
    return false;
  }

  if (GameBootstrap() == false) {
    document.addEventListener("readystatechange", function () {
      GameBootstrap();
    });
  }
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7OztNQUc1QixRQUFRO0FBRUEsYUFGUixRQUFRLEdBRUc7NEJBRlgsUUFBUTs7QUFHVixVQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDOUIsY0FBUSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7QUFDcEIsY0FBUSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7QUFDckIsY0FBUSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7QUFDckIsY0FBUSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7QUFDckIsY0FBUSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7QUFDdEIsY0FBUSxDQUFDLE1BQU0sR0FBRztBQUNoQixhQUFLLEVBQUUsR0FBRztBQUNWLGNBQU0sRUFBRSxHQUFHO0FBQ1gsYUFBSyxFQUFFLElBQUk7QUFDWCxXQUFHLEVBQUUsRUFBRSxFQUNSLENBQUM7O0FBQ0YsY0FBUSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7QUFDdkIsY0FBUSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7S0FDdkI7O2lCQWpCRyxRQUFROzthQW1CTCxnQkFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFO0FBQ1osZUFBTyxJQUFJLE9BQU8sQ0FBQyxVQUFVLE9BQU8sRUFBRSxNQUFNLEVBQUU7Ozs7Ozs7QUFFNUMsaUNBQWdCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSw4SEFBRTtrQkFBdkIsR0FBRzs7QUFDVixrQkFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtBQUNyQix1QkFBTyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7ZUFD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QUFVLEVBQUU7QUFDckMsVUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ1osVUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNsQixVQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUN6QixhQUFPLElBQUksQ0FBQztLQUNiO0FBQ0QsV0FBTyxLQUFLLENBQUM7R0FDZDs7QUFFRCxNQUFJLGFBQWEsRUFBRSxJQUFJLEtBQUssRUFBRTtBQUM1QixZQUFRLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsWUFBWTtBQUN4RCxtQkFBYSxFQUFFLENBQUM7S0FDakIsQ0FBQyxDQUFDO0dBQ0o7Q0FFRixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gICAgLy8gcm9vdOe6p+WIq2FwaeWFpeWPo1xuICBjbGFzcyBHYW1lQ29yZSB7XG5cbiAgICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHByaXZhdGVzLml0ZW1zID0ge307XG4gICAgICBwcml2YXRlcy5za2lsbHMgPSB7fTtcbiAgICAgIHByaXZhdGVzLnNvdW5kcyA9IHt9O1xuICAgICAgcHJpdmF0ZXMubGF5ZXJzID0ge307XG4gICAgICBwcml2YXRlcy53aW5kb3dzID0ge307XG4gICAgICBwcml2YXRlcy5jb25maWcgPSB7IC8vIOS/neWtmOaJgOacieiuvue9ru+8iOm7mOiupOiuvue9ru+8iVxuICAgICAgICB3aWR0aDogODAwLCAvLyDmuLLmn5Pnqpflj6PnmoTljp/lp4vlpKflsI9cbiAgICAgICAgaGVpZ2h0OiA0NTAsXG4gICAgICAgIHNjYWxlOiB0cnVlLCAvLyDlpoLmnpzkuI3mi4nkvLjvvIzpgqPkuYjml6DorrrmtY/op4jlmajnqpflj6PlpJrlpKfvvIzpg73mmK/ljp/lp4vlpKflsI/vvJvmi4nkvLjliJnmjInmr5Tkvovloavmu6Hnqpflj6NcbiAgICAgICAgZnBzOiAzNSwgLy8g6ZSB5a6aZnBz5Yiw5oyH5a6a5pWw5YC877yM5aaC5p6c6K6+572u5Li6PD0w77yM5YiZ5LiN6ZmQ5Yi2XG4gICAgICB9O1xuICAgICAgcHJpdmF0ZXMucGF1c2VkID0gdHJ1ZTtcbiAgICAgIHByaXZhdGVzLnN0YWdlID0gbnVsbDtcbiAgICB9XG5cbiAgICBhZGRCYWcgKHgsIHkpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIC8vIOWvu+aJvuW3sue7j+WtmOWcqOeahGJhZ1xuICAgICAgICBmb3IgKGxldCBiYWcgb2YgR2FtZS5hcmVhLmJhZ3MpIHtcbiAgICAgICAgICBpZiAoYmFnLmhpdFRlc3QoeCwgeSkpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKGJhZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIOWmguaenOayoeacieW3sue7j+WtmOWcqOeahGJhZ+WQiOmAgu+8jOaWsOW7uuS4gOS4qlxuICAgICAgICBHYW1lLkl0ZW0ubG9hZChcImJhZ1wiKS50aGVuKChiYWcpID0+IHtcbiAgICAgICAgICBiYWcueCA9IHg7XG4gICAgICAgICAgYmFnLnkgPSB5O1xuICAgICAgICAgIGJhZy5pbm5lciA9IHt9O1xuICAgICAgICAgIGJhZy5kcmF3KCk7XG4gICAgICAgICAgR2FtZS5hcmVhLmJhZ3MuYWRkKGJhZyk7XG4gICAgICAgICAgcmVzb2x2ZShiYWcpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGFzc2lnbiAobmFtZSwgb2JqZWN0KSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgbmFtZSwge1xuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgICB2YWx1ZTogb2JqZWN0XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKiDorr7nva7muLjmiI/mmoLlgZzmoIflv5fkuLpmYWxzZe+8jOWQr+WKqOa4uOaIj+S4u+W+queOr++8jOaOpeWPl+i+k+WFpSAqL1xuICAgIHN0YXJ0ICgpIHtcbiAgICAgIGludGVybmFsKHRoaXMpLnBhdXNlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKiDmmoLlgZzmuLjmiI8gKi9cbiAgICBwYXVzZSAoKSB7XG4gICAgICBpbnRlcm5hbCh0aGlzKS5wYXVzZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIGdldCBwYXVzZWQgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLnBhdXNlZDtcbiAgICB9XG5cbiAgICBzZXQgcGF1c2VkICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5wYXVzZWQgcmVhZG9ubHksIHVzZSBHYW1lLnBhdXNlKCkgaW5zdGVhZFwiKTtcbiAgICB9XG5cbiAgICBnZXQgd2luZG93cyAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykud2luZG93cztcbiAgICB9XG5cbiAgICBzZXQgd2luZG93cyAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUud2luZG93cyByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgY29uZmlnICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5jb25maWc7XG4gICAgfVxuXG4gICAgc2V0IGNvbmZpZyAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuY29uZmlnIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGdldCBpdGVtcyAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuaXRlbXM7XG4gICAgfVxuXG4gICAgc2V0IGl0ZW1zICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5pdGVtcyByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgc2tpbGxzICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5za2lsbHM7XG4gICAgfVxuXG4gICAgc2V0IHNraWxscyAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuc2tpbGxzIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGdldCBzb3VuZHMgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLnNvdW5kcztcbiAgICB9XG5cbiAgICBzZXQgc291bmRzICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5zb3VuZHMgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgZ2V0IGxheWVycyAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykubGF5ZXJzO1xuICAgIH1cblxuICAgIHNldCBsYXllcnMgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLmxheWVycyByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgc3RhZ2UgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLnN0YWdlO1xuICAgIH1cblxuICAgIHNldCBzdGFnZSAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuc3RhZ2UgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgLyoqIOa4heeQhuiInuWPsO+8jOWNs+WIoOmZpOiInuWPsOS4iuaJgOacieWFg+e0oCAqL1xuICAgIGNsZWFyU3RhZ2UgKCkge1xuICAgICAgaWYgKEdhbWUuYXJlYSkge1xuICAgICAgICBmb3IgKGxldCBhY3RvciBvZiBHYW1lLmFyZWEuYWN0b3JzKSB7XG4gICAgICAgICAgYWN0b3IuZXJhc2UoKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBiYWcgb2YgR2FtZS5hcmVhLmJhZ3MpIHtcbiAgICAgICAgICBiYWcuZXJhc2UoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5sYXllcnMubWFwTGF5ZXIuY2xlYXIoKTtcbiAgICAgIHRoaXMubGF5ZXJzLm1hcEhpZGVMYXllci5jbGVhcigpO1xuICAgICAgZm9yIChsZXQgbGF5ZXIgb2YgdGhpcy5zdGFnZS5jaGlsZHJlbikge1xuICAgICAgICBsYXllci5jbGVhcigpO1xuICAgICAgfVxuICAgICAgdGhpcy5zdGFnZS5yZWxlYXNlUmVuZGVyZXIoKTtcbiAgICB9XG5cbiAgICAvKiog5ri45oiP5Yid5aeL5YyWICovXG4gICAgaW5pdCAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIC8vIOiInuWPsFxuICAgICAgcHJpdmF0ZXMuc3RhZ2UgPSBuZXcgU3ByaXRlLlN0YWdlKHByaXZhdGVzLmNvbmZpZy53aWR0aCwgcHJpdmF0ZXMuY29uZmlnLmhlaWdodCk7XG4gICAgICAvLyDlu7rnq4vkuIDkuKrlj6/ku6Xoh6rliqjkvLjnvKnnmoTnqpflj6PvvIzlubblsIboiJ7lj7DliqDlhaXlhbbkuK1cbiAgICAgIHByaXZhdGVzLndpbmRvd3Muc3RhZ2UgPSBHYW1lLldpbmRvdy5jcmVhdGUoXCJzdGFnZVwiKVxuICAgICAgICAuYXBwZW5kQ2hpbGQocHJpdmF0ZXMuc3RhZ2UuY2FudmFzKVxuICAgICAgICAuc2hvdygpO1xuXG4gICAgICAvLyDlnLDlm77lsYJcbiAgICAgIHByaXZhdGVzLmxheWVycy5tYXBMYXllciA9IG5ldyBTcHJpdGUuQ29udGFpbmVyKCk7XG4gICAgICBwcml2YXRlcy5sYXllcnMubWFwTGF5ZXIubmFtZSA9IFwibWFwTGF5ZXJcIjtcbiAgICAgIC8vIOWcsOWbvuWxgiAtIDJcbiAgICAgIHByaXZhdGVzLmxheWVycy5tYXBIaWRlTGF5ZXIgPSBuZXcgU3ByaXRlLkNvbnRhaW5lcigpO1xuICAgICAgcHJpdmF0ZXMubGF5ZXJzLm1hcEhpZGVMYXllci5uYW1lID0gXCJtYXBIaWRlTGF5ZXJcIjtcbiAgICAgIC8vIOeJqeWTgeWxglxuICAgICAgcHJpdmF0ZXMubGF5ZXJzLml0ZW1MYXllciA9IG5ldyBTcHJpdGUuQ29udGFpbmVyKCk7XG4gICAgICBwcml2YXRlcy5sYXllcnMuaXRlbUxheWVyLm5hbWUgPSBcIml0ZW1MYXllclwiO1xuICAgICAgLy8g5Lq654mp5bGC77yM5YyF5ous546p5a62XG4gICAgICBwcml2YXRlcy5sYXllcnMuYWN0b3JMYXllciA9IG5ldyBTcHJpdGUuQ29udGFpbmVyKCk7XG4gICAgICBwcml2YXRlcy5sYXllcnMuYWN0b3JMYXllci5uYW1lID0gXCJhY3RvckxheWVyXCI7XG4gICAgICAvLyDkv6Hmga/lsYJcbiAgICAgIHByaXZhdGVzLmxheWVycy5pbmZvTGF5ZXIgPSBuZXcgU3ByaXRlLkNvbnRhaW5lcigpO1xuICAgICAgcHJpdmF0ZXMubGF5ZXJzLmluZm9MYXllci5uYW1lID0gXCJpbmZvckxheWVyXCI7XG4gICAgICAvLyDmioDog73mlYjmnpzlsYJcbiAgICAgIHByaXZhdGVzLmxheWVycy5za2lsbExheWVyID0gbmV3IFNwcml0ZS5Db250YWluZXIoKTtcbiAgICAgIHByaXZhdGVzLmxheWVycy5za2lsbExheWVyLm5hbWUgPSBcInNraWxsTGF5ZXJcIjtcbiAgICAgIC8vIOWvueivneWxglxuICAgICAgcHJpdmF0ZXMubGF5ZXJzLmRpYWxvZ3VlTGF5ZXIgPSBuZXcgU3ByaXRlLkNvbnRhaW5lcigpO1xuICAgICAgcHJpdmF0ZXMubGF5ZXJzLmRpYWxvZ3VlTGF5ZXIubmFtZSA9IFwiZGlhbG9ndWVMYXllclwiO1xuXG4gICAgICBwcml2YXRlcy5zdGFnZS5hcHBlbmRDaGlsZChcbiAgICAgICAgcHJpdmF0ZXMubGF5ZXJzLm1hcExheWVyLFxuICAgICAgICBwcml2YXRlcy5sYXllcnMubWFwSGlkZUxheWVyLFxuICAgICAgICBwcml2YXRlcy5sYXllcnMuaXRlbUxheWVyLFxuICAgICAgICBwcml2YXRlcy5sYXllcnMuYWN0b3JMYXllcixcbiAgICAgICAgcHJpdmF0ZXMubGF5ZXJzLmluZm9MYXllcixcbiAgICAgICAgcHJpdmF0ZXMubGF5ZXJzLnNraWxsTGF5ZXIsXG4gICAgICAgIHByaXZhdGVzLmxheWVycy5kaWFsb2d1ZUxheWVyXG4gICAgICApO1xuXG4gICAgICAvLyDosIPmlbTkurrnianlsYLpobrluo/vvIzkuZ/lsLHmmK/kuIrmlrnnmoTkurrniankvJrooqvkuIvmlrnnmoTkurrnianpga7nm5bvvIzkvovlpoJcbiAgICAgIC8qKlxuICAgICAgICogQUEgQkJcbiAgICAgICAqIEFBIEJCXG4gICAgICAgKiDov5nmoLfkurrnialB5ZKMQumDveS4jeW5sua2ie+8jOS9huaYr0HnmoTkvY3nva7lpoLmnpzlnKhC55qE5LiK6Z2i77yM5bm25LiU57Sn5oyo552A5bCx5Y+Y5oiQ5LqGXG4gICAgICAgKiBBQVxuICAgICAgICogQkJcbiAgICAgICAqIEJCXG4gICAgICAgKiDov5nmoLfkurrnialB55qE5LiL5Y2K6Lqr5bCx6KKr5Lq654mpQumBrueblu+8jOi/meWwseaYr+i/m+ihjOaOkuW6j++8jOWQpuWImeWmguaenOWPmOaIkFxuICAgICAgICogQUFcbiAgICAgICAqIEFBXG4gICAgICAgKiBCQlxuICAgICAgICog6L+Z5qC35bCx5pivQueahOS4iuWNiui6q+iiq+S6uueJqUHpga7nm5bvvIzov5nlsLHlvojlpYfmgKpcbiAgICAgICAqL1xuICAgICAgcHJpdmF0ZXMuc3RhZ2Uub24oXCJiZWZvcmVEcmF3XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKEdhbWUuaGVybykge1xuICAgICAgICAgIEdhbWUubGF5ZXJzLmFjdG9yTGF5ZXIuY2hpbGRyZW4uc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgaWYgKGEueSA8IGIueSkgcmV0dXJuIC0xO1xuICAgICAgICAgICAgaWYgKGEueSA+IGIueSkgcmV0dXJuIDE7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8qXG4gICAgICBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIGlmIChHYW1lLnBhdXNlZCA9PSBmYWxzZSkge1xuICAgICAgICAgIEdhbWUuc3RhZ2UudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0sIDApO1xuICAgICAgKi9cbiAgICAgIFNwcml0ZS5UaWNrZXIub24oXCJ0aWNrXCIsICgpID0+IHtcbiAgICAgICAgaWYgKEdhbWUucGF1c2VkID09IGZhbHNlKSB7XG4gICAgICAgICAgR2FtZS5zdGFnZS51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8qXG4gICAgICBsZXQgdXBkYXRlTmV4dCA9IGZhbHNlO1xuICAgICAgR2FtZS5zdGFnZS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHVwZGF0ZU5leHQgPSB0cnVlO1xuICAgICAgfSk7XG4gICAgICBTcHJpdGUuVGlja2VyLm9uKFwidGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgaWYgKEdhbWUucGF1c2VkID09IGZhbHNlICYmIHVwZGF0ZU5leHQpIHtcbiAgICAgICAgIEdhbWUuc3RhZ2UudXBkYXRlKCk7XG4gICAgICAgICB1cGRhdGVOZXh0ID0gZmFsc2U7XG4gICAgICAgfVxuICAgICAgfSk7XG4gICAgICAqL1xuXG4gICAgICBsZXQgZnBzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBmcHNFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgZnBzRWxlbWVudC5zdHlsZS5sZWZ0ID0gXCIwXCI7XG4gICAgICBmcHNFbGVtZW50LnN0eWxlLnRvcCA9IFwiMFwiO1xuICAgICAgZnBzRWxlbWVudC5zdHlsZS5jb2xvciA9IFwid2hpdGVcIjtcbiAgICAgIGZwc0VsZW1lbnQuc3R5bGUuekluZGV4ID0gOTk5OTk5O1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmcHNFbGVtZW50KTtcblxuICAgICAgbGV0IGZwcyA9IDA7XG4gICAgICBsZXQgc3RhcnQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgIHByaXZhdGVzLnN0YWdlLm9uKFwiYWZ0ZXJEcmF3XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnBzKys7XG4gICAgICB9KTtcbiAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICBsZXQgZiA9IGZwcyAvICgobm93IC0gc3RhcnQpLzEwMDApO1xuICAgICAgICBmcHMgPSAwO1xuICAgICAgICBzdGFydCA9IG5vdztcbiAgICAgICAgZnBzRWxlbWVudC50ZXh0Q29udGVudCA9IGYudG9GaXhlZCgxKTtcbiAgICAgIH0sIDEwMDApO1xuXG4gICAgICBjb25zb2xlLmxvZyhcIlJQRyBHYW1lIDAuMS4xIEZseWluZyFcIik7XG4gICAgfVxuICB9O1xuXG4gIGxldCBHYW1lID0gd2luZG93LkdhbWUgPSBuZXcgR2FtZUNvcmUoKTtcblxuICAvLyB1bmRlciBub2RlLXdlYmtpdFxuICBpZiAod2luZG93LnJlcXVpcmUpIHtcbiAgICBHYW1lLmNvbmZpZy5zY2FsZSA9IHRydWU7XG4gIH1cblxuICBmdW5jdGlvbiBHYW1lQm9vdHN0cmFwICgpIHtcbiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PSBcImNvbXBsZXRlXCIpIHtcbiAgICAgIEdhbWUuaW5pdCgpO1xuICAgICAgR2FtZS5JbnB1dC5pbml0KCk7XG4gICAgICBHYW1lLndpbmRvd3MubWFpbi5zaG93KCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKEdhbWVCb290c3RyYXAoKSA9PSBmYWxzZSkge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJyZWFkeXN0YXRlY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIEdhbWVCb290c3RyYXAoKTtcbiAgICB9KTtcbiAgfVxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();
  /** 全部窗口 */
  var windows = new Set();
  /**窗口z-index，不断递增 */
  var zIndex = 227;

  Game.assign("Window", (function (_Sprite$Event) {
    _inherits(GameWindow, _Sprite$Event);

    _createClass(GameWindow, null, [{
      key: "create",
      value: function create(id) {
        var win = new Game.Window(id);
        return win;
      }

      /**
       * @constructor
       */
    }]);

    function GameWindow(id) {
      var _this = this;

      _classCallCheck(this, GameWindow);

      _get(Object.getPrototypeOf(GameWindow.prototype), "constructor", this).call(this);

      var privates = internal(this);
      privates.id = id;
      privates.css = document.createElement("style");
      privates.html = document.createElement("div");
      privates.index = -1;

      // 随机一个字符串作为dom的id
      privates.html.id = "GW" + Math.random().toString(16).substr(2);
      privates.html.classList.add(id);
      privates.html.classList.add("game-window");
      privates.html.style.display = "none";
      document.body.appendChild(privates.html);
      document.head.appendChild(privates.css);

      privates.html.addEventListener("mousedown", function (event) {
        var x = event.clientX;
        var y = event.clientY;

        var left = null;
        var top = null;
        var scale = null;

        if (privates.html.style.left) {
          var t = privates.html.style.left.match(/(\d+)px/);
          if (t) {
            left = parseInt(t[1]);
          }
        }

        if (privates.html.style.top) {
          var t = privates.html.style.top.match(/(\d+)px/);
          if (t) {
            top = parseInt(t[1]);
          }
        }

        if (privates.html.style.transform) {
          var t = privates.html.style.transform.match(/scale\(([\d\.]+), ([\d\.]+)\)/);
          if (t) {
            scale = parseFloat(t[1]);
          } else {
            scale = 1.0;
          }
        } else {
          scale = 1.0;
        }

        if (Number.isFinite(left) && Number.isFinite(top) && Number.isFinite(scale)) {
          x -= left;
          y -= top;
          x /= scale;
          y /= scale;
          _this.emit("mousedown", false, {
            x: x,
            y: y
          });
        }
      });

      windows.add(this);
    }

    _createClass(GameWindow, [{
      key: "destroy",
      value: function destroy() {
        var privates = internal(this);
        if (this.showing) {
          this.hide();
        }
        if (privates.html) {
          document.body.removeChild(privates.html);
          privates.html = null;
        }
        if (privates.css) {
          document.head.removeChild(privates.css);
          privates.css = null;
        }
        if (windows.has(this)) {
          windows["delete"](this);
        }
      }
    }, {
      key: "whenPress",
      value: function whenPress(keys, callback) {
        var _this2 = this;

        Sprite.Input.whenPress(keys, function (key) {
          if (_this2.atop) {
            callback(key);
          }
        });
        return this;
      }
    }, {
      key: "whenUp",
      value: function whenUp(keys, callback) {
        var _this3 = this;

        Sprite.Input.whenUp(keys, function (key) {
          if (_this3.atop) {
            callback(key);
          }
        });
        return this;
      }
    }, {
      key: "whenDown",
      value: function whenDown(keys, callback) {
        var _this4 = this;

        Sprite.Input.whenDown(keys, function (key) {
          if (_this4.atop) {
            callback(key);
          }
        });
        return this;
      }
    }, {
      key: "assign",
      value: function assign(name, object) {
        Object.defineProperty(this, name, {
          enumerable: false,
          configurable: false,
          writable: false,
          value: object
        });

        return this;
      }
    }, {
      key: "show",
      value: function show() {
        var privates = internal(this);
        GameWindowResize();
        if (this.showing == false && privates.html) {
          this.emit("beforeShow");

          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = windows[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var win = _step.value;

              if (win.atop) {
                win.emit("deactive");
              }
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator["return"]) {
                _iterator["return"]();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }

          privates.index = zIndex;
          privates.html.style.zIndex = privates.index;
          privates.html.style.display = "block";
          zIndex++;
          this.emit("afterShow");
          this.emit("active");
        }
        return this;
      }
    }, {
      key: "hide",
      value: function hide() {
        var privates = internal(this);
        if (privates.html) {
          this.emit("beforeHide");

          privates.index = -1;
          this.emit("afterHide");
          this.emit("deactive");

          if (privates && privates.html) {
            privates.html.style.zIndex = privates.index;
            privates.html.style.display = "none";
          }

          var _iteratorNormalCompletion2 = true;
          var _didIteratorError2 = false;
          var _iteratorError2 = undefined;

          try {
            for (var _iterator2 = windows[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              var win = _step2.value;

              if (win.atop) {
                win.emit("active");
              }
            }
          } catch (err) {
            _didIteratorError2 = true;
            _iteratorError2 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
                _iterator2["return"]();
              }
            } finally {
              if (_didIteratorError2) {
                throw _iteratorError2;
              }
            }
          }
        }
        return this;
      }
    }, {
      key: "querySelector",
      value: function querySelector(selector) {
        var privates = internal(this);
        return document.querySelector("#" + privates.html.id + " " + selector);
      }
    }, {
      key: "querySelectorAll",
      value: function querySelectorAll(selector) {
        var privates = internal(this);
        return document.querySelectorAll("#" + privates.html.id + " " + selector);
      }
    }, {
      key: "appendChild",
      value: function appendChild(domElement) {
        internal(this).html.appendChild(domElement);
        return this;
      }
    }, {
      key: "removeChild",
      value: function removeChild(domElement) {
        internal(this).html.removeChild(domElement);
        return this;
      }
    }, {
      key: "index",
      get: function get() {
        var privates = internal(this);
        return privates.index;
      },
      set: function set(value) {
        console.error(this);
        throw new Error("Game.Window.index readonly");
      }
    }, {
      key: "showing",
      get: function get() {
        var privates = internal(this);
        if (privates.html && privates.html.style.display != "none") {
          return true;
        }
        return false;
      },
      set: function set(value) {
        throw new Error("Game.Window.showing readonly");
      }
    }, {
      key: "atop",
      get: function get() {
        var _iteratorNormalCompletion3 = true;
        var _didIteratorError3 = false;
        var _iteratorError3 = undefined;

        try {
          for (var _iterator3 = windows[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
            var win = _step3.value;

            if (win.showing && win.index > this.index) {
              return false;
            }
          }
        } catch (err) {
          _didIteratorError3 = true;
          _iteratorError3 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion3 && _iterator3["return"]) {
              _iterator3["return"]();
            }
          } finally {
            if (_didIteratorError3) {
              throw _iteratorError3;
            }
          }
        }

        return true;
      },
      set: function set(value) {
        throw new Error("Game.Window.atop readonly");
      }
    }, {
      key: "html",
      get: function get() {
        return internal(this).html.innerHTML;
      },
      set: function set(value) {
        internal(this).html.innerHTML = value;
      }
    }, {
      key: "css",
      get: function get() {
        return internal(this).css.innerHTML;
      },
      set: function set(value) {
        internal(this).css.innerHTML = value;
      }
    }]);

    return GameWindow;
  })(Sprite.Event));

  // 当窗口大小改变时改变游戏窗口大小
  function GameWindowResize() {
    var width = window.innerWidth;
    var height = window.innerHeight;
    var scale = 1;
    var leftMargin = 0;
    var topMargin = 0;
    var mobile = false;

    if (navigator.userAgent.match(/iPad|iPhone|iPod|Android|BlackBerry|webOS|IEMobile|Opera Mini/i)) {
      if (width < height) {
        var t = width;
        width = height;
        height = t;
        mobile = true;
      }
    }

    if (Game.config.scale == false) {
      // 不拉伸游戏窗口，按原始大小计算窗口居中
      leftMargin = Math.floor((width - Game.config.width) / 2);
      topMargin = Math.floor((height - Game.config.height) / 2);
    } else {
      // 拉伸游戏窗口，首先计算游戏原始大小比例
      var ratio = Game.config.width / Game.config.height;
      // width first
      var w = width;
      var h = w / ratio;
      // then height
      if (h > height) {
        h = height;
        w = h * ratio;
      }

      w = Math.floor(w);
      h = Math.floor(h);
      leftMargin = Math.floor((width - w) / 2);
      topMargin = Math.floor((height - h) / 2);

      scale = Math.min(w / Game.config.width, h / Game.config.height);

      // scale = scale.toFixed(3);
    }

    // html窗口拉伸（css中控制了原始大小）
    var _iteratorNormalCompletion4 = true;
    var _didIteratorError4 = false;
    var _iteratorError4 = undefined;

    try {
      for (var _iterator4 = windows[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
        var win = _step4.value;

        internal(win).html.style.left = leftMargin + "px";
        internal(win).html.style.top = topMargin + "px";
        internal(win).html.style.transformOrigin = "0 0 0";
        internal(win).html.style.transform = "scale(" + scale + ", " + scale + ") translateZ(0)";
        internal(win).html.style.webkitTransform = "scale(" + scale + ", " + scale + ") translateZ(0)";
        internal(win).html.style.filter = "none";
        internal(win).html.style.webkitFilter = "blur(0px)";
        internal(win).html.style.mozFilter = "blur(0px)";
        internal(win).html.style.msFilter = "blur(0px)";
      }
    } catch (err) {
      _didIteratorError4 = true;
      _iteratorError4 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion4 && _iterator4["return"]) {
          _iterator4["return"]();
        }
      } finally {
        if (_didIteratorError4) {
          throw _iteratorError4;
        }
      }
    }

    if (Game.hero) {
      Game.hero.focus();
    }
  }

  GameWindowResize();
  window.addEventListener("resize", function () {
    GameWindowResize();
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3cuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7QUFFYixNQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7O0FBRWxDLE1BQUksT0FBTyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7O0FBRXhCLE1BQUksTUFBTSxHQUFHLEdBQUcsQ0FBQzs7QUFFakIsTUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRO2NBQVEsVUFBVTs7aUJBQVYsVUFBVTs7YUFDdEIsZ0JBQUMsRUFBRSxFQUFFO0FBQ2pCLFlBQUksR0FBRyxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUM3QixlQUFPLEdBQUcsQ0FBQztPQUNaOzs7Ozs7O0FBS1csYUFUYyxVQUFVLENBU3ZCLEVBQUUsRUFBRTs7OzRCQVRTLFVBQVU7O0FBVWxDLGlDQVZ3QixVQUFVLDZDQVUxQjs7QUFFUixVQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDOUIsY0FBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7QUFDakIsY0FBUSxDQUFDLEdBQUcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQy9DLGNBQVEsQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUM5QyxjQUFRLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDOzs7QUFHcEIsY0FBUSxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQy9ELGNBQVEsQ0FBQyxJQUFJLENBQUMsU0FB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ZSI6IkdhbWVXaW5kb3cuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgaW50ZXJuYWwgPSBTcHJpdGUuTmFtZXNwYWNlKCk7XG4gIC8qKiDlhajpg6jnqpflj6MgKi9cbiAgbGV0IHdpbmRvd3MgPSBuZXcgU2V0KCk7XG4gIC8qKueql+WPo3otaW5kZXjvvIzkuI3mlq3pgJLlop4gKi9cbiAgbGV0IHpJbmRleCA9IDIyNztcblxuICBHYW1lLmFzc2lnbihcIldpbmRvd1wiLCBjbGFzcyBHYW1lV2luZG93IGV4dGVuZHMgU3ByaXRlLkV2ZW50IHtcbiAgICBzdGF0aWMgY3JlYXRlIChpZCkge1xuICAgICAgbGV0IHdpbiA9IG5ldyBHYW1lLldpbmRvdyhpZClcbiAgICAgIHJldHVybiB3aW47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKGlkKSB7XG4gICAgICBzdXBlcigpO1xuXG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHByaXZhdGVzLmlkID0gaWQ7XG4gICAgICBwcml2YXRlcy5jc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG4gICAgICBwcml2YXRlcy5odG1sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHByaXZhdGVzLmluZGV4ID0gLTE7XG5cbiAgICAgIC8vIOmaj+acuuS4gOS4quWtl+espuS4suS9nOS4umRvbeeahGlkXG4gICAgICBwcml2YXRlcy5odG1sLmlkID0gXCJHV1wiICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygxNikuc3Vic3RyKDIpO1xuICAgICAgcHJpdmF0ZXMuaHRtbC5jbGFzc0xpc3QuYWRkKGlkKTtcbiAgICAgIHByaXZhdGVzLmh0bWwuY2xhc3NMaXN0LmFkZChcImdhbWUtd2luZG93XCIpO1xuICAgICAgcHJpdmF0ZXMuaHRtbC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHByaXZhdGVzLmh0bWwpO1xuICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChwcml2YXRlcy5jc3MpXG5cbiAgICAgIHByaXZhdGVzLmh0bWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgbGV0IHggPSBldmVudC5jbGllbnRYO1xuICAgICAgICBsZXQgeSA9IGV2ZW50LmNsaWVudFk7XG5cbiAgICAgICAgbGV0IGxlZnQgPSBudWxsO1xuICAgICAgICBsZXQgdG9wID0gbnVsbDtcbiAgICAgICAgbGV0IHNjYWxlID0gbnVsbDtcblxuICAgICAgICBpZiAocHJpdmF0ZXMuaHRtbC5zdHlsZS5sZWZ0KSB7XG4gICAgICAgICAgbGV0IHQgPSBwcml2YXRlcy5odG1sLnN0eWxlLmxlZnQubWF0Y2goLyhcXGQrKXB4Lyk7XG4gICAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgIGxlZnQgPSBwYXJzZUludCh0WzFdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocHJpdmF0ZXMuaHRtbC5zdHlsZS50b3ApIHtcbiAgICAgICAgICBsZXQgdCA9IHByaXZhdGVzLmh0bWwuc3R5bGUudG9wLm1hdGNoKC8oXFxkKylweC8pO1xuICAgICAgICAgIGlmICh0KSB7XG4gICAgICAgICAgICB0b3AgPSBwYXJzZUludCh0WzFdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocHJpdmF0ZXMuaHRtbC5zdHlsZS50cmFuc2Zvcm0pIHtcbiAgICAgICAgICBsZXQgdCA9IHByaXZhdGVzLmh0bWwuc3R5bGUudHJhbnNmb3JtLm1hdGNoKC9zY2FsZVxcKChbXFxkXFwuXSspLCAoW1xcZFxcLl0rKVxcKS8pO1xuICAgICAgICAgIGlmICh0KSB7XG4gICAgICAgICAgICBzY2FsZSA9IHBhcnNlRmxvYXQodFsxXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNjYWxlID0gMS4wO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzY2FsZSA9IDEuMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUobGVmdCkgJiYgTnVtYmVyLmlzRmluaXRlKHRvcCkgJiYgTnVtYmVyLmlzRmluaXRlKHNjYWxlKSkge1xuICAgICAgICAgIHggLT0gbGVmdDtcbiAgICAgICAgICB5IC09IHRvcDtcbiAgICAgICAgICB4IC89IHNjYWxlO1xuICAgICAgICAgIHkgLz0gc2NhbGU7XG4gICAgICAgICAgdGhpcy5lbWl0KFwibW91c2Vkb3duXCIsIGZhbHNlLCB7XG4gICAgICAgICAgICB4OiB4LFxuICAgICAgICAgICAgeTogeVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgd2luZG93cy5hZGQodGhpcyk7XG4gICAgfVxuXG4gICAgZGVzdHJveSAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmICh0aGlzLnNob3dpbmcpIHtcbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICB9XG4gICAgICBpZiAocHJpdmF0ZXMuaHRtbCkge1xuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHByaXZhdGVzLmh0bWwpO1xuICAgICAgICBwcml2YXRlcy5odG1sID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmIChwcml2YXRlcy5jc3MpIHtcbiAgICAgICAgZG9jdW1lbnQuaGVhZC5yZW1vdmVDaGlsZChwcml2YXRlcy5jc3MpO1xuICAgICAgICBwcml2YXRlcy5jc3MgPSBudWxsO1xuICAgICAgfVxuICAgICAgaWYgKHdpbmRvd3MuaGFzKHRoaXMpKSB7XG4gICAgICAgIHdpbmRvd3MuZGVsZXRlKHRoaXMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHdoZW5QcmVzcyAoa2V5cywgY2FsbGJhY2spIHtcbiAgICAgIFNwcml0ZS5JbnB1dC53aGVuUHJlc3Moa2V5cywgKGtleSkgPT4ge1xuICAgICAgICBpZiAodGhpcy5hdG9wKSB7XG4gICAgICAgICAgY2FsbGJhY2soa2V5KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICB3aGVuVXAgKGtleXMsIGNhbGxiYWNrKSB7XG4gICAgICBTcHJpdGUuSW5wdXQud2hlblVwKGtleXMsIChrZXkpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuYXRvcCkge1xuICAgICAgICAgIGNhbGxiYWNrKGtleSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgd2hlbkRvd24gKGtleXMsIGNhbGxiYWNrKSB7XG4gICAgICBTcHJpdGUuSW5wdXQud2hlbkRvd24oa2V5cywgKGtleSkgPT4ge1xuICAgICAgICBpZiAodGhpcy5hdG9wKSB7XG4gICAgICAgICAgY2FsbGJhY2soa2V5KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBhc3NpZ24gKG5hbWUsIG9iamVjdCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIG5hbWUsIHtcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgdmFsdWU6IG9iamVjdFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHNob3cgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBHYW1lV2luZG93UmVzaXplKCk7XG4gICAgICBpZiAodGhpcy5zaG93aW5nID09IGZhbHNlICYmIHByaXZhdGVzLmh0bWwpIHtcbiAgICAgICAgdGhpcy5lbWl0KFwiYmVmb3JlU2hvd1wiKTtcblxuICAgICAgICBmb3IgKGxldCB3aW4gb2Ygd2luZG93cykge1xuICAgICAgICAgIGlmICh3aW4uYXRvcCkge1xuICAgICAgICAgICAgd2luLmVtaXQoXCJkZWFjdGl2ZVwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBwcml2YXRlcy5pbmRleCA9IHpJbmRleDtcbiAgICAgICAgcHJpdmF0ZXMuaHRtbC5zdHlsZS56SW5kZXggPSBwcml2YXRlcy5pbmRleDtcbiAgICAgICAgcHJpdmF0ZXMuaHRtbC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB6SW5kZXgrKztcbiAgICAgICAgdGhpcy5lbWl0KFwiYWZ0ZXJTaG93XCIpO1xuICAgICAgICB0aGlzLmVtaXQoXCJhY3RpdmVcIik7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBoaWRlICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgaWYgKHByaXZhdGVzLmh0bWwpIHtcbiAgICAgICAgdGhpcy5lbWl0KFwiYmVmb3JlSGlkZVwiKTtcblxuICAgICAgICBwcml2YXRlcy5pbmRleCA9IC0xO1xuICAgICAgICB0aGlzLmVtaXQoXCJhZnRlckhpZGVcIik7XG4gICAgICAgIHRoaXMuZW1pdChcImRlYWN0aXZlXCIpO1xuXG4gICAgICAgIGlmIChwcml2YXRlcyAmJiBwcml2YXRlcy5odG1sKSB7XG4gICAgICAgICAgcHJpdmF0ZXMuaHRtbC5zdHlsZS56SW5kZXggPSBwcml2YXRlcy5pbmRleDtcbiAgICAgICAgICBwcml2YXRlcy5odG1sLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAobGV0IHdpbiBvZiB3aW5kb3dzKSB7XG4gICAgICAgICAgaWYgKHdpbi5hdG9wKSB7XG4gICAgICAgICAgICB3aW4uZW1pdChcImFjdGl2ZVwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIHF1ZXJ5U2VsZWN0b3IgKHNlbGVjdG9yKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtwcml2YXRlcy5odG1sLmlkfSAke3NlbGVjdG9yfWApO1xuICAgIH1cblxuICAgIHF1ZXJ5U2VsZWN0b3JBbGwgKHNlbGVjdG9yKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAjJHtwcml2YXRlcy5odG1sLmlkfSAke3NlbGVjdG9yfWApO1xuICAgIH1cblxuICAgIGdldCBpbmRleCAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHJldHVybiBwcml2YXRlcy5pbmRleDtcbiAgICB9XG5cbiAgICBzZXQgaW5kZXggKHZhbHVlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKHRoaXMpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5XaW5kb3cuaW5kZXggcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgZ2V0IHNob3dpbmcgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAocHJpdmF0ZXMuaHRtbCAmJiBwcml2YXRlcy5odG1sLnN0eWxlLmRpc3BsYXkgIT0gXCJub25lXCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgc2V0IHNob3dpbmcgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLldpbmRvdy5zaG93aW5nIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGdldCBhdG9wICgpIHtcbiAgICAgIGZvciAobGV0IHdpbiBvZiB3aW5kb3dzKSB7XG4gICAgICAgIGlmICh3aW4uc2hvd2luZyAmJiB3aW4uaW5kZXggPiB0aGlzLmluZGV4KSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBzZXQgYXRvcCAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuV2luZG93LmF0b3AgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgZ2V0IGh0bWwgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmh0bWwuaW5uZXJIVE1MO1xuICAgIH1cblxuICAgIHNldCBodG1sICh2YWx1ZSkge1xuICAgICAgaW50ZXJuYWwodGhpcykuaHRtbC5pbm5lckhUTUwgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgY3NzICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5jc3MuaW5uZXJIVE1MO1xuICAgIH1cblxuICAgIHNldCBjc3MgKHZhbHVlKSB7XG4gICAgICBpbnRlcm5hbCh0aGlzKS5jc3MuaW5uZXJIVE1MID0gdmFsdWU7XG4gICAgfVxuXG4gICAgYXBwZW5kQ2hpbGQgKGRvbUVsZW1lbnQpIHtcbiAgICAgIGludGVybmFsKHRoaXMpLmh0bWwuYXBwZW5kQ2hpbGQoZG9tRWxlbWVudCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICByZW1vdmVDaGlsZCAoZG9tRWxlbWVudCkge1xuICAgICAgaW50ZXJuYWwodGhpcykuaHRtbC5yZW1vdmVDaGlsZChkb21FbGVtZW50KTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8g5b2T56qX5Y+j5aSn5bCP5pS55Y+Y5pe25pS55Y+Y5ri45oiP56qX5Y+j5aSn5bCPXG4gIGZ1bmN0aW9uIEdhbWVXaW5kb3dSZXNpemUgKCkge1xuICAgIGxldCB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIGxldCBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgbGV0IHNjYWxlID0gMTtcbiAgICBsZXQgbGVmdE1hcmdpbiA9IDA7XG4gICAgbGV0IHRvcE1hcmdpbiA9IDA7XG4gICAgbGV0IG1vYmlsZSA9IGZhbHNlO1xuXG4gICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL2lQYWR8aVBob25lfGlQb2R8QW5kcm9pZHxCbGFja0JlcnJ5fHdlYk9TfElFTW9iaWxlfE9wZXJhIE1pbmkvaSkpIHtcbiAgICAgIGlmICh3aWR0aCA8IGhlaWdodCkge1xuICAgICAgICBsZXQgdCA9IHdpZHRoO1xuICAgICAgICB3aWR0aCA9IGhlaWdodDtcbiAgICAgICAgaGVpZ2h0ID0gdDtcbiAgICAgICAgbW9iaWxlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoR2FtZS5jb25maWcuc2NhbGUgPT0gZmFsc2UpIHtcbiAgICAgIC8vIOS4jeaLieS8uOa4uOaIj+eql+WPo++8jOaMieWOn+Wni+Wkp+Wwj+iuoeeul+eql+WPo+WxheS4rVxuICAgICAgbGVmdE1hcmdpbiA9IE1hdGguZmxvb3IoKHdpZHRoIC0gR2FtZS5jb25maWcud2lkdGgpIC8gMik7XG4gICAgICB0b3BNYXJnaW4gPSBNYXRoLmZsb29yKChoZWlnaHQgLSBHYW1lLmNvbmZpZy5oZWlnaHQpIC8gMik7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIOaLieS8uOa4uOaIj+eql+WPo++8jOmmluWFiOiuoeeul+a4uOaIj+WOn+Wni+Wkp+Wwj+avlOS+i1xuICAgICAgbGV0IHJhdGlvID0gR2FtZS5jb25maWcud2lkdGggLyBHYW1lLmNvbmZpZy5oZWlnaHQ7XG4gICAgICAvLyB3aWR0aCBmaXJzdFxuICAgICAgbGV0IHcgPSB3aWR0aDtcbiAgICAgIGxldCBoID0gdyAvIHJhdGlvO1xuICAgICAgLy8gdGhlbiBoZWlnaHRcbiAgICAgIGlmIChoID4gaGVpZ2h0KSB7XG4gICAgICAgIGggPSBoZWlnaHQ7XG4gICAgICAgIHcgPSBoICogcmF0aW87XG4gICAgICB9XG5cbiAgICAgIHcgPSBNYXRoLmZsb29yKHcpO1xuICAgICAgaCA9IE1hdGguZmxvb3IoaCk7XG4gICAgICBsZWZ0TWFyZ2luID0gTWF0aC5mbG9vcigod2lkdGggLSB3KSAvIDIpO1xuICAgICAgdG9wTWFyZ2luID0gTWF0aC5mbG9vcigoaGVpZ2h0IC0gaCkgLyAyKTtcblxuICAgICAgc2NhbGUgPSBNYXRoLm1pbihcbiAgICAgICAgdyAvIEdhbWUuY29uZmlnLndpZHRoLFxuICAgICAgICBoIC8gR2FtZS5jb25maWcuaGVpZ2h0XG4gICAgICApO1xuXG4gICAgICAvLyBzY2FsZSA9IHNjYWxlLnRvRml4ZWQoMyk7XG4gICAgfVxuXG4gICAgLy8gaHRtbOeql+WPo+aLieS8uO+8iGNzc+S4reaOp+WItuS6huWOn+Wni+Wkp+Wwj++8iVxuICAgIGZvciAobGV0IHdpbiBvZiB3aW5kb3dzKSB7XG4gICAgICBpbnRlcm5hbCh3aW4pLmh0bWwuc3R5bGUubGVmdCA9IGAke2xlZnRNYXJnaW59cHhgO1xuICAgICAgaW50ZXJuYWwod2luKS5odG1sLnN0eWxlLnRvcCA9IGAke3RvcE1hcmdpbn1weGA7XG4gICAgICBpbnRlcm5hbCh3aW4pLmh0bWwuc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gXCIwIDAgMFwiO1xuICAgICAgaW50ZXJuYWwod2luKS5odG1sLnN0eWxlLnRyYW5zZm9ybSA9IGBzY2FsZSgke3NjYWxlfSwgJHtzY2FsZX0pIHRyYW5zbGF0ZVooMClgO1xuICAgICAgaW50ZXJuYWwod2luKS5odG1sLnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IGBzY2FsZSgke3NjYWxlfSwgJHtzY2FsZX0pIHRyYW5zbGF0ZVooMClgO1xuICAgICAgaW50ZXJuYWwod2luKS5odG1sLnN0eWxlLmZpbHRlciA9IFwibm9uZVwiO1xuICAgICAgaW50ZXJuYWwod2luKS5odG1sLnN0eWxlLndlYmtpdEZpbHRlciA9IFwiYmx1cigwcHgpXCI7XG4gICAgICBpbnRlcm5hbCh3aW4pLmh0bWwuc3R5bGUubW96RmlsdGVyID0gXCJibHVyKDBweClcIjtcbiAgICAgIGludGVybmFsKHdpbikuaHRtbC5zdHlsZS5tc0ZpbHRlciA9IFwiYmx1cigwcHgpXCI7XG5cbiAgICB9XG5cbiAgICBpZiAoR2FtZS5oZXJvKSB7XG4gICAgICBHYW1lLmhlcm8uZm9jdXMoKTtcbiAgICB9XG5cbiAgfVxuXG4gIEdhbWVXaW5kb3dSZXNpemUoKTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgZnVuY3Rpb24gKCkge1xuICAgIEdhbWVXaW5kb3dSZXNpemUoKTtcbiAgfSk7XG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.archive = Game.Window.create("archiveWindow");

  win.html = "\n    <div class=\"window-box\">\n      <div id=\"archiveWindowItemBar\">\n        <button id=\"archiveWindowClose\" class=\"brownButton\">关闭</button>\n        <button id=\"archiveWindowSave\" class=\"brownButton\">保存</button>\n      </div>\n      <div id=\"archiveWindowTable\"></div>\n    </div>\n  ";

  win.css = "\n    #archiveWindowTable {\n      width: 100%;\n      overflow-y: auto;\n      height: 320px;\n    }\n\n    .archiveWindowItem {\n      border: 1px solid gray;\n      border-radius: 10px;\n      margin: 10px 10px;\n    }\n\n    .archiveWindowItem > button {\n      width: 100px;\n      height: 40px;\n      border-radius: 5px;\n    }\n\n    #archiveWindowItemBar button {\n      width: 100px;\n      height: 30px;\n      font-size: 16px;\n      display: block;\n      margin-bottom: 5px;\n    }\n\n    #archiveWindowClose {\n      float: right;\n    }\n  ";

  var archiveWindowSave = win.querySelector("button#archiveWindowSave");
  var archiveWindowClose = win.querySelector("button#archiveWindowClose");
  var archiveWindowTable = win.querySelector("#archiveWindowTable");

  archiveWindowSave.addEventListener("click", function () {
    var canvas = document.createElement("canvas");
    canvas.width = 80;
    canvas.height = 45;
    var context = canvas.getContext("2d");
    context.drawImage(Game.stage.canvas, 0, 0, Game.stage.canvas.width, Game.stage.canvas.height, 0, 0, 80, 45);

    Game.Archive.save({
      hero: Game.hero.data,
      screenshot: canvas.toDataURL("image/jpeg")
    });

    win.open();
  });

  archiveWindowClose.addEventListener("click", function () {
    win.hide();
    if (!Game.hero) {
      Game.windows.main.show();
    }
  });

  win.whenUp(["esc"], function (key) {
    setTimeout(function () {
      archiveWindowClose.click();
    }, 20);
  });

  win.assign("open", function () {

    if (Game.hero) {
      archiveWindowSave.style.visibility = "visible";
    } else {
      archiveWindowSave.style.visibility = "hidden";
    }

    var table = "";
    var list = Game.Archive.list();
    list.forEach(function (element) {
      var line = "<div class=\"archiveWindowItem\">\n";
      var archive = Game.Archive.get("SAVE_" + element);
      line += "  <button data-type=\"remove\" data-id=\"SAVE_" + element + "\" class=\"brownButton\" style=\"float: right;\">删除</button>\n";
      line += "  <button data-type=\"load\" data-id=\"SAVE_" + element + "\" class=\"brownButton\" style=\"float: right;\">读取</button>\n";
      line += "  <img alt=\"\" src=\"" + (archive.screenshot || "") + "\" width=\"80\" height=\"45\" style=\"display: inline-block; margin: 5px;\">\n";
      line += "  <label style=\"font-size: 20px; margin: 10px;\">" + archive.name + "</label>\n";
      line += "  <label style=\"margin: 10px;\">" + archive.date + "</label>\n";
      line += "</div>\n";
      table += line;
    });

    archiveWindowTable.innerHTML = table;
    Game.windows.archive.show();
  });

  archiveWindowTable.addEventListener("click", function (event) {
    var type = event.target.getAttribute("data-type");
    var id = event.target.getAttribute("data-id");
    if (type && id) {
      if (type == "remove") {
        Game.Archive.remove(id);
        win.open();
      } else if (type == "load") {
        Game.Archive.load(id);
        win.hide();
      }
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dBcmNoaXZlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUdiLE1BQUksR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDOztBQUVyRSxLQUFHLENBQUMsSUFBSSxrVEFRUCxDQUFDOztBQUVGLEtBQUcsQ0FBQyxHQUFHLGlqQkE4Qk4sQ0FBQzs7QUFFRixNQUFJLGlCQUFpQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUN0RSxNQUFJLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUN4RSxNQUFJLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMscUJBQXFCLENBQUMsQ0FBQzs7QUFFbEUsbUJBQWlCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFlBQVk7QUFDdEQsUUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUM5QyxVQUFNLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztBQUNsQixVQUFNLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztBQUNuQixRQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3RDLFdBQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFF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LENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93QXJjaGl2ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG5cbiAgbGV0IHdpbiA9IEdhbWUud2luZG93cy5hcmNoaXZlID0gR2FtZS5XaW5kb3cuY3JlYXRlKFwiYXJjaGl2ZVdpbmRvd1wiKTtcblxuICB3aW4uaHRtbCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwid2luZG93LWJveFwiPlxuICAgICAgPGRpdiBpZD1cImFyY2hpdmVXaW5kb3dJdGVtQmFyXCI+XG4gICAgICAgIDxidXR0b24gaWQ9XCJhcmNoaXZlV2luZG93Q2xvc2VcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5YWz6ZetPC9idXR0b24+XG4gICAgICAgIDxidXR0b24gaWQ9XCJhcmNoaXZlV2luZG93U2F2ZVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7kv53lrZg8L2J1dHRvbj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBpZD1cImFyY2hpdmVXaW5kb3dUYWJsZVwiPjwvZGl2PlxuICAgIDwvZGl2PlxuICBgO1xuXG4gIHdpbi5jc3MgPSBgXG4gICAgI2FyY2hpdmVXaW5kb3dUYWJsZSB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIG92ZXJmbG93LXk6IGF1dG87XG4gICAgICBoZWlnaHQ6IDMyMHB4O1xuICAgIH1cblxuICAgIC5hcmNoaXZlV2luZG93SXRlbSB7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCBncmF5O1xuICAgICAgYm9yZGVyLXJhZGl1czogMTBweDtcbiAgICAgIG1hcmdpbjogMTBweCAxMHB4O1xuICAgIH1cblxuICAgIC5hcmNoaXZlV2luZG93SXRlbSA+IGJ1dHRvbiB7XG4gICAgICB3aWR0aDogMTAwcHg7XG4gICAgICBoZWlnaHQ6IDQwcHg7XG4gICAgICBib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgfVxuXG4gICAgI2FyY2hpdmVXaW5kb3dJdGVtQmFyIGJ1dHRvbiB7XG4gICAgICB3aWR0aDogMTAwcHg7XG4gICAgICBoZWlnaHQ6IDMwcHg7XG4gICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgICBkaXNwbGF5OiBibG9jaztcbiAgICAgIG1hcmdpbi1ib3R0b206IDVweDtcbiAgICB9XG5cbiAgICAjYXJjaGl2ZVdpbmRvd0Nsb3NlIHtcbiAgICAgIGZsb2F0OiByaWdodDtcbiAgICB9XG4gIGA7XG5cbiAgbGV0IGFyY2hpdmVXaW5kb3dTYXZlID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jYXJjaGl2ZVdpbmRvd1NhdmVcIik7XG4gIGxldCBhcmNoaXZlV2luZG93Q2xvc2UgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNhcmNoaXZlV2luZG93Q2xvc2VcIik7XG4gIGxldCBhcmNoaXZlV2luZG93VGFibGUgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNhcmNoaXZlV2luZG93VGFibGVcIik7XG5cbiAgYXJjaGl2ZVdpbmRvd1NhdmUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBjYW52YXMud2lkdGggPSA4MDtcbiAgICBjYW52YXMuaGVpZ2h0ID0gNDU7XG4gICAgbGV0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGNvbnRleHQuZHJhd0ltYWdlKEdhbWUuc3RhZ2UuY2FudmFzLCAwLCAwLCBHYW1lLnN0YWdlLmNhbnZhcy53aWR0aCwgR2FtZS5zdGFnZS5jYW52YXMuaGVpZ2h0LCAwLCAwLCA4MCwgNDUpO1xuXG4gICAgR2FtZS5BcmNoaXZlLnNhdmUoe1xuICAgICAgaGVybzogR2FtZS5oZXJvLmRhdGEsXG4gICAgICBzY3JlZW5zaG90OiBjYW52YXMudG9EYXRhVVJMKFwiaW1hZ2UvanBlZ1wiKVxuICAgIH0pO1xuXG4gICAgd2luLm9wZW4oKTtcbiAgfSk7XG5cbiAgYXJjaGl2ZVdpbmRvd0Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgd2luLmhpZGUoKTtcbiAgICBpZiAoIUdhbWUuaGVybykge1xuICAgICAgR2FtZS53aW5kb3dzLm1haW4uc2hvdygpO1xuICAgIH1cbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJlc2NcIl0sIGZ1bmN0aW9uIChrZXkpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIGFyY2hpdmVXaW5kb3dDbG9zZS5jbGljaygpO1xuICAgIH0sIDIwKTtcbiAgfSk7XG5cbiAgd2luLmFzc2lnbihcIm9wZW5cIiwgZnVuY3Rpb24gKCkge1xuXG4gICAgaWYgKEdhbWUuaGVybykge1xuICAgICAgYXJjaGl2ZVdpbmRvd1NhdmUuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBhcmNoaXZlV2luZG93U2F2ZS5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgICB9XG5cbiAgICBsZXQgdGFibGUgPSBcIlwiO1xuICAgIGxldCBsaXN0ID0gR2FtZS5BcmNoaXZlLmxpc3QoKTtcbiAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIGxldCBsaW5lID0gYDxkaXYgY2xhc3M9XCJhcmNoaXZlV2luZG93SXRlbVwiPlxcbmA7XG4gICAgICBsZXQgYXJjaGl2ZSA9IEdhbWUuQXJjaGl2ZS5nZXQoYFNBVkVfJHtlbGVtZW50fWApO1xuICAgICAgbGluZSArPSBgICA8YnV0dG9uIGRhdGEtdHlwZT1cInJlbW92ZVwiIGRhdGEtaWQ9XCJTQVZFXyR7ZWxlbWVudH1cIiBjbGFzcz1cImJyb3duQnV0dG9uXCIgc3R5bGU9XCJmbG9hdDogcmlnaHQ7XCI+5Yig6ZmkPC9idXR0b24+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPGJ1dHRvbiBkYXRhLXR5cGU9XCJsb2FkXCIgZGF0YS1pZD1cIlNBVkVfJHtlbGVtZW50fVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIiBzdHlsZT1cImZsb2F0OiByaWdodDtcIj7or7vlj5Y8L2J1dHRvbj5cXG5gO1xuICAgICAgbGluZSArPSBgICA8aW1nIGFsdD1cIlwiIHNyYz1cIiR7YXJjaGl2ZS5zY3JlZW5zaG90IHx8IFwiXCJ9XCIgd2lkdGg9XCI4MFwiIGhlaWdodD1cIjQ1XCIgc3R5bGU9XCJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IG1hcmdpbjogNXB4O1wiPlxcbmA7XG4gICAgICBsaW5lICs9IGAgIDxsYWJlbCBzdHlsZT1cImZvbnQtc2l6ZTogMjBweDsgbWFyZ2luOiAxMHB4O1wiPiR7YXJjaGl2ZS5uYW1lfTwvbGFiZWw+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPGxhYmVsIHN0eWxlPVwibWFyZ2luOiAxMHB4O1wiPiR7YXJjaGl2ZS5kYXRlfTwvbGFiZWw+XFxuYDtcbiAgICAgIGxpbmUgKz0gXCI8L2Rpdj5cXG5cIlxuICAgICAgdGFibGUgKz0gbGluZTtcbiAgICB9KTtcblxuICAgIGFyY2hpdmVXaW5kb3dUYWJsZS5pbm5lckhUTUwgPSB0YWJsZTtcbiAgICBHYW1lLndpbmRvd3MuYXJjaGl2ZS5zaG93KCk7XG4gIH0pO1xuXG4gIGFyY2hpdmVXaW5kb3dUYWJsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgbGV0IHR5cGUgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS10eXBlXCIpO1xuICAgIGxldCBpZCA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIpO1xuICAgIGlmICh0eXBlICYmIGlkKSB7XG4gICAgICBpZiAodHlwZSA9PSBcInJlbW92ZVwiKSB7XG4gICAgICAgIEdhbWUuQXJjaGl2ZS5yZW1vdmUoaWQpO1xuICAgICAgICB3aW4ub3BlbigpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlID09IFwibG9hZFwiKSB7XG4gICAgICAgIEdhbWUuQXJjaGl2ZS5sb2FkKGlkKTtcbiAgICAgICAgd2luLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.buy = Game.Window.create("buyWindow");

  win.html = "\n  <div class=\"window-box\">\n    <div id=\"buyWindowItemBar\">\n\n      <button id=\"buyWindowClose\" class=\"brownButton\">关闭</button>\n      <button id=\"buyWindowSell\" class=\"brownButton\">卖出</button>\n\n      <button id=\"buyWindowAll\" class=\"brownButton\">全部</button>\n      <button id=\"buyWindowWeapon\" class=\"brownButton\">武器</button>\n      <button id=\"buyWindowArmor\" class=\"brownButton\">护甲</button>\n      <button id=\"buyWindowPotion\" class=\"brownButton\">药水</button>\n      <button id=\"buyWindowMaterial\" class=\"brownButton\">材料</button>\n      <button id=\"buyWindowBook\" class=\"brownButton\">书籍</button>\n      <button id=\"buyWindowMisc\" class=\"brownButton\">其他</button>\n    </div>\n\n    <span id=\"buyWindowGold\"></span>\n\n    <div style=\"overflow: auto; height: 300px;\">\n      <table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n        <thead>\n          <tr>\n            <td style=\"width: 40px;\"></td>\n            <td style=\"width: 120px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td></td>\n            <td style=\"width: 60px;\"></td>\n          </tr>\n        </thead>\n        <tbody id=\"buyWindowTable\"></tbody>\n      </table>\n    </div>\n  </div>\n  ";

  win.css = "\n    #buyWindowItemBar > button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n      margin-left: 5px;\n      margin-right: 5px;\n      margin-top: 0px;\n      margin-bottom: 5px;\n    }\n\n    #buyWindowClose {\n      float: right;\n    }\n\n    #buyWindowStatus {\n      float: right;\n    }\n\n    .buyWindow table {\n      width: 100%;\n    }\n\n    .buyWindow table img {\n      width: 100%;\n      height: 100%;\n    }\n\n    .buyWindow table button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n    }\n\n    #buyWindowGold {\n      position: absolute;\n      right: 100px;\n      bottom: 30px;\n      font-size: 20px;\n      color: black;\n    }\n  ";

  var buyWindowClose = win.querySelector("button#buyWindowClose");
  var buyWindowSell = win.querySelector("button#buyWindowSell");

  var buyWindowAll = win.querySelector("button#buyWindowAll");
  var buyWindowWeapon = win.querySelector("button#buyWindowWeapon");
  var buyWindowArmor = win.querySelector("button#buyWindowArmor");
  var buyWindowPotion = win.querySelector("button#buyWindowPotion");
  var buyWindowMaterial = win.querySelector("button#buyWindowMaterial");
  var buyWindowBook = win.querySelector("button#buyWindowBook");
  var buyWindowMisc = win.querySelector("button#buyWindowMisc");

  var buyWindowGold = win.querySelector("span#buyWindowGold");
  var buyWindowTable = win.querySelector("#buyWindowTable");

  var lastItems = null;
  var lastFilter = null;
  var lastSelect = -1;

  buyWindowClose.addEventListener("click", function () {
    win.hide();
  });

  buyWindowSell.addEventListener("click", function () {
    win.hide();
    Game.windows.sell.open(lastItems);
  });

  win.whenUp(["tab"], function () {
    setTimeout(function () {
      win.hide();
      Game.windows.sell.open(lastItems);
    }, 20);
  });

  buyWindowAll.addEventListener("click", function (event) {
    win.open(lastItems, null);
  });

  buyWindowWeapon.addEventListener("click", function (event) {
    win.open(lastItems, "sword|spear|bow");
  });

  buyWindowArmor.addEventListener("click", function (event) {
    win.open(lastItems, "head|body|feet");
  });

  buyWindowPotion.addEventListener("click", function (event) {
    win.open(lastItems, "potion");
  });

  buyWindowMaterial.addEventListener("click", function (event) {
    win.open(lastItems, "material");
  });

  buyWindowBook.addEventListener("click", function (event) {
    win.open(lastItems, "book|scroll|letter");
  });

  buyWindowMisc.addEventListener("click", function (event) {
    win.open(lastItems, "misc");
  });

  win.assign("open", function (items, filter, select) {

    if (typeof select == "undefined") {
      select = -1;
    }

    lastItems = items;
    lastFilter = filter;
    lastSelect = select;

    buyWindowGold.textContent = Game.hero.data.gold + "G";

    var defaultColor = "white";
    var activeColor = "yellow";

    buyWindowAll.style.color = defaultColor;
    buyWindowWeapon.style.color = defaultColor;
    buyWindowArmor.style.color = defaultColor;
    buyWindowPotion.style.color = defaultColor;
    buyWindowMaterial.style.color = defaultColor;
    buyWindowBook.style.color = defaultColor;
    buyWindowMisc.style.color = defaultColor;

    if (filter == null) {
      buyWindowAll.style.color = activeColor;
    } else if (filter.match(/sword/)) {
      buyWindowWeapon.style.color = activeColor;
    } else if (filter.match(/head/)) {
      buyWindowArmor.style.color = activeColor;
    } else if (filter.match(/potion/)) {
      buyWindowPotion.style.color = activeColor;
    } else if (filter.match(/material/)) {
      buyWindowMaterial.style.color = activeColor;
    } else if (filter.match(/book/)) {
      buyWindowBook.style.color = activeColor;
    } else if (filter.match(/misc/)) {
      buyWindowMisc.style.color = activeColor;
    }

    var index = 0;
    var table = "";
    Sprite.each(items, function (itemCount, itemId) {
      var item = Game.items[itemId];

      if (filter && filter.indexOf(item.data.type) == -1) return;

      var line = "";

      if (select == index) {
        line += "<tr style=\"background-color: green;\">\n";
      } else {
        line += "<tr>\n";
      }

      if (item.icon) {
        line += "  <td><img alt=\"\" src=\"" + item.icon.src + "\"></td>\n";
      } else {
        line += "  <td> </td>\n";
      }
      line += "  <td>" + item.data.name + "</td>\n";
      line += "  <td style=\"text-align: center;\">" + Math.ceil(item.data.value * 1.2) + "G</td>\n";
      line += "  <td style=\"text-align: center;\">" + itemCount + "</td>\n";
      line += "  <td>" + item.data.description + "</td>\n";

      if (Math.ceil(item.data.value * 1.2) > Game.hero.data.gold || items[itemId] <= 0) {
        line += "  <td><button disabled style=\"Opacity: 0.5;\" class=\"brownButton\">买入</button></td>\n";
      } else {
        line += "  <td><button data-id=\"" + itemId + "\" class=\"brownButton\">买入</button></td>\n";
      }

      line += "</tr>\n";
      table += line;
      index++;
    });

    buyWindowTable.innerHTML = table;
    win.show();
  });

  win.whenUp(["enter"], function () {
    var buttons = buyWindowTable.querySelectorAll("button");
    if (lastSelect >= 0 && lastSelect < buttons.length) {
      buttons[lastSelect].click();
    }
  });

  win.whenUp(["up", "down"], function (key) {
    var count = buyWindowTable.querySelectorAll("button").length;
    if (count <= 0) return;

    if (lastSelect == -1) {
      if (key == "down") {
        win.open(lastItems, lastFilter, 0);
      } else if (key == "up") {
        win.open(lastItems, lastFilter, count - 1);
      }
    } else {
      if (key == "down") {
        var select = lastSelect + 1;
        if (select >= count) {
          select = 0;
        }
        win.open(lastItems, lastFilter, select);
      } else if (key == "up") {
        var select = lastSelect - 1;
        if (select < 0) {
          select = count - 1;
        }
        win.open(lastItems, lastFilter, select);
      }
    }
  });

  win.whenUp(["esc"], function () {
    setTimeout(function () {
      win.hide();
    }, 20);
  });

  win.whenUp(["left", "right"], function (key) {
    if (key == "right") {
      var filter = lastFilter;
      if (filter == null) {
        filter = "sword|spear|bow";
      } else if (filter.match(/sword/)) {
        filter = "head|body|feet";
      } else if (filter.match(/head/)) {
        filter = "potion";
      } else if (filter.match(/potion/)) {
        filter = "material";
      } else if (filter.match(/material/)) {
        filter = "book|scroll|letter";
      } else if (filter.match(/book/)) {
        filter = "misc";
      } else if (filter.match(/misc/)) {
        filter = null;
      }
      win.open(lastItems, filter);
    } else if (key == "left") {
      var filter = lastFilter;
      if (filter == null) {
        filter = "misc";
      } else if (filter.match(/sword/)) {
        filter = null;
      } else if (filter.match(/head/)) {
        filter = "sword|spear|bow";
      } else if (filter.match(/potion/)) {
        filter = "head|body|feet";
      } else if (filter.match(/material/)) {
        filter = "potion";
      } else if (filter.match(/book/)) {
        filter = "material";
      } else if (filter.match(/misc/)) {
        filter = "book|scroll|letter";
      }
      win.open(lastItems, filter);
    }
  });

  buyWindowTable.addEventListener("click", function (event) {
    var itemId = event.target.getAttribute("data-id");
    if (itemId && lastItems.hasOwnProperty(itemId)) {
      var item = Game.items[itemId];

      Game.hero.data.gold -= Math.ceil(item.data.value * 1.2);
      if (Game.hero.data.items[itemId]) {
        Game.hero.data.items[itemId]++;
      } else {
        Game.hero.data.items[itemId] = 1;
      }

      lastItems[itemId]--;

      if (lastItems[itemId] == 0) {
        delete lastItems[itemId];
      }

      win.open(lastItems, lastFilter);
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dCdXkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7O0FBRTdELEtBQUcsQ0FBQyxJQUFJLGd4Q0FrQ1AsQ0FBQzs7QUFFRixLQUFHLENBQUMsR0FBRyxpc0JBeUNOLENBQUM7O0FBRUYsTUFBSSxjQUFjLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ2hFLE1BQUksYUFBYSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUMsQ0FBQzs7QUFFOUQsTUFBSSxZQUFZLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzVELE1BQUksZUFBZSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUNsRSxNQUFJLGNBQWMsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFDaEUsTUFBSSxlQUFlLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0FBQ2xFLE1BQUksaUJBQWlCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ3RFLE1BQUksYUFBYSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUM5RCxNQUFJLGFBQWEsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHNCQUFzQixDQUFDLENBQUM7O0FBRTlELE1BQUksYUFBYSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUM1RCxNQUFJLGNB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QUFDLEVBQUU7QUFDMUIsZUFBTyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7T0FDMUI7O0FBRUQsU0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUM7S0FDakM7R0FDRixDQUFDLENBQUM7Q0FFSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93QnV5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IHdpbiA9IEdhbWUud2luZG93cy5idXkgPSBHYW1lLldpbmRvdy5jcmVhdGUoXCJidXlXaW5kb3dcIik7XG5cbiAgd2luLmh0bWwgPSBgXG4gIDxkaXYgY2xhc3M9XCJ3aW5kb3ctYm94XCI+XG4gICAgPGRpdiBpZD1cImJ1eVdpbmRvd0l0ZW1CYXJcIj5cblxuICAgICAgPGJ1dHRvbiBpZD1cImJ1eVdpbmRvd0Nsb3NlXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuWFs+mXrTwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ1eVdpbmRvd1NlbGxcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5Y2W5Ye6PC9idXR0b24+XG5cbiAgICAgIDxidXR0b24gaWQ9XCJidXlXaW5kb3dBbGxcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5YWo6YOoPC9idXR0b24+XG4gICAgICA8YnV0dG9uIGlkPVwiYnV5V2luZG93V2VhcG9uXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuatpuWZqDwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ1eVdpbmRvd0FybW9yXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuaKpOeUsjwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ1eVdpbmRvd1BvdGlvblwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7oja/msLQ8L2J1dHRvbj5cbiAgICAgIDxidXR0b24gaWQ9XCJidXlXaW5kb3dNYXRlcmlhbFwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7mnZDmlpk8L2J1dHRvbj5cbiAgICAgIDxidXR0b24gaWQ9XCJidXlXaW5kb3dCb29rXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuS5puexjTwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ1eVdpbmRvd01pc2NcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5YW25LuWPC9idXR0b24+XG4gICAgPC9kaXY+XG5cbiAgICA8c3BhbiBpZD1cImJ1eVdpbmRvd0dvbGRcIj48L3NwYW4+XG5cbiAgICA8ZGl2IHN0eWxlPVwib3ZlcmZsb3c6IGF1dG87IGhlaWdodDogMzAwcHg7XCI+XG4gICAgICA8dGFibGUgYm9yZGVyPVwiMVwiIGNlbGxzcGFjaW5nPVwiMFwiIGNlbGxwYWRkaW5nPVwiMFwiPlxuICAgICAgICA8dGhlYWQ+XG4gICAgICAgICAgPHRyPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwid2lkdGg6IDQwcHg7XCI+PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiAxMjBweDtcIj48L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwid2lkdGg6IDMwcHg7XCI+PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiAzMHB4O1wiPjwvdGQ+XG4gICAgICAgICAgICA8dGQ+PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiA2MHB4O1wiPjwvdGQ+XG4gICAgICAgICAgPC90cj5cbiAgICAgICAgPC90aGVhZD5cbiAgICAgICAgPHRib2R5IGlkPVwiYnV5V2luZG93VGFibGVcIj48L3Rib2R5PlxuICAgICAgPC90YWJsZT5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIGA7XG5cbiAgd2luLmNzcyA9IGBcbiAgICAjYnV5V2luZG93SXRlbUJhciA+IGJ1dHRvbiB7XG4gICAgICB3aWR0aDogNjBweDtcbiAgICAgIGhlaWdodDogNDBweDtcbiAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICAgIG1hcmdpbi1sZWZ0OiA1cHg7XG4gICAgICBtYXJnaW4tcmlnaHQ6IDVweDtcbiAgICAgIG1hcmdpbi10b3A6IDBweDtcbiAgICAgIG1hcmdpbi1ib3R0b206IDVweDtcbiAgICB9XG5cbiAgICAjYnV5V2luZG93Q2xvc2Uge1xuICAgICAgZmxvYXQ6IHJpZ2h0O1xuICAgIH1cblxuICAgICNidXlXaW5kb3dTdGF0dXMge1xuICAgICAgZmxvYXQ6IHJpZ2h0O1xuICAgIH1cblxuICAgIC5idXlXaW5kb3cgdGFibGUge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgfVxuXG4gICAgLmJ1eVdpbmRvdyB0YWJsZSBpbWcge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgfVxuXG4gICAgLmJ1eVdpbmRvdyB0YWJsZSBidXR0b24ge1xuICAgICAgd2lkdGg6IDYwcHg7XG4gICAgICBoZWlnaHQ6IDQwcHg7XG4gICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgfVxuXG4gICAgI2J1eVdpbmRvd0dvbGQge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgcmlnaHQ6IDEwMHB4O1xuICAgICAgYm90dG9tOiAzMHB4O1xuICAgICAgZm9udC1zaXplOiAyMHB4O1xuICAgICAgY29sb3I6IGJsYWNrO1xuICAgIH1cbiAgYDtcblxuICBsZXQgYnV5V2luZG93Q2xvc2UgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dDbG9zZVwiKTtcbiAgbGV0IGJ1eVdpbmRvd1NlbGwgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dTZWxsXCIpO1xuXG4gIGxldCBidXlXaW5kb3dBbGwgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dBbGxcIik7XG4gIGxldCBidXlXaW5kb3dXZWFwb24gPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dXZWFwb25cIik7XG4gIGxldCBidXlXaW5kb3dBcm1vciA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI2J1eVdpbmRvd0FybW9yXCIpO1xuICBsZXQgYnV5V2luZG93UG90aW9uID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jYnV5V2luZG93UG90aW9uXCIpO1xuICBsZXQgYnV5V2luZG93TWF0ZXJpYWwgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dNYXRlcmlhbFwiKTtcbiAgbGV0IGJ1eVdpbmRvd0Jvb2sgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dCb29rXCIpO1xuICBsZXQgYnV5V2luZG93TWlzYyA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI2J1eVdpbmRvd01pc2NcIik7XG5cbiAgbGV0IGJ1eVdpbmRvd0dvbGQgPSB3aW4ucXVlcnlTZWxlY3RvcihcInNwYW4jYnV5V2luZG93R29sZFwiKTtcbiAgbGV0IGJ1eVdpbmRvd1RhYmxlID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjYnV5V2luZG93VGFibGVcIik7XG5cbiAgbGV0IGxhc3RJdGVtcyA9IG51bGw7XG4gIGxldCBsYXN0RmlsdGVyID0gbnVsbDtcbiAgbGV0IGxhc3RTZWxlY3QgPSAtMTtcblxuICBidXlXaW5kb3dDbG9zZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgIHdpbi5oaWRlKCk7XG4gIH0pO1xuXG4gIGJ1eVdpbmRvd1NlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICB3aW4uaGlkZSgpO1xuICAgIEdhbWUud2luZG93cy5zZWxsLm9wZW4obGFzdEl0ZW1zKTtcbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJ0YWJcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHdpbi5oaWRlKCk7XG4gICAgICBHYW1lLndpbmRvd3Muc2VsbC5vcGVuKGxhc3RJdGVtcyk7XG4gICAgfSwgMjApO1xuICB9KTtcblxuICBidXlXaW5kb3dBbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgbnVsbCk7XG4gIH0pO1xuXG4gIGJ1eVdpbmRvd1dlYXBvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4obGFzdEl0ZW1zLCBcInN3b3JkfHNwZWFyfGJvd1wiKTtcbiAgfSk7XG5cbiAgYnV5V2luZG93QXJtb3IuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgXCJoZWFkfGJvZHl8ZmVldFwiKTtcbiAgfSk7XG5cbiAgYnV5V2luZG93UG90aW9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4ub3BlbihsYXN0SXRlbXMsIFwicG90aW9uXCIpO1xuICB9KTtcblxuICBidXlXaW5kb3dNYXRlcmlhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4obGFzdEl0ZW1zLCBcIm1hdGVyaWFsXCIpO1xuICB9KTtcblxuICBidXlXaW5kb3dCb29rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4ub3BlbihsYXN0SXRlbXMsIFwiYm9va3xzY3JvbGx8bGV0dGVyXCIpO1xuICB9KTtcblxuICBidXlXaW5kb3dNaXNjLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4ub3BlbihsYXN0SXRlbXMsIFwibWlzY1wiKTtcbiAgfSk7XG5cbiAgd2luLmFzc2lnbihcIm9wZW5cIiwgZnVuY3Rpb24gKGl0ZW1zLCBmaWx0ZXIsIHNlbGVjdCkge1xuXG4gICAgaWYgKHR5cGVvZiBzZWxlY3QgPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgc2VsZWN0ID0gLTE7XG4gICAgfVxuXG4gICAgbGFzdEl0ZW1zID0gaXRlbXM7XG4gICAgbGFzdEZpbHRlciA9IGZpbHRlcjtcbiAgICBsYXN0U2VsZWN0ID0gc2VsZWN0O1xuXG4gICAgYnV5V2luZG93R29sZC50ZXh0Q29udGVudCA9IEdhbWUuaGVyby5kYXRhLmdvbGQgKyBcIkdcIjtcblxuICAgIGxldCBkZWZhdWx0Q29sb3IgPSBcIndoaXRlXCI7XG4gICAgbGV0IGFjdGl2ZUNvbG9yID0gXCJ5ZWxsb3dcIjtcblxuICAgIGJ1eVdpbmRvd0FsbC5zdHlsZS5jb2xvciA9IGRlZmF1bHRDb2xvcjtcbiAgICBidXlXaW5kb3dXZWFwb24uc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgYnV5V2luZG93QXJtb3Iuc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgYnV5V2luZG93UG90aW9uLnN0eWxlLmNvbG9yID0gZGVmYXVsdENvbG9yO1xuICAgIGJ1eVdpbmRvd01hdGVyaWFsLnN0eWxlLmNvbG9yID0gZGVmYXVsdENvbG9yO1xuICAgIGJ1eVdpbmRvd0Jvb2suc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgYnV5V2luZG93TWlzYy5zdHlsZS5jb2xvciA9IGRlZmF1bHRDb2xvcjtcblxuICAgIGlmIChmaWx0ZXIgPT0gbnVsbCkge1xuICAgICAgYnV5V2luZG93QWxsLnN0eWxlLmNvbG9yID0gYWN0aXZlQ29sb3I7XG4gICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3N3b3JkLykpIHtcbiAgICAgIGJ1eVdpbmRvd1dlYXBvbi5zdHlsZS5jb2xvciA9IGFjdGl2ZUNvbG9yO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9oZWFkLykpIHtcbiAgICAgIGJ1eVdpbmRvd0FybW9yLnN0eWxlLmNvbG9yID0gYWN0aXZlQ29sb3I7XG4gICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3BvdGlvbi8pKSB7XG4gICAgICBidXlXaW5kb3dQb3Rpb24uc3R5bGUuY29sb3IgPSBhY3RpdmVDb2xvcjtcbiAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvbWF0ZXJpYWwvKSkge1xuICAgICAgYnV5V2luZG93TWF0ZXJpYWwuc3R5bGUuY29sb3IgPSBhY3RpdmVDb2xvcjtcbiAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvYm9vay8pKSB7XG4gICAgICBidXlXaW5kb3dCb29rLnN0eWxlLmNvbG9yID0gYWN0aXZlQ29sb3I7XG4gICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21pc2MvKSkge1xuICAgICAgYnV5V2luZG93TWlzYy5zdHlsZS5jb2xvciA9IGFjdGl2ZUNvbG9yO1xuICAgIH1cblxuICAgIGxldCBpbmRleCA9IDA7XG4gICAgbGV0IHRhYmxlID0gXCJcIjtcbiAgICBTcHJpdGUuZWFjaChpdGVtcywgZnVuY3Rpb24gKGl0ZW1Db3VudCwgaXRlbUlkKSB7XG4gICAgICBsZXQgaXRlbSA9IEdhbWUuaXRlbXNbaXRlbUlkXTtcblxuICAgICAgaWYgKGZpbHRlciAmJiBmaWx0ZXIuaW5kZXhPZihpdGVtLmRhdGEudHlwZSkgPT0gLTEpXG4gICAgICAgIHJldHVybjtcblxuICAgICAgbGV0IGxpbmUgPSBcIlwiO1xuXG4gICAgICBpZiAoc2VsZWN0ID09IGluZGV4KSB7XG4gICAgICAgIGxpbmUgKz0gYDx0ciBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IGdyZWVuO1wiPlxcbmA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsaW5lICs9IGA8dHI+XFxuYDtcbiAgICAgIH1cblxuXG4gICAgICBpZiAoaXRlbS5pY29uKSB7XG4gICAgICAgIGxpbmUgKz0gYCAgPHRkPjxpbWcgYWx0PVwiXCIgc3JjPVwiJHtpdGVtLmljb24uc3JjfVwiPjwvdGQ+XFxuYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpbmUgKz0gYCAgPHRkPiA8L3RkPlxcbmA7XG4gICAgICB9XG4gICAgICBsaW5lICs9IGAgIDx0ZD4ke2l0ZW0uZGF0YS5uYW1lfTwvdGQ+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPHRkIHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyO1wiPiR7TWF0aC5jZWlsKGl0ZW0uZGF0YS52YWx1ZSAqIDEuMil9RzwvdGQ+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPHRkIHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyO1wiPiR7aXRlbUNvdW50fTwvdGQ+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPHRkPiR7aXRlbS5kYXRhLmRlc2NyaXB0aW9ufTwvdGQ+XFxuYDtcblxuICAgICAgaWYgKE1hdGguY2VpbChpdGVtLmRhdGEudmFsdWUgKiAxLjIpID4gR2FtZS5oZXJvLmRhdGEuZ29sZCB8fCBpdGVtc1tpdGVtSWRdIDw9IDApIHtcbiAgICAgICAgbGluZSArPSBgICA8dGQ+PGJ1dHRvbiBkaXNhYmxlZCBzdHlsZT1cIk9wYWNpdHk6IDAuNTtcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5Lmw5YWlPC9idXR0b24+PC90ZD5cXG5gO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGluZSArPSBgICA8dGQ+PGJ1dHRvbiBkYXRhLWlkPVwiJHtpdGVtSWR9XCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuS5sOWFpTwvYnV0dG9uPjwvdGQ+XFxuYDtcbiAgICAgIH1cblxuICAgICAgbGluZSArPSBcIjwvdHI+XFxuXCI7XG4gICAgICB0YWJsZSArPSBsaW5lO1xuICAgICAgaW5kZXgrKztcbiAgICB9KTtcblxuICAgIGJ1eVdpbmRvd1RhYmxlLmlubmVySFRNTCA9IHRhYmxlO1xuICAgIHdpbi5zaG93KCk7XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1wiZW50ZXJcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgYnV0dG9ucyA9IGJ1eVdpbmRvd1RhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b25cIik7XG4gICAgaWYgKGxhc3RTZWxlY3QgPj0gMCAmJiBsYXN0U2VsZWN0IDwgYnV0dG9ucy5sZW5ndGgpIHtcbiAgICAgIGJ1dHRvbnNbbGFzdFNlbGVjdF0uY2xpY2soKTtcbiAgICB9XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1widXBcIiwgXCJkb3duXCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgbGV0IGNvdW50ID0gYnV5V2luZG93VGFibGUucXVlcnlTZWxlY3RvckFsbChcImJ1dHRvblwiKS5sZW5ndGg7XG4gICAgaWYgKGNvdW50IDw9IDApIHJldHVybjtcblxuICAgIGlmIChsYXN0U2VsZWN0ID09IC0xKSB7XG4gICAgICBpZiAoa2V5ID09IFwiZG93blwiKSB7XG4gICAgICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgbGFzdEZpbHRlciwgMCk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PSBcInVwXCIpIHtcbiAgICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBsYXN0RmlsdGVyLCBjb3VudCAtIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoa2V5ID09IFwiZG93blwiKSB7XG4gICAgICAgIGxldCBzZWxlY3QgPSBsYXN0U2VsZWN0ICsgMTtcbiAgICAgICAgaWYgKHNlbGVjdCA+PSBjb3VudCkge1xuICAgICAgICAgIHNlbGVjdCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBsYXN0RmlsdGVyLCBzZWxlY3QpO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT0gXCJ1cFwiKSB7XG4gICAgICAgIGxldCBzZWxlY3QgPSBsYXN0U2VsZWN0IC0gMTtcbiAgICAgICAgaWYgKHNlbGVjdCA8IDApIHtcbiAgICAgICAgICBzZWxlY3QgPSBjb3VudCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBsYXN0RmlsdGVyLCBzZWxlY3QpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJlc2NcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHdpbi5oaWRlKCk7XG4gICAgfSwgMjApO1xuICB9KTtcblxuICB3aW4ud2hlblVwKFtcImxlZnRcIiwgXCJyaWdodFwiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIGlmIChrZXkgPT0gXCJyaWdodFwiKSB7XG4gICAgICBsZXQgZmlsdGVyID0gbGFzdEZpbHRlcjtcbiAgICAgIGlmIChmaWx0ZXIgPT0gbnVsbCkge1xuICAgICAgICBmaWx0ZXIgPSBcInN3b3JkfHNwZWFyfGJvd1wiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3N3b3JkLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJoZWFkfGJvZHl8ZmVldFwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL2hlYWQvKSkge1xuICAgICAgICBmaWx0ZXIgPSBcInBvdGlvblwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3BvdGlvbi8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwibWF0ZXJpYWxcIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9tYXRlcmlhbC8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwiYm9va3xzY3JvbGx8bGV0dGVyXCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvYm9vay8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwibWlzY1wiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21pc2MvKSkge1xuICAgICAgICBmaWx0ZXIgPSBudWxsO1xuICAgICAgfVxuICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBmaWx0ZXIpO1xuICAgIH0gZWxzZSBpZiAoa2V5ID09IFwibGVmdFwiKSB7XG4gICAgICBsZXQgZmlsdGVyID0gbGFzdEZpbHRlcjtcbiAgICAgIGlmIChmaWx0ZXIgPT0gbnVsbCkge1xuICAgICAgICBmaWx0ZXIgPSBcIm1pc2NcIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9zd29yZC8pKSB7XG4gICAgICAgIGZpbHRlciA9IG51bGw7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvaGVhZC8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwic3dvcmR8c3BlYXJ8Ym93XCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvcG90aW9uLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJoZWFkfGJvZHl8ZmVldFwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21hdGVyaWFsLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJwb3Rpb25cIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9ib29rLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJtYXRlcmlhbFwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21pc2MvKSkge1xuICAgICAgICBmaWx0ZXIgPSBcImJvb2t8c2Nyb2xsfGxldHRlclwiO1xuICAgICAgfVxuICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBmaWx0ZXIpO1xuICAgIH1cbiAgfSk7XG5cbiAgYnV5V2luZG93VGFibGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIGxldCBpdGVtSWQgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiKTtcbiAgICBpZiAoaXRlbUlkICYmIGxhc3RJdGVtcy5oYXNPd25Qcm9wZXJ0eShpdGVtSWQpKSB7XG4gICAgICBsZXQgaXRlbSA9IEdhbWUuaXRlbXNbaXRlbUlkXTtcblxuICAgICAgR2FtZS5oZXJvLmRhdGEuZ29sZCAtPSBNYXRoLmNlaWwoaXRlbS5kYXRhLnZhbHVlICogMS4yKTtcbiAgICAgIGlmIChHYW1lLmhlcm8uZGF0YS5pdGVtc1tpdGVtSWRdKSB7XG4gICAgICAgIEdhbWUuaGVyby5kYXRhLml0ZW1zW2l0ZW1JZF0rKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIEdhbWUuaGVyby5kYXRhLml0ZW1zW2l0ZW1JZF0gPSAxO1xuICAgICAgfVxuXG4gICAgICBsYXN0SXRlbXNbaXRlbUlkXS0tO1xuXG4gICAgICBpZiAobGFzdEl0ZW1zW2l0ZW1JZF0gPT0gMCkge1xuICAgICAgICBkZWxldGUgbGFzdEl0ZW1zW2l0ZW1JZF07XG4gICAgICB9XG5cbiAgICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgbGFzdEZpbHRlcik7XG4gICAgfVxuICB9KTtcblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var choiceHTML = "\n    <div class=\"window-box\">\n      <button id=\"choiceWindowNo\" class=\"brownButton\">取消</button>\n      <div style=\"width: 100%; height: 100%;\">\n        <div style=\"height: 370px; overflow-y: auto; text-align: center;\">\n          <table id=\"choiceWindowTable\" style=\"width: 100%; height: 370px;\">\n            <tbody>\n              <tr>\n                <td id=\"choiceWindowButtonContainer\">\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  ";

  var choiceCSS = "\n    .choiceWindow {\n      text-align: center;\n    }\n\n    .choiceWindow div {\n      text-align: center;\n    }\n\n    button#choiceWindowNo {\n      position: absolute;\n      right: 100px;\n      top: 50px;\n      width: 100px;\n      height: 60px;\n      font-size: 30px;\n    }\n\n    #choiceWindowTable button {\n      margin: 5px auto;\n      min-width: 300px;\n      min-height: 60px;\n      font-size: 30px;\n      display: block;\n    }\n  ";

  Game.choice = function (options, callback) {

    var win = Game.Window.create("choiceWindow");
    win.html = choiceHTML;
    win.css = choiceCSS;
    win.show();

    var choiceWindowButtonContainer = win.querySelector("#choiceWindowButtonContainer");
    var choiceWindowNo = win.querySelector("#choiceWindowNo");
    var buttonArray = [];

    Sprite.each(options, function (value, key) {
      var button = document.createElement("button");
      button.textContent = buttonArray.length + 1 + ". " + key;
      button.classList.add("brownButton");

      choiceWindowButtonContainer.appendChild(button);
      buttonArray.push(button);

      button.addEventListener("click", function () {
        win.hide();
        win.destroy();
        if (callback) {
          callback(value);
        }
      });
    });

    choiceWindowNo.addEventListener("click", function () {
      win.hide();
      win.destroy();
      if (callback) {
        callback(null);
      }
    });

    win.whenUp(["esc"], function () {
      setTimeout(function () {
        choiceWindowNo.click();
      }, 20);
    });

    win.whenUp(["1", "2", "3", "4", "5", "6", "7", "8", "9"], function (key) {
      // match 1 to 9
      var num = parseInt(key) - 1; // get 0 to 8
      var element = buttonArray[num];
      if (element) {
        element.click();
      }
    });
  };
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dDaG9pY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxVQUFVLG9pQkFnQmIsQ0FBQzs7QUFFRixNQUFJLFNBQVMsMmNBeUJaLENBQUM7O0FBRUYsTUFBSSxDQUFDLE1BQU0sR0FBRyxVQUFVLE9BQU8sRUFBRSxRQUFRLEVBQUU7O0FBRXpDLFFBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQzdDLE9BQUcsQ0FBQyxJQUFJLEdBQUcsVUFBVSxDQUFDO0FBQ3RCLE9BQUcsQ0FBQyxHQUFHLEdBQUcsU0FBUyxDQUFDO0FBQ3BCLE9BQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQzs7QUFFWCxRQUFJLDJCQUEyQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsOEJBQThCLENBQUMsQ0FBQztBQUNwRixRQUFJLGNBQWMsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFDMUQsUUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDOztBQUVyQixVQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRSxHQUFHLEVBQUU7QUFDekMsVUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUM5QyxZQUFNLENBQUMsV0FBVyxHQUFNLFdBQVcsQ0FBQyxNQUFNLEdBQUMsQ0FBQyxVQUFLLEdBQUcsQUFBRSxDQUFDO0FBQ3ZELFlBQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDOztBQUVwQyxpQ0FBMkIsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDaEQsaUJBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7O0FBRXpCLFlBQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUMzQyxXQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWCxXQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDZCxZQUFJLFFBQVEsRUFBRTtBQUNaLGtCQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDakI7T0FDRixDQUFDLENBQUM7S0FDSixDQUFDLENBQUM7O0FBRUgsa0JBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUNuRCxTQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWCxTQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDZCxVQUFJLFFBQVEsRUFBRTtBQUNaLGdCQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7T0FDaEI7S0FDRixDQUFDLENBQUM7O0FBRUgsT0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLFlBQVk7QUFDOUIsZ0JBQVUsQ0FBQyxZQUFZO0FBQ3JCLHNCQUFjLENBQUMsS0FBSyxFQUFFLENBQUM7T0FDeEIsRUFBRSxFQUFFLENBQUMsQ0FBQztLQUNSLENBQUMsQ0FBQzs7QUFFSCxPQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxVQUFVLEdBQUcsRUFBRTs7QUFFdkUsVUFBSSxHQUFHLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUM1QixVQUFJLE9BQU8sR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDL0IsVUFBSSxPQUFPLEVBQUU7QUFDWCxlQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7T0FDakI7S0FDRixDQUFDLENBQUM7R0FFSixDQUFDO0NBRUgsQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiR2FtZVdpbmRvd0Nob2ljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCBjaG9pY2VIVE1MID0gYFxuICAgIDxkaXYgY2xhc3M9XCJ3aW5kb3ctYm94XCI+XG4gICAgICA8YnV0dG9uIGlkPVwiY2hvaWNlV2luZG93Tm9cIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5Y+W5raIPC9idXR0b24+XG4gICAgICA8ZGl2IHN0eWxlPVwid2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTtcIj5cbiAgICAgICAgPGRpdiBzdHlsZT1cImhlaWdodDogMzcwcHg7IG92ZXJmbG93LXk6IGF1dG87IHRleHQtYWxpZ246IGNlbnRlcjtcIj5cbiAgICAgICAgICA8dGFibGUgaWQ9XCJjaG9pY2VXaW5kb3dUYWJsZVwiIHN0eWxlPVwid2lkdGg6IDEwMCU7IGhlaWdodDogMzcwcHg7XCI+XG4gICAgICAgICAgICA8dGJvZHk+XG4gICAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAgICA8dGQgaWQ9XCJjaG9pY2VXaW5kb3dCdXR0b25Db250YWluZXJcIj5cbiAgICAgICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgPC90Ym9keT5cbiAgICAgICAgICA8L3RhYmxlPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICBgO1xuXG4gIGxldCBjaG9pY2VDU1MgPSBgXG4gICAgLmNob2ljZVdpbmRvdyB7XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgfVxuXG4gICAgLmNob2ljZVdpbmRvdyBkaXYge1xuICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIH1cblxuICAgIGJ1dHRvbiNjaG9pY2VXaW5kb3dObyB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICByaWdodDogMTAwcHg7XG4gICAgICB0b3A6IDUwcHg7XG4gICAgICB3aWR0aDogMTAwcHg7XG4gICAgICBoZWlnaHQ6IDYwcHg7XG4gICAgICBmb250LXNpemU6IDMwcHg7XG4gICAgfVxuXG4gICAgI2Nob2ljZVdpbmRvd1RhYmxlIGJ1dHRvbiB7XG4gICAgICBtYXJnaW46IDVweCBhdXRvO1xuICAgICAgbWluLXdpZHRoOiAzMDBweDtcbiAgICAgIG1pbi1oZWlnaHQ6IDYwcHg7XG4gICAgICBmb250LXNpemU6IDMwcHg7XG4gICAgICBkaXNwbGF5OiBibG9jaztcbiAgICB9XG4gIGA7XG5cbiAgR2FtZS5jaG9pY2UgPSBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHtcblxuICAgIGxldCB3aW4gPSBHYW1lLldpbmRvdy5jcmVhdGUoXCJjaG9pY2VXaW5kb3dcIik7XG4gICAgd2luLmh0bWwgPSBjaG9pY2VIVE1MO1xuICAgIHdpbi5jc3MgPSBjaG9pY2VDU1M7XG4gICAgd2luLnNob3coKTtcblxuICAgIGxldCBjaG9pY2VXaW5kb3dCdXR0b25Db250YWluZXIgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNjaG9pY2VXaW5kb3dCdXR0b25Db250YWluZXJcIik7XG4gICAgbGV0IGNob2ljZVdpbmRvd05vID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjY2hvaWNlV2luZG93Tm9cIik7XG4gICAgbGV0IGJ1dHRvbkFycmF5ID0gW107XG5cbiAgICBTcHJpdGUuZWFjaChvcHRpb25zLCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xuICAgICAgbGV0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgICBidXR0b24udGV4dENvbnRlbnQgPSBgJHtidXR0b25BcnJheS5sZW5ndGgrMX0uICR7a2V5fWA7XG4gICAgICBidXR0b24uY2xhc3NMaXN0LmFkZChcImJyb3duQnV0dG9uXCIpO1xuXG4gICAgICBjaG9pY2VXaW5kb3dCdXR0b25Db250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTtcbiAgICAgIGJ1dHRvbkFycmF5LnB1c2goYnV0dG9uKTtcblxuICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdpbi5oaWRlKCk7XG4gICAgICAgIHdpbi5kZXN0cm95KCk7XG4gICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgIGNhbGxiYWNrKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBjaG9pY2VXaW5kb3dOby5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgd2luLmhpZGUoKTtcbiAgICAgIHdpbi5kZXN0cm95KCk7XG4gICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB3aW4ud2hlblVwKFtcImVzY1wiXSwgZnVuY3Rpb24gKCkge1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNob2ljZVdpbmRvd05vLmNsaWNrKCk7XG4gICAgICB9LCAyMCk7XG4gICAgfSk7XG5cbiAgICB3aW4ud2hlblVwKFtcIjFcIiwgXCIyXCIsIFwiM1wiLCBcIjRcIiwgXCI1XCIsIFwiNlwiLCBcIjdcIiwgXCI4XCIsIFwiOVwiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgICAgLy8gbWF0Y2ggMSB0byA5XG4gICAgICBsZXQgbnVtID0gcGFyc2VJbnQoa2V5KSAtIDE7IC8vIGdldCAwIHRvIDhcbiAgICAgIGxldCBlbGVtZW50ID0gYnV0dG9uQXJyYXlbbnVtXTtcbiAgICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQuY2xpY2soKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICB9O1xuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  var confirmHTML = "\n  <div class=\"window-box\">\n    <div style=\"width: 100%; height: 100%;\">\n      <table>\n        <tr><td><span id=\"confirmWindowMessage\"></span></td></tr>\n        <tr><td>\n          <button id=\"confirmWindowYes\" class=\"brownButton\">确定</button>\n          <button id=\"confirmWindowNo\" class=\"brownButton\">取消</button>\n        </td></tr>\n      </table>\n    </div>\n  </div>\n  ";

  var confirmCSS = "\n    .confirmWindow {\n      text-align: center;\n    }\n\n    .confirmWindow table {\n      width: 100%;\n      height: 100%;\n    }\n\n    .confirmWindow span {\n      font-size: 16px;\n    }\n\n    .confirmWindow button {\n      width: 100px;\n      height: 60px;\n      font-size: 16px;\n      margin: 20px;\n    }\n\n    #confirmWindowMessage {\n      color: black;\n      font-size: 20px;\n    }\n  ";

  Game.assign("confirm", function (message, yes, no) {

    var win = Game.Window.create("confirmWindow");
    win.html = confirmHTML;
    win.css = confirmCSS;
    win.show();

    var confirmWindowMessage = win.querySelector("#confirmWindowMessage");
    var confirmWindowYes = win.querySelector("#confirmWindowYes");
    var confirmWindowNo = win.querySelector("#confirmWindowNo");

    if (typeof message == "string") {
      confirmWindowMessage.textContent = message;
    } else if (message.message) {
      confirmWindowMessage.textContent = message.message;
      if (message.yes) {
        confirmWindowYes.textContent = message.yes;
      }
      if (message.no) {
        confirmWindowNo.textContent = message.no;
      }
    } else {
      console.error(message, yes, no);
      throw new Error("Game.confirm got invalid arguments");
    }

    win.whenUp(["esc"], function () {
      setTimeout(function () {
        confirmWindowNo.click();
      }, 20);
    });

    win.whenUp(["y", "Y"], function () {
      confirmWindowYes.click();
    });

    win.whenUp(["n", "N"], function () {
      confirmWindowNo.click();
    });

    confirmWindowYes.addEventListener("click", function () {
      win.destroy();
      if (yes) {
        yes();
      }
    });

    confirmWindowNo.addEventListener("click", function () {
      win.destroy();
      if (no) {
        no();
      }
    });
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dDb25maXJtLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7QUFFbEMsTUFBSSxXQUFXLGdaQVlkLENBQUM7O0FBRUYsTUFBSSxVQUFVLDJaQXlCYixDQUFDOztBQUVGLE1BQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLFVBQVUsT0FBTyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUU7O0FBRWpELFFBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzlDLE9BQUcsQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDO0FBQ3ZCLE9BQUcsQ0FBQyxHQUFHLEdBQUcsVUFBVSxDQUFDO0FBQ3JCLE9BQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQzs7QUFFWCxRQUFJLG9CQUFvQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUN0RSxRQUFJLGdCQUFnQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUM5RCxRQUFJLGVBQWUsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLENBQUM7O0FBRTVELFFBQUksT0FBTyxPQUFPLElBQUksUUFBUSxFQUFFO0FBQzlCLDBCQUFvQixDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUM7S0FDNUMsTUFBTSxJQUFJLE9BQU8sQ0FBQyxPQUFPLEVBQUU7QUFDMUIsMEJBQW9CLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUM7QUFDbkQsVUFBSSxPQUFPLENBQUMsR0FBRyxFQUFFO0FBQ2Ysd0JBQWdCLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7T0FDNUM7QUFDRCxVQUFJLE9BQU8sQ0FBQyxFQUFFLEVBQUU7QUFDZCx1QkFBZSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUMsRUFBRSxDQUFDO09BQzFDO0tBQ0YsTUFBTTtBQUNMLGFBQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUNoQyxZQUFNLElBQUksS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7S0FDdkQ7O0FBR0QsT0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLFlBQVk7QUFDOUIsZ0JBQVUsQ0FBQyxZQUFZO0FBQ3JCLHVCQUFlLENBQUMsS0FBSyxFQUFFLENBQUM7T0FDekIsRUFBRSxFQUFFLENBQUMsQ0FBQztLQUNSLENBQUMsQ0FBQzs7QUFFSCxPQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLFlBQVk7QUFDakMsc0JBQWdCLENBQUMsS0FBSyxFQUFFLENBQUM7S0FDMUIsQ0FBQyxDQUFDOztBQUVILE9BQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsWUFBWTtBQUNqQyxxQkFBZSxDQUFDLEtBQUssRUFBRSxDQUFDO0tBQ3pCLENBQUMsQ0FBQzs7QUFFSCxvQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUNyRCxTQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDZCxVQUFJLEdBQUcsRUFBRTtBQUNQLFdBQUcsRUFBRSxDQUFDO09BQ1A7S0FDRixDQUFDLENBQUM7O0FBRUgsbUJBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUNwRCxTQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDZCxVQUFJLEVBQUUsRUFBRTtBQUNOLFVBQUUsRUFBRSxDQUFDO09BQ047S0FDRixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93Q29uZmlybS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCBpbnRlcm5hbCA9IFNwcml0ZS5OYW1lc3BhY2UoKTtcblxuICBsZXQgY29uZmlybUhUTUwgPSBgXG4gIDxkaXYgY2xhc3M9XCJ3aW5kb3ctYm94XCI+XG4gICAgPGRpdiBzdHlsZT1cIndpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7XCI+XG4gICAgICA8dGFibGU+XG4gICAgICAgIDx0cj48dGQ+PHNwYW4gaWQ9XCJjb25maXJtV2luZG93TWVzc2FnZVwiPjwvc3Bhbj48L3RkPjwvdHI+XG4gICAgICAgIDx0cj48dGQ+XG4gICAgICAgICAgPGJ1dHRvbiBpZD1cImNvbmZpcm1XaW5kb3dZZXNcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+56Gu5a6aPC9idXR0b24+XG4gICAgICAgICAgPGJ1dHRvbiBpZD1cImNvbmZpcm1XaW5kb3dOb1wiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7lj5bmtog8L2J1dHRvbj5cbiAgICAgICAgPC90ZD48L3RyPlxuICAgICAgPC90YWJsZT5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIGA7XG5cbiAgbGV0IGNvbmZpcm1DU1MgPSBgXG4gICAgLmNvbmZpcm1XaW5kb3cge1xuICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIH1cblxuICAgIC5jb25maXJtV2luZG93IHRhYmxlIHtcbiAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgIH1cblxuICAgIC5jb25maXJtV2luZG93IHNwYW4ge1xuICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgIH1cblxuICAgIC5jb25maXJtV2luZG93IGJ1dHRvbiB7XG4gICAgICB3aWR0aDogMTAwcHg7XG4gICAgICBoZWlnaHQ6IDYwcHg7XG4gICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgICBtYXJnaW46IDIwcHg7XG4gICAgfVxuXG4gICAgI2NvbmZpcm1XaW5kb3dNZXNzYWdlIHtcbiAgICAgIGNvbG9yOiBibGFjaztcbiAgICAgIGZvbnQtc2l6ZTogMjBweDtcbiAgICB9XG4gIGA7XG5cbiAgR2FtZS5hc3NpZ24oXCJjb25maXJtXCIsIGZ1bmN0aW9uIChtZXNzYWdlLCB5ZXMsIG5vKSB7XG5cbiAgICBsZXQgd2luID0gR2FtZS5XaW5kb3cuY3JlYXRlKFwiY29uZmlybVdpbmRvd1wiKTtcbiAgICB3aW4uaHRtbCA9IGNvbmZpcm1IVE1MO1xuICAgIHdpbi5jc3MgPSBjb25maXJtQ1NTO1xuICAgIHdpbi5zaG93KCk7XG5cbiAgICBsZXQgY29uZmlybVdpbmRvd01lc3NhZ2UgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNjb25maXJtV2luZG93TWVzc2FnZVwiKTtcbiAgICBsZXQgY29uZmlybVdpbmRvd1llcyA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2NvbmZpcm1XaW5kb3dZZXNcIik7XG4gICAgbGV0IGNvbmZpcm1XaW5kb3dObyA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2NvbmZpcm1XaW5kb3dOb1wiKTtcblxuICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICBjb25maXJtV2luZG93TWVzc2FnZS50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgfSBlbHNlIGlmIChtZXNzYWdlLm1lc3NhZ2UpIHtcbiAgICAgIGNvbmZpcm1XaW5kb3dNZXNzYWdlLnRleHRDb250ZW50ID0gbWVzc2FnZS5tZXNzYWdlO1xuICAgICAgaWYgKG1lc3NhZ2UueWVzKSB7XG4gICAgICAgIGNvbmZpcm1XaW5kb3dZZXMudGV4dENvbnRlbnQgPSBtZXNzYWdlLnllcztcbiAgICAgIH1cbiAgICAgIGlmIChtZXNzYWdlLm5vKSB7XG4gICAgICAgIGNvbmZpcm1XaW5kb3dOby50ZXh0Q29udGVudCA9IG1lc3NhZ2Uubm87XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSwgeWVzLCBubyk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLmNvbmZpcm0gZ290IGludmFsaWQgYXJndW1lbnRzXCIpO1xuICAgIH1cblxuXG4gICAgd2luLndoZW5VcChbXCJlc2NcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25maXJtV2luZG93Tm8uY2xpY2soKTtcbiAgICAgIH0sIDIwKTtcbiAgICB9KTtcblxuICAgIHdpbi53aGVuVXAoW1wieVwiLCBcIllcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbmZpcm1XaW5kb3dZZXMuY2xpY2soKTtcbiAgICB9KTtcblxuICAgIHdpbi53aGVuVXAoW1wiblwiLCBcIk5cIl0sIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbmZpcm1XaW5kb3dOby5jbGljaygpO1xuICAgIH0pO1xuXG4gICAgY29uZmlybVdpbmRvd1llcy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgd2luLmRlc3Ryb3koKTtcbiAgICAgIGlmICh5ZXMpIHtcbiAgICAgICAgeWVzKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25maXJtV2luZG93Tm8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHdpbi5kZXN0cm95KCk7XG4gICAgICBpZiAobm8pIHtcbiAgICAgICAgbm8oKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.dialogue = Game.Window.create("dialogueWindow");

  win.html = "\n    <div class=\"window-box\">\n      <div style=\"width: 100%; height: 100%;\">\n        <span id=\"dialogueWindowSpeaker\"></span>\n        <table><tbody><tr><td>\n          <div id=\"dialogueWindowContent\"></div>\n        </td></tr></tbody></table>\n        <button id=\"dialogueWindowNext\" style=\"display: block;\" class=\"brownButton\">继续</button>\n        <button id=\"dialogueWindowClose\" style=\"display: none;\" class=\"brownButton\">结束</button>\n      </div>\n    </div>\n  ";

  win.css = "\n    .dialogueWindow table, dialogueWindow.tbody, dialogueWindow tr, dialogueWindow td {\n      margin: 0;\n      padding: 0;\n      width: 100%;\n      height: 100%;\n      text-align: center;\n    }\n\n    #dialogueWindowSpeaker {\n      position: absolute;\n      left: 50px;\n      top: 50px;\n      font-size: 30px;\n      font-weight: bold;\n    }\n\n    .dialogueWindow button {\n      width: 120px;\n      height: 60px;\n      font-size: 16px;\n      position: absolute;\n    }\n\n    #dialogueWindowNext {\n      bottom: 50px;\n      right: 100px;\n    }\n\n    #dialogueWindowClose {\n      bottom: 50px;\n      right: 100px;\n    }\n\n    #dialogueWindowContent {\n      margin-left: 50px;\n      margin-right: 50px;\n      max-width: 600px;\n      font-size: 24px;\n      text-align: center;\n    }\n  ";

  var dialogueWindowSpeaker = win.querySelector("#dialogueWindowSpeaker");

  var dialogueContent = [];
  var dialogueIndex = 0;
  var dialogueWindowNext = document.getElementById("dialogueWindowNext");
  var dialogueWindowClose = document.getElementById("dialogueWindowClose");
  var dialogueWindowContent = document.getElementById("dialogueWindowContent");

  dialogueWindowNext.addEventListener("click", function () {
    DialogueNext();
  });

  dialogueWindowClose.addEventListener("click", function () {
    setTimeout(function () {
      Game.windows.dialogue.hide();
      dialogueContent = [];
      dialogueIndex = 0;
    }, 20);
  });

  Game.dialogue = function (content, name) {
    dialogueWindowNext.style.display = "block";
    dialogueWindowClose.style.display = "none";
    if (name && name.length) {
      dialogueWindowSpeaker.textContent = name + "：";
    } else {
      dialogueWindowSpeaker.textContent = "";
    }
    dialogueContent = content;
    dialogueIndex = 0;
    DialogueNext();
    Game.windows.dialogue.show();
  };

  function DialogueNext() {
    dialogueWindowContent.textContent = dialogueContent[dialogueIndex];
    dialogueIndex++;
    if (dialogueIndex >= dialogueContent.length) {
      dialogueWindowNext.style.display = "none";
      dialogueWindowClose.style.display = "block";
    }
  };

  win.whenUp(["enter", "space", "esc"], function () {
    if (Game.windows.dialogue.showing) {
      if (dialogueWindowNext.style.display != "none") {
        dialogueWindowNext.click();
      } else if (dialogueWindowClose.style.display != "none") {
        dialogueWindowClose.click();
      }
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dEaWFsb2d1ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7QUFFYixNQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDOztBQUV2RSxLQUFHLENBQUMsSUFBSSwrZUFXUCxDQUFDOztBQUVGLEtBQUcsQ0FBQyxHQUFHLG96QkF5Q04sQ0FBQzs7QUFFRixNQUFJLHFCQUFxQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsd0JBQXdCLENBQUMsQ0FBQzs7QUFFeEUsTUFBSSxlQUFlLEdBQUcsRUFBRSxDQUFDO0FBQ3pCLE1BQUksYUFBYSxHQUFHLENBQUMsQ0FBQztBQUN0QixNQUFJLGtCQUFrQixHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUN2RSxNQUFJLG1CQUFtQixHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUN6RSxNQUFJLHFCQUFxQixHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsdUJBQXVCLENBQUMsQ0FBQzs7QUFFN0Usb0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFlBQVk7QUFDdkQsZ0JBQVksRUFBRSxDQUFDO0dBQ2hCLENBQUMsQ0FBQzs7QUFFSCxxQkFBbUIsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUN4RCxjQUFVLENBQUMsWUFBWTtBQUNyQixVQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUM3QixxQkFBZSxHQUFHLEVBQUUsQ0FBQztBQUNyQixtQkFBYSxHQUFHLENBQUMsQ0FBQztLQUNuQixFQUFFLEVBQUUsQ0FBQyxDQUFDO0dBQ1IsQ0FBQyxDQUFDOztBQUVILE1BQUksQ0FBQyxRQUFRLEdBQUcsVUFBVSxPQUFPLEVBQUUsSUFBSSxFQUFFO0FBQ3ZDLHNCQUFrQixDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0FBQzNDLHVCQUFtQixDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO0FBQzNDLFFBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7QUFDdkIsMkJBQXFCLENBQUMsV0FBVyxHQUFNLElBQUksTUFBRyxDQUFDO0tBQ2hELE1BQU07QUFDTCwyQkFBcUIsQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO0tBQ3hDO0FBQ0QsbUJBQWUsR0FBRyxPQUFPLENBQUM7QUFDMUIsaUJBQWEsR0FBRyxDQUFDLENBQUM7QUFDbEIsZ0JBQVksRUFBRSxDQUFDO0FBQ2YsUUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7R0FDOUIsQ0FBQzs7QUFFRixXQUFTLFlBQVksR0FBSTtBQUN2Qix5QkFBcUIsQ0FBQyxXQUFXLEdBQUcsZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ25FLGlCQUFhLEVBQUUsQ0FBQztBQUNoQixRQUFJLGFBQWEsSUFBSSxlQUFlLENBQUMsTUFBTSxFQUFFO0FBQzNDLHdCQUFrQixDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO0FBQzFDLHlCQUFtQixDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0tBQzdDO0dBQ0YsQ0FBQzs7QUFFRixLQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsRUFBRSxZQUFZO0FBQ2hELFFBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFO0FBQ2pDLFVBQUksa0JBQWtCLENBQUMsS0FBSyxDQUFDLE9BQU8sSUFBSSxNQUFNLEVBQUU7QUFDOUMsMEJBQWtCLENBQUMsS0FBSyxFQUFFLENBQUM7T0FDNUIsTUFBTSxJQUFJLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxPQUFPLElBQUksTUFBTSxFQUFFO0FBQ3RELDJCQUFtQixDQUFDLEtBQUssRUFBRSxDQUFDO09BQzdCO0tBQ0Y7R0FDRixDQUFDLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93RGlhbG9ndWUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgd2luID0gR2FtZS53aW5kb3dzLmRpYWxvZ3VlID0gR2FtZS5XaW5kb3cuY3JlYXRlKFwiZGlhbG9ndWVXaW5kb3dcIik7XG5cbiAgd2luLmh0bWwgPSBgXG4gICAgPGRpdiBjbGFzcz1cIndpbmRvdy1ib3hcIj5cbiAgICAgIDxkaXYgc3R5bGU9XCJ3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlO1wiPlxuICAgICAgICA8c3BhbiBpZD1cImRpYWxvZ3VlV2luZG93U3BlYWtlclwiPjwvc3Bhbj5cbiAgICAgICAgPHRhYmxlPjx0Ym9keT48dHI+PHRkPlxuICAgICAgICAgIDxkaXYgaWQ9XCJkaWFsb2d1ZVdpbmRvd0NvbnRlbnRcIj48L2Rpdj5cbiAgICAgICAgPC90ZD48L3RyPjwvdGJvZHk+PC90YWJsZT5cbiAgICAgICAgPGJ1dHRvbiBpZD1cImRpYWxvZ3VlV2luZG93TmV4dFwiIHN0eWxlPVwiZGlzcGxheTogYmxvY2s7XCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPue7p+e7rTwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGlkPVwiZGlhbG9ndWVXaW5kb3dDbG9zZVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+57uT5p2fPC9idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgYDtcblxuICB3aW4uY3NzID0gYFxuICAgIC5kaWFsb2d1ZVdpbmRvdyB0YWJsZSwgZGlhbG9ndWVXaW5kb3cudGJvZHksIGRpYWxvZ3VlV2luZG93IHRyLCBkaWFsb2d1ZVdpbmRvdyB0ZCB7XG4gICAgICBtYXJnaW46IDA7XG4gICAgICBwYWRkaW5nOiAwO1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgfVxuXG4gICAgI2RpYWxvZ3VlV2luZG93U3BlYWtlciB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICBsZWZ0OiA1MHB4O1xuICAgICAgdG9wOiA1MHB4O1xuICAgICAgZm9udC1zaXplOiAzMHB4O1xuICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgfVxuXG4gICAgLmRpYWxvZ3VlV2luZG93IGJ1dHRvbiB7XG4gICAgICB3aWR0aDogMTIwcHg7XG4gICAgICBoZWlnaHQ6IDYwcHg7XG4gICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgfVxuXG4gICAgI2RpYWxvZ3VlV2luZG93TmV4dCB7XG4gICAgICBib3R0b206IDUwcHg7XG4gICAgICByaWdodDogMTAwcHg7XG4gICAgfVxuXG4gICAgI2RpYWxvZ3VlV2luZG93Q2xvc2Uge1xuICAgICAgYm90dG9tOiA1MHB4O1xuICAgICAgcmlnaHQ6IDEwMHB4O1xuICAgIH1cblxuICAgICNkaWFsb2d1ZVdpbmRvd0NvbnRlbnQge1xuICAgICAgbWFyZ2luLWxlZnQ6IDUwcHg7XG4gICAgICBtYXJnaW4tcmlnaHQ6IDUwcHg7XG4gICAgICBtYXgtd2lkdGg6IDYwMHB4O1xuICAgICAgZm9udC1zaXplOiAyNHB4O1xuICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIH1cbiAgYDtcblxuICBsZXQgZGlhbG9ndWVXaW5kb3dTcGVha2VyID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjZGlhbG9ndWVXaW5kb3dTcGVha2VyXCIpO1xuXG4gIGxldCBkaWFsb2d1ZUNvbnRlbnQgPSBbXTtcbiAgbGV0IGRpYWxvZ3VlSW5kZXggPSAwO1xuICBsZXQgZGlhbG9ndWVXaW5kb3dOZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaWFsb2d1ZVdpbmRvd05leHRcIik7XG4gIGxldCBkaWFsb2d1ZVdpbmRvd0Nsb3NlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaWFsb2d1ZVdpbmRvd0Nsb3NlXCIpO1xuICBsZXQgZGlhbG9ndWVXaW5kb3dDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaWFsb2d1ZVdpbmRvd0NvbnRlbnRcIik7XG5cbiAgZGlhbG9ndWVXaW5kb3dOZXh0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgRGlhbG9ndWVOZXh0KCk7XG4gIH0pO1xuXG4gIGRpYWxvZ3VlV2luZG93Q2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIEdhbWUud2luZG93cy5kaWFsb2d1ZS5oaWRlKCk7XG4gICAgICBkaWFsb2d1ZUNvbnRlbnQgPSBbXTtcbiAgICAgIGRpYWxvZ3VlSW5kZXggPSAwO1xuICAgIH0sIDIwKTtcbiAgfSk7XG5cbiAgR2FtZS5kaWFsb2d1ZSA9IGZ1bmN0aW9uIChjb250ZW50LCBuYW1lKSB7XG4gICAgZGlhbG9ndWVXaW5kb3dOZXh0LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgZGlhbG9ndWVXaW5kb3dDbG9zZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgaWYgKG5hbWUgJiYgbmFtZS5sZW5ndGgpIHtcbiAgICAgIGRpYWxvZ3VlV2luZG93U3BlYWtlci50ZXh0Q29udGVudCA9IGAke25hbWV977yaYDtcbiAgICB9IGVsc2Uge1xuICAgICAgZGlhbG9ndWVXaW5kb3dTcGVha2VyLnRleHRDb250ZW50ID0gXCJcIjtcbiAgICB9XG4gICAgZGlhbG9ndWVDb250ZW50ID0gY29udGVudDtcbiAgICBkaWFsb2d1ZUluZGV4ID0gMDtcbiAgICBEaWFsb2d1ZU5leHQoKTtcbiAgICBHYW1lLndpbmRvd3MuZGlhbG9ndWUuc2hvdygpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIERpYWxvZ3VlTmV4dCAoKSB7XG4gICAgZGlhbG9ndWVXaW5kb3dDb250ZW50LnRleHRDb250ZW50ID0gZGlhbG9ndWVDb250ZW50W2RpYWxvZ3VlSW5kZXhdO1xuICAgIGRpYWxvZ3VlSW5kZXgrKztcbiAgICBpZiAoZGlhbG9ndWVJbmRleCA+PSBkaWFsb2d1ZUNvbnRlbnQubGVuZ3RoKSB7XG4gICAgICBkaWFsb2d1ZVdpbmRvd05leHQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgZGlhbG9ndWVXaW5kb3dDbG9zZS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgIH1cbiAgfTtcblxuICB3aW4ud2hlblVwKFtcImVudGVyXCIsIFwic3BhY2VcIiwgXCJlc2NcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoR2FtZS53aW5kb3dzLmRpYWxvZ3VlLnNob3dpbmcpIHtcbiAgICAgIGlmIChkaWFsb2d1ZVdpbmRvd05leHQuc3R5bGUuZGlzcGxheSAhPSBcIm5vbmVcIikge1xuICAgICAgICBkaWFsb2d1ZVdpbmRvd05leHQuY2xpY2soKTtcbiAgICAgIH0gZWxzZSBpZiAoZGlhbG9ndWVXaW5kb3dDbG9zZS5zdHlsZS5kaXNwbGF5ICE9IFwibm9uZVwiKSB7XG4gICAgICAgIGRpYWxvZ3VlV2luZG93Q2xvc2UuY2xpY2soKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows["interface"] = Game.Window.create("interfaceWindow");

  win.html = "\n    <div id=\"interfaceWindowBar\"></div>\n\n    <div style=\"position: absolute; bottom: 10px; left: 20px; width: 100px; height: 60px;\">\n      <div style=\"width: 100px; height: 20px; margin: 5px 0; border: 1px solid gray; background-color: white;\">\n        <div id=\"interfaceWindowHP\" style=\"width: 100%; height: 100%; background-color: green;\"></div>\n      </div>\n      <div style=\"width: 100px; height: 20px; margin: 5px 0; border: 1px solid gray; background-color: white;\">\n        <div id=\"interfaceWindowSP\" style=\"width: 100%; height: 100%; background-color: blue;\"></div>\n      </div>\n    </div>\n\n    <span id=\"interfaceWindowDatetime\"></span>\n    <span id=\"interfaceWindowMap\"></span>\n\n    <button id=\"interfaceWindowUse\" class=\"interfaceWindowButton\"></button>\n    <button id=\"interfaceWindowMenu\" class=\"interfaceWindowButton\"></button>\n  ";

  win.css = "\n\n    #interfaceWindowBar {\n      text-align: center;\n      position: absolute;\n      bottom: 10px;\n      width: 100%;\n      height: 60px;\n    }\n\n    .interfaceWindow {\n      /** 让interface窗口的主要窗口，不接受事件 */\n      pointer-events: none;\n    }\n\n    button.interfaceWindowButton {\n      margin-left: 3px;\n      margin-right: 3px;\n      width: 60px;\n      height: 60px;\n      border: 4px solid gray;\n      border-radius: 10px;\n      background-color: rgba(100, 100, 100, 0.5);\n      display: inline-block;\n      /** 让interface窗口的按钮，接受事件 */\n      pointer-events: auto;\n      background-repeat: no-repeat;\n      background-size: cover;\n    }\n\n    button.interfaceWindowButton:hover {\n      opacity: 0.5;\n    }\n\n    button.interfaceWindowButton > img {\n      width: 100%;\n      height: 100%;\n    }\n\n    #interfaceWindowMap {\n      position: absolute;\n      top: 35px;\n      left: 5px;\n      background-color: rgba(100, 100, 100, 0.7);\n      padding: 2px;\n    }\n\n    #interfaceWindowDatetime {\n      position: absolute;\n      top: 10px;\n      left: 5px;\n      background-color: rgba(100, 100, 100, 0.7);\n      padding: 2px;\n    }\n\n    button#interfaceWindowUse {\n      position: absolute;\n      top: 5px;\n      right: 85px;\n      visibility: hidden;\n      background-image: url(\"image/hint.png\");\n    }\n\n    button#interfaceWindowMenu {\n      position: absolute;\n      top: 5px;\n      right: 5px;\n      background-image: url(\"image/setting.png\");\n    }\n\n    interfaceWindowButton:disabled {\n      cursor: default;\n      pointer-events: none;\n      background-color: gray;\n      opacity: 0.5;\n    }\n\n    .interfaceWindowButtonText {\n      position: absolute;\n      background-color: white;\n      margin-left: -26px;\n      margin-top: 12px;\n    }\n  ";

  // 使用按钮
  var interfaceWindowUse = win.querySelector("button#interfaceWindowUse");
  // 技能栏按钮组
  var interfaceWindowBar = win.querySelector("div#interfaceWindowBar");
  // 地图信息
  var interfaceWindowMap = win.querySelector("#interfaceWindowMap");
  // 选项菜单
  var interfaceWindowMenu = win.querySelector("button#interfaceWindowMenu");
  // 玩家的hp
  var interfaceWindowHP = win.querySelector("#interfaceWindowHP");
  // 玩家的sp
  var interfaceWindowSP = win.querySelector("#interfaceWindowSP");

  win.assign("hideUse", function () {
    interfaceWindowUse.style.visibility = "hidden";
  });

  win.assign("showUse", function () {
    interfaceWindowUse.style.visibility = "visible";
  });

  win.on("active", function () {
    Game.start();
  });

  win.on("deactive", function () {
    Game.pause();
  });

  win.whenUp(["esc"], function (key) {
    if (Game.windows["interface"].atop) {
      setTimeout(function () {
        interfaceWindowMenu.click();
      }, 20);
    }
  });

  function InitInterfaceBar() {
    var buttonCount = 8;
    var buttonHTML = "";
    for (var i = 0; i < buttonCount; i++) {
      var line = "";
      line += "<button data-index=\"" + i + "\" class=\"interfaceWindowButton\">";
      line += "<label data-index=\"" + i + "\" class=\"interfaceWindowButtonText\"></label>";
      line += "</button>\n";
      buttonHTML += line;
    }
    interfaceWindowBar.innerHTML = buttonHTML;
  }

  setInterval(function () {
    if (Game.hero && Game.paused == false) {
      Game.hero.data.time++;
      Game.windows["interface"].datetime();
    }
  }, 1000);

  InitInterfaceBar();
  var buttons = win.querySelectorAll(".interfaceWindowButton");
  var buttonTexts = win.querySelectorAll(".interfaceWindowButtonText");

  interfaceWindowBar.addEventListener("click", function (event) {
    var index = event.target.getAttribute("data-index");
    if (index) {
      var element = Game.hero.data.bar[index];
      if (element) {
        if (element.type == "skill") {
          var cooldown = Game.hero.fire(element.id);
          if (cooldown) {
            event.target.disabled = true;
            setTimeout(function () {
              event.target.disabled = false;
            }, cooldown);
          }
        } else if (element.type == "item") {
          var itemId = element.id;
          var item = Game.items[itemId];
          item.heroUse();
          Game.windows["interface"].refresh();
        }
      }
    }
  });

  win.whenUp(["1", "2", "3", "4", "5", "6", "7", "8"], function (key) {
    var num = parseInt(key);
    if (Number.isInteger(num) && num >= 0 && num < buttons.length) {
      buttons[num - 1].click();
    }
  });

  win.whenUp(["e", "E", "space", "enter"], function (key) {
    if (Game.windows["interface"].showing) {
      if (Game.hintObject && Game.hintObject.heroUse) {
        Game.hintObject.heroUse();
      }
    }
  });

  interfaceWindowUse.addEventListener("click", function (event) {
    if (Game.hintObject && Game.hintObject.heroUse) {
      Game.hintObject.heroUse();
    }
  });

  win.assign("status", function () {
    if (Game.hero) {
      var hp = Game.hero.data.hp / Game.hero.data.$hp;
      var sp = Game.hero.data.sp / Game.hero.data.$sp;
      interfaceWindowHP.style.width = hp * 100 + "%";
      interfaceWindowSP.style.width = sp * 100 + "%";
      if (hp >= 0.5) {
        interfaceWindowHP.style.backgroundColor = "green";
      } else if (hp >= 0.25) {
        interfaceWindowHP.style.backgroundColor = "yellow";
      } else {
        interfaceWindowHP.style.backgroundColor = "red";
      }
    }
  });

  win.assign("datetime", function () {
    if (Game.hero && Game.hero.data && Number.isInteger(Game.hero.data.time)) {
      var YEARMIN = 60 * 24 * 30 * 12;
      var MONTHMIN = 60 * 24 * 30;
      var DAYMIN = 60 * 24;
      var HOURMIN = 60;
      var datetime = win.querySelector("#interfaceWindowDatetime");
      var time = Game.hero.data.time;
      var year = Math.floor(time / YEARMIN);
      time = time % YEARMIN;
      var month = Math.floor(time / MONTHMIN);
      time = time % MONTHMIN;
      var day = Math.floor(time / DAYMIN);
      time = time % DAYMIN;
      var hour = Math.floor(time / HOURMIN);
      time = time % HOURMIN;
      var minute = time;
      year++;
      month++;
      day++;
      hour = hour.toString();
      while (hour.length < 2) hour = "0" + hour;
      minute = minute.toString();
      while (minute.length < 2) minute = "0" + minute;
      datetime.textContent = month + "月" + day + "日 " + hour + ":" + minute;

      var type = Game.area.map.data.type;

      if (type == "indoor") {
        // do nothing
        Game.stage.filter("brightness", 0.0);
      } else if (type == "outdoor") {
        // 室外
        if (hour >= 20 || hour < 4) {
          // 20:00 to 4:00
          Game.stage.filter("brightness", -0.15);
        } else if (hour >= 4 && hour < 6) {
          Game.stage.filter("brightness", -0.1);
        } else if (hour >= 6 && hour < 8) {
          Game.stage.filter("brightness", -0.05);
        } else if (hour >= 8 && hour < 10) {
          Game.stage.filter("brightness", 0.0);
        } else if (hour >= 10 && hour < 12) {
          Game.stage.filter("brightness", 0.05);
        } else if (hour >= 12 && hour < 14) {
          Game.stage.filter("brightness", 0.0);
        } else if (hour >= 14 && hour < 16) {
          Game.stage.filter("brightness", 0.0);
        } else if (hour >= 16 && hour < 18) {
          Game.stage.filter("brightness", -0.05);
        } else if (hour >= 18 && hour < 20) {
          Game.stage.filter("brightness", -0.1);
        }
      } else if (type == "cave") {
        // caves are dark
        Game.stage.filter("brightness", -0.15);
      }
    }
  });

  win.assign("refresh", function () {
    for (var i = 0; i < 8; i++) {
      var element = Game.hero.data.bar[i];
      var button = buttons[i];
      var text = buttonTexts[i];
      button.disabled = false;
      text.disabled = false;

      if (element) {
        var id = element.id;
        var type = element.type;
        if (type == "skill") {
          var skill = Game.skills[id];
          button.style.backgroundImage = "url(\"" + skill.icon.src + "\")";
          text.textContent = skill.data.cost;
        } else if (type == "item") {
          var item = Game.items[id];
          button.style.backgroundImage = "url(\"" + item.icon.src + "\")";
          if (Game.hero.data.items[id]) {
            text.textContent = Game.hero.data.items[id];
          } else {
            text.textContent = "0";
            button.disabled = true;
            text.disabled = true;
          }
        }
      } else {
        // empty bar element
        text.textContent = "";
        button.style.backgroundImage = "";
      }
    }

    interfaceWindowMap.textContent = Game.area.map.data.name;
  });

  interfaceWindowMenu.addEventListener("click", function (event) {
    Game.windows.sysmenu.show();
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dJbnRlcmZhY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sYUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7O0FBRXpFLEtBQUcsQ0FBQyxJQUFJLGc0QkFpQlAsQ0FBQzs7QUFFRixLQUFHLENBQUMsR0FBRyxxeURBbUZOLENBQUM7OztBQUdGLE1BQUksa0JBQWtCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDOztBQUV4RSxNQUFJLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsd0JBQXdCLENBQUMsQ0FBQzs7QUFFckUsTUFBSSxrQkFBa0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHFCQUFxQixDQUFDLENBQUM7O0FBRWxFLE1BQUksbUJBQW1CLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDOztBQUUxRSxNQUFJLGlCQUFpQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsb0JBQW9CLENBQUMsQ0FBQzs7QUFFaEUsTUFBSSxpQkFBaUIsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDLENBQUM7O0FBRWhFLEtBQUcsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLFlBQVk7QUFDaEMsc0JBQWtCLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUM7R0FDaEQsQ0FBQyxDQUFDOztBQUVILEtBQUcsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLFlBQVk7QUFDaEMsc0JBQWtCLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7R0FDakQsQ0FBQyxDQUFDOztBQUVILEtBQUcsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLFlBQVk7QUFDM0IsUUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO0dBQ2QsQ0FBQyxDQUFDOztBQUVILEtBQUcsQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLFlBQVk7QUFDN0IsUUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO0dBQ2QsQ0FBQyxDQUFBOztBQUVGLEtBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxVQUFVLEdBQUcsRUFBRTtBQUNqQyxRQUFJLElBQUksQ0FBQyxPQUFPLGFBQVUsQ0FBQyxJQUFJLEVBQUU7QUFDL0IsZ0JBQVUsQ0FBQyxZQUFZO0FBQ3JCLDJCQUFtQixDQUFDLEtBQUssRUFBRSxDQUFDO09BQzdCLEVBQUUsRUFBRSxDQUFDLENBQUM7S0FDUjtHQUNGLENBQUMsQ0FBQzs7QUFFSCxXQUFTLGdCQUFnQixHQUFJO0FBQzNCLFFBQUksV0FBVyxHQUFHLENBQUMsQ0FBQztBQUNwQixRQUFJLFVBQVUsR0FBRyxFQUFFLENBQUM7QUFDcEIsU0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFdBQVcsRUFBRSxDQUFDLEVBQUUsRUFBRTtBQUNwQyxVQUFJLElBQUksR0FBRyxFQUFFLENBQUM7QUFDZCxVQUFJLDhCQUEyQixDQUFDLHdDQUFrQyxDQUFDO0FBQ25FLFVBQUksNkJBQTBCLENBQUMsb0RBQThDLENBQUE7QUFDN0UsVUFBSSxpQkFBaUIsQ0FBQztBQUN0QixnQkFBVSxJQUFJLElBQUksQ0FBQztLQUNwQjtBQUNELHNCQUFrQixDQUFDLFNBQVMsR0FBRyxVQUFVLENBQUM7R0FDM0M7O0FBRUQsYUFBVyxDQUFDLFlBQVk7QUFDdEIsUUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLElBQUksS0FBSyxFQUFFO0FBQ3JDLFVBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ3RCLFVBQUksQ0FBQyxPQUFPLGFBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztLQUNuQztHQUNGLEVBQUUsSUFBSSxDQUFDLENBQUM7O0FBRVQsa0JBQWdCLEVBQUUsQ0FBQztBQUNuQixNQUFJLE9BQU8sR0FBRyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUM3RCxNQUFJLFdBQVcsR0FBRyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsNEJBQTRCLENBQUMsQ0FBQzs7QUFFckUsb0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVUsS0FBSyxFQUFFO0FBQzVELFFBQUksS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3BELFFBQUksS0FBSyxFQUFFO0FBQ1QsVUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3hDLFVBQUksT0FBTyxFQUFFO0FBQ1gsWUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sRUFBRTtBQUMzQixjQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDMUMsY0FBSSxRQUFRLEVBQUU7QUFDWixpQkFBSyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO0FBQzdCLHNCQUFVLENBQUMsWUFBWTtBQUNyQixtQkFBSyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO2FBQy9CLEVBQUUsUUFBUSxDQUFDLENBQUM7V0FDZDtTQUNGLE1BQU0sSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE1BQU0sRUFBRTtBQUNqQyxjQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsRUFBRSxDQUFDO0FBQ3hCLGNBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDOUIsY0FBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ2YsY0FBSSxDQUFDLE9BQU8sYUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDO1NBQ2xDO09BQ0Y7S0FDRjtHQUNGLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLFVBQVUsR0FBRyxFQUFFO0FBQ2xFLFFBQUksR0FBRyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN4QixRQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRTtBQUM3RCxhQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO0tBQzFCO0dBQ0YsQ0FBQyxDQUFDOztBQUVILEtBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsRUFBRSxVQUFVLEdBQUcsRUFBRTtBQUN0RCxRQUFJLElBQUksQ0FBQyxPQUFPLGFBQVUsQ0FBQyxPQUFPLEVBQUU7QUFDbEMsVUFBSSxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFO0FBQzlDLFlBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7T0FDM0I7S0FDRjtHQUNGLENBQUMsQ0FBQzs7QUFFSCxvQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDNUQsUUFBSSxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFO0FBQzlDLFVBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDM0I7R0FDRixDQUFDLENBQUM7O0FBRUgsS0FBRyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsWUFBWTtBQUMvQixRQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7QUFDYixVQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO0FBQ2hELFVBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7QUFDaEQsdUJBQWlCLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBTSxFQUFFLEdBQUMsR0FBRyxNQUFHLENBQUM7QUFDN0MsdUJBQWlCLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBTSxFQUFFLEdBQUMsR0FBRyxNQUFHLENBQUM7QUFDN0MsVUFBSSxFQUFFLElBQUksR0FBRyxFQUFFO0FBQ2IseUJBQWlCLENBQUMsS0FBSyxDQUFDLGVBQWUsR0FBRyxPQUFPLENBQUM7T0FDbkQsTUFBTSxJQUFJLEVBQUUsSUFBSSxJQUFJLEVBQUU7QUFDckIseUJBQWlCLENBQUMsS0FBSyxDQUFDLGVBQWUsR0FBRyxRQUFRLENBQUM7T0FDcEQsTUFBTTtBQUNMLHlCQUFpQixDQUFDLEtBQUssQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO09BQ2pEO0tBQ0Y7R0FDRixDQUFDLENBQUM7O0FBRUgsS0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsWUFBWTtBQUNqQyxRQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN4RSxVQUFJLE9BQU8sR0FBRyxFQUFFLEdBQUMsRUFBRSxHQUFDLEVBQUUsR0FBQyxFQUFFLENBQUM7QUFDMUIsVUFBSSxRQUFRLEdBQUcsRUFBRSxHQUFDLEVBQUUsR0FBQyxFQUFFLENBQUM7QUFDeEIsVUFBSSxNQUFNLEdBQUcsRUFBRSxHQUFDLEVBQUUsQ0FBQztBQUNuQixVQUFJLE9BQU8sR0FBRyxFQUFFLENBQUM7QUFDakIsVUFBSSxRQUFRLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQzdELFVBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztBQUMvQixVQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksR0FBQyxPQUFPLENBQUMsQ0FBQztBQUNwQyxVQUFJLEdBQUcsSUFBSSxHQUFHLE9BQU8sQ0FBQztBQUN0QixVQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksR0FBQyxRQUFRLENBQUMsQ0FBQztBQUN0QyxVQUFJLEdBQUcsSUFBSSxHQUFHLFFBQVEsQ0FBQztBQUN2QixVQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksR0FBQyxNQUFNLENBQUMsQ0FBQztBQUNsQyxVQUFJLEdBQUcsSUFBSSxHQUFHLE1BQU0sQ0FBQztBQUNyQixVQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksR0FBQyxPQUFPLENBQUMsQ0FBQztBQUNwQyxVQUFJLEdBQUcsSUFBSSxHQUFHLE9BQU8sQ0FBQztBQUN0QixVQUFJLE1BQU0sR0FBRyxJQUFJLENBQUM7QUFDbEIsVUFBSSxFQUFFLENBQUM7QUFDUCxXQUFLLEVBQUUsQ0FBQztBQUNSLFNBQUcsRUFBRSxDQUFDO0FBQ04sVUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUN2QixhQUFPLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLElBQUksR0FBRyxHQUFHLEdBQUMsSUFBSSxDQUFDO0FBQ3hDLFlBQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDM0IsYUFBTyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxNQUFNLEdBQUcsR0FBRyxHQUFDLE1BQU0sQ0FBQztBQUM5QyxjQUFRLENBQUMsV0FBVyxHQUFNLEtBQUssU0FBSSxHQUFHLFVBQUssSUFBSSxTQUFJLE1BQU0sQUFBRSxDQUFDOztBQUU1RCxVQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDOztBQUVuQyxVQUFJLElBQUksSUFBSSxRQUFRLEVBQUU7O0FBRXBCLFlBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsQ0FBQztPQUN0QyxNQUFNLElBQUksSUFBSSxJQUFJLFNBQVMsRUFBRTs7QUFFNUIsWUFBSSxJQUFJLElBQUksRUFBRSxJQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7O0FBQzFCLGNBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3hDLE1BQU0sSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLEVBQUU7QUFDaEMsY0FBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDdkMsTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxHQUFHLENBQUMsRUFBRTtBQUNoQyxjQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN4QyxNQUFNLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLEdBQUcsRUFBRSxFQUFFO0FBQ2pDLGNBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsQ0FBQztTQUN0QyxNQUFNLElBQUksSUFBSSxJQUFJLEVBQUUsSUFBSSxJQUFJLEdBQUcsRUFBRSxFQUFFO0FBQ2xDLGNBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsQ0FBQztTQUN2QyxNQUFNLElBQUksSUFBSSxJQUFJLEVBQUUsSUFBSSxJQUFJLEdBQUcsRUFBRSxFQUFFO0FBQ2xDLGNBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsQ0FBQztTQUN0QyxNQUFNLElBQUksSUFBSSxJQUFJLEVBQUUsSUFBSSxJQUFJLEdBQUcsRUFBRSxFQUFFO0FBQ2xDLGNBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsQ0FBQztTQUN0QyxNQUFNLElBQUksSUFBSSxJQUFJLEVBQUUsSUFBSSxJQUFJLEdBQUcsRUFBRSxFQUFFO0FBQ2xDLGNBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3hDLE1BQU0sSUFBSSxJQUFJLElBQUksRUFBRSxJQUFJLElBQUksR0FBRyxFQUFFLEVBQUU7QUFDbEMsY0FBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDdkM7T0FDRixNQUFNLElBQUksSUFBSSxJQUFJLE1BQU0sRUFBRTs7QUFFekIsWUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7T0FDeEM7S0FFRjtHQUNGLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxZQUFZO0FBQ2hDLFNBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDMUIsVUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3BDLFVBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4QixVQUFJLElBQUksR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDMUIsWUFBTSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7QUFDeEIsVUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7O0FBRXRCLFVBQUksT0FBTyxFQUFFO0FBQ1gsWUFBSSxFQUFFLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQztBQUNwQixZQUFJLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0FBQ3hCLFlBQUksSUFBSSxJQUFJLE9BQU8sRUFBRTtBQUNuQixjQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQzVCLGdCQUFNLENBQUMsS0FBSyxDQUFDLGVBQWUsY0FBVyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsUUFBSSxDQUFDO0FBQzFELGNBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDcEMsTUFBTSxJQUFJLElBQUksSUFBSSxNQUFNLEVBQUU7QUFDekIsY0FBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUMxQixnQkFBTSxDQUFDLEtBQUssQ0FBQyxlQUFlLGNBQVcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLFFBQUksQ0FBQztBQUN6RCxjQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBRTtBQUM1QixnQkFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7V0FDN0MsTUFBTTtBQUNMLGdCQUFJLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQztBQUN2QixrQkFBTSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7QUFDdkIsZ0JBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1dBQ3RCO1NBQ0Y7T0FDRixNQUFNOztBQUVMLFlBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO0FBQ3RCLGNBQU0sQ0FBQyxLQUFLLENBQUMsZUFBZSxHQUFHLEVBQUUsQ0FBQztPQUNuQztLQUNGOztBQUVELHNCQUFrQixDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO0dBQzFELENBQUMsQ0FBQzs7QUFFSCxxQkFBbUIsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDN0QsUUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7R0FDN0IsQ0FBQyxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiR2FtZVdpbmRvd0ludGVyZmFjZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCB3aW4gPSBHYW1lLndpbmRvd3MuaW50ZXJmYWNlID0gR2FtZS5XaW5kb3cuY3JlYXRlKFwiaW50ZXJmYWNlV2luZG93XCIpO1xuXG4gIHdpbi5odG1sID0gYFxuICAgIDxkaXYgaWQ9XCJpbnRlcmZhY2VXaW5kb3dCYXJcIj48L2Rpdj5cblxuICAgIDxkaXYgc3R5bGU9XCJwb3NpdGlvbjogYWJzb2x1dGU7IGJvdHRvbTogMTBweDsgbGVmdDogMjBweDsgd2lkdGg6IDEwMHB4OyBoZWlnaHQ6IDYwcHg7XCI+XG4gICAgICA8ZGl2IHN0eWxlPVwid2lkdGg6IDEwMHB4OyBoZWlnaHQ6IDIwcHg7IG1hcmdpbjogNXB4IDA7IGJvcmRlcjogMXB4IHNvbGlkIGdyYXk7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1wiPlxuICAgICAgICA8ZGl2IGlkPVwiaW50ZXJmYWNlV2luZG93SFBcIiBzdHlsZT1cIndpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IGJhY2tncm91bmQtY29sb3I6IGdyZWVuO1wiPjwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IHN0eWxlPVwid2lkdGg6IDEwMHB4OyBoZWlnaHQ6IDIwcHg7IG1hcmdpbjogNXB4IDA7IGJvcmRlcjogMXB4IHNvbGlkIGdyYXk7IGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1wiPlxuICAgICAgICA8ZGl2IGlkPVwiaW50ZXJmYWNlV2luZG93U1BcIiBzdHlsZT1cIndpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IGJhY2tncm91bmQtY29sb3I6IGJsdWU7XCI+PC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cblxuICAgIDxzcGFuIGlkPVwiaW50ZXJmYWNlV2luZG93RGF0ZXRpbWVcIj48L3NwYW4+XG4gICAgPHNwYW4gaWQ9XCJpbnRlcmZhY2VXaW5kb3dNYXBcIj48L3NwYW4+XG5cbiAgICA8YnV0dG9uIGlkPVwiaW50ZXJmYWNlV2luZG93VXNlXCIgY2xhc3M9XCJpbnRlcmZhY2VXaW5kb3dCdXR0b25cIj48L2J1dHRvbj5cbiAgICA8YnV0dG9uIGlkPVwiaW50ZXJmYWNlV2luZG93TWVudVwiIGNsYXNzPVwiaW50ZXJmYWNlV2luZG93QnV0dG9uXCI+PC9idXR0b24+XG4gIGA7XG5cbiAgd2luLmNzcyA9IGBcblxuICAgICNpbnRlcmZhY2VXaW5kb3dCYXIge1xuICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgYm90dG9tOiAxMHB4O1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICBoZWlnaHQ6IDYwcHg7XG4gICAgfVxuXG4gICAgLmludGVyZmFjZVdpbmRvdyB7XG4gICAgICAvKiog6K6paW50ZXJmYWNl56qX5Y+j55qE5Li76KaB56qX5Y+j77yM5LiN5o6l5Y+X5LqL5Lu2ICovXG4gICAgICBwb2ludGVyLWV2ZW50czogbm9uZTtcbiAgICB9XG5cbiAgICBidXR0b24uaW50ZXJmYWNlV2luZG93QnV0dG9uIHtcbiAgICAgIG1hcmdpbi1sZWZ0OiAzcHg7XG4gICAgICBtYXJnaW4tcmlnaHQ6IDNweDtcbiAgICAgIHdpZHRoOiA2MHB4O1xuICAgICAgaGVpZ2h0OiA2MHB4O1xuICAgICAgYm9yZGVyOiA0cHggc29saWQgZ3JheTtcbiAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDEwMCwgMTAwLCAxMDAsIDAuNSk7XG4gICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgICAvKiog6K6paW50ZXJmYWNl56qX5Y+j55qE5oyJ6ZKu77yM5o6l5Y+X5LqL5Lu2ICovXG4gICAgICBwb2ludGVyLWV2ZW50czogYXV0bztcbiAgICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7XG4gICAgICBiYWNrZ3JvdW5kLXNpemU6IGNvdmVyO1xuICAgIH1cblxuICAgIGJ1dHRvbi5pbnRlcmZhY2VXaW5kb3dCdXR0b246aG92ZXIge1xuICAgICAgb3BhY2l0eTogMC41O1xuICAgIH1cblxuICAgIGJ1dHRvbi5pbnRlcmZhY2VXaW5kb3dCdXR0b24gPiBpbWcge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgfVxuXG4gICAgI2ludGVyZmFjZVdpbmRvd01hcCB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICB0b3A6IDM1cHg7XG4gICAgICBsZWZ0OiA1cHg7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDEwMCwgMTAwLCAxMDAsIDAuNyk7XG4gICAgICBwYWRkaW5nOiAycHg7XG4gICAgfVxuXG4gICAgI2ludGVyZmFjZVdpbmRvd0RhdGV0aW1lIHtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIHRvcDogMTBweDtcbiAgICAgIGxlZnQ6IDVweDtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMTAwLCAxMDAsIDEwMCwgMC43KTtcbiAgICAgIHBhZGRpbmc6IDJweDtcbiAgICB9XG5cbiAgICBidXR0b24jaW50ZXJmYWNlV2luZG93VXNlIHtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIHRvcDogNXB4O1xuICAgICAgcmlnaHQ6IDg1cHg7XG4gICAgICB2aXNpYmlsaXR5OiBoaWRkZW47XG4gICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoXCJpbWFnZS9oaW50LnBuZ1wiKTtcbiAgICB9XG5cbiAgICBidXR0b24jaW50ZXJmYWNlV2luZG93TWVudSB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICB0b3A6IDVweDtcbiAgICAgIHJpZ2h0OiA1cHg7XG4gICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoXCJpbWFnZS9zZXR0aW5nLnBuZ1wiKTtcbiAgICB9XG5cbiAgICBpbnRlcmZhY2VXaW5kb3dCdXR0b246ZGlzYWJsZWQge1xuICAgICAgY3Vyc29yOiBkZWZhdWx0O1xuICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBncmF5O1xuICAgICAgb3BhY2l0eTogMC41O1xuICAgIH1cblxuICAgIC5pbnRlcmZhY2VXaW5kb3dCdXR0b25UZXh0IHtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1xuICAgICAgbWFyZ2luLWxlZnQ6IC0yNnB4O1xuICAgICAgbWFyZ2luLXRvcDogMTJweDtcbiAgICB9XG4gIGA7XG5cbiAgLy8g5L2/55So5oyJ6ZKuXG4gIGxldCBpbnRlcmZhY2VXaW5kb3dVc2UgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNpbnRlcmZhY2VXaW5kb3dVc2VcIik7XG4gIC8vIOaKgOiDveagj+aMiemSrue7hFxuICBsZXQgaW50ZXJmYWNlV2luZG93QmFyID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJkaXYjaW50ZXJmYWNlV2luZG93QmFyXCIpO1xuICAvLyDlnLDlm77kv6Hmga9cbiAgbGV0IGludGVyZmFjZVdpbmRvd01hcCA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2ludGVyZmFjZVdpbmRvd01hcFwiKTtcbiAgLy8g6YCJ6aG56I+c5Y2VXG4gIGxldCBpbnRlcmZhY2VXaW5kb3dNZW51ID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jaW50ZXJmYWNlV2luZG93TWVudVwiKTtcbiAgLy8g546p5a6255qEaHBcbiAgbGV0IGludGVyZmFjZVdpbmRvd0hQID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjaW50ZXJmYWNlV2luZG93SFBcIik7XG4gIC8vIOeOqeWutueahHNwXG4gIGxldCBpbnRlcmZhY2VXaW5kb3dTUCA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2ludGVyZmFjZVdpbmRvd1NQXCIpO1xuXG4gIHdpbi5hc3NpZ24oXCJoaWRlVXNlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpbnRlcmZhY2VXaW5kb3dVc2Uuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gIH0pO1xuXG4gIHdpbi5hc3NpZ24oXCJzaG93VXNlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpbnRlcmZhY2VXaW5kb3dVc2Uuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICB9KTtcblxuICB3aW4ub24oXCJhY3RpdmVcIiwgZnVuY3Rpb24gKCkge1xuICAgIEdhbWUuc3RhcnQoKTtcbiAgfSk7XG5cbiAgd2luLm9uKFwiZGVhY3RpdmVcIiwgZnVuY3Rpb24gKCkge1xuICAgIEdhbWUucGF1c2UoKTtcbiAgfSlcblxuICB3aW4ud2hlblVwKFtcImVzY1wiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIGlmIChHYW1lLndpbmRvd3MuaW50ZXJmYWNlLmF0b3ApIHtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBpbnRlcmZhY2VXaW5kb3dNZW51LmNsaWNrKCk7XG4gICAgICB9LCAyMCk7XG4gICAgfVxuICB9KTtcblxuICBmdW5jdGlvbiBJbml0SW50ZXJmYWNlQmFyICgpIHtcbiAgICBsZXQgYnV0dG9uQ291bnQgPSA4O1xuICAgIGxldCBidXR0b25IVE1MID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1dHRvbkNvdW50OyBpKyspIHtcbiAgICAgIGxldCBsaW5lID0gXCJcIjtcbiAgICAgIGxpbmUgKz0gYDxidXR0b24gZGF0YS1pbmRleD1cIiR7aX1cIiBjbGFzcz1cImludGVyZmFjZVdpbmRvd0J1dHRvblwiPmA7XG4gICAgICBsaW5lICs9IGA8bGFiZWwgZGF0YS1pbmRleD1cIiR7aX1cIiBjbGFzcz1cImludGVyZmFjZVdpbmRvd0J1dHRvblRleHRcIj48L2xhYmVsPmBcbiAgICAgIGxpbmUgKz0gYDwvYnV0dG9uPlxcbmA7XG4gICAgICBidXR0b25IVE1MICs9IGxpbmU7XG4gICAgfVxuICAgIGludGVyZmFjZVdpbmRvd0Jhci5pbm5lckhUTUwgPSBidXR0b25IVE1MO1xuICB9XG5cbiAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgIGlmIChHYW1lLmhlcm8gJiYgR2FtZS5wYXVzZWQgPT0gZmFsc2UpIHtcbiAgICAgIEdhbWUuaGVyby5kYXRhLnRpbWUrKztcbiAgICAgIEdhbWUud2luZG93cy5pbnRlcmZhY2UuZGF0ZXRpbWUoKTtcbiAgICB9XG4gIH0sIDEwMDApO1xuXG4gIEluaXRJbnRlcmZhY2VCYXIoKTtcbiAgbGV0IGJ1dHRvbnMgPSB3aW4ucXVlcnlTZWxlY3RvckFsbChcIi5pbnRlcmZhY2VXaW5kb3dCdXR0b25cIik7XG4gIGxldCBidXR0b25UZXh0cyA9IHdpbi5xdWVyeVNlbGVjdG9yQWxsKFwiLmludGVyZmFjZVdpbmRvd0J1dHRvblRleHRcIik7XG5cbiAgaW50ZXJmYWNlV2luZG93QmFyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBsZXQgaW5kZXggPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS1pbmRleFwiKTtcbiAgICBpZiAoaW5kZXgpIHtcbiAgICAgIGxldCBlbGVtZW50ID0gR2FtZS5oZXJvLmRhdGEuYmFyW2luZGV4XTtcbiAgICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgIGlmIChlbGVtZW50LnR5cGUgPT0gXCJza2lsbFwiKSB7XG4gICAgICAgICAgbGV0IGNvb2xkb3duID0gR2FtZS5oZXJvLmZpcmUoZWxlbWVudC5pZCk7XG4gICAgICAgICAgaWYgKGNvb2xkb3duKSB7XG4gICAgICAgICAgICBldmVudC50YXJnZXQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSwgY29vbGRvd24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LnR5cGUgPT0gXCJpdGVtXCIpIHtcbiAgICAgICAgICBsZXQgaXRlbUlkID0gZWxlbWVudC5pZDtcbiAgICAgICAgICBsZXQgaXRlbSA9IEdhbWUuaXRlbXNbaXRlbUlkXTtcbiAgICAgICAgICBpdGVtLmhlcm9Vc2UoKTtcbiAgICAgICAgICBHYW1lLndpbmRvd3MuaW50ZXJmYWNlLnJlZnJlc2goKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCIsIFwiNVwiLCBcIjZcIiwgXCI3XCIsIFwiOFwiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIGxldCBudW0gPSBwYXJzZUludChrZXkpO1xuICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG51bSkgJiYgbnVtID49IDAgJiYgbnVtIDwgYnV0dG9ucy5sZW5ndGgpIHtcbiAgICAgIGJ1dHRvbnNbbnVtIC0gMV0uY2xpY2soKTtcbiAgICB9XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1wiZVwiLCBcIkVcIiwgXCJzcGFjZVwiLCBcImVudGVyXCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgaWYgKEdhbWUud2luZG93cy5pbnRlcmZhY2Uuc2hvd2luZykge1xuICAgICAgaWYgKEdhbWUuaGludE9iamVjdCAmJiBHYW1lLmhpbnRPYmplY3QuaGVyb1VzZSkge1xuICAgICAgICBHYW1lLmhpbnRPYmplY3QuaGVyb1VzZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgaW50ZXJmYWNlV2luZG93VXNlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBpZiAoR2FtZS5oaW50T2JqZWN0ICYmIEdhbWUuaGludE9iamVjdC5oZXJvVXNlKSB7XG4gICAgICBHYW1lLmhpbnRPYmplY3QuaGVyb1VzZSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgd2luLmFzc2lnbihcInN0YXR1c1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEdhbWUuaGVybykge1xuICAgICAgbGV0IGhwID0gR2FtZS5oZXJvLmRhdGEuaHAgLyBHYW1lLmhlcm8uZGF0YS4kaHA7XG4gICAgICBsZXQgc3AgPSBHYW1lLmhlcm8uZGF0YS5zcCAvIEdhbWUuaGVyby5kYXRhLiRzcDtcbiAgICAgIGludGVyZmFjZVdpbmRvd0hQLnN0eWxlLndpZHRoID0gYCR7aHAqMTAwfSVgO1xuICAgICAgaW50ZXJmYWNlV2luZG93U1Auc3R5bGUud2lkdGggPSBgJHtzcCoxMDB9JWA7XG4gICAgICBpZiAoaHAgPj0gMC41KSB7XG4gICAgICAgIGludGVyZmFjZVdpbmRvd0hQLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiZ3JlZW5cIjtcbiAgICAgIH0gZWxzZSBpZiAoaHAgPj0gMC4yNSkge1xuICAgICAgICBpbnRlcmZhY2VXaW5kb3dIUC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInllbGxvd1wiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW50ZXJmYWNlV2luZG93SFAuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHdpbi5hc3NpZ24oXCJkYXRldGltZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEdhbWUuaGVybyAmJiBHYW1lLmhlcm8uZGF0YSAmJiBOdW1iZXIuaXNJbnRlZ2VyKEdhbWUuaGVyby5kYXRhLnRpbWUpKSB7XG4gICAgICBsZXQgWUVBUk1JTiA9IDYwKjI0KjMwKjEyO1xuICAgICAgbGV0IE1PTlRITUlOID0gNjAqMjQqMzA7XG4gICAgICBsZXQgREFZTUlOID0gNjAqMjQ7XG4gICAgICBsZXQgSE9VUk1JTiA9IDYwO1xuICAgICAgbGV0IGRhdGV0aW1lID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjaW50ZXJmYWNlV2luZG93RGF0ZXRpbWVcIik7XG4gICAgICBsZXQgdGltZSA9IEdhbWUuaGVyby5kYXRhLnRpbWU7XG4gICAgICBsZXQgeWVhciA9IE1hdGguZmxvb3IodGltZS9ZRUFSTUlOKTtcbiAgICAgIHRpbWUgPSB0aW1lICUgWUVBUk1JTjtcbiAgICAgIGxldCBtb250aCA9IE1hdGguZmxvb3IodGltZS9NT05USE1JTik7XG4gICAgICB0aW1lID0gdGltZSAlIE1PTlRITUlOO1xuICAgICAgbGV0IGRheSA9IE1hdGguZmxvb3IodGltZS9EQVlNSU4pO1xuICAgICAgdGltZSA9IHRpbWUgJSBEQVlNSU47XG4gICAgICBsZXQgaG91ciA9IE1hdGguZmxvb3IodGltZS9IT1VSTUlOKTtcbiAgICAgIHRpbWUgPSB0aW1lICUgSE9VUk1JTjtcbiAgICAgIGxldCBtaW51dGUgPSB0aW1lO1xuICAgICAgeWVhcisrO1xuICAgICAgbW9udGgrKztcbiAgICAgIGRheSsrO1xuICAgICAgaG91ciA9IGhvdXIudG9TdHJpbmcoKTtcbiAgICAgIHdoaWxlIChob3VyLmxlbmd0aCA8IDIpIGhvdXIgPSBcIjBcIitob3VyO1xuICAgICAgbWludXRlID0gbWludXRlLnRvU3RyaW5nKCk7XG4gICAgICB3aGlsZSAobWludXRlLmxlbmd0aCA8IDIpIG1pbnV0ZSA9IFwiMFwiK21pbnV0ZTtcbiAgICAgIGRhdGV0aW1lLnRleHRDb250ZW50ID0gYCR7bW9udGh95pyIJHtkYXl95pelICR7aG91cn06JHttaW51dGV9YDtcblxuICAgICAgdmFyIHR5cGUgPSBHYW1lLmFyZWEubWFwLmRhdGEudHlwZTtcblxuICAgICAgaWYgKHR5cGUgPT0gXCJpbmRvb3JcIikge1xuICAgICAgICAvLyBkbyBub3RoaW5nXG4gICAgICAgIEdhbWUuc3RhZ2UuZmlsdGVyKFwiYnJpZ2h0bmVzc1wiLCAwLjApO1xuICAgICAgfSBlbHNlIGlmICh0eXBlID09IFwib3V0ZG9vclwiKSB7XG4gICAgICAgIC8vIOWupOWkllxuICAgICAgICBpZiAoaG91ciA+PSAyMCB8fCBob3VyIDwgNCkgeyAvLyAyMDowMCB0byA0OjAwXG4gICAgICAgICAgR2FtZS5zdGFnZS5maWx0ZXIoXCJicmlnaHRuZXNzXCIsIC0wLjE1KTtcbiAgICAgICAgfSBlbHNlIGlmIChob3VyID49IDQgJiYgaG91ciA8IDYpIHtcbiAgICAgICAgICBHYW1lLnN0YWdlLmZpbHRlcihcImJyaWdodG5lc3NcIiwgLTAuMSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaG91ciA+PSA2ICYmIGhvdXIgPCA4KSB7XG4gICAgICAgICAgR2FtZS5zdGFnZS5maWx0ZXIoXCJicmlnaHRuZXNzXCIsIC0wLjA1KTtcbiAgICAgICAgfSBlbHNlIGlmIChob3VyID49IDggJiYgaG91ciA8IDEwKSB7XG4gICAgICAgICAgR2FtZS5zdGFnZS5maWx0ZXIoXCJicmlnaHRuZXNzXCIsIDAuMCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaG91ciA+PSAxMCAmJiBob3VyIDwgMTIpIHtcbiAgICAgICAgICBHYW1lLnN0YWdlLmZpbHRlcihcImJyaWdodG5lc3NcIiwgMC4wNSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaG91ciA+PSAxMiAmJiBob3VyIDwgMTQpIHtcbiAgICAgICAgICBHYW1lLnN0YWdlLmZpbHRlcihcImJyaWdodG5lc3NcIiwgMC4wKTtcbiAgICAgICAgfSBlbHNlIGlmIChob3VyID49IDE0ICYmIGhvdXIgPCAxNikge1xuICAgICAgICAgIEdhbWUuc3RhZ2UuZmlsdGVyKFwiYnJpZ2h0bmVzc1wiLCAwLjApO1xuICAgICAgICB9IGVsc2UgaWYgKGhvdXIgPj0gMTYgJiYgaG91ciA8IDE4KSB7XG4gICAgICAgICAgR2FtZS5zdGFnZS5maWx0ZXIoXCJicmlnaHRuZXNzXCIsIC0wLjA1KTtcbiAgICAgICAgfSBlbHNlIGlmIChob3VyID49IDE4ICYmIGhvdXIgPCAyMCkge1xuICAgICAgICAgIEdhbWUuc3RhZ2UuZmlsdGVyKFwiYnJpZ2h0bmVzc1wiLCAtMC4xKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0eXBlID09IFwiY2F2ZVwiKSB7XG4gICAgICAgIC8vIGNhdmVzIGFyZSBkYXJrXG4gICAgICAgIEdhbWUuc3RhZ2UuZmlsdGVyKFwiYnJpZ2h0bmVzc1wiLCAtMC4xNSk7XG4gICAgICB9XG5cbiAgICB9XG4gIH0pO1xuXG4gIHdpbi5hc3NpZ24oXCJyZWZyZXNoXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykge1xuICAgICAgbGV0IGVsZW1lbnQgPSBHYW1lLmhlcm8uZGF0YS5iYXJbaV07XG4gICAgICBsZXQgYnV0dG9uID0gYnV0dG9uc1tpXTtcbiAgICAgIGxldCB0ZXh0ID0gYnV0dG9uVGV4dHNbaV07XG4gICAgICBidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIHRleHQuZGlzYWJsZWQgPSBmYWxzZTtcblxuICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgbGV0IGlkID0gZWxlbWVudC5pZDtcbiAgICAgICAgbGV0IHR5cGUgPSBlbGVtZW50LnR5cGU7XG4gICAgICAgIGlmICh0eXBlID09IFwic2tpbGxcIikge1xuICAgICAgICAgIGxldCBza2lsbCA9IEdhbWUuc2tpbGxzW2lkXTtcbiAgICAgICAgICBidXR0b24uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybChcIiR7c2tpbGwuaWNvbi5zcmN9XCIpYDtcbiAgICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gc2tpbGwuZGF0YS5jb3N0O1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJpdGVtXCIpIHtcbiAgICAgICAgICBsZXQgaXRlbSA9IEdhbWUuaXRlbXNbaWRdO1xuICAgICAgICAgIGJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKFwiJHtpdGVtLmljb24uc3JjfVwiKWA7XG4gICAgICAgICAgaWYgKEdhbWUuaGVyby5kYXRhLml0ZW1zW2lkXSkge1xuICAgICAgICAgICAgdGV4dC50ZXh0Q29udGVudCA9IEdhbWUuaGVyby5kYXRhLml0ZW1zW2lkXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGV4dC50ZXh0Q29udGVudCA9IFwiMFwiO1xuICAgICAgICAgICAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRleHQuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZW1wdHkgYmFyIGVsZW1lbnRcbiAgICAgICAgdGV4dC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgICAgIGJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcIlwiO1xuICAgICAgfVxuICAgIH1cblxuICAgIGludGVyZmFjZVdpbmRvd01hcC50ZXh0Q29udGVudCA9IEdhbWUuYXJlYS5tYXAuZGF0YS5uYW1lO1xuICB9KTtcblxuICBpbnRlcmZhY2VXaW5kb3dNZW51LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBHYW1lLndpbmRvd3Muc3lzbWVudS5zaG93KCk7XG4gIH0pO1xuXG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.inventory = Game.Window.create("inventoryWindow");

  win.html = "\n    <div class=\"window-box\">\n      <div id=\"inventoryWindowItemBar\">\n\n        <button id=\"inventoryWindowClose\" class=\"brownButton\">关闭</button>\n        <button id=\"inventoryWindowStatus\" class=\"brownButton\">状态</button>\n\n        <button id=\"inventoryWindowAll\" class=\"brownButton\">全部</button>\n        <button id=\"inventoryWindowWeapon\" class=\"brownButton\">武器</button>\n        <button id=\"inventoryWindowArmor\" class=\"brownButton\">护甲</button>\n        <button id=\"inventoryWindowPotion\" class=\"brownButton\">药水</button>\n        <button id=\"inventoryWindowMaterial\" class=\"brownButton\">材料</button>\n        <button id=\"inventoryWindowBook\" class=\"brownButton\">书籍</button>\n        <button id=\"inventoryWindowMisc\" class=\"brownButton\">其他</button>\n      </div>\n\n      <span id=\"inventoryWindowGold\"></span>\n\n      <div style=\"overflow: auto; height: 300px;\">\n        <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n          <thead>\n            <tr>\n              <td style=\"width: 40px;\"></td>\n              <td style=\"width: 120px;\"></td>\n              <td style=\"width: 30px;\"></td>\n              <td style=\"width: 30px;\"></td>\n              <td></td>\n              <td style=\"width: 60px;\"></td>\n            </tr>\n          </thead>\n          <tbody id=\"inventoryWindowTable\"></tbody>\n        </table>\n      </div>\n    </div>\n  ";

  win.css = "\n    #inventoryWindowItemBar > button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n      margin-left: 5px;\n      margin-right: 5px;\n      margin-top: 0px;\n      margin-bottom: 5px;\n    }\n\n    #inventoryWindowClose {\n      float: right;\n    }\n\n    #inventoryWindowStatus {\n      float: right;\n    }\n\n    .inventoryWindow table {\n      width: 100%;\n    }\n\n    .inventoryWindow table img {\n      width: 100%;\n      height: 100%;\n    }\n\n    .inventoryWindow table button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n    }\n\n    .inventoryWindow td {\n      border-bottom:1px solid #ccc;\n    }\n\n    .inventoryWindow tr:nth-child(odd) {\n      background-color: #ccc;\n    }\n\n    #inventoryWindowGold {\n      position: absolute;\n      right: 100px;\n      bottom: 30px;\n      font-size: 20px;\n      color: black;\n    }\n  ";

  var inventoryWindowClose = win.querySelector("button#inventoryWindowClose");
  var inventoryWindowStatus = win.querySelector("button#inventoryWindowStatus");

  var inventoryWindowAll = win.querySelector("button#inventoryWindowAll");
  var inventoryWindowWeapon = win.querySelector("button#inventoryWindowWeapon");
  var inventoryWindowArmor = win.querySelector("button#inventoryWindowArmor");
  var inventoryWindowPotion = win.querySelector("button#inventoryWindowPotion");
  var inventoryWindowMaterial = win.querySelector("button#inventoryWindowMaterial");
  var inventoryWindowBook = win.querySelector("button#inventoryWindowBook");
  var inventoryWindowMisc = win.querySelector("button#inventoryWindowMisc");

  var inventoryWindowGold = win.querySelector("span#inventoryWindowGold");
  var inventoryWindowTable = win.querySelector("#inventoryWindowTable");

  inventoryWindowClose.addEventListener("click", function (event) {
    win.hide();
  });

  inventoryWindowStatus.addEventListener("click", function (event) {
    win.hide();
    Game.windows.status.open();
  });

  win.whenUp(["tab"], function () {
    setTimeout(function () {
      win.hide();
      Game.windows.status.open();
    }, 20);
  });

  inventoryWindowAll.addEventListener("click", function (event) {
    win.open();
  });

  inventoryWindowWeapon.addEventListener("click", function (event) {
    win.open("sword|spear|bow");
  });

  inventoryWindowArmor.addEventListener("click", function (event) {
    win.open("head|body|feet");
  });

  inventoryWindowPotion.addEventListener("click", function (event) {
    win.open("potion");
  });

  inventoryWindowMaterial.addEventListener("click", function (event) {
    win.open("material");
  });

  inventoryWindowBook.addEventListener("click", function (event) {
    win.open("book|scroll|letter");
  });

  inventoryWindowMisc.addEventListener("click", function (event) {
    win.open("misc");
  });

  var lastFilter = null;
  var lastSelect = -1;

  win.assign("open", function (filter, select) {

    if (typeof select == "undefined") {
      select = -1;
    }

    lastFilter = filter;
    lastSelect = select;

    var defaultColor = "white";
    var activeColor = "yellow";

    inventoryWindowAll.style.color = defaultColor;
    inventoryWindowWeapon.style.color = defaultColor;
    inventoryWindowArmor.style.color = defaultColor;
    inventoryWindowPotion.style.color = defaultColor;
    inventoryWindowMaterial.style.color = defaultColor;
    inventoryWindowBook.style.color = defaultColor;
    inventoryWindowMisc.style.color = defaultColor;

    if (filter == null) {
      inventoryWindowAll.style.color = activeColor;
    } else if (filter.match(/sword/)) {
      inventoryWindowWeapon.style.color = activeColor;
    } else if (filter.match(/head/)) {
      inventoryWindowArmor.style.color = activeColor;
    } else if (filter.match(/potion/)) {
      inventoryWindowPotion.style.color = activeColor;
    } else if (filter.match(/material/)) {
      inventoryWindowMaterial.style.color = activeColor;
    } else if (filter.match(/book/)) {
      inventoryWindowBook.style.color = activeColor;
    } else if (filter.match(/misc/)) {
      inventoryWindowMisc.style.color = activeColor;
    }

    inventoryWindowGold.textContent = Game.hero.data.gold + "G";

    var table = "";
    var index = 0;
    var ids = Object.keys(Game.hero.data.items);
    ids.sort();
    ids.forEach(function (itemId) {
      var itemCount = Game.hero.data.items[itemId];
      var item = Game.items[itemId];
      var equipment = null;

      Sprite.each(Game.hero.data.equipment, function (element, key) {
        if (element == item.id) equipment = key;
      });

      if (filter && filter.indexOf(item.data.type) == -1) return;

      var line = "";

      if (select == index) {
        line += "<tr style=\"background-color: green;\">\n";
      } else {
        line += "<tr>\n";
      }

      if (item.icon) {
        line += "  <td><img alt=\"\" src=\"" + item.icon.src + "\"></td>\n";
      } else {
        line += "  <td> </td>\n";
      }
      line += "  <td>" + (equipment ? "*" : "") + item.data.name + "</td>\n";
      line += "  <td style=\"text-align: center;\">" + item.data.value + "G</td>\n";
      line += "  <td style=\"text-align: center;\">" + itemCount + "</td>\n";
      line += "  <td>" + item.data.description + "</td>\n";
      line += "  <td><button data-id=\"" + itemId + "\" class=\"brownButton\">操作</button></td>\n";
      line += "</tr>\n";
      table += line;
      index++;
    });

    inventoryWindowTable.innerHTML = table;
    win.show();
  });

  win.whenUp(["enter"], function () {
    var buttons = inventoryWindowTable.querySelectorAll("button");
    if (lastSelect >= 0 && lastSelect < buttons.length) {
      buttons[lastSelect].click();
    }
  });

  win.whenUp(["up", "down"], function (key) {
    var count = inventoryWindowTable.querySelectorAll("button").length;

    if (lastSelect == -1) {
      if (key == "down") {
        win.open(lastFilter, 0);
      } else if (key == "up") {
        win.open(lastFilter, count - 1);
      }
    } else {
      if (key == "down") {
        var select = lastSelect + 1;
        if (select >= count) {
          select = 0;
        }
        win.open(lastFilter, select);
      } else if (key == "up") {
        var select = lastSelect - 1;
        if (select < 0) {
          select = count - 1;
        }
        win.open(lastFilter, select);
      }
    }
  });

  inventoryWindowTable.addEventListener("click", function (event) {
    var itemId = event.target.getAttribute("data-id");
    if (itemId && Game.hero.data.items.hasOwnProperty(itemId)) {
      (function () {
        var item = Game.items[itemId];
        var itemCount = Game.hero.data.items[itemId];
        var equipment = null;

        Sprite.each(Game.hero.data.equipment, function (element, key) {
          if (element == item.id) equipment = key;
        });

        var options = {};
        if (item.data.type.match(/potion/)) {
          options["使用"] = "use";
          options["快捷键"] = "shortcut";
        } else if (item.data.type.match(/sword|spear|bow|head|body|feet|neck|ring/)) {
          if (equipment) options["卸下"] = "takeoff";else options["装备"] = "puton";
        } else if (item.data.type.match(/book/)) {
          options["阅读"] = "read";
        }

        options["丢弃"] = "drop";

        Game.choice(options, function (choice) {
          switch (choice) {
            case "puton":
              var type = item.data.type;
              if (type.match(/sword|spear|bow/)) {
                type = "weapon";
              }
              Game.hero.data.equipment[type] = item.id;
              return win.open(lastFilter);
              break;
            case "takeoff":
              if (item.data.type.match(/sword|spear|bow/)) Game.hero.data.equipment.weapon = null;else Game.hero.data.equipment[item.data.type] = null;
              return win.open(lastFilter);
              break;
            case "use":
              if (item.heroUse) {
                item.heroUse();
              }
              break;
            case "read":
              if (item.heroUse) {
                item.heroUse();
              }
              break;
            case "drop":
              if (equipment) {
                Game.hero.data.equipment[equipment] = null;
              }

              Game.addBag(Game.hero.x, Game.hero.y).then(function (bag) {
                if (bag.inner.hasOwnProperty(itemId)) {
                  bag.inner[itemId] += itemCount;
                } else {
                  bag.inner[itemId] = itemCount;
                }
              });

              delete Game.hero.data.items[itemId];

              Game.hero.data.bar.forEach(function (element, index, array) {
                if (element && element.id == itemId) {
                  array[index] = null;
                }
              });

              Game.windows["interface"].refresh();
              return win.open(lastFilter);
              break;
            case "shortcut":
              Game.choice({
                1: 0,
                2: 1,
                3: 2,
                4: 3,
                5: 4,
                6: 5,
                7: 6,
                8: 7
              }, function (choice) {
                if (Number.isFinite(choice) && choice >= 0) {
                  Game.hero.data.bar[choice] = {
                    id: item.id,
                    type: "item"
                  };
                  Game.windows["interface"].refresh();
                }
              });
              break;
          }
        });
      })();
    }
  });

  win.whenUp(["esc"], function () {
    setTimeout(function () {
      win.hide();
    }, 20);
  });

  win.whenUp(["left", "right"], function (key) {
    if (key == "right") {
      var filter = lastFilter;
      if (filter == null) {
        filter = "sword|spear|bow";
      } else if (filter.match(/sword/)) {
        filter = "head|body|feet";
      } else if (filter.match(/head/)) {
        filter = "potion";
      } else if (filter.match(/potion/)) {
        filter = "material";
      } else if (filter.match(/material/)) {
        filter = "book|scroll|letter";
      } else if (filter.match(/book/)) {
        filter = "misc";
      } else if (filter.match(/misc/)) {
        filter = null;
      }
      win.open(filter, -1);
    } else if (key == "left") {
      var filter = lastFilter;
      if (filter == null) {
        filter = "misc";
      } else if (filter.match(/sword/)) {
        filter = null;
      } else if (filter.match(/head/)) {
        filter = "sword|spear|bow";
      } else if (filter.match(/potion/)) {
        filter = "head|body|feet";
      } else if (filter.match(/material/)) {
        filter = "potion";
      } else if (filter.match(/book/)) {
        filter = "material";
      } else if (filter.match(/misc/)) {
        filter = "book|scroll|letter";
      }
      win.open(filter, -1);
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dJbnZlbnRvcnkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQzs7QUFFekUsS0FBRyxDQUFDLElBQUksbzVDQWtDUCxDQUFDOztBQUVGLEtBQUcsQ0FBQyxHQUFHLHM0QkFpRE4sQ0FBQzs7QUFFRixNQUFJLG9CQUFvQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsNkJBQTZCLENBQUMsQ0FBQztBQUM1RSxNQUFJLHFCQUFxQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsOEJBQThCLENBQUMsQ0FBQzs7QUFFOUUsTUFBSSxrQkFBa0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLDJCQUEyQixDQUFDLENBQUM7QUFDeEUsTUFBSSxxQkFBcUIsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLDhCQUE4QixDQUFDLENBQUM7QUFDOUUsTUFBSSxvQkFBb0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLDZCQUE2QixDQUFDLENBQUM7QUFDNUUsTUFBSSxxQkFBcUIsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLDhCQUE4QixDQUFDLENBQUM7QUFDOUUsTUFBSSx1QkFBdUIsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7QUFDbEYsTUFBSSxtQkFBbUIsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFDMUUsTUFBSSxtQkFBbUIsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLDRCQUE0QixDQUFDLENBQUM7O0FBRTFFLE1BQUksbUJBQW1CLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ3hFLE1BQUksb0JBQW9CLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDOztBQUV0RSxzQkFBb0IsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDOUQsT0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0dBQ1osQ0FBQyxDQUFDOztBQUVILHVCQUFxQixDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUMvRCxPQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWCxRQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztHQUM1QixDQUFDLENBQUM7O0FBRUgsS0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLFlBQVk7QUFDOUIsY0FBVSxDQUFDLFlBQVk7QUFDckIsU0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ1gsVUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7S0FDNUIsRUFBRSxFQUFFLENBQUMsQ0FBQztHQUNSLENBQUMsQ0FBQzs7QUFFSCxvQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDNUQsT0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0dBQ1osQ0FBQyxDQUFDOztBQUVILHVCQUFxQixDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUMvRCxPQUFHLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7R0FDN0IsQ0FBQyxDQUFDOztBQUVILHNCQUFvQixDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUM5RCxPQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7R0FDNUIsQ0FBQyxDQUFDOztBQUVILHVCQUFxQixDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUMvRCxPQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0dBQ3BCLENBQUMsQ0FBQzs7QUFFSCx5QkFBdUIsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDakUsT0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztHQUN0QixDQUFDLENBQUM7O0FBRUgscUJBQW1CLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVUsS0FBSyxFQUFFO0FBQzdELE9BQUcsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztHQUNoQyxDQUFDLENBQUM7O0FBRUgscUJBQW1CLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVUsS0FBSyxFQUFFO0FBQzdELE9BQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7R0FDbEIsQ0FBQyxDQUFDOztBQUVILE1BQUksVUFBVSxHQUFHLElBQUksQ0FBQztBQUN0QixNQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQzs7QUFFcEIsS0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsVUFBVSxNQUFNLEVBQUUsTUFBTSxFQUFFOztBQUUzQyxRQUFJLE9BQU8sTUFBTSxJQUFJLFdBQVcsRUFBRTtBQUNoQyxZQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDYjs7QUFFRCxjQUFVLEdBQUcsTUFBTSxDQUFDO0FBQ3BCLGNBQVUsR0FBRyxNQUFNLENBQUM7O0FBRXBCLFFBQUksWUFBWSxHQUFHLE9BQU8sQ0FBQztBQUMzQixRQUFJLFdBQVcsR0FBRyxRQUFRLENBQUM7O0FBRTNCLHNCQUFrQixDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDO0FBQzlDLHlCQUFxQixDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDO0FBQ2pELHdCQUFvQixDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDO0FBQ2hELHlCQUFxQixDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDO0FBQ2pELDJCQUF1QixDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDO0FBQ25ELHVCQUFtQixDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDO0FBQy9DLHVCQUFtQixDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDOztBQUUvQyxRQUFJLE1BQU0sSUFBSSxJQUFJLEVBQUU7QUFDbEIsd0JBQWtCLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxXQUFXLENBQUM7S0FDOUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUU7QUFDaEMsMkJBQXFCLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxXQUFXLENBQUM7S0FDakQsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7QUFDL0IsMEJBQW9CLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxXQUFXLENBQUM7S0FDaEQsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUU7QUFDakMsMkJBQXFCLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxXQUFXLENBQUM7S0FDakQsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEVBQUU7QUFDbkMsNkJBQXVCLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxXQUFXLENBQUM7S0FDbkQsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7QUFDL0IseUJBQW1CLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxXQUFXLENBQUM7S0FDL0MsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7QUFDL0IseUJBQW1CLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxXQUFXLENBQUM7S0FDL0M7O0FBRUQsdUJBQW1CLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7O0FBRTVELFFBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztBQUNmLFFBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztBQUNkLFFBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDNUMsT0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ1gsT0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFVLE1BQU0sRUFBRTtBQUM1QixVQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDN0MsVUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUM5QixVQUFJLFNBQVMsR0FBRyxJQUFJLENBQUM7O0FBRXJCLFlBQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQVUsT0FBTyxFQUFFLEdBQUcsRUFBRTtBQUM1RCxZQUFJLE9BQU8sSUFBSSxJQUFJLENBQUMsRUFBRSxFQUNwQixTQUFTLEdBQUcsR0FBRyxDQUFDO09BQ25CLENBQUMsQ0FBQzs7QUFFSCxVQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQ2hELE9BQU87O0FBRVQsVUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDOztBQUVkLFVBQUksTUFBTSxJQUFJLEtBQUssRUFBRTtBQUNuQixZQUFJLCtDQUE2QyxDQUFDO09BQ25ELE1BQU07QUFDTCxZQUFJLFlBQVksQ0FBQztPQUNsQjs7QUFFRCxVQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7QUFDYixZQUFJLG1DQUE4QixJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsZUFBVyxDQUFDO09BQzVELE1BQU07QUFDTCxZQUFJLG9CQUFvQixDQUFDO09BQzFCO0FBQ0QsVUFBSSxnQkFBYSxTQUFTLEdBQUMsR0FBRyxHQUFDLEVBQUUsQ0FBQSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxZQUFTLENBQUM7QUFDNUQsVUFBSSw2Q0FBeUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLGFBQVUsQ0FBQztBQUN2RSxVQUFJLDZDQUF5QyxTQUFTLFlBQVMsQ0FBQztBQUNoRSxVQUFJLGVBQWEsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLFlBQVMsQ0FBQztBQUNoRCxVQUFJLGlDQUE4QixNQUFNLGdEQUEwQyxDQUFDO0FBQ25GLFVBQUksSUFBSSxTQUFTLENBQUM7QUFDbEIsV0FBSyxJQUFJLElBQUksQ0FBQztBQUNkLFdBQUssRUFBRSxDQUFDO0tBQ1QsQ0FBQyxDQUFDOztBQUVILHdCQUFvQixDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7QUFDdkMsT0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0dBQ1osQ0FBQyxDQUFDOztBQUVILEtBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxZQUFZO0FBQ2hDLFFBQUksT0FBTyxHQUFHLG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzlELFFBQUksVUFBVSxJQUFJLENBQUMsSUFBSSxVQUFVLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRTtBQUNsRCxhQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7S0FDN0I7R0FDRixDQUFDLENBQUM7O0FBRUgsS0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsRUFBRSxVQUFVLEdBQUcsRUFBRTtBQUN4QyxRQUFJLEtBQUssR0FBRyxvQkFBb0IsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUM7O0FBRW5FLFFBQUksVUFBVSxJQUFJLENBQUMsQ0FBQyxFQUFFO0FBQ3BCLFVBQUksR0FBRyxJQUFJLE1BQU0sRUFBRTtBQUNqQixXQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztPQUN6QixNQUFNLElBQUksR0FBRyxJQUFJLElBQUksRUFBRTtBQUN0QixXQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7T0FDakM7S0FDRixNQUFNO0FBQ0wsVUFBSSxHQUFHLElBQUksTUFBTSxFQUFFO0FBQ2pCLFlBQUksTUFBTSxHQUFHLFVBQVUsR0FBRyxDQUFDLENBQUM7QUFDNUIsWUFBSSxNQUFNLElBQUksS0FBSyxFQUFFO0FBQ25CLGdCQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQ1o7QUFDRCxXQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztPQUM5QixNQUFNLElBQUksR0FBRyxJQUFJLElBQUksRUFBRTtBQUN0QixZQUFJLE1BQU0sR0FBRyxVQUFVLEdBQUcsQ0FBQyxDQUFDO0FBQzVCLFlBQUksTUFBTSxHQUFHLENBQUMsRUFBRTtBQUNkLGdCQUFNLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQztTQUNwQjtBQUNELFdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO09BQzlCO0tBQ0Y7R0FDRixDQUFDLENBQUM7O0FBRUgsc0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVUsS0FBSyxFQUFFO0FBQzlELFFBQUksTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2xELFFBQUksTUFBTSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLEVBQUU7O0FBQ3pELFlBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDOUIsWUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzdDLFlBQUksU0FBUyxHQUFHLElBQUksQ0FBQzs7QUFFckIsY0FBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsVUFBVSxPQUFPLEVBQUUsR0FBRyxFQUFFO0FBQzVELGNBQUksT0FBTyxJQUFJLElBQUksQ0FBQyxFQUFFLEVBQ3BCLFNBQVMsR0FBRyxHQUFHLENBQUM7U0FDbkIsQ0FBQyxDQUFDOztBQUVILFlBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztBQUNqQixZQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRTtBQUNsQyxpQkFBTyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztBQUN0QixpQkFBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLFVBQVUsQ0FBQztTQUM3QixNQUFNLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLDBDQUEwQyxDQUFDLEVBQUU7QUFDM0UsY0FBSSxTQUFTLEVBQ1gsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLFNBQVMsQ0FBQyxLQUUxQixPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDO1NBQzNCLE1BQU0sSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7QUFDdkMsaUJBQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUM7U0FDeEI7O0FBRUQsZUFBTyxDQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQzs7QUFFdkIsWUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsVUFBVSxNQUFNLEVBQUU7QUFDckMsa0JBQVEsTUFBTTtBQUNaLGlCQUFLLE9BQU87QUFDVixrQkFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7QUFDMUIsa0JBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFO0FBQ2pDLG9CQUFJLEdBQUcsUUFBUSxDQUFDO2VBQ2pCO0FBQ0Qsa0JBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO0FBQ3pDLHFCQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDNUIsb0JBQU07QUFBQSxBQUNSLGlCQUFLLFNBQVM7QUFDWixrQkFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsRUFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FFdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO0FBQ2xELHFCQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDNUIsb0JBQU07QUFBQSxBQUNSLGlCQUFLLEtBQUs7QUFDUixrQkFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO0FBQ2hCLG9CQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7ZUFDaEI7QUFDRCxvQkFBTTtBQUFBLEFBQ1IsaUJBQUssTUFBTTtBQUNULGtCQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7QUFDaEIsb0JBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztlQUNoQjtBQUNELG9CQUFNO0FBQUEsQUFDUixpQkFBSyxNQUFNO0FBQ1Qsa0JBQUksU0FBUyxFQUFFO0FBQ2Isb0JBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUM7ZUFDNUM7O0FBRUQsa0JBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxHQUFHLEVBQUs7QUFDbEQsb0JBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLEVBQUU7QUFDcEMscUJBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksU0FBUyxDQUFDO2lCQUNoQyxNQUFNO0FBQ0wscUJBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsU0FBUyxDQUFDO2lCQUMvQjtlQUNGLENBQUMsQ0FBQzs7QUFFSCxxQkFBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7O0FBRXBDLGtCQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7QUFDMUQsb0JBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxFQUFFLElBQUksTUFBTSxFQUFFO0FBQ25DLHVCQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDO2lCQUNyQjtlQUNGLENBQUMsQ0FBQzs7QUFFSCxrQkFBSSxDQUFDLE9BQU8sYUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ2pDLHFCQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDNUIsb0JBQU07QUFBQSxBQUNSLGlCQUFLLFVBQVU7QUFDYixrQkFBSSxDQUFDLE1BQU0sQ0FBQztBQUNWLGlCQUFDLEVBQUMsQ0FBQztBQUNILGlCQUFDLEVBQUMsQ0FBQztBQUNILGlCQUFDLEVBQUMsQ0FBQztBQUNILGlCQUFDLEVBQUMsQ0FBQztBQUNILGlCQUFDLEVBQUMsQ0FBQztBQUNILGlCQUFDLEVBQUMsQ0FBQztBQUNILGlCQUFDLEVBQUMsQ0FBQztBQUNILGlCQUFDLEVBQUMsQ0FBQztlQUNKLEVBQUUsVUFBVSxNQUFNLEVBQUU7QUFDbkIsb0JBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxNQUFNLElBQUksQ0FBQyxFQUFFO0FBQzFDLHNCQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUc7QUFDM0Isc0JBQUUsRUFBRSxJQUFJLENBQUMsRUFBRTtBQUNYLHdCQUFJLEVBQUUsTUFBTTttQkFDYixDQUFDO0FBQ0Ysc0JBQUksQ0FBQyxPQUFPLGFBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztpQkFDbEM7ZUFDRixDQUFDLENBQUM7QUFDSCxvQkFBTTtBQUFBLFdBQ1Q7U0FDRixDQUFDLENBQUM7O0tBRUo7R0FDRixDQUFDLENBQUM7O0FBRUgsS0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLFlBQVk7QUFDOUIsY0FBVSxDQUFDLFlBQVk7QUFDckIsU0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0tBQ1osRUFBRSxFQUFFLENBQUMsQ0FBQztHQUNSLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxFQUFFLFVBQVUsR0FBRyxFQUFFO0FBQzNDLFFBQUksR0FBRyxJQUFJLE9BQU8sRUFBRTtBQUNsQixVQUFJLE1BQU0sR0FBRyxVQUFVLENBQUM7QUFDeEIsVUFBSSxNQUFNLElBQUksSUFBSSxFQUFFO0FBQ2xCLGNBQU0sR0FBRyxpQkFBaUIsQ0FBQztPQUM1QixNQUFNLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBRTtBQUNoQyxjQUFNLEdBQUcsZ0JBQWdCLENBQUM7T0FDM0IsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7QUFDL0IsY0FBTSxHQUFHLFFBQVEsQ0FBQztPQUNuQixNQUFNLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRTtBQUNqQyxjQUFNLEdBQUcsVUFBVSxDQUFDO09BQ3JCLE1BQU0sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFO0FBQ25DLGNBQU0sR0FBRyxvQkFBb0IsQ0FBQztPQUMvQixNQUFNLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRTtBQUMvQixjQUFNLEdBQUcsTUFBTSxDQUFDO09BQ2pCLE1BQU0sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFO0FBQy9CLGNBQU0sR0FBRyxJQUFJLENBQUM7T0FDZjtBQUNELFNBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDdEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxNQUFNLEVBQUU7QUFDeEIsVUFBSSxNQUFNLEdBQUcsVUFBVSxDQUFDO0FBQ3hCLFVBQUksTUFBTSxJQUFJLElBQUksRUFBRTtBQUNsQixjQUFNLEdBQUcsTUFBTSxDQUFDO09BQ2pCLE1BQU0sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFFO0FBQ2hDLGNBQU0sR0FBRyxJQUFJLENBQUM7T0FDZixNQUFNLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRTtBQUMvQixjQUFNLEdBQUcsaUJBQWlCLENBQUM7T0FDNUIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUU7QUFDakMsY0FBTSxHQUFHLGdCQUFnQixDQUFDO09BQzNCLE1BQU0sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFO0FBQ25DLGNBQU0sR0FBRyxRQUFRLENBQUM7T0FDbkIsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7QUFDL0IsY0FBTSxHQUFHLFVBQVUsQ0FBQztPQUNyQixNQUFNLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRTtBQUMvQixjQUFNLEdBQUcsb0JBQW9CLENBQUM7T0FDL0I7QUFDRCxTQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3RCO0dBQ0YsQ0FBQyxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiR2FtZVdpbmRvd0ludmVudG9yeS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCB3aW4gPSBHYW1lLndpbmRvd3MuaW52ZW50b3J5ID0gR2FtZS5XaW5kb3cuY3JlYXRlKFwiaW52ZW50b3J5V2luZG93XCIpO1xuXG4gIHdpbi5odG1sID0gYFxuICAgIDxkaXYgY2xhc3M9XCJ3aW5kb3ctYm94XCI+XG4gICAgICA8ZGl2IGlkPVwiaW52ZW50b3J5V2luZG93SXRlbUJhclwiPlxuXG4gICAgICAgIDxidXR0b24gaWQ9XCJpbnZlbnRvcnlXaW5kb3dDbG9zZVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7lhbPpl608L2J1dHRvbj5cbiAgICAgICAgPGJ1dHRvbiBpZD1cImludmVudG9yeVdpbmRvd1N0YXR1c1wiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7nirbmgIE8L2J1dHRvbj5cblxuICAgICAgICA8YnV0dG9uIGlkPVwiaW52ZW50b3J5V2luZG93QWxsXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuWFqOmDqDwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGlkPVwiaW52ZW50b3J5V2luZG93V2VhcG9uXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuatpuWZqDwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGlkPVwiaW52ZW50b3J5V2luZG93QXJtb3JcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5oqk55SyPC9idXR0b24+XG4gICAgICAgIDxidXR0b24gaWQ9XCJpbnZlbnRvcnlXaW5kb3dQb3Rpb25cIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+6I2v5rC0PC9idXR0b24+XG4gICAgICAgIDxidXR0b24gaWQ9XCJpbnZlbnRvcnlXaW5kb3dNYXRlcmlhbFwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7mnZDmlpk8L2J1dHRvbj5cbiAgICAgICAgPGJ1dHRvbiBpZD1cImludmVudG9yeVdpbmRvd0Jvb2tcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5Lmm57GNPC9idXR0b24+XG4gICAgICAgIDxidXR0b24gaWQ9XCJpbnZlbnRvcnlXaW5kb3dNaXNjXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuWFtuS7ljwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxzcGFuIGlkPVwiaW52ZW50b3J5V2luZG93R29sZFwiPjwvc3Bhbj5cblxuICAgICAgPGRpdiBzdHlsZT1cIm92ZXJmbG93OiBhdXRvOyBoZWlnaHQ6IDMwMHB4O1wiPlxuICAgICAgICA8dGFibGUgYm9yZGVyPVwiMFwiIGNlbGxzcGFjaW5nPVwiMFwiIGNlbGxwYWRkaW5nPVwiMFwiPlxuICAgICAgICAgIDx0aGVhZD5cbiAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAgPHRkIHN0eWxlPVwid2lkdGg6IDQwcHg7XCI+PC90ZD5cbiAgICAgICAgICAgICAgPHRkIHN0eWxlPVwid2lkdGg6IDEyMHB4O1wiPjwvdGQ+XG4gICAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiAzMHB4O1wiPjwvdGQ+XG4gICAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiAzMHB4O1wiPjwvdGQ+XG4gICAgICAgICAgICAgIDx0ZD48L3RkPlxuICAgICAgICAgICAgICA8dGQgc3R5bGU9XCJ3aWR0aDogNjBweDtcIj48L3RkPlxuICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICA8L3RoZWFkPlxuICAgICAgICAgIDx0Ym9keSBpZD1cImludmVudG9yeVdpbmRvd1RhYmxlXCI+PC90Ym9keT5cbiAgICAgICAgPC90YWJsZT5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICBgO1xuXG4gIHdpbi5jc3MgPSBgXG4gICAgI2ludmVudG9yeVdpbmRvd0l0ZW1CYXIgPiBidXR0b24ge1xuICAgICAgd2lkdGg6IDYwcHg7XG4gICAgICBoZWlnaHQ6IDQwcHg7XG4gICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgICBtYXJnaW4tbGVmdDogNXB4O1xuICAgICAgbWFyZ2luLXJpZ2h0OiA1cHg7XG4gICAgICBtYXJnaW4tdG9wOiAwcHg7XG4gICAgICBtYXJnaW4tYm90dG9tOiA1cHg7XG4gICAgfVxuXG4gICAgI2ludmVudG9yeVdpbmRvd0Nsb3NlIHtcbiAgICAgIGZsb2F0OiByaWdodDtcbiAgICB9XG5cbiAgICAjaW52ZW50b3J5V2luZG93U3RhdHVzIHtcbiAgICAgIGZsb2F0OiByaWdodDtcbiAgICB9XG5cbiAgICAuaW52ZW50b3J5V2luZG93IHRhYmxlIHtcbiAgICAgIHdpZHRoOiAxMDAlO1xuICAgIH1cblxuICAgIC5pbnZlbnRvcnlXaW5kb3cgdGFibGUgaW1nIHtcbiAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgIH1cblxuICAgIC5pbnZlbnRvcnlXaW5kb3cgdGFibGUgYnV0dG9uIHtcbiAgICAgIHdpZHRoOiA2MHB4O1xuICAgICAgaGVpZ2h0OiA0MHB4O1xuICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgIH1cblxuICAgIC5pbnZlbnRvcnlXaW5kb3cgdGQge1xuICAgICAgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI2NjYztcbiAgICB9XG5cbiAgICAuaW52ZW50b3J5V2luZG93IHRyOm50aC1jaGlsZChvZGQpIHtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNjY2M7XG4gICAgfVxuXG4gICAgI2ludmVudG9yeVdpbmRvd0dvbGQge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgcmlnaHQ6IDEwMHB4O1xuICAgICAgYm90dG9tOiAzMHB4O1xuICAgICAgZm9udC1zaXplOiAyMHB4O1xuICAgICAgY29sb3I6IGJsYWNrO1xuICAgIH1cbiAgYDtcblxuICBsZXQgaW52ZW50b3J5V2luZG93Q2xvc2UgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNpbnZlbnRvcnlXaW5kb3dDbG9zZVwiKTtcbiAgbGV0IGludmVudG9yeVdpbmRvd1N0YXR1cyA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI2ludmVudG9yeVdpbmRvd1N0YXR1c1wiKTtcblxuICBsZXQgaW52ZW50b3J5V2luZG93QWxsID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jaW52ZW50b3J5V2luZG93QWxsXCIpO1xuICBsZXQgaW52ZW50b3J5V2luZG93V2VhcG9uID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jaW52ZW50b3J5V2luZG93V2VhcG9uXCIpO1xuICBsZXQgaW52ZW50b3J5V2luZG93QXJtb3IgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNpbnZlbnRvcnlXaW5kb3dBcm1vclwiKTtcbiAgbGV0IGludmVudG9yeVdpbmRvd1BvdGlvbiA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI2ludmVudG9yeVdpbmRvd1BvdGlvblwiKTtcbiAgbGV0IGludmVudG9yeVdpbmRvd01hdGVyaWFsID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jaW52ZW50b3J5V2luZG93TWF0ZXJpYWxcIik7XG4gIGxldCBpbnZlbnRvcnlXaW5kb3dCb29rID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jaW52ZW50b3J5V2luZG93Qm9va1wiKTtcbiAgbGV0IGludmVudG9yeVdpbmRvd01pc2MgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNpbnZlbnRvcnlXaW5kb3dNaXNjXCIpO1xuXG4gIGxldCBpbnZlbnRvcnlXaW5kb3dHb2xkID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuI2ludmVudG9yeVdpbmRvd0dvbGRcIik7XG4gIGxldCBpbnZlbnRvcnlXaW5kb3dUYWJsZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2ludmVudG9yeVdpbmRvd1RhYmxlXCIpO1xuXG4gIGludmVudG9yeVdpbmRvd0Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4uaGlkZSgpO1xuICB9KTtcblxuICBpbnZlbnRvcnlXaW5kb3dTdGF0dXMuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5oaWRlKCk7XG4gICAgR2FtZS53aW5kb3dzLnN0YXR1cy5vcGVuKCk7XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1widGFiXCJdLCBmdW5jdGlvbiAoKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICB3aW4uaGlkZSgpO1xuICAgICAgR2FtZS53aW5kb3dzLnN0YXR1cy5vcGVuKCk7XG4gICAgfSwgMjApO1xuICB9KTtcblxuICBpbnZlbnRvcnlXaW5kb3dBbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5vcGVuKCk7XG4gIH0pO1xuXG4gIGludmVudG9yeVdpbmRvd1dlYXBvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4oXCJzd29yZHxzcGVhcnxib3dcIik7XG4gIH0pO1xuXG4gIGludmVudG9yeVdpbmRvd0FybW9yLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4ub3BlbihcImhlYWR8Ym9keXxmZWV0XCIpO1xuICB9KTtcblxuICBpbnZlbnRvcnlXaW5kb3dQb3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5vcGVuKFwicG90aW9uXCIpO1xuICB9KTtcblxuICBpbnZlbnRvcnlXaW5kb3dNYXRlcmlhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4oXCJtYXRlcmlhbFwiKTtcbiAgfSk7XG5cbiAgaW52ZW50b3J5V2luZG93Qm9vay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4oXCJib29rfHNjcm9sbHxsZXR0ZXJcIik7XG4gIH0pO1xuXG4gIGludmVudG9yeVdpbmRvd01pc2MuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5vcGVuKFwibWlzY1wiKTtcbiAgfSk7XG5cbiAgbGV0IGxhc3RGaWx0ZXIgPSBudWxsO1xuICBsZXQgbGFzdFNlbGVjdCA9IC0xO1xuXG4gIHdpbi5hc3NpZ24oXCJvcGVuXCIsIGZ1bmN0aW9uIChmaWx0ZXIsIHNlbGVjdCkge1xuXG4gICAgaWYgKHR5cGVvZiBzZWxlY3QgPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgc2VsZWN0ID0gLTE7XG4gICAgfVxuXG4gICAgbGFzdEZpbHRlciA9IGZpbHRlcjtcbiAgICBsYXN0U2VsZWN0ID0gc2VsZWN0O1xuXG4gICAgbGV0IGRlZmF1bHRDb2xvciA9IFwid2hpdGVcIjtcbiAgICBsZXQgYWN0aXZlQ29sb3IgPSBcInllbGxvd1wiO1xuXG4gICAgaW52ZW50b3J5V2luZG93QWxsLnN0eWxlLmNvbG9yID0gZGVmYXVsdENvbG9yO1xuICAgIGludmVudG9yeVdpbmRvd1dlYXBvbi5zdHlsZS5jb2xvciA9IGRlZmF1bHRDb2xvcjtcbiAgICBpbnZlbnRvcnlXaW5kb3dBcm1vci5zdHlsZS5jb2xvciA9IGRlZmF1bHRDb2xvcjtcbiAgICBpbnZlbnRvcnlXaW5kb3dQb3Rpb24uc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgaW52ZW50b3J5V2luZG93TWF0ZXJpYWwuc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgaW52ZW50b3J5V2luZG93Qm9vay5zdHlsZS5jb2xvciA9IGRlZmF1bHRDb2xvcjtcbiAgICBpbnZlbnRvcnlXaW5kb3dNaXNjLnN0eWxlLmNvbG9yID0gZGVmYXVsdENvbG9yO1xuXG4gICAgaWYgKGZpbHRlciA9PSBudWxsKSB7XG4gICAgICBpbnZlbnRvcnlXaW5kb3dBbGwuc3R5bGUuY29sb3IgPSBhY3RpdmVDb2xvcjtcbiAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvc3dvcmQvKSkge1xuICAgICAgaW52ZW50b3J5V2luZG93V2VhcG9uLnN0eWxlLmNvbG9yID0gYWN0aXZlQ29sb3I7XG4gICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL2hlYWQvKSkge1xuICAgICAgaW52ZW50b3J5V2luZG93QXJtb3Iuc3R5bGUuY29sb3IgPSBhY3RpdmVDb2xvcjtcbiAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvcG90aW9uLykpIHtcbiAgICAgIGludmVudG9yeVdpbmRvd1BvdGlvbi5zdHlsZS5jb2xvciA9IGFjdGl2ZUNvbG9yO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9tYXRlcmlhbC8pKSB7XG4gICAgICBpbnZlbnRvcnlXaW5kb3dNYXRlcmlhbC5zdHlsZS5jb2xvciA9IGFjdGl2ZUNvbG9yO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9ib29rLykpIHtcbiAgICAgIGludmVudG9yeVdpbmRvd0Jvb2suc3R5bGUuY29sb3IgPSBhY3RpdmVDb2xvcjtcbiAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvbWlzYy8pKSB7XG4gICAgICBpbnZlbnRvcnlXaW5kb3dNaXNjLnN0eWxlLmNvbG9yID0gYWN0aXZlQ29sb3I7XG4gICAgfVxuXG4gICAgaW52ZW50b3J5V2luZG93R29sZC50ZXh0Q29udGVudCA9IEdhbWUuaGVyby5kYXRhLmdvbGQgKyBcIkdcIjtcblxuICAgIGxldCB0YWJsZSA9IFwiXCI7XG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICBsZXQgaWRzID0gT2JqZWN0LmtleXMoR2FtZS5oZXJvLmRhdGEuaXRlbXMpO1xuICAgIGlkcy5zb3J0KCk7XG4gICAgaWRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW1JZCkge1xuICAgICAgbGV0IGl0ZW1Db3VudCA9IEdhbWUuaGVyby5kYXRhLml0ZW1zW2l0ZW1JZF07XG4gICAgICBsZXQgaXRlbSA9IEdhbWUuaXRlbXNbaXRlbUlkXTtcbiAgICAgIGxldCBlcXVpcG1lbnQgPSBudWxsO1xuXG4gICAgICBTcHJpdGUuZWFjaChHYW1lLmhlcm8uZGF0YS5lcXVpcG1lbnQsIGZ1bmN0aW9uIChlbGVtZW50LCBrZXkpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQgPT0gaXRlbS5pZClcbiAgICAgICAgICBlcXVpcG1lbnQgPSBrZXk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKGZpbHRlciAmJiBmaWx0ZXIuaW5kZXhPZihpdGVtLmRhdGEudHlwZSkgPT0gLTEpXG4gICAgICAgIHJldHVybjtcblxuICAgICAgbGV0IGxpbmUgPSBcIlwiO1xuXG4gICAgICBpZiAoc2VsZWN0ID09IGluZGV4KSB7XG4gICAgICAgIGxpbmUgKz0gYDx0ciBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IGdyZWVuO1wiPlxcbmA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsaW5lICs9IGA8dHI+XFxuYDtcbiAgICAgIH1cblxuICAgICAgaWYgKGl0ZW0uaWNvbikge1xuICAgICAgICBsaW5lICs9IGAgIDx0ZD48aW1nIGFsdD1cIlwiIHNyYz1cIiR7aXRlbS5pY29uLnNyY31cIj48L3RkPlxcbmA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsaW5lICs9IGAgIDx0ZD4gPC90ZD5cXG5gO1xuICAgICAgfVxuICAgICAgbGluZSArPSBgICA8dGQ+JHtlcXVpcG1lbnQ/XCIqXCI6XCJcIn0ke2l0ZW0uZGF0YS5uYW1lfTwvdGQ+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPHRkIHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyO1wiPiR7aXRlbS5kYXRhLnZhbHVlfUc8L3RkPlxcbmA7XG4gICAgICBsaW5lICs9IGAgIDx0ZCBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjtcIj4ke2l0ZW1Db3VudH08L3RkPlxcbmA7XG4gICAgICBsaW5lICs9IGAgIDx0ZD4ke2l0ZW0uZGF0YS5kZXNjcmlwdGlvbn08L3RkPlxcbmA7XG4gICAgICBsaW5lICs9IGAgIDx0ZD48YnV0dG9uIGRhdGEtaWQ9XCIke2l0ZW1JZH1cIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5pON5L2cPC9idXR0b24+PC90ZD5cXG5gO1xuICAgICAgbGluZSArPSBcIjwvdHI+XFxuXCI7XG4gICAgICB0YWJsZSArPSBsaW5lO1xuICAgICAgaW5kZXgrKztcbiAgICB9KTtcblxuICAgIGludmVudG9yeVdpbmRvd1RhYmxlLmlubmVySFRNTCA9IHRhYmxlO1xuICAgIHdpbi5zaG93KCk7XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1wiZW50ZXJcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgYnV0dG9ucyA9IGludmVudG9yeVdpbmRvd1RhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b25cIik7XG4gICAgaWYgKGxhc3RTZWxlY3QgPj0gMCAmJiBsYXN0U2VsZWN0IDwgYnV0dG9ucy5sZW5ndGgpIHtcbiAgICAgIGJ1dHRvbnNbbGFzdFNlbGVjdF0uY2xpY2soKTtcbiAgICB9XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1widXBcIiwgXCJkb3duXCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgbGV0IGNvdW50ID0gaW52ZW50b3J5V2luZG93VGFibGUucXVlcnlTZWxlY3RvckFsbChcImJ1dHRvblwiKS5sZW5ndGg7XG5cbiAgICBpZiAobGFzdFNlbGVjdCA9PSAtMSkge1xuICAgICAgaWYgKGtleSA9PSBcImRvd25cIikge1xuICAgICAgICB3aW4ub3BlbihsYXN0RmlsdGVyLCAwKTtcbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09IFwidXBcIikge1xuICAgICAgICB3aW4ub3BlbihsYXN0RmlsdGVyLCBjb3VudCAtIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoa2V5ID09IFwiZG93blwiKSB7XG4gICAgICAgIGxldCBzZWxlY3QgPSBsYXN0U2VsZWN0ICsgMTtcbiAgICAgICAgaWYgKHNlbGVjdCA+PSBjb3VudCkge1xuICAgICAgICAgIHNlbGVjdCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgd2luLm9wZW4obGFzdEZpbHRlciwgc2VsZWN0KTtcbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09IFwidXBcIikge1xuICAgICAgICBsZXQgc2VsZWN0ID0gbGFzdFNlbGVjdCAtIDE7XG4gICAgICAgIGlmIChzZWxlY3QgPCAwKSB7XG4gICAgICAgICAgc2VsZWN0ID0gY291bnQgLSAxO1xuICAgICAgICB9XG4gICAgICAgIHdpbi5vcGVuKGxhc3RGaWx0ZXIsIHNlbGVjdCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBpbnZlbnRvcnlXaW5kb3dUYWJsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgbGV0IGl0ZW1JZCA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIpO1xuICAgIGlmIChpdGVtSWQgJiYgR2FtZS5oZXJvLmRhdGEuaXRlbXMuaGFzT3duUHJvcGVydHkoaXRlbUlkKSkge1xuICAgICAgbGV0IGl0ZW0gPSBHYW1lLml0ZW1zW2l0ZW1JZF07XG4gICAgICBsZXQgaXRlbUNvdW50ID0gR2FtZS5oZXJvLmRhdGEuaXRlbXNbaXRlbUlkXTtcbiAgICAgIGxldCBlcXVpcG1lbnQgPSBudWxsO1xuXG4gICAgICBTcHJpdGUuZWFjaChHYW1lLmhlcm8uZGF0YS5lcXVpcG1lbnQsIGZ1bmN0aW9uIChlbGVtZW50LCBrZXkpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQgPT0gaXRlbS5pZClcbiAgICAgICAgICBlcXVpcG1lbnQgPSBrZXk7XG4gICAgICB9KTtcblxuICAgICAgbGV0IG9wdGlvbnMgPSB7fTtcbiAgICAgIGlmIChpdGVtLmRhdGEudHlwZS5tYXRjaCgvcG90aW9uLykpIHtcbiAgICAgICAgb3B0aW9uc1tcIuS9v+eUqFwiXSA9IFwidXNlXCI7XG4gICAgICAgIG9wdGlvbnNbXCLlv6vmjbfplK5cIl0gPSBcInNob3J0Y3V0XCI7XG4gICAgICB9IGVsc2UgaWYgKGl0ZW0uZGF0YS50eXBlLm1hdGNoKC9zd29yZHxzcGVhcnxib3d8aGVhZHxib2R5fGZlZXR8bmVja3xyaW5nLykpIHtcbiAgICAgICAgaWYgKGVxdWlwbWVudClcbiAgICAgICAgICBvcHRpb25zW1wi5Y245LiLXCJdID0gXCJ0YWtlb2ZmXCI7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBvcHRpb25zW1wi6KOF5aSHXCJdID0gXCJwdXRvblwiO1xuICAgICAgfSBlbHNlIGlmIChpdGVtLmRhdGEudHlwZS5tYXRjaCgvYm9vay8pKSB7XG4gICAgICAgIG9wdGlvbnNbXCLpmIXor7tcIl0gPSBcInJlYWRcIjtcbiAgICAgIH1cblxuICAgICAgb3B0aW9uc1tcIuS4ouW8g1wiXSA9IFwiZHJvcFwiO1xuXG4gICAgICBHYW1lLmNob2ljZShvcHRpb25zLCBmdW5jdGlvbiAoY2hvaWNlKSB7XG4gICAgICAgIHN3aXRjaCAoY2hvaWNlKSB7XG4gICAgICAgICAgY2FzZSBcInB1dG9uXCI6XG4gICAgICAgICAgICBsZXQgdHlwZSA9IGl0ZW0uZGF0YS50eXBlO1xuICAgICAgICAgICAgaWYgKHR5cGUubWF0Y2goL3N3b3JkfHNwZWFyfGJvdy8pKSB7XG4gICAgICAgICAgICAgIHR5cGUgPSBcIndlYXBvblwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgR2FtZS5oZXJvLmRhdGEuZXF1aXBtZW50W3R5cGVdID0gaXRlbS5pZDtcbiAgICAgICAgICAgIHJldHVybiB3aW4ub3BlbihsYXN0RmlsdGVyKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJ0YWtlb2ZmXCI6XG4gICAgICAgICAgICBpZiAoaXRlbS5kYXRhLnR5cGUubWF0Y2goL3N3b3JkfHNwZWFyfGJvdy8pKVxuICAgICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS5lcXVpcG1lbnQud2VhcG9uID0gbnVsbDtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgR2FtZS5oZXJvLmRhdGEuZXF1aXBtZW50W2l0ZW0uZGF0YS50eXBlXSA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm4gd2luLm9wZW4obGFzdEZpbHRlcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwidXNlXCI6XG4gICAgICAgICAgICBpZiAoaXRlbS5oZXJvVXNlKSB7XG4gICAgICAgICAgICAgIGl0ZW0uaGVyb1VzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcInJlYWRcIjpcbiAgICAgICAgICAgIGlmIChpdGVtLmhlcm9Vc2UpIHtcbiAgICAgICAgICAgICAgaXRlbS5oZXJvVXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiZHJvcFwiOlxuICAgICAgICAgICAgaWYgKGVxdWlwbWVudCkge1xuICAgICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS5lcXVpcG1lbnRbZXF1aXBtZW50XSA9IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIEdhbWUuYWRkQmFnKEdhbWUuaGVyby54ICxHYW1lLmhlcm8ueSkudGhlbigoYmFnKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChiYWcuaW5uZXIuaGFzT3duUHJvcGVydHkoaXRlbUlkKSkge1xuICAgICAgICAgICAgICAgIGJhZy5pbm5lcltpdGVtSWRdICs9IGl0ZW1Db3VudDtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBiYWcuaW5uZXJbaXRlbUlkXSA9IGl0ZW1Db3VudDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRlbGV0ZSBHYW1lLmhlcm8uZGF0YS5pdGVtc1tpdGVtSWRdO1xuXG4gICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS5iYXIuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCwgaW5kZXgsIGFycmF5KSB7XG4gICAgICAgICAgICAgIGlmIChlbGVtZW50ICYmIGVsZW1lbnQuaWQgPT0gaXRlbUlkKSB7XG4gICAgICAgICAgICAgICAgYXJyYXlbaW5kZXhdID0gbnVsbDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIEdhbWUud2luZG93cy5pbnRlcmZhY2UucmVmcmVzaCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdpbi5vcGVuKGxhc3RGaWx0ZXIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcInNob3J0Y3V0XCI6XG4gICAgICAgICAgICBHYW1lLmNob2ljZSh7XG4gICAgICAgICAgICAgIDE6MCxcbiAgICAgICAgICAgICAgMjoxLFxuICAgICAgICAgICAgICAzOjIsXG4gICAgICAgICAgICAgIDQ6MyxcbiAgICAgICAgICAgICAgNTo0LFxuICAgICAgICAgICAgICA2OjUsXG4gICAgICAgICAgICAgIDc6NixcbiAgICAgICAgICAgICAgODo3XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoY2hvaWNlKSB7XG4gICAgICAgICAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUoY2hvaWNlKSAmJiBjaG9pY2UgPj0gMCkge1xuICAgICAgICAgICAgICAgIEdhbWUuaGVyby5kYXRhLmJhcltjaG9pY2VdID0ge1xuICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW0uaWQsXG4gICAgICAgICAgICAgICAgICB0eXBlOiBcIml0ZW1cIlxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgR2FtZS53aW5kb3dzLmludGVyZmFjZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfVxuICB9KTtcblxuICB3aW4ud2hlblVwKFtcImVzY1wiXSwgZnVuY3Rpb24gKCkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgd2luLmhpZGUoKTtcbiAgICB9LCAyMCk7XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1wibGVmdFwiLCBcInJpZ2h0XCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgaWYgKGtleSA9PSBcInJpZ2h0XCIpIHtcbiAgICAgIGxldCBmaWx0ZXIgPSBsYXN0RmlsdGVyO1xuICAgICAgaWYgKGZpbHRlciA9PSBudWxsKSB7XG4gICAgICAgIGZpbHRlciA9IFwic3dvcmR8c3BlYXJ8Ym93XCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvc3dvcmQvKSkge1xuICAgICAgICBmaWx0ZXIgPSBcImhlYWR8Ym9keXxmZWV0XCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvaGVhZC8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwicG90aW9uXCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvcG90aW9uLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJtYXRlcmlhbFwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21hdGVyaWFsLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJib29rfHNjcm9sbHxsZXR0ZXJcIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9ib29rLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJtaXNjXCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvbWlzYy8pKSB7XG4gICAgICAgIGZpbHRlciA9IG51bGw7XG4gICAgICB9XG4gICAgICB3aW4ub3BlbihmaWx0ZXIsIC0xKTtcbiAgICB9IGVsc2UgaWYgKGtleSA9PSBcImxlZnRcIikge1xuICAgICAgbGV0IGZpbHRlciA9IGxhc3RGaWx0ZXI7XG4gICAgICBpZiAoZmlsdGVyID09IG51bGwpIHtcbiAgICAgICAgZmlsdGVyID0gXCJtaXNjXCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvc3dvcmQvKSkge1xuICAgICAgICBmaWx0ZXIgPSBudWxsO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL2hlYWQvKSkge1xuICAgICAgICBmaWx0ZXIgPSBcInN3b3JkfHNwZWFyfGJvd1wiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3BvdGlvbi8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwiaGVhZHxib2R5fGZlZXRcIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9tYXRlcmlhbC8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwicG90aW9uXCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvYm9vay8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwibWF0ZXJpYWxcIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9taXNjLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJib29rfHNjcm9sbHxsZXR0ZXJcIjtcbiAgICAgIH1cbiAgICAgIHdpbi5vcGVuKGZpbHRlciwgLTEpO1xuICAgIH1cbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var loadingIconSrc = "data:image/svg+xml;base64," + window.btoa("\n  <svg id=\"loadingIcon\" width=\"100\" height=\"100\" xmlns=\"http://www.w3.org/2000/svg\">\n    <circle cx=\"50\" cy=\"50\" r=\"50\" fill=\"#808080\" />\n    <path d=\"M50,50 h-40 a40,40 0 1,0 40,-40 z\" fill=\"white\" />\n    <path d=\"M49,49 h-30 a30,30 0 1,0 30,-30 z\" fill=\"#808080\" />\n  </svg>");

  var win = Game.windows.loading = Game.Window.create("loadingWindow");

  win.html = "\n    <div id=\"loadingWindowBox\">\n      <img id=\"loadingWindowLoadingIcon\" src=\"" + loadingIconSrc + "\" alt=\"loading\">\n      <br>\n      <label>请稍等...<small id=\"loadingWindowProgress\"></small></label>\n      <br>\n      <h5 id=\"loadingWindowText\"></h5>\n    </div>\n  ";

  win.css = "\n    .loadingWindow {\n      text-align: center;\n    }\n\n    #loadingWindowLoadingIcon {\n      width: 50px;\n      height: 50px;\n      margin-top: 15px;\n      margin-bottom: 10px;\n      animation: loadingAnimation 1s linear infinite;\n    }\n\n    @keyframes loadingAnimation\n    {\n      0%   { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n\n    #loadingWindowBox {\n      width: 500px;\n      height: 300px;\n      border-radius: 25px;\n      position: fixed;\n      top: 75px;\n      left: 150px;\n      background-color: gray;\n    }\n\n    .loadingWindow label {\n      color: white;\n      font-size: 48px;\n    }\n\n    #loadingWindowText {\n      color: white;\n    }\n  ";

  var loadingWindowProgress = win.querySelector("#loadingWindowProgress");
  var loadingWindowText = win.querySelector("#loadingWindowText");

  // 提示信息
  var text = ["打开游戏菜单之后，游戏是暂停的，你可以在这时思考下战斗策略", "记得出门带着矿工锄和采药铲，或许能从其中赚点小钱", "职业、信仰、技能，都可以任意改变，但是必须付出代价", "你的信仰决定了神对你的祝福，还有某些人或者组织对你的看法", "信仰是可以改变的，不过艾利韦斯的居民并不喜欢总是改变自己信仰的人", "艾利韦斯信仰自由，没有信仰也是一种信仰，但是你享受不到任何神的祝福"];

  win.assign("begin", function () {
    loadingWindowProgress.innerHTML = "";
    // 随机一个提示
    loadingWindowText.textContent = text[Math.floor(Math.random() * text.length)];
    win.show();
  });

  win.assign("update", function (value) {
    loadingWindowProgress.innerHTML = value;
  });

  win.assign("end", function () {
    win.hide();
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dMb2FkaW5nLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUdiLE1BQUksY0FBYyxHQUFHLDRCQUE0QixHQUFHLE1BQU0sQ0FBQyxJQUFJLHNUQUt2RCxDQUFDOztBQUdULE1BQUksR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDOztBQUVyRSxLQUFHLENBQUMsSUFBSSw4RkFFc0MsY0FBYyxtTEFNM0QsQ0FBQzs7QUFFRixLQUFHLENBQUMsR0FBRyxxdEJBcUNOLENBQUM7O0FBRUYsTUFBSSxxQkFBcUIsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHdCQUF3QixDQUFDLENBQUM7QUFDeEUsTUFBSSxpQkFBaUIsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDLENBQUM7OztBQUdoRSxNQUFJLElBQUksR0FBRyxDQUNULCtCQUErQixFQUMvQiwwQkFBMEIsRUFDMUIsMkJBQTJCLEVBQzNCLDhCQUE4QixFQUM5QixrQ0FBa0MsRUFDbEMsbUNBQW1DLENBQ3BDLENBQUM7O0FBRUYsS0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUM5Qix5QkFBcUIsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDOztBQUVyQyxxQkFBaUIsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0FBQzlFLE9BQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztHQUNaLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxVQUFVLEtBQUssRUFBRTtBQUNwQyx5QkFBcUIsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO0dBQ3pDLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxZQUFZO0FBQzVCLE9BQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztHQUNaLENBQUMsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVXaW5kb3dMb2FkaW5nLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cblxuICBsZXQgbG9hZGluZ0ljb25TcmMgPSBcImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsXCIgKyB3aW5kb3cuYnRvYShgXG4gIDxzdmcgaWQ9XCJsb2FkaW5nSWNvblwiIHdpZHRoPVwiMTAwXCIgaGVpZ2h0PVwiMTAwXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiPlxuICAgIDxjaXJjbGUgY3g9XCI1MFwiIGN5PVwiNTBcIiByPVwiNTBcIiBmaWxsPVwiIzgwODA4MFwiIC8+XG4gICAgPHBhdGggZD1cIk01MCw1MCBoLTQwIGE0MCw0MCAwIDEsMCA0MCwtNDAgelwiIGZpbGw9XCJ3aGl0ZVwiIC8+XG4gICAgPHBhdGggZD1cIk00OSw0OSBoLTMwIGEzMCwzMCAwIDEsMCAzMCwtMzAgelwiIGZpbGw9XCIjODA4MDgwXCIgLz5cbiAgPC9zdmc+YCk7XG5cblxuICBsZXQgd2luID0gR2FtZS53aW5kb3dzLmxvYWRpbmcgPSBHYW1lLldpbmRvdy5jcmVhdGUoXCJsb2FkaW5nV2luZG93XCIpO1xuXG4gIHdpbi5odG1sID0gYFxuICAgIDxkaXYgaWQ9XCJsb2FkaW5nV2luZG93Qm94XCI+XG4gICAgICA8aW1nIGlkPVwibG9hZGluZ1dpbmRvd0xvYWRpbmdJY29uXCIgc3JjPVwiJHtsb2FkaW5nSWNvblNyY31cIiBhbHQ9XCJsb2FkaW5nXCI+XG4gICAgICA8YnI+XG4gICAgICA8bGFiZWw+6K+356iN562JLi4uPHNtYWxsIGlkPVwibG9hZGluZ1dpbmRvd1Byb2dyZXNzXCI+PC9zbWFsbD48L2xhYmVsPlxuICAgICAgPGJyPlxuICAgICAgPGg1IGlkPVwibG9hZGluZ1dpbmRvd1RleHRcIj48L2g1PlxuICAgIDwvZGl2PlxuICBgO1xuXG4gIHdpbi5jc3MgPSBgXG4gICAgLmxvYWRpbmdXaW5kb3cge1xuICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIH1cblxuICAgICNsb2FkaW5nV2luZG93TG9hZGluZ0ljb24ge1xuICAgICAgd2lkdGg6IDUwcHg7XG4gICAgICBoZWlnaHQ6IDUwcHg7XG4gICAgICBtYXJnaW4tdG9wOiAxNXB4O1xuICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDtcbiAgICAgIGFuaW1hdGlvbjogbG9hZGluZ0FuaW1hdGlvbiAxcyBsaW5lYXIgaW5maW5pdGU7XG4gICAgfVxuXG4gICAgQGtleWZyYW1lcyBsb2FkaW5nQW5pbWF0aW9uXG4gICAge1xuICAgICAgMCUgICB7IHRyYW5zZm9ybTogcm90YXRlKDBkZWcpOyB9XG4gICAgICAxMDAlIHsgdHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTsgfVxuICAgIH1cblxuICAgICNsb2FkaW5nV2luZG93Qm94IHtcbiAgICAgIHdpZHRoOiA1MDBweDtcbiAgICAgIGhlaWdodDogMzAwcHg7XG4gICAgICBib3JkZXItcmFkaXVzOiAyNXB4O1xuICAgICAgcG9zaXRpb246IGZpeGVkO1xuICAgICAgdG9wOiA3NXB4O1xuICAgICAgbGVmdDogMTUwcHg7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBncmF5O1xuICAgIH1cblxuICAgIC5sb2FkaW5nV2luZG93IGxhYmVsIHtcbiAgICAgIGNvbG9yOiB3aGl0ZTtcbiAgICAgIGZvbnQtc2l6ZTogNDhweDtcbiAgICB9XG5cbiAgICAjbG9hZGluZ1dpbmRvd1RleHQge1xuICAgICAgY29sb3I6IHdoaXRlO1xuICAgIH1cbiAgYDtcblxuICBsZXQgbG9hZGluZ1dpbmRvd1Byb2dyZXNzID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjbG9hZGluZ1dpbmRvd1Byb2dyZXNzXCIpO1xuICBsZXQgbG9hZGluZ1dpbmRvd1RleHQgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNsb2FkaW5nV2luZG93VGV4dFwiKTtcblxuICAvLyDmj5DnpLrkv6Hmga9cbiAgbGV0IHRleHQgPSBbXG4gICAgXCLmiZPlvIDmuLjmiI/oj5zljZXkuYvlkI7vvIzmuLjmiI/mmK/mmoLlgZznmoTvvIzkvaDlj6/ku6XlnKjov5nml7bmgJ3ogIPkuIvmiJjmlpfnrZbnlaVcIixcbiAgICBcIuiusOW+l+WHuumXqOW4puedgOefv+W3pemUhOWSjOmHh+iNr+mTsu+8jOaIluiuuOiDveS7juWFtuS4rei1mueCueWwj+mSsVwiLFxuICAgIFwi6IGM5Lia44CB5L+h5Luw44CB5oqA6IO977yM6YO95Y+v5Lul5Lu75oSP5pS55Y+Y77yM5L2G5piv5b+F6aG75LuY5Ye65Luj5Lu3XCIsXG4gICAgXCLkvaDnmoTkv6Hku7DlhrPlrprkuobnpZ7lr7nkvaDnmoTnpZ3npo/vvIzov5jmnInmn5DkupvkurrmiJbogIXnu4Tnu4flr7nkvaDnmoTnnIvms5VcIixcbiAgICBcIuS/oeS7sOaYr+WPr+S7peaUueWPmOeahO+8jOS4jei/h+iJvuWIqemfpuaWr+eahOWxheawkeW5tuS4jeWWnOasouaAu+aYr+aUueWPmOiHquW3seS/oeS7sOeahOS6ulwiLFxuICAgIFwi6Im+5Yip6Z+m5pav5L+h5Luw6Ieq55Sx77yM5rKh5pyJ5L+h5Luw5Lmf5piv5LiA56eN5L+h5Luw77yM5L2G5piv5L2g5Lqr5Y+X5LiN5Yiw5Lu75L2V56We55qE56Wd56aPXCJcbiAgXTtcblxuICB3aW4uYXNzaWduKFwiYmVnaW5cIiwgZnVuY3Rpb24gKCkge1xuICAgIGxvYWRpbmdXaW5kb3dQcm9ncmVzcy5pbm5lckhUTUwgPSBcIlwiO1xuICAgIC8vIOmaj+acuuS4gOS4quaPkOekulxuICAgIGxvYWRpbmdXaW5kb3dUZXh0LnRleHRDb250ZW50ID0gdGV4dFtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0ZXh0Lmxlbmd0aCldO1xuICAgIHdpbi5zaG93KCk7XG4gIH0pO1xuXG4gIHdpbi5hc3NpZ24oXCJ1cGRhdGVcIiwgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgbG9hZGluZ1dpbmRvd1Byb2dyZXNzLmlubmVySFRNTCA9IHZhbHVlO1xuICB9KTtcblxuICB3aW4uYXNzaWduKFwiZW5kXCIsIGZ1bmN0aW9uICgpIHtcbiAgICB3aW4uaGlkZSgpO1xuICB9KTtcblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.main = Game.Window.create("mainWindow");

  win.html = "\n    <div id=\"mainWindowBox\">\n      <h1>Elliorwis</h1>\n      <h4>艾利韦斯</h4>\n      <br>\n      <button id=\"mainWindowContinue\" class=\"brownButton\">继续旅程</button>\n      <br>\n      <button id=\"mainWindowNew\" class=\"brownButton\">新的旅程</button>\n      <br>\n      <button id=\"mainWindowLoad\" class=\"brownButton\">读取进度</button>\n      <br>\n    </div>\n  ";

  win.css = "\n    #mainWindowBox {\n      text-align: center;\n      height: 412px;\n      background-color: rgba(240, 217, 194, 0.85);\n      border: 20px solid rgba(134, 93, 52, 0.85);\n    }\n\n    .mainWindow h1 {\n      font-size: 60px;\n      margin-bottom: 0;\n      text-shadow: 0 0 15px #111;\n    }\n\n    .mainWindow h4 {\n      margin-bottom: 0;\n      text-shadow: 0 0 15px #111;\n    }\n\n    .mainWindow button {\n      width: 120px;\n      height: 60px;\n      margin-top: 10px;\n    }\n  ";

  var mainWindowContinue = win.querySelector("button#mainWindowContinue");
  var mainWindowNew = win.querySelector("button#mainWindowNew");
  var mainWindowLoad = win.querySelector("button#mainWindowLoad");

  win.on("beforeShow", function () {
    if (!Game.Archive.last()) {
      mainWindowContinue.style.visibility = "hidden";
    } else {
      mainWindowContinue.style.visibility = "visible";
    }
  });

  mainWindowContinue.addEventListener("click", function (event) {
    win.hide();
    setTimeout(function () {
      Game.Archive.load();
    }, 20);
  });

  mainWindowNew.addEventListener("click", function (event) {
    win.hide();
    Game.register.reg();
  });

  mainWindowLoad.addEventListener("click", function (event) {
    win.hide();
    Game.windows.archive.open();
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dNYWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDOztBQUUvRCxLQUFHLENBQUMsSUFBSSxrWEFZUCxDQUFDOztBQUVGLEtBQUcsQ0FBQyxHQUFHLGtmQXdCTixDQUFDOztBQUVGLE1BQUksa0JBQWtCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBQ3hFLE1BQUksYUFBYSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUM5RCxNQUFJLGNBQWMsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHVCQUF1QixDQUFDLENBQUM7O0FBRWhFLEtBQUcsQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLFlBQVk7QUFDL0IsUUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUU7QUFDeEIsd0JBQWtCLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUM7S0FDaEQsTUFBTTtBQUNMLHdCQUFrQixDQUFDLEtBQUssQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO0tBQ2pEO0dBQ0YsQ0FBQyxDQUFDOztBQUVILG9CQUFrQixDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUM1RCxPQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWCxjQUFVLENBQUMsWUFBWTtBQUNyQixVQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO0tBQ3JCLEVBQUUsRUFBRSxDQUFDLENBQUM7R0FDUixDQUFDLENBQUM7O0FBRUgsZUFBYSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUN2RCxPQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWCxRQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxDQUFDO0dBQ3JCLENBQUMsQ0FBQzs7QUFFSCxnQkFBYyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUN4RCxPQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWCxRQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztHQUM3QixDQUFDLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93TWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCB3aW4gPSBHYW1lLndpbmRvd3MubWFpbiA9IEdhbWUuV2luZG93LmNyZWF0ZShcIm1haW5XaW5kb3dcIik7XG5cbiAgd2luLmh0bWwgPSBgXG4gICAgPGRpdiBpZD1cIm1haW5XaW5kb3dCb3hcIj5cbiAgICAgIDxoMT5FbGxpb3J3aXM8L2gxPlxuICAgICAgPGg0PuiJvuWIqemfpuaWrzwvaDQ+XG4gICAgICA8YnI+XG4gICAgICA8YnV0dG9uIGlkPVwibWFpbldpbmRvd0NvbnRpbnVlXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPue7p+e7reaXheeoizwvYnV0dG9uPlxuICAgICAgPGJyPlxuICAgICAgPGJ1dHRvbiBpZD1cIm1haW5XaW5kb3dOZXdcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5paw55qE5peF56iLPC9idXR0b24+XG4gICAgICA8YnI+XG4gICAgICA8YnV0dG9uIGlkPVwibWFpbldpbmRvd0xvYWRcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+6K+75Y+W6L+b5bqmPC9idXR0b24+XG4gICAgICA8YnI+XG4gICAgPC9kaXY+XG4gIGA7XG5cbiAgd2luLmNzcyA9IGBcbiAgICAjbWFpbldpbmRvd0JveCB7XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICBoZWlnaHQ6IDQxMnB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNDAsIDIxNywgMTk0LCAwLjg1KTtcbiAgICAgIGJvcmRlcjogMjBweCBzb2xpZCByZ2JhKDEzNCwgOTMsIDUyLCAwLjg1KTtcbiAgICB9XG5cbiAgICAubWFpbldpbmRvdyBoMSB7XG4gICAgICBmb250LXNpemU6IDYwcHg7XG4gICAgICBtYXJnaW4tYm90dG9tOiAwO1xuICAgICAgdGV4dC1zaGFkb3c6IDAgMCAxNXB4ICMxMTE7XG4gICAgfVxuXG4gICAgLm1haW5XaW5kb3cgaDQge1xuICAgICAgbWFyZ2luLWJvdHRvbTogMDtcbiAgICAgIHRleHQtc2hhZG93OiAwIDAgMTVweCAjMTExO1xuICAgIH1cblxuICAgIC5tYWluV2luZG93IGJ1dHRvbiB7XG4gICAgICB3aWR0aDogMTIwcHg7XG4gICAgICBoZWlnaHQ6IDYwcHg7XG4gICAgICBtYXJnaW4tdG9wOiAxMHB4O1xuICAgIH1cbiAgYDtcblxuICBsZXQgbWFpbldpbmRvd0NvbnRpbnVlID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jbWFpbldpbmRvd0NvbnRpbnVlXCIpO1xuICBsZXQgbWFpbldpbmRvd05ldyA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI21haW5XaW5kb3dOZXdcIik7XG4gIGxldCBtYWluV2luZG93TG9hZCA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI21haW5XaW5kb3dMb2FkXCIpO1xuXG4gIHdpbi5vbihcImJlZm9yZVNob3dcIiwgZnVuY3Rpb24gKCkge1xuICAgIGlmICghR2FtZS5BcmNoaXZlLmxhc3QoKSkge1xuICAgICAgbWFpbldpbmRvd0NvbnRpbnVlLnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBtYWluV2luZG93Q29udGludWUuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xuICAgIH1cbiAgfSk7XG5cbiAgbWFpbldpbmRvd0NvbnRpbnVlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4uaGlkZSgpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgR2FtZS5BcmNoaXZlLmxvYWQoKTtcbiAgICB9LCAyMCk7XG4gIH0pO1xuXG4gIG1haW5XaW5kb3dOZXcuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5oaWRlKCk7XG4gICAgR2FtZS5yZWdpc3Rlci5yZWcoKTtcbiAgfSk7XG5cbiAgbWFpbldpbmRvd0xvYWQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5oaWRlKCk7XG4gICAgR2FtZS53aW5kb3dzLmFyY2hpdmUub3BlbigpO1xuICB9KTtcblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.map = Game.Window.create("mapWindow");

  win.html = "\n    <div class=\"window-box\">\n      <button id=\"mapWindowClose\" class=\"brownButton\">关闭</button>\n      <table><tbody><tr><td>\n        <div id=\"mapWindowMap\"></div>\n      </td></tr></tbody></table>\n    </div>\n  ";

  win.css = "\n    .mapWindow table, .mapWindow tbody, .mapWindow tr, .mapWindow td {\n      width: 100%;\n      height: 100%;\n      magrin: 0;\n      padding: 0;\n    }\n\n    .mapWindow {\n      text-align: center;\n    }\n\n    #mapWindowClose {\n      position: absolute;\n      right: 50px;\n      top: 50px;\n      width: 120px;\n      height: 60px;\n      font-size: 16px;\n    }\n\n    #mapWindowMap img, #mapWindowMap canvas {\n      max-width: 700px;\n      max-height: 320px;\n    }\n  ";

  var mapWindowClose = win.querySelector("#mapWindowClose");
  var mapWindowMap = win.querySelector("#mapWindowMap");

  mapWindowClose.addEventListener("click", function (event) {
    Game.windows.map.hide();
  });

  win.whenUp(["esc"], function (key) {
    setTimeout(function () {
      mapWindowClose.click();
    }, 20);
  });

  win.on("beforeShow", function (event) {
    if (Game.stage && Game.area && Game.area.map) {
      var stage = {
        x: Game.stage.x,
        y: Game.stage.y,
        centerX: Game.stage.centerX,
        centerY: Game.stage.centerY
      };
      Game.stage.x = 0;
      Game.stage.y = 0;
      Game.stage.centerX = 0;
      Game.stage.centerY = 0;
      var canvas = document.createElement("canvas");
      canvas.width = Game.area.map.width;
      canvas.height = Game.area.map.height;
      var context = canvas.getContext("2d");
      Game.stage.draw(context);
      var minimap = document.createElement("canvas");
      minimap.width = Math.floor(canvas.width / 8);
      minimap.height = Math.floor(canvas.height / 8);
      var minimapContext = minimap.getContext("2d");
      minimapContext.drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, minimap.width, minimap.height);
      context = null;
      canvas = null;
      mapWindowMap.innerHTML = "";
      mapWindowMap.appendChild(minimap);
      Game.stage.x = stage.x;
      Game.stage.y = stage.y;
      Game.stage.centerX = stage.centerX;
      Game.stage.centerY = stage.centerY;
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dNYXAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7O0FBRTdELEtBQUcsQ0FBQyxJQUFJLHFPQU9QLENBQUM7O0FBRUYsS0FBRyxDQUFDLEdBQUcsMGVBeUJOLENBQUM7O0FBRUYsTUFBSSxjQUFjLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBQzFELE1BQUksWUFBWSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLENBQUM7O0FBRXRELGdCQUFjLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVUsS0FBSyxFQUFFO0FBQ3hELFFBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0dBQ3pCLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsVUFBVSxHQUFHLEVBQUU7QUFDakMsY0FBVSxDQUFDLFlBQVk7QUFDckIsb0JBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztLQUN4QixFQUFFLEVBQUUsQ0FBQyxDQUFDO0dBQ1IsQ0FBQyxDQUFDOztBQUVILEtBQUcsQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLFVBQVUsS0FBSyxFQUFFO0FBQ3BDLFFBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO0FBQzVDLFVBQUksS0FBSyxHQUFHO0FBQ1YsU0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNmLFNBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDZixlQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPO0FBQzNCLGVBQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU87T0FDNUIsQ0FBQztBQUNGLFVBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNqQixVQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDakIsVUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZCLFVBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztBQUN2QixVQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzlDLFlBQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO0FBQ25DLFlBQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO0FBQ3JDLFVBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDdEMsVUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDekIsVUFBSSxPQUFPLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUMvQyxhQUFPLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztBQUM3QyxhQUFPLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztBQUMvQyxVQUFJLGNBQWMsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlDLG9CQUFjLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFDN0IsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLEVBQ2pDLENBQUMsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDdkMsYUFBTyxHQUFHLElBQUksQ0FBQztBQUNmLFlBQU0sR0FBRyxJQUFJLENBQUM7QUFDZCxrQkFBWSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7QUFDNUIsa0JBQVksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDbEMsVUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQztBQUN2QixVQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDO0FBQ3ZCLFVBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUM7QUFDbkMsVUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQztLQUNwQztHQUNGLENBQUMsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVXaW5kb3dNYXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgd2luID0gR2FtZS53aW5kb3dzLm1hcCA9IEdhbWUuV2luZG93LmNyZWF0ZShcIm1hcFdpbmRvd1wiKTtcblxuICB3aW4uaHRtbCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwid2luZG93LWJveFwiPlxuICAgICAgPGJ1dHRvbiBpZD1cIm1hcFdpbmRvd0Nsb3NlXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuWFs+mXrTwvYnV0dG9uPlxuICAgICAgPHRhYmxlPjx0Ym9keT48dHI+PHRkPlxuICAgICAgICA8ZGl2IGlkPVwibWFwV2luZG93TWFwXCI+PC9kaXY+XG4gICAgICA8L3RkPjwvdHI+PC90Ym9keT48L3RhYmxlPlxuICAgIDwvZGl2PlxuICBgO1xuXG4gIHdpbi5jc3MgPSBgXG4gICAgLm1hcFdpbmRvdyB0YWJsZSwgLm1hcFdpbmRvdyB0Ym9keSwgLm1hcFdpbmRvdyB0ciwgLm1hcFdpbmRvdyB0ZCB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgIG1hZ3JpbjogMDtcbiAgICAgIHBhZGRpbmc6IDA7XG4gICAgfVxuXG4gICAgLm1hcFdpbmRvdyB7XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgfVxuXG4gICAgI21hcFdpbmRvd0Nsb3NlIHtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIHJpZ2h0OiA1MHB4O1xuICAgICAgdG9wOiA1MHB4O1xuICAgICAgd2lkdGg6IDEyMHB4O1xuICAgICAgaGVpZ2h0OiA2MHB4O1xuICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgIH1cblxuICAgICNtYXBXaW5kb3dNYXAgaW1nLCAjbWFwV2luZG93TWFwIGNhbnZhcyB7XG4gICAgICBtYXgtd2lkdGg6IDcwMHB4O1xuICAgICAgbWF4LWhlaWdodDogMzIwcHg7XG4gICAgfVxuICBgO1xuXG4gIGxldCBtYXBXaW5kb3dDbG9zZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI21hcFdpbmRvd0Nsb3NlXCIpO1xuICBsZXQgbWFwV2luZG93TWFwID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjbWFwV2luZG93TWFwXCIpO1xuXG4gIG1hcFdpbmRvd0Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBHYW1lLndpbmRvd3MubWFwLmhpZGUoKTtcbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJlc2NcIl0sIGZ1bmN0aW9uIChrZXkpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIG1hcFdpbmRvd0Nsb3NlLmNsaWNrKCk7XG4gICAgfSwgMjApO1xuICB9KTtcblxuICB3aW4ub24oXCJiZWZvcmVTaG93XCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIGlmIChHYW1lLnN0YWdlICYmIEdhbWUuYXJlYSAmJiBHYW1lLmFyZWEubWFwKSB7XG4gICAgICBsZXQgc3RhZ2UgPSB7XG4gICAgICAgIHg6IEdhbWUuc3RhZ2UueCxcbiAgICAgICAgeTogR2FtZS5zdGFnZS55LFxuICAgICAgICBjZW50ZXJYOiBHYW1lLnN0YWdlLmNlbnRlclgsXG4gICAgICAgIGNlbnRlclk6IEdhbWUuc3RhZ2UuY2VudGVyWVxuICAgICAgfTtcbiAgICAgIEdhbWUuc3RhZ2UueCA9IDA7XG4gICAgICBHYW1lLnN0YWdlLnkgPSAwO1xuICAgICAgR2FtZS5zdGFnZS5jZW50ZXJYID0gMDtcbiAgICAgIEdhbWUuc3RhZ2UuY2VudGVyWSA9IDA7XG4gICAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgIGNhbnZhcy53aWR0aCA9IEdhbWUuYXJlYS5tYXAud2lkdGg7XG4gICAgICBjYW52YXMuaGVpZ2h0ID0gR2FtZS5hcmVhLm1hcC5oZWlnaHQ7XG4gICAgICBsZXQgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICBHYW1lLnN0YWdlLmRyYXcoY29udGV4dCk7XG4gICAgICBsZXQgbWluaW1hcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICBtaW5pbWFwLndpZHRoID0gTWF0aC5mbG9vcihjYW52YXMud2lkdGggLyA4KTtcbiAgICAgIG1pbmltYXAuaGVpZ2h0ID0gTWF0aC5mbG9vcihjYW52YXMuaGVpZ2h0IC8gOCk7XG4gICAgICBsZXQgbWluaW1hcENvbnRleHQgPSBtaW5pbWFwLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIG1pbmltYXBDb250ZXh0LmRyYXdJbWFnZShjYW52YXMsXG4gICAgICAgIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCxcbiAgICAgICAgMCwgMCwgbWluaW1hcC53aWR0aCwgbWluaW1hcC5oZWlnaHQpO1xuICAgICAgY29udGV4dCA9IG51bGw7XG4gICAgICBjYW52YXMgPSBudWxsO1xuICAgICAgbWFwV2luZG93TWFwLmlubmVySFRNTCA9IFwiXCI7XG4gICAgICBtYXBXaW5kb3dNYXAuYXBwZW5kQ2hpbGQobWluaW1hcCk7XG4gICAgICBHYW1lLnN0YWdlLnggPSBzdGFnZS54O1xuICAgICAgR2FtZS5zdGFnZS55ID0gc3RhZ2UueTtcbiAgICAgIEdhbWUuc3RhZ2UuY2VudGVyWCA9IHN0YWdlLmNlbnRlclg7XG4gICAgICBHYW1lLnN0YWdlLmNlbnRlclkgPSBzdGFnZS5jZW50ZXJZO1xuICAgIH1cbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.over = Game.Window.create("overWindow");

  win.html = "\n    <div class=\"window-box\">\n      <button id=\"overWindowClose\" class=\"brownButton\">返回主菜单</button>\n      <table><tbody><tr><td>\n        <div>\n          <h1 id=\"overWindowMessage\"></h1>\n          <h2 id=\"overWindowReason\"></h2>\n        </div>\n      </td></tr></tbody></table>\n    </div>\n  ";

  win.css = "\n    .overWindow table, .overWindow tbody, .overWindow tr, .overWindow td {\n      width: 100%;\n      height: 100%;\n      magrin: 0;\n      padding: 0;\n    }\n\n    .overWindow {\n      text-align: center;\n    }\n\n    #overWindowClose {\n      position: absolute;\n      right: 50px;\n      top: 50px;\n      width: 120px;\n      height: 60px;\n      font-size: 16px;\n    }\n\n    #overWindowMap img, #overWindowMap canvas {\n      max-width: 700px;\n      max-height: 320px;\n    }\n  ";

  var overWindowMessage = win.querySelector("#overWindowMessage");
  var overWindowReason = win.querySelector("#overWindowReason");

  var deadText = ["不幸的事情终于发生了……即便你的内心曾对神灵祈祷", "不幸的事情终于发生了……你就知道自己今天不应该穿白色的袜子", "不幸的事情终于发生了……明明还没有体验过天伦之乐", "不幸的事情终于发生了……你的墓碑上写着：“下次不能随便踢小动物”", "不幸的事情终于发生了……你感觉自己的身体变轻了…轻了…轻了…", "不幸的事情终于发生了……你摸了摸自己的脖子，似乎找不到脑袋了，于是你一赌气", "不幸的事情终于发生了……你的墓碑上写着：“下次再也不把治疗药水借给别人了”", "不幸的事情终于发生了……曾经有一瓶治疗药水摆在你面前，而你没有珍惜", "不幸的事情终于发生了……你回想起曾经在广阔的原野上尽情的奔跑", "不幸的事情终于发生了……不过好消息是你再也不用减肥了", "不幸的事情终于发生了……下次在冒险前一定要吃饱饭"];

  win.assign("open", function (reason) {
    if (reason) {
      overWindowReason.textContent = reason;
    } else {
      overWindowReason.innerHTML = "";
    }
    overWindowMessage.textContent = deadText[Math.floor(Math.random() * deadText.length)];
    Game.windows.stage.hide();
    Game.windows["interface"].hide();
    win.show();
  });

  overWindowClose.addEventListener("click", function (event) {
    Game.clearStage();
    win.hide();
    Game.windows.main.show();
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dPdmVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDOztBQUUvRCxLQUFHLENBQUMsSUFBSSwwVEFVUCxDQUFDOztBQUVGLEtBQUcsQ0FBQyxHQUFHLGtmQXlCTixDQUFDOztBQUVGLE1BQUksaUJBQWlCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQ2hFLE1BQUksZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDOztBQUU5RCxNQUFJLFFBQVEsR0FBRyxDQUNiLDBCQUEwQixFQUMxQiwrQkFBK0IsRUFDL0IsMEJBQTBCLEVBQzFCLGtDQUFrQyxFQUNsQyxnQ0FBZ0MsRUFDaEMsdUNBQXVDLEVBQ3ZDLHVDQUF1QyxFQUN2QyxtQ0FBbUMsRUFDbkMsZ0NBQWdDLEVBQ2hDLDRCQUE0QixFQUM1QiwwQkFBMEIsQ0FDM0IsQ0FBQzs7QUFFRixLQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxVQUFVLE1BQU0sRUFBRTtBQUNuQyxRQUFJLE1BQU0sRUFBRTtBQUNWLHNCQUFnQixDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUM7S0FDdkMsTUFBTTtBQUNMLHNCQUFnQixDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7S0FDakM7QUFDRCxxQkFBaUIsQ0FBQyxXQUFXLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0FBQ3RGLFFBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQzFCLFFBQUksQ0FBQyxPQUFPLGFBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUM5QixPQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7R0FDWixDQUFDLENBQUM7O0FBRUgsaUJBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDekQsUUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0FBQ2xCLE9BQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNYLFFBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0dBQzFCLENBQUMsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVXaW5kb3dPdmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IHdpbiA9IEdhbWUud2luZG93cy5vdmVyID0gR2FtZS5XaW5kb3cuY3JlYXRlKFwib3ZlcldpbmRvd1wiKTtcblxuICB3aW4uaHRtbCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwid2luZG93LWJveFwiPlxuICAgICAgPGJ1dHRvbiBpZD1cIm92ZXJXaW5kb3dDbG9zZVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7ov5Tlm57kuLvoj5zljZU8L2J1dHRvbj5cbiAgICAgIDx0YWJsZT48dGJvZHk+PHRyPjx0ZD5cbiAgICAgICAgPGRpdj5cbiAgICAgICAgICA8aDEgaWQ9XCJvdmVyV2luZG93TWVzc2FnZVwiPjwvaDE+XG4gICAgICAgICAgPGgyIGlkPVwib3ZlcldpbmRvd1JlYXNvblwiPjwvaDI+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC90ZD48L3RyPjwvdGJvZHk+PC90YWJsZT5cbiAgICA8L2Rpdj5cbiAgYDtcblxuICB3aW4uY3NzID0gYFxuICAgIC5vdmVyV2luZG93IHRhYmxlLCAub3ZlcldpbmRvdyB0Ym9keSwgLm92ZXJXaW5kb3cgdHIsIC5vdmVyV2luZG93IHRkIHtcbiAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgICAgbWFncmluOiAwO1xuICAgICAgcGFkZGluZzogMDtcbiAgICB9XG5cbiAgICAub3ZlcldpbmRvdyB7XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgfVxuXG4gICAgI292ZXJXaW5kb3dDbG9zZSB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICByaWdodDogNTBweDtcbiAgICAgIHRvcDogNTBweDtcbiAgICAgIHdpZHRoOiAxMjBweDtcbiAgICAgIGhlaWdodDogNjBweDtcbiAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICB9XG5cbiAgICAjb3ZlcldpbmRvd01hcCBpbWcsICNvdmVyV2luZG93TWFwIGNhbnZhcyB7XG4gICAgICBtYXgtd2lkdGg6IDcwMHB4O1xuICAgICAgbWF4LWhlaWdodDogMzIwcHg7XG4gICAgfVxuICBgO1xuXG4gIGxldCBvdmVyV2luZG93TWVzc2FnZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI292ZXJXaW5kb3dNZXNzYWdlXCIpO1xuICBsZXQgb3ZlcldpbmRvd1JlYXNvbiA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI292ZXJXaW5kb3dSZWFzb25cIik7XG5cbiAgbGV0IGRlYWRUZXh0ID0gW1xuICAgIFwi5LiN5bm455qE5LqL5oOF57uI5LqO5Y+R55Sf5LqG4oCm4oCm5Y2z5L6/5L2g55qE5YaF5b+D5pu+5a+556We54G156WI56W3XCIsXG4gICAgXCLkuI3lubjnmoTkuovmg4Xnu4jkuo7lj5HnlJ/kuobigKbigKbkvaDlsLHnn6XpgZPoh6rlt7Hku4rlpKnkuI3lupTor6Xnqb/nmb3oibLnmoToopzlrZBcIixcbiAgICBcIuS4jeW5uOeahOS6i+aDhee7iOS6juWPkeeUn+S6huKApuKApuaYjuaYjui/mOayoeacieS9k+mqjOi/h+WkqeS8puS5i+S5kFwiLFxuICAgIFwi5LiN5bm455qE5LqL5oOF57uI5LqO5Y+R55Sf5LqG4oCm4oCm5L2g55qE5aKT56KR5LiK5YaZ552A77ya4oCc5LiL5qyh5LiN6IO96ZqP5L6/6Lii5bCP5Yqo54mp4oCdXCIsXG4gICAgXCLkuI3lubjnmoTkuovmg4Xnu4jkuo7lj5HnlJ/kuobigKbigKbkvaDmhJ/op4noh6rlt7HnmoTouqvkvZPlj5jovbvkuobigKbovbvkuobigKbovbvkuobigKZcIixcbiAgICBcIuS4jeW5uOeahOS6i+aDhee7iOS6juWPkeeUn+S6huKApuKApuS9oOaRuOS6huaRuOiHquW3seeahOiEluWtkO+8jOS8vOS5juaJvuS4jeWIsOiEkeiii+S6hu+8jOS6juaYr+S9oOS4gOi1jOawlFwiLFxuICAgIFwi5LiN5bm455qE5LqL5oOF57uI5LqO5Y+R55Sf5LqG4oCm4oCm5L2g55qE5aKT56KR5LiK5YaZ552A77ya4oCc5LiL5qyh5YaN5Lmf5LiN5oqK5rK755aX6I2v5rC05YCf57uZ5Yir5Lq65LqG4oCdXCIsXG4gICAgXCLkuI3lubjnmoTkuovmg4Xnu4jkuo7lj5HnlJ/kuobigKbigKbmm77nu4/mnInkuIDnk7bmsrvnlpfoja/msLTmkYblnKjkvaDpnaLliY3vvIzogIzkvaDmsqHmnInnj43mg5xcIixcbiAgICBcIuS4jeW5uOeahOS6i+aDhee7iOS6juWPkeeUn+S6huKApuKApuS9oOWbnuaDs+i1t+abvue7j+WcqOW5v+mYlOeahOWOn+mHjuS4iuWwveaDheeahOWllOi3kVwiLFxuICAgIFwi5LiN5bm455qE5LqL5oOF57uI5LqO5Y+R55Sf5LqG4oCm4oCm5LiN6L+H5aW95raI5oGv5piv5L2g5YaN5Lmf5LiN55So5YeP6IKl5LqGXCIsXG4gICAgXCLkuI3lubjnmoTkuovmg4Xnu4jkuo7lj5HnlJ/kuobigKbigKbkuIvmrKHlnKjlhpLpmanliY3kuIDlrpropoHlkIPppbHppa1cIlxuICBdO1xuXG4gIHdpbi5hc3NpZ24oXCJvcGVuXCIsIGZ1bmN0aW9uIChyZWFzb24pIHtcbiAgICBpZiAocmVhc29uKSB7XG4gICAgICBvdmVyV2luZG93UmVhc29uLnRleHRDb250ZW50ID0gcmVhc29uO1xuICAgIH0gZWxzZSB7XG4gICAgICBvdmVyV2luZG93UmVhc29uLmlubmVySFRNTCA9IFwiXCI7XG4gICAgfVxuICAgIG92ZXJXaW5kb3dNZXNzYWdlLnRleHRDb250ZW50ID0gZGVhZFRleHRbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogZGVhZFRleHQubGVuZ3RoKV07XG4gICAgR2FtZS53aW5kb3dzLnN0YWdlLmhpZGUoKTtcbiAgICBHYW1lLndpbmRvd3MuaW50ZXJmYWNlLmhpZGUoKTtcbiAgICB3aW4uc2hvdygpO1xuICB9KTtcblxuICBvdmVyV2luZG93Q2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIEdhbWUuY2xlYXJTdGFnZSgpO1xuICAgIHdpbi5oaWRlKCk7XG4gICAgR2FtZS53aW5kb3dzLm1haW4uc2hvdygpO1xuICB9KTtcblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.pickup = Game.Window.create("pickupWindow");

  win.html = "\n    <div class=\"window-box\">\n      <button id=\"pickupWindowClose\" class=\"brownButton\">关闭</button>\n      <button id=\"pickupWindowAll\" class=\"brownButton\">A 全部</button>\n      <table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n        <thead>\n          <tr>\n            <td style=\"width: 40px;\"></td>\n            <td style=\"width: 120px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td></td>\n            <td style=\"width: 60px;\"></td>\n          </tr>\n        </thead>\n        <tbody id=\"pickupWindowTable\"></tbody>\n      </table>\n    </div>\n  ";

  win.css = "\n    .pickupWindow table {\n      width: 100%;\n    }\n\n    .pickupWindow table img {\n      width: 100%;\n      height: 100%;\n    }\n\n    .pickupWindow button {\n      width: 60px;\n      height: 40px;\n      font-size: 16;\n    }\n\n    #pickupWindowClose {\n\n    }\n\n    #pickupWindowAll {\n\n    }\n  ";

  var pickupWindowClose = win.querySelector("button#pickupWindowClose");
  var pickupWindowAll = win.querySelector("button#pickupWindowAll");
  var pickupWindowTable = win.querySelector("#pickupWindowTable");

  var currentItemObj = null;
  var lastSelect = -1;

  pickupWindowClose.addEventListener("click", function (event) {
    Game.windows.pickup.hide();
  });

  pickupWindowAll.addEventListener("click", function (event) {
    var itemObj = currentItemObj;
    if (itemObj && itemObj.inner && Object.keys(itemObj.inner).length > 0) {
      Sprite.each(itemObj.inner, function (itemCount, itemId, inner) {
        if (itemId == "gold") {
          Game.hero.data.gold += itemCount;
        } else {
          if (Game.hero.data.items[itemId]) {
            Game.hero.data.items[itemId] += itemCount;
          } else {
            Game.hero.data.items[itemId] = itemCount;
          }
        }
        delete inner[itemId];
      });
      Game.windows.pickup.open(itemObj);
    }
  });

  win.whenUp(["a", "A"], function (key) {
    pickupWindowAll.click();
  });

  win.whenUp(["esc"], function (key) {
    setTimeout(function () {
      win.hide();
    }, 20);
  });

  win.whenUp(["1", "2", "3", "4", "5", "6", "7", "8", "9"], function (key) {
    var buttons = pickupWindowTable.querySelectorAll("button");
    for (var i = 0, len = buttons.length; i < len; i++) {
      var buttonIndex = buttons[i].getAttribute("data-index");
      if (buttonIndex) {
        if (buttonIndex == key) {
          buttons[i].click();
        }
      }
    }
  });

  win.assign("open", function (itemObj, select) {
    if (typeof select == "undefined") {
      select = -1;
    }

    lastSelect = select;

    if (!itemObj.inner || Object.keys(itemObj.inner).length <= 0) {
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = Game.area.bags[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var bag = _step.value;

          if (bag == itemObj) {
            Game.area.bags["delete"](bag);
            itemObj.erase();
          }
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator["return"]) {
            _iterator["return"]();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      Game.windows.pickup.hide();
      return;
    }

    currentItemObj = itemObj;

    var index = 1;
    var table = "";
    Sprite.each(itemObj.inner, function (itemCount, itemId, inner) {
      var item = Game.items[itemId];

      var line = "";

      if (select == index - 1) {
        line += "<tr style=\"background-color: green;\">\n";
      } else {
        line += "<tr>\n";
      }

      if (item.icon) {
        line += "  <td><img alt=\"\" src=\"" + item.icon.src + "\"></td>\n";
      } else {
        line += "  <td> </td>\n";
      }
      line += "  <td>" + item.data.name + "</td>\n";
      line += "  <td style=\"text-align: center;\">" + item.data.value + "G</td>\n";
      line += "  <td style=\"text-align: center;\">" + itemCount + "</td>\n";
      line += "  <td>" + item.data.description + "</td>\n";
      line += "  <td><button data-id=\"" + itemId + "\" data-index=\"" + index + "\" class=\"brownButton\">" + (index <= 9 ? index : "") + " 拿取</button></td>\n";

      line += "</tr>\n";
      table += line;
      index++;
    });

    pickupWindowTable.innerHTML = table;
    Game.windows.pickup.show();
  });

  win.whenUp(["enter"], function () {
    var buttons = pickupWindowTable.querySelectorAll("button");
    if (lastSelect >= 0 && lastSelect < buttons.length) {
      buttons[lastSelect].click();
    }
  });

  win.whenUp(["up", "down"], function (key) {
    var count = pickupWindowTable.querySelectorAll("button").length;

    if (lastSelect == -1) {
      if (key == "down") {
        win.open(currentItemObj, 0);
      } else if (key == "up") {
        win.open(currentItemObj, count - 1);
      }
    } else {
      if (key == "down") {
        var select = lastSelect + 1;
        if (select >= count) {
          select = 0;
        }
        win.open(currentItemObj, select);
      } else if (key == "up") {
        var select = lastSelect - 1;
        if (select < 0) {
          select = count - 1;
        }
        win.open(currentItemObj, select);
      }
    }
  });

  pickupWindowTable.addEventListener("click", function (event) {
    var itemId = event.target.getAttribute("data-id");
    if (itemId && currentItemObj.inner && currentItemObj.inner.hasOwnProperty(itemId)) {
      var itemCount = currentItemObj.inner[itemId];
      if (itemId == "gold") {
        Game.hero.data.gold += itemCount;
      } else {
        if (Game.hero.data.items.hasOwnProperty(itemId)) {
          Game.hero.data.items[itemId] += itemCount;
        } else {
          Game.hero.data.items[itemId] = itemCount;
        }
      }
      delete currentItemObj.inner[itemId];
      win.open(currentItemObj);
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dQaWNrdXAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7O0FBRW5FLEtBQUcsQ0FBQyxJQUFJLDZvQkFrQlAsQ0FBQzs7QUFFRixLQUFHLENBQUMsR0FBRyw0VEF1Qk4sQ0FBQzs7QUFFRixNQUFJLGlCQUFpQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUN0RSxNQUFJLGVBQWUsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHdCQUF3QixDQUFDLENBQUM7QUFDbEUsTUFBSSxpQkFBaUIsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDLENBQUM7O0FBRWhFLE1BQUksY0FBYyxHQUFHLElBQUksQ0FBQztBQUMxQixNQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQzs7QUFFcEIsbUJBQWlCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVUsS0FBSyxFQUFFO0FBQzNELFFBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0dBQzVCLENBQUMsQ0FBQzs7QUFFSCxpQkFBZSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUN6RCxRQUFJLE9BQU8sR0FBRyxjQUFjLENBQUM7QUFDN0IsUUFBSSxPQUFPLElBQUksT0FBTyxDQUFDLEtBQUssSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQ3JFLFlBQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFD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Q0FFSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93UGlja3VwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IHdpbiA9IEdhbWUud2luZG93cy5waWNrdXAgPSBHYW1lLldpbmRvdy5jcmVhdGUoXCJwaWNrdXBXaW5kb3dcIik7XG5cbiAgd2luLmh0bWwgPSBgXG4gICAgPGRpdiBjbGFzcz1cIndpbmRvdy1ib3hcIj5cbiAgICAgIDxidXR0b24gaWQ9XCJwaWNrdXBXaW5kb3dDbG9zZVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7lhbPpl608L2J1dHRvbj5cbiAgICAgIDxidXR0b24gaWQ9XCJwaWNrdXBXaW5kb3dBbGxcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+QSDlhajpg6g8L2J1dHRvbj5cbiAgICAgIDx0YWJsZSBib3JkZXI9XCIxXCIgY2VsbHNwYWNpbmc9XCIwXCIgY2VsbHBhZGRpbmc9XCIwXCI+XG4gICAgICAgIDx0aGVhZD5cbiAgICAgICAgICA8dHI+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJ3aWR0aDogNDBweDtcIj48L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwid2lkdGg6IDEyMHB4O1wiPjwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJ3aWR0aDogMzBweDtcIj48L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwid2lkdGg6IDMwcHg7XCI+PC90ZD5cbiAgICAgICAgICAgIDx0ZD48L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwid2lkdGg6IDYwcHg7XCI+PC90ZD5cbiAgICAgICAgICA8L3RyPlxuICAgICAgICA8L3RoZWFkPlxuICAgICAgICA8dGJvZHkgaWQ9XCJwaWNrdXBXaW5kb3dUYWJsZVwiPjwvdGJvZHk+XG4gICAgICA8L3RhYmxlPlxuICAgIDwvZGl2PlxuICBgO1xuXG4gIHdpbi5jc3MgPSBgXG4gICAgLnBpY2t1cFdpbmRvdyB0YWJsZSB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICB9XG5cbiAgICAucGlja3VwV2luZG93IHRhYmxlIGltZyB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogMTAwJTtcbiAgICB9XG5cbiAgICAucGlja3VwV2luZG93IGJ1dHRvbiB7XG4gICAgICB3aWR0aDogNjBweDtcbiAgICAgIGhlaWdodDogNDBweDtcbiAgICAgIGZvbnQtc2l6ZTogMTY7XG4gICAgfVxuXG4gICAgI3BpY2t1cFdpbmRvd0Nsb3NlIHtcblxuICAgIH1cblxuICAgICNwaWNrdXBXaW5kb3dBbGwge1xuXG4gICAgfVxuICBgO1xuXG4gIGxldCBwaWNrdXBXaW5kb3dDbG9zZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI3BpY2t1cFdpbmRvd0Nsb3NlXCIpO1xuICBsZXQgcGlja3VwV2luZG93QWxsID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jcGlja3VwV2luZG93QWxsXCIpO1xuICBsZXQgcGlja3VwV2luZG93VGFibGUgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNwaWNrdXBXaW5kb3dUYWJsZVwiKTtcblxuICBsZXQgY3VycmVudEl0ZW1PYmogPSBudWxsO1xuICBsZXQgbGFzdFNlbGVjdCA9IC0xO1xuXG4gIHBpY2t1cFdpbmRvd0Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBHYW1lLndpbmRvd3MucGlja3VwLmhpZGUoKTtcbiAgfSk7XG5cbiAgcGlja3VwV2luZG93QWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBsZXQgaXRlbU9iaiA9IGN1cnJlbnRJdGVtT2JqO1xuICAgIGlmIChpdGVtT2JqICYmIGl0ZW1PYmouaW5uZXIgJiYgT2JqZWN0LmtleXMoaXRlbU9iai5pbm5lcikubGVuZ3RoID4gMCkge1xuICAgICAgU3ByaXRlLmVhY2goaXRlbU9iai5pbm5lciwgZnVuY3Rpb24gKGl0ZW1Db3VudCwgaXRlbUlkLCBpbm5lcikge1xuICAgICAgICBpZiAoaXRlbUlkID09IFwiZ29sZFwiKSB7XG4gICAgICAgICAgR2FtZS5oZXJvLmRhdGEuZ29sZCArPSBpdGVtQ291bnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKEdhbWUuaGVyby5kYXRhLml0ZW1zW2l0ZW1JZF0pIHtcbiAgICAgICAgICAgIEdhbWUuaGVyby5kYXRhLml0ZW1zW2l0ZW1JZF0gKz0gaXRlbUNvdW50O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS5pdGVtc1tpdGVtSWRdID0gaXRlbUNvdW50O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBkZWxldGUgaW5uZXJbaXRlbUlkXTtcbiAgICAgIH0pO1xuICAgICAgR2FtZS53aW5kb3dzLnBpY2t1cC5vcGVuKGl0ZW1PYmopO1xuICAgIH1cbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJhXCIsIFwiQVwiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIHBpY2t1cFdpbmRvd0FsbC5jbGljaygpO1xuICB9KTtcblxuICB3aW4ud2hlblVwKFtcImVzY1wiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgd2luLmhpZGUoKTtcbiAgICB9LCAyMCk7XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1wiMVwiLCBcIjJcIiwgXCIzXCIsIFwiNFwiLCBcIjVcIiwgXCI2XCIsIFwiN1wiLCBcIjhcIiwgXCI5XCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgbGV0IGJ1dHRvbnMgPSBwaWNrdXBXaW5kb3dUYWJsZS5xdWVyeVNlbGVjdG9yQWxsKFwiYnV0dG9uXCIpO1xuICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBidXR0b25zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBsZXQgYnV0dG9uSW5kZXggPSBidXR0b25zW2ldLmdldEF0dHJpYnV0ZShcImRhdGEtaW5kZXhcIik7XG4gICAgICBpZiAoYnV0dG9uSW5kZXgpIHtcbiAgICAgICAgaWYgKGJ1dHRvbkluZGV4ID09IGtleSkge1xuICAgICAgICAgIGJ1dHRvbnNbaV0uY2xpY2soKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgd2luLmFzc2lnbihcIm9wZW5cIiwgZnVuY3Rpb24gKGl0ZW1PYmosIHNlbGVjdCkge1xuICAgIGlmICh0eXBlb2Ygc2VsZWN0ID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHNlbGVjdCA9IC0xO1xuICAgIH1cblxuICAgIGxhc3RTZWxlY3QgPSBzZWxlY3Q7XG5cbiAgICBpZiAoIWl0ZW1PYmouaW5uZXIgfHwgT2JqZWN0LmtleXMoaXRlbU9iai5pbm5lcikubGVuZ3RoIDw9IDApIHtcbiAgICAgIGZvciAobGV0IGJhZyBvZiBHYW1lLmFyZWEuYmFncykge1xuICAgICAgICBpZiAoYmFnID09IGl0ZW1PYmopIHtcbiAgICAgICAgICBHYW1lLmFyZWEuYmFncy5kZWxldGUoYmFnKTtcbiAgICAgICAgICBpdGVtT2JqLmVyYXNlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIEdhbWUud2luZG93cy5waWNrdXAuaGlkZSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGN1cnJlbnRJdGVtT2JqID0gaXRlbU9iajtcblxuICAgIGxldCBpbmRleCA9IDE7XG4gICAgbGV0IHRhYmxlID0gXCJcIjtcbiAgICBTcHJpdGUuZWFjaChpdGVtT2JqLmlubmVyLCBmdW5jdGlvbiAoaXRlbUNvdW50LCBpdGVtSWQsIGlubmVyKSB7XG4gICAgICBsZXQgaXRlbSA9IEdhbWUuaXRlbXNbaXRlbUlkXTtcblxuICAgICAgbGV0IGxpbmUgPSBcIlwiO1xuXG4gICAgICBpZiAoc2VsZWN0ID09IChpbmRleCAtIDEpKSB7XG4gICAgICAgIGxpbmUgKz0gYDx0ciBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IGdyZWVuO1wiPlxcbmA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsaW5lICs9IGA8dHI+XFxuYDtcbiAgICAgIH1cblxuXG4gICAgICBpZiAoaXRlbS5pY29uKSB7XG4gICAgICAgIGxpbmUgKz0gYCAgPHRkPjxpbWcgYWx0PVwiXCIgc3JjPVwiJHtpdGVtLmljb24uc3JjfVwiPjwvdGQ+XFxuYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpbmUgKz0gYCAgPHRkPiA8L3RkPlxcbmA7XG4gICAgICB9XG4gICAgICBsaW5lICs9IGAgIDx0ZD4ke2l0ZW0uZGF0YS5uYW1lfTwvdGQ+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPHRkIHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyO1wiPiR7aXRlbS5kYXRhLnZhbHVlfUc8L3RkPlxcbmA7XG4gICAgICBsaW5lICs9IGAgIDx0ZCBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjtcIj4ke2l0ZW1Db3VudH08L3RkPlxcbmA7XG4gICAgICBsaW5lICs9IGAgIDx0ZD4ke2l0ZW0uZGF0YS5kZXNjcmlwdGlvbn08L3RkPlxcbmA7XG4gICAgICBsaW5lICs9IGAgIDx0ZD48YnV0dG9uIGRhdGEtaWQ9XCIke2l0ZW1JZH1cIiBkYXRhLWluZGV4PVwiJHtpbmRleH1cIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+JHtpbmRleDw9OT8oaW5kZXgpOlwiXCJ9IOaLv+WPljwvYnV0dG9uPjwvdGQ+XFxuYDtcblxuICAgICAgbGluZSArPSBcIjwvdHI+XFxuXCI7XG4gICAgICB0YWJsZSArPSBsaW5lO1xuICAgICAgaW5kZXgrKztcbiAgICB9KTtcblxuICAgIHBpY2t1cFdpbmRvd1RhYmxlLmlubmVySFRNTCA9IHRhYmxlO1xuICAgIEdhbWUud2luZG93cy5waWNrdXAuc2hvdygpO1xuICB9KTtcblxuICB3aW4ud2hlblVwKFtcImVudGVyXCJdLCBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGJ1dHRvbnMgPSBwaWNrdXBXaW5kb3dUYWJsZS5xdWVyeVNlbGVjdG9yQWxsKFwiYnV0dG9uXCIpO1xuICAgIGlmIChsYXN0U2VsZWN0ID49IDAgJiYgbGFzdFNlbGVjdCA8IGJ1dHRvbnMubGVuZ3RoKSB7XG4gICAgICBidXR0b25zW2xhc3RTZWxlY3RdLmNsaWNrKCk7XG4gICAgfVxuICB9KTtcblxuICB3aW4ud2hlblVwKFtcInVwXCIsIFwiZG93blwiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIGxldCBjb3VudCA9IHBpY2t1cFdpbmRvd1RhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b25cIikubGVuZ3RoO1xuXG4gICAgaWYgKGxhc3RTZWxlY3QgPT0gLTEpIHtcbiAgICAgIGlmIChrZXkgPT0gXCJkb3duXCIpIHtcbiAgICAgICAgd2luLm9wZW4oY3VycmVudEl0ZW1PYmosIDApO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT0gXCJ1cFwiKSB7XG4gICAgICAgIHdpbi5vcGVuKGN1cnJlbnRJdGVtT2JqLCBjb3VudCAtIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoa2V5ID09IFwiZG93blwiKSB7XG4gICAgICAgIGxldCBzZWxlY3QgPSBsYXN0U2VsZWN0ICsgMTtcbiAgICAgICAgaWYgKHNlbGVjdCA+PSBjb3VudCkge1xuICAgICAgICAgIHNlbGVjdCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgd2luLm9wZW4oY3VycmVudEl0ZW1PYmosIHNlbGVjdCk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PSBcInVwXCIpIHtcbiAgICAgICAgbGV0IHNlbGVjdCA9IGxhc3RTZWxlY3QgLSAxO1xuICAgICAgICBpZiAoc2VsZWN0IDwgMCkge1xuICAgICAgICAgIHNlbGVjdCA9IGNvdW50IC0gMTtcbiAgICAgICAgfVxuICAgICAgICB3aW4ub3BlbihjdXJyZW50SXRlbU9iaiwgc2VsZWN0KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHBpY2t1cFdpbmRvd1RhYmxlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBsZXQgaXRlbUlkID0gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZShcImRhdGEtaWRcIik7XG4gICAgaWYgKGl0ZW1JZCAmJiBjdXJyZW50SXRlbU9iai5pbm5lciAmJiBjdXJyZW50SXRlbU9iai5pbm5lci5oYXNPd25Qcm9wZXJ0eShpdGVtSWQpKSB7XG4gICAgICBsZXQgaXRlbUNvdW50ID0gY3VycmVudEl0ZW1PYmouaW5uZXJbaXRlbUlkXTtcbiAgICAgIGlmKGl0ZW1JZCA9PSBcImdvbGRcIikge1xuICAgICAgICBHYW1lLmhlcm8uZGF0YS5nb2xkICs9IGl0ZW1Db3VudDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChHYW1lLmhlcm8uZGF0YS5pdGVtcy5oYXNPd25Qcm9wZXJ0eShpdGVtSWQpKSB7XG4gICAgICAgICAgR2FtZS5oZXJvLmRhdGEuaXRlbXNbaXRlbUlkXSArPSBpdGVtQ291bnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgR2FtZS5oZXJvLmRhdGEuaXRlbXNbaXRlbUlkXSA9IGl0ZW1Db3VudDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZGVsZXRlIGN1cnJlbnRJdGVtT2JqLmlubmVyW2l0ZW1JZF07XG4gICAgICB3aW4ub3BlbihjdXJyZW50SXRlbU9iaik7XG4gICAgfVxuICB9KTtcblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.quest = Game.Window.create("questWindow");

  win.html = "\n    <div class=\"window-box\">\n      <div id=\"questWindowItemBar\">\n        <button id=\"questWindowClose\" class=\"brownButton\">关闭</button>\n        <button id=\"questWindowCurrent\" class=\"brownButton\">当前任务</button>\n        <button id=\"questWindowPast\" class=\"brownButton\">已完成</button>\n      </div>\n      <div id=\"questWindowTable\"></div>\n    </div>\n  ";

  win.css = "\n    #questWindowTable {\n      width: 100%;\n      overflow-y: auto;\n      height: 320px;\n    }\n\n    .questWindowItem {\n      border: 1px solid gray;\n      border-radius: 10px;\n      margin: 10px 10px;\n    }\n\n    .questWindowItem > button {\n      width: 100px;\n      height: 40px;\n      border-radius: 5px;\n    }\n\n    #questWindowItemBar button {\n      width: 100px;\n      height: 30px;\n      font-size: 16px;\n      margin-bottom: 5px;\n    }\n\n    #questWindowClose {\n      float: right;\n    }\n  ";

  var questWindowClose = win.querySelector("#questWindowClose");
  var questWindowCurrent = win.querySelector("#questWindowCurrent");
  var questWindowPast = win.querySelector("#questWindowPast");
  var questWindowTable = win.querySelector("#questWindowTable");

  questWindowClose.addEventListener("click", function () {
    win.hide();
  });

  win.whenUp(["esc"], function (key) {
    setTimeout(function () {
      questWindowClose.click();
    }, 20);
  });

  questWindowCurrent.addEventListener("click", function () {
    win.hide();
    win.current();
  });

  questWindowPast.addEventListener("click", function () {
    win.hide();
    win.past();
  });

  win.assign("current", function () {

    questWindowCurrent.disabled = true;
    questWindowPast.disabled = false;

    var table = "";
    var list = Game.hero.data.currentQuest;
    list.forEach(function (quest) {

      var complete = Game.Quest.isComplete(quest);

      var line = "<div class=\"questWindowItem\">\n";
      line += "  <label style=\"font-size: 20px; margin: 10px;\">" + quest.name + (complete ? "[已完成]" : "[未完成]") + "</label>\n";
      line += "  <div style=\"margin: 10px;\">简介：" + quest.description + "</div>\n";

      if (quest.reward) {
        line += "  <div style=\"margin: 10px;\">任务奖励：";
        if (quest.reward.gold) {
          line += "<label style=\"margin-right: 20px;\">金币：" + quest.reward.gold + "</label>";
        }
        if (quest.reward.exp) {
          line += "<label style=\"margin-right: 20px;\">经验：" + quest.reward.exp + "</label>";
        }
        line += "  </div>";
      }

      if (quest.target && quest.target.kill == "kill") {
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = quest.target.kill[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var k = _step.value;

            line += "<div style=\"margin: 10px;\">" + k.name + "：" + k.current + " / " + t.need + "</div>";
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator["return"]) {
              _iterator["return"]();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      }

      line += "  <label style=\"margin: 10px;\">给予人：" + quest.fromMap + " 的 " + quest.fromName + "</label>\n";
      line += "  <label style=\"margin: 10px;\">交付人：" + quest.toMap + " 的 " + quest.toName + "</label>\n";
      line += "</div>\n";
      table += line;
    });

    if (table.length <= 0) {
      table = "<div><label>没有正在进行的任务</label></div>";
    }

    questWindowTable.innerHTML = table;
    win.show();
  });

  win.assign("past", function () {

    questWindowCurrent.disabled = false;
    questWindowPast.disabled = true;

    var table = "";
    var list = Game.hero.data.completeQuest;
    list.forEach(function (quest) {

      var line = "<div class=\"questWindowItem\">\n";
      line += "  <label style=\"font-size: 20px; margin: 10px;\">" + quest.name + "[已完成]</label>\n";
      line += "  <div style=\"margin: 10px;\">简介：" + quest.description + "</div>\n";

      if (quest.reward) {
        line += "  <div style=\"margin: 10px;\">任务奖励：";
        if (quest.reward.gold) {
          line += "<label style=\"margin-right: 20px;\">金币：" + quest.reward.gold + "</label>";
        }
        if (quest.reward.exp) {
          line += "<label style=\"margin-right: 20px;\">经验：" + quest.reward.exp + "</label>";
        }
        line += "  </div>";
      }

      if (quest.target && quest.target.type == "kill") {
        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = quest.target.kill[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var k = _step2.value;

            line += "<div style=\"margin: 10px;\">" + k.name + "：" + k.current + " / " + t.need + "</div>";
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
              _iterator2["return"]();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }
      }

      line += "  <label style=\"margin: 10px;\">给予人：" + quest.fromMap + " 的 " + quest.fromName + "</label>\n";
      line += "  <label style=\"margin: 10px;\">交付人：" + quest.toMap + " 的 " + quest.toName + "</label>\n";
      line += "</div>\n";
      table += line;
    });

    if (table.length <= 0) {
      table = "<div><label>没有已完成任务</label></div>";
    }

    questWindowTable.innerHTML = table;
    win.show();
  });

  questWindowTable.addEventListener("click", function (event) {
    var id = event.target.getAttribute("data-id");
    if (id) {
      if (type == "remove") {
        Game.Archive.remove(id);
        win.open();
      } else if (type == "load") {
        Game.Archive.load(id);
        win.hide();
      }
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dRdWVzdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7QUFHYixNQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQzs7QUFFakUsS0FBRyxDQUFDLElBQUksMFhBU1AsQ0FBQzs7QUFFRixLQUFHLENBQUMsR0FBRyxnaEJBNkJOLENBQUM7O0FBRUYsTUFBSSxnQkFBZ0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLG1CQUFtQixDQUFDLENBQUM7QUFDOUQsTUFBSSxrQkFBa0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHFCQUFxQixDQUFDLENBQUM7QUFDbEUsTUFBSSxlQUFlLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQzVELE1BQUksZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDOztBQUc5RCxrQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUNyRCxPQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7R0FDWixDQUFDLENBQUM7O0FBRUgsS0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLFVBQVUsR0FBRyxFQUFFO0FBQ2pDLGNBQVUsQ0FBQyxZQUFZO0FBQ3JCLHNCQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDO0tBQzFCLEVBQUUsRUFBRSxDQUFDLENBQUM7R0FDUixDQUFDLENBQUM7O0FBRUgsb0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFlBQVk7QUFDdkQsT0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ1gsT0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO0dBQ2Ys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QUMsQ0FBQzs7QUFFSCxrQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDMUQsUUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDOUMsUUFBSSxFQUFFLEVBQUU7QUFDTixVQUFJLElBQUksSUFBSSxRQUFRLEVBQUU7QUFDcEIsWUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDeEIsV0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO09BQ1osTUFBTSxJQUFJLElBQUksSUFBSSxNQUFNLEVBQUU7QUFDekIsWUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDdEIsV0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO09BQ1o7S0FDRjtHQUNGLENBQUMsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVXaW5kb3dRdWVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG5cbiAgbGV0IHdpbiA9IEdhbWUud2luZG93cy5xdWVzdCA9IEdhbWUuV2luZG93LmNyZWF0ZShcInF1ZXN0V2luZG93XCIpO1xuXG4gIHdpbi5odG1sID0gYFxuICAgIDxkaXYgY2xhc3M9XCJ3aW5kb3ctYm94XCI+XG4gICAgICA8ZGl2IGlkPVwicXVlc3RXaW5kb3dJdGVtQmFyXCI+XG4gICAgICAgIDxidXR0b24gaWQ9XCJxdWVzdFdpbmRvd0Nsb3NlXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuWFs+mXrTwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGlkPVwicXVlc3RXaW5kb3dDdXJyZW50XCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuW9k+WJjeS7u+WKoTwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGlkPVwicXVlc3RXaW5kb3dQYXN0XCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuW3suWujOaIkDwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGlkPVwicXVlc3RXaW5kb3dUYWJsZVwiPjwvZGl2PlxuICAgIDwvZGl2PlxuICBgO1xuXG4gIHdpbi5jc3MgPSBgXG4gICAgI3F1ZXN0V2luZG93VGFibGUge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICBvdmVyZmxvdy15OiBhdXRvO1xuICAgICAgaGVpZ2h0OiAzMjBweDtcbiAgICB9XG5cbiAgICAucXVlc3RXaW5kb3dJdGVtIHtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIGdyYXk7XG4gICAgICBib3JkZXItcmFkaXVzOiAxMHB4O1xuICAgICAgbWFyZ2luOiAxMHB4IDEwcHg7XG4gICAgfVxuXG4gICAgLnF1ZXN0V2luZG93SXRlbSA+IGJ1dHRvbiB7XG4gICAgICB3aWR0aDogMTAwcHg7XG4gICAgICBoZWlnaHQ6IDQwcHg7XG4gICAgICBib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgfVxuXG4gICAgI3F1ZXN0V2luZG93SXRlbUJhciBidXR0b24ge1xuICAgICAgd2lkdGg6IDEwMHB4O1xuICAgICAgaGVpZ2h0OiAzMHB4O1xuICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgbWFyZ2luLWJvdHRvbTogNXB4O1xuICAgIH1cblxuICAgICNxdWVzdFdpbmRvd0Nsb3NlIHtcbiAgICAgIGZsb2F0OiByaWdodDtcbiAgICB9XG4gIGA7XG5cbiAgbGV0IHF1ZXN0V2luZG93Q2xvc2UgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNxdWVzdFdpbmRvd0Nsb3NlXCIpO1xuICBsZXQgcXVlc3RXaW5kb3dDdXJyZW50ID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjcXVlc3RXaW5kb3dDdXJyZW50XCIpO1xuICBsZXQgcXVlc3RXaW5kb3dQYXN0ID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjcXVlc3RXaW5kb3dQYXN0XCIpO1xuICBsZXQgcXVlc3RXaW5kb3dUYWJsZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI3F1ZXN0V2luZG93VGFibGVcIik7XG5cblxuICBxdWVzdFdpbmRvd0Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgd2luLmhpZGUoKTtcbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJlc2NcIl0sIGZ1bmN0aW9uIChrZXkpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHF1ZXN0V2luZG93Q2xvc2UuY2xpY2soKTtcbiAgICB9LCAyMCk7XG4gIH0pO1xuXG4gIHF1ZXN0V2luZG93Q3VycmVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgIHdpbi5oaWRlKCk7XG4gICAgd2luLmN1cnJlbnQoKTtcbiAgfSk7XG5cbiAgcXVlc3RXaW5kb3dQYXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgd2luLmhpZGUoKTtcbiAgICB3aW4ucGFzdCgpO1xuICB9KTtcblxuICB3aW4uYXNzaWduKFwiY3VycmVudFwiLCBmdW5jdGlvbiAoKSB7XG5cbiAgICBxdWVzdFdpbmRvd0N1cnJlbnQuZGlzYWJsZWQgPSB0cnVlO1xuICAgIHF1ZXN0V2luZG93UGFzdC5kaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgbGV0IHRhYmxlID0gXCJcIjtcbiAgICBsZXQgbGlzdCA9IEdhbWUuaGVyby5kYXRhLmN1cnJlbnRRdWVzdDtcbiAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24gKHF1ZXN0KSB7XG5cbiAgICAgIGxldCBjb21wbGV0ZSA9IEdhbWUuUXVlc3QuaXNDb21wbGV0ZShxdWVzdCk7XG5cbiAgICAgIGxldCBsaW5lID0gYDxkaXYgY2xhc3M9XCJxdWVzdFdpbmRvd0l0ZW1cIj5cXG5gO1xuICAgICAgbGluZSArPSBgICA8bGFiZWwgc3R5bGU9XCJmb250LXNpemU6IDIwcHg7IG1hcmdpbjogMTBweDtcIj4ke3F1ZXN0Lm5hbWV9JHtjb21wbGV0ZT9cIlvlt7LlrozmiJBdXCI6XCJb5pyq5a6M5oiQXVwifTwvbGFiZWw+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPGRpdiBzdHlsZT1cIm1hcmdpbjogMTBweDtcIj7nroDku4vvvJoke3F1ZXN0LmRlc2NyaXB0aW9ufTwvZGl2PlxcbmA7XG5cbiAgICAgIGlmIChxdWVzdC5yZXdhcmQpIHtcbiAgICAgICAgbGluZSArPSBgICA8ZGl2IHN0eWxlPVwibWFyZ2luOiAxMHB4O1wiPuS7u+WKoeWlluWKse+8mmA7XG4gICAgICAgIGlmIChxdWVzdC5yZXdhcmQuZ29sZCkge1xuICAgICAgICAgIGxpbmUgKz0gYDxsYWJlbCBzdHlsZT1cIm1hcmdpbi1yaWdodDogMjBweDtcIj7ph5HluIHvvJoke3F1ZXN0LnJld2FyZC5nb2xkfTwvbGFiZWw+YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAocXVlc3QucmV3YXJkLmV4cCkge1xuICAgICAgICAgIGxpbmUgKz0gYDxsYWJlbCBzdHlsZT1cIm1hcmdpbi1yaWdodDogMjBweDtcIj7nu4/pqozvvJoke3F1ZXN0LnJld2FyZC5leHB9PC9sYWJlbD5gO1xuICAgICAgICB9XG4gICAgICAgIGxpbmUgKz0gYCAgPC9kaXY+YDtcbiAgICAgIH1cblxuICAgICAgaWYgKHF1ZXN0LnRhcmdldCAmJiBxdWVzdC50YXJnZXQua2lsbCA9PSBcImtpbGxcIikge1xuICAgICAgICBmb3IgKGxldCBrIG9mIHF1ZXN0LnRhcmdldC5raWxsKSB7XG4gICAgICAgICAgbGluZSArPSBgPGRpdiBzdHlsZT1cIm1hcmdpbjogMTBweDtcIj4ke2submFtZX3vvJoke2suY3VycmVudH0gLyAke3QubmVlZH08L2Rpdj5gO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxpbmUgKz0gYCAgPGxhYmVsIHN0eWxlPVwibWFyZ2luOiAxMHB4O1wiPue7meS6iOS6uu+8miR7cXVlc3QuZnJvbU1hcH0g55qEICR7cXVlc3QuZnJvbU5hbWV9PC9sYWJlbD5cXG5gO1xuICAgICAgbGluZSArPSBgICA8bGFiZWwgc3R5bGU9XCJtYXJnaW46IDEwcHg7XCI+5Lqk5LuY5Lq677yaJHtxdWVzdC50b01hcH0g55qEICR7cXVlc3QudG9OYW1lfTwvbGFiZWw+XFxuYDtcbiAgICAgIGxpbmUgKz0gXCI8L2Rpdj5cXG5cIlxuICAgICAgdGFibGUgKz0gbGluZTtcbiAgICB9KTtcblxuICAgIGlmICh0YWJsZS5sZW5ndGggPD0gMCkge1xuICAgICAgdGFibGUgPSBcIjxkaXY+PGxhYmVsPuayoeacieato+WcqOi/m+ihjOeahOS7u+WKoTwvbGFiZWw+PC9kaXY+XCI7XG4gICAgfVxuXG4gICAgcXVlc3RXaW5kb3dUYWJsZS5pbm5lckhUTUwgPSB0YWJsZTtcbiAgICB3aW4uc2hvdygpO1xuICB9KTtcblxuICB3aW4uYXNzaWduKFwicGFzdFwiLCBmdW5jdGlvbiAoKSB7XG5cbiAgICBxdWVzdFdpbmRvd0N1cnJlbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBxdWVzdFdpbmRvd1Bhc3QuZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgbGV0IHRhYmxlID0gXCJcIjtcbiAgICBsZXQgbGlzdCA9IEdhbWUuaGVyby5kYXRhLmNvbXBsZXRlUXVlc3Q7XG4gICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChxdWVzdCkge1xuXG4gICAgICBsZXQgbGluZSA9IGA8ZGl2IGNsYXNzPVwicXVlc3RXaW5kb3dJdGVtXCI+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPGxhYmVsIHN0eWxlPVwiZm9udC1zaXplOiAyMHB4OyBtYXJnaW46IDEwcHg7XCI+JHtxdWVzdC5uYW1lfVvlt7LlrozmiJBdPC9sYWJlbD5cXG5gO1xuICAgICAgbGluZSArPSBgICA8ZGl2IHN0eWxlPVwibWFyZ2luOiAxMHB4O1wiPueugOS7i++8miR7cXVlc3QuZGVzY3JpcHRpb259PC9kaXY+XFxuYDtcblxuICAgICAgaWYgKHF1ZXN0LnJld2FyZCkge1xuICAgICAgICBsaW5lICs9IGAgIDxkaXYgc3R5bGU9XCJtYXJnaW46IDEwcHg7XCI+5Lu75Yqh5aWW5Yqx77yaYDtcbiAgICAgICAgaWYgKHF1ZXN0LnJld2FyZC5nb2xkKSB7XG4gICAgICAgICAgbGluZSArPSBgPGxhYmVsIHN0eWxlPVwibWFyZ2luLXJpZ2h0OiAyMHB4O1wiPumHkeW4ge+8miR7cXVlc3QucmV3YXJkLmdvbGR9PC9sYWJlbD5gO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVzdC5yZXdhcmQuZXhwKSB7XG4gICAgICAgICAgbGluZSArPSBgPGxhYmVsIHN0eWxlPVwibWFyZ2luLXJpZ2h0OiAyMHB4O1wiPue7j+mqjO+8miR7cXVlc3QucmV3YXJkLmV4cH08L2xhYmVsPmA7XG4gICAgICAgIH1cbiAgICAgICAgbGluZSArPSBgICA8L2Rpdj5gO1xuICAgICAgfVxuXG4gICAgICBpZiAocXVlc3QudGFyZ2V0ICYmIHF1ZXN0LnRhcmdldC50eXBlID09IFwia2lsbFwiKSB7XG4gICAgICAgIGZvciAobGV0IGsgb2YgcXVlc3QudGFyZ2V0LmtpbGwpIHtcbiAgICAgICAgICBsaW5lICs9IGA8ZGl2IHN0eWxlPVwibWFyZ2luOiAxMHB4O1wiPiR7ay5uYW1lfe+8miR7ay5jdXJyZW50fSAvICR7dC5uZWVkfTwvZGl2PmA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbGluZSArPSBgICA8bGFiZWwgc3R5bGU9XCJtYXJnaW46IDEwcHg7XCI+57uZ5LqI5Lq677yaJHtxdWVzdC5mcm9tTWFwfSDnmoQgJHtxdWVzdC5mcm9tTmFtZX08L2xhYmVsPlxcbmA7XG4gICAgICBsaW5lICs9IGAgIDxsYWJlbCBzdHlsZT1cIm1hcmdpbjogMTBweDtcIj7kuqTku5jkurrvvJoke3F1ZXN0LnRvTWFwfSDnmoQgJHtxdWVzdC50b05hbWV9PC9sYWJlbD5cXG5gO1xuICAgICAgbGluZSArPSBcIjwvZGl2PlxcblwiXG4gICAgICB0YWJsZSArPSBsaW5lO1xuICAgIH0pO1xuXG4gICAgaWYgKHRhYmxlLmxlbmd0aCA8PSAwKSB7XG4gICAgICB0YWJsZSA9IFwiPGRpdj48bGFiZWw+5rKh5pyJ5bey5a6M5oiQ5Lu75YqhPC9sYWJlbD48L2Rpdj5cIjtcbiAgICB9XG5cbiAgICBxdWVzdFdpbmRvd1RhYmxlLmlubmVySFRNTCA9IHRhYmxlO1xuICAgIHdpbi5zaG93KCk7XG4gIH0pO1xuXG4gIHF1ZXN0V2luZG93VGFibGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIGxldCBpZCA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIpO1xuICAgIGlmIChpZCkge1xuICAgICAgaWYgKHR5cGUgPT0gXCJyZW1vdmVcIikge1xuICAgICAgICBHYW1lLkFyY2hpdmUucmVtb3ZlKGlkKTtcbiAgICAgICAgd2luLm9wZW4oKTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcImxvYWRcIikge1xuICAgICAgICBHYW1lLkFyY2hpdmUubG9hZChpZCk7XG4gICAgICAgIHdpbi5oaWRlKCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.register = Game.Window.create("registerWindow");

  win.html = "\n    <div style=\"overflow-y: scroll; height: 100%; position: fixed; width: 100%;\">\n      <div>\n        <label>\n        性别\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"sex\" class=\"\">\n          <option value=\"male\">男性</option>\n          <option value=\"female\">女性</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        皮肤\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"body\" class=\"\">\n          <option value=\"light\">粉白</option>\n          <option value=\"dark\">深色</option>\n          <option value=\"dark2\">更深</option>\n          <option value=\"tanned\">黄白</option>\n          <option value=\"tanned2\">黄灰</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        眼睛\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"eyes\" class=\"\">\n          <option value=\"blue\">蓝色</option>\n          <option value=\"brown\">棕色</option>\n          <option value=\"gray\">灰色</option>\n          <option value=\"green\">绿色</option>\n          <option value=\"orange\">橙色</option>\n          <option value=\"purple\">紫色</option>\n          <option value=\"red\">红色</option>\n          <option value=\"yellow\">黄色</option>\n        </select>\n      </div>\n\n      <div id=\"customMaleHair\">\n        <label>\n        头发\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"hair\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"bedhead\">Bedhead</option>\n          <option value=\"long\">Long</option>\n          <option value=\"longhawk\">Longhawk</option>\n          <option value=\"messy1\">messy1</option>\n          <option value=\"messy2\">messy2</option>\n          <option value=\"mohawk\">Mohawk</option>\n          <option value=\"page\">Page</option>\n          <option value=\"parted\">Parted</option>\n          <option value=\"plain\">Plain</option>\n          <option value=\"shorthawk\">Shorthawk</option>\n        </select>\n      </div>\n\n      <div id=\"customFemaleHair\" style=\"display: none;\">\n        <label>\n        头发\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"hair\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"bangs\">bangs</option>\n          <option value=\"bangslong\">bangslong</option>\n          <option value=\"bangslong2\">bangslong2</option>\n          <option value=\"bunches\">bunches</option>\n          <option value=\"loose\">loose</option>\n          <option value=\"pixie\">pixie</option>\n          <option value=\"ponytail\">ponytail</option>\n          <option value=\"ponytail2\">ponytail2</option>\n          <option value=\"princess\">princess</option>\n          <option value=\"shoulderl\">shoulderl</option>\n          <option value=\"shoulderr\">shoulderr</option>\n          <option value=\"swoop\">swoop</option>\n          <option value=\"unkempt\">unkempt</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        发色\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"haircolor\" class=\"\">\n          <option value=\"black\">Black</option>\n          <option value=\"blonde\">Blonde</option>\n          <option value=\"blonde2\">blonde2</option>\n          <option value=\"blue\">blue</option>\n          <option value=\"blue2\">blue2</option>\n          <option value=\"brown\">brown</option>\n          <option value=\"brown2\">brown2</option>\n          <option value=\"brunette\">brunette</option>\n          <option value=\"brunette2\">brunette2</option>\n          <option value=\"dark-blonde\">dark-blonde</option>\n          <option value=\"gold\">gold</option>\n          <option value=\"gray\">gray</option>\n          <option value=\"gray2\">gray2</option>\n          <option value=\"green\">green</option>\n          <option value=\"green2\">green2</option>\n          <option value=\"light-blonde\">light-blonde</option>\n          <option value=\"light-blonde2\">light-blonde2</option>\n          <option value=\"pink\">pink</option>\n          <option value=\"pink2\">pink2</option>\n          <option value=\"purple\">purple</option>\n          <option value=\"raven\">raven</option>\n          <option value=\"raven2\">raven2</option>\n          <option value=\"redhead\">redhead</option>\n          <option value=\"redhead2\">redhead2</option>\n          <option value=\"ruby-red\">ruby-red</option>\n          <option value=\"white\">white</option>\n          <option value=\"white-blonde\">white-blonde</option>\n          <option value=\"white-blonde2\">white-blonde2</option>\n          <option value=\"white.centerYan\">white.centerYan</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        帽子\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"head\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"chainhat\">chainhat</option>\n          <option value=\"chain_hood\">chain_hood</option>\n          <option value=\"cloth_hood\">cloth_hood</option>\n          <option value=\"leather_cap\">leather_cap</option>\n          <option value=\"red\">red</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        上衣\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"shirts\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"brown\">brown</option>\n          <option value=\"maroon\">maroon</option>\n          <option value=\"teal\">teal</option>\n          <option value=\"white\">white</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        裤子\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"pants\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"magenta\">magenta</option>\n          <option value=\"red\">red</option>\n          <option value=\"teal\">teal</option>\n          <option value=\"white\">white</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        鞋子\n        </label>\n        <select onchange=\"SelectHero(event)\"  data-type=\"shoes\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"black\">black</option>\n          <option value=\"brown\">brown</option>\n          <option value=\"maroon\">maroon</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        头盔\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"armorhelms\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"golden\">黄金</option>\n          <option value=\"metal\">白银</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        胸甲\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"armorchest\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"golden\">黄金</option>\n          <option value=\"metal\">白银</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        臂甲\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"armorarm\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"golden\">黄金</option>\n          <option value=\"metal\">白银</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        腿甲\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"armorlegs\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"golden\">黄金</option>\n          <option value=\"metal\">白银</option>\n        </select>\n      </div>\n\n      <div>\n        <label>\n        足甲\n        </label>\n        <select onchange=\"SelectHero(event)\" data-type=\"armorfeet\" class=\"\">\n          <option value=\"\">无</option>\n          <option value=\"golden\">黄金</option>\n          <option value=\"metal\">白银</option>\n        </select>\n      </div>\n\n      <hr>\n\n      <div>\n        <label>\n        信仰\n        </label>\n        <select id=\"registerWindowBeliefChoice\" onchange=\"ChoiceHero(event)\" data-type=\"belief\">\n          <option value=\"None\">无信仰</option>\n          <option value=\"Elen\">艾琳 - 知识女神</option>\n          <option value=\"Enlon\">恩朗 - 死亡主宰</option>\n          <option value=\"Minare\">密娜 - 丰收女神</option>\n          <option value=\"Achiel\">阿切奥 - 保护之神</option>\n          <option value=\"Racha\">拉克 - 魔法女神</option>\n          <option value=\"Aestor\">阿斯托 - 盗贼之神</option>\n          <option value=\"Hielach\">赫拉克 - 财富之神</option>\n          <option value=\"Alik\">阿丽克 - 治愈女神</option>\n          <option value=\"Amarien\">阿玛恩 - 力量之神</option>\n        </select>\n        <div id=\"registerWindowBelief\"></div>\n      </div>\n\n      <div>\n        <label>\n        职业\n        </label>\n        <select id=\"registerWindowClassChoice\" onchange=\"ChoiceHero(event)\" data-type=\"class\">\n          <option value=\"warrior\">战士</option>\n          <option value=\"archer\">弓箭手</option>\n          <option value=\"wizard\">魔法师</option>\n          <option value=\"priest\">牧师</option>\n          <option value=\"bard\">吟游诗人</option>\n          <option value=\"thief\">盗贼</option>\n          <option value=\"business\">商人</option>\n        </select>\n        <div id=\"registerWindowClass\"></div>\n      </div>\n\n      <div>\n        <input id=\"registerHeroName\" placeholder=\"名字\" type=\"text\">\n      </div>\n\n      <div style=\"padding-bottom: 20px; padding-top: 10px;\">\n        <button id=\"registerWindowSubmit\" class=\"brownButton\">完成</button>\n        <button id=\"registerWindowBack\" class=\"brownButton\">返回</button>\n      </div>\n\n    </div>\n\n    <div style=\"position: fixed; height: 250px; width: 64px; left: 50px; top: 70px;\">\n      <label id=\"loading\">正在载入预览</label>\n      <br>\n      <canvas id=\"registerPreview\" width=\"64\" height=\"250\"></canvas>\n    </div>\n  ";

  win.css = "\n\n    #registerWindowBelief, #registerWindowClass {\n      text-align: left;\n      margin-left: 310px;\n      width: 400px;\n    }\n\n    .registerWindow table, .registerWindow tbody, .registerWindow tr {\n      width: 100%;\n      height: 100%;\n      margin: 0;\n      padding: 0;\n    }\n\n    #registerWindowSubmit, #registerWindowBack {\n      width: 100px;\n      height: 60px;\n    }\n\n    .registerWindow {\n      text-align: center;\n      height: 412px;\n      background-color: rgba(240, 217, 194, 0.85);\n      border: 20px solid rgba(134, 93, 52, 0.85);\n    }\n\n    .registerWindow input {\n      width: 240px;\n      height: 40px;\n      -webkit-border-radius: 5px;\n      -moz-border-radius: 5px;\n      border-radius: 5px;\n      text-align: center;\n      font-size: 16px;\n      background-color: #d5ab63;\n      margin: 10px;\n    }\n\n    .registerWindow label {\n      font-size: 20px;\n      color: white;\n    }\n\n    .registerWindow select {\n      -webkit-appearance: none;\n      -moz-appearance: none;\n      appearance: none;\n      width: 200px;\n      height: 40px;\n      -webkit-border-radius: 5px;\n      -moz-border-radius: 5px;\n      border-radius: 5px;\n      text-align: center;\n      font-size: 16px;\n      background-color: #d5ab63;\n      margin: 10px;\n    }\n  ";

  var registerWindowSubmit = win.querySelector("#registerWindowSubmit");
  var registerWindowBack = win.querySelector("#registerWindowBack");

  registerWindowSubmit.addEventListener("click", function () {
    Game.register.submit();
  });

  registerWindowBack.addEventListener("click", function () {
    win.hide();
    Game.windows.main.show();
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dSZWdpc3Rlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7QUFFYixNQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDOztBQUV2RSxLQUFHLENBQUMsSUFBSSxnMVRBdVJQLENBQUM7O0FBRUYsS0FBRyxDQUFDLEdBQUcsc3lDQTBETixDQUFDOztBQUVGLE1BQUksb0JBQW9CLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ3RFLE1BQUksa0JBQWtCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDOztBQUVsRSxzQkFBb0IsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUN6RCxRQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO0dBQ3hCLENBQUMsQ0FBQzs7QUFFSCxvQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUN2RCxPQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWCxRQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztHQUMxQixDQUFDLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93UmVnaXN0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgd2luID0gR2FtZS53aW5kb3dzLnJlZ2lzdGVyID0gR2FtZS5XaW5kb3cuY3JlYXRlKFwicmVnaXN0ZXJXaW5kb3dcIik7XG5cbiAgd2luLmh0bWwgPSBgXG4gICAgPGRpdiBzdHlsZT1cIm92ZXJmbG93LXk6IHNjcm9sbDsgaGVpZ2h0OiAxMDAlOyBwb3NpdGlvbjogZml4ZWQ7IHdpZHRoOiAxMDAlO1wiPlxuICAgICAgPGRpdj5cbiAgICAgICAgPGxhYmVsPlxuICAgICAgICDmgKfliKtcbiAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgPHNlbGVjdCBvbmNoYW5nZT1cIlNlbGVjdEhlcm8oZXZlbnQpXCIgZGF0YS10eXBlPVwic2V4XCIgY2xhc3M9XCJcIj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwibWFsZVwiPueUt+aApzwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJmZW1hbGVcIj7lpbPmgKc8L29wdGlvbj5cbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdj5cbiAgICAgICAgPGxhYmVsPlxuICAgICAgICDnmq7ogqRcbiAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgPHNlbGVjdCBvbmNoYW5nZT1cIlNlbGVjdEhlcm8oZXZlbnQpXCIgZGF0YS10eXBlPVwiYm9keVwiIGNsYXNzPVwiXCI+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImxpZ2h0XCI+57KJ55m9PC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImRhcmtcIj7mt7HoibI8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiZGFyazJcIj7mm7Tmt7E8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwidGFubmVkXCI+6buE55m9PC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInRhbm5lZDJcIj7pu4TngbA8L29wdGlvbj5cbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdj5cbiAgICAgICAgPGxhYmVsPlxuICAgICAgICDnnLznnZtcbiAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgPHNlbGVjdCBvbmNoYW5nZT1cIlNlbGVjdEhlcm8oZXZlbnQpXCIgZGF0YS10eXBlPVwiZXllc1wiIGNsYXNzPVwiXCI+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImJsdWVcIj7ok53oibI8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYnJvd25cIj7mo5XoibI8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiZ3JheVwiPueBsOiJsjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJncmVlblwiPue7v+iJsjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJvcmFuZ2VcIj7mqZnoibI8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwicHVycGxlXCI+57Sr6ImyPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInJlZFwiPue6ouiJsjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJ5ZWxsb3dcIj7pu4ToibI8L29wdGlvbj5cbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBpZD1cImN1c3RvbU1hbGVIYWlyXCI+XG4gICAgICAgIDxsYWJlbD5cbiAgICAgICAg5aS05Y+RXG4gICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDxzZWxlY3Qgb25jaGFuZ2U9XCJTZWxlY3RIZXJvKGV2ZW50KVwiIGRhdGEtdHlwZT1cImhhaXJcIiBjbGFzcz1cIlwiPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj7ml6A8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYmVkaGVhZFwiPkJlZGhlYWQ8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwibG9uZ1wiPkxvbmc8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwibG9uZ2hhd2tcIj5Mb25naGF3azwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJtZXNzeTFcIj5tZXNzeTE8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwibWVzc3kyXCI+bWVzc3kyPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIm1vaGF3a1wiPk1vaGF3azwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJwYWdlXCI+UGFnZTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJwYXJ0ZWRcIj5QYXJ0ZWQ8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwicGxhaW5cIj5QbGFpbjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJzaG9ydGhhd2tcIj5TaG9ydGhhd2s8L29wdGlvbj5cbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBpZD1cImN1c3RvbUZlbWFsZUhhaXJcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+XG4gICAgICAgIDxsYWJlbD5cbiAgICAgICAg5aS05Y+RXG4gICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDxzZWxlY3Qgb25jaGFuZ2U9XCJTZWxlY3RIZXJvKGV2ZW50KVwiIGRhdGEtdHlwZT1cImhhaXJcIiBjbGFzcz1cIlwiPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj7ml6A8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYmFuZ3NcIj5iYW5nczwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJiYW5nc2xvbmdcIj5iYW5nc2xvbmc8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYmFuZ3Nsb25nMlwiPmJhbmdzbG9uZzI8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYnVuY2hlc1wiPmJ1bmNoZXM8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwibG9vc2VcIj5sb29zZTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJwaXhpZVwiPnBpeGllPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInBvbnl0YWlsXCI+cG9ueXRhaWw8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwicG9ueXRhaWwyXCI+cG9ueXRhaWwyPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInByaW5jZXNzXCI+cHJpbmNlc3M8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwic2hvdWxkZXJsXCI+c2hvdWxkZXJsPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInNob3VsZGVyclwiPnNob3VsZGVycjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJzd29vcFwiPnN3b29wPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInVua2VtcHRcIj51bmtlbXB0PC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxkaXY+XG4gICAgICAgIDxsYWJlbD5cbiAgICAgICAg5Y+R6ImyXG4gICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDxzZWxlY3Qgb25jaGFuZ2U9XCJTZWxlY3RIZXJvKGV2ZW50KVwiIGRhdGEtdHlwZT1cImhhaXJjb2xvclwiIGNsYXNzPVwiXCI+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImJsYWNrXCI+QmxhY2s8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYmxvbmRlXCI+QmxvbmRlPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImJsb25kZTJcIj5ibG9uZGUyPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImJsdWVcIj5ibHVlPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImJsdWUyXCI+Ymx1ZTI8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYnJvd25cIj5icm93bjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJicm93bjJcIj5icm93bjI8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYnJ1bmV0dGVcIj5icnVuZXR0ZTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJicnVuZXR0ZTJcIj5icnVuZXR0ZTI8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiZGFyay1ibG9uZGVcIj5kYXJrLWJsb25kZTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJnb2xkXCI+Z29sZDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJncmF5XCI+Z3JheTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJncmF5MlwiPmdyYXkyPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImdyZWVuXCI+Z3JlZW48L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiZ3JlZW4yXCI+Z3JlZW4yPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImxpZ2h0LWJsb25kZVwiPmxpZ2h0LWJsb25kZTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJsaWdodC1ibG9uZGUyXCI+bGlnaHQtYmxvbmRlMjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJwaW5rXCI+cGluazwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJwaW5rMlwiPnBpbmsyPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInB1cnBsZVwiPnB1cnBsZTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJyYXZlblwiPnJhdmVuPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInJhdmVuMlwiPnJhdmVuMjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJyZWRoZWFkXCI+cmVkaGVhZDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJyZWRoZWFkMlwiPnJlZGhlYWQyPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInJ1YnktcmVkXCI+cnVieS1yZWQ8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwid2hpdGVcIj53aGl0ZTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJ3aGl0ZS1ibG9uZGVcIj53aGl0ZS1ibG9uZGU8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwid2hpdGUtYmxvbmRlMlwiPndoaXRlLWJsb25kZTI8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwid2hpdGUuY2VudGVyWWFuXCI+d2hpdGUuY2VudGVyWWFuPC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxkaXY+XG4gICAgICAgIDxsYWJlbD5cbiAgICAgICAg5bi95a2QXG4gICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDxzZWxlY3Qgb25jaGFuZ2U9XCJTZWxlY3RIZXJvKGV2ZW50KVwiIGRhdGEtdHlwZT1cImhlYWRcIiBjbGFzcz1cIlwiPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj7ml6A8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiY2hhaW5oYXRcIj5jaGFpbmhhdDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJjaGFpbl9ob29kXCI+Y2hhaW5faG9vZDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJjbG90aF9ob29kXCI+Y2xvdGhfaG9vZDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJsZWF0aGVyX2NhcFwiPmxlYXRoZXJfY2FwPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cInJlZFwiPnJlZDwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgIOS4iuiho1xuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8c2VsZWN0IG9uY2hhbmdlPVwiU2VsZWN0SGVybyhldmVudClcIiBkYXRhLXR5cGU9XCJzaGlydHNcIiBjbGFzcz1cIlwiPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj7ml6A8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYnJvd25cIj5icm93bjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJtYXJvb25cIj5tYXJvb248L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwidGVhbFwiPnRlYWw8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwid2hpdGVcIj53aGl0ZTwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgIOijpOWtkFxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8c2VsZWN0IG9uY2hhbmdlPVwiU2VsZWN0SGVybyhldmVudClcIiBkYXRhLXR5cGU9XCJwYW50c1wiIGNsYXNzPVwiXCI+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIlwiPuaXoDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJtYWdlbnRhXCI+bWFnZW50YTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJyZWRcIj5yZWQ8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwidGVhbFwiPnRlYWw8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwid2hpdGVcIj53aGl0ZTwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgIOmei+WtkFxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8c2VsZWN0IG9uY2hhbmdlPVwiU2VsZWN0SGVybyhldmVudClcIiAgZGF0YS10eXBlPVwic2hvZXNcIiBjbGFzcz1cIlwiPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj7ml6A8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYmxhY2tcIj5ibGFjazwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJicm93blwiPmJyb3duPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIm1hcm9vblwiPm1hcm9vbjwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgIOWktOeblFxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8c2VsZWN0IG9uY2hhbmdlPVwiU2VsZWN0SGVybyhldmVudClcIiBkYXRhLXR5cGU9XCJhcm1vcmhlbG1zXCIgY2xhc3M9XCJcIj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiXCI+5pegPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImdvbGRlblwiPum7hOmHkTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJtZXRhbFwiPueZvemTtjwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgIOiDuOeUslxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8c2VsZWN0IG9uY2hhbmdlPVwiU2VsZWN0SGVybyhldmVudClcIiBkYXRhLXR5cGU9XCJhcm1vcmNoZXN0XCIgY2xhc3M9XCJcIj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiXCI+5pegPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImdvbGRlblwiPum7hOmHkTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJtZXRhbFwiPueZvemTtjwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgIOiHgueUslxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8c2VsZWN0IG9uY2hhbmdlPVwiU2VsZWN0SGVybyhldmVudClcIiBkYXRhLXR5cGU9XCJhcm1vcmFybVwiIGNsYXNzPVwiXCI+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIlwiPuaXoDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJnb2xkZW5cIj7pu4Tph5E8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwibWV0YWxcIj7nmb3pk7Y8L29wdGlvbj5cbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdj5cbiAgICAgICAgPGxhYmVsPlxuICAgICAgICDohb/nlLJcbiAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgPHNlbGVjdCBvbmNoYW5nZT1cIlNlbGVjdEhlcm8oZXZlbnQpXCIgZGF0YS10eXBlPVwiYXJtb3JsZWdzXCIgY2xhc3M9XCJcIj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiXCI+5pegPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImdvbGRlblwiPum7hOmHkTwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJtZXRhbFwiPueZvemTtjwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgIOi2s+eUslxuICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8c2VsZWN0IG9uY2hhbmdlPVwiU2VsZWN0SGVybyhldmVudClcIiBkYXRhLXR5cGU9XCJhcm1vcmZlZXRcIiBjbGFzcz1cIlwiPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJcIj7ml6A8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiZ29sZGVuXCI+6buE6YeRPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIm1ldGFsXCI+55m96ZO2PC9vcHRpb24+XG4gICAgICAgIDwvc2VsZWN0PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxocj5cblxuICAgICAgPGRpdj5cbiAgICAgICAgPGxhYmVsPlxuICAgICAgICDkv6Hku7BcbiAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgPHNlbGVjdCBpZD1cInJlZ2lzdGVyV2luZG93QmVsaWVmQ2hvaWNlXCIgb25jaGFuZ2U9XCJDaG9pY2VIZXJvKGV2ZW50KVwiIGRhdGEtdHlwZT1cImJlbGllZlwiPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJOb25lXCI+5peg5L+h5LuwPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIkVsZW5cIj7oib7nkLMgLSDnn6Xor4blpbPnpZ48L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiRW5sb25cIj7mganmnJcgLSDmrbvkuqHkuLvlrrA8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiTWluYXJlXCI+5a+G5aicIC0g5Liw5pS25aWz56WePC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIkFjaGllbFwiPumYv+WIh+WlpSAtIOS/neaKpOS5i+elnjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJSYWNoYVwiPuaLieWFiyAtIOmtlOazleWls+elnjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJBZXN0b3JcIj7pmL/mlq/miZggLSDnm5fotLzkuYvnpZ48L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiSGllbGFjaFwiPui1q+aLieWFiyAtIOi0ouWvjOS5i+elnjwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJBbGlrXCI+6Zi/5Li95YWLIC0g5rK75oSI5aWz56WePC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIkFtYXJpZW5cIj7pmL/njpvmgakgLSDlipvph4/kuYvnpZ48L29wdGlvbj5cbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgICAgIDxkaXYgaWQ9XCJyZWdpc3RlcldpbmRvd0JlbGllZlwiPjwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxkaXY+XG4gICAgICAgIDxsYWJlbD5cbiAgICAgICAg6IGM5LiaXG4gICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDxzZWxlY3QgaWQ9XCJyZWdpc3RlcldpbmRvd0NsYXNzQ2hvaWNlXCIgb25jaGFuZ2U9XCJDaG9pY2VIZXJvKGV2ZW50KVwiIGRhdGEtdHlwZT1cImNsYXNzXCI+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIndhcnJpb3JcIj7miJjlo6s8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYXJjaGVyXCI+5byT566t5omLPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIndpemFyZFwiPumtlOazleW4iDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJwcmllc3RcIj7niafluIg8L29wdGlvbj5cbiAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiYmFyZFwiPuWQn+a4uOivl+S6ujwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJ0aGllZlwiPuebl+i0vDwvb3B0aW9uPlxuICAgICAgICAgIDxvcHRpb24gdmFsdWU9XCJidXNpbmVzc1wiPuWVhuS6ujwvb3B0aW9uPlxuICAgICAgICA8L3NlbGVjdD5cbiAgICAgICAgPGRpdiBpZD1cInJlZ2lzdGVyV2luZG93Q2xhc3NcIj48L2Rpdj5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2PlxuICAgICAgICA8aW5wdXQgaWQ9XCJyZWdpc3Rlckhlcm9OYW1lXCIgcGxhY2Vob2xkZXI9XCLlkI3lrZdcIiB0eXBlPVwidGV4dFwiPlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxkaXYgc3R5bGU9XCJwYWRkaW5nLWJvdHRvbTogMjBweDsgcGFkZGluZy10b3A6IDEwcHg7XCI+XG4gICAgICAgIDxidXR0b24gaWQ9XCJyZWdpc3RlcldpbmRvd1N1Ym1pdFwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7lrozmiJA8L2J1dHRvbj5cbiAgICAgICAgPGJ1dHRvbiBpZD1cInJlZ2lzdGVyV2luZG93QmFja1wiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7ov5Tlm548L2J1dHRvbj5cbiAgICAgIDwvZGl2PlxuXG4gICAgPC9kaXY+XG5cbiAgICA8ZGl2IHN0eWxlPVwicG9zaXRpb246IGZpeGVkOyBoZWlnaHQ6IDI1MHB4OyB3aWR0aDogNjRweDsgbGVmdDogNTBweDsgdG9wOiA3MHB4O1wiPlxuICAgICAgPGxhYmVsIGlkPVwibG9hZGluZ1wiPuato+WcqOi9veWFpemihOiniDwvbGFiZWw+XG4gICAgICA8YnI+XG4gICAgICA8Y2FudmFzIGlkPVwicmVnaXN0ZXJQcmV2aWV3XCIgd2lkdGg9XCI2NFwiIGhlaWdodD1cIjI1MFwiPjwvY2FudmFzPlxuICAgIDwvZGl2PlxuICBgO1xuXG4gIHdpbi5jc3MgPSBgXG5cbiAgICAjcmVnaXN0ZXJXaW5kb3dCZWxpZWYsICNyZWdpc3RlcldpbmRvd0NsYXNzIHtcbiAgICAgIHRleHQtYWxpZ246IGxlZnQ7XG4gICAgICBtYXJnaW4tbGVmdDogMzEwcHg7XG4gICAgICB3aWR0aDogNDAwcHg7XG4gICAgfVxuXG4gICAgLnJlZ2lzdGVyV2luZG93IHRhYmxlLCAucmVnaXN0ZXJXaW5kb3cgdGJvZHksIC5yZWdpc3RlcldpbmRvdyB0ciB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgIG1hcmdpbjogMDtcbiAgICAgIHBhZGRpbmc6IDA7XG4gICAgfVxuXG4gICAgI3JlZ2lzdGVyV2luZG93U3VibWl0LCAjcmVnaXN0ZXJXaW5kb3dCYWNrIHtcbiAgICAgIHdpZHRoOiAxMDBweDtcbiAgICAgIGhlaWdodDogNjBweDtcbiAgICB9XG5cbiAgICAucmVnaXN0ZXJXaW5kb3cge1xuICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgaGVpZ2h0OiA0MTJweDtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjQwLCAyMTcsIDE5NCwgMC44NSk7XG4gICAgICBib3JkZXI6IDIwcHggc29saWQgcmdiYSgxMzQsIDkzLCA1MiwgMC44NSk7XG4gICAgfVxuXG4gICAgLnJlZ2lzdGVyV2luZG93IGlucHV0IHtcbiAgICAgIHdpZHRoOiAyNDBweDtcbiAgICAgIGhlaWdodDogNDBweDtcbiAgICAgIC13ZWJraXQtYm9yZGVyLXJhZGl1czogNXB4O1xuICAgICAgLW1vei1ib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgICBib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZDVhYjYzO1xuICAgICAgbWFyZ2luOiAxMHB4O1xuICAgIH1cblxuICAgIC5yZWdpc3RlcldpbmRvdyBsYWJlbCB7XG4gICAgICBmb250LXNpemU6IDIwcHg7XG4gICAgICBjb2xvcjogd2hpdGU7XG4gICAgfVxuXG4gICAgLnJlZ2lzdGVyV2luZG93IHNlbGVjdCB7XG4gICAgICAtd2Via2l0LWFwcGVhcmFuY2U6IG5vbmU7XG4gICAgICAtbW96LWFwcGVhcmFuY2U6IG5vbmU7XG4gICAgICBhcHBlYXJhbmNlOiBub25lO1xuICAgICAgd2lkdGg6IDIwMHB4O1xuICAgICAgaGVpZ2h0OiA0MHB4O1xuICAgICAgLXdlYmtpdC1ib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgICAtbW96LWJvcmRlci1yYWRpdXM6IDVweDtcbiAgICAgIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNkNWFiNjM7XG4gICAgICBtYXJnaW46IDEwcHg7XG4gICAgfVxuICBgO1xuXG4gIGxldCByZWdpc3RlcldpbmRvd1N1Ym1pdCA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI3JlZ2lzdGVyV2luZG93U3VibWl0XCIpO1xuICBsZXQgcmVnaXN0ZXJXaW5kb3dCYWNrID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjcmVnaXN0ZXJXaW5kb3dCYWNrXCIpO1xuXG4gIHJlZ2lzdGVyV2luZG93U3VibWl0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgR2FtZS5yZWdpc3Rlci5zdWJtaXQoKTtcbiAgfSk7XG5cbiAgcmVnaXN0ZXJXaW5kb3dCYWNrLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgd2luLmhpZGUoKTtcbiAgICBHYW1lLndpbmRvd3MubWFpbi5zaG93KCk7XG4gIH0pO1xuXG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.sell = Game.Window.create("sellWindow");

  win.html = "\n  <div class=\"window-box\">\n    <div id=\"sellWindowItemBar\">\n\n      <button id=\"sellWindowClose\" class=\"brownButton\">关闭</button>\n      <button id=\"sellWindowBuy\" class=\"brownButton\">买入</button>\n\n      <button id=\"sellWindowAll\" class=\"brownButton\">全部</button>\n      <button id=\"sellWindowWeapon\" class=\"brownButton\">武器</button>\n      <button id=\"sellWindowArmor\" class=\"brownButton\">护甲</button>\n      <button id=\"sellWindowPotion\" class=\"brownButton\">药水</button>\n      <button id=\"sellWindowMaterial\" class=\"brownButton\">材料</button>\n      <button id=\"sellWindowBook\" class=\"brownButton\">书籍</button>\n      <button id=\"sellWindowMisc\" class=\"brownButton\">其他</button>\n    </div>\n\n    <span id=\"sellWindowGold\"></span>\n\n    <div style=\"overflow: auto; height: 300px;\">\n      <table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n        <thead>\n          <tr>\n            <td style=\"width: 40px;\"></td>\n            <td style=\"width: 120px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td></td>\n            <td style=\"width: 60px;\"></td>\n          </tr>\n        </thead>\n        <tbody id=\"sellWindowTable\"></tbody>\n      </table>\n    </div>\n  </div>\n  ";

  win.css = "\n    #sellWindowItemBar > button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n      margin-left: 5px;\n      margin-right: 5px;\n      margin-top: 0px;\n      margin-bottom: 5px;\n    }\n\n    #sellWindowClose {\n      float: right;\n    }\n\n    #sellWindowStatus {\n      float: right;\n    }\n\n    .sellWindow table {\n      width: 100%;\n    }\n\n    .sellWindow table img {\n      width: 100%;\n      height: 100%;\n    }\n\n    .sellWindow table button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n    }\n\n    #sellWindowGold {\n      position: absolute;\n      right: 100px;\n      bottom: 30px;\n      font-size: 20px;\n      color: black;\n    }\n  ";

  var sellWindowClose = win.querySelector("button#sellWindowClose");
  var sellWindowBuy = win.querySelector("button#sellWindowBuy");

  var sellWindowAll = win.querySelector("button#sellWindowAll");
  var sellWindowWeapon = win.querySelector("button#sellWindowWeapon");
  var sellWindowArmor = win.querySelector("button#sellWindowArmor");
  var sellWindowPotion = win.querySelector("button#sellWindowPotion");
  var sellWindowMaterial = win.querySelector("button#sellWindowMaterial");
  var sellWindowBook = win.querySelector("button#sellWindowBook");
  var sellWindowMisc = win.querySelector("button#sellWindowMisc");

  var sellWindowGold = win.querySelector("span#sellWindowGold");
  var sellWindowTable = win.querySelector("#sellWindowTable");

  var lastItems = null;
  var lastFilter = null;
  var lastSelect = -1;

  sellWindowClose.addEventListener("click", function () {
    win.hide();
  });

  sellWindowBuy.addEventListener("click", function () {
    win.hide();
    Game.windows.buy.open(lastItems);
  });

  win.whenUp(["tab"], function () {
    setTimeout(function () {
      win.hide();
      Game.windows.buy.open(lastItems);
    }, 20);
  });

  sellWindowAll.addEventListener("click", function (event) {
    win.open(lastItems, null);
  });

  sellWindowWeapon.addEventListener("click", function (event) {
    win.open(lastItems, "sword|spear|bow");
  });

  sellWindowArmor.addEventListener("click", function (event) {
    win.open(lastItems, "head|body|feet");
  });

  sellWindowPotion.addEventListener("click", function (event) {
    win.open(lastItems, "potion");
  });

  sellWindowMaterial.addEventListener("click", function (event) {
    win.open(lastItems, "material");
  });

  sellWindowBook.addEventListener("click", function (event) {
    win.open(lastItems, "book|scroll|letter");
  });

  sellWindowMisc.addEventListener("click", function (event) {
    win.open(lastItems, "misc");
  });

  win.assign("open", function (items, filter, select) {

    if (typeof select == "undefined") {
      select = -1;
    }

    lastItems = items;
    lastFilter = filter;
    lastSelect = select;

    sellWindowGold.textContent = Game.hero.data.gold + "G";

    var defaultColor = "white";
    var activeColor = "yellow";

    sellWindowAll.style.color = defaultColor;
    sellWindowWeapon.style.color = defaultColor;
    sellWindowArmor.style.color = defaultColor;
    sellWindowPotion.style.color = defaultColor;
    sellWindowMaterial.style.color = defaultColor;
    sellWindowBook.style.color = defaultColor;
    sellWindowMisc.style.color = defaultColor;

    if (filter == null) {
      sellWindowAll.style.color = activeColor;
    } else if (filter.match(/sword/)) {
      sellWindowWeapon.style.color = activeColor;
    } else if (filter.match(/head/)) {
      sellWindowArmor.style.color = activeColor;
    } else if (filter.match(/potion/)) {
      sellWindowPotion.style.color = activeColor;
    } else if (filter.match(/material/)) {
      sellWindowMaterial.style.color = activeColor;
    } else if (filter.match(/book/)) {
      sellWindowBook.style.color = activeColor;
    } else if (filter.match(/misc/)) {
      sellWindowMisc.style.color = activeColor;
    }

    var index = 0;
    var table = "";
    Sprite.each(Game.hero.data.items, function (itemCount, itemId) {
      var item = Game.items[itemId];

      if (filter && filter.indexOf(item.data.type) == -1) return;

      var line = "";

      if (select == index) {
        line += "<tr style=\"background-color: green;\">\n";
      } else {
        line += "<tr>\n";
      }

      if (item.icon) {
        line += "  <td><img alt=\"\" src=\"" + item.icon.src + "\"></td>\n";
      } else {
        line += "  <td> </td>\n";
      }
      line += "  <td>" + item.data.name + "</td>\n";
      line += "  <td style=\"text-align: center;\">" + Math.ceil(item.data.value * 0.8) + "G</td>\n";
      line += "  <td style=\"text-align: center;\">" + itemCount + "</td>\n";
      line += "  <td>" + item.data.description + "</td>\n";
      line += "  <td><button data-id=\"" + itemId + "\" class=\"brownButton\">卖出</button></td>\n";

      line += "</tr>\n";
      table += line;
      index++;
    });

    sellWindowTable.innerHTML = table;
    win.show();
  });

  win.whenUp(["enter"], function () {
    var buttons = sellWindowTable.querySelectorAll("button");
    if (lastSelect >= 0 && lastSelect < buttons.length) {
      buttons[lastSelect].click();
    }
  });

  win.whenUp(["up", "down"], function (key) {
    var count = sellWindowTable.querySelectorAll("button").length;
    if (count <= 0) return;

    if (lastSelect == -1) {
      if (key == "down") {
        win.open(lastItems, lastFilter, 0);
      } else if (key == "up") {
        win.open(lastItems, lastFilter, count - 1);
      }
    } else {
      if (key == "down") {
        var select = lastSelect + 1;
        if (select >= count) {
          select = 0;
        }
        win.open(lastItems, lastFilter, select);
      } else if (key == "up") {
        var select = lastSelect - 1;
        if (select < 0) {
          select = count - 1;
        }
        win.open(lastItems, lastFilter, select);
      }
    }
  });

  win.whenUp(["esc"], function () {
    setTimeout(function () {
      win.hide();
    }, 20);
  });

  win.whenUp(["left", "right"], function (key) {
    if (key == "right") {
      var filter = lastFilter;
      if (filter == null) {
        filter = "sword";
      } else if (filter.match(/sword/)) {
        filter = "head";
      } else if (filter.match(/head/)) {
        filter = "potion";
      } else if (filter.match(/potion/)) {
        filter = "material";
      } else if (filter.match(/material/)) {
        filter = "book";
      } else if (filter.match(/book/)) {
        filter = "misc";
      } else if (filter.match(/misc/)) {
        filter = null;
      }
      win.open(lastItems, filter);
    } else if (key == "left") {
      var filter = lastFilter;
      if (filter == null) {
        filter = "misc";
      } else if (filter.match(/sword/)) {
        filter = null;
      } else if (filter.match(/head/)) {
        filter = "sword";
      } else if (filter.match(/potion/)) {
        filter = "head";
      } else if (filter.match(/material/)) {
        filter = "potion";
      } else if (filter.match(/book/)) {
        filter = "material";
      } else if (filter.match(/misc/)) {
        filter = "book";
      }
      win.open(lastItems, filter);
    }
  });

  sellWindowTable.addEventListener("click", function (event) {
    var itemId = event.target.getAttribute("data-id");
    if (itemId && Game.hero.data.items.hasOwnProperty(itemId)) {
      var item = Game.items[itemId];
      var itemCount = Game.hero.data.items[itemId];

      if (lastItems.hasOwnProperty(itemId)) {
        lastItems[itemId]++;
      } else {
        lastItems[itemId] = 1;
      }

      if (itemCount == 1) {
        Game.hero.data.bar.forEach(function (element, index, array) {
          if (element && element.id == itemId) {
            array[index] = null;
          }
        });
        Sprite.each(Game.hero.data.equipment, function (element, key) {
          if (element == itemId) {
            Game.hero.data.equipment[key] = null;
          }
        });
        delete Game.hero.data.items[itemId];
      } else {
        Game.hero.data.items[itemId]--;
      }

      Game.hero.data.gold += Math.ceil(item.data.value * 0.8);
      Game.windows["interface"].refresh();
      win.open(lastItems, lastFilter);
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dTZWxsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDOztBQUUvRCxLQUFHLENBQUMsSUFBSSwyeENBa0NQLENBQUM7O0FBRUYsS0FBRyxDQUFDLEdBQUcsd3NCQXlDTixDQUFDOztBQUVGLE1BQUksZUFBZSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUNsRSxNQUFJLGFBQWEsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHNCQUFzQixDQUFDLENBQUM7O0FBRTlELE1BQUksYUFBYSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUM5RCxNQUFJLGdCQUFnQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMseUJBQXlCLENBQUMsQ0FBQztBQUNwRSxNQUFJLGVBQWUsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHdCQUF3QixDQUFDLENBQUM7QUFDbEUsTUFBSSxnQkFBZ0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHlCQUF5QixDQUFDLENBQUM7QUFDcEUsTUFBSSxrQkFBa0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLDJCQUEyQixDQUFDLENBQUM7QUFDeEUsTUFBSSxjQUFjLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ2hFLE1BQUksY0FBYyxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUMsQ0FBQzs7QUFFaEUsTUFBSSxjQUFjLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzlELE1B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R0FBRyxFQUFFO0FBQzVELGNBQUksT0FBTyxJQUFJLE1BQU0sRUFBRTtBQUNyQixnQkFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQztXQUN0QztTQUNGLENBQUMsQ0FBQztBQUNILGVBQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO09BQ3JDLE1BQU07QUFDTCxZQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztPQUNoQzs7QUFFRCxVQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQztBQUN4RCxVQUFJLENBQUMsT0FBTyxhQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDakMsU0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUM7S0FDakM7R0FDRixDQUFDLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93U2VsbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCB3aW4gPSBHYW1lLndpbmRvd3Muc2VsbCA9IEdhbWUuV2luZG93LmNyZWF0ZShcInNlbGxXaW5kb3dcIik7XG5cbiAgd2luLmh0bWwgPSBgXG4gIDxkaXYgY2xhc3M9XCJ3aW5kb3ctYm94XCI+XG4gICAgPGRpdiBpZD1cInNlbGxXaW5kb3dJdGVtQmFyXCI+XG5cbiAgICAgIDxidXR0b24gaWQ9XCJzZWxsV2luZG93Q2xvc2VcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5YWz6ZetPC9idXR0b24+XG4gICAgICA8YnV0dG9uIGlkPVwic2VsbFdpbmRvd0J1eVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7kubDlhaU8L2J1dHRvbj5cblxuICAgICAgPGJ1dHRvbiBpZD1cInNlbGxXaW5kb3dBbGxcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5YWo6YOoPC9idXR0b24+XG4gICAgICA8YnV0dG9uIGlkPVwic2VsbFdpbmRvd1dlYXBvblwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7mrablmag8L2J1dHRvbj5cbiAgICAgIDxidXR0b24gaWQ9XCJzZWxsV2luZG93QXJtb3JcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5oqk55SyPC9idXR0b24+XG4gICAgICA8YnV0dG9uIGlkPVwic2VsbFdpbmRvd1BvdGlvblwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7oja/msLQ8L2J1dHRvbj5cbiAgICAgIDxidXR0b24gaWQ9XCJzZWxsV2luZG93TWF0ZXJpYWxcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5p2Q5paZPC9idXR0b24+XG4gICAgICA8YnV0dG9uIGlkPVwic2VsbFdpbmRvd0Jvb2tcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5Lmm57GNPC9idXR0b24+XG4gICAgICA8YnV0dG9uIGlkPVwic2VsbFdpbmRvd01pc2NcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5YW25LuWPC9idXR0b24+XG4gICAgPC9kaXY+XG5cbiAgICA8c3BhbiBpZD1cInNlbGxXaW5kb3dHb2xkXCI+PC9zcGFuPlxuXG4gICAgPGRpdiBzdHlsZT1cIm92ZXJmbG93OiBhdXRvOyBoZWlnaHQ6IDMwMHB4O1wiPlxuICAgICAgPHRhYmxlIGJvcmRlcj1cIjFcIiBjZWxsc3BhY2luZz1cIjBcIiBjZWxscGFkZGluZz1cIjBcIj5cbiAgICAgICAgPHRoZWFkPlxuICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiA0MHB4O1wiPjwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJ3aWR0aDogMTIwcHg7XCI+PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiAzMHB4O1wiPjwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJ3aWR0aDogMzBweDtcIj48L3RkPlxuICAgICAgICAgICAgPHRkPjwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJ3aWR0aDogNjBweDtcIj48L3RkPlxuICAgICAgICAgIDwvdHI+XG4gICAgICAgIDwvdGhlYWQ+XG4gICAgICAgIDx0Ym9keSBpZD1cInNlbGxXaW5kb3dUYWJsZVwiPjwvdGJvZHk+XG4gICAgICA8L3RhYmxlPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbiAgYDtcblxuICB3aW4uY3NzID0gYFxuICAgICNzZWxsV2luZG93SXRlbUJhciA+IGJ1dHRvbiB7XG4gICAgICB3aWR0aDogNjBweDtcbiAgICAgIGhlaWdodDogNDBweDtcbiAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICAgIG1hcmdpbi1sZWZ0OiA1cHg7XG4gICAgICBtYXJnaW4tcmlnaHQ6IDVweDtcbiAgICAgIG1hcmdpbi10b3A6IDBweDtcbiAgICAgIG1hcmdpbi1ib3R0b206IDVweDtcbiAgICB9XG5cbiAgICAjc2VsbFdpbmRvd0Nsb3NlIHtcbiAgICAgIGZsb2F0OiByaWdodDtcbiAgICB9XG5cbiAgICAjc2VsbFdpbmRvd1N0YXR1cyB7XG4gICAgICBmbG9hdDogcmlnaHQ7XG4gICAgfVxuXG4gICAgLnNlbGxXaW5kb3cgdGFibGUge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgfVxuXG4gICAgLnNlbGxXaW5kb3cgdGFibGUgaW1nIHtcbiAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgIH1cblxuICAgIC5zZWxsV2luZG93IHRhYmxlIGJ1dHRvbiB7XG4gICAgICB3aWR0aDogNjBweDtcbiAgICAgIGhlaWdodDogNDBweDtcbiAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICB9XG5cbiAgICAjc2VsbFdpbmRvd0dvbGQge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgcmlnaHQ6IDEwMHB4O1xuICAgICAgYm90dG9tOiAzMHB4O1xuICAgICAgZm9udC1zaXplOiAyMHB4O1xuICAgICAgY29sb3I6IGJsYWNrO1xuICAgIH1cbiAgYDtcblxuICBsZXQgc2VsbFdpbmRvd0Nsb3NlID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jc2VsbFdpbmRvd0Nsb3NlXCIpO1xuICBsZXQgc2VsbFdpbmRvd0J1eSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI3NlbGxXaW5kb3dCdXlcIik7XG5cbiAgbGV0IHNlbGxXaW5kb3dBbGwgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNzZWxsV2luZG93QWxsXCIpO1xuICBsZXQgc2VsbFdpbmRvd1dlYXBvbiA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI3NlbGxXaW5kb3dXZWFwb25cIik7XG4gIGxldCBzZWxsV2luZG93QXJtb3IgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNzZWxsV2luZG93QXJtb3JcIik7XG4gIGxldCBzZWxsV2luZG93UG90aW9uID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jc2VsbFdpbmRvd1BvdGlvblwiKTtcbiAgbGV0IHNlbGxXaW5kb3dNYXRlcmlhbCA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI3NlbGxXaW5kb3dNYXRlcmlhbFwiKTtcbiAgbGV0IHNlbGxXaW5kb3dCb29rID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jc2VsbFdpbmRvd0Jvb2tcIik7XG4gIGxldCBzZWxsV2luZG93TWlzYyA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI3NlbGxXaW5kb3dNaXNjXCIpO1xuXG4gIGxldCBzZWxsV2luZG93R29sZCA9IHdpbi5xdWVyeVNlbGVjdG9yKFwic3BhbiNzZWxsV2luZG93R29sZFwiKTtcbiAgbGV0IHNlbGxXaW5kb3dUYWJsZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI3NlbGxXaW5kb3dUYWJsZVwiKTtcblxuICBsZXQgbGFzdEl0ZW1zID0gbnVsbDtcbiAgbGV0IGxhc3RGaWx0ZXIgPSBudWxsO1xuICBsZXQgbGFzdFNlbGVjdCA9IC0xO1xuXG4gIHNlbGxXaW5kb3dDbG9zZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgIHdpbi5oaWRlKCk7XG4gIH0pO1xuXG4gIHNlbGxXaW5kb3dCdXkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICB3aW4uaGlkZSgpO1xuICAgIEdhbWUud2luZG93cy5idXkub3BlbihsYXN0SXRlbXMpO1xuICB9KTtcblxuICB3aW4ud2hlblVwKFtcInRhYlwiXSwgZnVuY3Rpb24gKCkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgd2luLmhpZGUoKTtcbiAgICAgIEdhbWUud2luZG93cy5idXkub3BlbihsYXN0SXRlbXMpO1xuICAgIH0sIDIwKTtcbiAgfSk7XG5cbiAgc2VsbFdpbmRvd0FsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4obGFzdEl0ZW1zLCBudWxsKTtcbiAgfSk7XG5cbiAgc2VsbFdpbmRvd1dlYXBvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4obGFzdEl0ZW1zLCBcInN3b3JkfHNwZWFyfGJvd1wiKTtcbiAgfSk7XG5cbiAgc2VsbFdpbmRvd0FybW9yLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4ub3BlbihsYXN0SXRlbXMsIFwiaGVhZHxib2R5fGZlZXRcIik7XG4gIH0pO1xuXG4gIHNlbGxXaW5kb3dQb3Rpb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgXCJwb3Rpb25cIik7XG4gIH0pO1xuXG4gIHNlbGxXaW5kb3dNYXRlcmlhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4obGFzdEl0ZW1zLCBcIm1hdGVyaWFsXCIpO1xuICB9KTtcblxuICBzZWxsV2luZG93Qm9vay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4obGFzdEl0ZW1zLCBcImJvb2t8c2Nyb2xsfGxldHRlclwiKTtcbiAgfSk7XG5cbiAgc2VsbFdpbmRvd01pc2MuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgXCJtaXNjXCIpO1xuICB9KTtcblxuICB3aW4uYXNzaWduKFwib3BlblwiLCBmdW5jdGlvbiAoaXRlbXMsIGZpbHRlciwgc2VsZWN0KSB7XG5cbiAgICBpZiAodHlwZW9mIHNlbGVjdCA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBzZWxlY3QgPSAtMTtcbiAgICB9XG5cbiAgICBsYXN0SXRlbXMgPSBpdGVtcztcbiAgICBsYXN0RmlsdGVyID0gZmlsdGVyO1xuICAgIGxhc3RTZWxlY3QgPSBzZWxlY3Q7XG5cbiAgICBzZWxsV2luZG93R29sZC50ZXh0Q29udGVudCA9IEdhbWUuaGVyby5kYXRhLmdvbGQgKyBcIkdcIjtcblxuICAgIGxldCBkZWZhdWx0Q29sb3IgPSBcIndoaXRlXCI7XG4gICAgbGV0IGFjdGl2ZUNvbG9yID0gXCJ5ZWxsb3dcIjtcblxuICAgIHNlbGxXaW5kb3dBbGwuc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgc2VsbFdpbmRvd1dlYXBvbi5zdHlsZS5jb2xvciA9IGRlZmF1bHRDb2xvcjtcbiAgICBzZWxsV2luZG93QXJtb3Iuc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgc2VsbFdpbmRvd1BvdGlvbi5zdHlsZS5jb2xvciA9IGRlZmF1bHRDb2xvcjtcbiAgICBzZWxsV2luZG93TWF0ZXJpYWwuc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgc2VsbFdpbmRvd0Jvb2suc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgc2VsbFdpbmRvd01pc2Muc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG5cbiAgICBpZiAoZmlsdGVyID09IG51bGwpIHtcbiAgICAgIHNlbGxXaW5kb3dBbGwuc3R5bGUuY29sb3IgPSBhY3RpdmVDb2xvcjtcbiAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvc3dvcmQvKSkge1xuICAgICAgc2VsbFdpbmRvd1dlYXBvbi5zdHlsZS5jb2xvciA9IGFjdGl2ZUNvbG9yO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9oZWFkLykpIHtcbiAgICAgIHNlbGxXaW5kb3dBcm1vci5zdHlsZS5jb2xvciA9IGFjdGl2ZUNvbG9yO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9wb3Rpb24vKSkge1xuICAgICAgc2VsbFdpbmRvd1BvdGlvbi5zdHlsZS5jb2xvciA9IGFjdGl2ZUNvbG9yO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9tYXRlcmlhbC8pKSB7XG4gICAgICBzZWxsV2luZG93TWF0ZXJpYWwuc3R5bGUuY29sb3IgPSBhY3RpdmVDb2xvcjtcbiAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvYm9vay8pKSB7XG4gICAgICBzZWxsV2luZG93Qm9vay5zdHlsZS5jb2xvciA9IGFjdGl2ZUNvbG9yO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9taXNjLykpIHtcbiAgICAgIHNlbGxXaW5kb3dNaXNjLnN0eWxlLmNvbG9yID0gYWN0aXZlQ29sb3I7XG4gICAgfVxuXG4gICAgbGV0IGluZGV4ID0gMDtcbiAgICBsZXQgdGFibGUgPSBcIlwiO1xuICAgIFNwcml0ZS5lYWNoKEdhbWUuaGVyby5kYXRhLml0ZW1zLCBmdW5jdGlvbiAoaXRlbUNvdW50LCBpdGVtSWQpIHtcbiAgICAgIGxldCBpdGVtID0gR2FtZS5pdGVtc1tpdGVtSWRdO1xuXG4gICAgICBpZiAoZmlsdGVyICYmIGZpbHRlci5pbmRleE9mKGl0ZW0uZGF0YS50eXBlKSA9PSAtMSlcbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICBsZXQgbGluZSA9IFwiXCI7XG5cbiAgICAgIGlmIChzZWxlY3QgPT0gaW5kZXgpIHtcbiAgICAgICAgbGluZSArPSBgPHRyIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogZ3JlZW47XCI+XFxuYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpbmUgKz0gYDx0cj5cXG5gO1xuICAgICAgfVxuXG5cbiAgICAgIGlmIChpdGVtLmljb24pIHtcbiAgICAgICAgbGluZSArPSBgICA8dGQ+PGltZyBhbHQ9XCJcIiBzcmM9XCIke2l0ZW0uaWNvbi5zcmN9XCI+PC90ZD5cXG5gO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGluZSArPSBgICA8dGQ+IDwvdGQ+XFxuYDtcbiAgICAgIH1cbiAgICAgIGxpbmUgKz0gYCAgPHRkPiR7aXRlbS5kYXRhLm5hbWV9PC90ZD5cXG5gO1xuICAgICAgbGluZSArPSBgICA8dGQgc3R5bGU9XCJ0ZXh0LWFsaWduOiBjZW50ZXI7XCI+JHtNYXRoLmNlaWwoaXRlbS5kYXRhLnZhbHVlICogMC44KX1HPC90ZD5cXG5gO1xuICAgICAgbGluZSArPSBgICA8dGQgc3R5bGU9XCJ0ZXh0LWFsaWduOiBjZW50ZXI7XCI+JHtpdGVtQ291bnR9PC90ZD5cXG5gO1xuICAgICAgbGluZSArPSBgICA8dGQ+JHtpdGVtLmRhdGEuZGVzY3JpcHRpb259PC90ZD5cXG5gO1xuICAgICAgbGluZSArPSBgICA8dGQ+PGJ1dHRvbiBkYXRhLWlkPVwiJHtpdGVtSWR9XCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuWNluWHujwvYnV0dG9uPjwvdGQ+XFxuYDtcblxuICAgICAgbGluZSArPSBcIjwvdHI+XFxuXCI7XG4gICAgICB0YWJsZSArPSBsaW5lO1xuICAgICAgaW5kZXgrKztcbiAgICB9KTtcblxuICAgIHNlbGxXaW5kb3dUYWJsZS5pbm5lckhUTUwgPSB0YWJsZTtcbiAgICB3aW4uc2hvdygpO1xuICB9KTtcblxuICB3aW4ud2hlblVwKFtcImVudGVyXCJdLCBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGJ1dHRvbnMgPSBzZWxsV2luZG93VGFibGUucXVlcnlTZWxlY3RvckFsbChcImJ1dHRvblwiKTtcbiAgICBpZiAobGFzdFNlbGVjdCA+PSAwICYmIGxhc3RTZWxlY3QgPCBidXR0b25zLmxlbmd0aCkge1xuICAgICAgYnV0dG9uc1tsYXN0U2VsZWN0XS5jbGljaygpO1xuICAgIH1cbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJ1cFwiLCBcImRvd25cIl0sIGZ1bmN0aW9uIChrZXkpIHtcbiAgICBsZXQgY291bnQgPSBzZWxsV2luZG93VGFibGUucXVlcnlTZWxlY3RvckFsbChcImJ1dHRvblwiKS5sZW5ndGg7XG4gICAgaWYgKGNvdW50IDw9IDApIHJldHVybjtcblxuICAgIGlmIChsYXN0U2VsZWN0ID09IC0xKSB7XG4gICAgICBpZiAoa2V5ID09IFwiZG93blwiKSB7XG4gICAgICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgbGFzdEZpbHRlciwgMCk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PSBcInVwXCIpIHtcbiAgICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBsYXN0RmlsdGVyLCBjb3VudCAtIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoa2V5ID09IFwiZG93blwiKSB7XG4gICAgICAgIGxldCBzZWxlY3QgPSBsYXN0U2VsZWN0ICsgMTtcbiAgICAgICAgaWYgKHNlbGVjdCA+PSBjb3VudCkge1xuICAgICAgICAgIHNlbGVjdCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBsYXN0RmlsdGVyLCBzZWxlY3QpO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT0gXCJ1cFwiKSB7XG4gICAgICAgIGxldCBzZWxlY3QgPSBsYXN0U2VsZWN0IC0gMTtcbiAgICAgICAgaWYgKHNlbGVjdCA8IDApIHtcbiAgICAgICAgICBzZWxlY3QgPSBjb3VudCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBsYXN0RmlsdGVyLCBzZWxlY3QpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJlc2NcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHdpbi5oaWRlKCk7XG4gICAgfSwgMjApO1xuICB9KTtcblxuICB3aW4ud2hlblVwKFtcImxlZnRcIiwgXCJyaWdodFwiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIGlmIChrZXkgPT0gXCJyaWdodFwiKSB7XG4gICAgICBsZXQgZmlsdGVyID0gbGFzdEZpbHRlcjtcbiAgICAgIGlmIChmaWx0ZXIgPT0gbnVsbCkge1xuICAgICAgICBmaWx0ZXIgPSBcInN3b3JkXCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvc3dvcmQvKSkge1xuICAgICAgICBmaWx0ZXIgPSBcImhlYWRcIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9oZWFkLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJwb3Rpb25cIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9wb3Rpb24vKSkge1xuICAgICAgICBmaWx0ZXIgPSBcIm1hdGVyaWFsXCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvbWF0ZXJpYWwvKSkge1xuICAgICAgICBmaWx0ZXIgPSBcImJvb2tcIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9ib29rLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJtaXNjXCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvbWlzYy8pKSB7XG4gICAgICAgIGZpbHRlciA9IG51bGw7XG4gICAgICB9XG4gICAgICB3aW4ub3BlbihsYXN0SXRlbXMsIGZpbHRlcik7XG4gICAgfSBlbHNlIGlmIChrZXkgPT0gXCJsZWZ0XCIpIHtcbiAgICAgIGxldCBmaWx0ZXIgPSBsYXN0RmlsdGVyO1xuICAgICAgaWYgKGZpbHRlciA9PSBudWxsKSB7XG4gICAgICAgIGZpbHRlciA9IFwibWlzY1wiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3N3b3JkLykpIHtcbiAgICAgICAgZmlsdGVyID0gbnVsbDtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9oZWFkLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJzd29yZFwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3BvdGlvbi8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwiaGVhZFwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21hdGVyaWFsLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJwb3Rpb25cIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9ib29rLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJtYXRlcmlhbFwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21pc2MvKSkge1xuICAgICAgICBmaWx0ZXIgPSBcImJvb2tcIjtcbiAgICAgIH1cbiAgICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgZmlsdGVyKTtcbiAgICB9XG4gIH0pO1xuXG4gIHNlbGxXaW5kb3dUYWJsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgbGV0IGl0ZW1JZCA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIpO1xuICAgIGlmIChpdGVtSWQgJiYgR2FtZS5oZXJvLmRhdGEuaXRlbXMuaGFzT3duUHJvcGVydHkoaXRlbUlkKSkge1xuICAgICAgbGV0IGl0ZW0gPSBHYW1lLml0ZW1zW2l0ZW1JZF07XG4gICAgICBsZXQgaXRlbUNvdW50ID0gR2FtZS5oZXJvLmRhdGEuaXRlbXNbaXRlbUlkXTtcblxuICAgICAgaWYgKGxhc3RJdGVtcy5oYXNPd25Qcm9wZXJ0eShpdGVtSWQpKSB7XG4gICAgICAgIGxhc3RJdGVtc1tpdGVtSWRdKys7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsYXN0SXRlbXNbaXRlbUlkXSA9IDE7XG4gICAgICB9XG5cbiAgICAgIGlmIChpdGVtQ291bnQgPT0gMSkge1xuICAgICAgICBHYW1lLmhlcm8uZGF0YS5iYXIuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCwgaW5kZXgsIGFycmF5KSB7XG4gICAgICAgICAgaWYgKGVsZW1lbnQgJiYgZWxlbWVudC5pZCA9PSBpdGVtSWQpIHtcbiAgICAgICAgICAgIGFycmF5W2luZGV4XSA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgU3ByaXRlLmVhY2goR2FtZS5oZXJvLmRhdGEuZXF1aXBtZW50LCBmdW5jdGlvbiAoZWxlbWVudCwga2V5KSB7XG4gICAgICAgICAgaWYgKGVsZW1lbnQgPT0gaXRlbUlkKSB7XG4gICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS5lcXVpcG1lbnRba2V5XSA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgZGVsZXRlIEdhbWUuaGVyby5kYXRhLml0ZW1zW2l0ZW1JZF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBHYW1lLmhlcm8uZGF0YS5pdGVtc1tpdGVtSWRdLS07XG4gICAgICB9XG5cbiAgICAgIEdhbWUuaGVyby5kYXRhLmdvbGQgKz0gTWF0aC5jZWlsKGl0ZW0uZGF0YS52YWx1ZSAqIDAuOCk7XG4gICAgICBHYW1lLndpbmRvd3MuaW50ZXJmYWNlLnJlZnJlc2goKTtcbiAgICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgbGFzdEZpbHRlcik7XG4gICAgfVxuICB9KTtcblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.setting = Game.Window.create("settingWindow");

  win.html = "\n    <div class=\"window-box\">\n      <button id=\"settingWindowClose\" class=\"brownButton\">关闭</button>\n\n      <div id=\"settingWindowRendererType\"></div>\n\n      <div id=\"settingWindowBox\">\n        <button id=\"settingWindowFullscreen\" class=\"brownButton\">全屏</button>\n        <button id=\"settingWindowScale\" class=\"brownButton\">缩放</button>\n        <button id=\"settingWindowShortcut\" class=\"brownButton\">清除快捷栏</button>\n        <button id=\"settingWindowShortcutAll\" class=\"brownButton\">清除全部快捷栏</button>\n      </div>\n    </div>\n  ";

  win.css = "\n    #settingWindowBox {\n      width: 100%;\n      height: 360px;\n    }\n\n    #settingWindowBox button {\n      width: 120px;\n      height: 60px;\n      font-size: 16px;\n      display: block;\n    }\n\n    #settingWindowClose {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n      float: right;\n    }\n  ";

  var settingWindowShortcut = win.querySelector("#settingWindowShortcut");
  var settingWindowShortcutAll = win.querySelector("#settingWindowShortcutAll");

  var settingWindowClose = win.querySelector("#settingWindowClose");
  var settingWindowScale = win.querySelector("#settingWindowScale");

  var settingWindowFullscreen = win.querySelector("#settingWindowFullscreen");
  var settingWindowRendererType = win.querySelector("#settingWindowRendererType");

  settingWindowShortcut.addEventListener("click", function (event) {
    Game.choice({ 1: 0, 2: 1, 3: 2, 4: 3, 5: 4, 6: 5, 7: 6, 8: 7 }, function (choice) {
      if (Number.isFinite(choice)) {
        Game.hero.data.bar[choice] = null;
        Game.windows["interface"].refresh();
      }
    });
  });

  settingWindowShortcutAll.addEventListener("click", function (event) {
    Game.confirm("确定要删除所有快捷栏图表吗？", function () {
      for (var i = 0; i < 8; i++) {
        Game.hero.data.bar[i] = null;
      }
      Game.windows["interface"].refresh();
    });
  });

  win.on("beforeShow", function () {
    settingWindowRendererType.textContent = Game.stage.rendererType;
  });

  settingWindowClose.addEventListener("click", function (event) {
    win.hide();
  });

  settingWindowScale.addEventListener("click", function (event) {
    Game.config.scale = !Game.config.scale;
    win.show();
  });

  win.whenUp(["esc"], function (key) {
    settingWindowClose.click();
  });

  function toggleFullScreen() {
    if (!document.fullscreenElement && // alternative standard method
    !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
      // current working methods
      if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen();
      } else if (document.documentElement.msRequestFullscreen) {
        document.documentElement.msRequestFullscreen();
      } else if (document.documentElement.mozRequestFullScreen) {
        document.documentElement.mozRequestFullScreen();
      } else if (document.documentElement.webkitRequestFullscreen) {
        document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
      }
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      }
    }
  }

  settingWindowFullscreen.addEventListener("click", function (event) {
    toggleFullScreen();
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dTZXR0aW5nLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDOztBQUVyRSxLQUFHLENBQUMsSUFBSSxxakJBYVAsQ0FBQzs7QUFFRixLQUFHLENBQUMsR0FBRywrVUFtQk4sQ0FBQzs7QUFFRixNQUFJLHFCQUFxQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUN4RSxNQUFJLHdCQUF3QixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsMkJBQTJCLENBQUMsQ0FBQzs7QUFFOUUsTUFBSSxrQkFBa0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHFCQUFxQixDQUFDLENBQUM7QUFDbEUsTUFBSSxrQkFBa0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHFCQUFxQixDQUFDLENBQUM7O0FBRWxFLE1BQUksdUJBQXVCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQzVFLE1BQUkseUJBQXlCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDOztBQUVoRix1QkFBcUIsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDL0QsUUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxF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LENBQUM7T0FDaEMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRTtBQUN4QyxnQkFBUSxDQUFDLG9CQUFvQixFQUFFLENBQUM7T0FDakM7S0FDRjtHQUNGOztBQUVELHlCQUF1QixDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUNqRSxvQkFBZ0IsRUFBRSxDQUFDO0dBQ3BCLENBQUMsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVXaW5kb3dTZXR0aW5nLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IHdpbiA9IEdhbWUud2luZG93cy5zZXR0aW5nID0gR2FtZS5XaW5kb3cuY3JlYXRlKFwic2V0dGluZ1dpbmRvd1wiKTtcblxuICB3aW4uaHRtbCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwid2luZG93LWJveFwiPlxuICAgICAgPGJ1dHRvbiBpZD1cInNldHRpbmdXaW5kb3dDbG9zZVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7lhbPpl608L2J1dHRvbj5cblxuICAgICAgPGRpdiBpZD1cInNldHRpbmdXaW5kb3dSZW5kZXJlclR5cGVcIj48L2Rpdj5cblxuICAgICAgPGRpdiBpZD1cInNldHRpbmdXaW5kb3dCb3hcIj5cbiAgICAgICAgPGJ1dHRvbiBpZD1cInNldHRpbmdXaW5kb3dGdWxsc2NyZWVuXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuWFqOWxjzwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGlkPVwic2V0dGluZ1dpbmRvd1NjYWxlXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPue8qeaUvjwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGlkPVwic2V0dGluZ1dpbmRvd1Nob3J0Y3V0XCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPua4hemZpOW/q+aNt+agjzwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGlkPVwic2V0dGluZ1dpbmRvd1Nob3J0Y3V0QWxsXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPua4hemZpOWFqOmDqOW/q+aNt+agjzwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gIGA7XG5cbiAgd2luLmNzcyA9IGBcbiAgICAjc2V0dGluZ1dpbmRvd0JveCB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogMzYwcHg7XG4gICAgfVxuXG4gICAgI3NldHRpbmdXaW5kb3dCb3ggYnV0dG9uIHtcbiAgICAgIHdpZHRoOiAxMjBweDtcbiAgICAgIGhlaWdodDogNjBweDtcbiAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIH1cblxuICAgICNzZXR0aW5nV2luZG93Q2xvc2Uge1xuICAgICAgd2lkdGg6IDYwcHg7XG4gICAgICBoZWlnaHQ6IDQwcHg7XG4gICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgICBmbG9hdDogcmlnaHQ7XG4gICAgfVxuICBgO1xuXG4gIGxldCBzZXR0aW5nV2luZG93U2hvcnRjdXQgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNzZXR0aW5nV2luZG93U2hvcnRjdXRcIik7XG4gIGxldCBzZXR0aW5nV2luZG93U2hvcnRjdXRBbGwgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNzZXR0aW5nV2luZG93U2hvcnRjdXRBbGxcIik7XG5cbiAgbGV0IHNldHRpbmdXaW5kb3dDbG9zZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI3NldHRpbmdXaW5kb3dDbG9zZVwiKTtcbiAgbGV0IHNldHRpbmdXaW5kb3dTY2FsZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI3NldHRpbmdXaW5kb3dTY2FsZVwiKTtcblxuICBsZXQgc2V0dGluZ1dpbmRvd0Z1bGxzY3JlZW4gPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNzZXR0aW5nV2luZG93RnVsbHNjcmVlblwiKTtcbiAgbGV0IHNldHRpbmdXaW5kb3dSZW5kZXJlclR5cGUgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNzZXR0aW5nV2luZG93UmVuZGVyZXJUeXBlXCIpO1xuXG4gIHNldHRpbmdXaW5kb3dTaG9ydGN1dC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgR2FtZS5jaG9pY2UoezE6MCwgMjoxLCAzOjIsIDQ6MywgNTo0LCA2OjUsIDc6NiwgODo3fSwgZnVuY3Rpb24gKGNob2ljZSkge1xuICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShjaG9pY2UpKSB7XG4gICAgICAgIEdhbWUuaGVyby5kYXRhLmJhcltjaG9pY2VdID0gbnVsbDtcbiAgICAgICAgR2FtZS53aW5kb3dzLmludGVyZmFjZS5yZWZyZXNoKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG5cbiAgc2V0dGluZ1dpbmRvd1Nob3J0Y3V0QWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBHYW1lLmNvbmZpcm0oXCLnoa7lrpropoHliKDpmaTmiYDmnInlv6vmjbfmoI/lm77ooajlkJfvvJ9cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHtcbiAgICAgICAgR2FtZS5oZXJvLmRhdGEuYmFyW2ldID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIEdhbWUud2luZG93cy5pbnRlcmZhY2UucmVmcmVzaCgpO1xuICAgIH0pO1xuICB9KTtcblxuICB3aW4ub24oXCJiZWZvcmVTaG93XCIsIGZ1bmN0aW9uICgpIHtcbiAgICBzZXR0aW5nV2luZG93UmVuZGVyZXJUeXBlLnRleHRDb250ZW50ID0gR2FtZS5zdGFnZS5yZW5kZXJlclR5cGU7XG4gIH0pO1xuXG4gIHNldHRpbmdXaW5kb3dDbG9zZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLmhpZGUoKTtcbiAgfSk7XG5cbiAgc2V0dGluZ1dpbmRvd1NjYWxlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBHYW1lLmNvbmZpZy5zY2FsZSA9ICFHYW1lLmNvbmZpZy5zY2FsZTtcbiAgICB3aW4uc2hvdygpO1xuICB9KTtcblxuXG4gIHdpbi53aGVuVXAoW1wiZXNjXCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgc2V0dGluZ1dpbmRvd0Nsb3NlLmNsaWNrKCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHRvZ2dsZUZ1bGxTY3JlZW4gKCkge1xuICAgIGlmICghZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQgJiYgICAgLy8gYWx0ZXJuYXRpdmUgc3RhbmRhcmQgbWV0aG9kXG4gICAgICAgICFkb2N1bWVudC5tb3pGdWxsU2NyZWVuRWxlbWVudCAmJlxuICAgICAgICAhZG9jdW1lbnQud2Via2l0RnVsbHNjcmVlbkVsZW1lbnQgJiZcbiAgICAgICAgIWRvY3VtZW50Lm1zRnVsbHNjcmVlbkVsZW1lbnRcbiAgICApIHsgIC8vIGN1cnJlbnQgd29ya2luZyBtZXRob2RzXG4gICAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnJlcXVlc3RGdWxsc2NyZWVuKSB7XG4gICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZXF1ZXN0RnVsbHNjcmVlbigpO1xuICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubXNSZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubXNSZXF1ZXN0RnVsbHNjcmVlbigpO1xuICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubW96UmVxdWVzdEZ1bGxTY3JlZW4pIHtcbiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm1velJlcXVlc3RGdWxsU2NyZWVuKCk7XG4gICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4oRWxlbWVudC5BTExPV19LRVlCT0FSRF9JTlBVVCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChkb2N1bWVudC5leGl0RnVsbHNjcmVlbikge1xuICAgICAgICBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpO1xuICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5tc0V4aXRGdWxsc2NyZWVuKSB7XG4gICAgICAgIGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4oKTtcbiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubW96Q2FuY2VsRnVsbFNjcmVlbikge1xuICAgICAgICBkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuKCk7XG4gICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKSB7XG4gICAgICAgIGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2V0dGluZ1dpbmRvd0Z1bGxzY3JlZW4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHRvZ2dsZUZ1bGxTY3JlZW4oKTtcbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.skill = Game.Window.create("skillWindow");

  win.html = "\n    <div class=\"window-box\">\n      <div id=\"skillWindowItemBar\">\n        <button id=\"skillWindowClose\" class=\"brownButton\">关闭</button>\n      </div>\n      <table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n        <thead>\n          <tr>\n            <td style=\"width: 40px;\"></td>\n            <td style=\"width: 120px;\"></td>\n            <td></td>\n            <td style=\"width: 60px;\"></td>\n          </tr>\n        </thead>\n        <tbody id=\"skillWindowTable\"></tbody>\n      </table>\n    </div>\n  ";

  win.css = "\n    .skillWindow table {\n      width: 100%;\n    }\n\n    .skillWindow table img {\n      width: 100%;\n      height: 100%;\n    }\n\n    .skillWindow button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n    }\n\n    #skillWindowItemBar button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n      margin-left: 5px;\n      margin-right: 5px;\n      margin-top: 0px;\n      margin-bottom: 5px;\n    }\n\n    #skillWindowClose {\n      float: right;\n    }\n  ";

  var skillWindowClose = win.querySelector("button#skillWindowClose");
  var skillWindowTable = win.querySelector("#skillWindowTable");

  var lastSelect = -1;

  skillWindowClose.addEventListener("click", function (event) {
    win.hide();
  });

  win.whenUp(["esc"], function (key) {
    setTimeout(function () {
      win.hide();
    }, 20);
  });

  win.assign("open", function (select) {

    if (typeof select == "undefined") {
      select = -1;
    }

    lastSelect = select;

    var index = 0;
    var table = "";
    Game.hero.data.skills.forEach(function (skillId) {
      var skill = Game.skills[skillId];

      var line = "";

      if (select == index) {
        line += "<tr style=\"background-color: green;\">\n";
      } else {
        line += "<tr>\n";
      }

      line += "  <td><img alt=\"\" src=\"" + skill.icon.src + "\"></td>\n";
      line += "  <td>" + skill.data.name + "</td>\n";
      line += "  <td>" + skill.data.description + "</td>\n";
      line += "  <td><button data-id=\"" + skillId + "\" class=\"brownButton skillWindowManage\">管理</button></td>\n";
      line += "</tr>\n";
      table += line;
      index++;
    });

    skillWindowTable.innerHTML = table;
    Game.windows.skill.show();
  });

  win.whenUp(["enter"], function () {
    var buttons = win.querySelectorAll(".skillWindowManage");
    if (lastSelect >= 0 && lastSelect < buttons.length) {
      buttons[lastSelect].click();
    }
  });

  win.whenUp(["up", "down"], function (key) {
    var count = win.querySelectorAll(".skillWindowManage").length;

    if (lastSelect == -1) {
      if (key == "down") {
        win.open(0);
      } else if (key == "up") {
        win.open(count - 1);
      }
    } else {
      if (key == "down") {
        var select = lastSelect + 1;
        if (select >= count) {
          select = 0;
        }
        win.open(select);
      } else if (key == "up") {
        var select = lastSelect - 1;
        if (select < 0) {
          select = count - 1;
        }
        win.open(select);
      }
    }
  });

  skillWindowTable.addEventListener("click", function (event) {
    var skillId = event.target.getAttribute("data-id");
    var index = Game.hero.data.skills.indexOf(skillId);
    if (skillId && Game.skills.hasOwnProperty(skillId) && index != -1) {
      (function () {

        var skill = Game.skills[skillId];

        var options = {};

        options["快捷栏"] = "shortcut";
        options["遗忘"] = "remove";
        if (skill.data.next) {
          options["升级"] = "levelup";
        }

        Game.choice(options, function (choice) {
          switch (choice) {
            case "shortcut":
              Game.choice({
                1: 0,
                2: 1,
                3: 2,
                4: 3,
                5: 4,
                6: 5,
                7: 6,
                8: 7
              }, function (choice) {
                if (Number.isFinite(choice) && choice >= 0) {
                  Game.hero.data.bar[choice] = {
                    id: skillId,
                    type: "skill"
                  };
                  Game.windows["interface"].refresh();
                }
              });
              break;
            case "levelup":
              if (skill.data.next) {
                var cannot = [];
                if (Game.hero.data.gold < skill.data.next.gold) {
                  cannot.push("金币不足，需要金币" + skill.data.next.gold + "，当前您有金币" + Game.hero.data.gold);
                }
                if (Game.hero.data.exp < skill.data.next.exp) {
                  cannot.push("经验不足，需要经验" + skill.data.next.exp + "，当前您有经验" + Game.hero.data.exp);
                }
                if (cannot.length) {
                  Game.dialogue(cannot);
                  return;
                }
                Game.confirm("确定要升级这个技能吗？共需要金币" + skill.data.next.gold + "，经验" + skill.data.next.exp, function () {
                  var nextId = skill.data.next.id;
                  Game.hero.data.skills.splice(index, 1);
                  Game.hero.data.skills.push(nextId);
                  Game.hero.data.gold -= skill.data.next.gold;
                  Game.hero.data.exp -= skill.data.next.exp;
                  Game.windows.loading.begin();
                  Game.Skill.load(nextId).then(function (skillObj) {
                    Game.windows.loading.end();
                    win.open();
                  });
                });
              }
              break;
            case "remove":
              Game.confirm("真的要遗忘 " + skill.data.name + " 技能吗？", function () {
                Game.hero.data.bar.forEach(function (element, index, array) {
                  if (element && element.id == skillId) {
                    array[index] = null;
                  }
                });
                Game.hero.data.skills.splice(index, 1);
                Game.windows["interface"].refresh();
                win.open();
              });
              break;
          }
        });
      })();
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dTa2lsbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7QUFFYixNQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQzs7QUFFakUsS0FBRyxDQUFDLElBQUksNGhCQWlCUCxDQUFDOztBQUVGLEtBQUcsQ0FBQyxHQUFHLDRmQTZCTixDQUFDOztBQUVGLE1BQUksZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0FBQ3BFLE1BQUksZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDOztBQUU5RCxNQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQzs7QUFFcEIsa0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVUsS0FBSyxFQUFFO0FBQzFELE9BQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztHQUNaLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsVUFBVSxHQUFHLEVBQUU7QUFDakMsY0FBVSxDQUFDLFlBQVk7QUFDckIsU0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0tBQ1osRUFBRSxFQUFFLENBQUMsQ0FBQztHQUNSLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxVQUFVLE1BQU0sRUFBRTs7QUFFbkMsUUFBSSxPQUFPLE1BQU0sSUFBSSxXQUFXLEVBQUU7QUFDaEMsWUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO0tBQ2I7O0FBRUQsY0FBVSxHQUFHLE1BQU0sQ0FBQzs7QUFFcEIsUUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0FB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QyxDQUFDO0FBQ3ZDLG9CQUFJLENBQUMsT0FBTyxhQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDakMsbUJBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztlQUNaLENBQUMsQ0FBQztBQUNILG9CQUFNO0FBQUEsV0FDVDtTQUNGLENBQUMsQ0FBQzs7S0FFSjtHQUNGLENBQUMsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVXaW5kb3dTa2lsbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCB3aW4gPSBHYW1lLndpbmRvd3Muc2tpbGwgPSBHYW1lLldpbmRvdy5jcmVhdGUoXCJza2lsbFdpbmRvd1wiKTtcblxuICB3aW4uaHRtbCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwid2luZG93LWJveFwiPlxuICAgICAgPGRpdiBpZD1cInNraWxsV2luZG93SXRlbUJhclwiPlxuICAgICAgICA8YnV0dG9uIGlkPVwic2tpbGxXaW5kb3dDbG9zZVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7lhbPpl608L2J1dHRvbj5cbiAgICAgIDwvZGl2PlxuICAgICAgPHRhYmxlIGJvcmRlcj1cIjFcIiBjZWxsc3BhY2luZz1cIjBcIiBjZWxscGFkZGluZz1cIjBcIj5cbiAgICAgICAgPHRoZWFkPlxuICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiA0MHB4O1wiPjwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJ3aWR0aDogMTIwcHg7XCI+PC90ZD5cbiAgICAgICAgICAgIDx0ZD48L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwid2lkdGg6IDYwcHg7XCI+PC90ZD5cbiAgICAgICAgICA8L3RyPlxuICAgICAgICA8L3RoZWFkPlxuICAgICAgICA8dGJvZHkgaWQ9XCJza2lsbFdpbmRvd1RhYmxlXCI+PC90Ym9keT5cbiAgICAgIDwvdGFibGU+XG4gICAgPC9kaXY+XG4gIGA7XG5cbiAgd2luLmNzcyA9IGBcbiAgICAuc2tpbGxXaW5kb3cgdGFibGUge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgfVxuXG4gICAgLnNraWxsV2luZG93IHRhYmxlIGltZyB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogMTAwJTtcbiAgICB9XG5cbiAgICAuc2tpbGxXaW5kb3cgYnV0dG9uIHtcbiAgICAgIHdpZHRoOiA2MHB4O1xuICAgICAgaGVpZ2h0OiA0MHB4O1xuICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgIH1cblxuICAgICNza2lsbFdpbmRvd0l0ZW1CYXIgYnV0dG9uIHtcbiAgICAgIHdpZHRoOiA2MHB4O1xuICAgICAgaGVpZ2h0OiA0MHB4O1xuICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgbWFyZ2luLWxlZnQ6IDVweDtcbiAgICAgIG1hcmdpbi1yaWdodDogNXB4O1xuICAgICAgbWFyZ2luLXRvcDogMHB4O1xuICAgICAgbWFyZ2luLWJvdHRvbTogNXB4O1xuICAgIH1cblxuICAgICNza2lsbFdpbmRvd0Nsb3NlIHtcbiAgICAgIGZsb2F0OiByaWdodDtcbiAgICB9XG4gIGA7XG5cbiAgbGV0IHNraWxsV2luZG93Q2xvc2UgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNza2lsbFdpbmRvd0Nsb3NlXCIpO1xuICBsZXQgc2tpbGxXaW5kb3dUYWJsZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI3NraWxsV2luZG93VGFibGVcIik7XG5cbiAgbGV0IGxhc3RTZWxlY3QgPSAtMTtcblxuICBza2lsbFdpbmRvd0Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4uaGlkZSgpO1xuICB9KTtcblxuICB3aW4ud2hlblVwKFtcImVzY1wiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgd2luLmhpZGUoKTtcbiAgICB9LCAyMCk7XG4gIH0pO1xuXG4gIHdpbi5hc3NpZ24oXCJvcGVuXCIsIGZ1bmN0aW9uIChzZWxlY3QpIHtcblxuICAgIGlmICh0eXBlb2Ygc2VsZWN0ID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHNlbGVjdCA9IC0xO1xuICAgIH1cblxuICAgIGxhc3RTZWxlY3QgPSBzZWxlY3Q7XG5cbiAgICBsZXQgaW5kZXggPSAwO1xuICAgIGxldCB0YWJsZSA9IFwiXCI7XG4gICAgR2FtZS5oZXJvLmRhdGEuc2tpbGxzLmZvckVhY2goZnVuY3Rpb24gKHNraWxsSWQpIHtcbiAgICAgIGxldCBza2lsbCA9IEdhbWUuc2tpbGxzW3NraWxsSWRdO1xuXG4gICAgICBsZXQgbGluZSA9IFwiXCI7XG5cbiAgICAgIGlmIChzZWxlY3QgPT0gaW5kZXgpIHtcbiAgICAgICAgbGluZSArPSBgPHRyIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogZ3JlZW47XCI+XFxuYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpbmUgKz0gYDx0cj5cXG5gO1xuICAgICAgfVxuXG4gICAgICBsaW5lICs9IGAgIDx0ZD48aW1nIGFsdD1cIlwiIHNyYz1cIiR7c2tpbGwuaWNvbi5zcmN9XCI+PC90ZD5cXG5gO1xuICAgICAgbGluZSArPSBgICA8dGQ+JHtza2lsbC5kYXRhLm5hbWV9PC90ZD5cXG5gO1xuICAgICAgbGluZSArPSBgICA8dGQ+JHtza2lsbC5kYXRhLmRlc2NyaXB0aW9ufTwvdGQ+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPHRkPjxidXR0b24gZGF0YS1pZD1cIiR7c2tpbGxJZH1cIiBjbGFzcz1cImJyb3duQnV0dG9uIHNraWxsV2luZG93TWFuYWdlXCI+566h55CGPC9idXR0b24+PC90ZD5cXG5gO1xuICAgICAgbGluZSArPSBcIjwvdHI+XFxuXCI7XG4gICAgICB0YWJsZSArPSBsaW5lO1xuICAgICAgaW5kZXgrKztcbiAgICB9KTtcblxuICAgIHNraWxsV2luZG93VGFibGUuaW5uZXJIVE1MID0gdGFibGU7XG4gICAgR2FtZS53aW5kb3dzLnNraWxsLnNob3coKTtcbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJlbnRlclwiXSwgZnVuY3Rpb24gKCkge1xuICAgIGxldCBidXR0b25zID0gd2luLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2tpbGxXaW5kb3dNYW5hZ2VcIik7XG4gICAgaWYgKGxhc3RTZWxlY3QgPj0gMCAmJiBsYXN0U2VsZWN0IDwgYnV0dG9ucy5sZW5ndGgpIHtcbiAgICAgIGJ1dHRvbnNbbGFzdFNlbGVjdF0uY2xpY2soKTtcbiAgICB9XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1widXBcIiwgXCJkb3duXCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgbGV0IGNvdW50ID0gd2luLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2tpbGxXaW5kb3dNYW5hZ2VcIikubGVuZ3RoO1xuXG4gICAgaWYgKGxhc3RTZWxlY3QgPT0gLTEpIHtcbiAgICAgIGlmIChrZXkgPT0gXCJkb3duXCIpIHtcbiAgICAgICAgd2luLm9wZW4oMCk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PSBcInVwXCIpIHtcbiAgICAgICAgd2luLm9wZW4oY291bnQgLSAxKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGtleSA9PSBcImRvd25cIikge1xuICAgICAgICBsZXQgc2VsZWN0ID0gbGFzdFNlbGVjdCArIDE7XG4gICAgICAgIGlmIChzZWxlY3QgPj0gY291bnQpIHtcbiAgICAgICAgICBzZWxlY3QgPSAwO1xuICAgICAgICB9XG4gICAgICAgIHdpbi5vcGVuKHNlbGVjdCk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PSBcInVwXCIpIHtcbiAgICAgICAgbGV0IHNlbGVjdCA9IGxhc3RTZWxlY3QgLSAxO1xuICAgICAgICBpZiAoc2VsZWN0IDwgMCkge1xuICAgICAgICAgIHNlbGVjdCA9IGNvdW50IC0gMTtcbiAgICAgICAgfVxuICAgICAgICB3aW4ub3BlbihzZWxlY3QpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgc2tpbGxXaW5kb3dUYWJsZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgbGV0IHNraWxsSWQgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiKTtcbiAgICBsZXQgaW5kZXggPSBHYW1lLmhlcm8uZGF0YS5za2lsbHMuaW5kZXhPZihza2lsbElkKTtcbiAgICBpZiAoc2tpbGxJZCAmJiBHYW1lLnNraWxscy5oYXNPd25Qcm9wZXJ0eShza2lsbElkKSAmJiBpbmRleCAhPSAtMSkge1xuXG4gICAgICBsZXQgc2tpbGwgPSBHYW1lLnNraWxsc1tza2lsbElkXTtcblxuICAgICAgbGV0IG9wdGlvbnMgPSB7fTtcblxuICAgICAgb3B0aW9uc1tcIuW/q+aNt+agj1wiXSA9IFwic2hvcnRjdXRcIjtcbiAgICAgIG9wdGlvbnNbXCLpgZflv5hcIl0gPSBcInJlbW92ZVwiO1xuICAgICAgaWYgKHNraWxsLmRhdGEubmV4dCkge1xuICAgICAgICBvcHRpb25zW1wi5Y2H57qnXCJdID0gXCJsZXZlbHVwXCI7XG4gICAgICB9XG5cbiAgICAgIEdhbWUuY2hvaWNlKG9wdGlvbnMsIGZ1bmN0aW9uIChjaG9pY2UpIHtcbiAgICAgICAgc3dpdGNoKGNob2ljZSkge1xuICAgICAgICAgIGNhc2UgXCJzaG9ydGN1dFwiOlxuICAgICAgICAgICAgR2FtZS5jaG9pY2Uoe1xuICAgICAgICAgICAgICAxOjAsXG4gICAgICAgICAgICAgIDI6MSxcbiAgICAgICAgICAgICAgMzoyLFxuICAgICAgICAgICAgICA0OjMsXG4gICAgICAgICAgICAgIDU6NCxcbiAgICAgICAgICAgICAgNjo1LFxuICAgICAgICAgICAgICA3OjYsXG4gICAgICAgICAgICAgIDg6N1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGNob2ljZSkge1xuICAgICAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKGNob2ljZSkgJiYgY2hvaWNlID49IDApIHtcbiAgICAgICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS5iYXJbY2hvaWNlXSA9IHtcbiAgICAgICAgICAgICAgICAgIGlkOiBza2lsbElkLFxuICAgICAgICAgICAgICAgICAgdHlwZTogXCJza2lsbFwiXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBHYW1lLndpbmRvd3MuaW50ZXJmYWNlLnJlZnJlc2goKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwibGV2ZWx1cFwiOlxuICAgICAgICAgICAgaWYgKHNraWxsLmRhdGEubmV4dCkge1xuICAgICAgICAgICAgICBsZXQgY2Fubm90ID0gW107XG4gICAgICAgICAgICAgIGlmIChHYW1lLmhlcm8uZGF0YS5nb2xkIDwgc2tpbGwuZGF0YS5uZXh0LmdvbGQpIHtcbiAgICAgICAgICAgICAgICBjYW5ub3QucHVzaChg6YeR5biB5LiN6Laz77yM6ZyA6KaB6YeR5biBJHtza2lsbC5kYXRhLm5leHQuZ29sZH3vvIzlvZPliY3mgqjmnInph5HluIEke0dhbWUuaGVyby5kYXRhLmdvbGR9YCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKEdhbWUuaGVyby5kYXRhLmV4cCA8IHNraWxsLmRhdGEubmV4dC5leHApIHtcbiAgICAgICAgICAgICAgICBjYW5ub3QucHVzaChg57uP6aqM5LiN6Laz77yM6ZyA6KaB57uP6aqMJHtza2lsbC5kYXRhLm5leHQuZXhwfe+8jOW9k+WJjeaCqOaciee7j+mqjCR7R2FtZS5oZXJvLmRhdGEuZXhwfWApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChjYW5ub3QubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgR2FtZS5kaWFsb2d1ZShjYW5ub3QpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBHYW1lLmNvbmZpcm0oYOehruWumuimgeWNh+e6p+i/meS4quaKgOiDveWQl++8n+WFsemcgOimgemHkeW4gSR7c2tpbGwuZGF0YS5uZXh0LmdvbGR977yM57uP6aqMJHtza2lsbC5kYXRhLm5leHQuZXhwfWAsIGZ1bmN0aW9uICgpIHsgICAgICAgICAgICAgICAgbGV0IG5leHRJZCA9IHNraWxsLmRhdGEubmV4dC5pZDtcbiAgICAgICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS5za2lsbHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS5za2lsbHMucHVzaChuZXh0SWQpO1xuICAgICAgICAgICAgICAgIEdhbWUuaGVyby5kYXRhLmdvbGQgLT0gc2tpbGwuZGF0YS5uZXh0LmdvbGQ7XG4gICAgICAgICAgICAgICAgR2FtZS5oZXJvLmRhdGEuZXhwIC09IHNraWxsLmRhdGEubmV4dC5leHA7XG4gICAgICAgICAgICAgICAgR2FtZS53aW5kb3dzLmxvYWRpbmcuYmVnaW4oKTtcbiAgICAgICAgICAgICAgICBHYW1lLlNraWxsLmxvYWQobmV4dElkKS50aGVuKGZ1bmN0aW9uIChza2lsbE9iaikge1xuICAgICAgICAgICAgICAgICAgR2FtZS53aW5kb3dzLmxvYWRpbmcuZW5kKCk7XG4gICAgICAgICAgICAgICAgICB3aW4ub3BlbigpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJyZW1vdmVcIjpcbiAgICAgICAgICAgIEdhbWUuY29uZmlybShg55yf55qE6KaB6YGX5b+YICR7c2tpbGwuZGF0YS5uYW1lfSDmioDog73lkJfvvJ9gLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIEdhbWUuaGVyby5kYXRhLmJhci5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50LCBpbmRleCwgYXJyYXkpIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCAmJiBlbGVtZW50LmlkID09IHNraWxsSWQpIHtcbiAgICAgICAgICAgICAgICAgIGFycmF5W2luZGV4XSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgR2FtZS5oZXJvLmRhdGEuc2tpbGxzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgIEdhbWUud2luZG93cy5pbnRlcmZhY2UucmVmcmVzaCgpO1xuICAgICAgICAgICAgICB3aW4ub3BlbigpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICB9XG4gIH0pO1xuXG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.status = Game.Window.create("statusWindow");

  win.html = "\n    <div class=\"window-box\">\n      <div id=\"statusWindowItemBar\">\n        <button id=\"statusWindowClose\" class=\"brownButton\">关闭</button>\n        <button id=\"statusWindowInventory\" class=\"brownButton\">物品</button>\n        <label id=\"heroName\"></label>\n      </div>\n      <table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n        <tr>\n          <td id=\"statusWindowTable\">\n            <label id=\"heroHP\"></label>\n            <label id=\"heroSP\"></label>\n            <label id=\"heroLevel\"></label>\n            <label id=\"heroEXP\"></label>\n            <label id=\"heroSTR\"></label>\n            <label id=\"heroDEX\"></label>\n            <label id=\"heroCON\"></label>\n            <label id=\"heroINT\"></label>\n            <label id=\"heroCHA\"></label>\n            <label id=\"heroATK\"></label>\n            <label id=\"heroDEF\"></label>\n            <label id=\"heroMATK\"></label>\n            <label id=\"heroMDEF\"></label>\n          </td>\n          <td style=\"width: 50%;\">\n            <table id=\"statusWindowEquipmentTable\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n              <tbody>\n                <tr>\n                  <td class=\"statusWindowEquipmentText\">头部</td>\n                  <td id=\"equipment-head\"></td>\n                  <td style=\"width: 60px;\"><button id=\"equipmentButton-head\" class=\"brownButton\">卸下</button></td>\n                </tr>\n                <tr>\n                  <td class=\"statusWindowEquipmentText\">身体</td>\n                  <td id=\"equipment-body\"></td>\n                  <td><button id=\"equipmentButton-body\" class=\"brownButton\">卸下</button></td>\n                </tr>\n                <tr>\n                  <td class=\"statusWindowEquipmentText\">足部</td>\n                  <td id=\"equipment-feet\"></td>\n                  <td><button id=\"equipmentButton-feet\" class=\"brownButton\">卸下</button></td>\n                </tr>\n                <tr>\n                  <td class=\"statusWindowEquipmentText\">武器</td>\n                  <td id=\"equipment-weapon\"></td>\n                  <td><button id=\"equipmentButton-weapon\" class=\"brownButton\">卸下</button></td>\n                </tr>\n                <tr>\n                  <td class=\"statusWindowEquipmentText\">项链</td>\n                  <td id=\"equipment-neck\"></td>\n                  <td><button id=\"equipmentButton-neck\" class=\"brownButton\">卸下</button></td>\n                </tr>\n                <tr>\n                  <td class=\"statusWindowEquipmentText\">戒指</td>\n                  <td id=\"equipment-ring\"></td>\n                  <td><button id=\"equipmentButton-ring\" class=\"brownButton\">卸下</button></td>\n                </tr>\n              </tbody>\n            </table>\n          </td>\n        </tr>\n      </table>\n    </div>\n  ";

  win.css = "\n    #heroName {\n      font-size: 24px;\n      margin-left: 240px;\n    }\n\n    #statusWindowTable {\n      width: 50%;\n    }\n\n    #statusWindowTable label {\n      font-size: 18px;\n      margin-left: 80px;\n    }\n\n    #statusWindowEquipmentTable button {\n      width: 60px;\n      height: 40px;\n    }\n\n    .statusWindowEquipmentText {\n      width: 60px;\n      font-size: 20px;\n      text-align: center;\n    }\n\n    .statusWindow label {\n      display: block;\n    }\n\n    #statusWindowItemBar button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n      margin-left: 5px;\n      margin-right: 5px;\n      margin-top: 0px;\n      margin-bottom: 5px;\n      text-align: center;\n    }\n\n    #statusWindowClose {\n      float: right;\n    }\n\n    #statusWindowInventory {\n      float: right;\n    }\n\n    .statusWindow table {\n      width: 100%;\n      height: 320px;\n    }\n  ";

  var statusWindowEquipment = {
    head: win.querySelector("#equipment-head"),
    body: win.querySelector("#equipment-body"),
    feet: win.querySelector("#equipment-feet"),
    weapon: win.querySelector("#equipment-weapon"),
    neck: win.querySelector("#equipment-neck"),
    ring: win.querySelector("#equipment-ring")
  };

  var statusWindowEquipmentButton = {
    head: win.querySelector("#equipmentButton-head"),
    body: win.querySelector("#equipmentButton-body"),
    feet: win.querySelector("#equipmentButton-feet"),
    weapon: win.querySelector("#equipmentButton-weapon"),
    neck: win.querySelector("#equipmentButton-neck"),
    ring: win.querySelector("#equipmentButton-ring")
  };

  var lastSelect = -1;

  Sprite.each(statusWindowEquipmentButton, function (button, key) {
    button.addEventListener("click", function () {
      if (Game.hero.data.equipment[key]) {
        Game.hero.data.equipment[key] = null;
      } else {
        if (key == "weapon") {
          Game.windows.inventory.open("sword|spear|bow");
        } else {
          Game.windows.inventory.open("head|body|feet");
        }
      }
      win.update();
    });
  });

  var heroName = win.querySelector("#heroName");
  var heroHP = win.querySelector("#heroHP");
  var heroSP = win.querySelector("#heroSP");
  var heroLevel = win.querySelector("#heroLevel");
  var heroEXP = win.querySelector("#heroEXP");
  var heroSTR = win.querySelector("#heroSTR");
  var heroDEX = win.querySelector("#heroDEX");
  var heroCON = win.querySelector("#heroCON");
  var heroINT = win.querySelector("#heroINT");
  var heroCHA = win.querySelector("#heroCHA");
  var heroATK = win.querySelector("#heroATK");
  var heroDEF = win.querySelector("#heroDEF");
  var heroMATK = win.querySelector("#heroMATK");
  var heroMDEF = win.querySelector("#heroMDEF");

  var statusWindowClose = win.querySelector("button#statusWindowClose");
  var statusWindowInventory = win.querySelector("button#statusWindowInventory");
  var statusWindowEquipmentTable = win.querySelector("#statusWindowEquipmentTable");

  statusWindowClose.addEventListener("click", function (event) {
    win.hide();
  });

  statusWindowInventory.addEventListener("click", function (event) {
    win.hide();
    Game.windows.inventory.open();
  });

  win.whenUp(["tab"], function () {
    setTimeout(function () {
      win.hide();
      Game.windows.inventory.open();
    }, 20);
  });

  win.whenUp(["esc"], function (key) {
    setTimeout(function () {
      win.hide();
    }, 20);
  });

  win.assign("update", function (select) {

    if (typeof select == "undefined") {
      select = -1;
    }

    lastSelect = select;

    heroName.textContent = "名字：" + Game.hero.data.name;
    heroHP.textContent = "生命力：" + Game.hero.data.hp + "/" + Game.hero.data.$hp;
    heroSP.textContent = "精神力：" + Game.hero.data.sp + "/" + Game.hero.data.$sp;
    heroLevel.textContent = "等级：" + Game.hero.data.level;
    heroEXP.textContent = "经验：" + Game.hero.data.exp;
    heroSTR.textContent = "力量：" + Game.hero.data.str;
    heroDEX.textContent = "敏捷：" + Game.hero.data.dex;
    heroCON.textContent = "耐力：" + Game.hero.data.con;
    heroINT.textContent = "智力：" + Game.hero.data.int;
    heroCHA.textContent = "魅力：" + Game.hero.data.cha;
    heroATK.textContent = "攻击：" + Game.hero.data.atk;
    heroDEF.textContent = "防御：" + Game.hero.data.def;
    heroMATK.textContent = "魔法攻击：" + Game.hero.data.matk;
    heroMDEF.textContent = "魔法防御：" + Game.hero.data.mdef;

    var lines = statusWindowEquipmentTable.querySelectorAll("tr");
    for (var i = 0, len = lines.length; i < len; i++) {
      if (select == i) {
        lines[i].style.backgroundColor = "green";
      } else {
        lines[i].style.backgroundColor = "";
      }
    }

    Sprite.each(Game.hero.data.equipment, function (element, key) {
      var button = statusWindowEquipmentButton[key];

      if (element) {
        var line = "";
        line += "<img alt=\"\" src=\"" + Game.items[element].icon.src + "\">";
        line += "<span>" + Game.items[element].data.name + "</span>";
        statusWindowEquipment[key].innerHTML = line;
        button.textContent = "卸下";
      } else {
        statusWindowEquipment[key].innerHTML = "";
        button.textContent = "装备";
      }
    });
  });

  win.whenUp(["enter"], function () {
    var buttons = statusWindowEquipmentTable.querySelectorAll("button");
    if (lastSelect >= 0 && lastSelect < buttons.length) {
      buttons[lastSelect].click();
    }
  });

  win.whenUp(["up", "down"], function (key) {
    var count = statusWindowEquipmentTable.querySelectorAll("button").length;

    if (lastSelect == -1) {
      if (key == "down") {
        win.open(0);
      } else if (key == "up") {
        win.open(count - 1);
      }
    } else {
      if (key == "down") {
        var select = lastSelect + 1;
        if (select >= count) {
          select = 0;
        }
        win.open(select);
      } else if (key == "up") {
        var select = lastSelect - 1;
        if (select < 0) {
          select = count - 1;
        }
        win.open(select);
      }
    }
  });

  win.assign("open", function (select) {
    win.update(select);
    win.show();
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dTdGF0dXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUM7O0FBRW5FLEtBQUcsQ0FBQyxJQUFJLGt6RkErRFAsQ0FBQzs7QUFFRixLQUFHLENBQUMsR0FBRyw4NUJBcUROLENBQUM7O0FBRUYsTUFBSSxxQkFBcUIsR0FBRztBQUMxQixRQUFJLEVBQUUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQztBQUMxQyxRQUFJLEVBQUUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQztBQUMxQyxRQUFJLEVBQUUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQztBQUMxQyxVQUFNLEVBQUUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQztBQUM5QyxRQUFJLEVBQUUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQztBQUMxQyxRQUFJLEVBQUUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQztHQUMzQyxDQUFDOztBQUVGLE1BQUksMkJBQTJCLEdBQUc7QUFDaEMsUUFBSSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUM7QUFDaEQsUUFBSSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUM7QUFDaEQsUUFBSSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUM7QUFDaEQsVUFBTSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMseUJBQXlCLENBQUM7QUFDcEQsUUFBSSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUM7QUFDaEQsUUFBSSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUM7R0FDakQsQ0FBQzs7QUFFRixNQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQzs7QUFFcEIsUUFBTSxDQUFDLElBQUksQ0FBQywyQkFBMkIsRUFBRSxVQUFVLE1BQU0sRUFBRSxHQUFHLEVBQUU7QUFDOUQsVUFBTSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxZQUFZO0FBQzNDLFVBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFO0FBQ2pDLFlBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7T0FDdEMsTUFBTTtBQUNMLFlBQUksR0FBRyxJQUFJLFFBQVEsRUFBRTtBQUNuQixjQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztTQUNoRCxNQUFNO0FBQ0wsY0FBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7U0FDL0M7T0FDRjtBQUNELFNBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztLQUNkLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQzs7QUFFSCxNQUFJLFFBQVEsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQzlDLE1BQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUE7QUFDekMsTUFBSSxNQUFNLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUMxQyxNQUFJLFNBQVMsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ2hELE1BQUksT0FBTyxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDNUMsTUFBSSxPQUFPLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUM1QyxNQUFJLE9BQU8sR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQzVDLE1BQUksT0FBTyxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDNUMsTUFBSSxPQUFPLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUM1QyxNQUFJLE9BQU8sR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQzVDLE1BQUksT0FBTyxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDNUMsTUFBSSxPQUFPLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUM1QyxNQUFJLFFBQVEsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQzlDLE1BQUksUUFBUSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLENBQUM7O0FBRTlDLE1BQUksaUJBQWlCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ3RFLE1BQUkscUJBQXFCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBQzlFLE1BQUksMEJBQTBCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDOztBQUVsRixtQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLLEVBQUU7QUFDM0QsT0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0dBQ1osQ0FBQyxDQUFDOztBQUVILHVCQUFxQixDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUMvRCxPQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWCxRQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztHQUMvQixDQUFDLENBQUM7O0FBRUgsS0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLFlBQVk7QUFDOUIsY0FBVSxDQUFDLFlBQVk7QUFDckIsU0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ1gsVUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7S0FDL0IsRUFBRSxFQUFFLENBQUMsQ0FBQztHQUNSLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsVUFBVSxHQUFHLEVBQUU7QUFDakMsY0FBVSxDQUFDLFlBQVk7QUFDckIsU0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0tBQ1osRUFBRSxFQUFFLENBQUMsQ0FBQTtHQUNQLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxVQUFVLE1BQU0sRUFBRTs7QUFFckMsUUFBSSxPQUFPLE1BQU0sSUFBSSxXQUFXLEVBQUU7QUFDaEMsWUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO0tBQ2I7O0FBRUQsY0FBVSxHQUFHLE1BQU0sQ0FBQzs7QUFFcEIsWUFBUSxDQUFDLFdBQVcsV0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEFBQUUsQ0FBQztBQUNuRCxVQUFNLENBQUMsV0FBVyxZQUFVLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEFBQUUsQ0FBQztBQUN0RSxVQUFNLENBQUMsV0FBVyxZQUFVLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEFBQUUsQ0FBQztBQUN0RSxhQUFTLENBQUMsV0FBVyxXQUFTLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQUFBRSxDQUFDO0FBQ3JELFdBQU8sQ0FBQyxXQUFXLFdBQVMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxBQUFFLENBQUM7QUFDakQsV0FBTyxDQUFDLFdBQVcsV0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEFBQUUsQ0FBQztBQUNqRCxXQUFPLENBQUMsV0FBVyxXQUFTLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQUFBRSxDQUFDO0FBQ2pELFdBQU8sQ0FBQyxXQUFXLFdBQVMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxBQUFFLENBQUM7QUFDakQsV0FBTyxDQUFDLFdBQVcsV0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEFBQUUsQ0FBQztBQUNqRCxXQUFPLENBQUMsV0FBVyxXQUFTLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQUFBRSxDQUFDO0FBQ2pELFdBQU8sQ0FBQyxXQUFXLFdBQVMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxBQUFFLENBQUM7QUFDakQsV0FBTyxDQUFDLFdBQVcsV0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEFBQUUsQ0FBQztBQUNqRCxZQUFRLENBQUMsV0FBVyxhQUFXLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQUFBRSxDQUFDO0FBQ3JELFlBQVEsQ0FBQyxXQUFXLGFBQVcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxBQUFFLENBQUM7O0FBRXJELFFBQUksS0FBSyxHQUFHLDBCQUEwQixDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlELFNBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDaEQsVUFBSSxNQUFNLElBQUksQ0FBQyxFQUFFO0FBQ2YsYUFBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxlQUFlLEdBQUcsT0FBTyxDQUFDO09BQzFDLE1BQU07QUFDTCxhQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7T0FDckM7S0FDRjs7QUFFRCxVQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxVQUFVLE9BQU8sRUFBRSxHQUFHLEVBQUU7QUFDNUQsVUFBSSxNQUFNLEdBQUcsMkJBQTJCLENBQUMsR0FBRyxDQUFDLENBQUM7O0FBRTlDLFVBQUksT0FBTyxFQUFFO0FBQ1gsWUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO0FBQ2QsWUFBSSw2QkFBd0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxRQUFJLENBQUM7QUFDN0QsWUFBSSxlQUFhLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksWUFBUyxDQUFDO0FBQ3hELDZCQUFxQixDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7QUFDNUMsY0FBTSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7T0FDM0IsTUFBTTtBQUNMLDZCQUFxQixDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7QUFDMUMsY0FBTSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7T0FDM0I7S0FDRixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7O0FBRUgsS0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLFlBQVk7QUFDaEMsUUFBSSxPQUFPLEdBQUcsMEJBQTBCLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDcEUsUUFBSSxVQUFVLElBQUksQ0FBQyxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFO0FBQ2xELGFBQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztLQUM3QjtHQUNGLENBQUMsQ0FBQzs7QUFFSCxLQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxFQUFFLFVBQVUsR0FBRyxFQUFFO0FBQ3hDLFFBQUksS0FBSyxHQUFHLDBCQUEwQixDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQzs7QUFFekUsUUFBSSxVQUFVLElBQUksQ0FBQyxDQUFDLEVBQUU7QUFDcEIsVUFBSSxHQUFHLElBQUksTUFBTSxFQUFFO0FBQ2pCLFdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7T0FDYixNQUFNLElBQUksR0FBRyxJQUFJLElBQUksRUFBRTtBQUN0QixXQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztPQUNyQjtLQUNGLE1BQU07QUFDTCxVQUFJLEdBQUcsSUFBSSxNQUFNLEVBQUU7QUFDakIsWUFBSSxNQUFNLEdBQUcsVUFBVSxHQUFHLENBQUMsQ0FBQztBQUM1QixZQUFJLE1BQU0sSUFBSSxLQUFLLEVBQUU7QUFDbkIsZ0JBQU0sR0FBRyxDQUFDLENBQUM7U0FDWjtBQUNELFdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7T0FDbEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUU7QUFDdEIsWUFBSSxNQUFNLEdBQUcsVUFBVSxHQUFHLENBQUMsQ0FBQztBQUM1QixZQUFJLE1BQU0sR0FBRyxDQUFDLEVBQUU7QUFDZCxnQkFBTSxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUM7U0FDcEI7QUFDRCxXQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO09BQ2xCO0tBQ0Y7R0FDRixDQUFDLENBQUM7O0FBRUgsS0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsVUFBVSxNQUFNLEVBQUU7QUFDbkMsT0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNuQixPQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7R0FDWixDQUFDLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93U3RhdHVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IHdpbiA9IEdhbWUud2luZG93cy5zdGF0dXMgPSBHYW1lLldpbmRvdy5jcmVhdGUoXCJzdGF0dXNXaW5kb3dcIik7XG5cbiAgd2luLmh0bWwgPSBgXG4gICAgPGRpdiBjbGFzcz1cIndpbmRvdy1ib3hcIj5cbiAgICAgIDxkaXYgaWQ9XCJzdGF0dXNXaW5kb3dJdGVtQmFyXCI+XG4gICAgICAgIDxidXR0b24gaWQ9XCJzdGF0dXNXaW5kb3dDbG9zZVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7lhbPpl608L2J1dHRvbj5cbiAgICAgICAgPGJ1dHRvbiBpZD1cInN0YXR1c1dpbmRvd0ludmVudG9yeVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7nianlk4E8L2J1dHRvbj5cbiAgICAgICAgPGxhYmVsIGlkPVwiaGVyb05hbWVcIj48L2xhYmVsPlxuICAgICAgPC9kaXY+XG4gICAgICA8dGFibGUgYm9yZGVyPVwiMFwiIGNlbGxzcGFjaW5nPVwiMFwiIGNlbGxwYWRkaW5nPVwiMFwiPlxuICAgICAgICA8dHI+XG4gICAgICAgICAgPHRkIGlkPVwic3RhdHVzV2luZG93VGFibGVcIj5cbiAgICAgICAgICAgIDxsYWJlbCBpZD1cImhlcm9IUFwiPjwvbGFiZWw+XG4gICAgICAgICAgICA8bGFiZWwgaWQ9XCJoZXJvU1BcIj48L2xhYmVsPlxuICAgICAgICAgICAgPGxhYmVsIGlkPVwiaGVyb0xldmVsXCI+PC9sYWJlbD5cbiAgICAgICAgICAgIDxsYWJlbCBpZD1cImhlcm9FWFBcIj48L2xhYmVsPlxuICAgICAgICAgICAgPGxhYmVsIGlkPVwiaGVyb1NUUlwiPjwvbGFiZWw+XG4gICAgICAgICAgICA8bGFiZWwgaWQ9XCJoZXJvREVYXCI+PC9sYWJlbD5cbiAgICAgICAgICAgIDxsYWJlbCBpZD1cImhlcm9DT05cIj48L2xhYmVsPlxuICAgICAgICAgICAgPGxhYmVsIGlkPVwiaGVyb0lOVFwiPjwvbGFiZWw+XG4gICAgICAgICAgICA8bGFiZWwgaWQ9XCJoZXJvQ0hBXCI+PC9sYWJlbD5cbiAgICAgICAgICAgIDxsYWJlbCBpZD1cImhlcm9BVEtcIj48L2xhYmVsPlxuICAgICAgICAgICAgPGxhYmVsIGlkPVwiaGVyb0RFRlwiPjwvbGFiZWw+XG4gICAgICAgICAgICA8bGFiZWwgaWQ9XCJoZXJvTUFUS1wiPjwvbGFiZWw+XG4gICAgICAgICAgICA8bGFiZWwgaWQ9XCJoZXJvTURFRlwiPjwvbGFiZWw+XG4gICAgICAgICAgPC90ZD5cbiAgICAgICAgICA8dGQgc3R5bGU9XCJ3aWR0aDogNTAlO1wiPlxuICAgICAgICAgICAgPHRhYmxlIGlkPVwic3RhdHVzV2luZG93RXF1aXBtZW50VGFibGVcIiBib3JkZXI9XCIxXCIgY2VsbHNwYWNpbmc9XCIwXCIgY2VsbHBhZGRpbmc9XCIwXCI+XG4gICAgICAgICAgICAgIDx0Ym9keT5cbiAgICAgICAgICAgICAgICA8dHI+XG4gICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJzdGF0dXNXaW5kb3dFcXVpcG1lbnRUZXh0XCI+5aS06YOoPC90ZD5cbiAgICAgICAgICAgICAgICAgIDx0ZCBpZD1cImVxdWlwbWVudC1oZWFkXCI+PC90ZD5cbiAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiA2MHB4O1wiPjxidXR0b24gaWQ9XCJlcXVpcG1lbnRCdXR0b24taGVhZFwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7ljbjkuIs8L2J1dHRvbj48L3RkPlxuICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICAgPHRyPlxuICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwic3RhdHVzV2luZG93RXF1aXBtZW50VGV4dFwiPui6q+S9kzwvdGQ+XG4gICAgICAgICAgICAgICAgICA8dGQgaWQ9XCJlcXVpcG1lbnQtYm9keVwiPjwvdGQ+XG4gICAgICAgICAgICAgICAgICA8dGQ+PGJ1dHRvbiBpZD1cImVxdWlwbWVudEJ1dHRvbi1ib2R5XCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuWNuOS4izwvYnV0dG9uPjwvdGQ+XG4gICAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgICAgICA8dHI+XG4gICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJzdGF0dXNXaW5kb3dFcXVpcG1lbnRUZXh0XCI+6Laz6YOoPC90ZD5cbiAgICAgICAgICAgICAgICAgIDx0ZCBpZD1cImVxdWlwbWVudC1mZWV0XCI+PC90ZD5cbiAgICAgICAgICAgICAgICAgIDx0ZD48YnV0dG9uIGlkPVwiZXF1aXBtZW50QnV0dG9uLWZlZXRcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5Y245LiLPC9idXR0b24+PC90ZD5cbiAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cInN0YXR1c1dpbmRvd0VxdWlwbWVudFRleHRcIj7mrablmag8L3RkPlxuICAgICAgICAgICAgICAgICAgPHRkIGlkPVwiZXF1aXBtZW50LXdlYXBvblwiPjwvdGQ+XG4gICAgICAgICAgICAgICAgICA8dGQ+PGJ1dHRvbiBpZD1cImVxdWlwbWVudEJ1dHRvbi13ZWFwb25cIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5Y245LiLPC9idXR0b24+PC90ZD5cbiAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cInN0YXR1c1dpbmRvd0VxdWlwbWVudFRleHRcIj7pobnpk748L3RkPlxuICAgICAgICAgICAgICAgICAgPHRkIGlkPVwiZXF1aXBtZW50LW5lY2tcIj48L3RkPlxuICAgICAgICAgICAgICAgICAgPHRkPjxidXR0b24gaWQ9XCJlcXVpcG1lbnRCdXR0b24tbmVja1wiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7ljbjkuIs8L2J1dHRvbj48L3RkPlxuICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICAgPHRyPlxuICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwic3RhdHVzV2luZG93RXF1aXBtZW50VGV4dFwiPuaIkuaMhzwvdGQ+XG4gICAgICAgICAgICAgICAgICA8dGQgaWQ9XCJlcXVpcG1lbnQtcmluZ1wiPjwvdGQ+XG4gICAgICAgICAgICAgICAgICA8dGQ+PGJ1dHRvbiBpZD1cImVxdWlwbWVudEJ1dHRvbi1yaW5nXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuWNuOS4izwvYnV0dG9uPjwvdGQ+XG4gICAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgICAgPC90Ym9keT5cbiAgICAgICAgICAgIDwvdGFibGU+XG4gICAgICAgICAgPC90ZD5cbiAgICAgICAgPC90cj5cbiAgICAgIDwvdGFibGU+XG4gICAgPC9kaXY+XG4gIGA7XG5cbiAgd2luLmNzcyA9IGBcbiAgICAjaGVyb05hbWUge1xuICAgICAgZm9udC1zaXplOiAyNHB4O1xuICAgICAgbWFyZ2luLWxlZnQ6IDI0MHB4O1xuICAgIH1cblxuICAgICNzdGF0dXNXaW5kb3dUYWJsZSB7XG4gICAgICB3aWR0aDogNTAlO1xuICAgIH1cblxuICAgICNzdGF0dXNXaW5kb3dUYWJsZSBsYWJlbCB7XG4gICAgICBmb250LXNpemU6IDE4cHg7XG4gICAgICBtYXJnaW4tbGVmdDogODBweDtcbiAgICB9XG5cbiAgICAjc3RhdHVzV2luZG93RXF1aXBtZW50VGFibGUgYnV0dG9uIHtcbiAgICAgIHdpZHRoOiA2MHB4O1xuICAgICAgaGVpZ2h0OiA0MHB4O1xuICAgIH1cblxuICAgIC5zdGF0dXNXaW5kb3dFcXVpcG1lbnRUZXh0IHtcbiAgICAgIHdpZHRoOiA2MHB4O1xuICAgICAgZm9udC1zaXplOiAyMHB4O1xuICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIH1cblxuICAgIC5zdGF0dXNXaW5kb3cgbGFiZWwge1xuICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgfVxuXG4gICAgI3N0YXR1c1dpbmRvd0l0ZW1CYXIgYnV0dG9uIHtcbiAgICAgIHdpZHRoOiA2MHB4O1xuICAgICAgaGVpZ2h0OiA0MHB4O1xuICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgbWFyZ2luLWxlZnQ6IDVweDtcbiAgICAgIG1hcmdpbi1yaWdodDogNXB4O1xuICAgICAgbWFyZ2luLXRvcDogMHB4O1xuICAgICAgbWFyZ2luLWJvdHRvbTogNXB4O1xuICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIH1cblxuICAgICNzdGF0dXNXaW5kb3dDbG9zZSB7XG4gICAgICBmbG9hdDogcmlnaHQ7XG4gICAgfVxuXG4gICAgI3N0YXR1c1dpbmRvd0ludmVudG9yeSB7XG4gICAgICBmbG9hdDogcmlnaHQ7XG4gICAgfVxuXG4gICAgLnN0YXR1c1dpbmRvdyB0YWJsZSB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogMzIwcHg7XG4gICAgfVxuICBgO1xuXG4gIGxldCBzdGF0dXNXaW5kb3dFcXVpcG1lbnQgPSB7XG4gICAgaGVhZDogd2luLnF1ZXJ5U2VsZWN0b3IoXCIjZXF1aXBtZW50LWhlYWRcIiksXG4gICAgYm9keTogd2luLnF1ZXJ5U2VsZWN0b3IoXCIjZXF1aXBtZW50LWJvZHlcIiksXG4gICAgZmVldDogd2luLnF1ZXJ5U2VsZWN0b3IoXCIjZXF1aXBtZW50LWZlZXRcIiksXG4gICAgd2VhcG9uOiB3aW4ucXVlcnlTZWxlY3RvcihcIiNlcXVpcG1lbnQtd2VhcG9uXCIpLFxuICAgIG5lY2s6IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2VxdWlwbWVudC1uZWNrXCIpLFxuICAgIHJpbmc6IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2VxdWlwbWVudC1yaW5nXCIpXG4gIH07XG5cbiAgbGV0IHN0YXR1c1dpbmRvd0VxdWlwbWVudEJ1dHRvbiA9IHtcbiAgICBoZWFkOiB3aW4ucXVlcnlTZWxlY3RvcihcIiNlcXVpcG1lbnRCdXR0b24taGVhZFwiKSxcbiAgICBib2R5OiB3aW4ucXVlcnlTZWxlY3RvcihcIiNlcXVpcG1lbnRCdXR0b24tYm9keVwiKSxcbiAgICBmZWV0OiB3aW4ucXVlcnlTZWxlY3RvcihcIiNlcXVpcG1lbnRCdXR0b24tZmVldFwiKSxcbiAgICB3ZWFwb246IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2VxdWlwbWVudEJ1dHRvbi13ZWFwb25cIiksXG4gICAgbmVjazogd2luLnF1ZXJ5U2VsZWN0b3IoXCIjZXF1aXBtZW50QnV0dG9uLW5lY2tcIiksXG4gICAgcmluZzogd2luLnF1ZXJ5U2VsZWN0b3IoXCIjZXF1aXBtZW50QnV0dG9uLXJpbmdcIilcbiAgfTtcblxuICBsZXQgbGFzdFNlbGVjdCA9IC0xO1xuXG4gIFNwcml0ZS5lYWNoKHN0YXR1c1dpbmRvd0VxdWlwbWVudEJ1dHRvbiwgZnVuY3Rpb24gKGJ1dHRvbiwga2V5KSB7XG4gICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoR2FtZS5oZXJvLmRhdGEuZXF1aXBtZW50W2tleV0pIHtcbiAgICAgICAgR2FtZS5oZXJvLmRhdGEuZXF1aXBtZW50W2tleV0gPSBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGtleSA9PSBcIndlYXBvblwiKSB7XG4gICAgICAgICAgR2FtZS53aW5kb3dzLmludmVudG9yeS5vcGVuKFwic3dvcmR8c3BlYXJ8Ym93XCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIEdhbWUud2luZG93cy5pbnZlbnRvcnkub3BlbihcImhlYWR8Ym9keXxmZWV0XCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB3aW4udXBkYXRlKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGxldCBoZXJvTmFtZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2hlcm9OYW1lXCIpO1xuICBsZXQgaGVyb0hQID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjaGVyb0hQXCIpXG4gIGxldCBoZXJvU1AgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNoZXJvU1BcIik7XG4gIGxldCBoZXJvTGV2ZWwgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNoZXJvTGV2ZWxcIik7XG4gIGxldCBoZXJvRVhQID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjaGVyb0VYUFwiKTtcbiAgbGV0IGhlcm9TVFIgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNoZXJvU1RSXCIpO1xuICBsZXQgaGVyb0RFWCA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2hlcm9ERVhcIik7XG4gIGxldCBoZXJvQ09OID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjaGVyb0NPTlwiKTtcbiAgbGV0IGhlcm9JTlQgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNoZXJvSU5UXCIpO1xuICBsZXQgaGVyb0NIQSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI2hlcm9DSEFcIik7XG4gIGxldCBoZXJvQVRLID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjaGVyb0FUS1wiKTtcbiAgbGV0IGhlcm9ERUYgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNoZXJvREVGXCIpO1xuICBsZXQgaGVyb01BVEsgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNoZXJvTUFUS1wiKTtcbiAgbGV0IGhlcm9NREVGID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjaGVyb01ERUZcIik7XG5cbiAgbGV0IHN0YXR1c1dpbmRvd0Nsb3NlID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jc3RhdHVzV2luZG93Q2xvc2VcIik7XG4gIGxldCBzdGF0dXNXaW5kb3dJbnZlbnRvcnkgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNzdGF0dXNXaW5kb3dJbnZlbnRvcnlcIik7XG4gIGxldCBzdGF0dXNXaW5kb3dFcXVpcG1lbnRUYWJsZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiI3N0YXR1c1dpbmRvd0VxdWlwbWVudFRhYmxlXCIpO1xuXG4gIHN0YXR1c1dpbmRvd0Nsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4uaGlkZSgpO1xuICB9KTtcblxuICBzdGF0dXNXaW5kb3dJbnZlbnRvcnkuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5oaWRlKCk7XG4gICAgR2FtZS53aW5kb3dzLmludmVudG9yeS5vcGVuKCk7XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1widGFiXCJdLCBmdW5jdGlvbiAoKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICB3aW4uaGlkZSgpO1xuICAgICAgR2FtZS53aW5kb3dzLmludmVudG9yeS5vcGVuKCk7XG4gICAgfSwgMjApO1xuICB9KTtcblxuICB3aW4ud2hlblVwKFtcImVzY1wiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgd2luLmhpZGUoKTtcbiAgICB9LCAyMClcbiAgfSk7XG5cbiAgd2luLmFzc2lnbihcInVwZGF0ZVwiLCBmdW5jdGlvbiAoc2VsZWN0KSB7XG5cbiAgICBpZiAodHlwZW9mIHNlbGVjdCA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBzZWxlY3QgPSAtMTtcbiAgICB9XG5cbiAgICBsYXN0U2VsZWN0ID0gc2VsZWN0O1xuXG4gICAgaGVyb05hbWUudGV4dENvbnRlbnQgPSBg5ZCN5a2X77yaJHtHYW1lLmhlcm8uZGF0YS5uYW1lfWA7XG4gICAgaGVyb0hQLnRleHRDb250ZW50ID0gYOeUn+WRveWKm++8miR7R2FtZS5oZXJvLmRhdGEuaHB9LyR7R2FtZS5oZXJvLmRhdGEuJGhwfWA7XG4gICAgaGVyb1NQLnRleHRDb250ZW50ID0gYOeyvuelnuWKm++8miR7R2FtZS5oZXJvLmRhdGEuc3B9LyR7R2FtZS5oZXJvLmRhdGEuJHNwfWA7XG4gICAgaGVyb0xldmVsLnRleHRDb250ZW50ID0gYOetiee6p++8miR7R2FtZS5oZXJvLmRhdGEubGV2ZWx9YDtcbiAgICBoZXJvRVhQLnRleHRDb250ZW50ID0gYOe7j+mqjO+8miR7R2FtZS5oZXJvLmRhdGEuZXhwfWA7XG4gICAgaGVyb1NUUi50ZXh0Q29udGVudCA9IGDlipvph4/vvJoke0dhbWUuaGVyby5kYXRhLnN0cn1gO1xuICAgIGhlcm9ERVgudGV4dENvbnRlbnQgPSBg5pWP5o2377yaJHtHYW1lLmhlcm8uZGF0YS5kZXh9YDtcbiAgICBoZXJvQ09OLnRleHRDb250ZW50ID0gYOiAkOWKm++8miR7R2FtZS5oZXJvLmRhdGEuY29ufWA7XG4gICAgaGVyb0lOVC50ZXh0Q29udGVudCA9IGDmmbrlipvvvJoke0dhbWUuaGVyby5kYXRhLmludH1gO1xuICAgIGhlcm9DSEEudGV4dENvbnRlbnQgPSBg6a2F5Yqb77yaJHtHYW1lLmhlcm8uZGF0YS5jaGF9YDtcbiAgICBoZXJvQVRLLnRleHRDb250ZW50ID0gYOaUu+WHu++8miR7R2FtZS5oZXJvLmRhdGEuYXRrfWA7XG4gICAgaGVyb0RFRi50ZXh0Q29udGVudCA9IGDpmLLlvqHvvJoke0dhbWUuaGVyby5kYXRhLmRlZn1gO1xuICAgIGhlcm9NQVRLLnRleHRDb250ZW50ID0gYOmtlOazleaUu+WHu++8miR7R2FtZS5oZXJvLmRhdGEubWF0a31gO1xuICAgIGhlcm9NREVGLnRleHRDb250ZW50ID0gYOmtlOazlemYsuW+oe+8miR7R2FtZS5oZXJvLmRhdGEubWRlZn1gO1xuXG4gICAgbGV0IGxpbmVzID0gc3RhdHVzV2luZG93RXF1aXBtZW50VGFibGUucXVlcnlTZWxlY3RvckFsbChcInRyXCIpO1xuICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBsaW5lcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgaWYgKHNlbGVjdCA9PSBpKSB7XG4gICAgICAgIGxpbmVzW2ldLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiZ3JlZW5cIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpbmVzW2ldLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiXCI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgU3ByaXRlLmVhY2goR2FtZS5oZXJvLmRhdGEuZXF1aXBtZW50LCBmdW5jdGlvbiAoZWxlbWVudCwga2V5KSB7XG4gICAgICBsZXQgYnV0dG9uID0gc3RhdHVzV2luZG93RXF1aXBtZW50QnV0dG9uW2tleV07XG5cbiAgICAgIGlmIChlbGVtZW50KSB7XG4gICAgICAgIGxldCBsaW5lID0gXCJcIjtcbiAgICAgICAgbGluZSArPSBgPGltZyBhbHQ9XCJcIiBzcmM9XCIke0dhbWUuaXRlbXNbZWxlbWVudF0uaWNvbi5zcmN9XCI+YDtcbiAgICAgICAgbGluZSArPSBgPHNwYW4+JHtHYW1lLml0ZW1zW2VsZW1lbnRdLmRhdGEubmFtZX08L3NwYW4+YDtcbiAgICAgICAgc3RhdHVzV2luZG93RXF1aXBtZW50W2tleV0uaW5uZXJIVE1MID0gbGluZTtcbiAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gXCLljbjkuItcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0YXR1c1dpbmRvd0VxdWlwbWVudFtrZXldLmlubmVySFRNTCA9IFwiXCI7XG4gICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IFwi6KOF5aSHXCI7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1wiZW50ZXJcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgYnV0dG9ucyA9IHN0YXR1c1dpbmRvd0VxdWlwbWVudFRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b25cIik7XG4gICAgaWYgKGxhc3RTZWxlY3QgPj0gMCAmJiBsYXN0U2VsZWN0IDwgYnV0dG9ucy5sZW5ndGgpIHtcbiAgICAgIGJ1dHRvbnNbbGFzdFNlbGVjdF0uY2xpY2soKTtcbiAgICB9XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1widXBcIiwgXCJkb3duXCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgbGV0IGNvdW50ID0gc3RhdHVzV2luZG93RXF1aXBtZW50VGFibGUucXVlcnlTZWxlY3RvckFsbChcImJ1dHRvblwiKS5sZW5ndGg7XG5cbiAgICBpZiAobGFzdFNlbGVjdCA9PSAtMSkge1xuICAgICAgaWYgKGtleSA9PSBcImRvd25cIikge1xuICAgICAgICB3aW4ub3BlbigwKTtcbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09IFwidXBcIikge1xuICAgICAgICB3aW4ub3Blbihjb3VudCAtIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoa2V5ID09IFwiZG93blwiKSB7XG4gICAgICAgIGxldCBzZWxlY3QgPSBsYXN0U2VsZWN0ICsgMTtcbiAgICAgICAgaWYgKHNlbGVjdCA+PSBjb3VudCkge1xuICAgICAgICAgIHNlbGVjdCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgd2luLm9wZW4oc2VsZWN0KTtcbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09IFwidXBcIikge1xuICAgICAgICBsZXQgc2VsZWN0ID0gbGFzdFNlbGVjdCAtIDE7XG4gICAgICAgIGlmIChzZWxlY3QgPCAwKSB7XG4gICAgICAgICAgc2VsZWN0ID0gY291bnQgLSAxO1xuICAgICAgICB9XG4gICAgICAgIHdpbi5vcGVuKHNlbGVjdCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICB3aW4uYXNzaWduKFwib3BlblwiLCBmdW5jdGlvbiAoc2VsZWN0KSB7XG4gICAgd2luLnVwZGF0ZShzZWxlY3QpO1xuICAgIHdpbi5zaG93KCk7XG4gIH0pO1xuXG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.sysmenu = Game.Window.create("sysmenuWindow");

  win.html = "\n    <div class=\"window-box\">\n      <button id=\"sysmenuWindowClose\" class=\"brownButton\">关闭窗口</button>\n\n      <table><tbody><tr><td>\n        <button id=\"sysmenuWindowInventory\" class=\"brownButton\">1、背包物品</button>\n        <button id=\"sysmenuWindowStatus\" class=\"brownButton\">2、状态装备</button>\n        <br>\n        <button id=\"sysmenuWindowSkill\" class=\"brownButton\">3、查看技能</button>\n        <button id=\"sysmenuWindowQuest\" class=\"brownButton\">4、任务列表</button>\n        <br>\n        <button id=\"sysmenuWindowMap\" class=\"brownButton\">5、迷你地图</button>\n        <button id=\"sysmenuWindowSetting\" class=\"brownButton\">6、游戏设置</button>\n        <br>\n        <button id=\"sysmenuWindowArchive\" class=\"brownButton\">7、存档管理</button>\n        <button id=\"sysmenuWindowExit\" class=\"brownButton\">8、退出游戏</button>\n        <br>\n      </td></tr></tbody></table>\n    </div>\n  ";

  win.css = "\n    .sysmenuWindow {\n      text-align: center;\n    }\n\n    .sysmenuWindow table, .sysmenuWindow tbody, .sysmenuWindow tr, .sysmenuWindow td {\n      width: 100%;\n      height: 100%;\n      margin: 0;\n      padding: 0;\n    }\n\n    .sysmenuWindow button {\n      width: 200px;\n      height: 60px;\n      margin: 2px;\n      font-size: 16px;\n    }\n\n    button#sysmenuWindowClose {\n      position: absolute;\n      right: 50px;\n      top: 50px;\n      width: 120px;\n      height: 60px;\n      font-size: 16px;\n    }\n  ";

  var sysmenuWindowInventory = win.querySelector("button#sysmenuWindowInventory");
  var sysmenuWindowStatus = win.querySelector("button#sysmenuWindowStatus");

  var sysmenuWindowSkill = win.querySelector("button#sysmenuWindowSkill");
  var sysmenuWindowQuest = win.querySelector("button#sysmenuWindowQuest");

  var sysmenuWindowMap = win.querySelector("button#sysmenuWindowMap");
  var sysmenuWindowSetting = win.querySelector("button#sysmenuWindowSetting");

  var sysmenuWindowArchive = win.querySelector("button#sysmenuWindowArchive");
  var sysmenuWindowExit = win.querySelector("button#sysmenuWindowExit");

  var sysmenuWindowClose = win.querySelector("button#sysmenuWindowClose");

  win.whenUp(["esc"], function (key) {
    sysmenuWindowClose.click();
  });

  win.whenUp(["1", "2", "3", "4", "5", "6", "7", "8"], function (key) {
    switch (key) {
      case "1":
        sysmenuWindowInventory.click();
        break;
      case "2":
        sysmenuWindowStatus.click();
        break;
      case "3":
        sysmenuWindowSkill.click();
        break;
      case "4":
        sysmenuWindowQuest.click();
        break;
      case "5":
        sysmenuWindowMap.click();
        break;
      case "6":
        sysmenuWindowSetting.click();
        break;
      case "7":
        sysmenuWindowArchive.click();
        break;
      case "8":
        sysmenuWindowExit.click();
        break;
    }
  });

  sysmenuWindowInventory.addEventListener("click", function (event) {
    win.hide();
    Game.windows.inventory.open();
  });

  sysmenuWindowStatus.addEventListener("click", function (event) {
    win.hide();
    Game.windows.status.open();
  });

  sysmenuWindowSkill.addEventListener("click", function (event) {
    win.hide();
    Game.windows.skill.open();
  });

  sysmenuWindowQuest.addEventListener("click", function (event) {
    win.hide();
    Game.windows.quest.current();
  });

  sysmenuWindowMap.addEventListener("click", function (event) {
    win.hide();
    Game.windows.map.show();
  });

  sysmenuWindowSetting.addEventListener("click", function (event) {
    win.hide();
    Game.windows.setting.show();
  });

  sysmenuWindowArchive.addEventListener("click", function (event) {
    win.hide();
    Game.windows.archive.open();
  });

  sysmenuWindowExit.addEventListener("click", function (event) {
    Game.clearStage();
    win.hide();
    Game.windows.main.show();
  });

  sysmenuWindowClose.addEventListener("click", function (event) {
    win.hide();
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dTeXNtZW51LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDOztBQUVyRSxLQUFHLENBQUMsSUFBSSwwNEJBbUJQLENBQUM7O0FBRUYsS0FBRyxDQUFDLEdBQUcseWhCQTJCTixDQUFDOztBQUVGLE1BQUksc0JBQXNCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0FBQ2hGLE1BQUksbUJBQW1CLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDOztBQUUxRSxNQUFJLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUN4RSxNQUFJLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsMkJBQTJCLENBQUMsQ0FBQzs7QUFFeEUsTUFBSSxnQkFBZ0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHlCQUF5QixDQUFDLENBQUM7QUFDcEUsTUFBSSxvQkFBb0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLDZCQUE2QixDQUFDLENBQUM7O0FBRTVFLE1BQUksb0JBQW9CLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO0FBQzVFLE1BQUksaUJBQWlCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDOztBQUV0RSxNQUFJLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsMkJBQTJCLENBQUMsQ0FBQzs7QUFFeEUsS0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLFVB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RUgsbUJBQWlCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVUsS0FBSyxFQUFFO0FBQzNELFFBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztBQUNsQixPQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWCxRQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztHQUMxQixDQUFDLENBQUM7O0FBRUgsb0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVUsS0FBSyxFQUFFO0FBQzVELE9BQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztHQUNaLENBQUMsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVXaW5kb3dTeXNtZW51LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IHdpbiA9IEdhbWUud2luZG93cy5zeXNtZW51ID0gR2FtZS5XaW5kb3cuY3JlYXRlKFwic3lzbWVudVdpbmRvd1wiKTtcblxuICB3aW4uaHRtbCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwid2luZG93LWJveFwiPlxuICAgICAgPGJ1dHRvbiBpZD1cInN5c21lbnVXaW5kb3dDbG9zZVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7lhbPpl63nqpflj6M8L2J1dHRvbj5cblxuICAgICAgPHRhYmxlPjx0Ym9keT48dHI+PHRkPlxuICAgICAgICA8YnV0dG9uIGlkPVwic3lzbWVudVdpbmRvd0ludmVudG9yeVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj4x44CB6IOM5YyF54mp5ZOBPC9idXR0b24+XG4gICAgICAgIDxidXR0b24gaWQ9XCJzeXNtZW51V2luZG93U3RhdHVzXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPjLjgIHnirbmgIHoo4XlpIc8L2J1dHRvbj5cbiAgICAgICAgPGJyPlxuICAgICAgICA8YnV0dG9uIGlkPVwic3lzbWVudVdpbmRvd1NraWxsXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPjPjgIHmn6XnnIvmioDog708L2J1dHRvbj5cbiAgICAgICAgPGJ1dHRvbiBpZD1cInN5c21lbnVXaW5kb3dRdWVzdFwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj4044CB5Lu75Yqh5YiX6KGoPC9idXR0b24+XG4gICAgICAgIDxicj5cbiAgICAgICAgPGJ1dHRvbiBpZD1cInN5c21lbnVXaW5kb3dNYXBcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+NeOAgei/t+S9oOWcsOWbvjwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGlkPVwic3lzbWVudVdpbmRvd1NldHRpbmdcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+NuOAgea4uOaIj+iuvue9rjwvYnV0dG9uPlxuICAgICAgICA8YnI+XG4gICAgICAgIDxidXR0b24gaWQ9XCJzeXNtZW51V2luZG93QXJjaGl2ZVwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj4344CB5a2Y5qGj566h55CGPC9idXR0b24+XG4gICAgICAgIDxidXR0b24gaWQ9XCJzeXNtZW51V2luZG93RXhpdFwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj4444CB6YCA5Ye65ri45oiPPC9idXR0b24+XG4gICAgICAgIDxicj5cbiAgICAgIDwvdGQ+PC90cj48L3Rib2R5PjwvdGFibGU+XG4gICAgPC9kaXY+XG4gIGA7XG5cbiAgd2luLmNzcyA9IGBcbiAgICAuc3lzbWVudVdpbmRvdyB7XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgfVxuXG4gICAgLnN5c21lbnVXaW5kb3cgdGFibGUsIC5zeXNtZW51V2luZG93IHRib2R5LCAuc3lzbWVudVdpbmRvdyB0ciwgLnN5c21lbnVXaW5kb3cgdGQge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICBtYXJnaW46IDA7XG4gICAgICBwYWRkaW5nOiAwO1xuICAgIH1cblxuICAgIC5zeXNtZW51V2luZG93IGJ1dHRvbiB7XG4gICAgICB3aWR0aDogMjAwcHg7XG4gICAgICBoZWlnaHQ6IDYwcHg7XG4gICAgICBtYXJnaW46IDJweDtcbiAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICB9XG5cbiAgICBidXR0b24jc3lzbWVudVdpbmRvd0Nsb3NlIHtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIHJpZ2h0OiA1MHB4O1xuICAgICAgdG9wOiA1MHB4O1xuICAgICAgd2lkdGg6IDEyMHB4O1xuICAgICAgaGVpZ2h0OiA2MHB4O1xuICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgIH1cbiAgYDtcblxuICBsZXQgc3lzbWVudVdpbmRvd0ludmVudG9yeSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI3N5c21lbnVXaW5kb3dJbnZlbnRvcnlcIik7XG4gIGxldCBzeXNtZW51V2luZG93U3RhdHVzID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jc3lzbWVudVdpbmRvd1N0YXR1c1wiKTtcblxuICBsZXQgc3lzbWVudVdpbmRvd1NraWxsID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jc3lzbWVudVdpbmRvd1NraWxsXCIpO1xuICBsZXQgc3lzbWVudVdpbmRvd1F1ZXN0ID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jc3lzbWVudVdpbmRvd1F1ZXN0XCIpO1xuXG4gIGxldCBzeXNtZW51V2luZG93TWFwID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jc3lzbWVudVdpbmRvd01hcFwiKTtcbiAgbGV0IHN5c21lbnVXaW5kb3dTZXR0aW5nID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jc3lzbWVudVdpbmRvd1NldHRpbmdcIik7XG5cbiAgbGV0IHN5c21lbnVXaW5kb3dBcmNoaXZlID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jc3lzbWVudVdpbmRvd0FyY2hpdmVcIik7XG4gIGxldCBzeXNtZW51V2luZG93RXhpdCA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI3N5c21lbnVXaW5kb3dFeGl0XCIpO1xuXG4gIGxldCBzeXNtZW51V2luZG93Q2xvc2UgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNzeXNtZW51V2luZG93Q2xvc2VcIik7XG5cbiAgd2luLndoZW5VcChbXCJlc2NcIl0sIGZ1bmN0aW9uIChrZXkpIHtcbiAgICBzeXNtZW51V2luZG93Q2xvc2UuY2xpY2soKTtcbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCIsIFwiNVwiLCBcIjZcIiwgXCI3XCIsIFwiOFwiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICBjYXNlIFwiMVwiOlxuICAgICAgICBzeXNtZW51V2luZG93SW52ZW50b3J5LmNsaWNrKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIjJcIjpcbiAgICAgICAgc3lzbWVudVdpbmRvd1N0YXR1cy5jbGljaygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCIzXCI6XG4gICAgICAgIHN5c21lbnVXaW5kb3dTa2lsbC5jbGljaygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCI0XCI6XG4gICAgICAgIHN5c21lbnVXaW5kb3dRdWVzdC5jbGljaygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCI1XCI6XG4gICAgICAgIHN5c21lbnVXaW5kb3dNYXAuY2xpY2soKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiNlwiOlxuICAgICAgICBzeXNtZW51V2luZG93U2V0dGluZy5jbGljaygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCI3XCI6XG4gICAgICAgIHN5c21lbnVXaW5kb3dBcmNoaXZlLmNsaWNrKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIjhcIjpcbiAgICAgICAgc3lzbWVudVdpbmRvd0V4aXQuY2xpY2soKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9KTtcblxuICBzeXNtZW51V2luZG93SW52ZW50b3J5LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4uaGlkZSgpO1xuICAgIEdhbWUud2luZG93cy5pbnZlbnRvcnkub3BlbigpO1xuICB9KTtcblxuICBzeXNtZW51V2luZG93U3RhdHVzLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4uaGlkZSgpO1xuICAgIEdhbWUud2luZG93cy5zdGF0dXMub3BlbigpO1xuICB9KTtcblxuICBzeXNtZW51V2luZG93U2tpbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5oaWRlKCk7XG4gICAgR2FtZS53aW5kb3dzLnNraWxsLm9wZW4oKTtcbiAgfSk7XG5cbiAgc3lzbWVudVdpbmRvd1F1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4uaGlkZSgpO1xuICAgIEdhbWUud2luZG93cy5xdWVzdC5jdXJyZW50KCk7XG4gIH0pO1xuXG4gIHN5c21lbnVXaW5kb3dNYXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5oaWRlKCk7XG4gICAgR2FtZS53aW5kb3dzLm1hcC5zaG93KCk7XG4gIH0pO1xuXG4gIHN5c21lbnVXaW5kb3dTZXR0aW5nLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4uaGlkZSgpO1xuICAgIEdhbWUud2luZG93cy5zZXR0aW5nLnNob3coKTtcbiAgfSk7XG5cbiAgc3lzbWVudVdpbmRvd0FyY2hpdmUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5oaWRlKCk7XG4gICAgR2FtZS53aW5kb3dzLmFyY2hpdmUub3BlbigpO1xuICB9KTtcblxuICBzeXNtZW51V2luZG93RXhpdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgR2FtZS5jbGVhclN0YWdlKCk7XG4gICAgd2luLmhpZGUoKTtcbiAgICBHYW1lLndpbmRvd3MubWFpbi5zaG93KCk7XG4gIH0pO1xuXG4gIHN5c21lbnVXaW5kb3dDbG9zZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLmhpZGUoKTtcbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  /**
   * 自动寻路算法 A*
   */
  Game.assign("Astar", (function () {
    function GameAstar() {
      _classCallCheck(this, GameAstar);
    }

    _createClass(GameAstar, null, [{
      key: "getPath",

      /**
       * @param {function} collisionFunction 测试是否阻挡
       * @param {Object} start 起始位置 eg. {x: 0, y: 0}
       * @param {Object} end
       */
      value: function getPath(start, end, callback) {

        // console.time("t");

        var blocked = {};
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = Game.area.actors[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var actor = _step.value;

            if (actor.x != start.x || actor.y != start.y) {
              blocked[actor.x * 10000 + actor.y] = true;
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator["return"]) {
              _iterator["return"]();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        var result = path(function (x, y) {
          // 判断函数，判断是否阻挡
          if (x < 0 || x >= Game.area.map.col) {
            return true; // 有阻挡，返回true
          }
          if (y < 0 || y >= Game.area.map.row) {
            return true; // 有阻挡，返回true
          }
          var key = x * 10000 + y;
          if (Game.area.map.blockedMap[key]) {
            return true; // 有阻挡，返回true
          }
          if (blocked[key]) {
            return true; // 有阻挡，返回true
          }
          return false; // 没有阻挡
        }, start, end);

        // console.timeEnd("t");

        callback(result);
      }
    }]);

    return GameAstar;
  })());

  /*
  * reference from http://eloquentjavascript.net/1st_edition/appendix2.html
  */

  var BinaryHeap = (function () {
    function BinaryHeap(scoreFunction) {
      _classCallCheck(this, BinaryHeap);

      this.content = [];
      this.scoreFunction = scoreFunction;
      this.scores = new Map();
    }

    _createClass(BinaryHeap, [{
      key: "push",
      value: function push(element) {
        this.scores.set(element, this.scoreFunction(element));
        this.content.push(element);
        this.bubbleUp(this.content.length - 1);
      }
    }, {
      key: "pop",
      value: function pop() {
        var r = this.content[0];
        var e = this.content.pop();
        if (this.content.length > 0) {
          this.content[0] = e;
          this.sinkDown(0);
        }
        return r;
      }
    }, {
      key: "delete",
      value: function _delete(node) {
        for (var i = 0, len = this.content.length; i < len; i++) {
          if (this.content[i] == node) {
            this.scores["delete"](this.content[i]);
            var e = this.content.pop();
            if (i == len - 1) {
              break;
            }
            this.content[i] = e;
            this.bubbleUp(i);
            this.sinkDown(i);
            break;
          }
        }
      }
    }, {
      key: "bubbleUp",
      value: function bubbleUp(n) {
        var element = this.content[n];
        var score = this.scores.get(element);
        while (n > 0) {
          var parentN = Math.floor((n + 1) / 2) - 1;
          var _parent = this.content[parentN];
          if (score >= this.scores.get(_parent)) break;
          this.content[parentN] = element;
          this.content[n] = _parent;
          n = parentN;
        }
      }
    }, {
      key: "sinkDown",
      value: function sinkDown(n) {
        var len = this.content.length;
        var element = this.content[n];
        var score = this.scores.get(element);

        while (true) {
          var child2N = (n + 1) * 2;
          var child1N = child2N - 1;
          var swap = null;
          var child1score = undefined,
              child2score = undefined;

          if (child1N < len) {
            var child1 = this.content[child1N];
            child1score = this.scores.get(child1);
            if (child1score < score) {
              swap = child1N;
            }
          }

          if (child2N < len) {
            var child2 = this.content[child2N];
            child2score = this.scores.get(child2);
            if (child2score < (swap == null ? score : child1score)) {
              swap = child2N;
            }
          }

          if (swap == null) {
            break;
          }

          this.content[n] = this.content[swap];
          this.content[swap] = element;
          n = swap;
        }
      }
    }, {
      key: "size",
      get: function get() {
        return this.content.length;
      },
      set: function set(value) {
        throw new Error("BinaryHeap.size readonly");
      }
    }]);

    return BinaryHeap;
  })();

  ; // BinaryHeap

  // 计算点结构a和b之间的曼哈顿距离，即不带斜走的直线距离
  function manhattan(ax, ay, bx, by) {
    return Math.abs(ax - bx) + Math.abs(ay - by);
  }

  // 通过坐标x，y，当前最好的节点best和一个附加值（直线10，斜线14），返回一个新节点
  function make(x, y, end, best, addition) {
    var t = {
      key: x * 10000 + y,
      x: x,
      y: y,
      g: best.g + addition,
      h: manhattan(x, y, end.x, end.y),
      front: []
    };
    t.f = t.g + t.h;
    var len = best.front.length;
    t.front.length = len;
    for (var i = 0; i < len; i++) {
      t.front[i] = best.front[i];
    }
    t.front.push(best.x);
    t.front.push(best.y);
    return t;
  }

  function path(collisionFunction, start, end) {

    // 开启列表和关闭列表
    var open = new BinaryHeap(function (element) {
      return element.f;
    });
    var openIndex = new Set();
    var closeIndex = new Set();

    //构建起始节点
    var startElement = {
      key: start.x * 10000 + start.y,
      x: start.x,
      y: start.y,
      f: 0,
      g: 0,
      h: manhattan(start.x, start.y, end.x, end.y),
      front: []
    };
    openIndex.add(startElement.key);
    open.push(startElement);

    var push2open = function push2open(x, y, end, best) {
      if (!collisionFunction(x, y)) {
        // 验证up
        var key = x * 10000 + y;
        if (!openIndex.has(key) && !closeIndex.has(key)) {
          openIndex.add(key);
          open.push(make(x, y, end, best, 10));
        }
      }
    };

    while (open.size) {
      // F值最小的节点，就是堆顶
      var best = open.pop();
      // 从开启列表中删除，加入关闭列表
      open["delete"](best);
      openIndex["delete"](best.key);
      closeIndex.add(best.key);

      // 如果这个最好的节点就是结尾节点，则返回
      if (best.x == end.x && best.y == end.y) {
        var result = [];
        for (var i = 0, len = best.front.length; i < len; i += 2) {
          result.push({
            x: best.front[i],
            y: best.front[i + 1]
          });
        }
        result.push({
          x: end.x,
          y: end.y
        });
        return result;
      }

      // 记录上下左右四方向的可能值
      push2open(best.x, best.y - 1, end, best);
      push2open(best.x, best.y + 1, end, best);
      push2open(best.x - 1, best.y, end, best);
      push2open(best.x + 1, best.y, end, best);
    } // while

    return null;
  }
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVBc3Rhci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7Ozs7O0FBS2IsTUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPO2FBQVEsU0FBUzs0QkFBVCxTQUFTOzs7aUJBQVQsU0FBUzs7Ozs7Ozs7YUFNbEIsaUJBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUU7Ozs7QUFJcEMsWUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDOzs7Ozs7QUFDakIsK0JBQWtCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSw4SEFBRTtnQkFBM0IsS0FBSzs7QUFDWixnQkFBSSxLQUFLLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxFQUFFO0FBQzVDLHFCQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxLQUFLLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQzthQUMzQztXQUNGOzs7Ozs7Ozs7Ozs7Ozs7O0FBRUQsWUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsRUFBRTs7QUFFaEMsY0FBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUU7QUFDbkMsbUJBQU8sSUFBSSxDQUFDO1dBQ2I7QUFDRCxjQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRTtBQUNuQyxtQkFBTyxJQUFJLENBQUM7V0FDYjtBQUNELGNBQUksR0FBRyxHQUFHLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0FBQ3hCLGNBQUksSUFBSSxDQUFDLElBQUksQ0FB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RyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ3pDLGVBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztLQUUxQzs7QUFFRCxXQUFPLElBQUksQ0FBQztHQUNiO0NBR0YsQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiR2FtZUFzdGFyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgLyoqXG4gICAqIOiHquWKqOWvu+i3r+eul+azlSBBKlxuICAgKi9cbiAgR2FtZS5hc3NpZ24oXCJBc3RhclwiLCBjbGFzcyBHYW1lQXN0YXIge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNvbGxpc2lvbkZ1bmN0aW9uIOa1i+ivleaYr+WQpumYu+aMoVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzdGFydCDotbflp4vkvY3nva4gZWcuIHt4OiAwLCB5OiAwfVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlbmRcbiAgICAgKi9cbiAgICAgc3RhdGljIGdldFBhdGggKHN0YXJ0LCBlbmQsIGNhbGxiYWNrKSB7XG5cbiAgICAgICAvLyBjb25zb2xlLnRpbWUoXCJ0XCIpO1xuXG4gICAgICAgbGV0IGJsb2NrZWQgPSB7fTtcbiAgICAgICBmb3IgKGxldCBhY3RvciBvZiBHYW1lLmFyZWEuYWN0b3JzKSB7XG4gICAgICAgICBpZiAoYWN0b3IueCAhPSBzdGFydC54IHx8IGFjdG9yLnkgIT0gc3RhcnQueSkge1xuICAgICAgICAgICBibG9ja2VkW2FjdG9yLnggKiAxMDAwMCArIGFjdG9yLnldID0gdHJ1ZTtcbiAgICAgICAgIH1cbiAgICAgICB9XG5cbiAgICAgICBsZXQgcmVzdWx0ID0gcGF0aChmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICAgLy8g5Yik5pat5Ye95pWw77yM5Yik5pat5piv5ZCm6Zi75oyhXG4gICAgICAgICBpZiAoeCA8IDAgfHwgeCA+PSBHYW1lLmFyZWEubWFwLmNvbCkge1xuICAgICAgICAgICByZXR1cm4gdHJ1ZTsgLy8g5pyJ6Zi75oyh77yM6L+U5ZuedHJ1ZVxuICAgICAgICAgfVxuICAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gR2FtZS5hcmVhLm1hcC5yb3cpIHtcbiAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIOaciemYu+aMoe+8jOi/lOWbnnRydWVcbiAgICAgICAgIH1cbiAgICAgICAgIGxldCBrZXkgPSB4ICogMTAwMDAgKyB5O1xuICAgICAgICAgaWYgKEdhbWUuYXJlYS5tYXAuYmxvY2tlZE1hcFtrZXldKSB7XG4gICAgICAgICAgIHJldHVybiB0cnVlOyAvLyDmnInpmLvmjKHvvIzov5Tlm550cnVlXG4gICAgICAgICB9XG4gICAgICAgICBpZiAoYmxvY2tlZFtrZXldKSB7XG4gICAgICAgICAgIHJldHVybiB0cnVlOyAvLyDmnInpmLvmjKHvvIzov5Tlm550cnVlXG4gICAgICAgICB9XG4gICAgICAgICByZXR1cm4gZmFsc2U7IC8vIOayoeaciemYu+aMoVxuICAgICAgIH0sIHN0YXJ0LCBlbmQpO1xuXG4gICAgICAgLy8gY29uc29sZS50aW1lRW5kKFwidFwiKTtcblxuICAgICAgIGNhbGxiYWNrKHJlc3VsdCk7XG4gICAgIH1cblxuXG4gIH0pO1xuXG4gIC8qXG4gICogcmVmZXJlbmNlIGZyb20gaHR0cDovL2Vsb3F1ZW50amF2YXNjcmlwdC5uZXQvMXN0X2VkaXRpb24vYXBwZW5kaXgyLmh0bWxcbiAgKi9cbiAgY2xhc3MgQmluYXJ5SGVhcCB7XG5cbiAgICBjb25zdHJ1Y3RvciAoc2NvcmVGdW5jdGlvbikge1xuICAgICAgdGhpcy5jb250ZW50ID0gW107XG4gICAgICB0aGlzLnNjb3JlRnVuY3Rpb24gPSBzY29yZUZ1bmN0aW9uO1xuICAgICAgdGhpcy5zY29yZXMgPSBuZXcgTWFwKCk7XG4gICAgfVxuXG4gICAgcHVzaCAoZWxlbWVudCkge1xuICAgICAgdGhpcy5zY29yZXMuc2V0KGVsZW1lbnQsIHRoaXMuc2NvcmVGdW5jdGlvbihlbGVtZW50KSk7XG4gICAgICB0aGlzLmNvbnRlbnQucHVzaChlbGVtZW50KTtcbiAgICAgIHRoaXMuYnViYmxlVXAodGhpcy5jb250ZW50Lmxlbmd0aCAtIDEpO1xuICAgIH1cblxuICAgIHBvcCAoKSB7XG4gICAgICBsZXQgciA9IHRoaXMuY29udGVudFswXTtcbiAgICAgIGxldCBlID0gdGhpcy5jb250ZW50LnBvcCgpO1xuICAgICAgaWYgKHRoaXMuY29udGVudC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMuY29udGVudFswXSA9IGU7XG4gICAgICAgIHRoaXMuc2lua0Rvd24oMCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcjtcbiAgICB9XG5cbiAgICBkZWxldGUgKG5vZGUpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLmNvbnRlbnQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFtpXSA9PSBub2RlKSB7XG4gICAgICAgICAgdGhpcy5zY29yZXMuZGVsZXRlKHRoaXMuY29udGVudFtpXSk7XG4gICAgICAgICAgbGV0IGUgPSB0aGlzLmNvbnRlbnQucG9wKCk7XG4gICAgICAgICAgaWYgKGkgPT0gbGVuIC0gMSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY29udGVudFtpXSA9IGU7XG4gICAgICAgICAgdGhpcy5idWJibGVVcChpKTtcbiAgICAgICAgICB0aGlzLnNpbmtEb3duKGkpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHNpemUgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29udGVudC5sZW5ndGg7XG4gICAgfVxuXG4gICAgc2V0IHNpemUgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJCaW5hcnlIZWFwLnNpemUgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgYnViYmxlVXAgKG4pIHtcbiAgICAgIGxldCBlbGVtZW50ID0gdGhpcy5jb250ZW50W25dO1xuICAgICAgbGV0IHNjb3JlID0gdGhpcy5zY29yZXMuZ2V0KGVsZW1lbnQpO1xuICAgICAgd2hpbGUgKG4gPiAwKSB7XG4gICAgICAgIGxldCBwYXJlbnROID0gTWF0aC5mbG9vcigobiArIDEpIC8gMikgLSAxO1xuICAgICAgICBsZXQgcGFyZW50ID0gdGhpcy5jb250ZW50W3BhcmVudE5dO1xuICAgICAgICBpZiAoc2NvcmUgPj0gdGhpcy5zY29yZXMuZ2V0KHBhcmVudCkpXG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIHRoaXMuY29udGVudFtwYXJlbnROXSA9IGVsZW1lbnQ7XG4gICAgICAgIHRoaXMuY29udGVudFtuXSA9IHBhcmVudDtcbiAgICAgICAgbiA9IHBhcmVudE47XG4gICAgICB9XG4gICAgfVxuXG4gICAgc2lua0Rvd24gKG4pIHtcbiAgICAgIGxldCBsZW4gPSB0aGlzLmNvbnRlbnQubGVuZ3RoO1xuICAgICAgbGV0IGVsZW1lbnQgPSB0aGlzLmNvbnRlbnRbbl07XG4gICAgICBsZXQgc2NvcmUgPSB0aGlzLnNjb3Jlcy5nZXQoZWxlbWVudCk7XG5cbiAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGxldCBjaGlsZDJOID0gKG4gKyAxKSAqIDI7XG4gICAgICAgIGxldCBjaGlsZDFOID0gY2hpbGQyTiAtIDE7XG4gICAgICAgIGxldCBzd2FwID0gbnVsbDtcbiAgICAgICAgbGV0IGNoaWxkMXNjb3JlLCBjaGlsZDJzY29yZTtcblxuICAgICAgICBpZiAoY2hpbGQxTiA8IGxlbikge1xuICAgICAgICAgIGxldCBjaGlsZDEgPSB0aGlzLmNvbnRlbnRbY2hpbGQxTl07XG4gICAgICAgICAgY2hpbGQxc2NvcmUgPSB0aGlzLnNjb3Jlcy5nZXQoY2hpbGQxKTtcbiAgICAgICAgICBpZiAoY2hpbGQxc2NvcmUgPCBzY29yZSkge1xuICAgICAgICAgICAgc3dhcCA9IGNoaWxkMU47XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNoaWxkMk4gPCBsZW4pIHtcbiAgICAgICAgICBsZXQgY2hpbGQyID0gdGhpcy5jb250ZW50W2NoaWxkMk5dO1xuICAgICAgICAgIGNoaWxkMnNjb3JlID0gdGhpcy5zY29yZXMuZ2V0KGNoaWxkMik7XG4gICAgICAgICAgaWYgKGNoaWxkMnNjb3JlIDwgKHN3YXAgPT0gbnVsbCA/IHNjb3JlIDogY2hpbGQxc2NvcmUpKSB7XG4gICAgICAgICAgICBzd2FwID0gY2hpbGQyTjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc3dhcCA9PSBudWxsKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNvbnRlbnRbbl0gPSB0aGlzLmNvbnRlbnRbc3dhcF07XG4gICAgICAgIHRoaXMuY29udGVudFtzd2FwXSA9IGVsZW1lbnQ7XG4gICAgICAgIG4gPSBzd2FwO1xuICAgICAgfVxuXG4gICAgfVxuXG4gIH07IC8vIEJpbmFyeUhlYXBcblxuICAvLyDorqHnrpfngrnnu5PmnoRh5ZKMYuS5i+mXtOeahOabvOWTiOmhv+i3neemu++8jOWNs+S4jeW4puaWnOi1sOeahOebtOe6v+i3neemu1xuICBmdW5jdGlvbiBtYW5oYXR0YW4gKGF4LCBheSwgYngsIGJ5KSB7XG4gICAgcmV0dXJuIE1hdGguYWJzKGF4IC0gYngpICsgTWF0aC5hYnMoYXkgLSBieSk7XG4gIH1cblxuICAvLyDpgJrov4flnZDmoId477yMee+8jOW9k+WJjeacgOWlveeahOiKgueCuWJlc3TlkozkuIDkuKrpmYTliqDlgLzvvIjnm7Tnur8xMO+8jOaWnOe6vzE077yJ77yM6L+U5Zue5LiA5Liq5paw6IqC54K5XG4gIGZ1bmN0aW9uIG1ha2UgKHgsIHksIGVuZCwgYmVzdCwgYWRkaXRpb24pIHtcbiAgICBsZXQgdCA9IHtcbiAgICAgIGtleTogeCAqIDEwMDAwICsgeSxcbiAgICAgIHg6IHgsXG4gICAgICB5OiB5LFxuICAgICAgZzogYmVzdC5nICsgYWRkaXRpb24sXG4gICAgICBoOiBtYW5oYXR0YW4oeCwgeSwgZW5kLngsIGVuZC55KSxcbiAgICAgIGZyb250OiBbXVxuICAgIH07XG4gICAgdC5mID0gdC5nICsgdC5oO1xuICAgIGxldCBsZW4gID0gYmVzdC5mcm9udC5sZW5ndGg7XG4gICAgdC5mcm9udC5sZW5ndGggPSBsZW47XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgdC5mcm9udFtpXSA9IGJlc3QuZnJvbnRbaV07XG4gICAgfVxuICAgIHQuZnJvbnQucHVzaChiZXN0LngpO1xuICAgIHQuZnJvbnQucHVzaChiZXN0LnkpO1xuICAgIHJldHVybiB0O1xuICB9XG5cbiAgZnVuY3Rpb24gcGF0aCAoY29sbGlzaW9uRnVuY3Rpb24sIHN0YXJ0LCBlbmQpIHtcblxuICAgIC8vIOW8gOWQr+WIl+ihqOWSjOWFs+mXreWIl+ihqFxuICAgIGxldCBvcGVuID0gbmV3IEJpbmFyeUhlYXAoZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBlbGVtZW50LmY7XG4gICAgfSk7XG4gICAgbGV0IG9wZW5JbmRleCA9IG5ldyBTZXQoKTtcbiAgICBsZXQgY2xvc2VJbmRleCA9IG5ldyBTZXQoKTtcblxuICAgIC8v5p6E5bu66LW35aeL6IqC54K5XG4gICAgbGV0IHN0YXJ0RWxlbWVudCA9IHtcbiAgICAgIGtleTogc3RhcnQueCoxMDAwMCtzdGFydC55LFxuICAgICAgeDogc3RhcnQueCxcbiAgICAgIHk6IHN0YXJ0LnksXG4gICAgICBmOiAwLFxuICAgICAgZzogMCxcbiAgICAgIGg6IG1hbmhhdHRhbihzdGFydC54LCBzdGFydC55LCBlbmQueCwgZW5kLnkpLFxuICAgICAgZnJvbnQ6IFtdXG4gICAgfTtcbiAgICBvcGVuSW5kZXguYWRkKHN0YXJ0RWxlbWVudC5rZXkpO1xuICAgIG9wZW4ucHVzaChzdGFydEVsZW1lbnQpO1xuXG4gICAgbGV0IHB1c2gyb3BlbiA9IGZ1bmN0aW9uICh4LCB5LCBlbmQsIGJlc3QpIHtcbiAgICAgIGlmICghY29sbGlzaW9uRnVuY3Rpb24oeCwgeSkpIHsgLy8g6aqM6K+BdXBcbiAgICAgICAgbGV0IGtleSA9IHggKiAxMDAwMCArIHk7XG4gICAgICAgIGlmICghb3BlbkluZGV4LmhhcyhrZXkpICYmICFjbG9zZUluZGV4LmhhcyhrZXkpKSB7XG4gICAgICAgICAgb3BlbkluZGV4LmFkZChrZXkpO1xuICAgICAgICAgIG9wZW4ucHVzaChtYWtlKHgsIHksIGVuZCwgYmVzdCwgMTApKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICB3aGlsZSAob3Blbi5zaXplKSB7XG4gICAgICAvLyBG5YC85pyA5bCP55qE6IqC54K577yM5bCx5piv5aCG6aG2XG4gICAgICBsZXQgYmVzdCA9IG9wZW4ucG9wKCk7XG4gICAgICAvLyDku47lvIDlkK/liJfooajkuK3liKDpmaTvvIzliqDlhaXlhbPpl63liJfooahcbiAgICAgIG9wZW4uZGVsZXRlKGJlc3QpO1xuICAgICAgb3BlbkluZGV4LmRlbGV0ZShiZXN0LmtleSk7XG4gICAgICBjbG9zZUluZGV4LmFkZChiZXN0LmtleSk7XG5cbiAgICAgIC8vIOWmguaenOi/meS4quacgOWlveeahOiKgueCueWwseaYr+e7k+WwvuiKgueCue+8jOWImei/lOWbnlxuICAgICAgaWYgKGJlc3QueCA9PSBlbmQueCAmJiBiZXN0LnkgPT0gZW5kLnkpIHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gYmVzdC5mcm9udC5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMikge1xuICAgICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgIHg6IGJlc3QuZnJvbnRbaV0sXG4gICAgICAgICAgICB5OiBiZXN0LmZyb250W2kgKyAxXVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICB4OiBlbmQueCxcbiAgICAgICAgICB5OiBlbmQueVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgLy8g6K6w5b2V5LiK5LiL5bem5Y+z5Zub5pa55ZCR55qE5Y+v6IO95YC8XG4gICAgICBwdXNoMm9wZW4oYmVzdC54LCBiZXN0LnkgLSAxLCBlbmQsIGJlc3QpO1xuICAgICAgcHVzaDJvcGVuKGJlc3QueCwgYmVzdC55ICsgMSwgZW5kLCBiZXN0KTtcbiAgICAgIHB1c2gyb3BlbihiZXN0LnggLSAxLCBiZXN0LnksIGVuZCwgYmVzdCk7XG4gICAgICBwdXNoMm9wZW4oYmVzdC54ICsgMSwgYmVzdC55LCBlbmQsIGJlc3QpO1xuXG4gICAgfSAvLyB3aGlsZVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  Game.assign("AI", (function () {
    function GameAI() {
      _classCallCheck(this, GameAI);
    }

    _createClass(GameAI, null, [{
      key: "attach",
      value: function attach(hero) {}
    }]);

    return GameAI;
  })());
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVBSS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXFCQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJO2FBQVEsTUFBTTs0QkFBTixNQUFNOzs7aUJBQU4sTUFBTTs7YUFFZCxnQkFBQyxJQUFJLEVBQUUsRUFDcEI7OztXQUhxQixNQUFNO09BSzVCLENBQUM7Q0FFSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lQUkuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIEdhbWUuYXNzaWduKFwiQUlcIiwgY2xhc3MgR2FtZUFJIHtcblxuICAgIHN0YXRpYyBhdHRhY2ggKGhlcm8pIHtcbiAgICB9XG5cbiAgfSk7XG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  function boxCollide(spriteA, spriteB, rectA, rectB) {
    var A = {
      x: spriteA.x - rectA.centerX,
      y: spriteA.y - rectA.centerY,
      w: rectA.width,
      h: rectA.height,
      sx: rectA.x,
      sy: rectA.y,
      sw: rectA.width,
      sh: rectA.height,
      image: rectA.image
    };

    var B = {
      x: spriteB.x - rectB.centerX,
      y: spriteB.y - rectB.centerY,
      w: rectB.width,
      h: rectB.height,
      sx: rectB.x,
      sy: rectB.y,
      sw: rectB.width,
      sh: rectB.height,
      image: rectB.image
    };

    var bigX = Math.max(A.x + A.w, B.x + B.w);
    var smallX = Math.min(A.x, B.x);
    var bigY = Math.max(A.y + A.h, B.y + B.h);
    var smallY = Math.min(A.y, B.y);

    var width = bigX - smallX;
    var height = bigY - smallY;

    if (width < A.w + B.w && height < A.h + B.h) {
      return {
        A: A,
        B: B
      };
    }
    return false;
  }

  var collideCavansCache = new Map();

  function pixelCollide(A, B) {
    // 对图像进行某种意义上的移动，例如把上面的图的A和B都平移到左上角，也就是AA的左上角变为0,0坐标

    var now = new Date().getTime();

    // WWWHHH
    var key = A.w * 1000 + A.h;
    var canvas = undefined;
    var context = undefined;
    if (collideCavansCache.has(key)) {
      canvas = collideCavansCache.get(key).canvas;
      context = collideCavansCache.get(key).context;
    } else {
      canvas = document.createElement("canvas");
      canvas.width = A.w;
      canvas.height = A.h;
      context = canvas.getContext("2d");
      collideCavansCache.set(key, {
        canvas: canvas,
        context: context
      });
    }
    context.clearRect(0, 0, canvas.width, canvas.height);

    // draw spriteA
    context.globalCompositeOperation = "source-over";
    context.drawImage(A.image, A.sx, A.sy, A.sw, A.sh, 0, 0, A.w, A.h);

    // draw spriteB
    // 在source-in模式下，图像如果相交则显示，不相交则透明，所以判断如果有非透明就是相交
    context.globalCompositeOperation = "source-in";
    context.drawImage(B.image, B.sx, B.sy, B.sw, B.sh, B.x - A.x, B.y - A.y, B.w, B.h);

    var pixel = context.getImageData(0, 0, A.w, A.h).data;

    var collision = false;

    for (var i = 3, len = pixel.length; i < len; i += 3) {
      if (pixel[i] != 0) {
        collision = true;
      }
    }

    return collision;
  }

  // 角色碰撞检测，先简单的矩形检测，如有碰撞可能则进行像素级检测
  Game.assign("actorCollision", function (actorSprite, blockSprite) {
    // 角色只检测frame 0，因为角色老变动，避免卡住，只检测第一个frame
    var actorRect = actorSprite.getFrame(0);
    // 阻挡的块则检测当前frame
    var blockRect = blockSprite.getFrame();
    var data = boxCollide(actorSprite, blockSprite, actorRect, blockRect);
    if (data) {
      // 计算一个delta，即只碰撞角色的下半部分
      // deltaY偏移0.85，大概意思是只检测角色最下方15%的地方
      var deltaY = Math.floor(actorRect.height * 0.85);
      data.A.y += deltaY;
      data.A.sy += deltaY;
      data.A.h -= deltaY;
      data.A.sh -= deltaY;

      return pixelCollide(data.A, data.B);
    }
    return false;
  });

  // 技能碰撞检测
  Game.assign("skillCollision", function (skillSprite, actorSprite) {
    var skillRect = skillSprite.getFrame();
    var actorRect = actorSprite.getFrame();

    var data = boxCollide(skillSprite, actorSprite, skillRect, actorRect);
    if (data) {
      // 和角色碰撞检测对比，技能碰撞检测无delta
      return pixelCollide(data.A, data.B);
    }
    return false;
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVDb2xsaXNpb24uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsV0FBUyxVQUFVLENBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFO0FBQ25ELFFBQUksQ0FBQyxHQUFHO0FBQ04sT0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLE9BQU87QUFDNUIsT0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLE9BQU87QUFDNUIsT0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLO0FBQ2QsT0FBQyxFQUFFLEtBQUssQ0FBQyxNQUFNO0FBQ2YsUUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ1gsUUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ1gsUUFBRSxFQUFFLEtBQUssQ0FBQyxLQUFLO0FBQ2YsUUFBRSxFQUFFLEtBQUssQ0FBQyxNQUFNO0FBQ2hCLFdBQUssRUFBRSxLQUFLLENBQUMsS0FBSztLQUNuQixDQUFDOztBQUVGLFFBQUksQ0FBQyxHQUFHO0FBQ04sT0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLE9BQU87QUFDNUIsT0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLE9BQU87QUFDNUIsT0FBQyxFQUFFLEtBQUssQ0FBQyxLQUFLO0FBQ2QsT0FBQyxFQUFFLEtBQUssQ0FBQyxNQUFNO0FBQ2YsUUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ1gsUUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ1gsUUFBRSxFQUFFLEtBQUssQ0FBQyxLQUFLO0FBQ2YsUUFBRSxFQUFFLEtBQUssQ0FBQyxNQUFNO0FBQ2hCLFdBQUssRUFBRSxLQUFLLENBQUMsS0FBSztLQUNuQixDQUFDOztBQUVGLFFBQUks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SSxFQUFFOzs7QUFHUixVQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDakQsVUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDO0FBQ25CLFVBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLE1BQU0sQ0FBQztBQUNwQixVQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUM7QUFDbkIsVUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksTUFBTSxDQUFDOztBQUVwQixhQUFPLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNyQztBQUNELFdBQU8sS0FBSyxDQUFDO0dBQ2QsQ0FBQyxDQUFDOzs7QUFHSCxNQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixFQUFFLFVBQVUsV0FBVyxFQUFFLFdBQVcsRUFBRTtBQUNoRSxRQUFJLFNBQVMsR0FBRyxXQUFXLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDdkMsUUFBSSxTQUFTLEdBQUcsV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFDOztBQUV2QyxRQUFJLElBQUksR0FBRyxVQUFVLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDdEUsUUFBSSxJQUFJLEVBQUU7O0FBRVIsYUFBTyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDckM7QUFDRCxXQUFPLEtBQUssQ0FBQztHQUNkLENBQUMsQ0FBQztDQUVKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVDb2xsaXNpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBmdW5jdGlvbiBib3hDb2xsaWRlIChzcHJpdGVBLCBzcHJpdGVCLCByZWN0QSwgcmVjdEIpIHtcbiAgICBsZXQgQSA9IHtcbiAgICAgIHg6IHNwcml0ZUEueCAtIHJlY3RBLmNlbnRlclgsXG4gICAgICB5OiBzcHJpdGVBLnkgLSByZWN0QS5jZW50ZXJZLFxuICAgICAgdzogcmVjdEEud2lkdGgsXG4gICAgICBoOiByZWN0QS5oZWlnaHQsXG4gICAgICBzeDogcmVjdEEueCxcbiAgICAgIHN5OiByZWN0QS55LFxuICAgICAgc3c6IHJlY3RBLndpZHRoLFxuICAgICAgc2g6IHJlY3RBLmhlaWdodCxcbiAgICAgIGltYWdlOiByZWN0QS5pbWFnZVxuICAgIH07XG5cbiAgICBsZXQgQiA9IHtcbiAgICAgIHg6IHNwcml0ZUIueCAtIHJlY3RCLmNlbnRlclgsXG4gICAgICB5OiBzcHJpdGVCLnkgLSByZWN0Qi5jZW50ZXJZLFxuICAgICAgdzogcmVjdEIud2lkdGgsXG4gICAgICBoOiByZWN0Qi5oZWlnaHQsXG4gICAgICBzeDogcmVjdEIueCxcbiAgICAgIHN5OiByZWN0Qi55LFxuICAgICAgc3c6IHJlY3RCLndpZHRoLFxuICAgICAgc2g6IHJlY3RCLmhlaWdodCxcbiAgICAgIGltYWdlOiByZWN0Qi5pbWFnZVxuICAgIH07XG5cbiAgICBsZXQgYmlnWCA9IE1hdGgubWF4KEEueCArIEEudywgQi54ICsgQi53KTtcbiAgICBsZXQgc21hbGxYID0gTWF0aC5taW4oQS54LCBCLngpO1xuICAgIGxldCBiaWdZID0gTWF0aC5tYXgoQS55ICsgQS5oLCBCLnkgKyBCLmgpO1xuICAgIGxldCBzbWFsbFkgPSBNYXRoLm1pbihBLnksIEIueSk7XG5cbiAgICBsZXQgd2lkdGggPSBiaWdYIC0gc21hbGxYO1xuICAgIGxldCBoZWlnaHQgPSBiaWdZIC0gc21hbGxZO1xuXG4gICAgaWYgKHdpZHRoIDwgKEEudyArIEIudykgJiYgaGVpZ2h0IDwgKEEuaCArIEIuaCkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIEE6IEEsXG4gICAgICAgIEI6IEJcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGxldCBjb2xsaWRlQ2F2YW5zQ2FjaGUgPSBuZXcgTWFwKCk7XG5cbiAgZnVuY3Rpb24gcGl4ZWxDb2xsaWRlIChBLCBCKSB7XG4gICAgLy8g5a+55Zu+5YOP6L+b6KGM5p+Q56eN5oSP5LmJ5LiK55qE56e75Yqo77yM5L6L5aaC5oqK5LiK6Z2i55qE5Zu+55qEQeWSjELpg73lubPnp7vliLDlt6bkuIrop5LvvIzkuZ/lsLHmmK9BQeeahOW3puS4iuinkuWPmOS4ujAsMOWdkOagh1xuXG4gICAgbGV0IG5vdyA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSk7XG5cbiAgICAvLyBXV1dISEhcbiAgICBsZXQga2V5ID0gQS53ICogMTAwMCArIEEuaDtcbiAgICBsZXQgY2FudmFzO1xuICAgIGxldCBjb250ZXh0O1xuICAgIGlmIChjb2xsaWRlQ2F2YW5zQ2FjaGUuaGFzKGtleSkpIHtcbiAgICAgIGNhbnZhcyA9IGNvbGxpZGVDYXZhbnNDYWNoZS5nZXQoa2V5KS5jYW52YXM7XG4gICAgICBjb250ZXh0ID0gY29sbGlkZUNhdmFuc0NhY2hlLmdldChrZXkpLmNvbnRleHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgICBjYW52YXMud2lkdGggPSBBLnc7XG4gICAgICBjYW52YXMuaGVpZ2h0ID0gQS5oO1xuICAgICAgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICBjb2xsaWRlQ2F2YW5zQ2FjaGUuc2V0KGtleSwge1xuICAgICAgICBjYW52YXM6IGNhbnZhcyxcbiAgICAgICAgY29udGV4dDogY29udGV4dFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cbiAgICAvLyBkcmF3IHNwcml0ZUFcbiAgICBjb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbj1cInNvdXJjZS1vdmVyXCJcbiAgICBjb250ZXh0LmRyYXdJbWFnZShBLmltYWdlLFxuICAgICAgQS5zeCwgQS5zeSwgQS5zdywgQS5zaCxcbiAgICAgIDAsIDAsIEEudywgQS5oKTtcblxuICAgIC8vIGRyYXcgc3ByaXRlQlxuICAgIC8vIOWcqHNvdXJjZS1pbuaooeW8j+S4i++8jOWbvuWDj+WmguaenOebuOS6pOWImeaYvuekuu+8jOS4jeebuOS6pOWImemAj+aYju+8jOaJgOS7peWIpOaWreWmguaenOaciemdnumAj+aYjuWwseaYr+ebuOS6pFxuICAgIGNvbnRleHQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uPVwic291cmNlLWluXCJcbiAgICBjb250ZXh0LmRyYXdJbWFnZShCLmltYWdlLFxuICAgICAgQi5zeCwgQi5zeSwgQi5zdywgQi5zaCxcbiAgICAgIEIueCAtIEEueCwgQi55IC0gQS55LCBCLncsIEIuaCk7XG5cbiAgICBsZXQgcGl4ZWwgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBBLncsIEEuaCkuZGF0YTtcblxuICAgIGxldCBjb2xsaXNpb24gPSBmYWxzZTtcblxuICAgIGZvciAobGV0IGkgPSAzLCBsZW4gPSBwaXhlbC5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMykge1xuICAgICAgaWYgKHBpeGVsW2ldICE9IDApIHtcbiAgICAgICAgY29sbGlzaW9uID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY29sbGlzaW9uO1xuICB9XG5cbiAgLy8g6KeS6Imy56Kw5pKe5qOA5rWL77yM5YWI566A5Y2V55qE55+p5b2i5qOA5rWL77yM5aaC5pyJ56Kw5pKe5Y+v6IO95YiZ6L+b6KGM5YOP57Sg57qn5qOA5rWLXG4gIEdhbWUuYXNzaWduKFwiYWN0b3JDb2xsaXNpb25cIiwgZnVuY3Rpb24gKGFjdG9yU3ByaXRlLCBibG9ja1Nwcml0ZSkge1xuICAgIC8vIOinkuiJsuWPquajgOa1i2ZyYW1lIDDvvIzlm6DkuLrop5LoibLogIHlj5jliqjvvIzpgb/lhY3ljaHkvY/vvIzlj6rmo4DmtYvnrKzkuIDkuKpmcmFtZVxuICAgIGxldCBhY3RvclJlY3QgPSBhY3RvclNwcml0ZS5nZXRGcmFtZSgwKTtcbiAgICAvLyDpmLvmjKHnmoTlnZfliJnmo4DmtYvlvZPliY1mcmFtZVxuICAgIGxldCBibG9ja1JlY3QgPSBibG9ja1Nwcml0ZS5nZXRGcmFtZSgpO1xuICAgIGxldCBkYXRhID0gYm94Q29sbGlkZShhY3RvclNwcml0ZSwgYmxvY2tTcHJpdGUsIGFjdG9yUmVjdCwgYmxvY2tSZWN0KTtcbiAgICBpZiAoZGF0YSkge1xuICAgICAgLy8g6K6h566X5LiA5LiqZGVsdGHvvIzljbPlj6rnorDmkp7op5LoibLnmoTkuIvljYrpg6jliIZcbiAgICAgIC8vIGRlbHRhWeWBj+enuzAuODXvvIzlpKfmpoLmhI/mgJ3mmK/lj6rmo4DmtYvop5LoibLmnIDkuIvmlrkxNSXnmoTlnLDmlrlcbiAgICAgIGxldCBkZWx0YVkgPSBNYXRoLmZsb29yKGFjdG9yUmVjdC5oZWlnaHQgKiAwLjg1KTtcbiAgICAgIGRhdGEuQS55ICs9IGRlbHRhWTtcbiAgICAgIGRhdGEuQS5zeSArPSBkZWx0YVk7XG4gICAgICBkYXRhLkEuaCAtPSBkZWx0YVk7XG4gICAgICBkYXRhLkEuc2ggLT0gZGVsdGFZO1xuXG4gICAgICByZXR1cm4gcGl4ZWxDb2xsaWRlKGRhdGEuQSwgZGF0YS5CKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9KTtcblxuICAvLyDmioDog73norDmkp7mo4DmtYtcbiAgR2FtZS5hc3NpZ24oXCJza2lsbENvbGxpc2lvblwiLCBmdW5jdGlvbiAoc2tpbGxTcHJpdGUsIGFjdG9yU3ByaXRlKSB7XG4gICAgbGV0IHNraWxsUmVjdCA9IHNraWxsU3ByaXRlLmdldEZyYW1lKCk7XG4gICAgbGV0IGFjdG9yUmVjdCA9IGFjdG9yU3ByaXRlLmdldEZyYW1lKCk7XG5cbiAgICBsZXQgZGF0YSA9IGJveENvbGxpZGUoc2tpbGxTcHJpdGUsIGFjdG9yU3ByaXRlLCBza2lsbFJlY3QsIGFjdG9yUmVjdCk7XG4gICAgaWYgKGRhdGEpIHtcbiAgICAgIC8vIOWSjOinkuiJsueisOaSnuajgOa1i+WvueavlO+8jOaKgOiDveeisOaSnuajgOa1i+aXoGRlbHRhXG4gICAgICByZXR1cm4gcGl4ZWxDb2xsaWRlKGRhdGEuQSwgZGF0YS5CKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9KTtcblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var popupCache = new Map();

  Game.assign("popup", function (obj, text) {
    var adjustX = arguments.length <= 2 || arguments[2] === undefined ? 0 : arguments[2];
    var adjustY = arguments.length <= 3 || arguments[3] === undefined ? 0 : arguments[3];

    if (popupCache.has(obj)) {
      var popup = popupCache.get(obj);
      Game.layers.dialogueLayer.removeChild(popup.container);
      clearInterval(popup.timer);
      popupCache["delete"](obj);
    }

    var dialogueText = new Sprite.Text({
      text: text,
      maxWidth: 200
    });

    var w = dialogueText.width;
    var h = dialogueText.height;
    var middle = Math.round((w + 10) / 2);

    var dialogueBox = new Sprite.Shape();

    dialogueBox.polygon({
      points: "0,0 " + (w + 10) + ",0 " + (w + 10) + "," + (h + 10) + " " + (middle + 5) + "," + (h + 10) + " " + middle + "," + (h + 15) + " " + (middle - 5) + "," + (h + 10) + " 0," + (h + 10) + " 0,0",
      fill: "white"
    });

    var dialogueContainer = new Sprite.Container();
    dialogueContainer.appendChild(dialogueBox, dialogueText);
    dialogueText.x = 5;
    dialogueText.y = 5;
    dialogueContainer.x = obj.x + adjustX;
    dialogueContainer.y = obj.y + adjustY;
    dialogueContainer.centerX = middle;
    dialogueContainer.centerY = h + 15;

    Game.layers.dialogueLayer.appendChild(dialogueContainer);

    if (obj instanceof Sprite.Event) {
      obj.on("change", function () {
        dialogueContainer.x = obj.x + adjustX;
        dialogueContainer.y = obj.y + adjustY;
      });
    }

    var timer = setTimeout(function () {
      if (popupCache.has(obj)) {
        var popup = popupCache.get(obj);
        Game.layers.dialogueLayer.removeChild(popup.container);
        popupCache["delete"](obj);
      }
    }, 3000);

    popupCache.set(obj, {
      container: dialogueContainer,
      timer: timer
    });
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVVSS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7QUFFYixNQUFJLFVBQVUsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDOztBQUUzQixNQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxVQUFVLEdBQUcsRUFBRSxJQUFJLEVBQTRCO1FBQTFCLE9BQU8seURBQUcsQ0FBQztRQUFFLE9BQU8seURBQUcsQ0FBQzs7QUFFaEUsUUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO0FBQ3ZCLFVBQUksS0FBSyxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDaEMsVUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUN2RCxtQkFBYSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUMzQixnQkFBVSxVQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDeEI7O0FBRUQsUUFBSSxZQUFZLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2pDLFVBQUksRUFBRSxJQUFJO0FBQ1YsY0FBUSxFQUFFLEdBQUc7S0FDZCxDQUFDLENBQUM7O0FBRUgsUUFBSSxDQUFDLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQztBQUMzQixRQUFJLENBQUMsR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDO0FBQzVCLFFBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFBLEdBQUksQ0FBQyxDQUFDLENBQUM7O0FBRXRDLFFBQUksV0FBVyxHQUFHLElBQUksTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDOztBQUVyQyxlQUFXLENBQUMsT0FBTyxDQUFDO0FBQ2xCLFlBQU0sWUFBUyxDQUFDLEdBQUMsRUFBRSxDQUFBLFlBQU0sQ0FBQyxHQUFDLEVBQUUsQ0FBQSxVQUFJLENBQUMsR0FBQyxFQUFFLENBQUEsVUFBSSxNQUFNLEdBQUMsQ0FBQyxDQUFBLFVBQUksQ0FBQyxHQUFDLEVBQUUsQ0FBQSxTQUFJLE1BQU0sVUFBSSxDQUFDLEdBQUMsRUFBRSxDQUFBLFVBQUksTUFBTSxHQUFDLENBQUMsQ0FBQSxVQUFJLENBQUMsR0FBQyxFQUFFLENBQUEsWUFBTSxDQUFDLEdBQUMsRUFBRSxDQUFBLFNBQU07QUFDL0csVUFBSSxFQUFFLE9BQU87S0FDZCxDQUFDLENBQUM7O0FBRUgsUUFBSSxpQkFBaUIsR0FBRyxJQUFJLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQztBQUMvQyxxQkFBaUIsQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBQ3pELGdCQUFZLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNuQixnQkFBWSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDbkIscUJBQWlCLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDO0FBQ3RDLHFCQUFpQixDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQztBQUN0QyxxQkFBaUIsQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO0FBQ25DLHFCQUFpQixDQUFDLE9BQU8sR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDOztBQUVuQyxRQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsQ0FBQzs7QUFFekQsUUFBSSxHQUFHLFlBQVksTUFBTSxDQUFDLEtBQUssRUFBRTtBQUMvQixTQUFHLENBQUMsRUFBRSxDQUFDLFFBQVEsRUFBRSxZQUFZO0FBQzNCLHlCQUFpQixDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQztBQUN0Qyx5QkFBaUIsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUM7T0FDdkMsQ0FBQyxDQUFDO0tBQ0o7O0FBRUQsUUFBSSxLQUFLLEdBQUcsVUFBVSxDQUFDLFlBQU07QUFDM0IsVUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO0FBQ3ZCLFlBQUksS0FBSyxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDaEMsWUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUN2RCxrQkFBVSxVQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7T0FDeEI7S0FDRixFQUFFLElBQUksQ0FBQyxDQUFDOztBQUVULGNBQVUsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFO0FBQ2xCLGVBQVMsRUFBRSxpQkFBaUI7QUFDNUIsV0FBSyxFQUFFLEtBQUs7S0FDYixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lVUkuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgcG9wdXBDYWNoZSA9IG5ldyBNYXAoKTtcblxuICBHYW1lLmFzc2lnbihcInBvcHVwXCIsIGZ1bmN0aW9uIChvYmosIHRleHQsIGFkanVzdFggPSAwLCBhZGp1c3RZID0gMCkge1xuXG4gICAgaWYgKHBvcHVwQ2FjaGUuaGFzKG9iaikpIHtcbiAgICAgIGxldCBwb3B1cCA9IHBvcHVwQ2FjaGUuZ2V0KG9iaik7XG4gICAgICBHYW1lLmxheWVycy5kaWFsb2d1ZUxheWVyLnJlbW92ZUNoaWxkKHBvcHVwLmNvbnRhaW5lcik7XG4gICAgICBjbGVhckludGVydmFsKHBvcHVwLnRpbWVyKTtcbiAgICAgIHBvcHVwQ2FjaGUuZGVsZXRlKG9iaik7XG4gICAgfVxuXG4gICAgbGV0IGRpYWxvZ3VlVGV4dCA9IG5ldyBTcHJpdGUuVGV4dCh7XG4gICAgICB0ZXh0OiB0ZXh0LFxuICAgICAgbWF4V2lkdGg6IDIwMCxcbiAgICB9KTtcblxuICAgIGxldCB3ID0gZGlhbG9ndWVUZXh0LndpZHRoO1xuICAgIGxldCBoID0gZGlhbG9ndWVUZXh0LmhlaWdodDtcbiAgICBsZXQgbWlkZGxlID0gTWF0aC5yb3VuZCgodyArIDEwKSAvIDIpO1xuXG4gICAgbGV0IGRpYWxvZ3VlQm94ID0gbmV3IFNwcml0ZS5TaGFwZSgpO1xuXG4gICAgZGlhbG9ndWVCb3gucG9seWdvbih7XG4gICAgICBwb2ludHM6IGAwLDAgJHt3KzEwfSwwICR7dysxMH0sJHtoKzEwfSAke21pZGRsZSs1fSwke2grMTB9ICR7bWlkZGxlfSwke2grMTV9ICR7bWlkZGxlLTV9LCR7aCsxMH0gMCwke2grMTB9IDAsMGAsXG4gICAgICBmaWxsOiBcIndoaXRlXCJcbiAgICB9KTtcblxuICAgIGxldCBkaWFsb2d1ZUNvbnRhaW5lciA9IG5ldyBTcHJpdGUuQ29udGFpbmVyKCk7XG4gICAgZGlhbG9ndWVDb250YWluZXIuYXBwZW5kQ2hpbGQoZGlhbG9ndWVCb3gsIGRpYWxvZ3VlVGV4dCk7XG4gICAgZGlhbG9ndWVUZXh0LnggPSA1O1xuICAgIGRpYWxvZ3VlVGV4dC55ID0gNTtcbiAgICBkaWFsb2d1ZUNvbnRhaW5lci54ID0gb2JqLnggKyBhZGp1c3RYO1xuICAgIGRpYWxvZ3VlQ29udGFpbmVyLnkgPSBvYmoueSArIGFkanVzdFk7XG4gICAgZGlhbG9ndWVDb250YWluZXIuY2VudGVyWCA9IG1pZGRsZTtcbiAgICBkaWFsb2d1ZUNvbnRhaW5lci5jZW50ZXJZID0gaCArIDE1O1xuXG4gICAgR2FtZS5sYXllcnMuZGlhbG9ndWVMYXllci5hcHBlbmRDaGlsZChkaWFsb2d1ZUNvbnRhaW5lcik7XG5cbiAgICBpZiAob2JqIGluc3RhbmNlb2YgU3ByaXRlLkV2ZW50KSB7XG4gICAgICBvYmoub24oXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBkaWFsb2d1ZUNvbnRhaW5lci54ID0gb2JqLnggKyBhZGp1c3RYO1xuICAgICAgICBkaWFsb2d1ZUNvbnRhaW5lci55ID0gb2JqLnkgKyBhZGp1c3RZO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgbGV0IHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAocG9wdXBDYWNoZS5oYXMob2JqKSkge1xuICAgICAgICBsZXQgcG9wdXAgPSBwb3B1cENhY2hlLmdldChvYmopO1xuICAgICAgICBHYW1lLmxheWVycy5kaWFsb2d1ZUxheWVyLnJlbW92ZUNoaWxkKHBvcHVwLmNvbnRhaW5lcik7XG4gICAgICAgIHBvcHVwQ2FjaGUuZGVsZXRlKG9iaik7XG4gICAgICB9XG4gICAgfSwgMzAwMCk7XG5cbiAgICBwb3B1cENhY2hlLnNldChvYmosIHtcbiAgICAgIGNvbnRhaW5lcjogZGlhbG9ndWVDb250YWluZXIsXG4gICAgICB0aW1lcjogdGltZXJcbiAgICB9KTtcbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  // 游戏无论什么时候都需要预加载的内容
  function Preload() {
    return new Promise(function (resolve, reject) {
      var promises = new Set();

      var preloadSoundEffects = {
        hurt: "sound/effect/hurt.ogg" // 伤害效果音
      };

      for (var key in preloadSoundEffects) {
        promises.add((function (key, url) {
          return new Promise(function (resolve, reject) {
            if (Game.sounds && Game.sounds[key]) {
              resolve();
            } else {
              Sprite.load(url).then(function (data) {
                Game.sounds[key] = data[0];
                resolve();
              });
            }
          });
        })(key, preloadSoundEffects[key]));
      }

      var preloadItems = ["bag", // 掉落物品用的小包
      "gold" // 金币图标
      ];

      preloadItems.forEach(function (id) {
        promises.add(new Promise(function (resolve, reject) {
          if (Game.items && Game.items[id]) {
            resolve();
          } else {
            Game.Item.load(id).then(function (itemObj) {
              resolve();
            });
          }
        }));
      });

      Promise.all(promises).then(function () {
        resolve();
      });
    });
  }

  // 加载区域，把括地图，角色，物品
  Game.assign("loadArea", function (id) {
    return new Promise(function (resolve, reject) {

      Game.Map.load(id).then(function (mapObj) {

        var area = {
          actors: new Set(), // 角色
          bags: new Set(), // 掉落小包
          items: new Set(), // 其他物品（有碰撞）
          touch: [], // touch或onto会触发的地点/物品
          onto: [], // onto会触发的地点/物品
          map: mapObj
        };

        var promises = new Set();

        promises.add(Preload());

        if (mapObj.data.actors) {
          mapObj.data.actors.forEach(function (element) {
            promises.add(new Promise(function (resolve, reject) {
              Game.Actor.load(element.id).then(function (actorObj) {

                for (var key in element) {
                  actorObj.data[key] = element[key];
                }

                area.actors.add(actorObj);
                actorObj.draw();
                resolve();
              });
            }));
          });
        }

        if (mapObj.spawnMonster && mapObj.spawnMonster.list && mapObj.spawnMonster.count) {
          var _loop = function (monsterId) {
            promises.add(new Promise(function (resolve, reject) {
              Game.Actor.load(monsterId).then(function () {
                resolve();
              });
            }));
          };

          for (var monsterId in mapObj.spawnMonster.list) {
            _loop(monsterId);
          }
        }

        if (mapObj.spawnItem && mapObj.spawnItem.list && mapObj.spawnItem.count) {
          var _loop2 = function (itemId) {
            promises.add(new Promise(function (resolve, reject) {
              Game.Item.load(itemId).then(function () {
                resolve();
              });
            }));
          };

          for (var itemId in mapObj.spawnItem.list) {
            _loop2(itemId);
          }
        }

        if (mapObj.data.onto) {
          mapObj.data.onto.forEach(function (element) {
            area.onto.push(element);
          });
        }

        if (mapObj.data.touch) {
          mapObj.data.touch.forEach(function (element) {
            area.touch.push(element);
          });
        }

        Promise.all(promises).then(function () {
          resolve(area);
        });
      }); //map
    });
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVBcmVhLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFxQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOzs7QUFHYixXQUFTLE9BQU8sR0FBSTtBQUNsQixXQUFPLElBQUksT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFLE1BQU0sRUFBRTtBQUM1QyxVQUFJLFFBQVEsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDOztBQUV6QixVQUFJLG1CQUFtQixHQUFHO0FBQ3hCLFlBQUksRUFBRSx1QkFBdUI7T0FDOUIsQ0FBQzs7QUFFRixXQUFLLElBQUksR0FBRyxJQUFJLG1CQUFtQixFQUFFO0FBQ25DLGdCQUFRLENBQUMsR0FBRyxDQUNWLENBQUMsVUFBVSxHQUFHLEVBQUUsR0FBRyxFQUFFO0FBQ25CLGlCQUFPLElBQUksT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFLE1BQU0sRUFBRTtBQUM1QyxnQkFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUU7QUFDbkMscUJBQU8sRUFBRSxDQUFDO2FBQ1gsTUFBTTtBQUNMLG9CQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLElBQUksRUFBRTtBQUNwQyxvQkFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDM0IsdUJBQU8sRUFBRSxDQUFDO2VBQ1gsQ0FBQyxDQUFDO2FBQ0o7V0FDRixDQUFDLENBQUM7U0FDSixDQUFBLENBQUUsR0FBRyxFQUFFLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQ2xDLENBQUM7T0FDSDs7QUFFRCxVQUFJLFlBQVksR0FBRyxDQUNqQixLQUFLO0FBQ0wsWUFBTTtPQUNQLENBQUM7O0FBRUYsa0JBQVksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLEVBQUU7QUFDakMsZ0JBQVEsQ0FBQyxHQUFHLENBQ1YsSUFBSSxPQUFPLENBQUMsVUFBVSxPQUFPLEVBQUUsTUFBTSxFQUFFO0FBQ3JDLGNBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFFO0FBQ2hDLG1CQUFPLEVBQUUsQ0FBQztXQUNYLE1BQU07QUFDTCxnQkFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsT0FBTyxFQUFFO0FBQ3pDLHFCQUFPLEVBQUUsQ0FBQzthQUNYLENBQUMsQ0FBQztXQUNKO1NBQ0YsQ0FBQyxDQUNILENBQUM7T0FDSCxDQUFDLENBQUM7O0FBRUgsYUFBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWTtBQUNyQyxlQUFPLEVBQUUsQ0FBQztPQUNYLENBQUMsQ0FBQztLQUNKLENBQUMsQ0FBQztHQUNKOzs7QUFHRCxNQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxVQUFVLEVBQUUsRUFBRTtBQUNwQyxXQUFPLElBQUksT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFLE1BQU0sRUFBRTs7QUFFNUMsVUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsTUFBTSxFQUFFOztBQUV2QyxZQUFJLElBQUksR0FBRztBQUNULGdCQUFNLEVBQUUsSUFBSSxHQUFHLEVBQUU7QUFDakIsY0FBSSxFQUFFLElBQUksR0FBRyxFQUFFO0FBQ2YsZUFBSyxFQUFFLElBQUksR0FBRyxFQUFFO0FBQ2hCLGVBQUssRUFBRSxFQUFFO0FBQ1QsY0FBSSxFQUFFLEVBQUU7QUFDUixhQUFHLEVBQUUsTUFBTTtTQUNaLENBQUM7O0FBRUYsWUFBSSxRQUFRLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQzs7QUFFekIsZ0JBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQzs7QUFFeEIsWUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtBQUN0QixnQkFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFO0FBQzVDLG9CQUFRLENBQUMsR0FBRyxDQUNWLElBQUksT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFLE1BQU0sRUFBRTtBQUNyQyxrQkFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLFFBQVEsRUFBRTs7QUFFbkQscUJBQUssSUFBSSxHQUFHLElBQUksT0FBTyxFQUFFO0FBQ3ZCLDBCQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztpQkFDbkM7O0FBRUQsb0JBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzFCLHdCQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDaEIsdUJBQU8sRUFBRSxDQUFDO2VBQ1gsQ0FBQyxDQUFDO2FBQ0osQ0FBQyxDQUNILENBQUM7V0FDSCxDQUFDLENBQUM7U0FDSjs7QUFFRCxZQUNFLE1BQU0sQ0FBQyxZQUFZLElBQ25CLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxJQUN4QixNQUFNLENBQUMsWUFBWSxDQUFDLEtBQUssRUFDekI7Z0NBQ1MsU0FBUztBQUNoQixvQkFBUSxDQUFDLEdBQUcsQ0FDVixJQUFJLE9BQU8sQ0FBQyxVQUFVLE9BQU8sRUFBRSxNQUFNLEVBQUU7QUFDckMsa0JBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZO0FBQzFDLHVCQUFPLEVBQUUsQ0FBQztlQUNYLENBQUMsQ0FBQzthQUNKLENBQUMsQ0FDSCxDQUFDOzs7QUFQSixlQUFLLElBQUksU0FBUyxJQUFJLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFO2tCQUF2QyxTQUFTO1dBUWpCO1NBQ0Y7O0FBRUQsWUFDRSxNQUFNLENBQUMsU0FBUyxJQUNoQixNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksSUFDckIsTUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQ3RCO2lDQUNTLE1BQU07QUFDYixvQkFBUSxDQUFDLEdBQUcsQ0FDVixJQUFJLE9BQU8sQ0FBQyxVQUFVLE9BQU8sRUFBRSxNQUFNLEVBQUU7QUFDckMsa0JBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZO0FBQ3RDLHVCQUFPLEVBQUUsQ0FBQztlQUNYLENBQUMsQ0FBQzthQUNKLENBQUMsQ0FDSCxDQUFDOzs7QUFQSixlQUFLLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFO21CQUFqQyxNQUFNO1dBUWQ7U0FDRjs7QUFFRCxZQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFO0FBQ3BCLGdCQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxPQUFPLEVBQUU7QUFDMUMsZ0JBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1dBQ3pCLENBQUMsQ0FBQztTQUNKOztBQUVELFlBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7QUFDckIsZ0JBQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLE9BQU8sRUFBRTtBQUMzQyxnQkFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7V0FDMUIsQ0FBQyxDQUFDO1NBQ0o7O0FBRUQsZUFBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWTtBQUNyQyxpQkFBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2YsQ0FBQyxDQUFDO09BRUosQ0FBQyxDQUFDO0tBRUosQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBRUosQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiR2FtZUFyZWEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIC8vIOa4uOaIj+aXoOiuuuS7gOS5iOaXtuWAmemDvemcgOimgemihOWKoOi9veeahOWGheWuuVxuICBmdW5jdGlvbiBQcmVsb2FkICgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgbGV0IHByb21pc2VzID0gbmV3IFNldCgpO1xuXG4gICAgICBsZXQgcHJlbG9hZFNvdW5kRWZmZWN0cyA9IHtcbiAgICAgICAgaHVydDogXCJzb3VuZC9lZmZlY3QvaHVydC5vZ2dcIiAvLyDkvKTlrrPmlYjmnpzpn7NcbiAgICAgIH07XG5cbiAgICAgIGZvciAobGV0IGtleSBpbiBwcmVsb2FkU291bmRFZmZlY3RzKSB7XG4gICAgICAgIHByb21pc2VzLmFkZChcbiAgICAgICAgICAoZnVuY3Rpb24gKGtleSwgdXJsKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICBpZiAoR2FtZS5zb3VuZHMgJiYgR2FtZS5zb3VuZHNba2V5XSkge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBTcHJpdGUubG9hZCh1cmwpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgIEdhbWUuc291bmRzW2tleV0gPSBkYXRhWzBdO1xuICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KShrZXksIHByZWxvYWRTb3VuZEVmZmVjdHNba2V5XSlcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgbGV0IHByZWxvYWRJdGVtcyA9IFtcbiAgICAgICAgXCJiYWdcIiwgLy8g5o6J6JC954mp5ZOB55So55qE5bCP5YyFXG4gICAgICAgIFwiZ29sZFwiIC8vIOmHkeW4geWbvuagh1xuICAgICAgXTtcblxuICAgICAgcHJlbG9hZEl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHByb21pc2VzLmFkZChcbiAgICAgICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICBpZiAoR2FtZS5pdGVtcyAmJiBHYW1lLml0ZW1zW2lkXSkge1xuICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBHYW1lLkl0ZW0ubG9hZChpZCkudGhlbihmdW5jdGlvbiAoaXRlbU9iaikge1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8g5Yqg6L295Yy65Z+f77yM5oqK5ous5Zyw5Zu+77yM6KeS6Imy77yM54mp5ZOBXG4gIEdhbWUuYXNzaWduKFwibG9hZEFyZWFcIiwgZnVuY3Rpb24gKGlkKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcblxuICAgICAgR2FtZS5NYXAubG9hZChpZCkudGhlbihmdW5jdGlvbiAobWFwT2JqKSB7XG5cbiAgICAgICAgbGV0IGFyZWEgPSB7XG4gICAgICAgICAgYWN0b3JzOiBuZXcgU2V0KCksIC8vIOinkuiJslxuICAgICAgICAgIGJhZ3M6IG5ldyBTZXQoKSwgLy8g5o6J6JC95bCP5YyFXG4gICAgICAgICAgaXRlbXM6IG5ldyBTZXQoKSwgLy8g5YW25LuW54mp5ZOB77yI5pyJ56Kw5pKe77yJXG4gICAgICAgICAgdG91Y2g6IFtdLCAvLyB0b3VjaOaIlm9udG/kvJrop6blj5HnmoTlnLDngrkv54mp5ZOBXG4gICAgICAgICAgb250bzogW10sIC8vIG9udG/kvJrop6blj5HnmoTlnLDngrkv54mp5ZOBXG4gICAgICAgICAgbWFwOiBtYXBPYmpcbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgcHJvbWlzZXMgPSBuZXcgU2V0KCk7XG5cbiAgICAgICAgcHJvbWlzZXMuYWRkKFByZWxvYWQoKSk7XG5cbiAgICAgICAgaWYgKG1hcE9iai5kYXRhLmFjdG9ycykge1xuICAgICAgICAgIG1hcE9iai5kYXRhLmFjdG9ycy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICBwcm9taXNlcy5hZGQoXG4gICAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICBHYW1lLkFjdG9yLmxvYWQoZWxlbWVudC5pZCkudGhlbihmdW5jdGlvbiAoYWN0b3JPYmopIHtcblxuICAgICAgICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0b3JPYmouZGF0YVtrZXldID0gZWxlbWVudFtrZXldO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBhcmVhLmFjdG9ycy5hZGQoYWN0b3JPYmopO1xuICAgICAgICAgICAgICAgICAgYWN0b3JPYmouZHJhdygpO1xuICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBtYXBPYmouc3Bhd25Nb25zdGVyICYmXG4gICAgICAgICAgbWFwT2JqLnNwYXduTW9uc3Rlci5saXN0ICYmXG4gICAgICAgICAgbWFwT2JqLnNwYXduTW9uc3Rlci5jb3VudFxuICAgICAgICApIHtcbiAgICAgICAgICBmb3IgKGxldCBtb25zdGVySWQgaW4gbWFwT2JqLnNwYXduTW9uc3Rlci5saXN0KSB7XG4gICAgICAgICAgICBwcm9taXNlcy5hZGQoXG4gICAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICBHYW1lLkFjdG9yLmxvYWQobW9uc3RlcklkKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIG1hcE9iai5zcGF3bkl0ZW0gJiZcbiAgICAgICAgICBtYXBPYmouc3Bhd25JdGVtLmxpc3QgJiZcbiAgICAgICAgICBtYXBPYmouc3Bhd25JdGVtLmNvdW50XG4gICAgICAgICkge1xuICAgICAgICAgIGZvciAobGV0IGl0ZW1JZCBpbiBtYXBPYmouc3Bhd25JdGVtLmxpc3QpIHtcbiAgICAgICAgICAgIHByb21pc2VzLmFkZChcbiAgICAgICAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgIEdhbWUuSXRlbS5sb2FkKGl0ZW1JZCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtYXBPYmouZGF0YS5vbnRvKSB7XG4gICAgICAgICAgbWFwT2JqLmRhdGEub250by5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICBhcmVhLm9udG8ucHVzaChlbGVtZW50KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtYXBPYmouZGF0YS50b3VjaCkge1xuICAgICAgICAgIG1hcE9iai5kYXRhLnRvdWNoLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGFyZWEudG91Y2gucHVzaChlbGVtZW50KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXNvbHZlKGFyZWEpO1xuICAgICAgICB9KTtcblxuICAgICAgfSk7IC8vbWFwXG5cbiAgICB9KTtcbiAgfSk7XG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; })();

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  Game.assign("Map", (function (_Sprite$Event) {
    _inherits(GameMap, _Sprite$Event);

    _createClass(GameMap, [{
      key: "hitTest",
      value: function hitTest(x, y) {
        if (internal(this).blockedMap[x * 10000 + y]) {
          return true;
        }
        return false;
      }
    }, {
      key: "hitWater",
      value: function hitWater(x, y) {
        if (internal(this).waterMap[x * 10000 + y]) {
          return true;
        }
        return false;
      }
    }, {
      key: "blockedMap",
      get: function get() {
        return internal(this).blockedMap;
      },
      set: function set(value) {
        throw new Error("Game.Map.blockedMap readonly");
      }
    }], [{
      key: "load",
      value: function load(id) {
        return new Promise(function (resolve, reject) {
          Sprite.load("map/" + id + ".json", "map/" + id + ".js").then(function (data) {
            var _data = _slicedToArray(data, 2);

            var mapData = _data[0];
            var mapInfo = _data[1];

            mapInfo = mapInfo(); // map/id.js文件会返回一个函数
            mapData.id = id;

            for (var key in mapInfo) {
              if (mapData.hasOwnProperty(key)) {
                console.log(key, mapData[key], mapInfo[key], mapInfo, mapData);
                throw new Error("Game.loadArea invalid data");
              }
              mapData[key] = mapInfo[key];
            }

            var mapObj = new Game.Map(mapData);
            mapObj.on("complete", function () {
              resolve(mapObj);
            });
          });
        });
      }
    }]);

    function GameMap(mapData) {
      var _this = this;

      _classCallCheck(this, GameMap);

      _get(Object.getPrototypeOf(GameMap.prototype), "constructor", this).call(this);
      var privates = internal(this);
      privates.data = mapData;

      var images = [];
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = privates.data.tilesets[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var element = _step.value;

          images.push("map/" + element.image);
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator["return"]) {
            _iterator["return"]();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      ;

      Sprite.load(images).then(function (data) {

        // 释放空间
        privates.data.tilesets = null;

        privates.sheet = new Sprite.Sheet({
          images: data,
          width: privates.data.tilewidth,
          height: privates.data.tileheight
        });

        // 水地图，用来进行hitWater测试
        privates.waterMap = {};
        // 计算阻挡地图，如果为object则有阻挡，undefined则无阻挡
        privates.blockedMap = {};

        // 保存这个地图的所有地图块
        // 这个空间在draw后会释放
        privates.layers = [];

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = privates.data.layers[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var layerData = _step2.value;

            var layerObj = null;
            if (layerData.name != "block" && layerData.name != "water") {
              layerObj = new Sprite.Container();
              layerObj.name = layerData.name;
              privates.layers.push(layerObj);
            }

            var width = _this.col;
            var height = _this.row;
            for (var y = 0; y < height; y++) {
              for (var x = 0; x < width; x++) {
                var position = x + y * width;
                var key = x * 10000 + y;
                var picture = layerData.data[position] - 1;

                if (picture >= 0) {
                  if (layerData.name == "block") {
                    privates.blockedMap[key] = true;
                  } else if (layerData.name == "water") {
                    privates.waterMap[key] = true;
                  } else {
                    var frame = privates.sheet.getFrame(picture);
                    frame.x = x * privates.data.tilewidth;
                    frame.y = y * privates.data.tileheight;

                    layerObj.appendChild(frame);
                  }
                }
              }
            }
          }

          // 发送完成事件，第二个参数代表此事件是一次性事件，即不会再次complete
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
              _iterator2["return"]();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        _this.emit("complete", true);
      });
    }

    _createClass(GameMap, [{
      key: "tile",

      // 返回某个坐标点所在的地格
      value: function tile(x, y) {
        if (Number.isFinite(x) && Number.isFinite(y)) {
          return {
            x: Math.floor(x / this.data.tilewidth),
            y: Math.floor(y / this.data.tileheight)
          };
        } else {
          console.error(x, y, this.data);
          throw new Error("Game.Map.tile got invalid arguments");
        }
      }

      // 绘制图片，会改变Game.currentArea
    }, {
      key: "draw",
      value: function draw() {
        var _this2 = this;

        var privates = internal(this);
        Game.layers.mapLayer.clear();
        Game.layers.mapHideLayer.clear();

        privates.layers.forEach(function (element, index) {
          var layerData = privates.data.layers[index];

          if (Number.isFinite(layerData.opacity)) {
            element.alpha = layerData.opacity;
          }

          Game.layers.mapLayer.appendChild(element);
        });

        // 释放冗余空间
        privates.layers = null;
        privates.data.layers = null;

        // 给其他地图缓冲层
        Game.layers.mapLayer.cache();
        var map = new Sprite.Bitmap(Game.layers.mapLayer.cacheCanvas);
        Game.layers.mapLayer.clear();
        Game.layers.mapLayer.appendChild(map);

        var minimap = document.createElement("canvas");
        minimap.width = this.col * 8; // 原地图的四倍
        minimap.height = this.row * 8;
        var minimapContext = minimap.getContext("2d");
        minimapContext.drawImage(map.image, 0, 0, map.width, map.height, 0, 0, minimap.width, minimap.height);

        privates.minimap = minimap;

        if (privates.data.bgm) {
          // set loop = -1, 无限循环
          //let bgm = createjs.Sound.play(this.data.bgm, undefined, undefined, undefined, -1);
          //bgm.setVolume(0.2);
        }

        var block = {};

        // 预设人物占位
        if (privates.data.actors) {
          var _iteratorNormalCompletion3 = true;
          var _didIteratorError3 = false;
          var _iteratorError3 = undefined;

          try {
            for (var _iterator3 = privates.data.actors[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
              var actor = _step3.value;

              block[actor.x * 10000 + actor.y] = true;
            }
          } catch (err) {
            _didIteratorError3 = true;
            _iteratorError3 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion3 && _iterator3["return"]) {
                _iterator3["return"]();
              }
            } finally {
              if (_didIteratorError3) {
                throw _iteratorError3;
              }
            }
          }
        }

        // 生成怪物
        if (privates.data.spawnMonster && privates.data.spawnMonster.list && privates.data.spawnMonster.count) {
          for (var i = 0, len = privates.data.spawnMonster.count; i < len; i++) {
            var monsterId = null;
            var prob = 0;
            var r = Math.random();
            for (var key in privates.data.spawnMonster.list) {
              prob += privates.data.spawnMonster.list[key];
              if (r < prob) {
                monsterId = key;
                break;
              }
            }
            if (!monsterId) {
              monsterId = Object.keys(privates.data.spawnMonster.list)[0];
            }
            Game.Actor.load(monsterId).then(function (actorObj) {
              var x = undefined,
                  y = undefined;
              while (true) {
                x = Sprite.rand(0, _this2.col);
                y = Sprite.rand(0, _this2.row);
                if (!_this2.hitTest(x, y) && !block[x * 10000 + y]) {
                  break;
                }
              }
              block[x * 10000 + y] = true;
              actorObj.x = x;
              actorObj.y = y;
              Game.area.actors.add(actorObj);
              actorObj.draw();
            });
          }
        }

        if (privates.data.spawnItem && privates.data.spawnItem.list && privates.data.spawnItem.count) {
          var _loop = function (i, len) {
            var itemId = null;
            var prob = 0;
            var r = Math.random();
            for (var key in privates.data.spawnItem.list) {
              prob += privates.data.spawnItem.list[key];
              if (r < prob) {
                itemId = key;
                break;
              }
            }
            if (!itemId) {
              itemId = Object.keys(privates.data.spawnItem.list)[0];
            }
            Game.Item.load(itemId).then(function (itemObj) {
              var x = undefined,
                  y = undefined;
              while (true) {
                x = Sprite.rand(0, _this2.col);
                y = Sprite.rand(0, _this2.row);
                if (!_this2.hitTest(x, y) && !block[x * 10000 + y]) {
                  break;
                }
              }
              block[x * 10000 + y] = true;
              itemObj.x = x;
              itemObj.y = y;
              itemObj.inner = {};
              itemObj.inner[itemId] = 1;
              Game.area.items.add(itemObj);
              itemObj.draw();
            });
          };

          for (var i = 0, len = privates.data.spawnItem.count; i < len; i++) {
            _loop(i, len);
          }
        }
      }
    }, {
      key: "data",
      get: function get() {
        return internal(this).data;
      },
      set: function set(value) {
        throw new Error("Game.Map.data readonly");
      }
    }, {
      key: "id",
      get: function get() {
        return internal(this).id;
      },
      set: function set(value) {
        throw new Error("Game.Map.id readonly");
      }
    }, {
      key: "width",
      get: function get() {
        return this.data.width * this.data.tilewidth;
      },
      set: function set(value) {
        throw new Error("Game.Map.width readonly");
      }
    }, {
      key: "height",
      get: function get() {
        return this.data.height * this.data.tileheight;
      },
      set: function set(value) {
        throw new Error("Game.Map.height readonly");
      }
    }, {
      key: "col",
      get: function get() {
        // width / tilewidth
        return this.data.width;
      },
      set: function set(value) {
        throw new Error("Game.Map.col readonly");
      }
    }, {
      key: "row",
      get: function get() {
        // height / tileheight
        return this.data.height;
      },
      set: function set(value) {
        throw new Error("Game.Map.row readonly");
      }
    }, {
      key: "minimap",
      get: function get() {
        return internal(this).minimap;
      },
      set: function set(value) {
        throw new Error("Game.Map.minimap readonly");
      }
    }]);

    return GameMap;
  })(Sprite.Event));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVNYXAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7QUFFbEMsTUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLO2NBQVEsT0FBTzs7aUJBQVAsT0FBTzs7YUF5QnRCLGlCQUFDLENBQUMsRUFBRSxDQUFDLEVBQUU7QUFDYixZQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFDLEtBQUssR0FBQyxDQUFDLENBQUMsRUFBRTtBQUN4QyxpQkFBTyxJQUFJLENBQUM7U0FDYjtBQUNELGVBQU8sS0FBSyxDQUFDO09BQ2Q7OzthQUVRLGtCQUFDLENBQUMsRUFBRSxDQUFDLEVBQUU7QUFDZCxZQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxHQUFDLEtBQUssR0FBQyxDQUFDLENBQUMsRUFBRTtBQUN0QyxpQkFBTyxJQUFJLENBQUM7U0FDYjtBQUNELGVBQU8sS0FBSyxDQUFDO09BQ2Q7OztXQUVjLGVBQUc7QUFDaEIsZUFBTyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsVUFBVSxDQUFDO09BQ2xDO1dBRWMsYUFBQyxLQUFLLEVBQUU7QUFDckIsY0FBTSxJQUFJLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO09BQ2pEOzs7YUEzQ1csY0FBQyxFQUFFLEVBQUU7QUFDZixlQUFPLElBQUksT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFLE1BQU0sRUFBRTtBQUM1QyxnQkFBTSxDQUFDLElBQUksVUFBUSxFQUFFLHFCQUFnQixFQUFFLFNBQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxJQUFJLEVBQUU7dUNBQ3hDLElBQUk7O2dCQUF4QixPQUFPO2dCQUFFLE9BQU87O0FBQ3JC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QUFDZCxjQUFNLElBQUksS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUM7T0FDMUM7OztXQUVPLGVBQUc7O0FBQ1QsZUFBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQTtPQUN4QjtXQUVPLGFBQUMsS0FBSyxFQUFFO0FBQ2QsY0FBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO09BQzFDOzs7V0FFVyxlQUFHO0FBQ2IsZUFBTyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDO09BQy9CO1dBRVcsYUFBQyxLQUFLLEVBQUU7QUFDbEIsY0FBTSxJQUFJLEtBQUssQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO09BQzlDOzs7V0EzS3NCLE9BQU87S0FBUyxNQUFNLENBQUMsS0FBSyxFQTZUbkQsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVNYXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgaW50ZXJuYWwgPSBTcHJpdGUuTmFtZXNwYWNlKCk7XG5cbiAgR2FtZS5hc3NpZ24oXCJNYXBcIiwgY2xhc3MgR2FtZU1hcCBleHRlbmRzIFNwcml0ZS5FdmVudCB7XG5cbiAgICBzdGF0aWMgbG9hZCAoaWQpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIFNwcml0ZS5sb2FkKGBtYXAvJHtpZH0uanNvbmAsIGBtYXAvJHtpZH0uanNgKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgbGV0IFttYXBEYXRhLCBtYXBJbmZvXSA9IGRhdGE7XG4gICAgICAgICAgbWFwSW5mbyA9IG1hcEluZm8oKTsgLy8gbWFwL2lkLmpz5paH5Lu25Lya6L+U5Zue5LiA5Liq5Ye95pWwXG4gICAgICAgICAgbWFwRGF0YS5pZCA9IGlkO1xuXG4gICAgICAgICAgZm9yIChsZXQga2V5IGluIG1hcEluZm8pIHtcbiAgICAgICAgICAgIGlmIChtYXBEYXRhLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coa2V5LCBtYXBEYXRhW2tleV0sIG1hcEluZm9ba2V5XSwgbWFwSW5mbywgbWFwRGF0YSk7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUubG9hZEFyZWEgaW52YWxpZCBkYXRhXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbWFwRGF0YVtrZXldID0gbWFwSW5mb1trZXldO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGxldCBtYXBPYmogPSBuZXcgR2FtZS5NYXAobWFwRGF0YSk7XG4gICAgICAgICAgbWFwT2JqLm9uKFwiY29tcGxldGVcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmVzb2x2ZShtYXBPYmopO1xuICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaGl0VGVzdCAoeCwgeSkge1xuICAgICAgaWYgKGludGVybmFsKHRoaXMpLmJsb2NrZWRNYXBbeCoxMDAwMCt5XSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBoaXRXYXRlciAoeCwgeSkge1xuICAgICAgaWYgKGludGVybmFsKHRoaXMpLndhdGVyTWFwW3gqMTAwMDAreV0pIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgZ2V0IGJsb2NrZWRNYXAgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmJsb2NrZWRNYXA7XG4gICAgfVxuXG4gICAgc2V0IGJsb2NrZWRNYXAgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLk1hcC5ibG9ja2VkTWFwIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yIChtYXBEYXRhKSB7XG4gICAgICBzdXBlcigpO1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBwcml2YXRlcy5kYXRhID0gbWFwRGF0YTtcblxuICAgICAgbGV0IGltYWdlcyA9IFtdO1xuICAgICAgZm9yIChsZXQgZWxlbWVudCBvZiBwcml2YXRlcy5kYXRhLnRpbGVzZXRzKSB7XG4gICAgICAgIGltYWdlcy5wdXNoKGBtYXAvJHtlbGVtZW50LmltYWdlfWApO1xuICAgICAgfTtcblxuICAgICAgU3ByaXRlLmxvYWQoaW1hZ2VzKS50aGVuKChkYXRhKSA9PiB7XG5cbiAgICAgICAgLy8g6YeK5pS+56m66Ze0XG4gICAgICAgIHByaXZhdGVzLmRhdGEudGlsZXNldHMgPSBudWxsO1xuXG4gICAgICAgIHByaXZhdGVzLnNoZWV0ID0gbmV3IFNwcml0ZS5TaGVldCh7XG4gICAgICAgICAgaW1hZ2VzOiBkYXRhLFxuICAgICAgICAgIHdpZHRoOiBwcml2YXRlcy5kYXRhLnRpbGV3aWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IHByaXZhdGVzLmRhdGEudGlsZWhlaWdodCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8g5rC05Zyw5Zu+77yM55So5p2l6L+b6KGMaGl0V2F0ZXLmtYvor5VcbiAgICAgICAgcHJpdmF0ZXMud2F0ZXJNYXAgPSB7fTtcbiAgICAgICAgLy8g6K6h566X6Zi75oyh5Zyw5Zu+77yM5aaC5p6c5Li6b2JqZWN05YiZ5pyJ6Zi75oyh77yMdW5kZWZpbmVk5YiZ5peg6Zi75oyhXG4gICAgICAgIHByaXZhdGVzLmJsb2NrZWRNYXAgPSB7fTtcblxuICAgICAgICAvLyDkv53lrZjov5nkuKrlnLDlm77nmoTmiYDmnInlnLDlm77lnZdcbiAgICAgICAgLy8g6L+Z5Liq56m66Ze05ZyoZHJhd+WQjuS8mumHiuaUvlxuICAgICAgICBwcml2YXRlcy5sYXllcnMgPSBbXTtcblxuICAgICAgICBmb3IgKGxldCBsYXllckRhdGEgb2YgcHJpdmF0ZXMuZGF0YS5sYXllcnMpIHtcbiAgICAgICAgICBsZXQgbGF5ZXJPYmogPSBudWxsO1xuICAgICAgICAgIGlmIChsYXllckRhdGEubmFtZSAhPSBcImJsb2NrXCIgJiYgbGF5ZXJEYXRhLm5hbWUgIT0gXCJ3YXRlclwiKSB7XG4gICAgICAgICAgICBsYXllck9iaiA9IG5ldyBTcHJpdGUuQ29udGFpbmVyKCk7XG4gICAgICAgICAgICBsYXllck9iai5uYW1lID0gbGF5ZXJEYXRhLm5hbWU7XG4gICAgICAgICAgICBwcml2YXRlcy5sYXllcnMucHVzaChsYXllck9iaik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGV0IHdpZHRoID0gdGhpcy5jb2w7XG4gICAgICAgICAgbGV0IGhlaWdodCA9IHRoaXMucm93O1xuICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHtcbiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7IHgrKykge1xuICAgICAgICAgICAgICBsZXQgcG9zaXRpb24gPSB4ICsgeSAqIHdpZHRoO1xuICAgICAgICAgICAgICBsZXQga2V5ID0geCAqIDEwMDAwICsgeTtcbiAgICAgICAgICAgICAgbGV0IHBpY3R1cmUgPSBsYXllckRhdGEuZGF0YVtwb3NpdGlvbl0gLSAxO1xuXG4gICAgICAgICAgICAgIGlmIChwaWN0dXJlID49IDApIHtcbiAgICAgICAgICAgICAgICBpZiAobGF5ZXJEYXRhLm5hbWUgPT0gXCJibG9ja1wiKSB7XG4gICAgICAgICAgICAgICAgICBwcml2YXRlcy5ibG9ja2VkTWFwW2tleV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGF5ZXJEYXRhLm5hbWUgPT0gXCJ3YXRlclwiKSB7XG4gICAgICAgICAgICAgICAgICBwcml2YXRlcy53YXRlck1hcFtrZXldID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgbGV0IGZyYW1lID0gcHJpdmF0ZXMuc2hlZXQuZ2V0RnJhbWUocGljdHVyZSk7XG4gICAgICAgICAgICAgICAgICBmcmFtZS54ID0geCAqIHByaXZhdGVzLmRhdGEudGlsZXdpZHRoO1xuICAgICAgICAgICAgICAgICAgZnJhbWUueSA9IHkgKiBwcml2YXRlcy5kYXRhLnRpbGVoZWlnaHQ7XG5cbiAgICAgICAgICAgICAgICAgIGxheWVyT2JqLmFwcGVuZENoaWxkKGZyYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWPkemAgeWujOaIkOS6i+S7tu+8jOesrOS6jOS4quWPguaVsOS7o+ihqOatpOS6i+S7tuaYr+S4gOasoeaAp+S6i+S7tu+8jOWNs+S4jeS8muWGjeasoWNvbXBsZXRlXG4gICAgICAgIHRoaXMuZW1pdChcImNvbXBsZXRlXCIsIHRydWUpO1xuICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBnZXQgZGF0YSAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuZGF0YTtcbiAgICB9XG5cbiAgICBzZXQgZGF0YSAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuTWFwLmRhdGEgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgZ2V0IGlkICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5pZDtcbiAgICB9XG5cbiAgICBzZXQgaWQgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLk1hcC5pZCByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgd2lkdGggKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZGF0YS53aWR0aCAqIHRoaXMuZGF0YS50aWxld2lkdGg7XG4gICAgfVxuXG4gICAgc2V0IHdpZHRoICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5NYXAud2lkdGggcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgZ2V0IGhlaWdodCAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5kYXRhLmhlaWdodCAqIHRoaXMuZGF0YS50aWxlaGVpZ2h0O1xuICAgIH1cblxuICAgIHNldCBoZWlnaHQgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLk1hcC5oZWlnaHQgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgZ2V0IGNvbCAoKSB7IC8vIHdpZHRoIC8gdGlsZXdpZHRoXG4gICAgICByZXR1cm4gdGhpcy5kYXRhLndpZHRoO1xuICAgIH1cblxuICAgIHNldCBjb2wgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLk1hcC5jb2wgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgZ2V0IHJvdyAoKSB7IC8vIGhlaWdodCAvIHRpbGVoZWlnaHRcbiAgICAgIHJldHVybiB0aGlzLmRhdGEuaGVpZ2h0XG4gICAgfVxuXG4gICAgc2V0IHJvdyAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuTWFwLnJvdyByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgbWluaW1hcCAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykubWluaW1hcDtcbiAgICB9XG5cbiAgICBzZXQgbWluaW1hcCAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuTWFwLm1pbmltYXAgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgLy8g6L+U5Zue5p+Q5Liq5Z2Q5qCH54K55omA5Zyo55qE5Zyw5qC8XG4gICAgdGlsZSAoeCwgeSkge1xuICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZSh4KSAmJiBOdW1iZXIuaXNGaW5pdGUoeSkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB4OiBNYXRoLmZsb29yKHggLyB0aGlzLmRhdGEudGlsZXdpZHRoKSxcbiAgICAgICAgICB5OiBNYXRoLmZsb29yKHkgLyB0aGlzLmRhdGEudGlsZWhlaWdodClcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoeCwgeSwgdGhpcy5kYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5NYXAudGlsZSBnb3QgaW52YWxpZCBhcmd1bWVudHNcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g57uY5Yi25Zu+54mH77yM5Lya5pS55Y+YR2FtZS5jdXJyZW50QXJlYVxuICAgIGRyYXcgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBHYW1lLmxheWVycy5tYXBMYXllci5jbGVhcigpO1xuICAgICAgR2FtZS5sYXllcnMubWFwSGlkZUxheWVyLmNsZWFyKCk7XG5cbiAgICAgIHByaXZhdGVzLmxheWVycy5mb3JFYWNoKChlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgICAgICBsZXQgbGF5ZXJEYXRhID0gcHJpdmF0ZXMuZGF0YS5sYXllcnNbaW5kZXhdO1xuXG4gICAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUobGF5ZXJEYXRhLm9wYWNpdHkpKSB7XG4gICAgICAgICAgZWxlbWVudC5hbHBoYSA9IGxheWVyRGF0YS5vcGFjaXR5O1xuICAgICAgICB9XG5cbiAgICAgICAgR2FtZS5sYXllcnMubWFwTGF5ZXIuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICB9KTtcblxuICAgICAgLy8g6YeK5pS+5YaX5L2Z56m66Ze0XG4gICAgICBwcml2YXRlcy5sYXllcnMgPSBudWxsO1xuICAgICAgcHJpdmF0ZXMuZGF0YS5sYXllcnMgPSBudWxsO1xuXG4gICAgICAvLyDnu5nlhbbku5blnLDlm77nvJPlhrLlsYJcbiAgICAgIEdhbWUubGF5ZXJzLm1hcExheWVyLmNhY2hlKCk7XG4gICAgICBsZXQgbWFwID0gbmV3IFNwcml0ZS5CaXRtYXAoR2FtZS5sYXllcnMubWFwTGF5ZXIuY2FjaGVDYW52YXMpO1xuICAgICAgR2FtZS5sYXllcnMubWFwTGF5ZXIuY2xlYXIoKTtcbiAgICAgIEdhbWUubGF5ZXJzLm1hcExheWVyLmFwcGVuZENoaWxkKG1hcCk7XG5cbiAgICAgIGxldCBtaW5pbWFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgIG1pbmltYXAud2lkdGggPSB0aGlzLmNvbCAqIDg7IC8vIOWOn+WcsOWbvueahOWbm+WAjVxuICAgICAgbWluaW1hcC5oZWlnaHQgPSB0aGlzLnJvdyAqIDg7XG4gICAgICBsZXQgbWluaW1hcENvbnRleHQgPSBtaW5pbWFwLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIG1pbmltYXBDb250ZXh0LmRyYXdJbWFnZShtYXAuaW1hZ2UsXG4gICAgICAgIDAsIDAsIG1hcC53aWR0aCwgbWFwLmhlaWdodCxcbiAgICAgICAgMCwgMCwgbWluaW1hcC53aWR0aCwgbWluaW1hcC5oZWlnaHQpO1xuXG4gICAgICBwcml2YXRlcy5taW5pbWFwID0gbWluaW1hcDtcblxuXG4gICAgICBpZiAocHJpdmF0ZXMuZGF0YS5iZ20pIHtcbiAgICAgICAgLy8gc2V0IGxvb3AgPSAtMSwg5peg6ZmQ5b6q546vXG4gICAgICAgIC8vbGV0IGJnbSA9IGNyZWF0ZWpzLlNvdW5kLnBsYXkodGhpcy5kYXRhLmJnbSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgLTEpO1xuICAgICAgICAvL2JnbS5zZXRWb2x1bWUoMC4yKTtcbiAgICAgIH1cblxuICAgICAgbGV0IGJsb2NrID0ge307XG5cbiAgICAgIC8vIOmihOiuvuS6uueJqeWNoOS9jVxuICAgICAgaWYgKHByaXZhdGVzLmRhdGEuYWN0b3JzKSB7XG4gICAgICAgIGZvciAobGV0IGFjdG9yIG9mIHByaXZhdGVzLmRhdGEuYWN0b3JzKSB7XG4gICAgICAgICAgYmxvY2tbYWN0b3IueCoxMDAwMCthY3Rvci55XSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8g55Sf5oiQ5oCq54mpXG4gICAgICBpZiAoXG4gICAgICAgIHByaXZhdGVzLmRhdGEuc3Bhd25Nb25zdGVyICYmXG4gICAgICAgIHByaXZhdGVzLmRhdGEuc3Bhd25Nb25zdGVyLmxpc3QgJiZcbiAgICAgICAgcHJpdmF0ZXMuZGF0YS5zcGF3bk1vbnN0ZXIuY291bnRcbiAgICAgICkge1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcHJpdmF0ZXMuZGF0YS5zcGF3bk1vbnN0ZXIuY291bnQ7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIGxldCBtb25zdGVySWQgPSBudWxsO1xuICAgICAgICAgIGxldCBwcm9iID0gMDtcbiAgICAgICAgICBsZXQgciA9IE1hdGgucmFuZG9tKCk7XG4gICAgICAgICAgZm9yIChsZXQga2V5IGluIHByaXZhdGVzLmRhdGEuc3Bhd25Nb25zdGVyLmxpc3QpIHtcbiAgICAgICAgICAgIHByb2IgKz0gcHJpdmF0ZXMuZGF0YS5zcGF3bk1vbnN0ZXIubGlzdFtrZXldO1xuICAgICAgICAgICAgaWYgKHIgPCBwcm9iKSB7XG4gICAgICAgICAgICAgIG1vbnN0ZXJJZCA9IGtleTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghbW9uc3RlcklkKSB7XG4gICAgICAgICAgICBtb25zdGVySWQgPSBPYmplY3Qua2V5cyhwcml2YXRlcy5kYXRhLnNwYXduTW9uc3Rlci5saXN0KVswXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgR2FtZS5BY3Rvci5sb2FkKG1vbnN0ZXJJZCkudGhlbigoYWN0b3JPYmopID0+IHtcbiAgICAgICAgICAgIGxldCB4LCB5O1xuICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgeCA9IFNwcml0ZS5yYW5kKDAsIHRoaXMuY29sKTtcbiAgICAgICAgICAgICAgeSA9IFNwcml0ZS5yYW5kKDAsIHRoaXMucm93KTtcbiAgICAgICAgICAgICAgaWYgKCF0aGlzLmhpdFRlc3QoeCwgeSkgJiYgIWJsb2NrW3gqMTAwMDAreV0pIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2tbeCoxMDAwMCt5XSA9IHRydWU7XG4gICAgICAgICAgICBhY3Rvck9iai54ID0geDtcbiAgICAgICAgICAgIGFjdG9yT2JqLnkgPSB5O1xuICAgICAgICAgICAgR2FtZS5hcmVhLmFjdG9ycy5hZGQoYWN0b3JPYmopO1xuICAgICAgICAgICAgYWN0b3JPYmouZHJhdygpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgcHJpdmF0ZXMuZGF0YS5zcGF3bkl0ZW0gJiZcbiAgICAgICAgcHJpdmF0ZXMuZGF0YS5zcGF3bkl0ZW0ubGlzdCAmJlxuICAgICAgICBwcml2YXRlcy5kYXRhLnNwYXduSXRlbS5jb3VudFxuICAgICAgKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwcml2YXRlcy5kYXRhLnNwYXduSXRlbS5jb3VudDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgbGV0IGl0ZW1JZCA9IG51bGw7XG4gICAgICAgICAgbGV0IHByb2IgPSAwO1xuICAgICAgICAgIGxldCByID0gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gcHJpdmF0ZXMuZGF0YS5zcGF3bkl0ZW0ubGlzdCkge1xuICAgICAgICAgICAgcHJvYiArPSBwcml2YXRlcy5kYXRhLnNwYXduSXRlbS5saXN0W2tleV07XG4gICAgICAgICAgICBpZiAociA8IHByb2IpIHtcbiAgICAgICAgICAgICAgaXRlbUlkID0ga2V5O1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFpdGVtSWQpIHtcbiAgICAgICAgICAgIGl0ZW1JZCA9IE9iamVjdC5rZXlzKHByaXZhdGVzLmRhdGEuc3Bhd25JdGVtLmxpc3QpWzBdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBHYW1lLkl0ZW0ubG9hZChpdGVtSWQpLnRoZW4oKGl0ZW1PYmopID0+IHtcbiAgICAgICAgICAgIGxldCB4LCB5O1xuICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgeCA9IFNwcml0ZS5yYW5kKDAsIHRoaXMuY29sKTtcbiAgICAgICAgICAgICAgeSA9IFNwcml0ZS5yYW5kKDAsIHRoaXMucm93KTtcbiAgICAgICAgICAgICAgaWYgKCF0aGlzLmhpdFRlc3QoeCwgeSkgJiYgIWJsb2NrW3gqMTAwMDAreV0pIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYmxvY2tbeCoxMDAwMCt5XSA9IHRydWU7XG4gICAgICAgICAgICBpdGVtT2JqLnggPSB4O1xuICAgICAgICAgICAgaXRlbU9iai55ID0geTtcbiAgICAgICAgICAgIGl0ZW1PYmouaW5uZXIgPSB7fTtcbiAgICAgICAgICAgIGl0ZW1PYmouaW5uZXJbaXRlbUlkXSA9IDE7XG4gICAgICAgICAgICBHYW1lLmFyZWEuaXRlbXMuYWRkKGl0ZW1PYmopO1xuICAgICAgICAgICAgaXRlbU9iai5kcmF3KCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuXG4gICAgfVxuICB9KTtcblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  Game.assign("Quest", (function () {
    function GameQuest() {
      _classCallCheck(this, GameQuest);
    }

    _createClass(GameQuest, null, [{
      key: "load",
      value: function load(id) {
        return new Promise(function (resolve, reject) {
          Sprite.load("quest/" + id + ".js").then(function (data) {
            var questData = data[0]();
            questData.id = id;
            resolve(questData);
          });
        });
      }
    }, {
      key: "isComplete",
      value: function isComplete(quest) {
        if (quest.target) {
          if (quest.target.kill) {
            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
              for (var _iterator = quest.target.kill[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                var k = _step.value;

                if (k.current < k.need) {
                  return false;
                }
              }
            } catch (err) {
              _didIteratorError = true;
              _iteratorError = err;
            } finally {
              try {
                if (!_iteratorNormalCompletion && _iterator["return"]) {
                  _iterator["return"]();
                }
              } finally {
                if (_didIteratorError) {
                  throw _iteratorError;
                }
              }
            }
          }
        }

        return true;
      }
    }]);

    return GameQuest;
  })());
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVRdWVzdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPO2FBQVEsU0FBUzs0QkFBVCxTQUFTOzs7aUJBQVQsU0FBUzs7YUFFdEIsY0FBQyxFQUFFLEVBQUU7QUFDZixlQUFPLElBQUksT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFLE1BQU0sRUFBRTtBQUM1QyxnQkFBTSxDQUFDLElBQUksWUFBVSxFQUFFLFNBQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxJQUFJLEVBQUU7QUFDakQsZ0JBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0FBQzFCLHFCQUFTLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztBQUNsQixtQkFBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1dBQ3BCLENBQUMsQ0FBQztTQUNKLENBQUMsQ0FBQztPQUNKOzs7YUFFaUIsb0JBQUMsS0FBSyxFQUFFO0FBQ3hCLFlBQUksS0FBSyxDQUFDLE1BQU0sRUFBRTtBQUNoQixjQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFOzs7Ozs7QUFDckIsbUNBQWMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLDhIQUFFO29CQUF4QixDQUFDOztBQUNSLG9CQUFJLENBQUMsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRTtBQUN0Qix5QkFBTyxLQUFLLENBQUM7aUJBQ2Q7ZUFDRjs7Ozs7Ozs7Ozs7Ozs7O1dBQ0Y7U0FDRjs7QUFFRCxlQUFPLElBQUksQ0FBQztPQUNiOzs7V0F4QndCLFNBQVM7T0EwQmxDLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lUXVlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBHYW1lLmFzc2lnbihcIlF1ZXN0XCIsIGNsYXNzIEdhbWVRdWVzdCB7XG5cbiAgICBzdGF0aWMgbG9hZCAoaWQpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIFNwcml0ZS5sb2FkKGBxdWVzdC8ke2lkfS5qc2ApLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBsZXQgcXVlc3REYXRhID0gZGF0YVswXSgpO1xuICAgICAgICAgIHF1ZXN0RGF0YS5pZCA9IGlkO1xuICAgICAgICAgIHJlc29sdmUocXVlc3REYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGF0aWMgaXNDb21wbGV0ZSAocXVlc3QpIHtcbiAgICAgIGlmIChxdWVzdC50YXJnZXQpIHtcbiAgICAgICAgaWYgKHF1ZXN0LnRhcmdldC5raWxsKSB7XG4gICAgICAgICAgZm9yIChsZXQgayBvZiBxdWVzdC50YXJnZXQua2lsbCkge1xuICAgICAgICAgICAgaWYgKGsuY3VycmVudCA8IGsubmVlZCkge1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICB9KTtcblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  Game.assign("Item", (function (_Sprite$Event) {
    _inherits(GameItem, _Sprite$Event);

    _createClass(GameItem, null, [{
      key: "load",
      value: function load(id) {
        return new Promise(function (resolve, reject) {
          Sprite.load("item/" + id + ".js").then(function (data) {
            var itemData = data[0]();
            itemData.id = id;
            var itemObj = new Game.Item(itemData);
            Game.items[id] = itemObj;
            itemObj.on("complete", function () {
              resolve(itemObj);
            });
          });
        });
      }
    }]);

    function GameItem(itemData) {
      var _this = this;

      _classCallCheck(this, GameItem);

      _get(Object.getPrototypeOf(GameItem.prototype), "constructor", this).call(this);
      var privates = internal(this);

      privates.data = itemData;
      privates.inner = null;

      if (!this.data.x || !this.data.y) {
        this.data.x = 0;
        this.data.y = 0;
      }

      if (this.data.image) {
        Sprite.load("item/" + this.data.image).then(function (data) {
          var image = data[0];
          privates.icon = image;

          privates.bitmap = new Sprite.Bitmap(image);
          privates.bitmap.x = _this.data.x * 32 + 16;
          privates.bitmap.y = _this.data.y * 32 + 16;
          privates.bitmap.name = _this.id;

          if (Number.isInteger(_this.data.centerX) && Number.isInteger(_this.data.centerY)) {
            privates.bitmap.centerX = _this.data.centerX;
            privates.bitmap.centerY = _this.data.centerY;
          } else {
            console.log(_this.data);
            throw new Error("Game.Item invalid centerX/centerY");
          }

          // 发送完成事件，第二个参数代表一次性事件
          _this.emit("complete", true);
        });
      } else {
        this.emit("complete", true);
      }
    }

    _createClass(GameItem, [{
      key: "hitTest",
      value: function hitTest(x, y) {
        if (this.data.hitArea && this.data.hitArea instanceof Array) {
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = this.data.hitArea[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var p = _step.value;

              if (x == this.x + p[0] && y == this.y + p[1]) {
                return true;
              }
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator["return"]) {
                _iterator["return"]();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }

          return false;
        } else {
          console.error(this.data);
          throw new Error("Game.Actor.hitTest invalid data");
        }
      }
    }, {
      key: "heroUse",
      value: function heroUse() {
        if (this.inner) {
          if (this.data.pickupCondition) {
            if (this.data.pickupCondition()) {
              Game.windows.pickup.open(this);
            } else {
              // 不符合条件
            }
          } else {
              Game.windows.pickup.open(this);
            }
        }

        if (typeof this.data.use == "function") {
          this.data.use();
        }

        if (this.data.type == "potion") {
          for (var attribute in this.data.potion) {
            var effect = this.data.potion[attribute];
            if (attribute == "hp") {
              (function () {
                Game.hero.data.hp = Math.min(Game.hero.data.hp + effect, Game.hero.data.$hp);
                var text = new Sprite.Text({
                  text: "hp+" + effect,
                  color: "black",
                  fontSize: 20
                });
                text.centerX = Math.floor(text.width / 2);
                text.centerY = Math.floor(text.height);
                text.x = Game.hero.sprite.x;
                text.y = Game.hero.sprite.y;
                Game.layers.actorLayer.appendChild(text);
                Sprite.Ticker.whiles(100, function (last) {
                  text.y -= 3;
                  if (last) {
                    Game.layers.actorLayer.removeChild(text);
                  }
                });
              })();
            }
          }
          Game.hero.data.items[this.id]--;
          if (Game.hero.data.items[this.id] <= 0) {
            delete Game.hero.data.items[this.id];
          }
        } // potion
      }
    }, {
      key: "erase",
      value: function erase(layer) {
        Game.layers.itemLayer.removeChild(internal(this).bitmap);
      }
    }, {
      key: "draw",
      value: function draw() {
        Game.layers.itemLayer.appendChild(internal(this).bitmap);
      }
    }, {
      key: "id",
      get: function get() {
        return internal(this).data.id;
      },
      set: function set(value) {
        throw new Error("Game.Item.id readonly");
      }
    }, {
      key: "icon",
      get: function get() {
        if (internal(this).bitmap) {
          return internal(this).bitmap.image;
        }
        return null;
      },
      set: function set(value) {
        throw new Error("Game.Item.icon readonly");
      }
    }, {
      key: "data",
      get: function get() {
        return internal(this).data;
      },
      set: function set(value) {
        console.error(this);
        throw new Error("Game.Item.data readonly");
      }
    }, {
      key: "inner",
      get: function get() {
        return internal(this).inner;
      },
      set: function set(value) {
        internal(this).inner = value;
      }
    }, {
      key: "x",
      get: function get() {
        return internal(this).data.x;
      },
      set: function set(value) {
        var privates = internal(this);
        privates.data.x = value;
        privates.bitmap.x = value * 32 + 16;
      }
    }, {
      key: "y",
      get: function get() {
        return internal(this).data.y;
      },
      set: function set(value) {
        var privates = internal(this);
        privates.data.y = value;
        privates.bitmap.y = value * 32 + 16;
      }
    }, {
      key: "visible",
      get: function get() {
        return internal(this).bitmap.visible;
      },
      set: function set(value) {
        internal(this).bitmap.visible = value;
      }
    }, {
      key: "alpha",
      get: function get() {
        return internal(this).bitmap.alpha;
      },
      set: function set(value) {
        if (Number.isFinite(value) && value >= 0 && value <= 1) {
          internal(this).bitmap.alpha = value;
        } else {
          console.error(value, this);
          throw new Error("Game.Item.alpha got invalid value");
        }
      }
    }, {
      key: "position",
      get: function get() {
        return {
          x: this.x,
          y: this.y
        };
      },
      set: function set(value) {
        console.error(this.data);
        throw new Error("Game.Item.position readonly");
      }
    }]);

    return GameItem;
  })(Sprite.Event));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVJdGVtLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDOztBQUVsQyxNQUFJLENBQUMsTUFBTSxDQUFDLE1BQU07Y0FBUSxRQUFROztpQkFBUixRQUFROzthQUVwQixjQUFDLEVBQUUsRUFBRTtBQUNmLGVBQU8sSUFBSSxPQUFPLENBQUMsVUFBVSxPQUFPLEVBQUUsTUFBTSxFQUFFO0FBQzVDLGdCQUFNLENBQUMsSUFBSSxXQUFTLEVBQUUsU0FBTSxDQUFDLElBQUksQ0FBQyxVQUFVLElBQUksRUFBRTtBQUNoRCxnQkFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDekIsb0JBQVEsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO0FBQ2pCLGdCQUFJLE9BQU8sR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDdEMsZ0JBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDO0FBQ3pCLG1CQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxZQUFNO0FBQzNCLHFCQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDbEIsQ0FBQyxDQUFDO1dBQ0osQ0FBQyxDQUFDO1NBQ0osQ0FBQyxDQUFDO09BQ0o7OztBQUVXLGFBaEJZLFFBQVEsQ0FnQm5CLFFBQVEsRUFBRTs7OzRCQWhCQyxRQUFROztBQWlCOUIsaUNBakJzQixRQUFRLDZDQWlCdEI7QUFDUixVQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7O0FBRTlCLGNBQVEsQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDO0FBQ3pCLGNBQVEsQ0FBQyxLQUFLLEdBQUcsSUFBSSxD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QUU7QUFDbkIsZUFBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDekIsY0FBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO09BQ2hEOzs7V0E3SXVCLFFBQVE7S0FBUyxNQUFNLENBQUMsS0FBSyxFQXdOckQsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVJdGVtLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gIEdhbWUuYXNzaWduKFwiSXRlbVwiLCBjbGFzcyBHYW1lSXRlbSBleHRlbmRzIFNwcml0ZS5FdmVudCB7XG5cbiAgICBzdGF0aWMgbG9hZCAoaWQpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIFNwcml0ZS5sb2FkKGBpdGVtLyR7aWR9LmpzYCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIGxldCBpdGVtRGF0YSA9IGRhdGFbMF0oKTtcbiAgICAgICAgICBpdGVtRGF0YS5pZCA9IGlkO1xuICAgICAgICAgIGxldCBpdGVtT2JqID0gbmV3IEdhbWUuSXRlbShpdGVtRGF0YSk7XG4gICAgICAgICAgR2FtZS5pdGVtc1tpZF0gPSBpdGVtT2JqO1xuICAgICAgICAgIGl0ZW1PYmoub24oXCJjb21wbGV0ZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKGl0ZW1PYmopO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yIChpdGVtRGF0YSkge1xuICAgICAgc3VwZXIoKTtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuXG4gICAgICBwcml2YXRlcy5kYXRhID0gaXRlbURhdGE7XG4gICAgICBwcml2YXRlcy5pbm5lciA9IG51bGw7XG5cbiAgICAgIGlmICghdGhpcy5kYXRhLnggfHwgIXRoaXMuZGF0YS55KSB7XG4gICAgICAgIHRoaXMuZGF0YS54ID0gMDtcbiAgICAgICAgdGhpcy5kYXRhLnkgPSAwO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5kYXRhLmltYWdlKSB7XG4gICAgICAgIFNwcml0ZS5sb2FkKGBpdGVtLyR7dGhpcy5kYXRhLmltYWdlfWApLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICBsZXQgaW1hZ2UgPSBkYXRhWzBdO1xuICAgICAgICAgIHByaXZhdGVzLmljb24gPSBpbWFnZTtcblxuICAgICAgICAgIHByaXZhdGVzLmJpdG1hcCA9IG5ldyBTcHJpdGUuQml0bWFwKGltYWdlKTtcbiAgICAgICAgICBwcml2YXRlcy5iaXRtYXAueCA9IHRoaXMuZGF0YS54ICogMzIgKyAxNjtcbiAgICAgICAgICBwcml2YXRlcy5iaXRtYXAueSA9IHRoaXMuZGF0YS55ICogMzIgKyAxNjtcbiAgICAgICAgICBwcml2YXRlcy5iaXRtYXAubmFtZSA9IHRoaXMuaWQ7XG5cbiAgICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcih0aGlzLmRhdGEuY2VudGVyWCkgJiYgTnVtYmVyLmlzSW50ZWdlcih0aGlzLmRhdGEuY2VudGVyWSkpIHtcbiAgICAgICAgICAgIHByaXZhdGVzLmJpdG1hcC5jZW50ZXJYID0gdGhpcy5kYXRhLmNlbnRlclg7XG4gICAgICAgICAgICBwcml2YXRlcy5iaXRtYXAuY2VudGVyWSA9IHRoaXMuZGF0YS5jZW50ZXJZO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmRhdGEpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5JdGVtIGludmFsaWQgY2VudGVyWC9jZW50ZXJZXCIpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIOWPkemAgeWujOaIkOS6i+S7tu+8jOesrOS6jOS4quWPguaVsOS7o+ihqOS4gOasoeaAp+S6i+S7tlxuICAgICAgICAgIHRoaXMuZW1pdChcImNvbXBsZXRlXCIsIHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZW1pdChcImNvbXBsZXRlXCIsIHRydWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGdldCBpZCAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuZGF0YS5pZDtcbiAgICB9XG5cbiAgICBzZXQgaWQgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLkl0ZW0uaWQgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgZ2V0IGljb24gKCkge1xuICAgICAgaWYgKGludGVybmFsKHRoaXMpLmJpdG1hcCkge1xuICAgICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuYml0bWFwLmltYWdlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgc2V0IGljb24gKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLkl0ZW0uaWNvbiByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgZGF0YSAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuZGF0YTtcbiAgICB9XG5cbiAgICBzZXQgZGF0YSAodmFsdWUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IodGhpcyk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLkl0ZW0uZGF0YSByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgaW5uZXIgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmlubmVyO1xuICAgIH1cblxuICAgIHNldCBpbm5lciAodmFsdWUpIHtcbiAgICAgIGludGVybmFsKHRoaXMpLmlubmVyID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IHggKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmRhdGEueDtcbiAgICB9XG5cbiAgICBzZXQgeCAodmFsdWUpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgcHJpdmF0ZXMuZGF0YS54ID0gdmFsdWU7XG4gICAgICBwcml2YXRlcy5iaXRtYXAueCA9IHZhbHVlICogMzIgKyAxNjtcbiAgICB9XG5cbiAgICBnZXQgeSAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuZGF0YS55O1xuICAgIH1cblxuICAgIHNldCB5ICh2YWx1ZSkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBwcml2YXRlcy5kYXRhLnkgPSB2YWx1ZTtcbiAgICAgIHByaXZhdGVzLmJpdG1hcC55ID0gdmFsdWUgKiAzMiArIDE2O1xuICAgIH1cblxuICAgIGdldCB2aXNpYmxlICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5iaXRtYXAudmlzaWJsZTtcbiAgICB9XG5cbiAgICBzZXQgdmlzaWJsZSAodmFsdWUpIHtcbiAgICAgIGludGVybmFsKHRoaXMpLmJpdG1hcC52aXNpYmxlID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZ2V0IGFscGhhICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5iaXRtYXAuYWxwaGE7XG4gICAgfVxuXG4gICAgc2V0IGFscGhhICh2YWx1ZSkge1xuICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkgJiYgdmFsdWUgPj0gMCAmJiB2YWx1ZSA8PSAxKSB7XG4gICAgICAgIGludGVybmFsKHRoaXMpLmJpdG1hcC5hbHBoYSA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuSXRlbS5hbHBoYSBnb3QgaW52YWxpZCB2YWx1ZVwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgcG9zaXRpb24gKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeDogdGhpcy54LFxuICAgICAgICB5OiB0aGlzLnlcbiAgICAgIH07XG4gICAgfVxuXG4gICAgc2V0IHBvc2l0aW9uICh2YWx1ZSkge1xuICAgICAgY29uc29sZS5lcnJvcih0aGlzLmRhdGEpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5JdGVtLnBvc2l0aW9uIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGhpdFRlc3QgKHgsIHkpIHtcbiAgICAgIGlmICh0aGlzLmRhdGEuaGl0QXJlYSAmJiB0aGlzLmRhdGEuaGl0QXJlYSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIGZvciAobGV0IHAgb2YgdGhpcy5kYXRhLmhpdEFyZWEpIHtcbiAgICAgICAgICBpZiAoeCA9PSB0aGlzLnggKyBwWzBdICYmIHkgPT0gdGhpcy55ICsgcFsxXSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IodGhpcy5kYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5BY3Rvci5oaXRUZXN0IGludmFsaWQgZGF0YVwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBoZXJvVXNlICgpIHtcbiAgICAgIGlmICh0aGlzLmlubmVyKSB7XG4gICAgICAgIGlmICh0aGlzLmRhdGEucGlja3VwQ29uZGl0aW9uKSB7XG4gICAgICAgICAgaWYgKHRoaXMuZGF0YS5waWNrdXBDb25kaXRpb24oKSkge1xuICAgICAgICAgICAgR2FtZS53aW5kb3dzLnBpY2t1cC5vcGVuKHRoaXMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyDkuI3nrKblkIjmnaHku7ZcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgR2FtZS53aW5kb3dzLnBpY2t1cC5vcGVuKHRoaXMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgdGhpcy5kYXRhLnVzZSA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgdGhpcy5kYXRhLnVzZSgpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5kYXRhLnR5cGUgPT0gXCJwb3Rpb25cIikge1xuICAgICAgICBmb3IgKGxldCBhdHRyaWJ1dGUgaW4gdGhpcy5kYXRhLnBvdGlvbikge1xuICAgICAgICAgIGxldCBlZmZlY3QgPSB0aGlzLmRhdGEucG90aW9uW2F0dHJpYnV0ZV07XG4gICAgICAgICAgaWYgKGF0dHJpYnV0ZSA9PSBcImhwXCIpIHtcbiAgICAgICAgICAgIEdhbWUuaGVyby5kYXRhLmhwID0gTWF0aC5taW4oXG4gICAgICAgICAgICAgIEdhbWUuaGVyby5kYXRhLmhwICsgZWZmZWN0LFxuICAgICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS4kaHBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBsZXQgdGV4dCA9IG5ldyBTcHJpdGUuVGV4dCh7XG4gICAgICAgICAgICAgIHRleHQ6IGBocCske2VmZmVjdH1gLFxuICAgICAgICAgICAgICBjb2xvcjogXCJibGFja1wiLFxuICAgICAgICAgICAgICBmb250U2l6ZTogMjBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGV4dC5jZW50ZXJYID0gTWF0aC5mbG9vcih0ZXh0LndpZHRoIC8gMik7XG4gICAgICAgICAgICB0ZXh0LmNlbnRlclkgPSBNYXRoLmZsb29yKHRleHQuaGVpZ2h0KTtcbiAgICAgICAgICAgIHRleHQueCA9IEdhbWUuaGVyby5zcHJpdGUueDtcbiAgICAgICAgICAgIHRleHQueSA9IEdhbWUuaGVyby5zcHJpdGUueTtcbiAgICAgICAgICAgIEdhbWUubGF5ZXJzLmFjdG9yTGF5ZXIuYXBwZW5kQ2hpbGQodGV4dCk7XG4gICAgICAgICAgICBTcHJpdGUuVGlja2VyLndoaWxlcygxMDAsIChsYXN0KSA9PiB7XG4gICAgICAgICAgICAgIHRleHQueSAtPSAzO1xuICAgICAgICAgICAgICBpZiAobGFzdCkge1xuICAgICAgICAgICAgICAgIEdhbWUubGF5ZXJzLmFjdG9yTGF5ZXIucmVtb3ZlQ2hpbGQodGV4dCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBHYW1lLmhlcm8uZGF0YS5pdGVtc1t0aGlzLmlkXS0tO1xuICAgICAgICBpZiAoR2FtZS5oZXJvLmRhdGEuaXRlbXNbdGhpcy5pZF0gPD0gMCkge1xuICAgICAgICAgIGRlbGV0ZSBHYW1lLmhlcm8uZGF0YS5pdGVtc1t0aGlzLmlkXTtcbiAgICAgICAgfVxuICAgICAgfSAvLyBwb3Rpb25cblxuICAgIH1cblxuICAgIGVyYXNlIChsYXllcikge1xuICAgICAgR2FtZS5sYXllcnMuaXRlbUxheWVyLnJlbW92ZUNoaWxkKGludGVybmFsKHRoaXMpLmJpdG1hcCk7XG4gICAgfVxuXG4gICAgZHJhdyAoKSB7XG4gICAgICBHYW1lLmxheWVycy5pdGVtTGF5ZXIuYXBwZW5kQ2hpbGQoaW50ZXJuYWwodGhpcykuYml0bWFwKTtcbiAgICB9XG5cbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  Game.assign("Skill", (function (_Sprite$Event) {
    _inherits(GameSkill, _Sprite$Event);

    _createClass(GameSkill, null, [{
      key: "load",
      value: function load(id) {
        return new Promise(function (resolve, reject) {
          Sprite.load("skill/" + id + ".js").then(function (data) {
            var skillData = data[0]();
            var skillObj = new Game.Skill(skillData);
            Game.skills[id] = skillObj;
            skillObj.on("complete", function () {
              resolve(skillObj);
            });
          });
        });
      }
    }]);

    function GameSkill(skillData) {
      var _this = this;

      _classCallCheck(this, GameSkill);

      _get(Object.getPrototypeOf(GameSkill.prototype), "constructor", this).call(this);
      var privates = internal(this);
      privates.data = skillData;

      Sprite.load("skill/" + this.data.image, "skill/" + this.data.icon, "skill/" + this.data.sound).then(function (data) {
        var image = data[0];
        privates.icon = data[1];
        privates.sound = data[2];

        var sheet = new Sprite.Sheet({
          images: [image],
          width: _this.data.tilewidth,
          height: _this.data.tileheight,
          animations: _this.data.animations
        });

        sheet.centerX = Math.floor(_this.data.tilewidth / 2);
        sheet.centerY = Math.floor(_this.data.tileheight / 2);

        if (_this.data.alpha) {
          sheet.alpha = _this.data.alpha;
        }

        privates.sprite = sheet;

        // 发送完成事件，第二个参数代表一次性事件
        _this.emit("complete", true);
      });
    }

    _createClass(GameSkill, [{
      key: "fire",
      value: function fire(attacker, direction, callback) {
        var _this2 = this;

        var privates = internal(this);

        if (privates.sound) {
          privates.sound.load();
          privates.sound.play();
        }

        var animation = "attack" + direction;
        var weaponAnimation = this.data.animations[animation];
        var sprite = privates.sprite.clone();

        // 矫正武器效果位置
        sprite.x = attacker.facePosition.x * 32 + 16;
        sprite.y = attacker.facePosition.y * 32 + 16;

        // 矫正武器效果中心
        if (Number.isFinite(weaponAnimation.centerX) && Number.isFinite(weaponAnimation.centerY)) {
          sprite.centerX = weaponAnimation.centerX;
          sprite.centerY = weaponAnimation.centerY;
        } else {
          console.error(weaponAnimation, this.data);
          throw new Error("Game.Skill.fire invalid centerX/centerY");
        }

        // 如果是远距离攻击（this.data.distance > 0），那么distance是它已经走过的距离
        var distance = 0;
        // 被命中的actor列表
        var hitted = [];
        var CheckHit = function CheckHit() {
          // 技能所在当前方格
          var l1 = Game.area.map.tile(sprite.x, sprite.y);
          // 碰撞检测
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = Game.area.actors[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var actor = _step.value;

              if (actor != attacker && hitted.length <= 0) {
                if (actor.hitTest(l1.x, l1.y)) {
                  hitted.push(actor);
                }
              }
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator["return"]) {
                _iterator["return"]();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }
        };

        var listener = Sprite.Ticker.on("tick", function () {

          if (_this2.data.distance > 0) {
            // 飞行速度是4
            distance += 4;
          }

          switch (animation) {
            case "attackdown":
              sprite.y += distance;
              break;
            case "attackleft":
              sprite.x -= distance;
              break;
            case "attackright":
              sprite.x += distance;
              break;
            case "attackup":
              sprite.y -= distance;
              break;
          }

          CheckHit();

          // 测试碰撞到墙
          var grid = Game.area.map.tile(sprite.x, sprite.y);
          if (Game.area.map.hitTest(grid.x, grid.y)) {
            Finish();
          }

          // 如果击中了一个敌人（单体伤害）
          if (hitted.length > 0) {
            Finish();
          }

          // 如果是远程攻击，并且攻击距离已经到了
          if (_this2.data.distance > 0 && distance >= _this2.data.distance) {
            Finish();
          }
        });

        // 攻击结束时运行Stop函数
        var Finish = function Finish() {
          Sprite.Ticker.off("tick", listener);

          if (hitted.length > 0 && _this2.data.animations["hitted"]) {
            var actor = hitted[0];
            sprite.x = actor.sprite.x;
            sprite.y = actor.sprite.y;
            sprite.play("hitted");
            if (sprite.paused == true) {
              Game.layers.skillLayer.removeChild(sprite);
            } else {
              sprite.on("animationend", function () {
                Game.layers.skillLayer.removeChild(sprite);
              });
            }
          } else {
            // 如果动画已经播完，则停止
            if (sprite.paused == true) {
              Game.layers.skillLayer.removeChild(sprite);
            } else {
              sprite.on("animationend", function () {
                Game.layers.skillLayer.removeChild(sprite);
              });
            }
          }

          if (callback) {
            callback(hitted);
          }
        };

        Game.layers.skillLayer.appendChild(sprite);
        sprite.play(animation);

        if (this.data.animations[animation].actor && attacker.data.animations[this.data.animations[animation].actor]) {
          attacker.play(this.data.animations[animation].actor, 3);
        } else {
          attacker.play("face" + direction, 0);
          attacker.play("attack" + direction, 3);
        }
      }
    }, {
      key: "id",
      get: function get() {
        return internal(this).data.id;
      },
      set: function set(value) {
        throw new Error("Game.Skill.id readonly");
      }
    }, {
      key: "icon",
      get: function get() {
        return internal(this).icon;
      },
      set: function set(value) {
        throw new Error("Game.Skill.icon readonly");
      }
    }, {
      key: "data",
      get: function get() {
        return internal(this).data;
      },
      set: function set(value) {
        console.error(this);
        throw new Error("Game.Skill.data readonly");
      }
    }, {
      key: "power",
      get: function get() {
        if (Number.isFinite(this.data.power)) {
          // 固定伤害
          return this.data.power;
        } else if (typeof this.data.power == "string") {
          // 骰子伤害，例如1d5就是投一个五面骰子，数值在1到5之间
          var m = this.data.power.match(/(\d+)d(\d+)/);
          if (!m) {
            console.error(this.data.power, this.data);
            throw new Error("Sprite.Skill got invalid power data");
          }
          var times = parseInt(m[1]);
          var dice = parseInt(m[2]);
          var sum = 0;
          for (var i = 0; i < times; i++) {
            sum += Sprite.rand(0, dice) + 1;
          }
          return sum;
        } else {
          console.error(this.data.power, this.data);
          throw new Error("Game.Skill.power invalid power");
        }
      },
      set: function set(value) {
        throw new Error("Game.Skill.power readonly");
      }
    }, {
      key: "type",
      get: function get() {
        return this.data.type;
      },
      set: function set(value) {
        throw new Error("Game.Skill.type readonly");
      }
    }]);

    return GameSkill;
  })(Sprite.Event));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVTa2lsbC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7QUFFbEMsTUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPO2NBQVEsU0FBUzs7aUJBQVQsU0FBUzs7YUFFdEIsY0FBQyxFQUFFLEVBQUU7QUFDZixlQUFPLElBQUksT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFLE1BQU0sRUFBRTtBQUM1QyxnQkFBTSxDQUFDLElBQUksWUFBVSxFQUFFLFNBQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxJQUFJLEVBQUU7QUFDakQsZ0JBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0FBQzFCLGdCQUFJLFFBQVEsR0FBRyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDekMsZ0JBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDO0FBQzNCLG9CQUFRLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxZQUFNO0FBQzVCLHFCQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7YUFDbkIsQ0FBQyxDQUFDO1dBQ0osQ0FBQyxDQUFDO1NBQ0osQ0FBQyxDQUFDO09BQ0o7OztBQUVXLGFBZmEsU0FBUyxDQWVyQixTQUFTLEVBQUU7Ozs0QkFmQyxTQUFTOztBQWdCaEMsaUNBaEJ1QixTQUFTLDZDQWdCdkI7QUFDVCxVQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDOUIsY0FBUSxDQUFDLElBQUksR0FBRyxTQUFTLENBQUM7O0FBRTFCLFlBQU0sQ0FBQyxJQUFJLFlBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLGFBQ2YsSUFBSSxDQUFDLElBQUks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QyxDQUFDLENBQUM7QUFDM0IsY0FBSSxJQUFJLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFCLGNBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztBQUNaLGVBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDOUIsZUFBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztXQUNqQztBQUNELGlCQUFPLEdBQUcsQ0FBQztTQUNaLE1BQU07QUFDTCxpQkFBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDMUMsZ0JBQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztTQUNuRDtPQUNGO1dBRVMsYUFBQyxLQUFLLEVBQUU7QUFDaEIsY0FBTSxJQUFJLEtBQUssQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO09BQzlDOzs7V0FFUSxlQUFHO0FBQ1YsZUFBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztPQUN2QjtXQUVRLGFBQUMsS0FBSyxFQUFFO0FBQ2YsY0FBTSxJQUFJLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO09BQzdDOzs7V0E3R3dCLFNBQVM7S0FBUyxNQUFNLENBQUMsS0FBSyxFQStPdkQsQ0FBQztDQUVKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVTa2lsbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCBpbnRlcm5hbCA9IFNwcml0ZS5OYW1lc3BhY2UoKTtcblxuICBHYW1lLmFzc2lnbihcIlNraWxsXCIsIGNsYXNzIEdhbWVTa2lsbCBleHRlbmRzIFNwcml0ZS5FdmVudCB7XG5cbiAgICBzdGF0aWMgbG9hZCAoaWQpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIFNwcml0ZS5sb2FkKGBza2lsbC8ke2lkfS5qc2ApLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBsZXQgc2tpbGxEYXRhID0gZGF0YVswXSgpO1xuICAgICAgICAgIGxldCBza2lsbE9iaiA9IG5ldyBHYW1lLlNraWxsKHNraWxsRGF0YSk7XG4gICAgICAgICAgR2FtZS5za2lsbHNbaWRdID0gc2tpbGxPYmo7XG4gICAgICAgICAgc2tpbGxPYmoub24oXCJjb21wbGV0ZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKHNraWxsT2JqKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvciAoc2tpbGxEYXRhKSB7XG4gICAgICBzdXBlciAoKTtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgcHJpdmF0ZXMuZGF0YSA9IHNraWxsRGF0YTtcblxuICAgICAgU3ByaXRlLmxvYWQoXG4gICAgICAgIGBza2lsbC8ke3RoaXMuZGF0YS5pbWFnZX1gLFxuICAgICAgICBgc2tpbGwvJHt0aGlzLmRhdGEuaWNvbn1gLFxuICAgICAgICBgc2tpbGwvJHt0aGlzLmRhdGEuc291bmR9YFxuICAgICAgKS50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgIGxldCBpbWFnZSA9IGRhdGFbMF07XG4gICAgICAgIHByaXZhdGVzLmljb24gPSBkYXRhWzFdO1xuICAgICAgICBwcml2YXRlcy5zb3VuZCA9IGRhdGFbMl07XG5cbiAgICAgICAgbGV0IHNoZWV0ID0gbmV3IFNwcml0ZS5TaGVldCh7XG4gICAgICAgICAgaW1hZ2VzOiBbaW1hZ2VdLFxuICAgICAgICAgIHdpZHRoOiB0aGlzLmRhdGEudGlsZXdpZHRoLFxuICAgICAgICAgIGhlaWdodDogdGhpcy5kYXRhLnRpbGVoZWlnaHQsXG4gICAgICAgICAgYW5pbWF0aW9uczogdGhpcy5kYXRhLmFuaW1hdGlvbnNcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2hlZXQuY2VudGVyWCA9IE1hdGguZmxvb3IodGhpcy5kYXRhLnRpbGV3aWR0aCAvIDIpO1xuICAgICAgICBzaGVldC5jZW50ZXJZID0gTWF0aC5mbG9vcih0aGlzLmRhdGEudGlsZWhlaWdodCAvIDIpO1xuXG4gICAgICAgIGlmICh0aGlzLmRhdGEuYWxwaGEpIHtcbiAgICAgICAgICBzaGVldC5hbHBoYSA9IHRoaXMuZGF0YS5hbHBoYTtcbiAgICAgICAgfVxuXG4gICAgICAgIHByaXZhdGVzLnNwcml0ZSA9IHNoZWV0O1xuXG4gICAgICAgIC8vIOWPkemAgeWujOaIkOS6i+S7tu+8jOesrOS6jOS4quWPguaVsOS7o+ihqOS4gOasoeaAp+S6i+S7tlxuICAgICAgICB0aGlzLmVtaXQoXCJjb21wbGV0ZVwiLCB0cnVlKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldCBpZCAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuZGF0YS5pZDtcbiAgICB9XG5cbiAgICBzZXQgaWQgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLlNraWxsLmlkIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGdldCBpY29uICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5pY29uO1xuICAgIH1cblxuICAgIHNldCBpY29uICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5Ta2lsbC5pY29uIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGdldCBkYXRhICgpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbCh0aGlzKS5kYXRhO1xuICAgIH1cblxuICAgIHNldCBkYXRhICh2YWx1ZSkge1xuICAgICAgY29uc29sZS5lcnJvcih0aGlzKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuU2tpbGwuZGF0YSByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgcG93ZXIgKCkge1xuICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZSh0aGlzLmRhdGEucG93ZXIpKSB7XG4gICAgICAgIC8vIOWbuuWumuS8pOWus1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLnBvd2VyO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy5kYXRhLnBvd2VyID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgLy8g6aqw5a2Q5Lyk5a6z77yM5L6L5aaCMWQ15bCx5piv5oqV5LiA5Liq5LqU6Z2i6aqw5a2Q77yM5pWw5YC85ZyoMeWIsDXkuYvpl7RcbiAgICAgICAgbGV0IG0gPSB0aGlzLmRhdGEucG93ZXIubWF0Y2goLyhcXGQrKWQoXFxkKykvKTtcbiAgICAgICAgaWYgKCFtKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcih0aGlzLmRhdGEucG93ZXIsIHRoaXMuZGF0YSk7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3ByaXRlLlNraWxsIGdvdCBpbnZhbGlkIHBvd2VyIGRhdGFcIik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHRpbWVzID0gcGFyc2VJbnQobVsxXSk7XG4gICAgICAgIGxldCBkaWNlID0gcGFyc2VJbnQobVsyXSk7XG4gICAgICAgIGxldCBzdW0gPSAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRpbWVzOyBpKyspIHtcbiAgICAgICAgICBzdW0gKz0gU3ByaXRlLnJhbmQoMCwgZGljZSkgKyAxO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdW07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKHRoaXMuZGF0YS5wb3dlciwgdGhpcy5kYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5Ta2lsbC5wb3dlciBpbnZhbGlkIHBvd2VyXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHNldCBwb3dlciAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuU2tpbGwucG93ZXIgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgZ2V0IHR5cGUgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZGF0YS50eXBlO1xuICAgIH1cblxuICAgIHNldCB0eXBlICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5Ta2lsbC50eXBlIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGZpcmUgKGF0dGFja2VyLCBkaXJlY3Rpb24sIGNhbGxiYWNrKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcblxuICAgICAgaWYgKHByaXZhdGVzLnNvdW5kKSB7XG4gICAgICAgIHByaXZhdGVzLnNvdW5kLmxvYWQoKTtcbiAgICAgICAgcHJpdmF0ZXMuc291bmQucGxheSgpO1xuICAgICAgfVxuXG4gICAgICBsZXQgYW5pbWF0aW9uID0gXCJhdHRhY2tcIiArIGRpcmVjdGlvbjtcbiAgICAgIGxldCB3ZWFwb25BbmltYXRpb24gPSB0aGlzLmRhdGEuYW5pbWF0aW9uc1thbmltYXRpb25dO1xuICAgICAgbGV0IHNwcml0ZSA9IHByaXZhdGVzLnNwcml0ZS5jbG9uZSgpO1xuXG4gICAgICAvLyDnn6vmraPmrablmajmlYjmnpzkvY3nva5cbiAgICAgIHNwcml0ZS54ID0gYXR0YWNrZXIuZmFjZVBvc2l0aW9uLnggKiAzMiArIDE2O1xuICAgICAgc3ByaXRlLnkgPSBhdHRhY2tlci5mYWNlUG9zaXRpb24ueSAqIDMyICsgMTY7XG5cbiAgICAgIC8vIOefq+ato+atpuWZqOaViOaenOS4reW/g1xuICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZSh3ZWFwb25BbmltYXRpb24uY2VudGVyWCkgJiYgTnVtYmVyLmlzRmluaXRlKHdlYXBvbkFuaW1hdGlvbi5jZW50ZXJZKSkge1xuICAgICAgICBzcHJpdGUuY2VudGVyWCA9IHdlYXBvbkFuaW1hdGlvbi5jZW50ZXJYO1xuICAgICAgICBzcHJpdGUuY2VudGVyWSA9IHdlYXBvbkFuaW1hdGlvbi5jZW50ZXJZO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih3ZWFwb25BbmltYXRpb24sIHRoaXMuZGF0YSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuU2tpbGwuZmlyZSBpbnZhbGlkIGNlbnRlclgvY2VudGVyWVwiKTtcbiAgICAgIH1cblxuICAgICAgLy8g5aaC5p6c5piv6L+c6Led56a75pS75Ye777yIdGhpcy5kYXRhLmRpc3RhbmNlID4gMO+8ie+8jOmCo+S5iGRpc3RhbmNl5piv5a6D5bey57uP6LWw6L+H55qE6Led56a7XG4gICAgICBsZXQgZGlzdGFuY2UgPSAwO1xuICAgICAgLy8g6KKr5ZG95Lit55qEYWN0b3LliJfooahcbiAgICAgIGxldCBoaXR0ZWQgPSBbXTtcbiAgICAgIGxldCBDaGVja0hpdCA9ICgpID0+IHtcbiAgICAgICAgLy8g5oqA6IO95omA5Zyo5b2T5YmN5pa55qC8XG4gICAgICAgIGxldCBsMSA9IEdhbWUuYXJlYS5tYXAudGlsZShzcHJpdGUueCwgc3ByaXRlLnkpO1xuICAgICAgICAvLyDnorDmkp7mo4DmtYtcbiAgICAgICAgZm9yIChsZXQgYWN0b3Igb2YgR2FtZS5hcmVhLmFjdG9ycykge1xuICAgICAgICAgIGlmIChhY3RvciAhPSBhdHRhY2tlciAmJiBoaXR0ZWQubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgIGlmIChhY3Rvci5oaXRUZXN0KGwxLngsIGwxLnkpKSB7XG4gICAgICAgICAgICAgIGhpdHRlZC5wdXNoKGFjdG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGxldCBsaXN0ZW5lciA9IFNwcml0ZS5UaWNrZXIub24oXCJ0aWNrXCIsICgpID0+IHtcblxuICAgICAgICBpZiAodGhpcy5kYXRhLmRpc3RhbmNlID4gMCkge1xuICAgICAgICAgIC8vIOmjnuihjOmAn+W6puaYrzRcbiAgICAgICAgICBkaXN0YW5jZSArPSA0O1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoIChhbmltYXRpb24pIHtcbiAgICAgICAgICBjYXNlIFwiYXR0YWNrZG93blwiOlxuICAgICAgICAgICAgc3ByaXRlLnkgKz0gZGlzdGFuY2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiYXR0YWNrbGVmdFwiOlxuICAgICAgICAgICAgc3ByaXRlLnggLT0gZGlzdGFuY2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiYXR0YWNrcmlnaHRcIjpcbiAgICAgICAgICAgIHNwcml0ZS54ICs9IGRpc3RhbmNlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcImF0dGFja3VwXCI6XG4gICAgICAgICAgICBzcHJpdGUueSAtPSBkaXN0YW5jZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgQ2hlY2tIaXQoKTtcblxuICAgICAgICAvLyDmtYvor5XnorDmkp7liLDloplcbiAgICAgICAgbGV0IGdyaWQgPSBHYW1lLmFyZWEubWFwLnRpbGUoc3ByaXRlLngsIHNwcml0ZS55KTtcbiAgICAgICAgaWYgKEdhbWUuYXJlYS5tYXAuaGl0VGVzdChncmlkLngsIGdyaWQueSkpIHtcbiAgICAgICAgICBGaW5pc2goKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWmguaenOWHu+S4reS6huS4gOS4quaVjOS6uu+8iOWNleS9k+S8pOWus++8iVxuICAgICAgICBpZiAoaGl0dGVkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBGaW5pc2goKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOWmguaenOaYr+i/nOeoi+aUu+WHu++8jOW5tuS4lOaUu+WHu+i3neemu+W3sue7j+WIsOS6hlxuICAgICAgICBpZiAodGhpcy5kYXRhLmRpc3RhbmNlID4gMCAmJiBkaXN0YW5jZSA+PSB0aGlzLmRhdGEuZGlzdGFuY2UpIHtcbiAgICAgICAgICBGaW5pc2goKTtcbiAgICAgICAgfVxuXG4gICAgICB9KTtcblxuICAgICAgLy8g5pS75Ye757uT5p2f5pe26L+Q6KGMU3RvcOWHveaVsFxuICAgICAgbGV0IEZpbmlzaCA9ICgpID0+IHtcbiAgICAgICAgU3ByaXRlLlRpY2tlci5vZmYoXCJ0aWNrXCIsIGxpc3RlbmVyKTtcblxuICAgICAgICBpZiAoaGl0dGVkLmxlbmd0aCA+IDAgJiYgdGhpcy5kYXRhLmFuaW1hdGlvbnNbXCJoaXR0ZWRcIl0pIHtcbiAgICAgICAgICBsZXQgYWN0b3IgPSBoaXR0ZWRbMF07XG4gICAgICAgICAgc3ByaXRlLnggPSBhY3Rvci5zcHJpdGUueDtcbiAgICAgICAgICBzcHJpdGUueSA9IGFjdG9yLnNwcml0ZS55O1xuICAgICAgICAgIHNwcml0ZS5wbGF5KFwiaGl0dGVkXCIpO1xuICAgICAgICAgIGlmIChzcHJpdGUucGF1c2VkID09IHRydWUpIHtcbiAgICAgICAgICAgIEdhbWUubGF5ZXJzLnNraWxsTGF5ZXIucmVtb3ZlQ2hpbGQoc3ByaXRlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3ByaXRlLm9uKFwiYW5pbWF0aW9uZW5kXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgR2FtZS5sYXllcnMuc2tpbGxMYXllci5yZW1vdmVDaGlsZChzcHJpdGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOWmguaenOWKqOeUu+W3sue7j+aSreWujO+8jOWImeWBnOatolxuICAgICAgICAgIGlmIChzcHJpdGUucGF1c2VkID09IHRydWUpIHtcbiAgICAgICAgICAgIEdhbWUubGF5ZXJzLnNraWxsTGF5ZXIucmVtb3ZlQ2hpbGQoc3ByaXRlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3ByaXRlLm9uKFwiYW5pbWF0aW9uZW5kXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgR2FtZS5sYXllcnMuc2tpbGxMYXllci5yZW1vdmVDaGlsZChzcHJpdGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgY2FsbGJhY2soaGl0dGVkKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBHYW1lLmxheWVycy5za2lsbExheWVyLmFwcGVuZENoaWxkKHNwcml0ZSk7XG4gICAgICBzcHJpdGUucGxheShhbmltYXRpb24pO1xuXG4gICAgICBpZiAoIHRoaXMuZGF0YS5hbmltYXRpb25zW2FuaW1hdGlvbl0uYWN0b3JcbiAgICAgICAgJiYgYXR0YWNrZXIuZGF0YS5hbmltYXRpb25zW3RoaXMuZGF0YS5hbmltYXRpb25zW2FuaW1hdGlvbl0uYWN0b3JdICkge1xuICAgICAgICBhdHRhY2tlci5wbGF5KHRoaXMuZGF0YS5hbmltYXRpb25zW2FuaW1hdGlvbl0uYWN0b3IsIDMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXR0YWNrZXIucGxheShcImZhY2VcIiArIGRpcmVjdGlvbiwgMCk7XG4gICAgICAgIGF0dGFja2VyLnBsYXkoXCJhdHRhY2tcIiArIGRpcmVjdGlvbiwgMyk7XG4gICAgICB9XG4gICAgfVxuXG4gIH0pO1xuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x2, _x3, _x4) { var _again = true; _function: while (_again) { var object = _x2, property = _x3, receiver = _x4; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x2 = parent; _x3 = property; _x4 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /*
    角色类，包括涉及到hero和npc
    属性：
      this.sprite 精灵
  */
  Game.assign("Actor", (function (_Sprite$Event) {
    _inherits(Actor, _Sprite$Event);

    _createClass(Actor, null, [{
      key: "load",
      value: function load(id) {
        return new Promise(function (resolve, reject) {
          Sprite.load("actor/" + id + ".js").then(function (data) {
            var actorData = data[0]();
            actorData.id = id;

            var actorObj = null;
            if (actorData.type == "npc") {
              actorObj = new Game.ActorNPC(actorData);
            } else if (actorData.type == "monster") {
              actorObj = new Game.ActorMonster(actorData);
            } else if (actorData.type == "ally") {
              actorObj = new Game.ActorAlly(actorData);
            } else if (actorData.type == "pet") {
              actorObj = new Game.ActorPet(actorData);
            } else {
              console.error(actorData.type, actorData);
              throw new Error("Game.Actor.load invalid actor type");
            }
            actorObj.on("complete", function () {
              resolve(actorObj);
            });
          });
        });
      }
    }]);

    function Actor(actorData) {
      var _this = this;

      _classCallCheck(this, Actor);

      _get(Object.getPrototypeOf(Actor.prototype), "constructor", this).call(this);
      var privates = internal(this);

      privates.data = actorData;

      this.makeInfoBox();

      if (this.data.image instanceof Array) {
        this.init(this.data.image);
      } else if (typeof this.data.image == "string") {
        Sprite.load("actor/" + this.data.image).then(function (data) {
          // data is Array
          _this.init(data);
        });
      } else {
        console.error(this.id, this.data, this.data.image, this);
        throw new Error("Invalid Actor Image");
      }
    }

    _createClass(Actor, [{
      key: "init",
      value: function init(images) {
        var _this2 = this;

        var privates = internal(this);
        var data = privates.data;

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = images[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var image = _step.value;

            if (!(image instanceof Image) && !(image.getContext && image.getContext("2d"))) {
              console.error(image, images, this);
              throw new Error("Game.Actor got invalid image, not Image or Canvas");
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator["return"]) {
              _iterator["return"]();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }

        ;

        var sprite = new Sprite.Sheet({
          images: images, // images is Array
          width: data.tilewidth,
          height: data.tileheight,
          animations: data.animations
        });

        if (Number.isInteger(data.centerX) && Number.isInteger(data.centerY)) {
          sprite.centerX = data.centerX;
          sprite.centerY = data.centerY;
        } else {
          console.log(data);
          throw new Error("Game.Actor invalid centerX/centerY");
        }

        sprite.play("facedown");
        privates.sprite = sprite;

        sprite.on("change", function () {
          privates.infoBox.x = sprite.x;
          privates.infoBox.y = sprite.y - sprite.centerY - 20;
        });

        var completeCount = -1;
        var Complete = function Complete() {
          completeCount++;
          if (completeCount >= 0) {
            _this2.calculate();
            _this2.refreshBar();
            _this2.emit("complete", true);
          }
        };

        // 加载NPC可能有的任务
        if (data.quest) {
          privates.quest = [];
          privates.quest.length = data.quest.length;
          data.quest.forEach(function (questId, index) {
            completeCount--;

            Game.Quest.load(questId).then(function (questData) {
              privates.quest.push(questData);
              Complete();
            });
          });
        }

        // 加载人物技能
        if (data.skills) {
          data.skills.forEach(function (skillId) {
            completeCount--;
            Game.Skill.load(skillId).then(function () {
              Complete();
            });
          });
        }

        // 加载人物装备（暂时只有玩家）
        if (data.equipment) {
          for (var key in data.equipment) {
            var itemId = data.equipment[key];
            if (itemId) {
              completeCount--;
              Game.Item.load(itemId).then(function () {
                Complete();
              });
            }
          }
        }

        // 加载人物物品
        if (data.items) {
          for (var itemId in data.items) {
            completeCount--;
            Game.Item.load(itemId).then(function () {
              Complete();
            });
          }
        }

        Complete();
      }
    }, {
      key: "popup",
      value: function popup(text) {
        Game.popup(this.sprite, text, 0, -50);
      }
    }, {
      key: "makeInfoBox",
      value: function makeInfoBox() {
        var privates = internal(this);
        // 名字
        var text = new Sprite.Text({
          text: privates.data.name,
          maxWidth: 200,
          color: "white",
          fontSize: 12
        });
        text.centerY = Math.floor(text.height / 2);
        text.centerX = Math.floor(text.width / 2);
        text.x = 0;
        text.y = 0;

        // 一个上面四个精神条、血条的聚合，统一管理放入这个Container
        privates.infoBox = new Sprite.Container();

        if (privates.data.type != "hero") {
          // 血条外面的黑框
          var hpbarBox = new Sprite.Shape();
          hpbarBox.centerX = 15;
          hpbarBox.centerY = 2;
          hpbarBox.x = 0;
          hpbarBox.y = 9;

          // 魔法条外面的黑框
          var mpbarBox = new Sprite.Shape();
          mpbarBox.centerX = 15;
          mpbarBox.centerY = 2;
          mpbarBox.x = 0;
          mpbarBox.y = 12;

          hpbarBox.rect({
            x: 0,
            y: 0,
            width: 30,
            height: 3,
            "fill-opacity": 0
          });

          mpbarBox.rect({
            x: 0,
            y: 0,
            width: 30,
            height: 3,
            "fill-opacity": 0
          });

          // 生命条
          privates.hpbar = new Sprite.Shape();
          privates.hpbar.centerX = 15;
          privates.hpbar.centerY = 2;
          privates.hpbar.x = 0;
          privates.hpbar.y = 9;

          // 精力条
          privates.mpbar = new Sprite.Shape();
          privates.mpbar.centerX = 15;
          privates.mpbar.centerY = 2;
          privates.mpbar.x = 0;
          privates.mpbar.y = 12;

          privates.infoBox.appendChild(text, hpbarBox, mpbarBox, privates.hpbar, privates.mpbar);
        }
      }
    }, {
      key: "calculate",
      value: function calculate() {
        var data = internal(this).data;
        if (data.$str && data.$dex && data.$con && data.$int && data.$cha) {

          data.str = data.$str;
          data.dex = data.$dex;
          data.con = data.$con;
          data.int = data.$int;
          data.cha = data.$cha;

          // 然后可以针对一级属性计算buff

          // 计算完一级属性的buff之后，开始计算二级属性

          data.$hp = data.con * 5;
          data.$sp = data.int * 5;

          data.atk = Math.floor(data.str * 0.25);
          data.matk = Math.floor(data.int * 0.25);
          data.def = 0;
          data.mdef = 0;
          data.critical = data.dex * 0.005;
          data.dodge = data.dex * 0.005;

          // 然后可以对二级属性计算buff

          // 对二级属性计算完buff之后，可以计算会变动的值
          // 例如.$hp是buff之后的生命值上限，.hp是当前生命值
          data.hp = data.$hp;
          data.sp = data.$sp;

          if (data.buff && data.nerf) {
            data.buff.forEach(function (element) {});
            data.nerf.forEach(function (element) {});
          }
        }
      }
    }, {
      key: "refreshBar",
      value: function refreshBar() {
        var privates = internal(this);

        if (privates.hpbar && privates.mpbar) {
          var hpcolor = "green";
          if (this.data.hp / this.data.$hp < 0.25) hpcolor = "red";else if (this.data.hp / this.data.$hp < 0.5) hpcolor = "yellow";

          privates.hpbar.clear().rect({
            x: 1,
            y: 1,
            width: Math.floor(this.data.hp / this.data.$hp * 28),
            height: 2,
            fill: hpcolor,
            "stroke-width": 0
          });

          privates.mpbar.clear().rect({
            x: 1,
            y: 1,
            width: Math.floor(this.data.sp / this.data.$sp * 28),
            height: 2,
            fill: "blue",
            "stroke-width": 0
          });
        }
      }
    }, {
      key: "distance",
      value: function distance() {
        var x = null,
            y = null;
        if (arguments.length == 2 && Number.isFinite(arguments[0]) && Number.isFinite(arguments[1])) {
          x = arguments[0];
          y = arguments[1];
        } else if (arguments.length == 1 && Number.isFinite(arguments[0].x) && Number.isFinite(arguments[0].y)) {
          x = arguments[0].x;
          y = arguments[0].y;
        } else {
          console.error(arguments);
          throw new Error("Game.Actor.distance Invalid arguments");
        }
        var d = 0;
        d += Math.pow(this.x - x, 2);
        d += Math.pow(this.y - y, 2);
        d = Math.sqrt(d);
        return d;
      }
    }, {
      key: "decreaseHP",
      value: function decreaseHP(power) {
        this.data.hp -= power;
        this.refreshBar();
      }
    }, {
      key: "decreaseSP",
      value: function decreaseSP(sp) {
        this.data.sp -= sp;
        this.refreshBar();
      }
    }, {
      key: "dead",
      value: function dead(attacker) {
        var _this3 = this;

        if (this.data.hp <= 0) {
          if (this.data.type == "hero") {
            Game.windows.over.open("你被" + attacker.data.name + "打死了");
          } else {
            (function () {

              _this3.erase();
              Game.area.actors["delete"](_this3);

              var items = _this3.data.items || { gold: 1 };

              Game.addBag(_this3.x, _this3.y).then(function (bag) {
                for (var itemId in items) {
                  if (bag.inner.hasOwnProperty(itemId)) {
                    bag.inner[itemId] += items[itemId];
                  } else {
                    bag.inner[itemId] = items[itemId];
                  }
                }
              });

              attacker.emit("kill", false, _this3);
            })();
          }
        }
      }

      /** 闪一闪人物，例如被击中时的效果 */
    }, {
      key: "flash",
      value: function flash() {
        var _this4 = this;

        this.sprite.alpha = 0.5;
        setTimeout(function () {
          _this4.sprite.alpha = 1;
        }, 200);
      }

      /** 受到attacker的skill技能的伤害 */
    }, {
      key: "damage",
      value: function damage(attacker, skill) {

        this.emit("damaged");

        var power = skill.power;
        var type = skill.type;

        var color = "white";
        if (this.data.type == "hero") {
          color = "red";
        }

        if (type == "normal") {
          power += attacker.data.atk;
          power -= this.data.def;
          power = Math.max(0, power);
        } else {
          // type == magic
          power += attacker.data.matk;
          power - this.data.mdef;
          power = Math.max(0, power);
        }

        var text = null;
        var state = null;

        if (Math.random() < this.data.dodge) {
          // 闪避了
          state = "dodge";
          text = new Sprite.Text({
            text: "miss",
            color: color,
            fontSize: 16
          });
        } else if (Math.random() < attacker.data.critical) {
          // 重击了
          state = "critical";
          power *= 2;
          text = new Sprite.Text({
            text: "-" + power,
            color: color,
            fontSize: 32
          });
          this.flash();
          this.decreaseHP(power);
        } else {
          // 普通击中
          state = "hit";
          text = new Sprite.Text({
            text: "-" + power,
            color: color,
            fontSize: 16
          });
          this.flash();
          this.decreaseHP(power);
        }

        /*
        if (state != "dodge" && this != Game.hero) {
          if (Game.sounds.hurt) {
            Game.sounds.hurt.load();
            Game.sounds.hurt.play();
          }
        }
        */

        text.centerX = Math.floor(text.width / 2);
        text.centerY = Math.floor(text.height);
        text.x = this.sprite.x;
        text.y = this.sprite.y;

        text.x += Sprite.rand(-10, 10);

        Game.layers.actorLayer.appendChild(text);

        var speed = Sprite.rand(1, 3);

        Sprite.Ticker.whiles(100, function (last) {
          text.y -= speed;
          if (last) {
            Game.layers.actorLayer.removeChild(text);
          }
        });

        // 测试是否死亡
        this.dead(attacker);
      }

      /** 播放一个动画 */
    }, {
      key: "play",
      value: function play(animation, priority) {
        // 新动画默认优先级为0
        if (!Number.isFinite(priority)) {
          priority = 0;
        }

        // 无动画或者停止状态，现有优先级为-1（最低级）
        if (typeof this.animationPriority == "undefined" || this.sprite.paused == true) {
          this.animationPriority = -1;
        }

        if (this.data.animations.hasOwnProperty(animation) && priority >= this.animationPriority && animation != this.sprite.currentAnimation) {
          this.animationPriority = priority;
          this.sprite.play(animation);
        }
      }

      /** 停止 */
    }, {
      key: "stop",
      value: function stop() {
        if (!this.sprite.currentAnimation) return;

        if (this.sprite.paused && !this.sprite.currentAnimation.match(/face/) || this.sprite.currentAnimation.match(/walk|run/)) {
          switch (this.direction) {
            case "up":
              this.sprite.play("faceup");
              break;
            case "down":
              this.sprite.play("facedown");
              break;
            case "left":
              this.sprite.play("faceleft");
              break;
            case "right":
              this.sprite.play("faceright");
              break;
          }
        }
      }

      /** 向指定direction方向释放一个技能 */
    }, {
      key: "fire",
      value: function fire(id, direction) {
        var _this5 = this;

        // 同一时间只能施展一个skill
        if (this.attacking) return 0;

        var skill = Game.skills[id];
        if (!skill) return 0;

        // 只有当这个skill的cooldown结
        var now = new Date().getTime();
        if (Number.isFinite(this.lastAttack) && Number.isFinite(this.lastAttackCooldown) && now - this.lastAttack < this.lastAttackCooldown) {
          return 0;
        }

        if (skill.data.cost > this.data.sp) {
          return 0;
        }

        if (!direction) {
          direction = this.direction;
        }

        if ( // 玩家使用技能是可能有条件的，例如剑技能需要装备剑
        this.type == "hero" && skill.data.condition && skill.data.condition() == false) {
          return 0;
        }

        this.lastAttack = now;
        this.lastAttackCooldown = skill.data.cooldown;
        this.attacking = true;

        this.data.sp -= skill.data.cost;
        this.refreshBar();

        skill.fire(this, direction, function (hitted) {
          _this5.attacking = false;
          if (hitted.length > 0) {
            hitted[0].damage(_this5, skill);
          }
          _this5.emit("change");
        });

        return skill.data.cooldown;
      }

      /** 行走到指定地点 */
    }, {
      key: "goto",
      value: function goto(x, y, state, callback) {
        var _this6 = this;

        if (this.going) {
          this.goingNext = function () {
            _this6.goto(x, y, state, callback);
          };
          return false;
        }

        var destBlocked = this.checkCollision(x, y);

        if (destBlocked) {
          if (this.x == x) {
            if (this.y - y == -1) {
              this.stop();
              this.face("down");
              if (callback) callback();
              return false;
            } else if (this.y - y == 1) {
              this.stop();
              this.face("up");
              if (callback) callback();
              return false;
            }
          } else if (this.y == y) {
            if (this.x - x == -1) {
              this.stop();
              this.face("right");
              if (callback) callback();
              return false;
            } else if (this.x - x == 1) {
              this.stop();
              this.face("left");
              if (callback) callback();
              return false;
            }
          }
        }

        var positionChoice = [];
        // 上下左右
        if (this.checkCollision(x, y - 1) == false) {
          positionChoice.push({ x: x, y: y - 1, after: "down" });
        }
        if (this.checkCollision(x, y + 1) == false) {
          positionChoice.push({ x: x, y: y + 1, after: "up" });
        }
        if (this.checkCollision(x - 1, y) == false) {
          positionChoice.push({ x: x - 1, y: y, after: "right" });
        }
        if (this.checkCollision(x + 1, y) == false) {
          positionChoice.push({ x: x + 1, y: y, after: "left" });
        }

        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = positionChoice[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var element = _step2.value;
            // 计算地址距离
            element.distance = this.distance(element.x, element.y);
          }

          // 按照地址的距离从近到远排序（从小到大）
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
              _iterator2["return"]();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }

        positionChoice.sort(function (a, b) {
          return a.distance - b.distance;
        });

        // 如果真正的目的地有可能走，插入到第一位，写在这里是因为目的地并不一定是distance最小的
        if (this.checkCollision(x, y) == false) {
          positionChoice.splice(0, 0, { x: x, y: y });
        }

        var index = 0;
        var otherChoice = false;

        var TestPosition = function TestPosition() {
          if (index < positionChoice.length) {
            (function () {
              var dest = positionChoice[index]; // 保存第一个选项
              index++;
              Game.Astar.getPath({ x: _this6.x, y: _this6.y }, dest, function (result) {
                _this6.gettingPath = false;
                if (_this6.goingNext) {
                  var c = _this6.goingNext;
                  _this6.goingNext = null;
                  _this6.going = false;
                  if (_this6 == Game.hero) {
                    Game.Input.clearDest();
                  }
                  c();
                  return false;
                }
                if (_this6.going) {
                  return false;
                }
                if (result) {
                  if (_this6 == Game.hero) {
                    Game.Input.setDest(dest.x, dest.y);
                  } else {
                    // not hero
                    if (result.length > 30) {
                      // too far
                      return false;
                    }
                  }
                  _this6.gotoPath(result, state, dest.after, callback);
                  return true;
                } else {
                  return TestPosition();
                }
              });
            })();
          } else {
            if (otherChoice == false) {
              otherChoice = true;
              var otherPositionChoice = [];
              // 四个角
              if (_this6.checkCollision(x - 1, y - 1) == false) {
                otherPositionChoice.push({ x: x - 1, y: y - 1, after: "right" });
              }
              if (_this6.checkCollision(x + 1, y - 1) == false) {
                otherPositionChoice.push({ x: x + 1, y: y - 1, after: "left" });
              }
              if (_this6.checkCollision(x - 1, y + 1) == false) {
                otherPositionChoice.push({ x: x - 1, y: y + 1, after: "right" });
              }
              if (_this6.checkCollision(x + 1, y + 1) == false) {
                otherPositionChoice.push({ x: x + 1, y: y + 1, after: "left" });
              }
              // 四个远方向
              if (_this6.checkCollision(x, y - 2) == false) {
                otherPositionChoice.push({ x: x, y: y - 2, after: "down" });
              }
              if (_this6.checkCollision(x, y + 2) == false) {
                otherPositionChoice.push({ x: x, y: y + 2, after: "up" });
              }
              if (_this6.checkCollision(x - 2, y) == false) {
                otherPositionChoice.push({ x: x - 2, y: y, after: "right" });
              }
              if (_this6.checkCollision(x + 2, y) == false) {
                otherPositionChoice.push({ x: x + 2, y: y, after: "left" });
              }

              var _iteratorNormalCompletion3 = true;
              var _didIteratorError3 = false;
              var _iteratorError3 = undefined;

              try {
                for (var _iterator3 = otherPositionChoice[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                  var element = _step3.value;
                  // 计算地址距离
                  element.distance = _this6.distance(element.x, element.y);
                }

                // 按照地址的距离从近到远排序（从小到大）
              } catch (err) {
                _didIteratorError3 = true;
                _iteratorError3 = err;
              } finally {
                try {
                  if (!_iteratorNormalCompletion3 && _iterator3["return"]) {
                    _iterator3["return"]();
                  }
                } finally {
                  if (_didIteratorError3) {
                    throw _iteratorError3;
                  }
                }
              }

              otherPositionChoice.sort(function (a, b) {
                return a.distance - b.distance;
              });

              if (otherPositionChoice.length) {
                index = 0;
                positionChoice = otherPositionChoice;
                TestPosition();
              }
            }
          } // 再次尝试离地点最近的地点
        };

        return TestPosition();
      }
    }, {
      key: "gotoPath",
      value: function gotoPath(path, state, after, callback) {
        var _this7 = this;

        this.going = true;
        var index = 1;
        var Walk = function Walk() {
          if (Game.paused) {
            _this7.stop();
            _this7.going = false;
            if (_this7 == Game.hero) {
              Game.Input.clearDest();
            }
            return;
          }
          if (_this7.goingNext) {
            var c = _this7.goingNext;
            _this7.goingNext = null;
            _this7.going = false;
            if (_this7 == Game.hero) {
              Game.Input.clearDest();
            }
            c();
            return;
          }

          if (index < path.length) {
            var current = { x: _this7.x, y: _this7.y };
            var dest = path[index];
            var direction = null;
            if (dest.x == current.x) {
              if (dest.y > current.y) {
                direction = "down";
              } else if (dest.y < current.y) {
                direction = "up";
              }
            } else if (dest.y == current.y) {
              if (dest.x > current.x) {
                direction = "right";
              } else if (dest.x < current.x) {
                direction = "left";
              }
            }

            if (direction) {
              var currentDirection = _this7.direction;
              if (direction != currentDirection) {
                _this7.stop();
                _this7.face(direction);
              }
              var goResult = _this7.go(state, direction, function () {
                return Walk();
              });
              if (goResult != true) {
                _this7.going = false;
              }
              index++;
            }
          } else {
            // 正常结束
            if (after) {
              _this7.stop();
              _this7.face(after);
            }
            if (_this7 == Game.hero) {
              Game.Input.clearDest();
            }
            _this7.going = false;
            if (callback) callback();
          }
        };
        Walk();
      }
    }, {
      key: "face",
      value: function face(direction) {
        var animation = "face" + direction;
        if (this.animation != animation) {
          this.sprite.play(animation);
          this.emit("change");
        }
      }

      // 参数t中记录了某个方格的方位xy，测试这个方格是否和玩家有冲突
      // 返回true为有碰撞，返回false为无碰撞
    }, {
      key: "checkCollision",
      value: function checkCollision(x, y) {
        // 地图边缘碰撞
        if (x < 0 || y < 0 || x >= Game.area.map.data.width || y >= Game.area.map.data.height) {
          return true;
        }
        // 地图碰撞
        if (Game.area.map.hitTest(x, y)) {
          return true;
        }

        // 角色碰撞
        if (Game.area.actors) {
          var _iteratorNormalCompletion4 = true;
          var _didIteratorError4 = false;
          var _iteratorError4 = undefined;

          try {
            for (var _iterator4 = Game.area.actors[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
              var actor = _step4.value;

              if (actor != this && actor.hitTest(x, y)) {
                return true;
              }
            }
          } catch (err) {
            _didIteratorError4 = true;
            _iteratorError4 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion4 && _iterator4["return"]) {
                _iterator4["return"]();
              }
            } finally {
              if (_didIteratorError4) {
                throw _iteratorError4;
              }
            }
          }
        }

        if (Game.area.items) {
          var _iteratorNormalCompletion5 = true;
          var _didIteratorError5 = false;
          var _iteratorError5 = undefined;

          try {
            for (var _iterator5 = Game.area.items[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
              var item = _step5.value;

              if (item.hitTest(x, y)) {
                return true;
              }
            }
          } catch (err) {
            _didIteratorError5 = true;
            _iteratorError5 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion5 && _iterator5["return"]) {
                _iterator5["return"]();
              }
            } finally {
              if (_didIteratorError5) {
                throw _iteratorError5;
              }
            }
          }
        }

        return false;
      }
    }, {
      key: "hitTest",
      value: function hitTest(x, y) {
        if (this.data.hitArea && this.data.hitArea instanceof Array) {
          var _iteratorNormalCompletion6 = true;
          var _didIteratorError6 = false;
          var _iteratorError6 = undefined;

          try {
            for (var _iterator6 = this.data.hitArea[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
              var p = _step6.value;

              if (x == this.x + p[0] && y == this.y + p[1]) {
                return true;
              }
            }
          } catch (err) {
            _didIteratorError6 = true;
            _iteratorError6 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion6 && _iterator6["return"]) {
                _iterator6["return"]();
              }
            } finally {
              if (_didIteratorError6) {
                throw _iteratorError6;
              }
            }
          }

          return false;
        } else {
          console.error(this.data);
          throw new Error("Game.Actor.hitTest invalid data");
        }
      }
    }, {
      key: "go",
      value: function go(state, direction) {
        var _this8 = this;

        var callback = arguments.length <= 2 || arguments[2] === undefined ? null : arguments[2];

        if (Game.paused) {
          return false;
        }

        // 如果正在战斗动画，则不走
        if (this.sprite.paused == false && this.sprite.currentAnimation.match(/skillcast|thrust|slash|shoot/)) {
          return false;
        }

        if (this.walking) {
          return false;
        }

        if (this.attacking) {
          return false;
        }

        if (this.direction != direction) {
          this.walking = true;
          this.stop();
          this.face(direction);
          // wait 4 ticks
          Sprite.Ticker.after(4, function () {
            _this8.walking = false;
          });
          return false;
        }

        var newPosition = this.facePosition;

        if (this.checkCollision(newPosition.x, newPosition.y) == false) {
          var _ret3 = (function () {
            // 没碰撞，开始行走
            _this8.walking = true;

            // 把角色位置设置为新位置，为了占领这个位置，这样其他角色就会碰撞
            // 但是不能用this.x = newX这样设置，因为this.x的设置会同时设置this.sprite.x
            var oldX = _this8.data.x;
            var oldY = _this8.data.y;
            _this8.data.x = newPosition.x;
            _this8.data.y = newPosition.y;

            // walk
            // 这些数组和必须是32，为了保证一次go行走32个像素
            var speed = [3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2]; // 和是32
            if (state == "run") {
              // speed = [6,7,6,7,6]; // 和是32
              speed = [4, 4, 4, 4, 4, 4, 4, 4]; // 和是32
            }
            // 比预计多一个，这样是为了流畅
            // 因为下一次go可能紧挨着这次
            var times = speed.length + 1;

            var whilesId = Sprite.Ticker.whiles(times, function (last) {
              if (Game.paused) {
                _this8.data.x = oldX;
                _this8.data.y = oldY;
                _this8.walking = false;
                _this8.emit("change");
                Sprite.Ticker.clearWhiles(whilesId);
                if (callback) {
                  callback();
                }
                return;
              }

              if (last) {
                _this8.x = newPosition.x;
                _this8.y = newPosition.y;
                _this8.walking = false;
                _this8.emit("change");

                if (callback) {
                  callback();
                }
              } else {
                switch (direction) {
                  case "up":
                    _this8.sprite.y -= speed.pop();
                    break;
                  case "down":
                    _this8.sprite.y += speed.pop();
                    break;
                  case "left":
                    _this8.sprite.x -= speed.pop();
                    break;
                  case "right":
                    _this8.sprite.x += speed.pop();
                    break;
                }
              }
            });

            // 播放行走动画
            _this8.play(state + direction, 1);
            return {
              v: true
            };
          })();

          if (typeof _ret3 === "object") return _ret3.v;
        }

        return false;
      }

      /** 在Game.actorLayer上删除人物 */
    }, {
      key: "erase",
      value: function erase() {
        var privates = internal(this);
        Game.layers.actorLayer.removeChild(this.sprite);
        Game.layers.infoLayer.removeChild(privates.infoBox);
      }

      /** 在Game.actorLayer上显示人物 */
    }, {
      key: "draw",
      value: function draw() {
        var privates = internal(this);
        if (Number.isInteger(this.x) && Number.isInteger(this.y)) {
          this.x = this.data.x;
          this.y = this.data.y;

          internal(this).infoBox.x = this.sprite.x;
          internal(this).infoBox.y = this.sprite.y - this.sprite.centerY - 20;

          Game.layers.actorLayer.appendChild(this.sprite);
          Game.layers.infoLayer.appendChild(privates.infoBox);
        } else {
          console.error(this.data.x, this.data.y, this.data);
          throw new Error("Game.Actor.draw invalid data.x/data.y");
        }
      }

      /** 镜头集中 */
    }, {
      key: "focus",
      value: function focus() {
        var privates = internal(this);
        privates.infoBox.x = this.sprite.x;
        privates.infoBox.y = this.sprite.y - this.sprite.centerY - 20;

        Game.stage.centerX = Math.round(this.sprite.x - Game.config.width / 2);
        Game.stage.centerY = Math.round(this.sprite.y - Game.config.height / 2);
      }
    }, {
      key: "data",
      get: function get() {
        var privates = internal(this);
        return privates.data;
      },
      set: function set(value) {
        throw new Error("Game.Actor.data readonly");
      }
    }, {
      key: "id",
      get: function get() {
        return internal(this).data.id;
      },
      set: function set(value) {
        throw new Error("Game.Actor.id readonly");
      }
    }, {
      key: "type",
      get: function get() {
        return internal(this).data.type;
      },
      set: function set(value) {
        throw new Error("Game.Actor.type readonly");
      }
    }, {
      key: "sprite",
      get: function get() {
        var privates = internal(this);
        return privates.sprite;
      },
      set: function set(value) {
        throw new Error("Game.Actor.sprite readonly");
      }
    }, {
      key: "quest",
      get: function get() {
        var privates = internal(this);
        if (privates.quest) {
          return privates.quest;
        } else {
          return null;
        }
      },
      set: function set(value) {
        throw new Error("Game.Actor.quests readonly");
      }
    }, {
      key: "x",
      get: function get() {
        return this.data.x;
      },
      set: function set(value) {
        if (Number.isFinite(value) && Number.isInteger(value)) {
          this.data.x = value;
          this.sprite.x = value * 32 + 16;
        } else {
          console.error(value, internal(this), this);
          throw new Error("Game.Actor got invalid x, x has to be a number and integer");
        }
      }
    }, {
      key: "y",
      get: function get() {
        return this.data.y;
      },
      set: function set(value) {
        if (Number.isFinite(value) && Number.isInteger(value)) {
          this.data.y = value;
          this.sprite.y = value * 32 + 16;
        } else {
          console.error(value, internal(this), this);
          throw new Error("Game.Actor got invalid y, y has to be a number and integer");
        }
      }
    }, {
      key: "visible",
      get: function get() {
        return this.sprite.visible;
      },
      set: function set(value) {
        this.sprite.visible = value;
        internal(this).infoBox.visible = value;
      }
    }, {
      key: "alpha",
      get: function get() {
        return this.sprite.alpha;
      },
      set: function set(value) {
        if (Number.isFinite(value) && value >= 0 && value <= 1) {
          this.sprite.alpha = value;
          internal(this).infoBox.alpha = value;
        } else {
          console.error(value, this);
          throw new Error("Game.Actor.alpha got invalid value");
        }
      }
    }, {
      key: "position",
      get: function get() {
        return {
          x: this.x,
          y: this.y
        };
      },
      set: function set(value) {
        throw new Error("Game.Actor.position readonly");
      }
    }, {
      key: "direction",
      get: function get() {
        return this.sprite.currentAnimation.match(/up|left|down|right/)[0];
      },
      set: function set(value) {
        throw new Error("Game.Actor.direction readonly");
      }
    }, {
      key: "facePosition",
      get: function get() {
        var p = this.position;
        switch (this.direction) {
          case "up":
            p.y -= 1;
            break;
          case "down":
            p.y += 1;
            break;
          case "left":
            p.x -= 1;
            break;
          case "right":
            p.x += 1;
            break;
        }
        return p;
      },
      set: function set(value) {
        throw new Error("Game.Actor.facePosition readonly");
      }
    }]);

    return Actor;
  })(Sprite.Event)); // Game.Actor
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVBY3Rvci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7Ozs7OztBQU9sQyxNQUFJLENBQUMsTUFBTSxDQUFDLE9BQU87Y0FBUSxLQUFLOztpQkFBTCxLQUFLOzthQUVsQixjQUFDLEVBQUUsRUFBRTtBQUNmLGVBQU8sSUFBSSxPQUFPLENBQUMsVUFBVSxPQUFPLEVBQUUsTUFBTSxFQUFFO0FBQzVDLGdCQUFNLENBQUMsSUFBSSxZQUFVLEVBQUUsU0FBTSxDQUFDLElBQUksQ0FBQyxVQUFVLElBQUksRUFBRTtBQUNqRCxnQkFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFDMUIscUJBQVMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDOztBQUVsQixnQkFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDO0FBQ3BCLGdCQUFJLFNBQVMsQ0FBQyxJQUFJLElBQUksS0FBSyxFQUFFO0FBQzNCLHNCQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2FBQ3pDLE1BQU0sSUFBSSxTQUFTLENBQUMsSUFBSSxJQUFJLFNBQVMsRUFBRTtBQUN0QyxzQkFBUSxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQzthQUM3QyxNQUFNLElBQUksU0FBUyxDQUFDLElBQUksSUFBSSxNQUFNLEVBQUU7QUFDbkMsc0JBQVEsR0FBRyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7YUFDMUMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxJQUFJLElBQUksS0FBSyxFQUFFO0FBQ2xDLHNCQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFD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LEVBQUUsQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztlQUM1RDtBQUNELGtCQUFJLE9BQUssY0FBYyxDQUFDLENBQUMsR0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssRUFBRTtBQUMxQyxtQ0FBbUIsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQztlQUMzRDtBQUNELGtCQUFJLE9BQUssY0FBYyxDQUFDLENBQUMsR0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssRUFBRTtBQUMxQyxtQ0FBbUIsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztlQUM1RDtBQUNELGtCQUFJLE9BQUssY0FBYyxDQUFDLENBQUMsR0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssRUFBRTtBQUMxQyxtQ0FBbUIsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQztlQUMzRDs7QUFFRCxrQkFBSSxPQUFLLGNBQWMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssRUFBRTtBQUN4QyxtQ0FBbUIsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUMsQ0FB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QUNqRDs7O1dBRWEsZUFBRztBQUNmLGVBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztPQUNwRTtXQUVhLGFBQUMsS0FBSyxFQUFFO0FBQ3BCLGNBQU0sSUFBSSxLQUFLLENBQUMsK0JBQStCLENBQUMsQ0FBQztPQUNsRDs7O1dBRWdCLGVBQUc7QUFDbEIsWUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztBQUN0QixnQkFBUSxJQUFJLENBQUMsU0FBUztBQUNwQixlQUFLLElBQUk7QUFDUCxhQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNULGtCQUFNO0FBQUEsQUFDUixlQUFLLE1BQU07QUFDVCxhQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNULGtCQUFNO0FBQUEsQUFDUixlQUFLLE1BQU07QUFDVCxhQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNULGtCQUFNO0FBQUEsQUFDUixlQUFLLE9BQU87QUFDVixhQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNULGtCQUFNO0FBQUEsU0FDVDtBQUNELGVBQU8sQ0FBQyxDQUFDO09BQ1Y7V0FFZ0IsYUFBQyxLQUFLLEVBQUU7QUFDdkIsY0FBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO09BQ3JEOzs7V0E3WndCLEtBQUs7S0FBUyxNQUFNLENBQUMsS0FBSyxFQTBsQ25ELENBQUM7Q0FFSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lQWN0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgaW50ZXJuYWwgPSBTcHJpdGUuTmFtZXNwYWNlKCk7XG5cbiAgLypcbiAgICDop5LoibLnsbvvvIzljIXmi6zmtonlj4rliLBoZXJv5ZKMbnBjXG4gICAg5bGe5oCn77yaXG4gICAgICB0aGlzLnNwcml0ZSDnsr7ngbVcbiAgKi9cbiAgR2FtZS5hc3NpZ24oXCJBY3RvclwiLCBjbGFzcyBBY3RvciBleHRlbmRzIFNwcml0ZS5FdmVudCB7XG5cbiAgICBzdGF0aWMgbG9hZCAoaWQpIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIFNwcml0ZS5sb2FkKGBhY3Rvci8ke2lkfS5qc2ApLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBsZXQgYWN0b3JEYXRhID0gZGF0YVswXSgpO1xuICAgICAgICAgIGFjdG9yRGF0YS5pZCA9IGlkO1xuXG4gICAgICAgICAgbGV0IGFjdG9yT2JqID0gbnVsbDtcbiAgICAgICAgICBpZiAoYWN0b3JEYXRhLnR5cGUgPT0gXCJucGNcIikge1xuICAgICAgICAgICAgYWN0b3JPYmogPSBuZXcgR2FtZS5BY3Rvck5QQyhhY3RvckRhdGEpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoYWN0b3JEYXRhLnR5cGUgPT0gXCJtb25zdGVyXCIpIHtcbiAgICAgICAgICAgIGFjdG9yT2JqID0gbmV3IEdhbWUuQWN0b3JNb25zdGVyKGFjdG9yRGF0YSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChhY3RvckRhdGEudHlwZSA9PSBcImFsbHlcIikge1xuICAgICAgICAgICAgYWN0b3JPYmogPSBuZXcgR2FtZS5BY3RvckFsbHkoYWN0b3JEYXRhKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGFjdG9yRGF0YS50eXBlID09IFwicGV0XCIpIHtcbiAgICAgICAgICAgIGFjdG9yT2JqID0gbmV3IEdhbWUuQWN0b3JQZXQoYWN0b3JEYXRhKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihhY3RvckRhdGEudHlwZSwgYWN0b3JEYXRhKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuQWN0b3IubG9hZCBpbnZhbGlkIGFjdG9yIHR5cGVcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGFjdG9yT2JqLm9uKFwiY29tcGxldGVcIiwgKCkgPT4ge1xuICAgICAgICAgICAgcmVzb2x2ZShhY3Rvck9iaik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICBjb25zdHJ1Y3RvciAoYWN0b3JEYXRhKSB7XG4gICAgICBzdXBlcigpO1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG5cbiAgICAgIHByaXZhdGVzLmRhdGEgPSBhY3RvckRhdGE7XG5cbiAgICAgIHRoaXMubWFrZUluZm9Cb3goKTtcblxuICAgICAgaWYgKHRoaXMuZGF0YS5pbWFnZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIHRoaXMuaW5pdCh0aGlzLmRhdGEuaW1hZ2UpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy5kYXRhLmltYWdlID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgU3ByaXRlLmxvYWQoXCJhY3Rvci9cIiArIHRoaXMuZGF0YS5pbWFnZSkudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgIC8vIGRhdGEgaXMgQXJyYXlcbiAgICAgICAgICB0aGlzLmluaXQoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih0aGlzLmlkLCB0aGlzLmRhdGEsIHRoaXMuZGF0YS5pbWFnZSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgQWN0b3IgSW1hZ2VcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaW5pdCAoaW1hZ2VzKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGxldCBkYXRhID0gcHJpdmF0ZXMuZGF0YTtcblxuICAgICAgZm9yIChsZXQgaW1hZ2Ugb2YgaW1hZ2VzKSB7XG4gICAgICAgIGlmICghKGltYWdlIGluc3RhbmNlb2YgSW1hZ2UpICYmICEoaW1hZ2UuZ2V0Q29udGV4dCAmJiBpbWFnZS5nZXRDb250ZXh0KFwiMmRcIikpKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihpbWFnZSwgaW1hZ2VzLCB0aGlzKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLkFjdG9yIGdvdCBpbnZhbGlkIGltYWdlLCBub3QgSW1hZ2Ugb3IgQ2FudmFzXCIpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBsZXQgc3ByaXRlID0gbmV3IFNwcml0ZS5TaGVldCh7XG4gICAgICAgIGltYWdlczogaW1hZ2VzLCAvLyBpbWFnZXMgaXMgQXJyYXlcbiAgICAgICAgd2lkdGg6IGRhdGEudGlsZXdpZHRoLFxuICAgICAgICBoZWlnaHQ6IGRhdGEudGlsZWhlaWdodCxcbiAgICAgICAgYW5pbWF0aW9uczogZGF0YS5hbmltYXRpb25zXG4gICAgICB9KTtcblxuICAgICAgaWYgKFxuICAgICAgICBOdW1iZXIuaXNJbnRlZ2VyKGRhdGEuY2VudGVyWCkgJiZcbiAgICAgICAgTnVtYmVyLmlzSW50ZWdlcihkYXRhLmNlbnRlclkpXG4gICAgICApIHtcbiAgICAgICAgc3ByaXRlLmNlbnRlclggPSBkYXRhLmNlbnRlclg7XG4gICAgICAgIHNwcml0ZS5jZW50ZXJZID0gZGF0YS5jZW50ZXJZO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuQWN0b3IgaW52YWxpZCBjZW50ZXJYL2NlbnRlcllcIik7XG4gICAgICB9XG5cbiAgICAgIHNwcml0ZS5wbGF5KFwiZmFjZWRvd25cIik7XG4gICAgICBwcml2YXRlcy5zcHJpdGUgPSBzcHJpdGU7XG5cbiAgICAgIHNwcml0ZS5vbihcImNoYW5nZVwiLCAoKSA9PiB7XG4gICAgICAgIHByaXZhdGVzLmluZm9Cb3gueCA9IHNwcml0ZS54O1xuICAgICAgICBwcml2YXRlcy5pbmZvQm94LnkgPSBzcHJpdGUueSAtIHNwcml0ZS5jZW50ZXJZIC0gMjBcbiAgICAgIH0pO1xuXG4gICAgICBsZXQgY29tcGxldGVDb3VudCA9IC0xO1xuICAgICAgbGV0IENvbXBsZXRlID0gKCkgPT4ge1xuICAgICAgICBjb21wbGV0ZUNvdW50Kys7XG4gICAgICAgIGlmIChjb21wbGV0ZUNvdW50ID49IDApIHtcbiAgICAgICAgICB0aGlzLmNhbGN1bGF0ZSgpO1xuICAgICAgICAgIHRoaXMucmVmcmVzaEJhcigpO1xuICAgICAgICAgIHRoaXMuZW1pdChcImNvbXBsZXRlXCIsIHRydWUpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICAvLyDliqDovb1OUEPlj6/og73mnInnmoTku7vliqFcbiAgICAgIGlmIChkYXRhLnF1ZXN0KSB7XG4gICAgICAgIHByaXZhdGVzLnF1ZXN0ID0gW107XG4gICAgICAgIHByaXZhdGVzLnF1ZXN0Lmxlbmd0aCA9IGRhdGEucXVlc3QubGVuZ3RoO1xuICAgICAgICBkYXRhLnF1ZXN0LmZvckVhY2goKHF1ZXN0SWQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgY29tcGxldGVDb3VudC0tO1xuXG4gICAgICAgICAgR2FtZS5RdWVzdC5sb2FkKHF1ZXN0SWQpLnRoZW4oKHF1ZXN0RGF0YSkgPT4ge1xuICAgICAgICAgICAgcHJpdmF0ZXMucXVlc3QucHVzaChxdWVzdERhdGEpO1xuICAgICAgICAgICAgQ29tcGxldGUoKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8g5Yqg6L295Lq654mp5oqA6IO9XG4gICAgICBpZiAoZGF0YS5za2lsbHMpIHtcbiAgICAgICAgZGF0YS5za2lsbHMuZm9yRWFjaCgoc2tpbGxJZCkgPT4ge1xuICAgICAgICAgIGNvbXBsZXRlQ291bnQtLTtcbiAgICAgICAgICBHYW1lLlNraWxsLmxvYWQoc2tpbGxJZCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBDb21wbGV0ZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8g5Yqg6L295Lq654mp6KOF5aSH77yI5pqC5pe25Y+q5pyJ546p5a6277yJXG4gICAgICBpZiAoZGF0YS5lcXVpcG1lbnQpIHtcbiAgICAgICAgZm9yIChsZXQga2V5IGluIGRhdGEuZXF1aXBtZW50KSB7XG4gICAgICAgICAgbGV0IGl0ZW1JZCA9IGRhdGEuZXF1aXBtZW50W2tleV07XG4gICAgICAgICAgaWYgKGl0ZW1JZCkge1xuICAgICAgICAgICAgY29tcGxldGVDb3VudC0tO1xuICAgICAgICAgICAgR2FtZS5JdGVtLmxvYWQoaXRlbUlkKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgQ29tcGxldGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyDliqDovb3kurrniannianlk4FcbiAgICAgIGlmIChkYXRhLml0ZW1zKSB7XG4gICAgICAgIGZvciAobGV0IGl0ZW1JZCBpbiBkYXRhLml0ZW1zKSB7XG4gICAgICAgICAgY29tcGxldGVDb3VudC0tO1xuICAgICAgICAgIEdhbWUuSXRlbS5sb2FkKGl0ZW1JZCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBDb21wbGV0ZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIENvbXBsZXRlKCk7XG4gICAgfVxuXG4gICAgZ2V0IGRhdGEgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICByZXR1cm4gcHJpdmF0ZXMuZGF0YTtcbiAgICB9XG5cbiAgICBzZXQgZGF0YSAodmFsdWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuQWN0b3IuZGF0YSByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgaWQgKCkge1xuICAgICAgcmV0dXJuIGludGVybmFsKHRoaXMpLmRhdGEuaWQ7XG4gICAgfVxuXG4gICAgc2V0IGlkICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5BY3Rvci5pZCByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgdHlwZSAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuZGF0YS50eXBlO1xuICAgIH1cblxuICAgIHNldCB0eXBlICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5BY3Rvci50eXBlIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGdldCBzcHJpdGUgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICByZXR1cm4gcHJpdmF0ZXMuc3ByaXRlO1xuICAgIH1cblxuICAgIHNldCBzcHJpdGUgKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLkFjdG9yLnNwcml0ZSByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgcXVlc3QgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBpZiAocHJpdmF0ZXMucXVlc3QpIHtcbiAgICAgICAgcmV0dXJuIHByaXZhdGVzLnF1ZXN0O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfVxuXG4gICAgc2V0IHF1ZXN0ICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5BY3Rvci5xdWVzdHMgcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgcG9wdXAgKHRleHQpIHtcbiAgICAgIEdhbWUucG9wdXAodGhpcy5zcHJpdGUsIHRleHQsIDAsIC01MCk7XG4gICAgfVxuXG4gICAgbWFrZUluZm9Cb3ggKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICAvLyDlkI3lrZdcbiAgICAgIGxldCB0ZXh0ID0gbmV3IFNwcml0ZS5UZXh0KHtcbiAgICAgICAgdGV4dDogcHJpdmF0ZXMuZGF0YS5uYW1lLFxuICAgICAgICBtYXhXaWR0aDogMjAwLFxuICAgICAgICBjb2xvcjogXCJ3aGl0ZVwiLFxuICAgICAgICBmb250U2l6ZTogMTJcbiAgICAgIH0pO1xuICAgICAgdGV4dC5jZW50ZXJZID0gTWF0aC5mbG9vcih0ZXh0LmhlaWdodCAvIDIpO1xuICAgICAgdGV4dC5jZW50ZXJYID0gTWF0aC5mbG9vcih0ZXh0LndpZHRoIC8gMik7XG4gICAgICB0ZXh0LnggPSAwO1xuICAgICAgdGV4dC55ID0gMDtcblxuICAgICAgLy8g5LiA5Liq5LiK6Z2i5Zub5Liq57K+56We5p2h44CB6KGA5p2h55qE6IGa5ZCI77yM57uf5LiA566h55CG5pS+5YWl6L+Z5LiqQ29udGFpbmVyXG4gICAgICBwcml2YXRlcy5pbmZvQm94ID0gbmV3IFNwcml0ZS5Db250YWluZXIoKTtcblxuICAgICAgaWYgKHByaXZhdGVzLmRhdGEudHlwZSAhPSBcImhlcm9cIikge1xuICAgICAgICAvLyDooYDmnaHlpJbpnaLnmoTpu5HmoYZcbiAgICAgICAgbGV0IGhwYmFyQm94ID0gbmV3IFNwcml0ZS5TaGFwZSgpO1xuICAgICAgICBocGJhckJveC5jZW50ZXJYID0gMTU7XG4gICAgICAgIGhwYmFyQm94LmNlbnRlclkgPSAyO1xuICAgICAgICBocGJhckJveC54ID0gMDtcbiAgICAgICAgaHBiYXJCb3gueSA9IDk7XG5cbiAgICAgICAgLy8g6a2U5rOV5p2h5aSW6Z2i55qE6buR5qGGXG4gICAgICAgIGxldCBtcGJhckJveCA9IG5ldyBTcHJpdGUuU2hhcGUoKTtcbiAgICAgICAgbXBiYXJCb3guY2VudGVyWCA9IDE1O1xuICAgICAgICBtcGJhckJveC5jZW50ZXJZID0gMjtcbiAgICAgICAgbXBiYXJCb3gueCA9IDA7XG4gICAgICAgIG1wYmFyQm94LnkgPSAxMjtcblxuICAgICAgICBocGJhckJveC5yZWN0KHtcbiAgICAgICAgICB4OiAwLFxuICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgd2lkdGg6IDMwLFxuICAgICAgICAgIGhlaWdodDogMyxcbiAgICAgICAgICBcImZpbGwtb3BhY2l0eVwiOiAwXG4gICAgICAgIH0pO1xuXG4gICAgICAgIG1wYmFyQm94LnJlY3Qoe1xuICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgeTogMCxcbiAgICAgICAgICB3aWR0aDogMzAsXG4gICAgICAgICAgaGVpZ2h0OiAzLFxuICAgICAgICAgIFwiZmlsbC1vcGFjaXR5XCI6IDBcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8g55Sf5ZG95p2hXG4gICAgICAgIHByaXZhdGVzLmhwYmFyID0gbmV3IFNwcml0ZS5TaGFwZSgpO1xuICAgICAgICBwcml2YXRlcy5ocGJhci5jZW50ZXJYID0gMTU7XG4gICAgICAgIHByaXZhdGVzLmhwYmFyLmNlbnRlclkgPSAyO1xuICAgICAgICBwcml2YXRlcy5ocGJhci54ID0gMDtcbiAgICAgICAgcHJpdmF0ZXMuaHBiYXIueSA9IDk7XG5cbiAgICAgICAgLy8g57K+5Yqb5p2hXG4gICAgICAgIHByaXZhdGVzLm1wYmFyID0gbmV3IFNwcml0ZS5TaGFwZSgpO1xuICAgICAgICBwcml2YXRlcy5tcGJhci5jZW50ZXJYID0gMTU7XG4gICAgICAgIHByaXZhdGVzLm1wYmFyLmNlbnRlclkgPSAyO1xuICAgICAgICBwcml2YXRlcy5tcGJhci54ID0gMDtcbiAgICAgICAgcHJpdmF0ZXMubXBiYXIueSA9IDEyO1xuXG4gICAgICAgIHByaXZhdGVzLmluZm9Cb3guYXBwZW5kQ2hpbGQoXG4gICAgICAgICAgdGV4dCxcbiAgICAgICAgICBocGJhckJveCxcbiAgICAgICAgICBtcGJhckJveCxcbiAgICAgICAgICBwcml2YXRlcy5ocGJhcixcbiAgICAgICAgICBwcml2YXRlcy5tcGJhclxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNhbGN1bGF0ZSAoKSB7XG4gICAgICBsZXQgZGF0YSA9IGludGVybmFsKHRoaXMpLmRhdGE7XG4gICAgICBpZiAoXG4gICAgICAgIGRhdGEuJHN0ciAmJlxuICAgICAgICBkYXRhLiRkZXggJiZcbiAgICAgICAgZGF0YS4kY29uICYmXG4gICAgICAgIGRhdGEuJGludCAmJlxuICAgICAgICBkYXRhLiRjaGFcbiAgICAgICkge1xuXG4gICAgICAgIGRhdGEuc3RyID0gZGF0YS4kc3RyO1xuICAgICAgICBkYXRhLmRleCA9IGRhdGEuJGRleDtcbiAgICAgICAgZGF0YS5jb24gPSBkYXRhLiRjb247XG4gICAgICAgIGRhdGEuaW50ID0gZGF0YS4kaW50O1xuICAgICAgICBkYXRhLmNoYSA9IGRhdGEuJGNoYTtcblxuICAgICAgICAvLyDnhLblkI7lj6/ku6Xpkojlr7nkuIDnuqflsZ7mgKforqHnrpdidWZmXG5cblxuICAgICAgICAvLyDorqHnrpflrozkuIDnuqflsZ7mgKfnmoRidWZm5LmL5ZCO77yM5byA5aeL6K6h566X5LqM57qn5bGe5oCnXG5cbiAgICAgICAgZGF0YS4kaHAgPSBkYXRhLmNvbiAqIDU7XG4gICAgICAgIGRhdGEuJHNwID0gZGF0YS5pbnQgKiA1O1xuXG4gICAgICAgIGRhdGEuYXRrID0gTWF0aC5mbG9vcihkYXRhLnN0ciAqIDAuMjUpO1xuICAgICAgICBkYXRhLm1hdGsgPSBNYXRoLmZsb29yKGRhdGEuaW50ICogMC4yNSk7XG4gICAgICAgIGRhdGEuZGVmID0gMDtcbiAgICAgICAgZGF0YS5tZGVmID0gMDtcbiAgICAgICAgZGF0YS5jcml0aWNhbCA9IGRhdGEuZGV4ICogMC4wMDU7XG4gICAgICAgIGRhdGEuZG9kZ2UgPSBkYXRhLmRleCAqIDAuMDA1O1xuXG4gICAgICAgIC8vIOeEtuWQjuWPr+S7peWvueS6jOe6p+WxnuaAp+iuoeeul2J1ZmZcblxuXG5cbiAgICAgICAgLy8g5a+55LqM57qn5bGe5oCn6K6h566X5a6MYnVmZuS5i+WQju+8jOWPr+S7peiuoeeul+S8muWPmOWKqOeahOWAvFxuICAgICAgICAvLyDkvovlpoIuJGhw5pivYnVmZuS5i+WQjueahOeUn+WRveWAvOS4iumZkO+8jC5ocOaYr+W9k+WJjeeUn+WRveWAvFxuICAgICAgICBkYXRhLmhwID0gZGF0YS4kaHA7XG4gICAgICAgIGRhdGEuc3AgPSBkYXRhLiRzcDtcblxuICAgICAgICBpZiAoZGF0YS5idWZmICYmIGRhdGEubmVyZikge1xuICAgICAgICAgIGRhdGEuYnVmZi5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG5cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBkYXRhLm5lcmYuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgeCAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5kYXRhLng7XG4gICAgfVxuXG4gICAgc2V0IHggKHZhbHVlKSB7XG4gICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKHZhbHVlKSAmJiBOdW1iZXIuaXNJbnRlZ2VyKHZhbHVlKSkge1xuICAgICAgICB0aGlzLmRhdGEueCA9IHZhbHVlO1xuICAgICAgICB0aGlzLnNwcml0ZS54ID0gdmFsdWUgKiAzMiArIDE2O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih2YWx1ZSwgaW50ZXJuYWwodGhpcyksIHRoaXMpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLkFjdG9yIGdvdCBpbnZhbGlkIHgsIHggaGFzIHRvIGJlIGEgbnVtYmVyIGFuZCBpbnRlZ2VyXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGdldCB5ICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmRhdGEueTtcbiAgICB9XG5cbiAgICBzZXQgeSAodmFsdWUpIHtcbiAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUodmFsdWUpICYmIE51bWJlci5pc0ludGVnZXIodmFsdWUpKSB7XG4gICAgICAgIHRoaXMuZGF0YS55ID0gdmFsdWU7XG4gICAgICAgIHRoaXMuc3ByaXRlLnkgPSB2YWx1ZSAqIDMyICsgMTY7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKHZhbHVlLCBpbnRlcm5hbCh0aGlzKSwgdGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuQWN0b3IgZ290IGludmFsaWQgeSwgeSBoYXMgdG8gYmUgYSBudW1iZXIgYW5kIGludGVnZXJcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHZpc2libGUgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3ByaXRlLnZpc2libGU7XG4gICAgfVxuXG4gICAgc2V0IHZpc2libGUgKHZhbHVlKSB7XG4gICAgICB0aGlzLnNwcml0ZS52aXNpYmxlID0gdmFsdWU7XG4gICAgICBpbnRlcm5hbCh0aGlzKS5pbmZvQm94LnZpc2libGUgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgYWxwaGEgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3ByaXRlLmFscGhhO1xuICAgIH1cblxuICAgIHNldCBhbHBoYSAodmFsdWUpIHtcbiAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUodmFsdWUpICYmIHZhbHVlID49IDAgJiYgdmFsdWUgPD0gMSkge1xuICAgICAgICB0aGlzLnNwcml0ZS5hbHBoYSA9IHZhbHVlO1xuICAgICAgICBpbnRlcm5hbCh0aGlzKS5pbmZvQm94LmFscGhhID0gdmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKHZhbHVlLCB0aGlzKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5BY3Rvci5hbHBoYSBnb3QgaW52YWxpZCB2YWx1ZVwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgcG9zaXRpb24gKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeDogdGhpcy54LFxuICAgICAgICB5OiB0aGlzLnlcbiAgICAgIH07XG4gICAgfVxuXG4gICAgc2V0IHBvc2l0aW9uICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5BY3Rvci5wb3NpdGlvbiByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICBnZXQgZGlyZWN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnNwcml0ZS5jdXJyZW50QW5pbWF0aW9uLm1hdGNoKC91cHxsZWZ0fGRvd258cmlnaHQvKVswXTtcbiAgICB9XG5cbiAgICBzZXQgZGlyZWN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5BY3Rvci5kaXJlY3Rpb24gcmVhZG9ubHlcIik7XG4gICAgfVxuXG4gICAgZ2V0IGZhY2VQb3NpdGlvbiAoKSB7XG4gICAgICBsZXQgcCA9IHRoaXMucG9zaXRpb247XG4gICAgICBzd2l0Y2ggKHRoaXMuZGlyZWN0aW9uKSB7XG4gICAgICAgIGNhc2UgXCJ1cFwiOlxuICAgICAgICAgIHAueSAtPSAxO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZG93blwiOlxuICAgICAgICAgIHAueSArPSAxO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibGVmdFwiOlxuICAgICAgICAgIHAueCAtPSAxO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwicmlnaHRcIjpcbiAgICAgICAgICBwLnggKz0gMTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIHJldHVybiBwO1xuICAgIH1cblxuICAgIHNldCBmYWNlUG9zaXRpb24gKHZhbHVlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLkFjdG9yLmZhY2VQb3NpdGlvbiByZWFkb25seVwiKTtcbiAgICB9XG5cbiAgICByZWZyZXNoQmFyICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuXG4gICAgICBpZiAocHJpdmF0ZXMuaHBiYXIgJiYgcHJpdmF0ZXMubXBiYXIpIHtcbiAgICAgICAgbGV0IGhwY29sb3IgPSBcImdyZWVuXCI7XG4gICAgICAgIGlmICgodGhpcy5kYXRhLmhwIC8gdGhpcy5kYXRhLiRocCkgPCAwLjI1KVxuICAgICAgICAgIGhwY29sb3IgPSBcInJlZFwiO1xuICAgICAgICBlbHNlIGlmICgodGhpcy5kYXRhLmhwIC8gdGhpcy5kYXRhLiRocCkgPCAwLjUpXG4gICAgICAgICAgaHBjb2xvciA9IFwieWVsbG93XCI7XG5cbiAgICAgICAgcHJpdmF0ZXMuaHBiYXIuY2xlYXIoKS5yZWN0KHtcbiAgICAgICAgICB4OiAxLFxuICAgICAgICAgIHk6IDEsXG4gICAgICAgICAgd2lkdGg6IE1hdGguZmxvb3IoKHRoaXMuZGF0YS5ocCAvIHRoaXMuZGF0YS4kaHApICogMjgpLFxuICAgICAgICAgIGhlaWdodDogMixcbiAgICAgICAgICBmaWxsOiBocGNvbG9yLFxuICAgICAgICAgIFwic3Ryb2tlLXdpZHRoXCI6IDBcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcHJpdmF0ZXMubXBiYXIuY2xlYXIoKS5yZWN0KHtcbiAgICAgICAgICB4OiAxLFxuICAgICAgICAgIHk6IDEsXG4gICAgICAgICAgd2lkdGg6IE1hdGguZmxvb3IoKHRoaXMuZGF0YS5zcCAvIHRoaXMuZGF0YS4kc3ApICogMjgpLFxuICAgICAgICAgIGhlaWdodDogMixcbiAgICAgICAgICBmaWxsOiBcImJsdWVcIixcbiAgICAgICAgICBcInN0cm9rZS13aWR0aFwiOiAwXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRpc3RhbmNlICgpIHtcbiAgICAgIGxldCB4ID0gbnVsbCwgeSA9IG51bGw7XG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAyICYmIE51bWJlci5pc0Zpbml0ZShhcmd1bWVudHNbMF0pICYmIE51bWJlci5pc0Zpbml0ZShhcmd1bWVudHNbMV0pKSB7XG4gICAgICAgIHggPSBhcmd1bWVudHNbMF07XG4gICAgICAgIHkgPSBhcmd1bWVudHNbMV07XG4gICAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSAmJiBOdW1iZXIuaXNGaW5pdGUoYXJndW1lbnRzWzBdLngpICYmIE51bWJlci5pc0Zpbml0ZShhcmd1bWVudHNbMF0ueSkpIHtcbiAgICAgICAgeCA9IGFyZ3VtZW50c1swXS54O1xuICAgICAgICB5ID0gYXJndW1lbnRzWzBdLnk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKGFyZ3VtZW50cyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdhbWUuQWN0b3IuZGlzdGFuY2UgSW52YWxpZCBhcmd1bWVudHNcIik7XG4gICAgICB9XG4gICAgICBsZXQgZCA9IDA7XG4gICAgICBkICs9IE1hdGgucG93KHRoaXMueCAtIHgsIDIpO1xuICAgICAgZCArPSBNYXRoLnBvdyh0aGlzLnkgLSB5LCAyKTtcbiAgICAgIGQgPSBNYXRoLnNxcnQoZCk7XG4gICAgICByZXR1cm4gZDtcbiAgICB9XG5cbiAgICBkZWNyZWFzZUhQIChwb3dlcikge1xuICAgICAgdGhpcy5kYXRhLmhwIC09IHBvd2VyO1xuICAgICAgdGhpcy5yZWZyZXNoQmFyKCk7XG4gICAgfVxuXG4gICAgZGVjcmVhc2VTUCAoc3ApIHtcbiAgICAgIHRoaXMuZGF0YS5zcCAtPSBzcDtcbiAgICAgIHRoaXMucmVmcmVzaEJhcigpO1xuICAgIH1cblxuICAgIGRlYWQgKGF0dGFja2VyKSB7XG4gICAgICBpZiAodGhpcy5kYXRhLmhwIDw9IDApIHtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS50eXBlID09IFwiaGVyb1wiKSB7XG4gICAgICAgICAgR2FtZS53aW5kb3dzLm92ZXIub3Blbihg5L2g6KKrJHthdHRhY2tlci5kYXRhLm5hbWV95omT5q275LqGYCk7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICB0aGlzLmVyYXNlKCk7XG4gICAgICAgICAgR2FtZS5hcmVhLmFjdG9ycy5kZWxldGUodGhpcyk7XG5cbiAgICAgICAgICBsZXQgaXRlbXMgPSB0aGlzLmRhdGEuaXRlbXMgfHwgeyBnb2xkOiAxIH07XG5cbiAgICAgICAgICBHYW1lLmFkZEJhZyh0aGlzLnggLHRoaXMueSkudGhlbigoYmFnKSA9PiB7XG4gICAgICAgICAgICBmb3IgKGxldCBpdGVtSWQgaW4gaXRlbXMpIHtcbiAgICAgICAgICAgICAgaWYgKGJhZy5pbm5lci5oYXNPd25Qcm9wZXJ0eShpdGVtSWQpKSB7XG4gICAgICAgICAgICAgICAgYmFnLmlubmVyW2l0ZW1JZF0gKz0gaXRlbXNbaXRlbUlkXTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBiYWcuaW5uZXJbaXRlbUlkXSA9IGl0ZW1zW2l0ZW1JZF07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGF0dGFja2VyLmVtaXQoXCJraWxsXCIsIGZhbHNlLCB0aGlzKTtcblxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqIOmXquS4gOmXquS6uueJqe+8jOS+i+Wmguiiq+WHu+S4reaXtueahOaViOaenCAqL1xuICAgIGZsYXNoICgpIHtcbiAgICAgIHRoaXMuc3ByaXRlLmFscGhhID0gMC41O1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuc3ByaXRlLmFscGhhID0gMTtcbiAgICAgIH0sIDIwMCk7XG4gICAgfVxuXG4gICAgLyoqIOWPl+WIsGF0dGFja2Vy55qEc2tpbGzmioDog73nmoTkvKTlrrMgKi9cbiAgICBkYW1hZ2UgKGF0dGFja2VyLCBza2lsbCkge1xuXG4gICAgICB0aGlzLmVtaXQoXCJkYW1hZ2VkXCIpO1xuXG4gICAgICBsZXQgcG93ZXIgPSBza2lsbC5wb3dlcjtcbiAgICAgIGxldCB0eXBlID0gc2tpbGwudHlwZTtcblxuICAgICAgbGV0IGNvbG9yID0gXCJ3aGl0ZVwiO1xuICAgICAgaWYgKHRoaXMuZGF0YS50eXBlID09IFwiaGVyb1wiKSB7XG4gICAgICAgIGNvbG9yID0gXCJyZWRcIjtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGUgPT0gXCJub3JtYWxcIikge1xuICAgICAgICBwb3dlciArPSBhdHRhY2tlci5kYXRhLmF0aztcbiAgICAgICAgcG93ZXIgLT0gdGhpcy5kYXRhLmRlZlxuICAgICAgICBwb3dlciA9IE1hdGgubWF4KDAsIHBvd2VyKTtcbiAgICAgIH0gZWxzZSB7IC8vIHR5cGUgPT0gbWFnaWNcbiAgICAgICAgcG93ZXIgKz0gYXR0YWNrZXIuZGF0YS5tYXRrO1xuICAgICAgICBwb3dlciAtIHRoaXMuZGF0YS5tZGVmXG4gICAgICAgIHBvd2VyID0gTWF0aC5tYXgoMCwgcG93ZXIpO1xuICAgICAgfVxuXG4gICAgICBsZXQgdGV4dCA9IG51bGw7XG4gICAgICBsZXQgc3RhdGUgPSBudWxsO1xuXG4gICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IHRoaXMuZGF0YS5kb2RnZSkgeyAvLyDpl6rpgb/kuoZcbiAgICAgICAgc3RhdGUgPSBcImRvZGdlXCI7XG4gICAgICAgIHRleHQgPSBuZXcgU3ByaXRlLlRleHQoe1xuICAgICAgICAgIHRleHQ6IFwibWlzc1wiLFxuICAgICAgICAgIGNvbG9yOiBjb2xvcixcbiAgICAgICAgICBmb250U2l6ZTogMTZcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKE1hdGgucmFuZG9tKCkgPCBhdHRhY2tlci5kYXRhLmNyaXRpY2FsKSB7IC8vIOmHjeWHu+S6hlxuICAgICAgICBzdGF0ZSA9IFwiY3JpdGljYWxcIjtcbiAgICAgICAgcG93ZXIgKj0gMjtcbiAgICAgICAgdGV4dCA9IG5ldyBTcHJpdGUuVGV4dCh7XG4gICAgICAgICAgdGV4dDogXCItXCIgKyBwb3dlcixcbiAgICAgICAgICBjb2xvcjogY29sb3IsXG4gICAgICAgICAgZm9udFNpemU6IDMyXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmZsYXNoKCk7XG4gICAgICAgIHRoaXMuZGVjcmVhc2VIUChwb3dlcik7XG4gICAgICB9IGVsc2UgeyAvLyDmma7pgJrlh7vkuK1cbiAgICAgICAgc3RhdGUgPSBcImhpdFwiO1xuICAgICAgICB0ZXh0ID0gbmV3IFNwcml0ZS5UZXh0KHtcbiAgICAgICAgICB0ZXh0OiBcIi1cIiArIHBvd2VyLFxuICAgICAgICAgIGNvbG9yOiBjb2xvcixcbiAgICAgICAgICBmb250U2l6ZTogMTZcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZmxhc2goKTtcbiAgICAgICAgdGhpcy5kZWNyZWFzZUhQKHBvd2VyKTtcbiAgICAgIH1cblxuICAgICAgLypcbiAgICAgIGlmIChzdGF0ZSAhPSBcImRvZGdlXCIgJiYgdGhpcyAhPSBHYW1lLmhlcm8pIHtcbiAgICAgICAgaWYgKEdhbWUuc291bmRzLmh1cnQpIHtcbiAgICAgICAgICBHYW1lLnNvdW5kcy5odXJ0LmxvYWQoKTtcbiAgICAgICAgICBHYW1lLnNvdW5kcy5odXJ0LnBsYXkoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgKi9cblxuICAgICAgdGV4dC5jZW50ZXJYID0gTWF0aC5mbG9vcih0ZXh0LndpZHRoIC8gMik7XG4gICAgICB0ZXh0LmNlbnRlclkgPSBNYXRoLmZsb29yKHRleHQuaGVpZ2h0KTtcbiAgICAgIHRleHQueCA9IHRoaXMuc3ByaXRlLng7XG4gICAgICB0ZXh0LnkgPSB0aGlzLnNwcml0ZS55O1xuXG4gICAgICB0ZXh0LnggKz0gU3ByaXRlLnJhbmQoLTEwLCAxMCk7XG5cbiAgICAgIEdhbWUubGF5ZXJzLmFjdG9yTGF5ZXIuYXBwZW5kQ2hpbGQodGV4dCk7XG5cbiAgICAgIGxldCBzcGVlZCA9IFNwcml0ZS5yYW5kKDEsIDMpO1xuXG4gICAgICBTcHJpdGUuVGlja2VyLndoaWxlcygxMDAsIChsYXN0KSA9PiB7XG4gICAgICAgIHRleHQueSAtPSBzcGVlZDtcbiAgICAgICAgaWYgKGxhc3QpIHtcbiAgICAgICAgICBHYW1lLmxheWVycy5hY3RvckxheWVyLnJlbW92ZUNoaWxkKHRleHQpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8g5rWL6K+V5piv5ZCm5q275LqhXG4gICAgICB0aGlzLmRlYWQoYXR0YWNrZXIpO1xuXG4gICAgfVxuXG4gICAgLyoqIOaSreaUvuS4gOS4quWKqOeUuyAqL1xuICAgIHBsYXkgKGFuaW1hdGlvbiwgcHJpb3JpdHkpIHtcbiAgICAgIC8vIOaWsOWKqOeUu+m7mOiupOS8mOWFiOe6p+S4ujBcbiAgICAgIGlmICghTnVtYmVyLmlzRmluaXRlKHByaW9yaXR5KSkge1xuICAgICAgICBwcmlvcml0eSA9IDA7XG4gICAgICB9XG5cbiAgICAgIC8vIOaXoOWKqOeUu+aIluiAheWBnOatoueKtuaAge+8jOeOsOacieS8mOWFiOe6p+S4ui0x77yI5pyA5L2O57qn77yJXG4gICAgICBpZiAodHlwZW9mIHRoaXMuYW5pbWF0aW9uUHJpb3JpdHkgPT0gXCJ1bmRlZmluZWRcIiB8fCB0aGlzLnNwcml0ZS5wYXVzZWQgPT0gdHJ1ZSkge1xuICAgICAgICB0aGlzLmFuaW1hdGlvblByaW9yaXR5ID0gLTE7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5kYXRhLmFuaW1hdGlvbnMuaGFzT3duUHJvcGVydHkoYW5pbWF0aW9uKSAmJlxuICAgICAgICBwcmlvcml0eSA+PSB0aGlzLmFuaW1hdGlvblByaW9yaXR5ICYmXG4gICAgICAgIGFuaW1hdGlvbiAhPSB0aGlzLnNwcml0ZS5jdXJyZW50QW5pbWF0aW9uXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5hbmltYXRpb25Qcmlvcml0eSA9IHByaW9yaXR5O1xuICAgICAgICB0aGlzLnNwcml0ZS5wbGF5KGFuaW1hdGlvbik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqIOWBnOatoiAqL1xuICAgIHN0b3AgKCkge1xuICAgICAgaWYgKCF0aGlzLnNwcml0ZS5jdXJyZW50QW5pbWF0aW9uKSByZXR1cm47XG5cbiAgICAgIGlmICgodGhpcy5zcHJpdGUucGF1c2VkICYmICF0aGlzLnNwcml0ZS5jdXJyZW50QW5pbWF0aW9uLm1hdGNoKC9mYWNlLykpXG4gICAgICAgIHx8IHRoaXMuc3ByaXRlLmN1cnJlbnRBbmltYXRpb24ubWF0Y2goL3dhbGt8cnVuLykpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLmRpcmVjdGlvbikge1xuICAgICAgICAgIGNhc2UgXCJ1cFwiOlxuICAgICAgICAgICAgdGhpcy5zcHJpdGUucGxheShcImZhY2V1cFwiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJkb3duXCI6XG4gICAgICAgICAgICB0aGlzLnNwcml0ZS5wbGF5KFwiZmFjZWRvd25cIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwibGVmdFwiOlxuICAgICAgICAgICAgdGhpcy5zcHJpdGUucGxheShcImZhY2VsZWZ0XCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcInJpZ2h0XCI6XG4gICAgICAgICAgICB0aGlzLnNwcml0ZS5wbGF5KFwiZmFjZXJpZ2h0XCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKiog5ZCR5oyH5a6aZGlyZWN0aW9u5pa55ZCR6YeK5pS+5LiA5Liq5oqA6IO9ICovXG4gICAgZmlyZSAoaWQsIGRpcmVjdGlvbikge1xuICAgICAgLy8g5ZCM5LiA5pe26Ze05Y+q6IO95pa95bGV5LiA5Liqc2tpbGxcbiAgICAgIGlmICh0aGlzLmF0dGFja2luZylcbiAgICAgICAgcmV0dXJuIDA7XG5cbiAgICAgIGxldCBza2lsbCA9IEdhbWUuc2tpbGxzW2lkXTtcbiAgICAgIGlmICghc2tpbGwpXG4gICAgICAgIHJldHVybiAwO1xuXG4gICAgICAvLyDlj6rmnInlvZPov5nkuKpza2lsbOeahGNvb2xkb3du57uTXG4gICAgICBsZXQgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICBpZiAoXG4gICAgICAgIE51bWJlci5pc0Zpbml0ZSh0aGlzLmxhc3RBdHRhY2spICYmXG4gICAgICAgIE51bWJlci5pc0Zpbml0ZSh0aGlzLmxhc3RBdHRhY2tDb29sZG93bikgJiZcbiAgICAgICAgKG5vdyAtIHRoaXMubGFzdEF0dGFjaykgPCB0aGlzLmxhc3RBdHRhY2tDb29sZG93blxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuXG4gICAgICBpZiAoc2tpbGwuZGF0YS5jb3N0ID4gdGhpcy5kYXRhLnNwKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWRpcmVjdGlvbikge1xuICAgICAgICBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjtcbiAgICAgIH1cblxuICAgICAgaWYgKCAvLyDnjqnlrrbkvb/nlKjmioDog73mmK/lj6/og73mnInmnaHku7bnmoTvvIzkvovlpoLliZHmioDog73pnIDopoHoo4XlpIfliZFcbiAgICAgICAgdGhpcy50eXBlID09IFwiaGVyb1wiICYmXG4gICAgICAgIHNraWxsLmRhdGEuY29uZGl0aW9uICYmXG4gICAgICAgIHNraWxsLmRhdGEuY29uZGl0aW9uKCkgPT0gZmFsc2VcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sYXN0QXR0YWNrID0gbm93O1xuICAgICAgdGhpcy5sYXN0QXR0YWNrQ29vbGRvd24gPSBza2lsbC5kYXRhLmNvb2xkb3duO1xuICAgICAgdGhpcy5hdHRhY2tpbmcgPSB0cnVlO1xuXG4gICAgICB0aGlzLmRhdGEuc3AgLT0gc2tpbGwuZGF0YS5jb3N0O1xuICAgICAgdGhpcy5yZWZyZXNoQmFyKCk7XG5cbiAgICAgIHNraWxsLmZpcmUodGhpcywgZGlyZWN0aW9uLCAoaGl0dGVkKSA9PiB7XG4gICAgICAgIHRoaXMuYXR0YWNraW5nID0gZmFsc2U7XG4gICAgICAgIGlmIChoaXR0ZWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGhpdHRlZFswXS5kYW1hZ2UodGhpcywgc2tpbGwpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZW1pdChcImNoYW5nZVwiKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gc2tpbGwuZGF0YS5jb29sZG93bjtcbiAgICB9XG5cbiAgICAvKiog6KGM6LWw5Yiw5oyH5a6a5Zyw54K5ICovXG4gICAgZ290byAoeCwgeSwgc3RhdGUsIGNhbGxiYWNrKSB7XG5cbiAgICAgIGlmICh0aGlzLmdvaW5nKSB7XG4gICAgICAgIHRoaXMuZ29pbmdOZXh0ID0gKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZ290byh4LCB5LCBzdGF0ZSwgY2FsbGJhY2spO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGxldCBkZXN0QmxvY2tlZCA9IHRoaXMuY2hlY2tDb2xsaXNpb24oeCwgeSk7XG5cbiAgICAgIGlmIChkZXN0QmxvY2tlZCkge1xuICAgICAgICBpZiAodGhpcy54ID09IHgpIHtcbiAgICAgICAgICBpZiAodGhpcy55IC0geSA9PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgICAgICB0aGlzLmZhY2UoXCJkb3duXCIpO1xuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy55IC0geSA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICAgIHRoaXMuZmFjZShcInVwXCIpO1xuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnkgPT0geSkge1xuICAgICAgICAgIGlmICh0aGlzLnggLSB4ID09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICAgIHRoaXMuZmFjZShcInJpZ2h0XCIpO1xuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy54IC0geCA9PSAxKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICAgIHRoaXMuZmFjZShcImxlZnRcIik7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxldCBwb3NpdGlvbkNob2ljZSA9IFtdO1xuICAgICAgLy8g5LiK5LiL5bem5Y+zXG4gICAgICBpZiAodGhpcy5jaGVja0NvbGxpc2lvbih4LCB5LTEpID09IGZhbHNlKSB7XG4gICAgICAgIHBvc2l0aW9uQ2hvaWNlLnB1c2goe3g6IHgsIHk6IHktMSwgYWZ0ZXI6IFwiZG93blwifSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5jaGVja0NvbGxpc2lvbih4LCB5KzEpID09IGZhbHNlKSB7XG4gICAgICAgIHBvc2l0aW9uQ2hvaWNlLnB1c2goe3g6IHgsIHk6IHkrMSwgYWZ0ZXI6IFwidXBcIn0pO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY2hlY2tDb2xsaXNpb24oeC0xLCB5KSA9PSBmYWxzZSkge1xuICAgICAgICBwb3NpdGlvbkNob2ljZS5wdXNoKHt4OiB4LTEsIHk6IHksIGFmdGVyOiBcInJpZ2h0XCJ9KTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmNoZWNrQ29sbGlzaW9uKHgrMSwgeSkgPT0gZmFsc2UpIHtcbiAgICAgICAgcG9zaXRpb25DaG9pY2UucHVzaCh7eDogeCsxLCB5OiB5LCBhZnRlcjogXCJsZWZ0XCJ9KTtcbiAgICAgIH1cblxuICAgICAgZm9yIChsZXQgZWxlbWVudCBvZiBwb3NpdGlvbkNob2ljZSkgeyAvLyDorqHnrpflnLDlnYDot53nprtcbiAgICAgICAgZWxlbWVudC5kaXN0YW5jZSA9IHRoaXMuZGlzdGFuY2UoZWxlbWVudC54LCBlbGVtZW50LnkpO1xuICAgICAgfVxuXG4gICAgICAvLyDmjInnhaflnLDlnYDnmoTot53nprvku47ov5HliLDov5zmjpLluo/vvIjku47lsI/liLDlpKfvvIlcbiAgICAgIHBvc2l0aW9uQ2hvaWNlLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgcmV0dXJuIGEuZGlzdGFuY2UgLSBiLmRpc3RhbmNlO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIOWmguaenOecn+ato+eahOebrueahOWcsOacieWPr+iDvei1sO+8jOaPkuWFpeWIsOesrOS4gOS9je+8jOWGmeWcqOi/memHjOaYr+WboOS4uuebrueahOWcsOW5tuS4jeS4gOWumuaYr2Rpc3RhbmNl5pyA5bCP55qEXG4gICAgICBpZiAodGhpcy5jaGVja0NvbGxpc2lvbih4LCB5KSA9PSBmYWxzZSkge1xuICAgICAgICBwb3NpdGlvbkNob2ljZS5zcGxpY2UoMCwgMCwge3g6IHgsIHk6IHl9KTtcbiAgICAgIH1cblxuICAgICAgbGV0IGluZGV4ID0gMDtcbiAgICAgIGxldCBvdGhlckNob2ljZSA9IGZhbHNlO1xuXG4gICAgICBsZXQgVGVzdFBvc2l0aW9uID0gKCkgPT4ge1xuICAgICAgICBpZiAoaW5kZXggPCBwb3NpdGlvbkNob2ljZS5sZW5ndGgpIHtcbiAgICAgICAgICBsZXQgZGVzdCA9IHBvc2l0aW9uQ2hvaWNlW2luZGV4XTsgLy8g5L+d5a2Y56ys5LiA5Liq6YCJ6aG5XG4gICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICBHYW1lLkFzdGFyLmdldFBhdGgoe3g6IHRoaXMueCwgeTogdGhpcy55fSwgZGVzdCwgKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5nZXR0aW5nUGF0aCA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHRoaXMuZ29pbmdOZXh0KSB7XG4gICAgICAgICAgICAgIGxldCBjID0gdGhpcy5nb2luZ05leHQ7XG4gICAgICAgICAgICAgIHRoaXMuZ29pbmdOZXh0ID0gbnVsbDtcbiAgICAgICAgICAgICAgdGhpcy5nb2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgICBpZiAodGhpcyA9PSBHYW1lLmhlcm8pIHtcbiAgICAgICAgICAgICAgICBHYW1lLklucHV0LmNsZWFyRGVzdCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGMoKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuZ29pbmcpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgICBpZiAodGhpcyA9PSBHYW1lLmhlcm8pIHtcbiAgICAgICAgICAgICAgICBHYW1lLklucHV0LnNldERlc3QoZGVzdC54LCBkZXN0LnkpO1xuICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBub3QgaGVyb1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMzApIHtcbiAgICAgICAgICAgICAgICAgIC8vIHRvbyBmYXJcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdGhpcy5nb3RvUGF0aChyZXN1bHQsIHN0YXRlLCBkZXN0LmFmdGVyLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFRlc3RQb3NpdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChvdGhlckNob2ljZSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgb3RoZXJDaG9pY2UgPSB0cnVlO1xuICAgICAgICAgICAgbGV0IG90aGVyUG9zaXRpb25DaG9pY2UgPSBbXTtcbiAgICAgICAgICAgIC8vIOWbm+S4quinklxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tDb2xsaXNpb24oeC0xLCB5LTEpID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG90aGVyUG9zaXRpb25DaG9pY2UucHVzaCh7eDogeC0xLCB5OiB5LTEsIGFmdGVyOiBcInJpZ2h0XCJ9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrQ29sbGlzaW9uKHgrMSwgeS0xKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICBvdGhlclBvc2l0aW9uQ2hvaWNlLnB1c2goe3g6IHgrMSwgeTogeS0xLCBhZnRlcjogXCJsZWZ0XCJ9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrQ29sbGlzaW9uKHgtMSwgeSsxKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICBvdGhlclBvc2l0aW9uQ2hvaWNlLnB1c2goe3g6IHgtMSwgeTogeSsxLCBhZnRlcjogXCJyaWdodFwifSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja0NvbGxpc2lvbih4KzEsIHkrMSkgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgb3RoZXJQb3NpdGlvbkNob2ljZS5wdXNoKHt4OiB4KzEsIHk6IHkrMSwgYWZ0ZXI6IFwibGVmdFwifSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDlm5vkuKrov5zmlrnlkJFcbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrQ29sbGlzaW9uKHgsIHktMikgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgb3RoZXJQb3NpdGlvbkNob2ljZS5wdXNoKHt4OiB4LCB5OiB5LTIsIGFmdGVyOiBcImRvd25cIn0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tDb2xsaXNpb24oeCwgeSsyKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICBvdGhlclBvc2l0aW9uQ2hvaWNlLnB1c2goe3g6IHgsIHk6IHkrMiwgYWZ0ZXI6IFwidXBcIn0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tDb2xsaXNpb24oeC0yLCB5KSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICBvdGhlclBvc2l0aW9uQ2hvaWNlLnB1c2goe3g6IHgtMiwgeTogeSwgYWZ0ZXI6IFwicmlnaHRcIn0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tDb2xsaXNpb24oeCsyLCB5KSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICBvdGhlclBvc2l0aW9uQ2hvaWNlLnB1c2goe3g6IHgrMiwgeTogeSwgYWZ0ZXI6IFwibGVmdFwifSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvciAobGV0IGVsZW1lbnQgb2Ygb3RoZXJQb3NpdGlvbkNob2ljZSkgeyAvLyDorqHnrpflnLDlnYDot53nprtcbiAgICAgICAgICAgICAgZWxlbWVudC5kaXN0YW5jZSA9IHRoaXMuZGlzdGFuY2UoZWxlbWVudC54LCBlbGVtZW50LnkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyDmjInnhaflnLDlnYDnmoTot53nprvku47ov5HliLDov5zmjpLluo/vvIjku47lsI/liLDlpKfvvIlcbiAgICAgICAgICAgIG90aGVyUG9zaXRpb25DaG9pY2Uuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gYS5kaXN0YW5jZSAtIGIuZGlzdGFuY2U7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKG90aGVyUG9zaXRpb25DaG9pY2UubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIGluZGV4ID0gMDtcbiAgICAgICAgICAgICAgcG9zaXRpb25DaG9pY2UgPSBvdGhlclBvc2l0aW9uQ2hvaWNlO1xuICAgICAgICAgICAgICBUZXN0UG9zaXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gLy8g5YaN5qyh5bCd6K+V56a75Zyw54K55pyA6L+R55qE5Zyw54K5XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBUZXN0UG9zaXRpb24oKTtcbiAgICB9XG5cbiAgICBnb3RvUGF0aCAocGF0aCwgc3RhdGUsIGFmdGVyLCBjYWxsYmFjaykge1xuICAgICAgdGhpcy5nb2luZyA9IHRydWU7XG4gICAgICBsZXQgaW5kZXggPSAxO1xuICAgICAgbGV0IFdhbGsgPSAoKSA9PiB7XG4gICAgICAgIGlmIChHYW1lLnBhdXNlZCkge1xuICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICAgIHRoaXMuZ29pbmcgPSBmYWxzZTtcbiAgICAgICAgICBpZiAodGhpcyA9PSBHYW1lLmhlcm8pIHtcbiAgICAgICAgICAgIEdhbWUuSW5wdXQuY2xlYXJEZXN0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5nb2luZ05leHQpIHtcbiAgICAgICAgICBsZXQgYyA9IHRoaXMuZ29pbmdOZXh0O1xuICAgICAgICAgIHRoaXMuZ29pbmdOZXh0ID0gbnVsbDtcbiAgICAgICAgICB0aGlzLmdvaW5nID0gZmFsc2U7XG4gICAgICAgICAgaWYgKHRoaXMgPT0gR2FtZS5oZXJvKSB7XG4gICAgICAgICAgICBHYW1lLklucHV0LmNsZWFyRGVzdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluZGV4IDwgcGF0aC5sZW5ndGgpIHtcbiAgICAgICAgICBsZXQgY3VycmVudCA9IHt4OiB0aGlzLngsIHk6IHRoaXMueX07XG4gICAgICAgICAgbGV0IGRlc3QgPSBwYXRoW2luZGV4XTtcbiAgICAgICAgICBsZXQgZGlyZWN0aW9uID0gbnVsbDtcbiAgICAgICAgICBpZiAoZGVzdC54ID09IGN1cnJlbnQueCkge1xuICAgICAgICAgICAgaWYgKGRlc3QueSA+IGN1cnJlbnQueSkge1xuICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBcImRvd25cIjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVzdC55IDwgY3VycmVudC55KSB7XG4gICAgICAgICAgICAgIGRpcmVjdGlvbiA9IFwidXBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKGRlc3QueSA9PSBjdXJyZW50LnkpIHtcbiAgICAgICAgICAgIGlmIChkZXN0LnggPiBjdXJyZW50LngpIHtcbiAgICAgICAgICAgICAgZGlyZWN0aW9uID0gXCJyaWdodFwiXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRlc3QueCA8IGN1cnJlbnQueCkge1xuICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBcImxlZnRcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICBsZXQgY3VycmVudERpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uO1xuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiAhPSBjdXJyZW50RGlyZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICAgICAgICB0aGlzLmZhY2UoZGlyZWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBnb1Jlc3VsdCA9IHRoaXMuZ28oc3RhdGUsIGRpcmVjdGlvbiwgKCkgPT4gV2FsaygpKTtcbiAgICAgICAgICAgIGlmIChnb1Jlc3VsdCAhPSB0cnVlKSB7XG4gICAgICAgICAgICAgIHRoaXMuZ29pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgeyAvLyDmraPluLjnu5PmnZ9cbiAgICAgICAgICBpZiAoYWZ0ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICAgICAgdGhpcy5mYWNlKGFmdGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHRoaXMgPT0gR2FtZS5oZXJvKSB7XG4gICAgICAgICAgICBHYW1lLklucHV0LmNsZWFyRGVzdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmdvaW5nID0gZmFsc2U7XG4gICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBXYWxrKCk7XG4gICAgfVxuXG4gICAgZmFjZSAoZGlyZWN0aW9uKSB7XG4gICAgICBsZXQgYW5pbWF0aW9uID0gXCJmYWNlXCIgKyBkaXJlY3Rpb247XG4gICAgICBpZiAodGhpcy5hbmltYXRpb24gIT0gYW5pbWF0aW9uKSB7XG4gICAgICAgIHRoaXMuc3ByaXRlLnBsYXkoYW5pbWF0aW9uKTtcbiAgICAgICAgdGhpcy5lbWl0KFwiY2hhbmdlXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOWPguaVsHTkuK3orrDlvZXkuobmn5DkuKrmlrnmoLznmoTmlrnkvY14ee+8jOa1i+ivlei/meS4quaWueagvOaYr+WQpuWSjOeOqeWutuacieWGsueqgVxuICAgIC8vIOi/lOWbnnRydWXkuLrmnInnorDmkp7vvIzov5Tlm55mYWxzZeS4uuaXoOeisOaSnlxuICAgIGNoZWNrQ29sbGlzaW9uICh4LCB5KSB7XG4gICAgICAvLyDlnLDlm77ovrnnvJjnorDmkp5cbiAgICAgIGlmICh4IDwgMCB8fCB5IDwgMCB8fCB4ID49IEdhbWUuYXJlYS5tYXAuZGF0YS53aWR0aCB8fCB5ID49IEdhbWUuYXJlYS5tYXAuZGF0YS5oZWlnaHQpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICAvLyDlnLDlm77norDmkp5cbiAgICAgIGlmIChHYW1lLmFyZWEubWFwLmhpdFRlc3QoeCwgeSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIC8vIOinkuiJsueisOaSnlxuICAgICAgaWYgKEdhbWUuYXJlYS5hY3RvcnMpIHtcbiAgICAgICAgZm9yIChsZXQgYWN0b3Igb2YgR2FtZS5hcmVhLmFjdG9ycykge1xuICAgICAgICAgIGlmIChhY3RvciAhPSB0aGlzICYmIGFjdG9yLmhpdFRlc3QoeCwgeSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoR2FtZS5hcmVhLml0ZW1zKSB7XG4gICAgICAgIGZvciAobGV0IGl0ZW0gb2YgR2FtZS5hcmVhLml0ZW1zKSB7XG4gICAgICAgICAgaWYgKGl0ZW0uaGl0VGVzdCh4LCB5KSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgaGl0VGVzdCAoeCwgeSkge1xuICAgICAgaWYgKHRoaXMuZGF0YS5oaXRBcmVhICYmIHRoaXMuZGF0YS5oaXRBcmVhIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgZm9yIChsZXQgcCBvZiB0aGlzLmRhdGEuaGl0QXJlYSkge1xuICAgICAgICAgIGlmICh4ID09IHRoaXMueCArIHBbMF0gJiYgeSA9PSB0aGlzLnkgKyBwWzFdKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcih0aGlzLmRhdGEpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHYW1lLkFjdG9yLmhpdFRlc3QgaW52YWxpZCBkYXRhXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGdvIChzdGF0ZSwgZGlyZWN0aW9uLCBjYWxsYmFjayA9IG51bGwpIHtcblxuICAgICAgaWYgKEdhbWUucGF1c2VkKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgLy8g5aaC5p6c5q2j5Zyo5oiY5paX5Yqo55S777yM5YiZ5LiN6LWwXG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMuc3ByaXRlLnBhdXNlZCA9PSBmYWxzZSAmJlxuICAgICAgICB0aGlzLnNwcml0ZS5jdXJyZW50QW5pbWF0aW9uLm1hdGNoKC9za2lsbGNhc3R8dGhydXN0fHNsYXNofHNob290LylcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLndhbGtpbmcpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5hdHRhY2tpbmcpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5kaXJlY3Rpb24gIT0gZGlyZWN0aW9uKSB7XG4gICAgICAgIHRoaXMud2Fsa2luZyA9IHRydWU7XG4gICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICB0aGlzLmZhY2UoZGlyZWN0aW9uKTtcbiAgICAgICAgLy8gd2FpdCA0IHRpY2tzXG4gICAgICAgIFNwcml0ZS5UaWNrZXIuYWZ0ZXIoNCwgKCkgPT4ge1xuICAgICAgICAgIHRoaXMud2Fsa2luZyA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBsZXQgbmV3UG9zaXRpb24gPSB0aGlzLmZhY2VQb3NpdGlvbjtcblxuICAgICAgaWYgKHRoaXMuY2hlY2tDb2xsaXNpb24obmV3UG9zaXRpb24ueCwgbmV3UG9zaXRpb24ueSkgPT0gZmFsc2UpIHtcbiAgICAgICAgLy8g5rKh56Kw5pKe77yM5byA5aeL6KGM6LWwXG4gICAgICAgIHRoaXMud2Fsa2luZyA9IHRydWU7XG5cbiAgICAgICAgLy8g5oqK6KeS6Imy5L2N572u6K6+572u5Li65paw5L2N572u77yM5Li65LqG5Y2g6aKG6L+Z5Liq5L2N572u77yM6L+Z5qC35YW25LuW6KeS6Imy5bCx5Lya56Kw5pKeXG4gICAgICAgIC8vIOS9huaYr+S4jeiDveeUqHRoaXMueCA9IG5ld1jov5nmoLforr7nva7vvIzlm6DkuLp0aGlzLnjnmoTorr7nva7kvJrlkIzml7borr7nva50aGlzLnNwcml0ZS54XG4gICAgICAgIGxldCBvbGRYID0gdGhpcy5kYXRhLng7XG4gICAgICAgIGxldCBvbGRZID0gdGhpcy5kYXRhLnk7XG4gICAgICAgIHRoaXMuZGF0YS54ID0gbmV3UG9zaXRpb24ueDtcbiAgICAgICAgdGhpcy5kYXRhLnkgPSBuZXdQb3NpdGlvbi55O1xuXG4gICAgICAgIC8vIHdhbGtcbiAgICAgICAgLy8g6L+Z5Lqb5pWw57uE5ZKM5b+F6aG75pivMzLvvIzkuLrkuobkv53or4HkuIDmrKFnb+ihjOi1sDMy5Liq5YOP57SgXG4gICAgICAgIGxldCBzcGVlZCA9IFszLDMsMiwzLDMsMiwzLDMsMiwzLDMsMl07IC8vIOWSjOaYrzMyXG4gICAgICAgIGlmIChzdGF0ZSA9PSBcInJ1blwiKSB7XG4gICAgICAgICAgLy8gc3BlZWQgPSBbNiw3LDYsNyw2XTsgLy8g5ZKM5pivMzJcbiAgICAgICAgICBzcGVlZCA9IFs0LDQsNCw0LDQsNCw0LDRdOyAvLyDlkozmmK8zMlxuICAgICAgICB9XG4gICAgICAgIC8vIOavlOmihOiuoeWkmuS4gOS4qu+8jOi/meagt+aYr+S4uuS6hua1geeVhVxuICAgICAgICAvLyDlm6DkuLrkuIvkuIDmrKFnb+WPr+iDvee0p+aMqOedgOi/measoVxuICAgICAgICBsZXQgdGltZXMgPSBzcGVlZC5sZW5ndGggKyAxO1xuXG4gICAgICAgIGxldCB3aGlsZXNJZCA9IFNwcml0ZS5UaWNrZXIud2hpbGVzKHRpbWVzLCAobGFzdCkgPT4ge1xuICAgICAgICAgIGlmIChHYW1lLnBhdXNlZCkge1xuICAgICAgICAgICAgdGhpcy5kYXRhLnggPSBvbGRYO1xuICAgICAgICAgICAgdGhpcy5kYXRhLnkgPSBvbGRZO1xuICAgICAgICAgICAgdGhpcy53YWxraW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmVtaXQoXCJjaGFuZ2VcIik7XG4gICAgICAgICAgICBTcHJpdGUuVGlja2VyLmNsZWFyV2hpbGVzKHdoaWxlc0lkKTtcbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChsYXN0KSB7XG4gICAgICAgICAgICB0aGlzLnggPSBuZXdQb3NpdGlvbi54O1xuICAgICAgICAgICAgdGhpcy55ID0gbmV3UG9zaXRpb24ueTtcbiAgICAgICAgICAgIHRoaXMud2Fsa2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5lbWl0KFwiY2hhbmdlXCIpO1xuXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgY2FzZSBcInVwXCI6XG4gICAgICAgICAgICAgICAgdGhpcy5zcHJpdGUueSAtPSBzcGVlZC5wb3AoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSBcImRvd25cIjpcbiAgICAgICAgICAgICAgICB0aGlzLnNwcml0ZS55ICs9IHNwZWVkLnBvcCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlIFwibGVmdFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLnggLT0gc3BlZWQucG9wKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICAgICAgICAgIHRoaXMuc3ByaXRlLnggKz0gc3BlZWQucG9wKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyDmkq3mlL7ooYzotbDliqjnlLtcbiAgICAgICAgdGhpcy5wbGF5KHN0YXRlICsgZGlyZWN0aW9uLCAxKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvKiog5ZyoR2FtZS5hY3RvckxheWVy5LiK5Yig6Zmk5Lq654mpICovXG4gICAgZXJhc2UgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBHYW1lLmxheWVycy5hY3RvckxheWVyLnJlbW92ZUNoaWxkKHRoaXMuc3ByaXRlKTtcbiAgICAgIEdhbWUubGF5ZXJzLmluZm9MYXllci5yZW1vdmVDaGlsZChwcml2YXRlcy5pbmZvQm94KTtcbiAgICB9XG5cbiAgICAvKiog5ZyoR2FtZS5hY3RvckxheWVy5LiK5pi+56S65Lq654mpICovXG4gICAgZHJhdyAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHRoaXMueCkgJiYgTnVtYmVyLmlzSW50ZWdlcih0aGlzLnkpKSB7XG4gICAgICAgIHRoaXMueCA9IHRoaXMuZGF0YS54O1xuICAgICAgICB0aGlzLnkgPSB0aGlzLmRhdGEueTtcblxuICAgICAgICBpbnRlcm5hbCh0aGlzKS5pbmZvQm94LnggPSB0aGlzLnNwcml0ZS54O1xuICAgICAgICBpbnRlcm5hbCh0aGlzKS5pbmZvQm94LnkgPSB0aGlzLnNwcml0ZS55IC0gdGhpcy5zcHJpdGUuY2VudGVyWSAtIDIwO1xuXG4gICAgICAgIEdhbWUubGF5ZXJzLmFjdG9yTGF5ZXIuYXBwZW5kQ2hpbGQodGhpcy5zcHJpdGUpO1xuICAgICAgICBHYW1lLmxheWVycy5pbmZvTGF5ZXIuYXBwZW5kQ2hpbGQocHJpdmF0ZXMuaW5mb0JveCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKHRoaXMuZGF0YS54LCB0aGlzLmRhdGEueSwgdGhpcy5kYXRhKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5BY3Rvci5kcmF3IGludmFsaWQgZGF0YS54L2RhdGEueVwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKiog6ZWc5aS06ZuG5LitICovXG4gICAgZm9jdXMgKCkge1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBwcml2YXRlcy5pbmZvQm94LnggPSB0aGlzLnNwcml0ZS54O1xuICAgICAgcHJpdmF0ZXMuaW5mb0JveC55ID0gdGhpcy5zcHJpdGUueSAtIHRoaXMuc3ByaXRlLmNlbnRlclkgLSAyMDtcblxuICAgICAgR2FtZS5zdGFnZS5jZW50ZXJYID0gTWF0aC5yb3VuZCh0aGlzLnNwcml0ZS54IC0gR2FtZS5jb25maWcud2lkdGggLyAyKTtcbiAgICAgIEdhbWUuc3RhZ2UuY2VudGVyWSA9IE1hdGgucm91bmQodGhpcy5zcHJpdGUueSAtIEdhbWUuY29uZmlnLmhlaWdodCAvIDIpO1xuICAgIH1cblxuICB9KTsgLy8gR2FtZS5BY3RvclxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
    英雄类
    属性：
      this.sprite 精灵
  */
  Game.assign("ActorAlly", (function (_Game$Actor) {
    _inherits(GameActorAlly, _Game$Actor);

    function GameActorAlly(actorData) {
      _classCallCheck(this, GameActorAlly);

      _get(Object.getPrototypeOf(GameActorAlly.prototype), "constructor", this).call(this, actorData);
    }

    return GameActorAlly;
  })(Game.Actor));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVBY3RvckFsbHkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDOzs7Ozs7O0FBT2xDLE1BQUksQ0FBQyxNQUFNLENBQUMsV0FBVztjQUFRLGFBQWE7O0FBQzlCLGFBRGlCLGFBQWEsQ0FDN0IsU0FBUyxFQUFFOzRCQURLLGFBQWE7O0FBRXhDLGlDQUYyQixhQUFhLDZDQUVsQyxTQUFTLEVBQUU7S0FDbEI7O1dBSDRCLGFBQWE7S0FBUyxJQUFJLENBQUMsS0FBSyxFQU03RCxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiR2FtZUFjdG9yQWxseS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCBpbnRlcm5hbCA9IFNwcml0ZS5OYW1lc3BhY2UoKTtcblxuICAvKipcbiAgICDoi7Hpm4TnsbtcbiAgICDlsZ7mgKfvvJpcbiAgICAgIHRoaXMuc3ByaXRlIOeyvueBtVxuICAqL1xuICBHYW1lLmFzc2lnbihcIkFjdG9yQWxseVwiLCBjbGFzcyBHYW1lQWN0b3JBbGx5IGV4dGVuZHMgR2FtZS5BY3RvciB7XG4gICAgY29uc3RydWN0b3IgKGFjdG9yRGF0YSkge1xuICAgICAgc3VwZXIoYWN0b3JEYXRhKTtcbiAgICB9XG5cblxuICB9KTtcblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
    英雄类
    属性：
      this.sprite 精灵
  */
  Game.assign("ActorHero", (function (_Game$Actor) {
    _inherits(GameActorHero, _Game$Actor);

    function GameActorHero(actorData) {
      var _this = this;

      _classCallCheck(this, GameActorHero);

      _get(Object.getPrototypeOf(GameActorHero.prototype), "constructor", this).call(this, actorData);
      var privates = internal(this);
      privates.ai = null;
      privates.beAttacking = new Set();

      this.on("kill", function (event) {
        var actor = event.data;

        if (_this.beAttacking.has(actor)) {
          _this.beAttacking["delete"](actor);
        }

        if (actor.data.exp) {
          _this.data.exp += actor.data.exp;
        } else {
          _this.data.exp += 1;
        }

        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = _this.data.currentQuest[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var quest = _step.value;

            if (quest.target && quest.target.kill) {
              var _iteratorNormalCompletion2 = true;
              var _didIteratorError2 = false;
              var _iteratorError2 = undefined;

              try {
                for (var _iterator2 = quest.target.kill[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                  var k = _step2.value;

                  if (actor.id == k.id && k.current < k.need) {
                    k.current++;
                  }
                }
              } catch (err) {
                _didIteratorError2 = true;
                _iteratorError2 = err;
              } finally {
                try {
                  if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
                    _iterator2["return"]();
                  }
                } finally {
                  if (_didIteratorError2) {
                    throw _iteratorError2;
                  }
                }
              }
            }
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator["return"]) {
              _iterator["return"]();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      });

      this.on("change", function () {
        _this.onto();
        _this.touch();
      });

      setInterval(function () {
        if (!Game.paused) {
          _this.onto();
          _this.touch();
        }
      }, 500);
    }

    _createClass(GameActorHero, [{
      key: "hasItem",
      value: function hasItem(id, count) {
        if (Number.isFinite(count) == false || count <= 0) {
          count = 1;
        }
        for (var key in this.data.items) {
          if (key == id) {
            if (this.data.items[key] >= count) {
              return true;
            } else {
              return false;
            }
          }
        }
        return false;
      }
    }, {
      key: "hasQuest",
      value: function hasQuest(id) {
        var _iteratorNormalCompletion3 = true;
        var _didIteratorError3 = false;
        var _iteratorError3 = undefined;

        try {
          for (var _iterator3 = this.data.currentQuest[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
            var quest = _step3.value;

            if (id == quest.id) {
              return true;
            }
          }
        } catch (err) {
          _didIteratorError3 = true;
          _iteratorError3 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion3 && _iterator3["return"]) {
              _iterator3["return"]();
            }
          } finally {
            if (_didIteratorError3) {
              throw _iteratorError3;
            }
          }
        }

        var _iteratorNormalCompletion4 = true;
        var _didIteratorError4 = false;
        var _iteratorError4 = undefined;

        try {
          for (var _iterator4 = this.data.completeQuest[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
            var quest = _step4.value;

            if (id == quest.id) {
              return true;
            }
          }
        } catch (err) {
          _didIteratorError4 = true;
          _iteratorError4 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion4 && _iterator4["return"]) {
              _iterator4["return"]();
            }
          } finally {
            if (_didIteratorError4) {
              throw _iteratorError4;
            }
          }
        }

        return false;
      }
    }, {
      key: "damage",
      value: function damage(attacker, skill) {
        var _this2 = this;

        _get(Object.getPrototypeOf(GameActorHero.prototype), "damage", this).call(this, attacker, skill);

        // 如果英雄受到了伤害
        var touchActor = [];
        var _iteratorNormalCompletion5 = true;
        var _didIteratorError5 = false;
        var _iteratorError5 = undefined;

        try {
          for (var _iterator5 = Game.area.actors[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
            var actor = _step5.value;

            // 找到所有邻接英雄的怪物
            if (actor != this && actor.data.type == "monster" && actor.distance(this) == 1) {
              touchActor.push(actor);
            }
          }
        } catch (err) {
          _didIteratorError5 = true;
          _iteratorError5 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion5 && _iterator5["return"]) {
              _iterator5["return"]();
            }
          } finally {
            if (_didIteratorError5) {
              throw _iteratorError5;
            }
          }
        }

        if (touchActor.length) {
          (function () {
            var faceAttacker = false;
            var facePosition = _this2.facePosition;
            touchActor.forEach(function (actor) {
              if (actor.hitTest(facePosition.x, facePosition.y)) {
                faceAttacker = true;
              }
            });
            // 如果英雄现在没面对任何一个邻接的怪物，面向它
            if (faceAttacker == false) {
              _this2.goto(touchActor[0].x, touchActor[0].y);
            }
          })();
        }
      }
    }, {
      key: "erase",
      value: function erase() {
        var privates = internal(this);
        _get(Object.getPrototypeOf(GameActorHero.prototype), "erase", this).call(this);

        if (privates.ai) {
          Sprite.Ticker.off("tick", privates.ai);
          privates.ai = null;
        }
      }
    }, {
      key: "refreshBar",
      value: function refreshBar() {
        _get(Object.getPrototypeOf(GameActorHero.prototype), "refreshBar", this).call(this);
        Game.windows["interface"].status(this.data.hp / this.data.$hp, // 生命百分比
        this.data.sp / this.data.$sp // 精神力百分比
        );
      }
    }, {
      key: "draw",
      value: function draw() {
        var _this3 = this;

        var privates = internal(this);
        _get(Object.getPrototypeOf(GameActorHero.prototype), "draw", this).call(this);

        privates.ai = Sprite.Ticker.on("tick", function (event) {

          var tickCount = event.data;

          // 每秒16个tick
          if (tickCount % 16 == 0) {
            var barChanged = false;

            if (_this3.data.hp < _this3.data.$hp && _this3.beAttacking.size <= 0) {
              _this3.data.hp++;
              barChanged = true;
            }

            if (_this3.data.sp < _this3.data.$sp) {
              _this3.data.sp++;
              barChanged = true;
            }

            if (barChanged) {
              _this3.refreshBar();
              if (Game.windows.status.atop) {
                Game.windows.status.update();
              }
            }
          }
        });
      }
    }, {
      key: "gotoArea",
      value: function gotoArea(dest, x, y) {
        var privates = internal(this);
        privates.beAttacking = new Set();
        Game.pause();
        Game.windows["interface"].hide();
        Game.windows.stage.hide();
        Game.windows.loading.begin();
        Game.windows.loading.update("20%");

        setTimeout(function () {

          Game.clearStage();
          Game.windows.loading.update("50%");

          setTimeout(function () {

            Game.loadArea(dest).then(function (area) {

              Game.area = area;
              Game.windows.loading.update("80%");

              setTimeout(function () {

                Game.hero.data.area = dest;
                Game.hero.draw();
                Game.hero.x = x;
                Game.hero.y = y;
                area.actors.add(Game.hero);

                area.map.draw();
                Game.windows.loading.update("100%");

                setTimeout(function () {

                  Game.hero.x = x;
                  Game.hero.y = y;
                  Game.hero.data.time += 60; // 加一小时
                  Game.windows.loading.end();
                  Game.windows["interface"].datetime();
                  Game.windows["interface"].refresh();
                  Game.start();

                  setTimeout(function () {

                    Game.stage.update();
                    Game.windows.stage.show();
                    Game.windows["interface"].show();
                  }, 5);
                }, 5);
              }, 5);
            }); // loadArea
          }, 5);
        }, 5);
      }

      // 当玩家站到某个点的时候执行的命令
    }, {
      key: "onto",
      value: function onto() {
        if (!Game.area) return;
        if (!Game.area.onto) return;

        var heroPosition = Game.hero.position;
        var onto = null;

        var FindUnderHero = function FindUnderHero(element) {
          if (onto != null || element == Game.hero) {
            return;
          }
          if (element.hitTest && element.hitTest(heroPosition.x, heroPosition.y)) {
            onto = element;
            return;
          } else if (element.points) {
            var _iteratorNormalCompletion6 = true;
            var _didIteratorError6 = false;
            var _iteratorError6 = undefined;

            try {
              for (var _iterator6 = element.points[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
                var p = _step6.value;

                if (p.x == heroPosition.x && p.y == heroPosition.y) {
                  onto = element;
                  return;
                }
              }
            } catch (err) {
              _didIteratorError6 = true;
              _iteratorError6 = err;
            } finally {
              try {
                if (!_iteratorNormalCompletion6 && _iterator6["return"]) {
                  _iterator6["return"]();
                }
              } finally {
                if (_didIteratorError6) {
                  throw _iteratorError6;
                }
              }
            }
          } else if (Number.isFinite(element.x) && Number.isFinite(element.y) && element.x == heroPosition.x && element.y == heroPosition.y) {
            onto = element;
            return;
          }
        };
        // 找最近可“事件”人物 Game.area.actors
        Sprite.each(Game.area.onto, FindUnderHero);
        if (onto) {
          if (onto.execute) {
            onto.execute();
          }
        } // touch
      }

      // 当玩家站到或者接触到某个点时执行的命令
    }, {
      key: "touch",
      value: function touch() {
        if (!Game.area) return;
        if (!Game.area.touch) return;

        var heroPosition = Game.hero.position;
        var heroFace = Game.hero.facePosition;
        var touch = null;

        var FindUnderHero = function FindUnderHero(element) {
          if (touch != null || element == Game.hero) {
            return;
          }
          if (element.heroUse) {
            if (element.hitTest && element.hitTest(heroPosition.x, heroPosition.y)) {
              touch = element;
              return;
            } else if (element.points) {
              var _iteratorNormalCompletion7 = true;
              var _didIteratorError7 = false;
              var _iteratorError7 = undefined;

              try {
                for (var _iterator7 = element.points[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {
                  var p = _step7.value;

                  if (p.x == heroPosition.x && p.y == heroPosition.y) {
                    touch = element;
                    return;
                  }
                }
              } catch (err) {
                _didIteratorError7 = true;
                _iteratorError7 = err;
              } finally {
                try {
                  if (!_iteratorNormalCompletion7 && _iterator7["return"]) {
                    _iterator7["return"]();
                  }
                } finally {
                  if (_didIteratorError7) {
                    throw _iteratorError7;
                  }
                }
              }
            } else if (Number.isFinite(element.x) && Number.isFinite(element.y) && element.x == heroPosition.x && element.y == heroPosition.y) {
              touch = element;
              return;
            }
          }
        };

        var FindFaceHero = function FindFaceHero(element) {
          if (touch != null || element == Game.hero) {
            return;
          }
          if (element.heroUse) {
            if (element.hitTest && element.hitTest(heroFace.x, heroFace.y)) {
              touch = element;
            } else if (element.points) {
              var _iteratorNormalCompletion8 = true;
              var _didIteratorError8 = false;
              var _iteratorError8 = undefined;

              try {
                for (var _iterator8 = element.points[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {
                  var p = _step8.value;

                  if (p.x == heroFace.x && p.y == heroFace.y) {
                    touch = element;
                    return;
                  }
                }
              } catch (err) {
                _didIteratorError8 = true;
                _iteratorError8 = err;
              } finally {
                try {
                  if (!_iteratorNormalCompletion8 && _iterator8["return"]) {
                    _iterator8["return"]();
                  }
                } finally {
                  if (_didIteratorError8) {
                    throw _iteratorError8;
                  }
                }
              }
            } else if (Number.isFinite(element.x) && Number.isFinite(element.y) && element.x == heroFace.x && element.y == heroFace.y) {
              touch = element;
              return;
            }
          }
        };

        // 用FindUnderHero函数寻找到玩家当前格子的地点

        // 找最近可“事件”人物 Game.area.actors
        Sprite.each(Game.area.actors, FindUnderHero);
        // 找最近尸体 Game.area.bags
        Sprite.each(Game.area.bags, FindUnderHero);
        // 找最近物品 Game.area.items
        Sprite.each(Game.area.items, FindUnderHero);
        // 其他物品（由地图文件定义）
        Game.area.touch.forEach(FindUnderHero);

        // 用FindFaceHero寻找面对着玩家的格子地点

        // 找最近可“事件”人物 Game.area.actors
        Sprite.each(Game.area.actors, FindFaceHero);
        // 找最近尸体 Game.area.bags
        Sprite.each(Game.area.bags, FindFaceHero);
        // 找最近尸体 Game.area.items
        Sprite.each(Game.area.items, FindFaceHero);
        // 其他物品（由地图文件定义）
        Game.area.touch.forEach(FindFaceHero);
        // 水源
        if (!touch && Game.area.map.hitWater(heroFace.x, heroFace.y)) {
          touch = {
            type: "water",
            heroUse: function heroUse() {
              this.popup("This is water");
            }
          };
        }

        if (!touch) {
          Game.hintObject = null;
          Game.windows["interface"].hideUse();
        } else {
          Game.hintObject = touch;
          Game.windows["interface"].showUse();
        }
      }
    }, {
      key: "beAttacking",
      get: function get() {
        return internal(this).beAttacking;
      },
      set: function set(value) {
        throw new Error("Game.hero.beAttacking readonly");
      }
    }]);

    return GameActorHero;
  })(Game.Actor));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9HYW1lL0dhbWVBY3Rvckhlcm8uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7QUFFYixNQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7Ozs7Ozs7QUFPbEMsTUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXO2NBQVEsYUFBYTs7QUFDOUIsYUFEaUIsYUFBYSxDQUM3QixTQUFTLEVBQUU7Ozs0QkFESyxhQUFhOztBQUV4QyxpQ0FGMkIsYUFBYSw2Q0FFbEMsU0FBUyxFQUFFO0FBQ2pCLFVBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM5QixjQUFRLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQztBQUNuQixjQUFRLENBQUMsV0FBVyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7O0FBRWpDLFVBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLFVBQUMsS0FBSyxFQUFLO0FBQ3pCLFlBQUksS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7O0FBRXZCLFlBQUksTUFBSyxXQUFXLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFO0FBQy9CLGdCQUFLLFdBQVcsVUFBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2hDOztBQUVELFlBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUU7QUFDbEIsZ0JBQUssSUFBSSxDQUFDLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztTQUNqQyxNQUFNO0FBQ0wsZ0JBQUssSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7U0FDcEI7Ozs7Ozs7QUFFRCwrQkFBa0IsTUFBSyxJQUFJLENBQUMsWUFBWSw4SEFBRTtnQkFBakMsS0FBSzs7QUFDWixnQkFBSSxLQUFLLENBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxNQUFNLENB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QUMsQ0FBQztPQUNuRDs7O1dBbkQ0QixhQUFhO0tBQVMsSUFBSSxDQUFDLEtBQUssRUF5VzdELENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJzcmMvR2FtZS9HYW1lQWN0b3JIZXJvLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gIC8qKlxuICAgIOiLsembhOexu1xuICAgIOWxnuaAp++8mlxuICAgICAgdGhpcy5zcHJpdGUg57K+54G1XG4gICovXG4gIEdhbWUuYXNzaWduKFwiQWN0b3JIZXJvXCIsIGNsYXNzIEdhbWVBY3Rvckhlcm8gZXh0ZW5kcyBHYW1lLkFjdG9yIHtcbiAgICBjb25zdHJ1Y3RvciAoYWN0b3JEYXRhKSB7XG4gICAgICBzdXBlcihhY3RvckRhdGEpO1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBwcml2YXRlcy5haSA9IG51bGw7XG4gICAgICBwcml2YXRlcy5iZUF0dGFja2luZyA9IG5ldyBTZXQoKTtcblxuICAgICAgdGhpcy5vbihcImtpbGxcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgIGxldCBhY3RvciA9IGV2ZW50LmRhdGE7XG5cbiAgICAgICAgaWYgKHRoaXMuYmVBdHRhY2tpbmcuaGFzKGFjdG9yKSkge1xuICAgICAgICAgIHRoaXMuYmVBdHRhY2tpbmcuZGVsZXRlKGFjdG9yKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhY3Rvci5kYXRhLmV4cCkge1xuICAgICAgICAgIHRoaXMuZGF0YS5leHAgKz0gYWN0b3IuZGF0YS5leHA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5kYXRhLmV4cCArPSAxO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgcXVlc3Qgb2YgdGhpcy5kYXRhLmN1cnJlbnRRdWVzdCkge1xuICAgICAgICAgIGlmIChxdWVzdC50YXJnZXQgJiYgcXVlc3QudGFyZ2V0LmtpbGwpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGsgb2YgcXVlc3QudGFyZ2V0LmtpbGwpIHtcbiAgICAgICAgICAgICAgaWYgKGFjdG9yLmlkID09IGsuaWQgJiYgay5jdXJyZW50IDwgay5uZWVkKSB7XG4gICAgICAgICAgICAgICAgay5jdXJyZW50Kys7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMub24oXCJjaGFuZ2VcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLm9udG8oKTtcbiAgICAgICAgdGhpcy50b3VjaCgpO1xuICAgICAgfSk7XG5cbiAgICAgIHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgaWYgKCAhR2FtZS5wYXVzZWQgKSB7XG4gICAgICAgICAgdGhpcy5vbnRvKCk7XG4gICAgICAgICAgdGhpcy50b3VjaCgpO1xuICAgICAgICB9XG4gICAgICB9LCA1MDApO1xuICAgIH1cblxuICAgIGdldCBiZUF0dGFja2luZyAoKSB7XG4gICAgICByZXR1cm4gaW50ZXJuYWwodGhpcykuYmVBdHRhY2tpbmc7XG4gICAgfVxuXG4gICAgc2V0IGJlQXR0YWNraW5nICh2YWx1ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2FtZS5oZXJvLmJlQXR0YWNraW5nIHJlYWRvbmx5XCIpO1xuICAgIH1cblxuICAgIGhhc0l0ZW0gKGlkLCBjb3VudCkge1xuICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShjb3VudCkgPT0gZmFsc2UgfHwgY291bnQgPD0gMCkge1xuICAgICAgICBjb3VudCA9IDE7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBrZXkgaW4gdGhpcy5kYXRhLml0ZW1zKSB7XG4gICAgICAgIGlmIChrZXkgPT0gaWQpIHtcbiAgICAgICAgICBpZiAodGhpcy5kYXRhLml0ZW1zW2tleV0gPj0gY291bnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaGFzUXVlc3QgKGlkKSB7XG4gICAgICBmb3IgKGxldCBxdWVzdCBvZiB0aGlzLmRhdGEuY3VycmVudFF1ZXN0KSB7XG4gICAgICAgIGlmIChpZCA9PSBxdWVzdC5pZCkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBxdWVzdCBvZiB0aGlzLmRhdGEuY29tcGxldGVRdWVzdCkge1xuICAgICAgICBpZiAoaWQgPT0gcXVlc3QuaWQpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGRhbWFnZSAoYXR0YWNrZXIsIHNraWxsKSB7XG4gICAgICBzdXBlci5kYW1hZ2UoYXR0YWNrZXIsIHNraWxsKTtcblxuICAgICAgLy8g5aaC5p6c6Iux6ZuE5Y+X5Yiw5LqG5Lyk5a6zXG4gICAgICBsZXQgdG91Y2hBY3RvciA9IFtdO1xuICAgICAgZm9yIChsZXQgYWN0b3Igb2YgR2FtZS5hcmVhLmFjdG9ycykge1xuICAgICAgICAvLyDmib7liLDmiYDmnInpgrvmjqXoi7Hpm4TnmoTmgKrnialcbiAgICAgICAgaWYgKGFjdG9yICE9IHRoaXMgJiYgYWN0b3IuZGF0YS50eXBlID09IFwibW9uc3RlclwiICYmIGFjdG9yLmRpc3RhbmNlKHRoaXMpID09IDEpIHtcbiAgICAgICAgICB0b3VjaEFjdG9yLnB1c2goYWN0b3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAodG91Y2hBY3Rvci5sZW5ndGgpIHtcbiAgICAgICAgbGV0IGZhY2VBdHRhY2tlciA9IGZhbHNlO1xuICAgICAgICBsZXQgZmFjZVBvc2l0aW9uID0gdGhpcy5mYWNlUG9zaXRpb247XG4gICAgICAgIHRvdWNoQWN0b3IuZm9yRWFjaChmdW5jdGlvbiAoYWN0b3IpIHtcbiAgICAgICAgICBpZiAoYWN0b3IuaGl0VGVzdChmYWNlUG9zaXRpb24ueCwgZmFjZVBvc2l0aW9uLnkpKSB7XG4gICAgICAgICAgICBmYWNlQXR0YWNrZXIgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIOWmguaenOiLsembhOeOsOWcqOayoemdouWvueS7u+S9leS4gOS4qumCu+aOpeeahOaAqueJqe+8jOmdouWQkeWug1xuICAgICAgICBpZiAoZmFjZUF0dGFja2VyID09IGZhbHNlKSB7XG4gICAgICAgICAgdGhpcy5nb3RvKHRvdWNoQWN0b3JbMF0ueCwgdG91Y2hBY3RvclswXS55KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGVyYXNlICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgc3VwZXIuZXJhc2UoKTtcblxuICAgICAgaWYgKHByaXZhdGVzLmFpKSB7XG4gICAgICAgIFNwcml0ZS5UaWNrZXIub2ZmKFwidGlja1wiLCBwcml2YXRlcy5haSk7XG4gICAgICAgIHByaXZhdGVzLmFpID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZWZyZXNoQmFyICgpIHtcbiAgICAgIHN1cGVyLnJlZnJlc2hCYXIoKTtcbiAgICAgIEdhbWUud2luZG93cy5pbnRlcmZhY2Uuc3RhdHVzKFxuICAgICAgICB0aGlzLmRhdGEuaHAgLyB0aGlzLmRhdGEuJGhwLCAvLyDnlJ/lkb3nmb7liIbmr5RcbiAgICAgICAgdGhpcy5kYXRhLnNwIC8gdGhpcy5kYXRhLiRzcCAvLyDnsr7npZ7lipvnmb7liIbmr5RcbiAgICAgICk7XG4gICAgfVxuXG4gICAgZHJhdyAoKSB7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcbiAgICAgIHN1cGVyLmRyYXcoKTtcblxuICAgICAgcHJpdmF0ZXMuYWkgPSBTcHJpdGUuVGlja2VyLm9uKFwidGlja1wiLCAoZXZlbnQpID0+IHtcblxuICAgICAgICBsZXQgdGlja0NvdW50ID0gZXZlbnQuZGF0YTtcblxuICAgICAgICAvLyDmr4/np5IxNuS4qnRpY2tcbiAgICAgICAgaWYgKHRpY2tDb3VudCAlIDE2ID09IDApIHtcbiAgICAgICAgICBsZXQgYmFyQ2hhbmdlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgaWYgKHRoaXMuZGF0YS5ocCA8IHRoaXMuZGF0YS4kaHAgJiYgdGhpcy5iZUF0dGFja2luZy5zaXplIDw9IDApIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YS5ocCsrO1xuICAgICAgICAgICAgYmFyQ2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHRoaXMuZGF0YS5zcCA8IHRoaXMuZGF0YS4kc3ApIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YS5zcCsrO1xuICAgICAgICAgICAgYmFyQ2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGJhckNoYW5nZWQpIHtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaEJhcigpO1xuICAgICAgICAgICAgaWYgKEdhbWUud2luZG93cy5zdGF0dXMuYXRvcCkge1xuICAgICAgICAgICAgICBHYW1lLndpbmRvd3Muc3RhdHVzLnVwZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9KTtcblxuICAgIH1cblxuXG4gICAgZ290b0FyZWEgKGRlc3QsIHgsIHkpIHtcbiAgICAgIHZhciBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgcHJpdmF0ZXMuYmVBdHRhY2tpbmcgPSBuZXcgU2V0KCk7XG4gICAgICBHYW1lLnBhdXNlKCk7XG4gICAgICBHYW1lLndpbmRvd3MuaW50ZXJmYWNlLmhpZGUoKTtcbiAgICAgIEdhbWUud2luZG93cy5zdGFnZS5oaWRlKCk7XG4gICAgICBHYW1lLndpbmRvd3MubG9hZGluZy5iZWdpbigpO1xuICAgICAgR2FtZS53aW5kb3dzLmxvYWRpbmcudXBkYXRlKFwiMjAlXCIpO1xuXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBHYW1lLmNsZWFyU3RhZ2UoKTtcbiAgICAgICAgR2FtZS53aW5kb3dzLmxvYWRpbmcudXBkYXRlKFwiNTAlXCIpO1xuXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgR2FtZS5sb2FkQXJlYShkZXN0KS50aGVuKGZ1bmN0aW9uIChhcmVhKSB7XG5cbiAgICAgICAgICAgIEdhbWUuYXJlYSA9IGFyZWE7XG4gICAgICAgICAgICBHYW1lLndpbmRvd3MubG9hZGluZy51cGRhdGUoXCI4MCVcIik7XG5cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgIEdhbWUuaGVyby5kYXRhLmFyZWEgPSBkZXN0O1xuICAgICAgICAgICAgICBHYW1lLmhlcm8uZHJhdygpO1xuICAgICAgICAgICAgICBHYW1lLmhlcm8ueCA9IHg7XG4gICAgICAgICAgICAgIEdhbWUuaGVyby55ID0geTtcbiAgICAgICAgICAgICAgYXJlYS5hY3RvcnMuYWRkKEdhbWUuaGVybyk7XG5cbiAgICAgICAgICAgICAgYXJlYS5tYXAuZHJhdygpO1xuICAgICAgICAgICAgICBHYW1lLndpbmRvd3MubG9hZGluZy51cGRhdGUoXCIxMDAlXCIpO1xuXG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgR2FtZS5oZXJvLnggPSB4O1xuICAgICAgICAgICAgICAgIEdhbWUuaGVyby55ID0geTtcbiAgICAgICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS50aW1lICs9IDYwOyAvLyDliqDkuIDlsI/ml7ZcbiAgICAgICAgICAgICAgICBHYW1lLndpbmRvd3MubG9hZGluZy5lbmQoKTtcbiAgICAgICAgICAgICAgICBHYW1lLndpbmRvd3MuaW50ZXJmYWNlLmRhdGV0aW1lKCk7XG4gICAgICAgICAgICAgICAgR2FtZS53aW5kb3dzLmludGVyZmFjZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICAgICAgR2FtZS5zdGFydCgpO1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgIEdhbWUuc3RhZ2UudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgICBHYW1lLndpbmRvd3Muc3RhZ2Uuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgR2FtZS53aW5kb3dzLmludGVyZmFjZS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfSwgNSk7XG4gICAgICAgICAgICAgIH0sIDUpO1xuICAgICAgICAgICAgfSwgNSk7XG4gICAgICAgICAgfSk7IC8vIGxvYWRBcmVhXG4gICAgICAgIH0sIDUpO1xuICAgICAgfSwgNSk7XG4gICAgfVxuXG4gICAgLy8g5b2T546p5a6256uZ5Yiw5p+Q5Liq54K555qE5pe25YCZ5omn6KGM55qE5ZG95LukXG4gICAgb250byAoKSB7XG4gICAgICBpZiAoIUdhbWUuYXJlYSkgcmV0dXJuO1xuICAgICAgaWYgKCFHYW1lLmFyZWEub250bykgcmV0dXJuO1xuXG4gICAgICBsZXQgaGVyb1Bvc2l0aW9uID0gR2FtZS5oZXJvLnBvc2l0aW9uO1xuICAgICAgbGV0IG9udG8gPSBudWxsO1xuXG4gICAgICBsZXQgRmluZFVuZGVySGVybyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIGlmIChvbnRvICE9IG51bGwgfHwgZWxlbWVudCA9PSBHYW1lLmhlcm8pIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW1lbnQuaGl0VGVzdCAmJiBlbGVtZW50LmhpdFRlc3QoaGVyb1Bvc2l0aW9uLngsIGhlcm9Qb3NpdGlvbi55KSkge1xuICAgICAgICAgIG9udG8gPSBlbGVtZW50O1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50LnBvaW50cykge1xuICAgICAgICAgIGZvciAobGV0IHAgb2YgZWxlbWVudC5wb2ludHMpIHtcbiAgICAgICAgICAgIGlmIChwLnggPT0gaGVyb1Bvc2l0aW9uLnggJiYgcC55ID09IGhlcm9Qb3NpdGlvbi55KSB7XG4gICAgICAgICAgICAgIG9udG8gPSBlbGVtZW50O1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIE51bWJlci5pc0Zpbml0ZShlbGVtZW50LngpICYmXG4gICAgICAgICAgTnVtYmVyLmlzRmluaXRlKGVsZW1lbnQueSkgJiZcbiAgICAgICAgICBlbGVtZW50LnggPT0gaGVyb1Bvc2l0aW9uLnggJiZcbiAgICAgICAgICBlbGVtZW50LnkgPT0gaGVyb1Bvc2l0aW9uLnlcbiAgICAgICAgKSB7XG4gICAgICAgICAgb250byA9IGVsZW1lbnQ7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyDmib7mnIDov5Hlj6/igJzkuovku7bigJ3kurrniakgR2FtZS5hcmVhLmFjdG9yc1xuICAgICAgU3ByaXRlLmVhY2goR2FtZS5hcmVhLm9udG8sIEZpbmRVbmRlckhlcm8pO1xuICAgICAgaWYgKG9udG8pIHtcbiAgICAgICAgaWYgKG9udG8uZXhlY3V0ZSkge1xuICAgICAgICAgIG9udG8uZXhlY3V0ZSgpO1xuICAgICAgICB9XG4gICAgICB9IC8vIHRvdWNoXG4gICAgfVxuXG4gICAgLy8g5b2T546p5a6256uZ5Yiw5oiW6ICF5o6l6Kem5Yiw5p+Q5Liq54K55pe25omn6KGM55qE5ZG95LukXG4gICAgdG91Y2ggKCkge1xuICAgICAgaWYgKCFHYW1lLmFyZWEpIHJldHVybjtcbiAgICAgIGlmICghR2FtZS5hcmVhLnRvdWNoKSByZXR1cm47XG5cbiAgICAgIGxldCBoZXJvUG9zaXRpb24gPSBHYW1lLmhlcm8ucG9zaXRpb247XG4gICAgICBsZXQgaGVyb0ZhY2UgPSBHYW1lLmhlcm8uZmFjZVBvc2l0aW9uO1xuICAgICAgbGV0IHRvdWNoID0gbnVsbDtcblxuICAgICAgbGV0IEZpbmRVbmRlckhlcm8gPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICBpZiAodG91Y2ggIT0gbnVsbCB8fCBlbGVtZW50ID09IEdhbWUuaGVybykge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbWVudC5oZXJvVXNlKSB7XG4gICAgICAgICAgaWYgKGVsZW1lbnQuaGl0VGVzdCAmJiBlbGVtZW50LmhpdFRlc3QoaGVyb1Bvc2l0aW9uLngsIGhlcm9Qb3NpdGlvbi55KSkge1xuICAgICAgICAgICAgdG91Y2ggPSBlbGVtZW50O1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5wb2ludHMpIHtcbiAgICAgICAgICAgIGZvciAobGV0IHAgb2YgZWxlbWVudC5wb2ludHMpIHtcbiAgICAgICAgICAgICAgaWYgKHAueCA9PSBoZXJvUG9zaXRpb24ueCAmJiBwLnkgPT0gaGVyb1Bvc2l0aW9uLnkpIHtcbiAgICAgICAgICAgICAgICB0b3VjaCA9IGVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgIE51bWJlci5pc0Zpbml0ZShlbGVtZW50LngpICYmXG4gICAgICAgICAgICBOdW1iZXIuaXNGaW5pdGUoZWxlbWVudC55KSAmJlxuICAgICAgICAgICAgZWxlbWVudC54ID09IGhlcm9Qb3NpdGlvbi54ICYmXG4gICAgICAgICAgICBlbGVtZW50LnkgPT0gaGVyb1Bvc2l0aW9uLnlcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHRvdWNoID0gZWxlbWVudDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbGV0IEZpbmRGYWNlSGVybyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgIGlmICh0b3VjaCAhPSBudWxsIHx8IGVsZW1lbnQgPT0gR2FtZS5oZXJvKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbGVtZW50Lmhlcm9Vc2UpIHtcbiAgICAgICAgICBpZiAoZWxlbWVudC5oaXRUZXN0ICYmIGVsZW1lbnQuaGl0VGVzdChoZXJvRmFjZS54LCBoZXJvRmFjZS55KSkge1xuICAgICAgICAgICAgdG91Y2ggPSBlbGVtZW50O1xuICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5wb2ludHMpIHtcbiAgICAgICAgICAgIGZvciAobGV0IHAgb2YgZWxlbWVudC5wb2ludHMpIHtcbiAgICAgICAgICAgICAgaWYgKHAueCA9PSBoZXJvRmFjZS54ICYmIHAueSA9PSBoZXJvRmFjZS55KSB7XG4gICAgICAgICAgICAgICAgdG91Y2ggPSBlbGVtZW50O1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICBOdW1iZXIuaXNGaW5pdGUoZWxlbWVudC54KSAmJlxuICAgICAgICAgICAgTnVtYmVyLmlzRmluaXRlKGVsZW1lbnQueSkgJiZcbiAgICAgICAgICAgIGVsZW1lbnQueCA9PSBoZXJvRmFjZS54ICYmXG4gICAgICAgICAgICBlbGVtZW50LnkgPT0gaGVyb0ZhY2UueVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgdG91Y2ggPSBlbGVtZW50O1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyDnlKhGaW5kVW5kZXJIZXJv5Ye95pWw5a+75om+5Yiw546p5a625b2T5YmN5qC85a2Q55qE5Zyw54K5XG5cbiAgICAgIC8vIOaJvuacgOi/keWPr+KAnOS6i+S7tuKAneS6uueJqSBHYW1lLmFyZWEuYWN0b3JzXG4gICAgICBTcHJpdGUuZWFjaChHYW1lLmFyZWEuYWN0b3JzLCBGaW5kVW5kZXJIZXJvKTtcbiAgICAgIC8vIOaJvuacgOi/keWwuOS9kyBHYW1lLmFyZWEuYmFnc1xuICAgICAgU3ByaXRlLmVhY2goR2FtZS5hcmVhLmJhZ3MsIEZpbmRVbmRlckhlcm8pO1xuICAgICAgLy8g5om+5pyA6L+R54mp5ZOBIEdhbWUuYXJlYS5pdGVtc1xuICAgICAgU3ByaXRlLmVhY2goR2FtZS5hcmVhLml0ZW1zLCBGaW5kVW5kZXJIZXJvKTtcbiAgICAgIC8vIOWFtuS7lueJqeWTge+8iOeUseWcsOWbvuaWh+S7tuWumuS5ie+8iVxuICAgICAgR2FtZS5hcmVhLnRvdWNoLmZvckVhY2goRmluZFVuZGVySGVybyk7XG5cbiAgICAgIC8vIOeUqEZpbmRGYWNlSGVyb+Wvu+aJvumdouWvueedgOeOqeWutueahOagvOWtkOWcsOeCuVxuXG4gICAgICAvLyDmib7mnIDov5Hlj6/igJzkuovku7bigJ3kurrniakgR2FtZS5hcmVhLmFjdG9yc1xuICAgICAgU3ByaXRlLmVhY2goR2FtZS5hcmVhLmFjdG9ycywgRmluZEZhY2VIZXJvKTtcbiAgICAgIC8vIOaJvuacgOi/keWwuOS9kyBHYW1lLmFyZWEuYmFnc1xuICAgICAgU3ByaXRlLmVhY2goR2FtZS5hcmVhLmJhZ3MsIEZpbmRGYWNlSGVybyk7XG4gICAgICAvLyDmib7mnIDov5HlsLjkvZMgR2FtZS5hcmVhLml0ZW1zXG4gICAgICBTcHJpdGUuZWFjaChHYW1lLmFyZWEuaXRlbXMsIEZpbmRGYWNlSGVybyk7XG4gICAgICAvLyDlhbbku5bnianlk4HvvIjnlLHlnLDlm77mlofku7blrprkuYnvvIlcbiAgICAgIEdhbWUuYXJlYS50b3VjaC5mb3JFYWNoKEZpbmRGYWNlSGVybyk7XG4gICAgICAvLyDmsLTmupBcbiAgICAgIGlmICghdG91Y2ggJiYgR2FtZS5hcmVhLm1hcC5oaXRXYXRlcihoZXJvRmFjZS54LCBoZXJvRmFjZS55KSkge1xuICAgICAgICB0b3VjaCA9IHtcbiAgICAgICAgICB0eXBlOiBcIndhdGVyXCIsXG4gICAgICAgICAgaGVyb1VzZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5wb3B1cChcIlRoaXMgaXMgd2F0ZXJcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRvdWNoKSB7XG4gICAgICAgIEdhbWUuaGludE9iamVjdCA9IG51bGw7XG4gICAgICAgIEdhbWUud2luZG93cy5pbnRlcmZhY2UuaGlkZVVzZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgR2FtZS5oaW50T2JqZWN0ID0gdG91Y2g7XG4gICAgICAgIEdhbWUud2luZG93cy5pbnRlcmZhY2Uuc2hvd1VzZSgpO1xuICAgICAgfVxuICAgIH1cblxuXG4gIH0pO1xuXG5cbn0pKCk7XG4iXX0=
/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
    英雄类
    属性：
      this.sprite 精灵
  */
  Game.assign("ActorMonster", (function (_Game$Actor) {
    _inherits(GameActorMonster, _Game$Actor);

    function GameActorMonster(actorData) {
      _classCallCheck(this, GameActorMonster);

      _get(Object.getPrototypeOf(GameActorMonster.prototype), "constructor", this).call(this, actorData);
      var privates = internal(this);
      privates.ai = null;
      privates.attacking = false;
    }

    _createClass(GameActorMonster, [{
      key: "damage",
      value: function damage(attacker, skill) {
        _get(Object.getPrototypeOf(GameActorMonster.prototype), "damage", this).call(this, attacker, skill);
        var privates = internal(this);

        if (privates.attacking == false) {
          this.goto(attacker.x, attacker.y, "walk");
        }
      }
    }, {
      key: "erase",
      value: function erase() {
        var privates = internal(this);
        _get(Object.getPrototypeOf(GameActorMonster.prototype), "erase", this).call(this);

        if (privates.ai) {
          Sprite.Ticker.off("tick", privates.ai);
          privates.ai = null;
        }
      }
    }, {
      key: "draw",
      value: function draw() {
        var _this = this;

        var privates = internal(this);
        _get(Object.getPrototypeOf(GameActorMonster.prototype), "draw", this).call(this);

        var dodo = Sprite.rand(30, 60);

        privates.ai = Sprite.Ticker.on("tick", function (event) {

          if (Game.paused) return;

          var tickCount = event.data;

          if (tickCount % 20 == 0) {
            var barChanged = false;

            if (_this.data.hp < _this.data.$hp && privates.attacking == false) {
              _this.data.hp++;
              barChanged = true;
            }

            if (_this.data.sp < _this.data.$sp) {
              _this.data.sp++;
              barChanged = true;
            }

            if (barChanged) {
              _this.refreshBar();
            }
          }

          if (privates.attacking) {
            if (tickCount % dodo == 0) {
              if (Game.hero && _this.facePosition.x == Game.hero.x && _this.facePosition.y == Game.hero.y) {
                if (_this.y == Game.hero.y) {
                  // left or right
                  if (_this.x < Game.hero.x) {
                    // left
                    _this.fire(_this.data.skills[0], "right");
                  } else {
                    // right
                    _this.fire(_this.data.skills[0], "left");
                  }
                } else {
                  // up or down
                  if (_this.y < Game.hero.y) {
                    // up
                    _this.fire(_this.data.skills[0], "down");
                  } else {
                    // down
                    _this.fire(_this.data.skills[0], "up");
                  }
                }
              }
            } else if (Game.hero && Game.hero.distance(_this) < 12) {
              _this.goto(Game.hero.x, Game.hero.y, "walk");
            } else {
              privates.attacking = false;
              if (Game.hero.beAttacking.has(_this)) {
                Game.hero.beAttacking["delete"](_this);
              }
            }
          } else {
            if (tickCount % dodo == 0) {
              if (Game.hero && Game.hero.distance(_this) < 8) {
                _this.goto(Game.hero.x, Game.hero.y, "walk");
                privates.attacking = true;
                Game.hero.beAttacking.add(_this);
              } else if (_this.data.mode == "patrol") {
                if (Math.random() > 0.3) {
                  _this.stop();
                  return;
                }
                var directions = ["down", "left", "right", "up"];
                _this.go("walk", directions[Math.floor(Math.random() * directions.length)], function () {
                  _this.stop();
                });
              }
            }
          } // not attacking
        });
      }
    }]);

    return GameActorMonster;
  })(Game.Actor));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVBY3Rvck1vbnN0ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7QUFFYixNQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7Ozs7Ozs7QUFPbEMsTUFBSSxDQUFDLE1BQU0sQ0FBQyxjQUFjO2NBQVEsZ0JBQWdCOztBQUNwQyxhQURvQixnQkFBZ0IsQ0FDbkMsU0FBUyxFQUFFOzRCQURRLGdCQUFnQjs7QUFFOUMsaUNBRjhCLGdCQUFnQiw2Q0FFeEMsU0FBUyxFQUFFO0FBQ2pCLFVBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM5QixjQUFRLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQztBQUNuQixjQUFRLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztLQUM1Qjs7aUJBTitCLGdCQUFnQjs7YUFRekMsZ0JBQUMsUUFBUSxFQUFFLEtBQUssRUFBRTtBQUN2QixtQ0FUOEIsZ0JBQWdCLHdDQVNqQyxRQUFRLEVBQUUsS0FBSyxFQUFFO0FBQzlCLFlBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQzs7QUFFOUIsWUFBSSxRQUFRLENBQUMsU0FBUyxJQUFJLEtBQUssRUFBRTtBQUMvQixjQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztTQUMzQztPQUNGOzs7YUFFSyxpQkFBRztBQUNQLFlBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM5QixtQ0FuQjhCLGdCQUFnQix1Q0FtQmhDOztBQUVkLFlBQUksUUFBUSxDQUFDLEVBQUUsRUFBRTtBQUNmLGdCQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsUUFBUSxD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QyIsImZpbGUiOiJHYW1lQWN0b3JNb25zdGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IGludGVybmFsID0gU3ByaXRlLk5hbWVzcGFjZSgpO1xuXG4gIC8qKlxuICAgIOiLsembhOexu1xuICAgIOWxnuaAp++8mlxuICAgICAgdGhpcy5zcHJpdGUg57K+54G1XG4gICovXG4gIEdhbWUuYXNzaWduKFwiQWN0b3JNb25zdGVyXCIsIGNsYXNzIEdhbWVBY3Rvck1vbnN0ZXIgZXh0ZW5kcyBHYW1lLkFjdG9yIHtcbiAgICBjb25zdHJ1Y3RvciAoYWN0b3JEYXRhKSB7XG4gICAgICBzdXBlcihhY3RvckRhdGEpO1xuICAgICAgbGV0IHByaXZhdGVzID0gaW50ZXJuYWwodGhpcyk7XG4gICAgICBwcml2YXRlcy5haSA9IG51bGw7XG4gICAgICBwcml2YXRlcy5hdHRhY2tpbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBkYW1hZ2UgKGF0dGFja2VyLCBza2lsbCkge1xuICAgICAgc3VwZXIuZGFtYWdlKGF0dGFja2VyLCBza2lsbCk7XG4gICAgICBsZXQgcHJpdmF0ZXMgPSBpbnRlcm5hbCh0aGlzKTtcblxuICAgICAgaWYgKHByaXZhdGVzLmF0dGFja2luZyA9PSBmYWxzZSkge1xuICAgICAgICB0aGlzLmdvdG8oYXR0YWNrZXIueCwgYXR0YWNrZXIueSwgXCJ3YWxrXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGVyYXNlICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgc3VwZXIuZXJhc2UoKTtcblxuICAgICAgaWYgKHByaXZhdGVzLmFpKSB7XG4gICAgICAgIFNwcml0ZS5UaWNrZXIub2ZmKFwidGlja1wiLCBwcml2YXRlcy5haSk7XG4gICAgICAgIHByaXZhdGVzLmFpID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkcmF3ICgpIHtcbiAgICAgIGxldCBwcml2YXRlcyA9IGludGVybmFsKHRoaXMpO1xuICAgICAgc3VwZXIuZHJhdygpO1xuXG4gICAgICBsZXQgZG9kbyA9IFNwcml0ZS5yYW5kKDMwLCA2MCk7XG5cbiAgICAgIHByaXZhdGVzLmFpID0gU3ByaXRlLlRpY2tlci5vbihcInRpY2tcIiwgKGV2ZW50KSA9PiB7XG5cbiAgICAgICAgaWYgKEdhbWUucGF1c2VkKSByZXR1cm47XG5cbiAgICAgICAgbGV0IHRpY2tDb3VudCA9IGV2ZW50LmRhdGE7XG5cbiAgICAgICAgaWYgKHRpY2tDb3VudCAlIDIwID09IDApIHtcbiAgICAgICAgICBsZXQgYmFyQ2hhbmdlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgaWYgKHRoaXMuZGF0YS5ocCA8IHRoaXMuZGF0YS4kaHAgJiYgcHJpdmF0ZXMuYXR0YWNraW5nID09IGZhbHNlKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGEuaHArKztcbiAgICAgICAgICAgIGJhckNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICh0aGlzLmRhdGEuc3AgPCB0aGlzLmRhdGEuJHNwKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGEuc3ArKztcbiAgICAgICAgICAgIGJhckNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChiYXJDaGFuZ2VkKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hCYXIoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocHJpdmF0ZXMuYXR0YWNraW5nKSB7XG4gICAgICAgICAgaWYgKHRpY2tDb3VudCAlIGRvZG8gPT0gMCkge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBHYW1lLmhlcm8gJiZcbiAgICAgICAgICAgICAgdGhpcy5mYWNlUG9zaXRpb24ueCA9PSBHYW1lLmhlcm8ueCAmJlxuICAgICAgICAgICAgICB0aGlzLmZhY2VQb3NpdGlvbi55ID09IEdhbWUuaGVyby55XG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgaWYgKHRoaXMueSA9PSBHYW1lLmhlcm8ueSkgeyAvLyBsZWZ0IG9yIHJpZ2h0XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMueCA8IEdhbWUuaGVyby54KSB7IC8vIGxlZnRcbiAgICAgICAgICAgICAgICAgIHRoaXMuZmlyZSh0aGlzLmRhdGEuc2tpbGxzWzBdLCBcInJpZ2h0XCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIHJpZ2h0XG4gICAgICAgICAgICAgICAgICB0aGlzLmZpcmUodGhpcy5kYXRhLnNraWxsc1swXSwgXCJsZWZ0XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gdXAgb3IgZG93blxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnkgPCBHYW1lLmhlcm8ueSkgeyAvLyB1cFxuICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKHRoaXMuZGF0YS5za2lsbHNbMF0sIFwiZG93blwiKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBkb3duXG4gICAgICAgICAgICAgICAgICB0aGlzLmZpcmUodGhpcy5kYXRhLnNraWxsc1swXSwgXCJ1cFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKEdhbWUuaGVybyAmJiBHYW1lLmhlcm8uZGlzdGFuY2UodGhpcykgPCAxMikge1xuICAgICAgICAgICAgdGhpcy5nb3RvKEdhbWUuaGVyby54LCBHYW1lLmhlcm8ueSwgXCJ3YWxrXCIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwcml2YXRlcy5hdHRhY2tpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChHYW1lLmhlcm8uYmVBdHRhY2tpbmcuaGFzKHRoaXMpKSB7XG4gICAgICAgICAgICAgIEdhbWUuaGVyby5iZUF0dGFja2luZy5kZWxldGUodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICh0aWNrQ291bnQgJSBkb2RvID09IDApIHtcbiAgICAgICAgICAgIGlmIChHYW1lLmhlcm8gJiYgR2FtZS5oZXJvLmRpc3RhbmNlKHRoaXMpIDwgOCkge1xuICAgICAgICAgICAgICB0aGlzLmdvdG8oR2FtZS5oZXJvLngsIEdhbWUuaGVyby55LCBcIndhbGtcIik7XG4gICAgICAgICAgICAgIHByaXZhdGVzLmF0dGFja2luZyA9IHRydWU7XG4gICAgICAgICAgICAgIEdhbWUuaGVyby5iZUF0dGFja2luZy5hZGQodGhpcyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZGF0YS5tb2RlID09IFwicGF0cm9sXCIpIHtcbiAgICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPiAwLjMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbGV0IGRpcmVjdGlvbnMgPSBbXCJkb3duXCIsIFwibGVmdFwiLCBcInJpZ2h0XCIsIFwidXBcIl07XG4gICAgICAgICAgICAgIHRoaXMuZ28oXCJ3YWxrXCIsXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBkaXJlY3Rpb25zLmxlbmd0aCldLFxuICAgICAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSAvLyBub3QgYXR0YWNraW5nXG5cblxuICAgICAgfSk7XG5cblxuICAgIH1cblxuXG4gIH0pO1xuXG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
    英雄类
    属性：
      this.sprite 精灵
  */
  Game.assign("ActorNPC", (function (_Game$Actor) {
    _inherits(GameActorNPC, _Game$Actor);

    function GameActorNPC(actorData) {
      _classCallCheck(this, GameActorNPC);

      _get(Object.getPrototypeOf(GameActorNPC.prototype), "constructor", this).call(this, actorData);
    }

    _createClass(GameActorNPC, [{
      key: "heroUse",
      value: function heroUse() {
        var _this = this;

        var data = this.data;

        var options = {};

        // npc对话，例如“闲谈”
        var contact = {};
        if (data.contact) {
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = data.contact[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var talk = _step.value;

              var result = true;
              // talk.condition 是对话条件，如果存在，它是一个函数
              if (typeof talk.condition == "function") {
                try {
                  result = talk.condition();
                } catch (e) {
                  console.error(this.id, this.data);
                  console.error(talk.condition);
                  console.error(talk.condition.toString());
                  throw e;
                }
              }
              if (result) {
                options[talk.name] = talk.name;
                contact[talk.name] = talk;
              }
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator["return"]) {
                _iterator["return"]();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }
        }

        // 玩家接受任务
        var quest = null;
        if (this.quest) {
          quest = this.quest.filter(function (quest) {
            if (Game.hero.hasQuest(quest.id)) {
              return false;
            }
            return true;
          });
          if (quest && quest.length) {
            options["任务"] = "quest";
          }
        }

        // 玩家完成任务
        var completeQuest = null;
        if (Game.hero.data.currentQuest.length) {
          completeQuest = [];
          var _iteratorNormalCompletion2 = true;
          var _didIteratorError2 = false;
          var _iteratorError2 = undefined;

          try {
            for (var _iterator2 = Game.hero.data.currentQuest[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              var _quest = _step2.value;

              if (_quest.to == this.id && Game.Quest.isComplete(_quest)) {
                completeQuest.push(_quest);
              }
            }
          } catch (err) {
            _didIteratorError2 = true;
            _iteratorError2 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion2 && _iterator2["return"]) {
                _iterator2["return"]();
              }
            } finally {
              if (_didIteratorError2) {
                throw _iteratorError2;
              }
            }
          }

          if (completeQuest.length > 0) {
            options["完成任务"] = "completeQuest";
          }
        }

        // NPC有的交易
        if (data.trade && data.items) {
          options["交易"] = "trade";
        }

        // 没有选项
        if (Object.keys(options).length <= 0) {
          return;
        }

        /*
          下面的代码中频繁调用了this.heroUse()
          是为了保证NPC对话框不会关闭，或者说玩家在执行完某个选项之后依然存在
          但是又不能简单的不关闭对话框，因为选项会有变化，所以要经常重新打开
        */
        Game.choice(options, function (choice) {
          switch (choice) {
            case "trade":
              // 玩家交易的选择，默认是买
              _this.heroUse();
              Game.windows.buy.open(data.items);
              break;
            case "quest":
              // 玩家接受任务的选择
              var questOption = {};
              quest.forEach(function (quest, index) {
                questOption[quest.name] = index;
              });
              Game.choice(questOption, function (choice) {
                if (Number.isInteger(choice)) {
                  (function () {
                    var q = quest[choice];
                    Game.confirm({
                      message: q.before,
                      yes: "接受任务",
                      no: "拒绝"
                    }, function () {
                      Game.hero.data.currentQuest.push(q);
                      _this.heroUse();
                    }, function () {
                      _this.heroUse();
                    });
                  })();
                } else {
                  _this.heroUse();
                }
              });
              break;
            case "completeQuest":
              // 玩家完成了某个任务的选择
              var completeQuestOption = {};
              completeQuest.forEach(function (quest, index) {
                completeQuestOption[quest.name] = index;
              });
              Game.choice(completeQuestOption, function (choice) {
                if (Number.isInteger(choice)) {
                  var _quest2 = completeQuest[choice];

                  Game.hero.data.currentQuest.splice(Game.hero.data.currentQuest.indexOf(_quest2), 1);
                  Game.hero.data.completeQuest.push(_quest2);

                  _this.heroUse();
                  Game.dialogue([_quest2.finish], data.name);
                  if (_quest2.reward) {
                    if (_quest2.reward.gold) {
                      Game.hero.data.gold += _quest2.reward.gold;
                    }
                    if (_quest2.reward.exp) {
                      Game.hero.data.exp += _quest2.reward.exp;
                    }
                  }
                };
              });
              break;
            default:
              // 其他选择都没选的情况下，就是对话选择，例如“闲谈”
              if (contact[choice]) {
                _this.heroUse();
                Game.dialogue(contact[choice].content, data.name);
              }
          }
        });
      }
    }]);

    return GameActorNPC;
  })(Game.Actor));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVBY3Rvck5QQy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkEsQ0FBQyxZQUFZO0FBQ1gsY0FBWSxDQUFDOztBQUViLE1BQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQzs7Ozs7OztBQU9sQyxNQUFJLENBQUMsTUFBTSxDQUFDLFVBQVU7Y0FBUSxZQUFZOztBQUM1QixhQURnQixZQUFZLENBQzNCLFNBQVMsRUFBRTs0QkFESSxZQUFZOztBQUV0QyxpQ0FGMEIsWUFBWSw2Q0FFaEMsU0FBUyxFQUFFO0tBQ2xCOztpQkFIMkIsWUFBWTs7YUFLaEMsbUJBQUc7OztBQUNULFlBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7O0FBRXJCLFlBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQzs7O0FBR2pCLFlBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztBQUNqQixZQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7Ozs7OztBQUNoQixpQ0FBaUIsSUFBSSxDQUFDLE9BQU8sOEhBQUU7a0JBQXRCLElBQUk7O0FBQ1gsa0JBQUksTUFBTSxHQUFHLElBQUksQ0FBQzs7QUFFbEIsa0JBQUksT0FBTyxJQUFJLENBQUMsU0FBUyxJQUFJLFVBQVUsRUFBRTtBQUN2QyxvQkFBSTtBQUNGLHdCQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2lCQUMzQixDQUFDLE9BQU8sQ0FBQyxFQUFFO0FBQ1YseUJBQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDbEMseUJBQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzlCLHlCQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztBQUN6Qyx3QkFB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LEVBQUU7QUFDaEIsd0JBQUksT0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUU7QUFDckIsMEJBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxPQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztxQkFDMUM7QUFDRCx3QkFBSSxPQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRTtBQUNwQiwwQkFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLE9BQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDO3FCQUN4QzttQkFDRjtpQkFDRixDQUFDO2VBQ0gsQ0FBQyxDQUFDO0FBQ0gsb0JBQU07QUFBQSxBQUNSOztBQUNFLGtCQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtBQUNuQixzQkFBSyxPQUFPLEVBQUUsQ0FBQztBQUNmLG9CQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2VBQ25EO0FBQUEsV0FDSjtTQUNGLENBQUMsQ0FBQztPQUNKOzs7V0EzSTJCLFlBQVk7S0FBUyxJQUFJLENBQUMsS0FBSyxFQTZJM0QsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVBY3Rvck5QQy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cbihmdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGxldCBpbnRlcm5hbCA9IFNwcml0ZS5OYW1lc3BhY2UoKTtcblxuICAvKipcbiAgICDoi7Hpm4TnsbtcbiAgICDlsZ7mgKfvvJpcbiAgICAgIHRoaXMuc3ByaXRlIOeyvueBtVxuICAqL1xuICBHYW1lLmFzc2lnbihcIkFjdG9yTlBDXCIsIGNsYXNzIEdhbWVBY3Rvck5QQyBleHRlbmRzIEdhbWUuQWN0b3Ige1xuICAgIGNvbnN0cnVjdG9yIChhY3RvckRhdGEpIHtcbiAgICAgIHN1cGVyKGFjdG9yRGF0YSk7XG4gICAgfVxuXG4gICAgaGVyb1VzZSAoKSB7XG4gICAgICBsZXQgZGF0YSA9IHRoaXMuZGF0YTtcblxuICAgICAgbGV0IG9wdGlvbnMgPSB7fTtcblxuICAgICAgLy8gbnBj5a+56K+d77yM5L6L5aaC4oCc6Zey6LCI4oCdXG4gICAgICBsZXQgY29udGFjdCA9IHt9O1xuICAgICAgaWYgKGRhdGEuY29udGFjdCkge1xuICAgICAgICBmb3IgKGxldCB0YWxrIG9mIGRhdGEuY29udGFjdCkge1xuICAgICAgICAgIGxldCByZXN1bHQgPSB0cnVlO1xuICAgICAgICAgIC8vIHRhbGsuY29uZGl0aW9uIOaYr+WvueivneadoeS7tu+8jOWmguaenOWtmOWcqO+8jOWug+aYr+S4gOS4quWHveaVsFxuICAgICAgICAgIGlmICh0eXBlb2YgdGFsay5jb25kaXRpb24gPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICByZXN1bHQgPSB0YWxrLmNvbmRpdGlvbigpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHRoaXMuaWQsIHRoaXMuZGF0YSk7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IodGFsay5jb25kaXRpb24pO1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHRhbGsuY29uZGl0aW9uLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICBvcHRpb25zW3RhbGsubmFtZV0gPSB0YWxrLm5hbWU7XG4gICAgICAgICAgICBjb250YWN0W3RhbGsubmFtZV0gPSB0YWxrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyDnjqnlrrbmjqXlj5fku7vliqFcbiAgICAgIGxldCBxdWVzdCA9IG51bGw7XG4gICAgICBpZiAodGhpcy5xdWVzdCkge1xuICAgICAgICBxdWVzdCA9IHRoaXMucXVlc3QuZmlsdGVyKGZ1bmN0aW9uIChxdWVzdCkge1xuICAgICAgICAgIGlmIChHYW1lLmhlcm8uaGFzUXVlc3QocXVlc3QuaWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHF1ZXN0ICYmIHF1ZXN0Lmxlbmd0aCkge1xuICAgICAgICAgIG9wdGlvbnNbXCLku7vliqFcIl0gPSBcInF1ZXN0XCI7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8g546p5a625a6M5oiQ5Lu75YqhXG4gICAgICBsZXQgY29tcGxldGVRdWVzdCA9IG51bGw7XG4gICAgICBpZiAoR2FtZS5oZXJvLmRhdGEuY3VycmVudFF1ZXN0Lmxlbmd0aCkge1xuICAgICAgICBjb21wbGV0ZVF1ZXN0ID0gW107XG4gICAgICAgIGZvciAobGV0IHF1ZXN0IG9mIEdhbWUuaGVyby5kYXRhLmN1cnJlbnRRdWVzdCkge1xuICAgICAgICAgIGlmIChxdWVzdC50byA9PSB0aGlzLmlkICYmIEdhbWUuUXVlc3QuaXNDb21wbGV0ZShxdWVzdCkpIHtcbiAgICAgICAgICAgIGNvbXBsZXRlUXVlc3QucHVzaChxdWVzdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjb21wbGV0ZVF1ZXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBvcHRpb25zW1wi5a6M5oiQ5Lu75YqhXCJdID0gXCJjb21wbGV0ZVF1ZXN0XCI7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gTlBD5pyJ55qE5Lqk5piTXG4gICAgICBpZiAoZGF0YS50cmFkZSAmJiBkYXRhLml0ZW1zKSB7XG4gICAgICAgIG9wdGlvbnNbXCLkuqTmmJNcIl0gPSBcInRyYWRlXCI7XG4gICAgICB9XG5cbiAgICAgIC8vIOayoeaciemAiemhuVxuICAgICAgaWYgKE9iamVjdC5rZXlzKG9wdGlvbnMpLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLypcbiAgICAgICAg5LiL6Z2i55qE5Luj56CB5Lit6aKR57mB6LCD55So5LqGdGhpcy5oZXJvVXNlKClcbiAgICAgICAg5piv5Li65LqG5L+d6K+BTlBD5a+56K+d5qGG5LiN5Lya5YWz6Zet77yM5oiW6ICF6K+0546p5a625Zyo5omn6KGM5a6M5p+Q5Liq6YCJ6aG55LmL5ZCO5L6d54S25a2Y5ZyoXG4gICAgICAgIOS9huaYr+WPiOS4jeiDveeugOWNleeahOS4jeWFs+mXreWvueivneahhu+8jOWboOS4uumAiemhueS8muacieWPmOWMlu+8jOaJgOS7peimgee7j+W4uOmHjeaWsOaJk+W8gFxuICAgICAgKi9cbiAgICAgIEdhbWUuY2hvaWNlKG9wdGlvbnMsIChjaG9pY2UpID0+IHtcbiAgICAgICAgc3dpdGNoIChjaG9pY2UpIHtcbiAgICAgICAgICBjYXNlIFwidHJhZGVcIjogLy8g546p5a625Lqk5piT55qE6YCJ5oup77yM6buY6K6k5piv5LmwXG4gICAgICAgICAgICB0aGlzLmhlcm9Vc2UoKTtcbiAgICAgICAgICAgIEdhbWUud2luZG93cy5idXkub3BlbihkYXRhLml0ZW1zKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJxdWVzdFwiOiAvLyDnjqnlrrbmjqXlj5fku7vliqHnmoTpgInmi6lcbiAgICAgICAgICAgIGxldCBxdWVzdE9wdGlvbiA9IHt9O1xuICAgICAgICAgICAgcXVlc3QuZm9yRWFjaCgocXVlc3QsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgIHF1ZXN0T3B0aW9uW3F1ZXN0Lm5hbWVdID0gaW5kZXg7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIEdhbWUuY2hvaWNlKHF1ZXN0T3B0aW9uLCAoY2hvaWNlKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGNob2ljZSkpIHtcbiAgICAgICAgICAgICAgICBsZXQgcSA9IHF1ZXN0W2Nob2ljZV07XG4gICAgICAgICAgICAgICAgR2FtZS5jb25maXJtKHtcbiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHEuYmVmb3JlLFxuICAgICAgICAgICAgICAgICAgeWVzOiBcIuaOpeWPl+S7u+WKoVwiLFxuICAgICAgICAgICAgICAgICAgbm86IFwi5ouS57udXCJcbiAgICAgICAgICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS5jdXJyZW50UXVlc3QucHVzaChxKTtcbiAgICAgICAgICAgICAgICAgIHRoaXMuaGVyb1VzZSgpO1xuICAgICAgICAgICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuaGVyb1VzZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVyb1VzZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJjb21wbGV0ZVF1ZXN0XCI6IC8vIOeOqeWutuWujOaIkOS6huafkOS4quS7u+WKoeeahOmAieaLqVxuICAgICAgICAgICAgbGV0IGNvbXBsZXRlUXVlc3RPcHRpb24gPSB7fTtcbiAgICAgICAgICAgIGNvbXBsZXRlUXVlc3QuZm9yRWFjaCgocXVlc3QsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgIGNvbXBsZXRlUXVlc3RPcHRpb25bcXVlc3QubmFtZV0gPSBpbmRleDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgR2FtZS5jaG9pY2UoY29tcGxldGVRdWVzdE9wdGlvbiwgKGNob2ljZSkgPT4ge1xuICAgICAgICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihjaG9pY2UpKSB7XG4gICAgICAgICAgICAgICAgbGV0IHF1ZXN0ID0gY29tcGxldGVRdWVzdFtjaG9pY2VdO1xuXG4gICAgICAgICAgICAgICAgR2FtZS5oZXJvLmRhdGEuY3VycmVudFF1ZXN0LnNwbGljZShcbiAgICAgICAgICAgICAgICAgIEdhbWUuaGVyby5kYXRhLmN1cnJlbnRRdWVzdC5pbmRleE9mKHF1ZXN0KSwgMVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgR2FtZS5oZXJvLmRhdGEuY29tcGxldGVRdWVzdC5wdXNoKHF1ZXN0KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuaGVyb1VzZSgpO1xuICAgICAgICAgICAgICAgIEdhbWUuZGlhbG9ndWUoW3F1ZXN0LmZpbmlzaF0sIGRhdGEubmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKHF1ZXN0LnJld2FyZCkge1xuICAgICAgICAgICAgICAgICAgaWYgKHF1ZXN0LnJld2FyZC5nb2xkKSB7XG4gICAgICAgICAgICAgICAgICAgIEdhbWUuaGVyby5kYXRhLmdvbGQgKz0gcXVlc3QucmV3YXJkLmdvbGQ7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiAocXVlc3QucmV3YXJkLmV4cCkge1xuICAgICAgICAgICAgICAgICAgICBHYW1lLmhlcm8uZGF0YS5leHAgKz0gcXVlc3QucmV3YXJkLmV4cDtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6IC8vIOWFtuS7lumAieaLqemDveayoemAieeahOaDheWGteS4i++8jOWwseaYr+WvueivnemAieaLqe+8jOS+i+WmguKAnOmXsuiwiOKAnVxuICAgICAgICAgICAgaWYgKGNvbnRhY3RbY2hvaWNlXSkge1xuICAgICAgICAgICAgICB0aGlzLmhlcm9Vc2UoKTtcbiAgICAgICAgICAgICAgR2FtZS5kaWFsb2d1ZShjb250YWN0W2Nob2ljZV0uY29udGVudCwgZGF0YS5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gIH0pO1xuXG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; desc = parent = getter = undefined; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

(function () {
  "use strict";

  var internal = Sprite.Namespace();

  /**
    英雄类
    属性：
      this.sprite 精灵
  */
  Game.assign("ActorPet", (function (_Game$Actor) {
    _inherits(GameActorPet, _Game$Actor);

    function GameActorPet(actorData) {
      _classCallCheck(this, GameActorPet);

      _get(Object.getPrototypeOf(GameActorPet.prototype), "constructor", this).call(this, actorData);
    }

    return GameActorPet;
  })(Game.Actor));
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVBY3RvclBldC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7QUFFYixNQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7Ozs7Ozs7QUFPbEMsTUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVO2NBQVEsWUFBWTs7QUFDNUIsYUFEZ0IsWUFBWSxDQUMzQixTQUFTLEVBQUU7NEJBREksWUFBWTs7QUFFdEMsaUNBRjBCLFlBQVksNkNBRWhDLFNBQVMsRUFBRTtLQUNsQjs7V0FIMkIsWUFBWTtLQUFTLElBQUksQ0FBQyxLQUFLLEVBTTNELENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lQWN0b3JQZXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBsZXQgaW50ZXJuYWwgPSBTcHJpdGUuTmFtZXNwYWNlKCk7XG5cbiAgLyoqXG4gICAg6Iux6ZuE57G7XG4gICAg5bGe5oCn77yaXG4gICAgICB0aGlzLnNwcml0ZSDnsr7ngbVcbiAgKi9cbiAgR2FtZS5hc3NpZ24oXCJBY3RvclBldFwiLCBjbGFzcyBHYW1lQWN0b3JQZXQgZXh0ZW5kcyBHYW1lLkFjdG9yIHtcbiAgICBjb25zdHJ1Y3RvciAoYWN0b3JEYXRhKSB7XG4gICAgICBzdXBlcihhY3RvckRhdGEpO1xuICAgIH1cblxuXG4gIH0pO1xuXG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  // 合并图片
  // 把images中的所有图片按顺序draw到一个canvas上面，然后用canvas.toDataURL返回一张叠好的图片
  function CombineHeroImage(images, width, height) {
    return new Promise(function (resolve, reject) {
      var canvas = document.createElement("canvas");
      canvas.height = height;
      canvas.width = width;
      var context = canvas.getContext("2d");
      context.clearRect(0, 0, width, height);

      var length = images.length - 1; // 最后一张图是武器
      for (var i = 0; i < length; i++) {
        var img = images[i];
        context.drawImage(img, 0, 0, img.width, img.height, 0, 0, width, height);
      }

      var withoutWeapon = null;
      var withWeapon = null;

      var promises = new Set();

      withoutWeapon = new Image();
      withoutWeapon.src = canvas.toDataURL("image/png");

      promises.add(new Promise(function (resolve, reject) {
        if (withoutWeapon.complete) {
          resolve();
        } else {
          withoutWeapon.onload = function () {
            resolve();
          };
        }
      }));

      context.drawImage(images[length], 0, 0, images[length].width, images[length].height, 0, 0, width, height);

      withWeapon = new Image();
      withWeapon.src = canvas.toDataURL("image/png");

      promises.add(new Promise(function (resolve, reject) {
        if (withWeapon.complete) {
          resolve();
        } else {
          withWeapon.onload = function () {
            resolve();
          };
        }
      }));

      // Promise es6
      Promise.all(promises).then(function () {
        resolve([withoutWeapon, withWeapon]);
      });
    });
  }

  function Check(str) {
    if (typeof str == "string" && str.length > 0) return true;
    return false;
  }

  // 把多张图片合成一张，并返回
  Game.assign("drawHero", function (heroCustom) {
    return new Promise(function (resolve, reject) {
      var BASE = "hero";
      var imageUrls = [];

      if (Check(heroCustom.sex) && Check(heroCustom.body)) {
        // 必须按顺序
        // 身体
        imageUrls.push(BASE + "/body/" + heroCustom.sex + "/" + heroCustom.body + ".png");
        // 眼睛
        if (Check(heroCustom.eyes)) imageUrls.push(BASE + "/body/" + heroCustom.sex + "/eyes/" + heroCustom.eyes + ".png");
        // 衣服
        if (Check(heroCustom.shirts)) imageUrls.push(BASE + "/shirts/" + heroCustom.sex + "/" + heroCustom.shirts + ".png");
        if (Check(heroCustom.pants)) imageUrls.push(BASE + "/pants/" + heroCustom.sex + "/" + heroCustom.pants + ".png");
        if (Check(heroCustom.shoes))
          // 盔甲
          imageUrls.push(BASE + "/shoes/" + heroCustom.sex + "/" + heroCustom.shoes + ".png");
        if (Check(heroCustom.armorchest)) imageUrls.push(BASE + "/armor/chest/" + heroCustom.sex + "/" + heroCustom.armorchest + ".png");
        if (Check(heroCustom.armorarm)) imageUrls.push(BASE + "/armor/arm/" + heroCustom.sex + "/" + heroCustom.armorarm + ".png");
        if (Check(heroCustom.armorlegs)) imageUrls.push(BASE + "/armor/legs/" + heroCustom.sex + "/" + heroCustom.armorlegs + ".png");
        if (Check(heroCustom.armorfeet)) imageUrls.push(BASE + "/armor/feet/" + heroCustom.sex + "/" + heroCustom.armorfeet + ".png");
        // 头发
        if (Check(heroCustom.hair) && Check(heroCustom.haircolor)) imageUrls.push(BASE + "/hair/" + heroCustom.sex + "/" + heroCustom.hair + "/" + heroCustom.haircolor + ".png");
        // 头
        if (Check(heroCustom.head)) imageUrls.push(BASE + "/head/" + heroCustom.sex + "/" + heroCustom.head + ".png");
        // 头盔
        if (Check(heroCustom.armorhelms)) imageUrls.push(BASE + "/armor/helms/" + heroCustom.sex + "/" + heroCustom.armorhelms + ".png");
        // 武器（包括所有武器）
        imageUrls.push(BASE + "/weapons/" + heroCustom.sex + "/weapons.png");
      }

      Sprite.load(imageUrls).then(function (data) {
        CombineHeroImage(data, heroCustom.width, heroCustom.height).then(function (data) {
          resolve(data);
        });
      });
    });
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVEcmF3SGVyby5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBcUJBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7OztBQUliLFdBQVMsZ0JBQWdCLENBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUU7QUFDaEQsV0FBTyxJQUFJLE9BQU8sQ0FBQyxVQUFVLE9BQU8sRUFBRSxNQUFNLEVBQUU7QUFDNUMsVUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUM5QyxZQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztBQUN2QixZQUFNLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztBQUNyQixVQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3RDLGFBQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7O0FBRXZDLFVBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0FBQy9CLFdBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDL0IsWUFBSSxHQUFHLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3BCLGVBQU8sQ0FBQyxTQUFTLENBQ2YsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsTUFBTSxFQUNoQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQ3BCLENBQUM7T0FDSDs7QUFFRCxVQUFJLGFBQWEsR0FBRyxJQUFJLENBQUM7QUFDekIsVUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDOztBQUV0QixVQUFJLFFBQVEsR0FBRyxJ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VSxDQUFDLEdBQUcsU0FBSSxVQUFVLENBQUMsSUFBSSxVQUFPLENBQUM7O0FBRTFFLFlBQUksS0FBSyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFDOUIsU0FBUyxDQUFDLElBQUksQ0FBSSxJQUFJLHFCQUFnQixVQUFVLENBQUMsR0FBRyxTQUFJLFVBQVUsQ0FBQyxVQUFVLFVBQU8sQ0FBQzs7QUFFdkYsaUJBQVMsQ0FBQyxJQUFJLENBQUksSUFBSSxpQkFBWSxVQUFVLENBQUMsR0FBRyxrQkFBZSxDQUFDO09BQ2pFOztBQUVELFlBQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxFQUFFO0FBQzFDLHdCQUFnQixDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxJQUFJLEVBQUU7QUFDL0UsaUJBQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNmLENBQUMsQ0FBQztPQUNKLENBQUMsQ0FBQztLQUNKLENBQUMsQ0FBQztHQUdKLENBQUMsQ0FBQztDQUdKLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6IkdhbWVEcmF3SGVyby5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5cbkEtUlBHIEdhbWUsIEJ1aWx0IHVzaW5nIEphdmFTY3JpcHQgRVM2XG5Db3B5cmlnaHQgKEMpIDIwMTUgcWhkdWFuKGh0dHA6Ly9xaGR1YW4uY29tKVxuXG5UaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbnRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4oYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuXG5UaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbmJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG5NRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG5HTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuXG5Zb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZVxuYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG5cbiovXG5cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgLy8g5ZCI5bm25Zu+54mHXG4gIC8vIOaKimltYWdlc+S4reeahOaJgOacieWbvueJh+aMiemhuuW6j2RyYXfliLDkuIDkuKpjYW52YXPkuIrpnaLvvIznhLblkI7nlKhjYW52YXMudG9EYXRhVVJM6L+U5Zue5LiA5byg5Y+g5aW955qE5Zu+54mHXG4gIGZ1bmN0aW9uIENvbWJpbmVIZXJvSW1hZ2UgKGltYWdlcywgd2lkdGgsIGhlaWdodCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICBjYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICAgIGxldCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIGNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgICBsZXQgbGVuZ3RoID0gaW1hZ2VzLmxlbmd0aCAtIDE7IC8vIOacgOWQjuS4gOW8oOWbvuaYr+atpuWZqFxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgaW1nID0gaW1hZ2VzW2ldO1xuICAgICAgICBjb250ZXh0LmRyYXdJbWFnZShcbiAgICAgICAgICBpbWcsIDAsIDAsIGltZy53aWR0aCwgaW1nLmhlaWdodCxcbiAgICAgICAgICAwLCAwLCB3aWR0aCwgaGVpZ2h0XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGxldCB3aXRob3V0V2VhcG9uID0gbnVsbDtcbiAgICAgIGxldCB3aXRoV2VhcG9uID0gbnVsbDtcblxuICAgICAgbGV0IHByb21pc2VzID0gbmV3IFNldCgpO1xuXG4gICAgICB3aXRob3V0V2VhcG9uID0gbmV3IEltYWdlKCk7XG4gICAgICB3aXRob3V0V2VhcG9uLnNyYyA9IGNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIik7XG5cbiAgICAgIHByb21pc2VzLmFkZChcbiAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIGlmICh3aXRob3V0V2VhcG9uLmNvbXBsZXRlKSB7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdpdGhvdXRXZWFwb24ub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAgIGNvbnRleHQuZHJhd0ltYWdlKFxuICAgICAgICBpbWFnZXNbbGVuZ3RoXSwgMCwgMCwgaW1hZ2VzW2xlbmd0aF0ud2lkdGgsIGltYWdlc1tsZW5ndGhdLmhlaWdodCxcbiAgICAgICAgMCwgMCwgd2lkdGgsIGhlaWdodFxuICAgICAgKTtcblxuICAgICAgd2l0aFdlYXBvbiA9IG5ldyBJbWFnZSgpO1xuICAgICAgd2l0aFdlYXBvbi5zcmMgPSBjYW52YXMudG9EYXRhVVJMKFwiaW1hZ2UvcG5nXCIpO1xuXG4gICAgICBwcm9taXNlcy5hZGQoXG4gICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICBpZiAod2l0aFdlYXBvbi5jb21wbGV0ZSkge1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3aXRoV2VhcG9uLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICAvLyBQcm9taXNlIGVzNiBcbiAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVzb2x2ZShbd2l0aG91dFdlYXBvbiwgd2l0aFdlYXBvbl0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIENoZWNrIChzdHIpIHtcbiAgICBpZiAodHlwZW9mIHN0ciA9PSBcInN0cmluZ1wiICYmIHN0ci5sZW5ndGggPiAwKVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8g5oqK5aSa5byg5Zu+54mH5ZCI5oiQ5LiA5byg77yM5bm26L+U5ZueXG4gIEdhbWUuYXNzaWduKFwiZHJhd0hlcm9cIiwgZnVuY3Rpb24gKGhlcm9DdXN0b20pIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgbGV0IEJBU0UgPSBcImhlcm9cIjtcbiAgICAgIGxldCBpbWFnZVVybHMgPSBbXTtcblxuICAgICAgaWYgKENoZWNrKGhlcm9DdXN0b20uc2V4KSAmJiBDaGVjayhoZXJvQ3VzdG9tLmJvZHkpKSB7XG4gICAgICAgIC8vIOW/hemhu+aMiemhuuW6j1xuICAgICAgICAvLyDouqvkvZNcbiAgICAgICAgaW1hZ2VVcmxzLnB1c2goYCR7QkFTRX0vYm9keS8ke2hlcm9DdXN0b20uc2V4fS8ke2hlcm9DdXN0b20uYm9keX0ucG5nYCk7XG4gICAgICAgIC8vIOecvOedm1xuICAgICAgICBpZiAoQ2hlY2soaGVyb0N1c3RvbS5leWVzKSlcbiAgICAgICAgICBpbWFnZVVybHMucHVzaChgJHtCQVNFfS9ib2R5LyR7aGVyb0N1c3RvbS5zZXh9L2V5ZXMvJHtoZXJvQ3VzdG9tLmV5ZXN9LnBuZ2ApO1xuICAgICAgICAvLyDooaPmnI1cbiAgICAgICAgaWYgKENoZWNrKGhlcm9DdXN0b20uc2hpcnRzKSlcbiAgICAgICAgICBpbWFnZVVybHMucHVzaChgJHtCQVNFfS9zaGlydHMvJHtoZXJvQ3VzdG9tLnNleH0vJHtoZXJvQ3VzdG9tLnNoaXJ0c30ucG5nYCk7XG4gICAgICAgIGlmIChDaGVjayhoZXJvQ3VzdG9tLnBhbnRzKSlcbiAgICAgICAgICBpbWFnZVVybHMucHVzaChgJHtCQVNFfS9wYW50cy8ke2hlcm9DdXN0b20uc2V4fS8ke2hlcm9DdXN0b20ucGFudHN9LnBuZ2ApO1xuICAgICAgICBpZiAoQ2hlY2soaGVyb0N1c3RvbS5zaG9lcykpXG4gICAgICAgIC8vIOeblOeUslxuICAgICAgICAgIGltYWdlVXJscy5wdXNoKGAke0JBU0V9L3Nob2VzLyR7aGVyb0N1c3RvbS5zZXh9LyR7aGVyb0N1c3RvbS5zaG9lc30ucG5nYCk7XG4gICAgICAgIGlmIChDaGVjayhoZXJvQ3VzdG9tLmFybW9yY2hlc3QpKVxuICAgICAgICAgIGltYWdlVXJscy5wdXNoKGAke0JBU0V9L2FybW9yL2NoZXN0LyR7aGVyb0N1c3RvbS5zZXh9LyR7aGVyb0N1c3RvbS5hcm1vcmNoZXN0fS5wbmdgKTtcbiAgICAgICAgaWYgKENoZWNrKGhlcm9DdXN0b20uYXJtb3Jhcm0pKVxuICAgICAgICAgIGltYWdlVXJscy5wdXNoKGAke0JBU0V9L2FybW9yL2FybS8ke2hlcm9DdXN0b20uc2V4fS8ke2hlcm9DdXN0b20uYXJtb3Jhcm19LnBuZ2ApO1xuICAgICAgICBpZiAoQ2hlY2soaGVyb0N1c3RvbS5hcm1vcmxlZ3MpKVxuICAgICAgICAgIGltYWdlVXJscy5wdXNoKGAke0JBU0V9L2FybW9yL2xlZ3MvJHtoZXJvQ3VzdG9tLnNleH0vJHtoZXJvQ3VzdG9tLmFybW9ybGVnc30ucG5nYCk7XG4gICAgICAgIGlmIChDaGVjayhoZXJvQ3VzdG9tLmFybW9yZmVldCkpXG4gICAgICAgICAgaW1hZ2VVcmxzLnB1c2goYCR7QkFTRX0vYXJtb3IvZmVldC8ke2hlcm9DdXN0b20uc2V4fS8ke2hlcm9DdXN0b20uYXJtb3JmZWV0fS5wbmdgKTtcbiAgICAgICAgLy8g5aS05Y+RXG4gICAgICAgIGlmIChDaGVjayhoZXJvQ3VzdG9tLmhhaXIpICYmIENoZWNrKGhlcm9DdXN0b20uaGFpcmNvbG9yKSlcbiAgICAgICAgICBpbWFnZVVybHMucHVzaChgJHtCQVNFfS9oYWlyLyR7aGVyb0N1c3RvbS5zZXh9LyR7aGVyb0N1c3RvbS5oYWlyfS8ke2hlcm9DdXN0b20uaGFpcmNvbG9yfS5wbmdgKTtcbiAgICAgICAgLy8g5aS0XG4gICAgICAgIGlmIChDaGVjayhoZXJvQ3VzdG9tLmhlYWQpKVxuICAgICAgICAgIGltYWdlVXJscy5wdXNoKGAke0JBU0V9L2hlYWQvJHtoZXJvQ3VzdG9tLnNleH0vJHtoZXJvQ3VzdG9tLmhlYWR9LnBuZ2ApO1xuICAgICAgICAvLyDlpLTnm5RcbiAgICAgICAgaWYgKENoZWNrKGhlcm9DdXN0b20uYXJtb3JoZWxtcykpXG4gICAgICAgICAgaW1hZ2VVcmxzLnB1c2goYCR7QkFTRX0vYXJtb3IvaGVsbXMvJHtoZXJvQ3VzdG9tLnNleH0vJHtoZXJvQ3VzdG9tLmFybW9yaGVsbXN9LnBuZ2ApO1xuICAgICAgICAvLyDmrablmajvvIjljIXmi6zmiYDmnInmrablmajvvIlcbiAgICAgICAgaW1hZ2VVcmxzLnB1c2goYCR7QkFTRX0vd2VhcG9ucy8ke2hlcm9DdXN0b20uc2V4fS93ZWFwb25zLnBuZ2ApO1xuICAgICAgfVxuXG4gICAgICBTcHJpdGUubG9hZChpbWFnZVVybHMpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgQ29tYmluZUhlcm9JbWFnZShkYXRhLCBoZXJvQ3VzdG9tLndpZHRoLCBoZXJvQ3VzdG9tLmhlaWdodCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cblxuICB9KTtcblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  function CheckHeroAction() {
    if (Game.paused) return;

    var state = "run";
    if (Sprite.Input.isPressed("shift")) {
      state = "walk";
    }

    if (Sprite.Input.isPressed("left")) {
      Game.hero.go(state, "left", CheckHeroAction);
    } else if (Sprite.Input.isPressed("up")) {
      Game.hero.go(state, "up", CheckHeroAction);
    } else if (Sprite.Input.isPressed("right")) {
      Game.hero.go(state, "right", CheckHeroAction);
    } else if (Sprite.Input.isPressed("down")) {
      Game.hero.go(state, "down", CheckHeroAction);
    }
  }

  var destIcon = null;

  Game.assign("Input", (function () {
    function GameInput() {
      _classCallCheck(this, GameInput);
    }

    _createClass(GameInput, null, [{
      key: "clearDest",
      value: function clearDest() {
        destIcon.visible = false;
      }
    }, {
      key: "setDest",
      value: function setDest(x, y) {
        destIcon.x = x * 32 + 16;
        destIcon.y = y * 32 + 16;
        destIcon.visible = true;
      }
    }, {
      key: "init",
      value: function init() {

        destIcon = new Sprite.Shape();
        destIcon.circle({
          cx: 5,
          cy: 5,
          r: 5,
          stroke: "red",
          fill: "green"
        });
        destIcon.visible = false;
        destIcon.centerX = 5;
        destIcon.centerY = 5;

        Game.windows.stage.on("mousedown", function (event) {
          var data = event.data;

          data.x += Game.stage.centerX;
          data.y += Game.stage.centerY;

          data.x = Math.floor(data.x / 32);
          data.y = Math.floor(data.y / 32);

          if (!Game.layers.infoLayer.hasChild(destIcon)) {
            Game.layers.infoLayer.appendChild(destIcon);
          }

          if (Game.hero.x != data.x || Game.hero.y != data.y) {
            Game.hero.goto(data.x, data.y, "run", function () {
              destIcon.visible = false;
              if (Game.hintObject && Game.hintObject.heroUse) {
                Game.hintObject.heroUse();
              }
            });
            /*
            if (destPosition) {
              destIcon.x = data.x * 32 + 16;
              destIcon.y = data.y * 32 + 16;
              destIcon.visible = true;
            }
            */
          }
        });

        Sprite.Ticker.on("tick", function () {

          if (Game.paused) return;
          if (!Game.hero) return;
          if (!Game.area) return;
          if (!Game.area.map) return;

          CheckHeroAction();
          if (!Game.hero.walking) {
            Game.hero.stop();
          }

          Game.hero.focus();
        });
      }
    }]);

    return GameInput;
  })());

  Game.assign("initInput", function () {

    /*
      let mousePressed = false;
       Game.stage.on("stagemousedown", function (event) {
        mousePressed = true;
      });
       Game.stage.on("stagemouseup", function (event) {
        mousePressed = false;
      });
       Game.stage.on("mouseleave", function (event) { // mouse leave canvas
        mousePressed = false;
      });
      */
  }); // Game.oninit
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVJbnB1dC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBR2IsV0FBUyxlQUFlLEdBQUk7QUFDMUIsUUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLE9BQU87O0FBRXhCLFFBQUksS0FBSyxHQUFHLEtBQUssQ0FBQztBQUNsQixRQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUFFO0FBQ25DLFdBQUssR0FBRyxNQUFNLENBQUM7S0FDaEI7O0FBRUQsUUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRTtBQUNsQyxVQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0tBQzlDLE1BQU0sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN2QyxVQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0tBQzVDLE1BQU0sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsRUFBRTtBQUMxQyxVQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLGVBQWUsQ0FBQyxDQUFDO0tBQy9DLE1BQU0sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRTtBQUN6QyxVQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0tBQzlDO0dBQ0Y7O0FBRUQsTUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDOztBQUVwQixNQUFJLENBQUMsTUFB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LENBQUMsT0FBTyxFQUFFO0FBQ3RCLGdCQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1dBQ2xCOztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDbkIsQ0FBQyxDQUFDO09BQ0o7OztXQXRFd0IsU0FBUztPQXVFbEMsQ0FBQzs7QUFFSCxNQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxZQUFZOzs7Ozs7Ozs7Ozs7OztHQXFCcEMsQ0FBQyxDQUFDO0NBR0osQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoiR2FtZUlucHV0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cblxuICBmdW5jdGlvbiBDaGVja0hlcm9BY3Rpb24gKCkge1xuICAgIGlmIChHYW1lLnBhdXNlZCkgcmV0dXJuO1xuXG4gICAgbGV0IHN0YXRlID0gXCJydW5cIjtcbiAgICBpZiAoU3ByaXRlLklucHV0LmlzUHJlc3NlZChcInNoaWZ0XCIpKSB7XG4gICAgICBzdGF0ZSA9IFwid2Fsa1wiO1xuICAgIH1cblxuICAgIGlmIChTcHJpdGUuSW5wdXQuaXNQcmVzc2VkKFwibGVmdFwiKSkge1xuICAgICAgR2FtZS5oZXJvLmdvKHN0YXRlLCBcImxlZnRcIiwgQ2hlY2tIZXJvQWN0aW9uKTtcbiAgICB9IGVsc2UgaWYgKFNwcml0ZS5JbnB1dC5pc1ByZXNzZWQoXCJ1cFwiKSkge1xuICAgICAgR2FtZS5oZXJvLmdvKHN0YXRlLCBcInVwXCIsIENoZWNrSGVyb0FjdGlvbik7XG4gICAgfSBlbHNlIGlmIChTcHJpdGUuSW5wdXQuaXNQcmVzc2VkKFwicmlnaHRcIikpIHtcbiAgICAgIEdhbWUuaGVyby5nbyhzdGF0ZSwgXCJyaWdodFwiLCBDaGVja0hlcm9BY3Rpb24pO1xuICAgIH0gZWxzZSBpZiAoU3ByaXRlLklucHV0LmlzUHJlc3NlZChcImRvd25cIikpIHtcbiAgICAgIEdhbWUuaGVyby5nbyhzdGF0ZSwgXCJkb3duXCIsIENoZWNrSGVyb0FjdGlvbik7XG4gICAgfVxuICB9XG5cbiAgbGV0IGRlc3RJY29uID0gbnVsbDtcblxuICBHYW1lLmFzc2lnbihcIklucHV0XCIsIGNsYXNzIEdhbWVJbnB1dCB7XG5cbiAgICBzdGF0aWMgY2xlYXJEZXN0ICgpIHtcbiAgICAgIGRlc3RJY29uLnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBzdGF0aWMgc2V0RGVzdCAoeCwgeSkge1xuICAgICAgZGVzdEljb24ueCA9IHggKiAzMiArIDE2O1xuICAgICAgZGVzdEljb24ueSA9IHkgKiAzMiArIDE2O1xuICAgICAgZGVzdEljb24udmlzaWJsZSA9IHRydWU7XG4gICAgfVxuXG4gICAgc3RhdGljIGluaXQgKCkge1xuXG4gICAgICBkZXN0SWNvbiA9IG5ldyBTcHJpdGUuU2hhcGUoKTtcbiAgICAgIGRlc3RJY29uLmNpcmNsZSh7XG4gICAgICAgIGN4OiA1LFxuICAgICAgICBjeTogNSxcbiAgICAgICAgcjogNSxcbiAgICAgICAgc3Ryb2tlOiBcInJlZFwiLFxuICAgICAgICBmaWxsOiBcImdyZWVuXCJcbiAgICAgIH0pO1xuICAgICAgZGVzdEljb24udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgZGVzdEljb24uY2VudGVyWCA9IDU7XG4gICAgICBkZXN0SWNvbi5jZW50ZXJZID0gNTtcblxuICAgICAgR2FtZS53aW5kb3dzLnN0YWdlLm9uKFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBsZXQgZGF0YSA9IGV2ZW50LmRhdGE7XG5cbiAgICAgICAgZGF0YS54ICs9IEdhbWUuc3RhZ2UuY2VudGVyWDtcbiAgICAgICAgZGF0YS55ICs9IEdhbWUuc3RhZ2UuY2VudGVyWTtcblxuICAgICAgICBkYXRhLnggPSBNYXRoLmZsb29yKGRhdGEueCAvIDMyKTtcbiAgICAgICAgZGF0YS55ID0gTWF0aC5mbG9vcihkYXRhLnkgLyAzMik7XG5cbiAgICAgICAgaWYgKCFHYW1lLmxheWVycy5pbmZvTGF5ZXIuaGFzQ2hpbGQoZGVzdEljb24pKSB7XG4gICAgICAgICAgR2FtZS5sYXllcnMuaW5mb0xheWVyLmFwcGVuZENoaWxkKGRlc3RJY29uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChHYW1lLmhlcm8ueCAhPSBkYXRhLnggfHwgR2FtZS5oZXJvLnkgIT0gZGF0YS55KSB7XG4gICAgICAgICAgR2FtZS5oZXJvLmdvdG8oZGF0YS54LCBkYXRhLnksIFwicnVuXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRlc3RJY29uLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChHYW1lLmhpbnRPYmplY3QgJiYgR2FtZS5oaW50T2JqZWN0Lmhlcm9Vc2UpIHtcbiAgICAgICAgICAgICAgR2FtZS5oaW50T2JqZWN0Lmhlcm9Vc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvKlxuICAgICAgICAgIGlmIChkZXN0UG9zaXRpb24pIHtcbiAgICAgICAgICAgIGRlc3RJY29uLnggPSBkYXRhLnggKiAzMiArIDE2O1xuICAgICAgICAgICAgZGVzdEljb24ueSA9IGRhdGEueSAqIDMyICsgMTY7XG4gICAgICAgICAgICBkZXN0SWNvbi52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgKi9cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIFNwcml0ZS5UaWNrZXIub24oXCJ0aWNrXCIsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBpZiAoR2FtZS5wYXVzZWQpIHJldHVybjtcbiAgICAgICAgaWYgKCFHYW1lLmhlcm8pIHJldHVybjtcbiAgICAgICAgaWYgKCFHYW1lLmFyZWEpIHJldHVybjtcbiAgICAgICAgaWYgKCFHYW1lLmFyZWEubWFwKSByZXR1cm47XG5cbiAgICAgICAgQ2hlY2tIZXJvQWN0aW9uKCk7XG4gICAgICAgIGlmICghR2FtZS5oZXJvLndhbGtpbmcpIHtcbiAgICAgICAgICBHYW1lLmhlcm8uc3RvcCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgR2FtZS5oZXJvLmZvY3VzKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIEdhbWUuYXNzaWduKFwiaW5pdElucHV0XCIsIGZ1bmN0aW9uICgpIHtcblxuXG5cblxuXG4gIC8qXG4gICAgbGV0IG1vdXNlUHJlc3NlZCA9IGZhbHNlO1xuXG4gICAgR2FtZS5zdGFnZS5vbihcInN0YWdlbW91c2Vkb3duXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbW91c2VQcmVzc2VkID0gdHJ1ZTtcbiAgICB9KTtcblxuICAgIEdhbWUuc3RhZ2Uub24oXCJzdGFnZW1vdXNldXBcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBtb3VzZVByZXNzZWQgPSBmYWxzZTtcbiAgICB9KTtcblxuICAgIEdhbWUuc3RhZ2Uub24oXCJtb3VzZWxlYXZlXCIsIGZ1bmN0aW9uIChldmVudCkgeyAvLyBtb3VzZSBsZWF2ZSBjYW52YXNcbiAgICAgIG1vdXNlUHJlc3NlZCA9IGZhbHNlO1xuICAgIH0pO1xuICAgICovXG4gIH0pOyAvLyBHYW1lLm9uaW5pdFxuXG5cbn0pKCk7XG4iXX0=

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  // 英雄组件数据
  var heroCustom = {
    sex: "male",
    body: "light",
    eyes: "blue",
    hair: "",
    haircolor: "black",

    head: "",
    shirts: "",
    pants: "",
    shoes: "",

    armorchest: "",
    armorarm: "",
    armorlegs: "",
    armorhelms: "",
    armorfeet: ""
  };

  // 13x21
  heroCustom.width = 64 * 13; // 832;
  heroCustom.height = 64 * 21; // 1344;
  heroCustom.width *= 0.8125;
  heroCustom.height *= 0.9375;
  heroCustom.tilewidth = heroCustom.width / 13; // 52
  heroCustom.tileheight = heroCustom.height / 21; // 60

  // defined at bottom
  var HeroDefault = null;

  function Init() {

    window.SelectHero = function (event) {
      var value = event.target.value;
      var type = event.target.getAttribute("data-type");
      if (heroCustom[type] != value) {
        if (type == "sex") {
          heroCustom.hair = "";
        }
        heroCustom[type] = value;
        DisplayHero();
      }
      if (heroCustom.sex == "male") {
        document.getElementById("customMaleHair").style.display = "block";
        document.getElementById("customFemaleHair").style.display = "none";
      } else {
        document.getElementById("customMaleHair").style.display = "none";
        document.getElementById("customFemaleHair").style.display = "block";
      }
    };

    var beliefText = {
      None: "信仰决定了神对你的祝福，当然没有信仰也是一种信仰，但你将无法享受神的祝福",
      Elen: "艾琳 - 知识女神",
      Enlon: "恩朗 - 死亡主宰",
      Minare: "密娜 - 丰收女神",
      Achiel: "阿切奥 - 保护之神",
      Racha: "拉克 - 魔法女神",
      Aestor: "阿斯托 - 盗贼之神",
      Hielach: "赫拉克 - 财富之神",
      Alik: "阿丽克 - 治愈女神",
      Amarien: "阿玛恩 - 力量之神"
    };

    var classText = {
      warrior: "战士是艾利韦斯最常见的冒险职业，擅长使用剑和枪",
      archer: "弓箭手擅长远程攻击，一般使用弓箭作为武器",
      wizard: "魔法师擅长使用魔法进行远程攻击",
      priest: "牧师擅长治疗，也会使用神术",
      bard: "吟游诗人的表演可以鼓舞士气或者削弱敌人的士气",
      thief: "盗贼总是躲藏在阴影中",
      business: "商人擅长交易和说服，帮助你更快的获得资金"
    };

    var registerWindowBeliefChoice = document.querySelector("#registerWindowBeliefChoice");
    var registerWindowClassChoice = document.querySelector("#registerWindowClassChoice");

    var registerWindowBelief = document.querySelector("#registerWindowBelief");
    var registerWindowClass = document.querySelector("#registerWindowClass");

    registerWindowBeliefChoice.value = "None";
    registerWindowClassChoice.value = "warrior";
    registerWindowBelief.textContent = beliefText["None"];
    registerWindowClass.textContent = classText["warrior"];

    window.ChoiceHero = function (event) {
      var value = event.target.value;
      var type = event.target.getAttribute("data-type");
      if (type == "belief") {
        HeroDefault.belief = value;
        registerWindowBelief.textContent = beliefText[value];
      } else if (type == "class") {
        HeroDefault["class"] = value;
        registerWindowClass.textContent = classText[value];
      }
    };

    DisplayHero();

    function DisplayHero() {

      var canvas = document.getElementById("registerPreview");
      var context = canvas.getContext("2d");
      context.clearRect(0, 0, canvas.width, canvas.height);

      document.getElementById("loading").innerHTML = "正在载入预览";
      Game.drawHero(heroCustom).then(function (images) {
        var img = images[0];
        context.drawImage(img, 0, 0, img.width, img.height);
        document.getElementById("loading").innerHTML = "预览";
      });
    }
  }

  Game.assign("register", (function () {
    function GameRegister() {
      _classCallCheck(this, GameRegister);
    }

    _createClass(GameRegister, null, [{
      key: "reg",

      // 注册模块
      value: function reg() {
        document.getElementById("registerHeroName").value = "";
        Game.windows.register.show();
        Init();
      }
    }, {
      key: "back",
      value: function back() {
        Game.windows.main.show();
      }
    }, {
      key: "submit",
      value: function submit() {
        var name = document.getElementById("registerHeroName").value;

        if (name.trim().length <= 0) {
          alert("Invalid Name");
          return;
        }

        HeroDefault.id = "hero_" + name;
        HeroDefault.name = name;
        HeroDefault.custom = heroCustom;
        HeroDefault.tilewidth = heroCustom.tilewidth;
        HeroDefault.tileheight = heroCustom.tileheight;

        // 保存一个存档
        Game.Archive.save({
          hero: HeroDefault
        });

        Game.windows.register.hide();

        // 空调用，代表读取最新一个存档（last），即刚刚新建的存档
        Game.Archive.load();
      }
    }]);

    return GameRegister;
  })());

  // 含有$开头的代表是基础值
  // 不含$的同名属性是计算后值，即经过各种加成，buff，nerf之后的值
  HeroDefault = {
    "level": 1, // 等级
    "exp": 0, // 经验值
    "type": "hero", // 标识这个actor的类别是hero，其他类别如npc，monster

    "class": "", // 职业，不同职业有不同加成

    // 233年2月27日 09时30分
    "time": 233 * (60 * 24 * 30 * 12) + 1 * (60 * 24 * 30) + 26 * (60 * 24) + 9 * 60 + 30,

    // 最基本的属性，其他属性都由此延伸
    "$str": 10, // strength 力量： 物理攻击力
    "$dex": 10, // dexterity 敏捷： 闪避，暴击
    "$con": 10, // constitution 耐力： 生命值
    "$int": 10, // intelligence 智力： 精神力，魔法攻击
    "$cha": 10, // charisma 魅力： 队友能力

    // 下面为0的值将由上面的基本属性计算出来

    "str": 0,
    "dex": 0,
    "int": 0,
    "con": 0,
    "cha": 0,

    "$hp": 0, // 生命力
    "$sp": 0, // 精神力

    "critical": 0, // 暴击率
    "dodge": 0, // 闪避

    "hp": 0,
    "sp": 0,

    "$atk": 0, // 攻击
    "$def": 0, // 防御
    "$matk": 0, // 魔法攻击
    "$mdef": 0, // 魔法防御

    "atk": 0,
    "def": 0,
    "matk": 0,
    "mdef": 0,

    "buff": [], // 有益状态
    "nerf": [], // 有害状态

    "currentQuest": [/* 当前任务 */],
    "completeQuest": [/* 完成了的任务 */],

    // 初始位置
    "area": "fystone", // 地图id
    "x": 54,
    "y": 58,

    "centerX": 26,
    "centerY": 55,
    "hitArea": [[0, 0]],

    // 能力
    "skills": ["fist.l1", "sword.l1", // 剑攻击Level1
    "spear.l1", // 枪攻击Level1
    "bow.l1", // 弓攻击Level1
    "fire.l1"],

    // 火球术Level1
    // 技能快捷方式列表
    "bar": [{
      "id": "sword.l1",
      "type": "skill"
    }, {
      "id": "bow.l1",
      "type": "skill"
    }, null, null, null, null, null, {
      "id": "potion.healWeak",
      "type": "item"
    }],

    // 技能，例如生活技能，说服技能，交易技能
    //skills: {
    //  _trade: 0, // 交易，交易时的价格
    //  _negotiate: 0, // 交涉，具体剧情，招揽同伴时的费用
    //  _lock: 0, // 开锁
    //  _knowledge: 0, // 知识，具体剧情，鉴定物品
    //  _treatment: 0, // 医疗，在使用医疗物品时的效果
    //  _animal: 0, // 动物战斗加成，动物驯养
    //},

    "equipment": {
      "head": null,
      "body": "cloth.normal",
      "feet": "shoes.normal",
      "weapon": "sword.iron",
      "neck": null,
      "ring": null
    },

    "items": {
      "sword.iron": 1,
      "spear.iron": 1,
      "bow.wood": 1,
      "cloth.normal": 1,
      "shoes.normal": 1,
      "potion.healWeak": 5,
      "book.gameAdventure": 1,
      "book.elliorwisHistory": 1
    },

    "gold": 0,

    "animations": {

      "spellcastup": [0, 6, "", 40],
      "spellcastleft": [13, 19, "", 40],
      "spellcastdown": [26, 32, "", 40],
      "spellcastright": [39, 45, "", 40],

      "walkup": [104, 112, "walkup", 70],
      "walkleft": [117, 125, "walkleft", 70],
      "walkdown": [130, 138, "walkdown", 70],
      "walkright": [143, 151, "walkright", 70],

      "meleeup": [156, 161, "", 40],
      "meleeleft": [169, 174, "", 40],
      "meleedown": [182, 187, "", 40],
      "meleeright": [195, 200, "", 40],

      // 273+是一张图的总数，hero一共两张图，第一张图没武器，第二张图有武器，所以以下动作在第二张图

      "thrustup": [273 + 52, 273 + 59, "", 40],
      "thrustleft": [273 + 65, 273 + 72, "", 40],
      "thrustdown": [273 + 78, 273 + 85, "", 40],
      "thrustright": [273 + 91, 273 + 98, "", 40],

      "runup": [273 + 105, 273 + 112, "runup", 30],
      "runleft": [273 + 118, 273 + 125, "runleft", 30],
      "rundown": [273 + 131, 273 + 138, "rundown", 30],
      "runright": [273 + 144, 273 + 151, "runright", 30],

      "slashup": [273 + 156, 273 + 161, "", 40],
      "slashleft": [273 + 169, 273 + 174, "", 40],
      "slashdown": [273 + 182, 273 + 187, "", 40],
      "slashright": [273 + 195, 273 + 200, "", 40],

      "shootup": [273 + 208, 273 + 220, "", 40],
      "shootleft": [273 + 221, 273 + 233, "", 40],
      "shootdown": [273 + 234, 273 + 246, "", 40],
      "shootright": [273 + 247, 273 + 259, "", 40],

      "hurt": [260, 265, "", 60],

      "dead": 265,

      "faceup": 104,
      "faceleft": 117,
      "facedown": 130,
      "faceright": 143
    }
  };
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVSZWdpc3Rlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7OztBQUdiLE1BQUksVUFBVSxHQUFHO0FBQ2YsT0FBRyxFQUFFLE1BQU07QUFDWCxRQUFJLEVBQUUsT0FBTztBQUNiLFFBQUksRUFBRSxNQUFNO0FBQ1osUUFBSSxFQUFFLEVBQUU7QUFDUixhQUFTLEVBQUUsT0FBTzs7QUFFbEIsUUFBSSxFQUFFLEVBQUU7QUFDUixVQUFNLEVBQUUsRUFBRTtBQUNWLFNBQUssRUFBRSxFQUFFO0FBQ1QsU0FBSyxFQUFFLEVBQUU7O0FBRVQsY0FBVSxFQUFFLEVBQUU7QUFDZCxZQUFRLEVBQUUsRUFBRTtBQUNaLGFBQVMsRUFBRSxFQUFFO0FBQ2IsY0FBVSxFQUFFLEVBQUU7QUFDZCxhQUFTLEVBQUUsRUFBRTtHQUNkLENBQUM7OztBQUdGLFlBQVUsQ0FBQyxLQUFLLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQztBQUMzQixZQUFVLENBQUMsTUFBTSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUM7QUFDNUIsWUFBVSxDQUFDLEtBQUssSUFBSSxNQUFNLENBQUM7QUFDM0IsWUFBVSxDQUFDLE1BQU0sSUFBSSxNQUFNLENBQUM7QUFDNUIsWUFBVSxDQUFDLFNBQVMsR0FBRyxVQUFVLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztBQUM3QyxZQUFVLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDOzs7QUFHL0MsTUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDOztBQUV2QixXQUFTLElBQUksR0FBSTs7QUFFZixVQUFNLENBQUMsVUFBVSxHQUFHLFVBQVUsS0FBSyxFQUFFO0FBQ25DLFVBQUksS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQy9CLFVBQUksSUFBSSxHQUFH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RSxDQUFDOztBQUUxQixZQUFNLEVBQUUsR0FBRzs7QUFFWCxjQUFRLEVBQUUsR0FBRztBQUNiLGdCQUFVLEVBQUUsR0FBRztBQUNmLGdCQUFVLEVBQUUsR0FBRztBQUNmLGlCQUFXLEVBQUUsR0FBRztLQUNqQjtHQUNGLENBQUM7Q0FHSCxDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lUmVnaXN0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuXG5BLVJQRyBHYW1lLCBCdWlsdCB1c2luZyBKYXZhU2NyaXB0IEVTNlxuQ29weXJpZ2h0IChDKSAyMDE1IHFoZHVhbihodHRwOi8vcWhkdWFuLmNvbSlcblxuVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbml0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG50aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cblxuVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG5idXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cblxuWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2VcbmFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuXG4qL1xuXG4oZnVuY3Rpb24gKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAvLyDoi7Hpm4Tnu4Tku7bmlbDmja5cbiAgbGV0IGhlcm9DdXN0b20gPSB7XG4gICAgc2V4OiBcIm1hbGVcIixcbiAgICBib2R5OiBcImxpZ2h0XCIsXG4gICAgZXllczogXCJibHVlXCIsXG4gICAgaGFpcjogXCJcIixcbiAgICBoYWlyY29sb3I6IFwiYmxhY2tcIixcblxuICAgIGhlYWQ6IFwiXCIsXG4gICAgc2hpcnRzOiBcIlwiLFxuICAgIHBhbnRzOiBcIlwiLFxuICAgIHNob2VzOiBcIlwiLFxuXG4gICAgYXJtb3JjaGVzdDogXCJcIixcbiAgICBhcm1vcmFybTogXCJcIixcbiAgICBhcm1vcmxlZ3M6IFwiXCIsXG4gICAgYXJtb3JoZWxtczogXCJcIixcbiAgICBhcm1vcmZlZXQ6IFwiXCJcbiAgfTtcblxuICAvLyAxM3gyMVxuICBoZXJvQ3VzdG9tLndpZHRoID0gNjQgKiAxMzsgLy8gODMyO1xuICBoZXJvQ3VzdG9tLmhlaWdodCA9IDY0ICogMjE7IC8vIDEzNDQ7XG4gIGhlcm9DdXN0b20ud2lkdGggKj0gMC44MTI1O1xuICBoZXJvQ3VzdG9tLmhlaWdodCAqPSAwLjkzNzU7XG4gIGhlcm9DdXN0b20udGlsZXdpZHRoID0gaGVyb0N1c3RvbS53aWR0aCAvIDEzOyAvLyA1MlxuICBoZXJvQ3VzdG9tLnRpbGVoZWlnaHQgPSBoZXJvQ3VzdG9tLmhlaWdodCAvIDIxOyAvLyA2MFxuXG4gIC8vIGRlZmluZWQgYXQgYm90dG9tXG4gIGxldCBIZXJvRGVmYXVsdCA9IG51bGw7XG5cbiAgZnVuY3Rpb24gSW5pdCAoKSB7XG5cbiAgICB3aW5kb3cuU2VsZWN0SGVybyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IHZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgbGV0IHR5cGUgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS10eXBlXCIpO1xuICAgICAgaWYgKGhlcm9DdXN0b21bdHlwZV0gIT0gdmFsdWUpIHtcbiAgICAgICAgaWYgKHR5cGUgPT0gXCJzZXhcIikge1xuICAgICAgICAgIGhlcm9DdXN0b20uaGFpciA9IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgaGVyb0N1c3RvbVt0eXBlXSA9IHZhbHVlO1xuICAgICAgICBEaXNwbGF5SGVybygpO1xuICAgICAgfVxuICAgICAgaWYgKGhlcm9DdXN0b20uc2V4ID09IFwibWFsZVwiKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY3VzdG9tTWFsZUhhaXJcIikuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjdXN0b21GZW1hbGVIYWlyXCIpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY3VzdG9tTWFsZUhhaXJcIikuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImN1c3RvbUZlbWFsZUhhaXJcIikuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgbGV0IGJlbGllZlRleHQgPSB7XG4gICAgICBOb25lOiBcIuS/oeS7sOWGs+WumuS6huelnuWvueS9oOeahOelneemj++8jOW9k+eEtuayoeacieS/oeS7sOS5n+aYr+S4gOenjeS/oeS7sO+8jOS9huS9oOWwhuaXoOazleS6q+WPl+elnueahOelneemj1wiLFxuICAgICAgRWxlbjogXCLoib7nkLMgLSDnn6Xor4blpbPnpZ5cIixcbiAgICAgIEVubG9uOiBcIuaBqeaclyAtIOatu+S6oeS4u+WusFwiLFxuICAgICAgTWluYXJlOiBcIuWvhuWonCAtIOS4sOaUtuWls+elnlwiLFxuICAgICAgQWNoaWVsOiBcIumYv+WIh+WlpSAtIOS/neaKpOS5i+elnlwiLFxuICAgICAgUmFjaGE6IFwi5ouJ5YWLIC0g6a2U5rOV5aWz56WeXCIsXG4gICAgICBBZXN0b3I6IFwi6Zi/5pav5omYIC0g55uX6LS85LmL56WeXCIsXG4gICAgICBIaWVsYWNoOiBcIui1q+aLieWFiyAtIOi0ouWvjOS5i+elnlwiLFxuICAgICAgQWxpazogXCLpmL/kuL3lhYsgLSDmsrvmhIjlpbPnpZ5cIixcbiAgICAgIEFtYXJpZW46IFwi6Zi/546b5oGpIC0g5Yqb6YeP5LmL56WeXCJcbiAgICB9O1xuXG4gICAgbGV0IGNsYXNzVGV4dCA9IHtcbiAgICAgIHdhcnJpb3I6IFwi5oiY5aOr5piv6Im+5Yip6Z+m5pav5pyA5bi46KeB55qE5YaS6Zmp6IGM5Lia77yM5pOF6ZW/5L2/55So5YmR5ZKM5p6qXCIsXG4gICAgICBhcmNoZXI6IFwi5byT566t5omL5pOF6ZW/6L+c56iL5pS75Ye777yM5LiA6Iis5L2/55So5byT566t5L2c5Li65q2m5ZmoXCIsXG4gICAgICB3aXphcmQ6IFwi6a2U5rOV5biI5pOF6ZW/5L2/55So6a2U5rOV6L+b6KGM6L+c56iL5pS75Ye7XCIsXG4gICAgICBwcmllc3Q6IFwi54mn5biI5pOF6ZW/5rK755aX77yM5Lmf5Lya5L2/55So56We5pyvXCIsXG4gICAgICBiYXJkOiBcIuWQn+a4uOivl+S6uueahOihqOa8lOWPr+S7pem8k+iInuWjq+awlOaIluiAheWJiuW8seaVjOS6uueahOWjq+awlFwiLFxuICAgICAgdGhpZWY6IFwi55uX6LS85oC75piv6Lqy6JeP5Zyo6Zi05b2x5LitXCIsXG4gICAgICBidXNpbmVzczogXCLllYbkurrmk4Xplb/kuqTmmJPlkozor7TmnI3vvIzluK7liqnkvaDmm7Tlv6vnmoTojrflvpfotYTph5FcIlxuICAgIH07XG5cbiAgICBsZXQgcmVnaXN0ZXJXaW5kb3dCZWxpZWZDaG9pY2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JlZ2lzdGVyV2luZG93QmVsaWVmQ2hvaWNlXCIpO1xuICAgIGxldCByZWdpc3RlcldpbmRvd0NsYXNzQ2hvaWNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyZWdpc3RlcldpbmRvd0NsYXNzQ2hvaWNlXCIpO1xuXG4gICAgbGV0IHJlZ2lzdGVyV2luZG93QmVsaWVmID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyZWdpc3RlcldpbmRvd0JlbGllZlwiKTtcbiAgICBsZXQgcmVnaXN0ZXJXaW5kb3dDbGFzcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcmVnaXN0ZXJXaW5kb3dDbGFzc1wiKTtcblxuICAgIHJlZ2lzdGVyV2luZG93QmVsaWVmQ2hvaWNlLnZhbHVlID0gXCJOb25lXCI7XG4gICAgcmVnaXN0ZXJXaW5kb3dDbGFzc0Nob2ljZS52YWx1ZSA9IFwid2FycmlvclwiO1xuICAgIHJlZ2lzdGVyV2luZG93QmVsaWVmLnRleHRDb250ZW50ID0gYmVsaWVmVGV4dFtcIk5vbmVcIl07XG4gICAgcmVnaXN0ZXJXaW5kb3dDbGFzcy50ZXh0Q29udGVudCA9IGNsYXNzVGV4dFtcIndhcnJpb3JcIl07XG5cbiAgICB3aW5kb3cuQ2hvaWNlSGVybyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgbGV0IHZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgbGV0IHR5cGUgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS10eXBlXCIpO1xuICAgICAgaWYgKHR5cGUgPT0gXCJiZWxpZWZcIikge1xuICAgICAgICBIZXJvRGVmYXVsdC5iZWxpZWYgPSB2YWx1ZTtcbiAgICAgICAgcmVnaXN0ZXJXaW5kb3dCZWxpZWYudGV4dENvbnRlbnQgPSBiZWxpZWZUZXh0W3ZhbHVlXTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcImNsYXNzXCIpIHtcbiAgICAgICAgSGVyb0RlZmF1bHQuY2xhc3MgPSB2YWx1ZTtcbiAgICAgICAgcmVnaXN0ZXJXaW5kb3dDbGFzcy50ZXh0Q29udGVudCA9IGNsYXNzVGV4dFt2YWx1ZV07XG4gICAgICB9XG4gICAgfTtcblxuICAgIERpc3BsYXlIZXJvKCk7XG5cbiAgICBmdW5jdGlvbiBEaXNwbGF5SGVybyAoKSB7XG5cbiAgICAgIGxldCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlZ2lzdGVyUHJldmlld1wiKTtcbiAgICAgIGxldCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIGNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9hZGluZ1wiKS5pbm5lckhUTUwgPSBcIuato+WcqOi9veWFpemihOiniFwiO1xuICAgICAgR2FtZS5kcmF3SGVybyhoZXJvQ3VzdG9tKS50aGVuKGZ1bmN0aW9uIChpbWFnZXMpIHtcbiAgICAgICAgbGV0IGltZyA9IGltYWdlc1swXTtcbiAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBpbWcud2lkdGgsIGltZy5oZWlnaHQpO1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxvYWRpbmdcIikuaW5uZXJIVE1MID0gXCLpooTop4hcIjtcbiAgICAgIH0pO1xuICAgIH1cblxuICB9XG5cbiAgR2FtZS5hc3NpZ24oXCJyZWdpc3RlclwiLCBjbGFzcyBHYW1lUmVnaXN0ZXIge1xuXG4gICAgLy8g5rOo5YaM5qih5Z2XXG4gICAgc3RhdGljIHJlZyAoKSB7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlZ2lzdGVySGVyb05hbWVcIikudmFsdWUgPSBcIlwiO1xuICAgICAgR2FtZS53aW5kb3dzLnJlZ2lzdGVyLnNob3coKTtcbiAgICAgIEluaXQoKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgYmFjayAoKSB7XG4gICAgICBHYW1lLndpbmRvd3MubWFpbi5zaG93KCk7XG4gICAgfVxuXG4gICAgc3RhdGljIHN1Ym1pdCAoKSB7XG4gICAgICBsZXQgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVnaXN0ZXJIZXJvTmFtZVwiKS52YWx1ZTtcblxuICAgICAgaWYgKG5hbWUudHJpbSgpLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgIGFsZXJ0KFwiSW52YWxpZCBOYW1lXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIEhlcm9EZWZhdWx0LmlkID0gXCJoZXJvX1wiICsgbmFtZTtcbiAgICAgIEhlcm9EZWZhdWx0Lm5hbWUgPSBuYW1lO1xuICAgICAgSGVyb0RlZmF1bHQuY3VzdG9tID0gaGVyb0N1c3RvbTtcbiAgICAgIEhlcm9EZWZhdWx0LnRpbGV3aWR0aCA9IGhlcm9DdXN0b20udGlsZXdpZHRoO1xuICAgICAgSGVyb0RlZmF1bHQudGlsZWhlaWdodCA9IGhlcm9DdXN0b20udGlsZWhlaWdodDtcblxuICAgICAgLy8g5L+d5a2Y5LiA5Liq5a2Y5qGjXG4gICAgICBHYW1lLkFyY2hpdmUuc2F2ZSh7XG4gICAgICAgIGhlcm86IEhlcm9EZWZhdWx0XG4gICAgICB9KTtcblxuICAgICAgR2FtZS53aW5kb3dzLnJlZ2lzdGVyLmhpZGUoKTtcblxuICAgICAgLy8g56m66LCD55So77yM5Luj6KGo6K+75Y+W5pyA5paw5LiA5Liq5a2Y5qGj77yIbGFzdO+8ie+8jOWNs+WImuWImuaWsOW7uueahOWtmOaho1xuICAgICAgR2FtZS5BcmNoaXZlLmxvYWQoKTtcbiAgICB9XG5cbiAgfSk7XG5cblxuICAvLyDlkKvmnIkk5byA5aS055qE5Luj6KGo5piv5Z+656GA5YC8XG4gIC8vIOS4jeWQqyTnmoTlkIzlkI3lsZ7mgKfmmK/orqHnrpflkI7lgLzvvIzljbPnu4/ov4flkITnp43liqDmiJDvvIxidWZm77yMbmVyZuS5i+WQjueahOWAvFxuICBIZXJvRGVmYXVsdCA9IHtcbiAgICBcImxldmVsXCI6IDEsIC8vIOetiee6p1xuICAgIFwiZXhwXCI6IDAsIC8vIOe7j+mqjOWAvFxuICAgIFwidHlwZVwiOiBcImhlcm9cIiwgLy8g5qCH6K+G6L+Z5LiqYWN0b3LnmoTnsbvliKvmmK9oZXJv77yM5YW25LuW57G75Yir5aaCbnBj77yMbW9uc3RlclxuXG4gICAgXCJjbGFzc1wiOiBcIlwiLCAvLyDogYzkuJrvvIzkuI3lkIzogYzkuJrmnInkuI3lkIzliqDmiJBcblxuICAgIC8vIDIzM+W5tDLmnIgyN+aXpSAwOeaXtjMw5YiGXG4gICAgXCJ0aW1lXCI6IDIzMyooNjAqMjQqMzAqMTIpICsgMSooNjAqMjQqMzApICsgMjYqKDYwKjI0KSArIDkqKDYwKSArIDMwLFxuXG4gICAgLy8g5pyA5Z+65pys55qE5bGe5oCn77yM5YW25LuW5bGe5oCn6YO955Sx5q2k5bu25Ly4XG4gICAgXCIkc3RyXCI6IDEwLCAvLyBzdHJlbmd0aCDlipvph4/vvJog54mp55CG5pS75Ye75YqbXG4gICAgXCIkZGV4XCI6IDEwLCAvLyBkZXh0ZXJpdHkg5pWP5o2377yaIOmXqumBv++8jOaatOWHu1xuICAgIFwiJGNvblwiOiAxMCwgLy8gY29uc3RpdHV0aW9uIOiAkOWKm++8miDnlJ/lkb3lgLxcbiAgICBcIiRpbnRcIjogMTAsIC8vIGludGVsbGlnZW5jZSDmmbrlipvvvJog57K+56We5Yqb77yM6a2U5rOV5pS75Ye7XG4gICAgXCIkY2hhXCI6IDEwLCAvLyBjaGFyaXNtYSDprYXlipvvvJog6Zif5Y+L6IO95YqbXG5cbiAgICAvLyDkuIvpnaLkuLow55qE5YC85bCG55Sx5LiK6Z2i55qE5Z+65pys5bGe5oCn6K6h566X5Ye65p2lXG5cbiAgICBcInN0clwiOiAwLFxuICAgIFwiZGV4XCI6IDAsXG4gICAgXCJpbnRcIjogMCxcbiAgICBcImNvblwiOiAwLFxuICAgIFwiY2hhXCI6IDAsXG5cbiAgICBcIiRocFwiOiAwLCAvLyDnlJ/lkb3liptcbiAgICBcIiRzcFwiOiAwLCAvLyDnsr7npZ7liptcblxuICAgIFwiY3JpdGljYWxcIjogMCwgLy8g5pq05Ye7546HXG4gICAgXCJkb2RnZVwiOiAwLCAvLyDpl6rpgb9cblxuICAgIFwiaHBcIjogMCxcbiAgICBcInNwXCI6IDAsXG5cbiAgICBcIiRhdGtcIjogMCwgLy8g5pS75Ye7XG4gICAgXCIkZGVmXCI6IDAsIC8vIOmYsuW+oVxuICAgIFwiJG1hdGtcIjogMCwgLy8g6a2U5rOV5pS75Ye7XG4gICAgXCIkbWRlZlwiOiAwLCAvLyDprZTms5XpmLLlvqFcblxuICAgIFwiYXRrXCI6IDAsXG4gICAgXCJkZWZcIjogMCxcbiAgICBcIm1hdGtcIjogMCxcbiAgICBcIm1kZWZcIjogMCxcblxuICAgIFwiYnVmZlwiOiBbXSwgLy8g5pyJ55uK54q25oCBXG4gICAgXCJuZXJmXCI6IFtdLCAvLyDmnInlrrPnirbmgIFcblxuICAgIFwiY3VycmVudFF1ZXN0XCI6IFsgLyog5b2T5YmN5Lu75YqhICovIF0sXG4gICAgXCJjb21wbGV0ZVF1ZXN0XCI6IFsgLyog5a6M5oiQ5LqG55qE5Lu75YqhICovIF0sXG5cbiAgICAvLyDliJ3lp4vkvY3nva5cbiAgICBcImFyZWFcIjogXCJmeXN0b25lXCIsIC8vIOWcsOWbvmlkXG4gICAgXCJ4XCI6IDU0LFxuICAgIFwieVwiOiA1OCxcblxuXG4gICAgXCJjZW50ZXJYXCI6IDI2LFxuICAgIFwiY2VudGVyWVwiOiA1NSxcbiAgICBcImhpdEFyZWFcIjogW1swLCAwXV0sXG5cbiAgICAvLyDog73liptcbiAgICBcInNraWxsc1wiOiBbXG4gICAgICBcImZpc3QubDFcIixcbiAgICAgIFwic3dvcmQubDFcIiwgLy8g5YmR5pS75Ye7TGV2ZWwxXG4gICAgICBcInNwZWFyLmwxXCIsIC8vIOaequaUu+WHu0xldmVsMVxuICAgICAgXCJib3cubDFcIiwgLy8g5byT5pS75Ye7TGV2ZWwxXG4gICAgICBcImZpcmUubDFcIiwgLy8g54Gr55CD5pyvTGV2ZWwxXG4gICAgXSxcblxuICAgIC8vIOaKgOiDveW/q+aNt+aWueW8j+WIl+ihqFxuICAgIFwiYmFyXCI6IFtcbiAgICAgIHtcbiAgICAgICAgXCJpZFwiOiBcInN3b3JkLmwxXCIsXG4gICAgICAgIFwidHlwZVwiOiBcInNraWxsXCJcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIFwiaWRcIjogXCJib3cubDFcIixcbiAgICAgICAgXCJ0eXBlXCI6IFwic2tpbGxcIlxuICAgICAgfSxcbiAgICAgIG51bGwsXG4gICAgICBudWxsLFxuICAgICAgbnVsbCxcbiAgICAgIG51bGwsXG4gICAgICBudWxsLFxuICAgICAge1xuICAgICAgICBcImlkXCI6IFwicG90aW9uLmhlYWxXZWFrXCIsXG4gICAgICAgIFwidHlwZVwiOiBcIml0ZW1cIlxuICAgICAgfVxuICAgIF0sXG5cbiAgICAvLyDmioDog73vvIzkvovlpoLnlJ/mtLvmioDog73vvIzor7TmnI3mioDog73vvIzkuqTmmJPmioDog71cbiAgICAvL3NraWxsczoge1xuICAgIC8vICBfdHJhZGU6IDAsIC8vIOS6pOaYk++8jOS6pOaYk+aXtueahOS7t+agvFxuICAgIC8vICBfbmVnb3RpYXRlOiAwLCAvLyDkuqTmtonvvIzlhbfkvZPliafmg4XvvIzmi5vmj73lkIzkvLTml7bnmoTotLnnlKhcbiAgICAvLyAgX2xvY2s6IDAsIC8vIOW8gOmUgVxuICAgIC8vICBfa25vd2xlZGdlOiAwLCAvLyDnn6Xor4bvvIzlhbfkvZPliafmg4XvvIzpibTlrprnianlk4FcbiAgICAvLyAgX3RyZWF0bWVudDogMCwgLy8g5Yy755aX77yM5Zyo5L2/55So5Yy755aX54mp5ZOB5pe255qE5pWI5p6cXG4gICAgLy8gIF9hbmltYWw6IDAsIC8vIOWKqOeJqeaImOaWl+WKoOaIkO+8jOWKqOeJqempr+WFu1xuICAgIC8vfSxcblxuICAgIFwiZXF1aXBtZW50XCI6IHtcbiAgICAgIFwiaGVhZFwiOiBudWxsLFxuICAgICAgXCJib2R5XCI6IFwiY2xvdGgubm9ybWFsXCIsXG4gICAgICBcImZlZXRcIjogXCJzaG9lcy5ub3JtYWxcIixcbiAgICAgIFwid2VhcG9uXCI6IFwic3dvcmQuaXJvblwiLFxuICAgICAgXCJuZWNrXCI6IG51bGwsXG4gICAgICBcInJpbmdcIjogbnVsbFxuICAgIH0sXG5cbiAgICBcIml0ZW1zXCI6IHtcbiAgICAgIFwic3dvcmQuaXJvblwiOiAxLFxuICAgICAgXCJzcGVhci5pcm9uXCI6IDEsXG4gICAgICBcImJvdy53b29kXCI6IDEgLFxuICAgICAgXCJjbG90aC5ub3JtYWxcIjogMSxcbiAgICAgIFwic2hvZXMubm9ybWFsXCI6IDEsXG4gICAgICBcInBvdGlvbi5oZWFsV2Vha1wiOiA1LFxuICAgICAgXCJib29rLmdhbWVBZHZlbnR1cmVcIjogMSxcbiAgICAgIFwiYm9vay5lbGxpb3J3aXNIaXN0b3J5XCI6IDFcbiAgICB9LFxuXG4gICAgXCJnb2xkXCI6IDAsXG5cbiAgICBcImFuaW1hdGlvbnNcIjoge1xuXG4gICAgICBcInNwZWxsY2FzdHVwXCI6IFswLCA2LCBcIlwiLCA0MF0sXG4gICAgICBcInNwZWxsY2FzdGxlZnRcIjogWzEzLCAxOSwgXCJcIiwgNDBdLFxuICAgICAgXCJzcGVsbGNhc3Rkb3duXCI6IFsyNiwgMzIsIFwiXCIsIDQwXSxcbiAgICAgIFwic3BlbGxjYXN0cmlnaHRcIjogWzM5LCA0NSwgXCJcIiwgNDBdLFxuXG4gICAgICBcIndhbGt1cFwiOiBbMTA0LCAxMTIsIFwid2Fsa3VwXCIsIDcwXSxcbiAgICAgIFwid2Fsa2xlZnRcIjogWzExNywgMTI1LCBcIndhbGtsZWZ0XCIsIDcwXSxcbiAgICAgIFwid2Fsa2Rvd25cIjogWzEzMCwgMTM4LCBcIndhbGtkb3duXCIsIDcwXSxcbiAgICAgIFwid2Fsa3JpZ2h0XCI6IFsxNDMsIDE1MSwgXCJ3YWxrcmlnaHRcIiwgNzBdLFxuXG4gICAgICBcIm1lbGVldXBcIjogWzE1NiwgMTYxLCBcIlwiLCA0MF0sXG4gICAgICBcIm1lbGVlbGVmdFwiOiBbMTY5LCAxNzQsIFwiXCIsIDQwXSxcbiAgICAgIFwibWVsZWVkb3duXCI6IFsxODIsIDE4NywgXCJcIiwgNDBdLFxuICAgICAgXCJtZWxlZXJpZ2h0XCI6IFsxOTUsIDIwMCwgXCJcIiwgNDBdLFxuXG4gICAgICAvLyAyNzMr5piv5LiA5byg5Zu+55qE5oC75pWw77yMaGVyb+S4gOWFseS4pOW8oOWbvu+8jOesrOS4gOW8oOWbvuayoeatpuWZqO+8jOesrOS6jOW8oOWbvuacieatpuWZqO+8jOaJgOS7peS7peS4i+WKqOS9nOWcqOesrOS6jOW8oOWbvlxuXG4gICAgICBcInRocnVzdHVwXCI6IFsyNzMrNTIsIDI3Mys1OSwgXCJcIiwgNDBdLFxuICAgICAgXCJ0aHJ1c3RsZWZ0XCI6IFsyNzMrNjUsIDI3Mys3MiwgXCJcIiwgNDBdLFxuICAgICAgXCJ0aHJ1c3Rkb3duXCI6IFsyNzMrNzgsIDI3Mys4NSwgXCJcIiwgNDBdLFxuICAgICAgXCJ0aHJ1c3RyaWdodFwiOiBbMjczKzkxLCAyNzMrOTgsIFwiXCIsIDQwXSxcblxuICAgICAgXCJydW51cFwiOiBbMjczKzEwNSwgMjczKzExMiwgXCJydW51cFwiLCAzMF0sXG4gICAgICBcInJ1bmxlZnRcIjogWzI3MysxMTgsIDI3MysxMjUsIFwicnVubGVmdFwiLCAzMF0sXG4gICAgICBcInJ1bmRvd25cIjogWzI3MysxMzEsIDI3MysxMzgsIFwicnVuZG93blwiLCAzMF0sXG4gICAgICBcInJ1bnJpZ2h0XCI6IFsyNzMrMTQ0LCAyNzMrMTUxLCBcInJ1bnJpZ2h0XCIsIDMwXSxcblxuICAgICAgXCJzbGFzaHVwXCI6IFsyNzMrMTU2LCAyNzMrMTYxLCBcIlwiLCA0MF0sXG4gICAgICBcInNsYXNobGVmdFwiOiBbMjczKzE2OSwgMjczKzE3NCwgXCJcIiwgNDBdLFxuICAgICAgXCJzbGFzaGRvd25cIjogWzI3MysxODIsIDI3MysxODcsIFwiXCIsIDQwXSxcbiAgICAgIFwic2xhc2hyaWdodFwiOiBbMjczKzE5NSwgMjczKzIwMCwgXCJcIiwgNDBdLFxuXG4gICAgICBcInNob290dXBcIjogWzI3MysyMDgsIDI3MysyMjAsIFwiXCIsIDQwXSxcbiAgICAgIFwic2hvb3RsZWZ0XCI6IFsyNzMrMjIxLCAyNzMrMjMzLCBcIlwiLCA0MF0sXG4gICAgICBcInNob290ZG93blwiOiBbMjczKzIzNCwgMjczKzI0NiwgXCJcIiwgNDBdLFxuICAgICAgXCJzaG9vdHJpZ2h0XCI6IFsyNzMrMjQ3LCAyNzMrMjU5LCBcIlwiLCA0MF0sXG5cbiAgICAgIFwiaHVydFwiOiBbMjYwLCAyNjUsIFwiXCIsIDYwXSxcblxuICAgICAgXCJkZWFkXCI6IDI2NSxcblxuICAgICAgXCJmYWNldXBcIjogMTA0LFxuICAgICAgXCJmYWNlbGVmdFwiOiAxMTcsXG4gICAgICBcImZhY2Vkb3duXCI6IDEzMCxcbiAgICAgIFwiZmFjZXJpZ2h0XCI6IDE0M1xuICAgIH1cbiAgfTtcblxuXG59KSgpO1xuIl19

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

(function () {
  "use strict";

  Game.assign("Archive", (function () {
    function GameArchive() {
      _classCallCheck(this, GameArchive);
    }

    _createClass(GameArchive, null, [{
      key: "remove",
      value: function remove(id) {
        if (window.localStorage.getItem(id)) {
          window.localStorage.removeItem(id);
        }
      }

      // 返回所有存档，Object格式
    }, {
      key: "list",
      value: function list() {
        var keys = [];
        for (var key in window.localStorage) {
          if (key.match(/^SAVE_(\d+)$/)) {
            keys.push(parseInt(key.match(/^SAVE_(\d+)$/)[1]));
          }
        }
        keys.sort();
        keys.reverse();
        return keys;
      }

      // 返回最新存档，Object格式
    }, {
      key: "last",
      value: function last() {
        var list = Game.Archive.list();
        if (list.length > 0) {
          var last = list[0];
          return JSON.parse(window.localStorage.getItem("SAVE_" + last));
        } else {
          return null;
        }
      }
    }, {
      key: "clear",
      value: function clear() {
        for (var key in window.localStorage) {
          if (key.match(/^SAVE_(\d+)$/)) {
            window.localStorage.removeItem(key);
          }
        }
      }
    }, {
      key: "save",
      value: function save(data) {
        var now = new Date();
        var id = now.getTime();

        data.id = id;
        data.name = data.hero.name;
        data.date = now.toLocaleString();

        window.localStorage.setItem("SAVE_" + id, JSON.stringify(data));
      }
    }, {
      key: "get",
      value: function get(id) {
        if (id && window.localStorage.getItem(id)) {
          return JSON.parse(window.localStorage.getItem(id));
        }
        return null;
      }
    }, {
      key: "load",
      value: function load(id) {
        var data = Game.Archive.get(id);
        if (!data) {
          data = Game.Archive.last();
        }

        if (data) {

          if (Game.windows["interface"].showing) {
            Game.windows["interface"].hide();
          }
          Game.windows.main.hide();

          Game.windows.loading.begin();

          setTimeout(function () {
            var heroData = data.hero;

            Game.drawHero(heroData.custom).then(function (heroImage) {
              heroData.image = heroImage;
              Game.hero = new Game.ActorHero(heroData);

              Game.hero.on("complete", function () {

                Game.hero.gotoArea(heroData.area, heroData.x, heroData.y);
              });
            });
          }, 20);
        } else {
          console.error("id:", id);
          throw new Error("Invalid id, Game.Archive.load");
        }
      }
    }]);

    return GameArchive;
  })());
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVBcmNoaXZlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBLENBQUMsWUFBWTtBQUNYLGNBQVksQ0FBQzs7QUFFYixNQUFJLENBQUMsTUFBTSxDQUFDLFNBQVM7YUFBUSxXQUFXOzRCQUFYLFdBQVc7OztpQkFBWCxXQUFXOzthQUV4QixnQkFBQyxFQUFFLEVBQUU7QUFDakIsWUFBSSxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRTtBQUNuQyxnQkFBTSxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDcEM7T0FDRjs7Ozs7YUFHVyxnQkFBRztBQUNiLFlBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztBQUNkLGFBQUssSUFBSSxHQUFHLElBQUksTUFBTSxDQUFDLFlBQVksRUFBRTtBQUNuQyxjQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLEVBQUU7QUFDN0IsZ0JBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1dBQ25EO1NBQ0Y7QUFDRCxZQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWixZQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDZixlQUFPLElBQUksQ0FBQztPQUNiOzs7OzthQUdXLGdCQUFHO0FBQ2IsWUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUMvQixZQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQ25CLGNBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNuQixpQkFBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsT0FBTyxXQUFTLElBQUks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cmNoaXZlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgR2FtZS5hc3NpZ24oXCJBcmNoaXZlXCIsIGNsYXNzIEdhbWVBcmNoaXZlIHtcblxuICAgIHN0YXRpYyByZW1vdmUgKGlkKSB7XG4gICAgICBpZiAod2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKGlkKSkge1xuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oaWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOi/lOWbnuaJgOacieWtmOaho++8jE9iamVjdOagvOW8j1xuICAgIHN0YXRpYyBsaXN0ICgpIHtcbiAgICAgIGxldCBrZXlzID0gW107XG4gICAgICBmb3IgKGxldCBrZXkgaW4gd2luZG93LmxvY2FsU3RvcmFnZSkge1xuICAgICAgICBpZiAoa2V5Lm1hdGNoKC9eU0FWRV8oXFxkKykkLykpIHtcbiAgICAgICAgICBrZXlzLnB1c2gocGFyc2VJbnQoa2V5Lm1hdGNoKC9eU0FWRV8oXFxkKykkLylbMV0pKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAga2V5cy5zb3J0KCk7XG4gICAgICBrZXlzLnJldmVyc2UoKTtcbiAgICAgIHJldHVybiBrZXlzO1xuICAgIH1cblxuICAgIC8vIOi/lOWbnuacgOaWsOWtmOaho++8jE9iamVjdOagvOW8j1xuICAgIHN0YXRpYyBsYXN0ICgpIHtcbiAgICAgIGxldCBsaXN0ID0gR2FtZS5BcmNoaXZlLmxpc3QoKTtcbiAgICAgIGlmIChsaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IGxhc3QgPSBsaXN0WzBdO1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oYFNBVkVfJHtsYXN0fWApKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBjbGVhciAoKSB7XG4gICAgICBmb3IgKGxldCBrZXkgaW4gd2luZG93LmxvY2FsU3RvcmFnZSkge1xuICAgICAgICBpZiAoa2V5Lm1hdGNoKC9eU0FWRV8oXFxkKykkLykpIHtcbiAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBzYXZlIChkYXRhKSB7XG4gICAgICBsZXQgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgIGxldCBpZCA9IG5vdy5nZXRUaW1lKCk7XG5cbiAgICAgIGRhdGEuaWQgPSBpZDtcbiAgICAgIGRhdGEubmFtZSA9IGRhdGEuaGVyby5uYW1lO1xuICAgICAgZGF0YS5kYXRlID0gbm93LnRvTG9jYWxlU3RyaW5nKCk7XG5cbiAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShgU0FWRV8ke2lkfWAsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZ2V0IChpZCkge1xuICAgICAgaWYgKGlkICYmIHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShpZCkpIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uod2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKGlkKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBzdGF0aWMgbG9hZCAoaWQpIHtcbiAgICAgIGxldCBkYXRhID0gR2FtZS5BcmNoaXZlLmdldChpZCk7XG4gICAgICBpZiAoIWRhdGEpIHtcbiAgICAgICAgZGF0YSA9IEdhbWUuQXJjaGl2ZS5sYXN0KCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChkYXRhKSB7XG5cbiAgICAgICAgaWYgKEdhbWUud2luZG93cy5pbnRlcmZhY2Uuc2hvd2luZykge1xuICAgICAgICAgIEdhbWUud2luZG93cy5pbnRlcmZhY2UuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIEdhbWUud2luZG93cy5tYWluLmhpZGUoKTtcblxuICAgICAgICBHYW1lLndpbmRvd3MubG9hZGluZy5iZWdpbigpO1xuXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxldCBoZXJvRGF0YSA9IGRhdGEuaGVybztcblxuICAgICAgICAgIEdhbWUuZHJhd0hlcm8oaGVyb0RhdGEuY3VzdG9tKS50aGVuKGZ1bmN0aW9uIChoZXJvSW1hZ2UpIHtcbiAgICAgICAgICAgIGhlcm9EYXRhLmltYWdlID0gaGVyb0ltYWdlO1xuICAgICAgICAgICAgR2FtZS5oZXJvID0gbmV3IEdhbWUuQWN0b3JIZXJvKGhlcm9EYXRhKTtcblxuICAgICAgICAgICAgR2FtZS5oZXJvLm9uKFwiY29tcGxldGVcIiwgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgIEdhbWUuaGVyby5nb3RvQXJlYShoZXJvRGF0YS5hcmVhLCBoZXJvRGF0YS54LCBoZXJvRGF0YS55KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwgMjApO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiaWQ6XCIsIGlkKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBpZCwgR2FtZS5BcmNoaXZlLmxvYWRcIik7XG4gICAgICB9XG4gICAgfVxuXG4gIH0pO1xuXG59KSgpO1xuIl19
