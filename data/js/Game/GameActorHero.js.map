{"version":3,"sources":["src/Game/GameActorHero.js"],"names":[],"mappings":"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","file":"src/Game/GameActorHero.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  let internal = Sprite.Namespace();\n\n  /**\n    英雄类\n    属性：\n      this.sprite 精灵\n  */\n  Game.assign(\"ActorHero\", class GameActorHero extends Game.Actor {\n    constructor (actorData) {\n      super(actorData);\n      let privates = internal(this);\n      privates.ai = null;\n\n      this.on(\"kill\", (event) => {\n        let actor = event.data;\n        if (actor.data.exp) {\n          this.data.exp += actor.data.exp;\n        } else {\n          this.data.exp += 1;\n        }\n        this.data.quest.current.forEach((quest) => {\n          if (quest.target.type == \"kill\") {\n            if (quest.target.kill.hasOwnProperty(actor.id)) {\n              let t = quest.target.kill[actor.id];\n              if (t.current < t.need) {\n                t.current++;\n              }\n            }\n          }\n        });\n      });\n    }\n\n    hasQuest (id) {\n      for (let quest of this.data.quest.current) {\n        if (id == quest.id) {\n          return true;\n        }\n      }\n      for (let quest of this.data.quest.past) {\n        if (id == quest.id) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    damage (attacker, skill) {\n      super.damage(attacker, skill);\n\n      // 如果英雄受到了伤害\n      let touchActor = [];\n      for (let actor of Game.area.actors) {\n        // 找到所有邻接英雄的怪物\n        if (actor != this && actor.data.type == \"monster\" && actor.distance(this) == 1) {\n          touchActor.push(actor);\n        }\n      }\n      if (touchActor.length) {\n        let faceAttacker = false;\n        let facePosition = this.facePosition;\n        touchActor.forEach(function (actor) {\n          if (actor.hitTest(facePosition.x, facePosition.y)) {\n            faceAttacker = true;\n          }\n        });\n        // 如果英雄现在没面对任何一个邻接的怪物，面向它\n        if (faceAttacker == false) {\n          this.goto(touchActor[0].x, touchActor[0].y);\n        }\n      }\n    }\n\n    erase () {\n      let privates = internal(this);\n      super.erase();\n\n      if (privates.ai) {\n        Sprite.Ticker.off(\"tick\", privates.ai);\n        privates.ai = null;\n      }\n    }\n\n    refreshBar () {\n      super.refreshBar();\n      Game.windows.interface.status(\n        this.data.hp / this.data.$hp, // 生命百分比\n        this.data.sp / this.data.$sp // 精神力百分比\n      );\n    }\n\n    draw () {\n      let privates = internal(this);\n      super.draw();\n\n      privates.ai = Sprite.Ticker.on(\"tick\", (event) => {\n\n        let tickCount = event.data;\n\n        // 每秒16个tick\n        if (tickCount % 16 == 0) {\n          let barChanged = false;\n\n          if (this.data.hp < this.data.$hp) {\n            this.data.hp++;\n            barChanged = true;\n          }\n\n          if (this.data.sp < this.data.$sp) {\n            this.data.sp++;\n            barChanged = true;\n          }\n\n          if (barChanged) {\n            this.refreshBar();\n            if (Game.windows.status.atop) {\n              Game.windows.status.update();\n            }\n          }\n        }\n\n      });\n\n\n    }\n\n\n  });\n\n\n})();\n"]}