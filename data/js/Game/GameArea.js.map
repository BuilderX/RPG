{"version":3,"sources":["src/Game/GameArea.js"],"names":[],"mappings":"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","file":"src/Game/GameArea.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n\n(function () {\n  \"use strict\";\n\n  // 游戏无论什么时候都需要预加载的内容\n  function Preload () {\n    return new Promise(function (resolve, reject) {\n      let promises = new Set();\n\n      let preloadSoundEffects = {\n        hurt: \"sound/effect/hurt.ogg\" // 伤害效果音\n      };\n\n      for (let key in preloadSoundEffects) {\n        promises.add(\n          (function (key, url) {\n            return new Promise(function (resolve, reject) {\n              if (Game.sounds && Game.sounds[key]) {\n                resolve();\n              } else {\n                Sprite.load(url).then(function (data) {\n                  Game.sounds[key] = data[0];\n                  resolve();\n                });\n              }\n            });\n          })(key, preloadSoundEffects[key])\n        );\n      }\n\n      let preloadItems = [\n        \"bag\", // 掉落物品用的小包\n        \"gold\" // 金币图标\n      ];\n\n      preloadItems.forEach(function (id) {\n        promises.add(\n          new Promise(function (resolve, reject) {\n            if (Game.items && Game.items[id]) {\n              resolve();\n            } else {\n              Game.Item.load(id).then(function (itemObj) {\n                resolve();\n              });\n            }\n          })\n        );\n      });\n\n      Promise.all(promises).then(function () {\n        resolve();\n      });\n    });\n  }\n\n  // 加载区域，把括地图，角色，物品\n  Game.assign(\"loadArea\", function (id) {\n    return new Promise(function (resolve, reject) {\n\n      Game.Map.load(id).then(function (mapObj) {\n\n        let area = {\n          actors: new Set(), // 角色\n          bags: new Set(), // 掉落小包\n          items: new Set(), // 其他物品（有碰撞）\n          touch: [], // touch或onto会触发的地点/物品\n          onto: [], // onto会触发的地点/物品\n          map: mapObj\n        };\n\n        let promises = new Set();\n\n        promises.add(Preload());\n\n        if (mapObj.data.actors) {\n          mapObj.data.actors.forEach(function (element) {\n            promises.add(\n              new Promise(function (resolve, reject) {\n                Game.Actor.load(element.id).then(function (actorObj) {\n\n                  for (let key in element) {\n                    actorObj.data[key] = element[key];\n                  }\n\n                  area.actors.add(actorObj);\n                  actorObj.draw();\n                  resolve();\n                });\n              })\n            );\n          });\n        }\n\n        if (\n          mapObj.spawnMonster &&\n          mapObj.spawnMonster.list &&\n          mapObj.spawnMonster.count\n        ) {\n          for (let monsterId in mapObj.spawnMonster.list) {\n            promises.add(\n              new Promise(function (resolve, reject) {\n                Game.Actor.load(monsterId).then(function () {\n                  resolve();\n                });\n              })\n            );\n          }\n        }\n\n        if (\n          mapObj.spawnItem &&\n          mapObj.spawnItem.list &&\n          mapObj.spawnItem.count\n        ) {\n          for (let itemId in mapObj.spawnItem.list) {\n            promises.add(\n              new Promise(function (resolve, reject) {\n                Game.Item.load(itemId).then(function () {\n                  resolve();\n                });\n              })\n            );\n          }\n        }\n\n        if (mapObj.data.onto) {\n          mapObj.data.onto.forEach(function (element) {\n            let onto = Sprite.copy(element);\n            onto.type = \"onto\";\n            area.onto.push(onto);\n          });\n        }\n\n        if (mapObj.data.touch) {\n          mapObj.data.touch.forEach(function (element) {\n            let touch = Sprite.copy(element);\n            area.touch.push(touch);\n          });\n        }\n\n        Promise.all(promises).then(function () {\n          resolve(area);\n        });\n\n      }); //map\n\n    });\n  });\n\n})();\n"]}