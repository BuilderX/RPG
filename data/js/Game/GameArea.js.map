{"version":3,"sources":["src/Game/GameArea.js"],"names":[],"mappings":"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","file":"src/Game/GameArea.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n\n(function () {\n  \"use strict\";\n\n  // 加载区域，把括地图，角色，物品\n  Game.assign(\"loadArea\", function (id, callback) {\n\n    let preloadSoundEffects = {\n      hurt: \"sound/effect/hurt.ogg\"\n    };\n\n    for (let key in preloadSoundEffects) {\n      (function (key, url) {\n        Sprite.Loader.create()\n          .add(url)\n          .start()\n          .on(\"complete\", function (event) {\n            Game.sounds[key] = event.data[0];\n          }\n        );\n      })(key, preloadSoundEffects[key]);\n    }\n\n    let preloadItems = [\"bag\", \"gold\"];\n    preloadItems = preloadItems.filter(function (element) {\n      if (Game.items && Game.items.hasOwnProperty(element)) {\n        return false;\n      }\n      return true;\n    });\n\n    if (preloadItems.length > 0) {\n      let itemLoader = Sprite.Loader.create();\n      preloadItems.forEach(function (id) {\n        Game.Item.load(id)\n      });\n    }\n\n    Sprite.Loader\n      .create()\n      .add(`map/${id}.json`, `map/${id}.extra.json`)\n      .start()\n      .on(\"complete\", function (event) {\n\n      let mapData = event.data[0];\n      let mapExtra = event.data[1];\n      mapData.id = id;\n\n      for (let key in mapExtra) {\n        mapData[key] = mapExtra[key];\n      }\n\n      let mapObj = new Game.Map(mapData);\n      mapObj.on(\"complete\", function () {\n\n        let area = {\n          actors: new Set(),\n          bags: new Set(),\n          touch: [], // touch或onto会触发的地点/物品\n          onto: [], // onto会触发的地点/物品\n          map: mapObj\n        };\n\n        let completeCount = -1;\n        let Complete = () => {\n          completeCount++;\n          if (completeCount >= 0) {\n            callback(area);\n          }\n        };\n\n        if (mapExtra.actors) {\n          mapExtra.actors.forEach(function (element) {\n            completeCount--;\n            Sprite.Loader\n              .create()\n              .add(`actor/${element.id}.json`)\n              .start()\n              .on(\"complete\", function (event) {\n              let actorData = Sprite.copy(event.data[0]);\n              actorData.id = id;\n              for (let key in element) {\n                actorData[key] = element[key];\n              }\n              let actorObj = null;\n\n              if (actorData.type == \"ally\") {\n                actorObj = new Game.ActorAlly(actorData);\n              } else if (actorData.type == \"monster\") {\n                actorObj = new Game.ActorMonster(actorData);\n              } else if (actorData.type == \"npc\") {\n                actorObj = new Game.ActorNPC(actorData);\n              } else if (actorData.type == \"pet\") {\n                actorObj = new Game.ActorPet(actorData);\n              } else {\n                console.error(actorData.type, actorData);\n                throw new Error(\"Invalid actor type\");\n              }\n\n              actorObj.on(\"complete\", function () {\n                area.actors.add(actorObj);\n                actorObj.draw(Game.layers.actorLayer);\n                Complete();\n              });\n            });\n          });\n        }\n\n        if (mapExtra.onto) {\n          mapExtra.onto.forEach(function (element) {\n            let onto = Sprite.copy(element);\n            onto.type = \"onto\";\n            area.onto.push(onto);\n          });\n        }\n\n        if (mapExtra.touch) {\n          mapExtra.touch.forEach(function (element) {\n            let touch = Sprite.copy(element);\n            area.touch.push(touch);\n          });\n        }\n\n        Complete();\n      });\n    });\n  });\n\n})();\n"]}