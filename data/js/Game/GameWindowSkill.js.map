{"version":3,"sources":["src/Game/GameWindowSkill.js"],"names":[],"mappings":"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","file":"src/Game/GameWindowSkill.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  let win = Game.windows.skill = Game.Window.create(\"skillWindow\");\n\n  win.html = `\n    <div class=\"window-box\">\n      <div id=\"skillWindowItemBar\">\n        <button id=\"skillWindowClose\" class=\"brownButton\">关闭</button>\n      </div>\n      <table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n        <thead>\n          <tr>\n            <td style=\"width: 40px;\"></td>\n            <td style=\"width: 120px;\"></td>\n            <td></td>\n            <td style=\"width: 60px;\"></td>\n          </tr>\n        </thead>\n        <tbody id=\"skillWindowTable\"></tbody>\n      </table>\n    </div>\n  `;\n\n  win.css = `\n    .skillWindow table {\n      width: 100%;\n    }\n\n    .skillWindow table img {\n      width: 100%;\n      height: 100%;\n    }\n\n    .skillWindow button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n    }\n\n    #skillWindowItemBar button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n      margin-left: 5px;\n      margin-right: 5px;\n      margin-top: 0px;\n      margin-bottom: 5px;\n    }\n\n    #skillWindowClose {\n      float: right;\n    }\n  `;\n\n  let skillWindowClose = win.querySelector(\"button#skillWindowClose\");\n  let skillWindowTable = win.querySelector(\"#skillWindowTable\");\n\n  let lastSelect = -1;\n\n  skillWindowClose.addEventListener(\"click\", function (event) {\n    win.hide();\n  });\n\n  win.whenUp([\"esc\"], function (key) {\n    setTimeout(function () {\n      win.hide();\n    }, 20);\n  });\n\n  win.assign(\"open\", function (select) {\n\n    if (typeof select == \"undefined\") {\n      select = -1;\n    }\n\n    lastSelect = select;\n\n    let index = 0;\n    let table = \"\";\n    Game.hero.data.skills.forEach(function (skillId) {\n      let skill = Game.skills[skillId];\n\n      let line = \"\";\n\n      if (select == index) {\n        line += `<tr style=\"background-color: green;\">\\n`;\n      } else {\n        line += `<tr>\\n`;\n      }\n\n      line += `  <td><img alt=\"\" src=\"${skill.icon.src}\"></td>\\n`;\n      line += `  <td>${skill.data.name}</td>\\n`;\n      line += `  <td>${skill.data.description}</td>\\n`;\n      line += `  <td><button data-id=\"${skillId}\" class=\"brownButton skillWindowManage\">管理</button></td>\\n`;\n      line += \"</tr>\\n\";\n      table += line;\n      index++;\n    });\n\n    skillWindowTable.innerHTML = table;\n    Game.windows.skill.show();\n  });\n\n  win.whenUp([\"enter\"], function () {\n    let buttons = win.querySelectorAll(\".skillWindowManage\");\n    if (lastSelect >= 0 && lastSelect < buttons.length) {\n      buttons[lastSelect].click();\n    }\n  });\n\n  win.whenUp([\"up\", \"down\"], function (key) {\n    let count = win.querySelectorAll(\".skillWindowManage\").length;\n\n    if (lastSelect == -1) {\n      if (key == \"down\") {\n        win.open(0);\n      } else if (key == \"up\") {\n        win.open(count - 1);\n      }\n    } else {\n      if (key == \"down\") {\n        let select = lastSelect + 1;\n        if (select >= count) {\n          select = 0;\n        }\n        win.open(select);\n      } else if (key == \"up\") {\n        let select = lastSelect - 1;\n        if (select < 0) {\n          select = count - 1;\n        }\n        win.open(select);\n      }\n    }\n  });\n\n  skillWindowTable.addEventListener(\"click\", function (event) {\n    let skillId = event.target.getAttribute(\"data-id\");\n    let index = Game.hero.data.skills.indexOf(skillId);\n    if (skillId && Game.skills.hasOwnProperty(skillId) && index != -1) {\n\n      let skill = Game.skills[skillId];\n\n      let options = {};\n\n      options[\"快捷栏\"] = \"shortcut\";\n      options[\"遗忘\"] = \"remove\";\n      if (skill.data.next) {\n        options[\"升级\"] = \"levelup\";\n      }\n\n      Game.choice(options, function (choice) {\n        switch(choice) {\n          case \"shortcut\":\n            Game.choice({\n              1:0,\n              2:1,\n              3:2,\n              4:3,\n              5:4,\n              6:5,\n              7:6,\n              8:7\n            }, function (choice) {\n              if (Number.isFinite(choice) && choice >= 0) {\n                Game.hero.data.bar[choice] = {\n                  id: skillId,\n                  type: \"skill\"\n                };\n                Game.windows.interface.refresh();\n              }\n            });\n            break;\n          case \"levelup\":\n            if (skill.data.next) {\n              let cannot = [];\n              if (Game.hero.data.gold < skill.data.next.gold) {\n                cannot.push(`金币不足，需要金币${skill.data.next.gold}，当前您有金币${Game.hero.data.gold}`);\n              }\n              if (Game.hero.data.exp < skill.data.next.exp) {\n                cannot.push(`经验不足，需要经验${skill.data.next.exp}，当前您有经验${Game.hero.data.exp}`);\n              }\n              if (cannot.length) {\n                Game.dialogue(cannot);\n                return;\n              }\n              Game.confirm(`确定要升级这个技能吗？共需要金币${skill.data.next.gold}，经验${skill.data.next.exp}`, function () {                let nextId = skill.data.next.id;\n                Game.hero.data.skills.splice(index, 1);\n                Game.hero.data.skills.push(nextId);\n                Game.hero.data.gold -= skill.data.next.gold;\n                Game.hero.data.exp -= skill.data.next.exp;\n                Game.windows.loading.begin();\n                Game.Skill.load(nextId).then(function (skillObj) {\n                  Game.windows.loading.end();\n                  win.open();\n                });\n              });\n            }\n            break;\n          case \"remove\":\n            Game.confirm(`真的要遗忘 ${skill.data.name} 技能吗？`, function () {\n              Game.hero.data.bar.forEach(function (element, index, array) {\n                if (element && element.id == skillId) {\n                  array[index] = null;\n                }\n              });\n              Game.hero.data.skills.splice(index, 1);\n              Game.windows.interface.refresh();\n              win.open();\n            });\n            break;\n        }\n      });\n\n    }\n  });\n\n\n})();\n"]}