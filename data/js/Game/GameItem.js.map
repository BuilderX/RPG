{"version":3,"sources":["src/Game/GameItem.js"],"names":[],"mappings":"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","file":"src/Game/GameItem.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  let internal = Sprite.Namespace();\n\n  Game.assign(\"Item\", class GameItem extends Sprite.Event {\n\n    static load (id) {\n      return new Promise(function (resolve, reject) {\n        Sprite.load(`item/${id}.js`).then(function (data) {\n          let itemData = data[0]();\n          itemData.id = id;\n          let itemObj = new Game.Item(itemData);\n          Game.items[id] = itemObj;\n          itemObj.on(\"complete\", () => {\n            resolve(itemObj);\n          });\n        });\n      });\n    }\n\n    constructor (itemData) {\n      super();\n      let privates = internal(this);\n\n      privates.data = itemData;\n      privates.inner = null;\n\n      if (!this.data.x || !this.data.y) {\n        this.data.x = 0;\n        this.data.y = 0;\n      }\n\n      Sprite.load(`item/${this.data.image}`).then((data) => {\n        let image = data[0];\n        privates.icon = image;\n\n        privates.bitmap = new Sprite.Bitmap(image);\n        privates.bitmap.x = this.data.x * 32 + 16;\n        privates.bitmap.y = this.data.y * 32 + 16;\n        privates.bitmap.name = this.id;\n\n        if (Number.isInteger(this.data.centerX) && Number.isInteger(this.data.centerY)) {\n          privates.bitmap.centerX = this.data.centerX;\n          privates.bitmap.centerY = this.data.centerY;\n        } else {\n          console.log(this.data);\n          throw new Error(\"Game.Item invalid centerX/centerY\");\n        }\n\n        // 发送完成事件，第二个参数代表一次性事件\n        this.emit(\"complete\", true);\n      });\n    }\n\n    get id () {\n      return internal(this).data.id;\n    }\n\n    set id (value) {\n      throw new Error(\"Game.Item.id readonly\");\n    }\n\n    get icon () {\n      return internal(this).bitmap.image;\n    }\n\n    set icon (value) {\n      throw new Error(\"Game.Item.icon readonly\");\n    }\n\n    get data () {\n      return internal(this).data;\n    }\n\n    set data (value) {\n      console.error(this);\n      throw new Error(\"Game.Item.data readonly\");\n    }\n\n    get inner () {\n      return internal(this).inner;\n    }\n\n    set inner (value) {\n      internal(this).inner = value;\n    }\n\n    get x () {\n      return internal(this).data.x;\n    }\n\n    set x (value) {\n      let privates = internal(this);\n      privates.data.x = value;\n      privates.bitmap.x = value * 32 + 16;\n    }\n\n    get y () {\n      return internal(this).data.y;\n    }\n\n    set y (value) {\n      let privates = internal(this);\n      privates.data.y = value;\n      privates.bitmap.y = value * 32 + 16;\n    }\n\n    get visible () {\n      return internal(this).bitmap.visible;\n    }\n\n    set visible (value) {\n      internal(this).bitmap.visible = value;\n    }\n\n    get alpha () {\n      return internal(this).bitmap.alpha;\n    }\n\n    set alpha (value) {\n      if (Number.isFinite(value) && value >= 0 && value <= 1) {\n        internal(this).bitmap.alpha = value;\n      } else {\n        console.error(value, this);\n        throw new Error(\"Game.Item.alpha got invalid value\");\n      }\n    }\n\n    get position () {\n      return {\n        x: this.x,\n        y: this.y\n      };\n    }\n\n    set position (value) {\n      console.error(this.data);\n      throw new Error(\"Game.Item.position readonly\");\n    }\n\n    hitTest (x, y) {\n      if (this.data.hitArea && this.data.hitArea instanceof Array) {\n        for (let p of this.data.hitArea) {\n          if (x == this.x + p[0] && y == this.y + p[1]) {\n            return true;\n          }\n        }\n        return false;\n      } else {\n        console.error(this.data);\n        throw new Error(\"Game.Actor.hitTest invalid data\");\n      }\n    }\n\n    heroUse () {\n      if (this.inner) {\n        Game.windows.pickup.open(this);\n      }\n\n      if (typeof this.data.use == \"function\") {\n        this.data.use();\n      }\n\n      if (this.data.type == \"potion\") {\n        for (let attribute in this.data.potion) {\n          let effect = this.data.potion[attribute];\n          if (attribute == \"hp\") {\n            Game.hero.data.hp = Math.min(\n              Game.hero.data.hp + effect,\n              Game.hero.data.$hp\n            );\n            let text = new Sprite.Text({\n              text: `hp+${effect}`,\n              color: \"black\",\n              fontSize: 20\n            });\n            text.centerX = Math.floor(text.width / 2);\n            text.centerY = Math.floor(text.height);\n            text.x = Game.hero.sprite.x;\n            text.y = Game.hero.sprite.y;\n            Game.layers.actorLayer.appendChild(text);\n            Sprite.Ticker.whiles(100, (last) => {\n              text.y -= 3;\n              if (last) {\n                Game.layers.actorLayer.removeChild(text);\n              }\n            });\n          }\n        }\n        Game.hero.data.items[this.id]--;\n        if (Game.hero.data.items[this.id] <= 0) {\n          delete Game.hero.data.items[this.id];\n        }\n      } // potion\n\n    }\n\n    erase (layer) {\n      Game.layers.itemLayer.removeChild(internal(this).bitmap);\n    }\n\n    draw () {\n      Game.layers.itemLayer.appendChild(internal(this).bitmap);\n    }\n\n  });\n\n\n})();\n"]}