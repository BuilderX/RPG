{"version":3,"sources":["src/Game/GameItem.js"],"names":[],"mappings":"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","file":"src/Game/GameItem.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  Game.Item = class GameItem extends Sprite.Event {\n\n    static load (id, callback) {\n      var itemLoader = new Sprite.Loader();\n      itemLoader.add(`/item/${id}.json`);\n      itemLoader.start();\n      itemLoader.on(\"complete\", (event) => {\n        var itemData = event.data[0];\n        var itemObj = new Game.Item(itemData);\n        Game.items[id] = itemObj;\n        itemObj.on(\"complete\", () => {\n          if (typeof callback == \"function\") {\n            callback();\n          }\n        });\n      });\n    }\n\n    constructor (itemData) {\n      super();\n\n      this.data = itemData;\n      this.id = this.data.id;\n      this.inner = null;\n\n      if (!this.data.x || !this.data.y) {\n        this.data.x = 0;\n        this.data.y = 0;\n      }\n\n      var loader = new Sprite.Loader();\n      loader.add(`/item/${this.data.image}`);\n      loader.start();\n      loader.on(\"complete\", (event) => {\n        var image = event.data[0];\n\n        this.icon = image;\n\n        this.bitmap = new Sprite.Bitmap(image);\n        this.bitmap.x = this.data.x * 32 + 16;\n        this.bitmap.y = this.data.y * 32 + 16;\n\n        if (Number.isInteger(this.data.centerX) && Number.isInteger(this.data.centerY)) {\n          this.bitmap.centerX = this.data.centerX;\n          this.bitmap.centerY = this.data.centerY;\n        } else {\n          console.log(this.data);\n          throw new Error(\"Game.Item invalid centerX/centerY\");\n        }\n\n        this.bitmap.name = this.id;\n\n        // 发送完成事件，第二个参数代表一次性事件\n        this.emit(\"complete\", true);\n      });\n    }\n\n    get x () {\n      return this.data.x;\n    }\n\n    set x (value) {\n      this.data.x = value;\n      this.bitmap.x = value * 32 + 16;\n    }\n\n    get y () {\n      return this.data.x;\n    }\n\n    set y (value) {\n      this.data.y = value;\n      this.bitmap.y = value * 32 + 16;\n    }\n\n    get position () {\n      return {\n        x: this.x,\n        y: this.y\n      };\n    }\n\n    set position (value) {\n      console.error(this.data);\n      throw new Error(\"Game.Item.position readonly\");\n    }\n\n    hitTest (x, y) {\n      if (this.data.hitArea && this.data.hitArea instanceof Array) {\n        for (let p of this.data.hitArea) {\n          if (x == this.x + p[0] && y == this.y + p[1]) {\n            return true;\n          }\n        }\n        return false;\n      } else {\n        console.error(this.data);\n        throw new Error(\"Game.Actor.hitTest invalid data\");\n      }\n    }\n\n    pickup () {\n      if (this.inner) {\n        Game.windows.pickup.execute(\"pickup\", this);\n      }\n    }\n\n    use (actor) {\n      if (this.data.type == \"potion\") {\n        for (let attribute in this.data.potion) {\n          var effect = this.data.potion[attribute];\n          if (attribute == \"hp\") {\n            actor.data.hp += effect;\n            if (actor.data.hp > actor.data.$hp) {\n              actor.data.hp = actor.data.$hp;\n            }\n          }\n        }\n      }\n    }\n\n    clone (callback) {\n      var itemObj = new Game.Item(this.data);\n      itemObj.x = this.x;\n      itemObj.y = this.y;\n      itemObj.inner = this.inner;\n      return itemObj;\n    }\n\n    erase (layer) {\n      layer.removeChild(this.bitmap);\n    }\n\n    draw (layer) {\n      layer.appendChild(this.bitmap);\n    }\n\n  };\n\n})();\n"]}