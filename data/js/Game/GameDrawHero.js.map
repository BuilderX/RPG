{"version":3,"sources":["../../../src/Game/GameDrawHero.js"],"names":[],"mappings":"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","file":"GameDrawHero.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n\n(function () {\n  \"use strict\";\n\n  // 合并图片\n  // 把images中的所有图片按顺序draw到一个canvas上面，然后用canvas.toDataURL返回一张叠好的图片\n  function CombineHeroImage (images, width, height) {\n    return new Promise(function (resolve, reject) {\n      let canvas = document.createElement(\"canvas\");\n      canvas.height = height;\n      canvas.width = width;\n      let context = canvas.getContext(\"2d\");\n      context.clearRect(0, 0, width, height);\n\n      let length = images.length - 1; // 最后一张图是武器\n      for (let i = 0; i < length; i++) {\n        let img = images[i];\n        context.drawImage(\n          img, 0, 0, img.width, img.height,\n          0, 0, width, height\n        );\n      }\n\n      let withoutWeapon = null;\n      let withWeapon = null;\n\n      let promises = new Set();\n\n      withoutWeapon = new Image();\n      withoutWeapon.src = canvas.toDataURL(\"image/png\");\n\n      promises.add(\n        new Promise(function (resolve, reject) {\n          if (withoutWeapon.complete) {\n            resolve();\n          } else {\n            withoutWeapon.onload = function () {\n              resolve();\n            };\n          }\n        })\n      );\n\n      context.drawImage(\n        images[length], 0, 0, images[length].width, images[length].height,\n        0, 0, width, height\n      );\n\n      withWeapon = new Image();\n      withWeapon.src = canvas.toDataURL(\"image/png\");\n\n      promises.add(\n        new Promise(function (resolve, reject) {\n          if (withWeapon.complete) {\n            resolve();\n          } else {\n            withWeapon.onload = function () {\n              resolve();\n            };\n          }\n        })\n      );\n\n      // Promise es6 \n      Promise.all(promises).then(function () {\n        resolve([withoutWeapon, withWeapon]);\n      });\n    });\n  }\n\n\n  function Check (str) {\n    if (typeof str == \"string\" && str.length > 0)\n      return true;\n    return false;\n  }\n\n  // 把多张图片合成一张，并返回\n  Game.assign(\"drawHero\", function (heroCustom) {\n    return new Promise(function (resolve, reject) {\n      let BASE = \"hero\";\n      let imageUrls = [];\n\n      if (Check(heroCustom.sex) && Check(heroCustom.body)) {\n        // 必须按顺序\n        // 身体\n        imageUrls.push(`${BASE}/body/${heroCustom.sex}/${heroCustom.body}.png`);\n        // 眼睛\n        if (Check(heroCustom.eyes))\n          imageUrls.push(`${BASE}/body/${heroCustom.sex}/eyes/${heroCustom.eyes}.png`);\n        // 衣服\n        if (Check(heroCustom.shirts))\n          imageUrls.push(`${BASE}/shirts/${heroCustom.sex}/${heroCustom.shirts}.png`);\n        if (Check(heroCustom.pants))\n          imageUrls.push(`${BASE}/pants/${heroCustom.sex}/${heroCustom.pants}.png`);\n        if (Check(heroCustom.shoes))\n        // 盔甲\n          imageUrls.push(`${BASE}/shoes/${heroCustom.sex}/${heroCustom.shoes}.png`);\n        if (Check(heroCustom.armorchest))\n          imageUrls.push(`${BASE}/armor/chest/${heroCustom.sex}/${heroCustom.armorchest}.png`);\n        if (Check(heroCustom.armorarm))\n          imageUrls.push(`${BASE}/armor/arm/${heroCustom.sex}/${heroCustom.armorarm}.png`);\n        if (Check(heroCustom.armorlegs))\n          imageUrls.push(`${BASE}/armor/legs/${heroCustom.sex}/${heroCustom.armorlegs}.png`);\n        if (Check(heroCustom.armorfeet))\n          imageUrls.push(`${BASE}/armor/feet/${heroCustom.sex}/${heroCustom.armorfeet}.png`);\n        // 头发\n        if (Check(heroCustom.hair) && Check(heroCustom.haircolor))\n          imageUrls.push(`${BASE}/hair/${heroCustom.sex}/${heroCustom.hair}/${heroCustom.haircolor}.png`);\n        // 头\n        if (Check(heroCustom.head))\n          imageUrls.push(`${BASE}/head/${heroCustom.sex}/${heroCustom.head}.png`);\n        // 头盔\n        if (Check(heroCustom.armorhelms))\n          imageUrls.push(`${BASE}/armor/helms/${heroCustom.sex}/${heroCustom.armorhelms}.png`);\n        // 武器（包括所有武器）\n        imageUrls.push(`${BASE}/weapons/${heroCustom.sex}/weapons.png`);\n      }\n\n      Sprite.load(imageUrls).then(function (data) {\n        CombineHeroImage(data, heroCustom.width, heroCustom.height).then(function (data) {\n          resolve(data);\n        });\n      });\n    });\n\n\n  });\n\n\n})();\n"]}