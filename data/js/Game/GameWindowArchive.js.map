{"version":3,"sources":["src/Game/GameWindowArchive.js"],"names":[],"mappings":"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","file":"src/Game/GameWindowArchive.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  var win = Game.windows.archive = new Game.Window(\"archiveWindow\");\n\n  win.html(`\n    <div class=\"window-box\">\n      <div id=\"archiveWindowItemBar\">\n        <button id=\"archiveWindowSave\">保存</button>\n        <button id=\"archiveWindowClose\">关闭</button>\n      </div>\n      <div id=\"archiveWindowTable\"></div>\n    </div>\n  `);\n\n  win.css(`\n    #archiveWindowTable {\n      width: 100%;\n      overflow-y: auto;\n      height: 360px;\n    }\n\n    .archiveItem {\n      border: 4px solid gray;\n      border-radius: 10px;\n      margin: 10px 10px;\n    }\n\n    .archiveItem > button {\n      width: 100px;\n      height: 40px;\n      border-radius: 5px;\n    }\n\n    #archiveWindowClose {\n      width: 100px;\n      height: 30px;\n      float: right;\n      font-size: 16px;\n      display: block;\n      margin-bottom: 5px;\n    }\n  `);\n\n  var archiveWindowSave = document.querySelector(\"button#archiveWindowSave\");\n  var archiveWindowClose = document.querySelector(\"button#archiveWindowClose\");\n  var archiveWindowTable = document.querySelector(\"#archiveWindowTable\");\n\n  archiveWindowSave.addEventListener(\"click\", function () {\n    Game.stage.requestScreenshot(function (img) {\n      var canvas=document.createElement(\"canvas\");\n      canvas.width = 80;\n      canvas.height = 45;\n      var context = canvas.getContext(\"2d\");\n      context.drawImage(img, 0, 0, img.width, img.height, 0, 0, 80, 45);\n      var screenshot = canvas.toDataURL(\"image/jpeg\");\n\n      Game.archive.save({\n        hero: Game.hero.data,\n        screenshot: screenshot\n      });\n\n      Game.windows.archive.execute(\"open\");\n    });\n  });\n\n  archiveWindowClose.addEventListener(\"click\", function () {\n    Game.windows.archive.hide();\n  });\n\n  win.register(\"open\", function () {\n\n    var table = archiveWindowTable;\n\n    while(table.hasChildNodes()) {\n      table.removeChild(table.lastChild);\n    }\n\n    var list = Game.archive.list();\n    list.forEach(function (element) {\n      var div = document.createElement(\"div\");\n      div.classList.add(\"archiveItem\");\n\n      var archive = Game.archive.get(`SAVE_${element}`);\n\n      var removeButton = document.createElement(\"button\");\n      removeButton.style.float = \"right\";\n      removeButton.textContent = \"REMOVE\";\n      div.appendChild(removeButton);\n      removeButton.addEventListener(\"click\", function () {\n        Game.archive.remove(`SAVE_${element}`);\n        Game.windows.archive.execute(\"open\");\n      });\n\n      var loadButton = document.createElement(\"button\");\n      loadButton.style.float = \"right\";\n      loadButton.textContent = \"LOAD\";\n      div.appendChild(loadButton);\n      loadButton.addEventListener(\"click\", function () {\n        Game.archive.load(`SAVE_${element}`);\n        Game.windows.archive.hide();\n      });\n\n      var screenshot = new Image();\n      screenshot.width = \"80\";\n      screenshot.height = \"45\";\n      screenshot.alt = \"存档截图\";\n      if (archive.screenshot) {\n        screenshot.src = archive.screenshot;\n      }\n      screenshot.style.display = \"inline-block\";\n      screenshot.style.margin = \"5px\";\n      div.appendChild(screenshot);\n\n      var heroName = document.createElement(\"label\");\n      heroName.innerHTML = archive.name;\n      heroName.style.fontSize = \"20px\";\n      heroName.style.margin = \"10px\";\n      div.appendChild(heroName);\n\n      var time = document.createElement(\"label\");\n      time.innerHTML = archive.date;\n      div.appendChild(time);\n\n      table.appendChild(div);\n    });\n\n    Game.windows.archive.show();\n  });\n\n}());\n"]}