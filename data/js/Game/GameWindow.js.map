{"version":3,"sources":["src/Game/GameWindow.js"],"names":[],"mappings":"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","file":"src/Game/GameWindow.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  Game.windows = {};\n\n  var zIndex = 227;\n\n  Game.Window = class GameWindow extends Sprite.Event {\n\n    static clear () {\n      var nodes = document.getElementsByClassName(\"GameWindowClass\");\n      for (let i = 0; i < nodes.length; i++) {\n        nodes[i].style.display = \"none\";\n      }\n    }\n\n    constructor (id) {\n      super();\n      this._id = id;\n      this._html = null;\n      this._css = null;\n      this._exec = {};\n    }\n\n    register (name, callback) {\n      this._exec[name] = callback;\n    }\n\n    execute () {\n      var args = Array.prototype.slice.call(arguments);\n      var name = args[0];\n      args.splice(0, 1);\n      this._exec[name].apply(this, args);\n    }\n\n    show () {\n      if (this._html) {\n        this.emit(\"beforeShow\");\n        this._html.style.zIndex = zIndex;\n        this._html.style.display = \"block\";\n        zIndex++;\n        this.emit(\"afterShow\");\n      }\n    }\n\n    hide () {\n      if (this._html) {\n        this.emit(\"beforeHide\");\n        this._html.style.display = \"none\";\n        this.emit(\"afterHide\");\n      }\n    }\n\n    showing () {\n      if (this._html && this._html.style.display != \"none\") {\n        return true;\n      }\n      return false;\n    }\n\n    only () {\n      var nodes = document.getElementsByClassName(\"GameWindowClass\");\n      var showing = 0;\n      for (let i = 0; i < nodes.length; i++) {\n        if (nodes[i].style.display != \"none\") {\n          showing++;\n        }\n      }\n      if (showing == 1 && this.showing()) {\n        return true;\n      }\n      return false;\n    }\n\n    html (html) {\n      if (this._html) {\n        document.body.removeChild(this._html);\n        this._html = null;\n      }\n      this._html = document.createElement(\"div\");\n      this._html.id = this._id;\n      this._html.innerHTML = html;\n      this._html.classList.add(\"GameWindowClass\");\n      this._html.style.display = \"none\";\n      document.body.appendChild(this._html);\n    }\n\n    css (css) {\n      if (this._css) {\n        document.head.removeChild(this._css);\n        this._css = null;\n      }\n      this._css = document.createElement(\"style\");\n      this._css.innerHTML = css;\n      document.body.appendChild(this._css);\n    }\n\n    // 当窗口大小改变时改变游戏窗口大小\n    static resize () {\n      var width = window.innerWidth;\n      var height = window.innerHeight;\n      var scale = 1;\n      var leftMargin = 0;\n      var topMargin = 0;\n\n      if (Game.config.scale == false) {\n        // 不拉伸游戏窗口，按原始大小计算窗口居中\n        leftMargin = Math.floor((width - Game.config.width) / 2);\n        topMargin = Math.floor((height - Game.config.height) / 2);\n      } else {\n        // 拉伸游戏窗口，首先计算游戏原始大小比例\n        var ratio = Game.config.width / Game.config.height;\n        // width first\n        var w = width;\n        var h = w / ratio;\n        // then height\n        if (h > height) {\n          h = height;\n          w = h * ratio;\n        }\n\n        w = Math.floor(w);\n        h = Math.floor(h);\n        leftMargin = Math.floor((width - w) / 2);\n        topMargin = Math.floor((height - h) / 2);\n\n        scale = Math.min(\n          w / Game.config.width,\n          h / Game.config.height\n        );\n      }\n\n      // html窗口拉伸（css中控制了原始大小）\n      var elements = document.getElementsByClassName(\"GameWindowClass\");\n      for (let i = 0; i < elements.length; i++) {\n        elements[i].style.transformOrigin = \"0 0 0\";\n        // elements[i].style.transform = `scale(${scale}, ${scale})`;\n        elements[i].style.transform = `scale3d(${scale}, ${scale}, 1.0)`;\n        elements[i].style.left = `${leftMargin}px`;\n        elements[i].style.top = `${topMargin}px`;\n      }\n\n      // 游戏画布拉伸\n      if (Game.stage && Game.stage.canvas) {\n        Game.stage.canvas.style.transformOrigin = \"0 0 0\";\n        // Game.stage.canvas.style.transform = `scale(${scale}, ${scale})`;\n        Game.stage.canvas.style.transform = `scale3d(${scale}, ${scale}, 1.0)`;\n        Game.stage.canvas.style.left = `${leftMargin}px`;\n        Game.stage.canvas.style.top = `${topMargin}px`;\n      }\n\n      if (Game.hero) {\n        Game.hero.focus();\n      }\n\n    };\n\n  };\n\n  Game.Window.resize();\n  window.addEventListener(\"resize\", function () {\n    Game.Window.resize();\n  });\n\n}());\n"]}