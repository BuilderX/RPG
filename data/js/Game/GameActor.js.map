{"version":3,"sources":["src/Game/GameActor.js"],"names":[],"mappings":"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","file":"src/Game/GameActor.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  var actorHold = [];\n\n  /*\n    角色类，包括涉及到hero和npc\n    属性：\n      this.sprite 精灵\n  */\n  Game.Actor = class GameActor extends Sprite.Event {\n    constructor (actorData) {\n      super();\n\n      this.data = actorData;\n      this.id = this.data.id;\n\n      // 名字\n      var text = new Sprite.Text({\n        text: this.data.name,\n        maxWidth: 200,\n        color: \"white\",\n        fontSize: 12\n      });\n      text.centerY = Math.floor(text.height / 2);\n      text.centerX = Math.floor(text.width / 2);\n      text.x = 0;\n      text.y = 0;\n      this.text = text;\n\n      // 一个上面四个精神条、血条的聚合，统一管理放入这个Container\n      this.infoBox = new Sprite.Container();\n\n      if (this.data.type == \"npc\") {\n        this.text.y += 10;\n        this.infoBox.appendChild(this.text);\n      } else if (this.data.type == \"hero\") {\n        // do nothing\n      } else {\n        // 血条外面的黑框\n        this.hpbarBox = new Sprite.Shape();\n        this.hpbarBox.centerX = 15;\n        this.hpbarBox.centerY = 2;\n        this.hpbarBox.x = 0;\n        this.hpbarBox.y = 9;\n\n        // 魔法条外面的黑框\n        this.mpbarBox = new Sprite.Shape();\n        this.mpbarBox.centerX = 15;\n        this.mpbarBox.centerY = 2;\n        this.mpbarBox.x = 0;\n        this.mpbarBox.y = 12;\n\n        this.hpbarBox.rect({\n          x: 0,\n          y: 0,\n          width: 30,\n          height: 3,\n          \"fill-opacity\": 0\n        });\n\n        this.mpbarBox.rect({\n          x: 0,\n          y: 0,\n          width: 30,\n          height: 3,\n          \"fill-opacity\": 0\n        });\n\n        // 生命条\n        this.hpbar = new Sprite.Shape();\n        this.hpbar.centerX = 15;\n        this.hpbar.centerY = 2;\n        this.hpbar.x = 0;\n        this.hpbar.y = 9;\n\n        // 精力条\n        this.mpbar = new Sprite.Shape();\n        this.mpbar.centerX = 15;\n        this.mpbar.centerY = 2;\n        this.mpbar.x = 0;\n        this.mpbar.y = 12;\n\n        this.infoBox.appendChild(this.text,\n          this.hpbarBox, this.mpbarBox, this.hpbar, this.mpbar);\n      }\n\n      var Init = (image) => {\n        var sprite = new Sprite.Sheet({\n          images: [image],\n          width: this.data.tilewidth,\n          height: this.data.tileheight,\n          animations: this.data.animations\n        });\n\n        //.centerX.centerY把角色中间设定为图片中间\n        sprite.centerX = Math.floor(this.data.tilewidth * 0.5);\n        sprite.centerY = Math.floor(this.data.tileheight * 0.75);\n        sprite.play(\"facedown\");\n        sprite.x = 0;\n        sprite.y = 0;\n        this.sprite = sprite;\n\n        sprite.on(\"change\", () => {\n          this.infoBox.x = this.x;\n          this.infoBox.y = this.y - this.sprite.centerY - 20\n        });\n\n        var completeCount = -1;\n        var Complete = () => {\n          completeCount++;\n          if (completeCount >= 0) {\n            this.calculate();\n            this.refreshBar();\n            this.emit(\"complete\", true);\n          }\n        };\n\n        if (this.data.skills) {\n          this.data.skills.forEach((skillId) => {\n            completeCount--;\n            Game.Skill.load(skillId, () => {\n              Complete();\n            });\n          });\n        }\n\n        if (this.data.equipment) {\n          for (var key in this.data.equipment) {\n            var itemId = this.data.equipment[key];\n            if (itemId) {\n              completeCount--;\n              Game.Item.load(itemId, () => {\n                Complete();\n              });\n            }\n          }\n        }\n\n        if (this.data.items) {\n          for (var itemId in this.data.items) {\n            completeCount--;\n            Game.Item.load(itemId, () => {\n              Complete();\n            });\n          }\n        }\n\n        if (this.data.contact && this.data.contact.trade && this.data.contact.trade.length) {\n          this.data.contact.trade.forEach((itemId) => {\n            completeCount--;\n            Game.Item.load(itemId, () => {\n              Complete();\n            });\n          });\n        }\n\n        Complete();\n      }\n\n      if (this.data.image && this.data.image.width && this.data.image.height) {\n        // img or canvas\n        Init(this.data.image);\n      } else if (typeof this.data.image == \"string\") {\n        var loader = new Sprite.Loader();\n        loader.add(\"/actor/\" + this.data.image);\n        loader.start();\n        loader.on(\"complete\", function (event) {\n          Init(event.data[0]);\n        });\n      } else {\n        console.error(this.id, this.data, this.data.image, this);\n        throw new Error(\"Invalid Actor Image\");\n      }\n    }\n\n    calculate () {\n      if (this.data.$str && this.data.$dex && this.data.$con && this.data.$int && this.data.$cha) {\n\n        this.data.str = this.data.$str;\n        this.data.dex = this.data.$dex;\n        this.data.con = this.data.$con;\n        this.data.int = this.data.$int;\n        this.data.cha = this.data.$cha;\n\n        // 然后可以针对基本属性计算buff\n\n        this.data.$hp = this.data.con * 10;\n        this.data.$sp = this.data.int * 5;\n        this.data.$atk = this.data.str * 1;\n        this.data.$matk = this.data.int * 0.5;\n        this.data.$def = 0;\n        this.data.$mdef = 0;\n\n        this.data.critical = this.data.dex * 0.005;\n        this.data.dodge = this.data.dex * 0.005;\n\n        // 计算完了战斗相关数值\n        this.data.hp = this.data.$hp;\n        this.data.sp = this.data.$sp;\n        this.data.atk = this.data.$atk;\n        this.data.def = this.data.$def;\n        this.data.matk = this.data.$matk;\n        this.data.mdef = this.data.$mdef;\n\n        // 最后可以对战斗相关数值计算buff\n\n        if (this.data.buff && this.data.nerf) {\n          this.data.buff.forEach((element) => {\n\n          });\n          this.data.nerf.forEach((element) => {\n\n          });\n        }\n      }\n    }\n\n    get x () {\n      return this.sprite.x;\n    }\n\n    get y () {\n      return this.sprite.y;\n    }\n\n    set x (value) {\n      this.sprite.x = value;\n      this.data.x = value;\n    }\n\n    set y (value) {\n      this.sprite.y = value;\n      this.data.y = value;\n    }\n\n    clone  (callback) {\n      var actorObj = new Game.Actor(this.data);\n      actorObj.oncomplete(callback);\n    }\n\n    refreshBar () {\n      if (Game.hero && this == Game.hero) {\n        Game.windows.interface.execute(\"status\", (this.data.hp / this.data.$hp), (this.data.sp / this.data.$sp));\n      }\n\n      if (this.hpbar && this.mpbar) {\n        var hpcolor = \"green\";\n        if ((this.data.hp / this.data.$hp) < 0.25)\n          hpcolor = \"red\";\n        else if ((this.data.hp / this.data.$hp) < 0.5)\n          hpcolor = \"yellow\";\n\n        this.hpbar.clear().rect({\n          x: 1,\n          y: 1,\n          width: Math.floor((this.data.hp / this.data.$hp) * 28),\n          height: 2,\n          fill: hpcolor,\n          \"stroke-width\": 0\n        });\n\n        this.mpbar.clear().rect({\n          x: 1,\n          y: 1,\n          width: Math.floor((this.data.sp / this.data.$sp) * 28),\n          height: 2,\n          fill: \"blue\",\n          \"stroke-width\": 0\n        });\n      }\n    }\n\n    contact () {\n      if (this.data.contact) {\n\n        var options = {};\n\n        if (this.data.contact.talk) {\n          options[\"对话\"] = \"talk\";\n        }\n\n        if (this.data.contact.trade) {\n          options[\"交易\"] = \"trade\"\n        }\n\n        Game.choice(options, (choice) => {\n          switch (choice) {\n            case \"talk\":\n              Game.dialogue(this.data.contact.talk, this.data.name);\n              break;\n            case \"trade\":\n              Game.windows.trade.execute(\"trade\", this.data.contact.trade);\n              break;\n          }\n        });\n      }\n    }\n\n    distance () {\n      var x, y;\n      if (arguments.length == 2 && typeof arguments[0] == \"number\" && typeof arguments[1] == \"number\") {\n        x = arguments[0];\n        y = arguments[1];\n      } else if (arguments.length == 1 && typeof arguments[0].x == \"number\" && typeof arguments[0].y == \"number\") {\n        x = arguments[0].x;\n        y = arguments[0].y;\n      } else {\n        console.error(arguments);\n        throw new Error(\"Game.Actor.distance Invalid arguments\");\n      }\n      var d = 0;\n      d += Math.pow(this.x - x, 2);\n      d += Math.pow(this.y - y, 2);\n      d = Math.sqrt(d);\n      return Math.floor(d);\n    }\n\n    decreaseHitpoint (power) {\n      this.data.hp -= power;\n      this.refreshBar();\n      this.dead();\n    }\n\n    decreaseManapoint (mp) {\n      this.data.sp -= mp;\n      this.refreshBar();\n    }\n\n    dead () {\n      if (this.data.hp <= 0) {\n\n        // item0001是物品掉落之后出现的小布袋\n        var dead = Game.items.bag.clone();\n        dead.x = this.x;\n        dead.y = this.y;\n        dead.draw(Game.layers.itemLayer);\n        dead.inner = {\n          \"gold\": 1\n        };\n        Game.area.bags[Sprite.uuid()] = dead;\n\n        this.remove();\n\n        delete Game.area.actors[this.id];\n\n      }\n    }\n\n    flash () {\n      this.sprite.alpha = 0.5;\n      setTimeout(() => {\n        this.sprite.alpha = 1;\n      }, 200);\n    }\n\n    damage (attacker, skill) {\n\n      var power = skill.power;\n      var type = skill.type;\n\n      var color = \"white\";\n      if (this.data.type == \"hero\") {\n        color = \"red\";\n      }\n\n      if (type == \"normal\") {\n        power += attacker.data.atk;\n        power -= this.data.def\n        power = Math.max(0, power);\n      } else { // type == magic\n        power += attacker.data.matk;\n        power - this.data.mdef\n        power = Math.max(0, power);\n      }\n\n      var text = null;\n\n      if (Math.random() < this.data.dodge) { // 闪避了\n        text = new Sprite.Text({\n          text: \"miss\",\n          color: color,\n          fontSize: 16\n        });\n      } else if (Math.random() < attacker.data.critical) { // 重击了\n        power *= 2;\n        text = new Sprite.Text({\n          text: \"-\" + power,\n          color: color,\n          fontSize: 32\n        });\n        this.flash();\n        this.decreaseHitpoint(power);\n      } else { // 普通击中\n        text = new Sprite.Text({\n          text: \"-\" + power,\n          color: color,\n          fontSize: 16\n        });\n        this.flash();\n        this.decreaseHitpoint(power);\n      }\n\n      text.centerX = Math.floor(text.width / 2);\n      text.centerY = Math.floor(text.height);\n      text.x = this.x;\n      text.y = this.y;\n\n      text.x += Sprite.rand(-10, 10);\n\n      Game.layers.actorLayer.appendChild(text);\n\n      var speed = Sprite.rand(0, 3);\n\n      Sprite.Ticker.whiles(100, (last) => {\n        text.y -= speed;\n        if (last) {\n          Game.layers.actorLayer.removeChild(text);\n        }\n      });\n\n    }\n\n    play (animation, priority) {\n      var direction = animation.match(/down|left|right|up/)[0];\n\n      // 新动画默认优先级为0\n      if (typeof priority == \"undefined\")\n        priority = 0;\n\n      // 无动画或者停止状态，现有优先级为-1（最低级）\n      if (typeof this.animationPriority == \"undefined\" || this.sprite.paused == true)\n        this.animationPriority = -1;\n\n      if (this.data.animations.hasOwnProperty(animation)\n      && priority >= this.animationPriority\n      && animation != this.sprite.currentAnimation) {\n        this.animationPriority = priority;\n        this.sprite.play(animation);\n      }\n    }\n\n    stop () {\n      if (!this.sprite.currentAnimation) return;\n\n      if (this.gotoListener) return;\n\n      if ((this.sprite.paused && !this.sprite.currentAnimation.match(/face/))\n        || this.sprite.currentAnimation.match(/walk|run/)) {\n        switch (this.sprite.currentAnimation.match(/up|down|left|right/)[0]) {\n          case \"up\":\n            this.sprite.play(\"faceup\");\n            break;\n          case \"down\":\n            this.sprite.play(\"facedown\");\n            break;\n          case \"left\":\n            this.sprite.play(\"faceleft\");\n            break;\n          case \"right\":\n            this.sprite.play(\"faceright\");\n            break;\n        }\n      }\n    }\n\n    fire (id, direction) {\n      // 同一时间只能施展一个skill\n      if (this.attacking)\n        return 0;\n\n      var skill = Game.skills[id];\n      if (!skill)\n        return 0;\n\n      // 只有当这个skill的cooldown结\n      var now = new Date().getTime();\n      if ( typeof this.lastAttack == \"number\"\n        && typeof this.lastAttackCooldown == \"number\"\n        && (now - this.lastAttack) < this.lastAttackCooldown)\n        return 0;\n\n      if (skill.data.cost > this.data.sp) {\n        return 0;\n      }\n\n      this.lastAttack = now;\n      this.lastAttackCooldown = skill.data.cooldown;\n      this.attacking = true;\n\n      if (!direction) {\n        direction = this.sprite.currentAnimation.match(/up|left|down|right/)[0];\n      }\n\n      this.data.sp -= skill.data.cost;\n      this.refreshBar();\n\n      skill.fire(this, \"attack\" + direction, (hittedActorIds) => {\n        this.attacking = false;\n        if (hittedActorIds && hittedActorIds.length) {\n          hittedActorIds.forEach((element) => {\n            if (Game.area.actors.hasOwnProperty(element)) {\n              Game.area.actors[element].damage(this, skill);\n            }\n          });\n        }\n      });\n\n      return skill.data.cooldown;\n    }\n\n    goto (x, y, state, callback = null) {\n      if (this.going) {\n        return false;\n      }\n\n      var destPosition = Game.area.map.tile(x, y);\n\n      var map = [];\n      var height = Game.area.map.blockedMap.length;\n      var width = Game.area.map.blockedMap[0].length;\n\n      map.length = height;\n      for (let i = 0; i < height; i++) {\n        map[i] = [];\n        map[i].length = width;\n      }\n\n      for (let i = 0; i < height; i++) {\n        for (let j = 0; j < width; j++) {\n          if (this.checkCollision({x: j, y: i})) {\n            map[i][j] = 0;\n          } else {\n            map[i][j] = 1;\n          }\n        }\n      }\n\n      var after = null;\n\n      var path = Game.Astar.path(map,\n        width,\n        height,\n        Game.area.map.tile(this.x, this.y), // 角色现在位置\n        destPosition); // 目的地\n\n      if (!path) {\n        var otherChoice = [\n          {\n            x: destPosition.x,\n            y: destPosition.y - 1,\n            after: \"facedown\"\n          }, {\n            x: destPosition.x,\n            y: destPosition.y + 1,\n            after: \"faceup\"\n          }, {\n            x: destPosition.x - 1,\n            y: destPosition.y,\n            after: \"faceright\"\n          }, {\n            x: destPosition.x + 1,\n            y: destPosition.y,\n            after: \"faceleft\"\n          }\n        ];\n\n        otherChoice.forEach((element) => {\n          var x = element.x * 32 + 16;\n          var y = element.y * 32 + 16;\n          element.distance = this.distance(x, y);\n        });\n\n        otherChoice.sort(function (a, b) {\n          return a.distance - b.distance;\n        });\n\n        otherChoice.forEach((element) => {\n          if (path) {\n            return;\n          }\n          path = Game.Astar.path(map, width, height, Game.area.map.tile(this.x, this.y), element);\n          if (path) {\n            after = element.after;\n          }\n        });\n      }\n\n      if (path && path.length && path.length > 1) {\n        this.going = true;\n        var index = 1;\n        var Walk = () => {\n          if (index < path.length) {\n            var current = Game.area.map.tile(this.x, this.y);\n            var dest = path[index];\n            var direction = null;\n            if (dest.x == current.x) {\n              if (dest.y > current.y) {\n                direction = \"down\";\n              } else if (dest.y < current.y) {\n                direction = \"up\";\n              }\n            } else if (dest.y == current.y) {\n              if (dest.x > current.x) {\n                direction = \"right\"\n              } else if (dest.x < current.x) {\n                direction = \"left\";\n              }\n            }\n\n            if (direction) {\n              var currentDirection = this.sprite.currentAnimation.match(/up|left|down|right/)[0];\n              if (direction != currentDirection) {\n                this.face(direction);\n              }\n              var goResult = this.go(\"walk\", direction, () => Walk());\n              if (goResult != true) {\n                this.going = false;\n              }\n              index++;\n            }\n          } else { // 正常结束\n            if (after) {\n              this.play(after);\n            }\n            this.going = false;\n          }\n        }\n        Walk();\n      } else {\n        // 实在没找到路\n        // console.log(\"noway\");\n      }\n    }\n\n    gotoTT (x, y, state, collisionTest = true, callback = null) {\n\n      if (this.gotoListener) {\n        Sprite.Ticker.off(\"tick\", this.gotoListener);\n        this.gotoListener = null;\n      }\n\n      var limit = 10;\n\n      x -= this.x;\n      y -= this.y;\n\n      var speed = 2;\n      if (state == \"run\")\n        speed = 4;\n\n      this.gotoListener = Sprite.Ticker.on(\"tick\", () => toXY());\n\n      var leftright = \"\";\n      var updown = \"\";\n      if (x > 0) {\n        leftright = \"right\";\n      } else {\n        leftright = \"left\";\n      }\n      if (y > 0) {\n        updown = \"down\";\n      } else {\n        updown = \"up\";\n      }\n      var X = x = Math.abs(x);\n      var Y = y = Math.abs(y);\n\n      var toXY = () => {\n        if (x <= limit && y <= limit) {\n          if (this.gotoListener) {\n            Sprite.Ticker.off(\"tick\", this.gotoListener);\n            this.gotoListener = null;\n            this.stop();\n            if (typeof callback == \"function\") {\n              callback();\n            }\n          }\n          if (X > Y) {\n            this.face(leftright);\n          } else {\n            this.face(updown);\n          }\n          if (callback) callback();\n        } else if (x > limit && y > limit) {\n          if (X > Y) {\n            this.go(state, leftright, collisionTest);\n            x -= speed;\n          } else {\n            this.go(state, updown, collisionTest);\n            y -= speed;\n          }\n          if (x < 0) x = 0;\n          if (y < 0) y = 0;\n        } else if (x > limit) {\n          this.go(state, leftright, collisionTest);\n          x -= speed;\n          if (x < 0) x = 0;\n        } else if (y > limit) {\n          this.go(state, updown, collisionTest);\n          y -= speed;\n          if (y < 0) y = 0;\n        }\n      }\n\n    }\n\n    face (direction) {\n      var animation = \"face\" + direction;\n      if (this.animation != animation) {\n        this.sprite.play(animation);\n      }\n    }\n\n    // 参数t中记录了某个方格的方位xy，测试这个方格是否和玩家有冲突\n    // 返回true为有碰撞，返回false为无碰撞\n    checkCollision (t) {\n      var positionKey = `${t.x}x${t.y}`;\n\n      if (actorHold[positionKey]) {\n        return true;\n      }\n      // 地图边缘碰撞\n      if (t.x < 0 || t.y < 0 || t.x >= Game.area.map.data.width || t.y >= Game.area.map.data.height) {\n        return true;\n      }\n      // 地图碰撞\n      if (Game.area.map.blockedMap[t.y] && Game.area.map.blockedMap[t.y][t.x]) {\n        return true;\n      }\n      // 角色碰撞\n      if (Game.area.actors) {\n        for (let key in Game.area.actors) {\n          var actor = Game.area.actors[key];\n          if (actor != this) {\n            var pos = Game.area.map.tile(actor.x, actor.y);\n            if (pos.x == t.x && pos.y == t.y) {\n              return true;\n            }\n          }\n        }\n      }\n      return false;\n    };\n\n    go (state, direction, callback = null) {\n\n      // 如果正在战斗动画，则不走\n      if (this.sprite.paused == false && this.sprite.currentAnimation.match(/skillcast|thrust|slash|shoot/)) {\n        return false;\n      }\n\n      if (this.walking) {\n        return false;\n      }\n\n      if (this.attacking) {\n        return false;\n      }\n\n      var currentDirection = this.sprite.currentAnimation.match(/up|left|down|right/)[0];\n      if (currentDirection != direction) {\n        this.walking = true;\n        this.face(direction);\n        // wait 8 ticks\n        Sprite.Ticker.after(4, () => {\n          this.walking = false;\n        });\n        return false;\n      }\n\n      var t = Game.area.map.tile(this.x, this.y);\n\n      var oldPositionKey = `${t.x}x${t.y}`;\n\n      switch (direction) {\n        case \"up\":\n          t.y -= 1;\n          break;\n        case \"down\":\n          t.y += 1;\n          break;\n        case \"left\":\n          t.x -= 1;\n          break;\n        case \"right\":\n          t.x += 1;\n          break;\n      }\n\n      var newPositionKey = `${t.x}x${t.y}`;\n\n      var result = this.checkCollision(t);\n\n      if (result == false) {\n        this.walking = true;\n        actorHold[newPositionKey] = true;\n        actorHold[oldPositionKey] = true;\n\n        var speed = 2;\n        if (state == \"run\") {\n          speed = 4;\n        }\n        var times = 32 / speed;\n        var count = 0;\n        var id = null;\n\n        Sprite.Ticker.whiles(times, (last) => {\n          switch (direction) {\n            case \"up\":\n              this.y -= speed;\n              break;\n            case \"down\":\n              this.y += speed;\n              break;\n            case \"left\":\n              this.x -= speed;\n              break;\n            case \"right\":\n              this.x += speed;\n              break;\n          }\n\n          if (last) {\n            delete actorHold[newPositionKey];\n            delete actorHold[oldPositionKey];\n            this.walking = false;\n\n            if (typeof callback == \"function\") {\n              callback();\n            }\n\n          }\n        });\n\n        this.play(state + direction, 1);\n        return true;\n      }\n\n      this.play(\"face\" + direction, 0);\n\n      return false;\n    }\n\n    remove () {\n      Game.layers.actorLayer.removeChild(this.sprite);\n      Game.layers.infoLayer.removeChild(this.infoBox);\n    }\n\n    draw () {\n      var x = this.data.x;\n      var y = this.data.y;\n\n      if (typeof x != \"number\" || typeof y != \"number\") {\n        console.log(this, this.data, this.data.x, this.data.y);\n        throw new Error(\"Game.Actor.draw Invalid position x,y\");\n      }\n\n      this.infoBox.x = x;\n      this.infoBox.y = y - this.sprite.centerY - 20;\n\n      this.x = x;\n      this.y = y;\n\n      Game.layers.actorLayer.appendChild(this.sprite);\n      Game.layers.infoLayer.appendChild(this.infoBox);\n    }\n\n    focus () {\n      this.infoBox.x = this.x;\n      this.infoBox.y = this.y - this.sprite.centerY - 20\n\n      Game.stage.centerX = Math.round(this.x - Game.config.width / 2);\n      Game.stage.centerY = Math.round(this.y - Game.config.height / 2);\n    }\n\n  } // Game.Actor\n\n})();\n"]}