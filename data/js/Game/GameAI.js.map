{"version":3,"sources":["src/Game/GameAI.js"],"names":[],"mappings":"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","file":"src/Game/GameAI.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function (Game) {\n  \"use strict\";\n\n  Game.AI = class AI {\n\n    static hint () {\n      if (Game.hero) {\n\n        var heroPosition = Game.hero.position;\n        var heroFace = Game.hero.facePosition;\n\n        var hint = null;\n\n        function FindUnderHero (element) {\n          if (hint != null || element == Game.hero) {\n            return;\n          }\n          if (element.hitTest && element.hitTest(heroPosition.x, heroPosition.y)) {\n            hint = element;\n          } else if (element.x == heroPosition.x && element.y == heroPosition.y) {\n            hint = element;\n          }\n        }\n\n        function FindFaceHero (element) {\n          if (hint != null || element == Game.hero) {\n            return;\n          }\n          if (element.hitTest && element.hitTest(heroFace.x, heroFace.y)) {\n            hint = element;\n          } else if (element.x == heroFace.x && element.y == heroFace.y) {\n            hint = element;\n          }\n        }\n\n        // 找最近可“事件”人物 Game.area.actors\n        Sprite.each(Game.area.touch, FindUnderHero);\n\n        // 找最近可“事件”人物 Game.area.actors\n        Sprite.each(Game.area.actors, FindUnderHero);\n        // 找最近尸体 Game.area.actors\n        Sprite.each(Game.area.bags, FindUnderHero);\n        // 最近的门\n        Game.area.doors.forEach(FindUnderHero);\n        // 最近的箱子\n        Game.area.chests.forEach(FindUnderHero);\n        // 最近的提示物（例如牌子）\n        Game.area.hints.forEach(FindUnderHero);\n\n\n        // 找最近可“事件”人物 Game.area.actors\n        Sprite.each(Game.area.actors, FindFaceHero);\n        // 找最近尸体 Game.area.actors\n        Sprite.each(Game.area.bags, FindFaceHero);\n        // 最近的门\n        Game.area.doors.forEach(FindFaceHero);\n        // 最近的箱子\n        Game.area.chests.forEach(FindFaceHero);\n        // 最近的提示物（例如牌子）\n        Game.area.hints.forEach(FindFaceHero);\n\n\n        if (Game.hintObject && Game.hintObject != hint) {\n          Game.hintObject = null;\n          Game.windows.interface.use.style.visibility = \"hidden\";\n        }\n\n        if (hint != null) {\n          Game.hintObject = hint;\n          Game.windows.interface.use.style.visibility = \"visible\";\n          if (hint.type == \"door\") {\n            Game.popup({x: hint.x*32+16, y: hint.y*32+16}, hint.description, 0, -30);\n          } else if (hint.type == \"touch\") {\n            if (hint.showmap) {\n              Game.layers.mapLayer.children.forEach(function (element) {\n                if (hint.showmap.indexOf(element.name) != -1) {\n                  if (element.visible == false) {\n                    element.visible = true;\n                    element.alpha = 0.01;\n                    Sprite.Tween.get(element).to({alpha: 1}, 200);\n                  }\n                }\n              });\n            } // showmap\n            if (hint.hidemap) {\n              Game.layers.mapLayer.children.forEach(function (element) {\n                if (hint.hidemap.indexOf(element.name) != -1) {\n                  if (element.alpha == 1) {\n                    element.visible = true;\n                    element.alpha = 0.99;\n                    Sprite.Tween.get(element).to({alpha: 0}, 200).call(function () {\n                      element.visible = false;\n                    });\n                  }\n                }\n              });\n            } // hidemap\n            if (hint.showactor) {\n              for (let actor of Game.area.actors) {\n                if (hint.showactor.indexOf(actor.id) != -1) {\n                  if (actor.visible == false) {\n                    actor.visible = true;\n                    actor.alpha = 0.01;\n                    Sprite.Tween.get(actor).to({alpha: 1}, 300);\n                  }\n                }\n              }\n            } // showactor\n            if (hint.hideactor) {\n              for (let actor of Game.area.actors) {\n                if (hint.hideactor.indexOf(actor.id) != -1) {\n                  if (actor.alpha == 1) {\n                    actor.visible = true;\n                    actor.alpha = 0.99;\n                    Sprite.Tween.get(actor).to({alpha: 0}, 100).call(function () {\n                      actor.visible = false;\n                    });\n                  }\n                }\n              }\n            } // hideactor\n          } // touch\n        }\n      }\n    }\n\n    static actor () {\n      if (Game.area && Game.area.actors) {\n        for (let actor of Game.area.actors) {\n\n          if (actor.data.type == \"hero\") {\n            var barChanged = false;\n\n            if (actor.data.hp < actor.data.$hp) {\n              actor.data.hp++;\n              barChanged = true;\n            }\n\n            if (actor.data.sp < actor.data.$sp) {\n              actor.data.sp++;\n              barChanged = true;\n            }\n\n            if (barChanged) {\n              actor.refreshBar();\n            }\n          } else if (actor.data.type == \"monster\") {\n\n            var barChanged = false;\n\n            if (actor.data.hp < actor.data.$hp) {\n              actor.data.hp++;\n              barChanged = true;\n            }\n\n            if (actor.data.sp < actor.data.$sp) {\n              actor.data.sp++;\n              barChanged = true;\n            }\n\n            if (barChanged) {\n              actor.refreshBar();\n            }\n\n            if (Game.hero && actor.facePosition.x == Game.hero.x && actor.facePosition.y == Game.hero.y) {\n              if (actor.y == Game.hero.y) { // left or right\n                if (actor.x < Game.hero.x) { // left\n                  actor.fire(\"sword01\", \"right\");\n                } else { // right\n                  actor.fire(\"sword01\", \"left\");\n                }\n              } else { // up or down\n                if (actor.y < Game.hero.y) { // up\n                  actor.fire(\"sword01\", \"down\");\n                } else { // down\n                  actor.fire(\"sword01\", \"up\");\n                }\n              }\n            } else if (Game.hero && Game.hero.distance(actor) < 10) {\n              actor.goto(Game.hero.x, Game.hero.y, \"walk\");\n            } else if (actor.data.mode == \"patrol\") {\n              if (Math.random() < 0.01) {\n                return;\n              }\n              var x = actor.x;\n              var y = actor.y;\n              actor.goto(x + Sprite.rand(-5, 5), y + Sprite.rand(-5, 5), \"walk\", function () {\n                actor.stop();\n              });\n            }\n          }\n        };\n      }\n    }\n\n    static start () {\n      setInterval(function () {\n        Game.AI.actor();\n      }, 50);\n\n      var skip = 0;\n      Sprite.Ticker.on(\"tick\", function () {\n        if (Game.area && Game.area.actors && Game.area.bags) {\n          skip++;\n          if (skip % 5 == 0)\n            Game.AI.hint();\n        }\n      });\n    }\n\n  };\n})(Game);\n"]}