{"version":3,"sources":["src/Game/GameWindowPickup.js"],"names":[],"mappings":"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","file":"src/Game/GameWindowPickup.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  let win = Game.Window.create(\"pickup\");\n\n  win.html = `\n    <div class=\"window-box\">\n      <button id=\"pickupWindowClose\" class=\"brownButton\">关闭</button>\n      <button id=\"pickupWindowAll\" class=\"brownButton\">全部(a)</button>\n      <table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n        <thead>\n          <tr>\n            <td style=\"width: 40px;\"></td>\n            <td style=\"width: 120px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td></td>\n            <td style=\"width: 60px;\"></td>\n          </tr>\n        </thead>\n        <tbody id=\"pickupWindowTable\"></tbody>\n      </table>\n    </div>\n  `;\n\n  win.css = `\n    #pickupWindow table {\n      width: 100%;\n    }\n\n    #pickupWindow table img {\n      width: 100%;\n      height: 100%;\n    }\n\n    #pickupWindow button {\n      width: 60px;\n      height: 40px;\n      font-size: 16;\n    }\n\n    #pickupWindowClose {\n\n    }\n\n    #pickupWindowAll {\n\n    }\n  `;\n\n  var pickupWindowClose = document.querySelector(\"button#pickupWindowClose\");\n  var pickupWindowAll = document.querySelector(\"button#pickupWindowAll\");\n\n  pickupWindowClose.addEventListener(\"click\", function (event) {\n    Game.windows.pickup.hide();\n  });\n\n  var currentItemObj = null;\n\n  pickupWindowAll.addEventListener(\"click\", function (event) {\n    var itemObj = currentItemObj;\n    if (itemObj && itemObj.inner && Object.keys(itemObj.inner).length > 0) {\n      Sprite.each(itemObj.inner, function (itemCount, itemId, inner) {\n        if (Game.hero.data.items[itemId]) {\n          Game.hero.data.items[itemId] += itemCount;\n        } else {\n          Game.hero.data.items[itemId] = itemCount;\n        }\n        delete inner[itemId];\n      });\n      Game.windows.pickup.execute(\"pickup\", itemObj);\n    }\n  });\n\n  Sprite.Input.whenUp([\"a\", \"A\"], function (key) {\n    if (Game.windows.pickup.showing) {\n      pickupWindowAll.click();\n    }\n  });\n\n  Sprite.Input.whenUp([\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"], function (key) {\n    if (Game.windows.pickup.showing) {\n      var index = parseInt(key) - 1;\n      var button = document.querySelector(`button#pickupWindowGet-${index}`);\n      if (button) {\n        button.click();\n      }\n    }\n  });\n\n  win.register(\"pickup\", function (itemObj) {\n    if (!itemObj.inner || Object.keys(itemObj.inner).length <= 0) {\n      for (let key in Game.area.bags) {\n        if (Game.area.bags[key] == itemObj) {\n          delete Game.area.bags[key];\n          itemObj.erase(Game.layers.itemLayer);\n        }\n      }\n      Game.windows.pickup.hide();\n      return;\n    }\n\n    currentItemObj = itemObj;\n\n    var tableBody = document.getElementById(\"pickupWindowTable\");\n    while (tableBody.hasChildNodes()) {\n      tableBody.removeChild(tableBody.lastChild);\n    }\n\n    var index = 0;\n\n    Sprite.each(itemObj.inner, function (itemCount, itemId, inner) {\n      var item = Game.items[itemId];\n\n      var line = document.createElement(\"tr\");\n\n      var icon = document.createElement(\"td\");\n      line.appendChild(icon);\n\n      var name = document.createElement(\"td\");\n      line.appendChild(name);\n\n      var count = document.createElement(\"td\");\n      count.style.textAlign = \"center\";\n      line.appendChild(count);\n\n      var description = document.createElement(\"td\");\n      line.appendChild(description);\n\n      var pickup = document.createElement(\"td\");\n      line.appendChild(pickup);\n\n      icon.appendChild(item.icon);\n      name.textContent = item.data.name;\n      count.textContent = itemCount;\n      description.textContent = item.data.description;\n\n      var pickupButton = document.createElement(\"button\");\n\n      if (index < 9) {\n        pickupButton.textContent = `${index+1}捡取`;\n      } else {\n        pickupButton.textContent = \"捡取\";\n      }\n      pickupButton.id = `pickupWindowGet-${index}`;\n      index++;\n\n      pickupButton.classList.add(\"brownButton\");\n\n      pickupButton.addEventListener(\"click\", function () {\n        if(itemId == \"gold\") {\n          Game.hero.data.gold += itemCount;\n        } else {\n          if (Game.hero.data.items[itemId]) {\n            Game.hero.data.items[itemId] += itemCount;\n          } else {\n            Game.hero.data.items[itemId] = itemCount;\n          }\n        }\n\n        delete inner[itemId];\n        Game.windows.pickup.execute(\"pickup\", itemObj);\n      });\n      pickup.appendChild(pickupButton);\n\n      tableBody.appendChild(line);\n    });\n\n    Game.windows.pickup.show();\n  });\n\n}());\n"]}