{"version":3,"sources":["src/Game/GameAstar.js"],"names":[],"mappings":"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","file":"src/Game/GameAstar.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function (Game) {\n  \"use strict\";\n\n  Game.Astar = class Astar {\n    static path (map, width, height, start, end) {\n      return astar(map, width, height, start, end);\n    }\n  };\n\n  function astar(map, width, height, start, end) {\n    // 用一个点结构的x和y值返回一个字符串的key\n    // 例如{x: 9, y: 8}返回\"9-8\"\n    var tag = function (point) {\n      return point.x.toString() + \"-\" + point.y.toString();\n    };\n    // 计算点结构a和b之间的曼哈顿距离，即不带斜走的直线距离\n    var manhattan = function (a, b) {\n      return Math.abs(a.x - b.x) + Math.abs(a.y - b.y);\n    };\n    // 粗略验证一个点是否可用，是否超出边界，地图上是否是墙\n    var valid = function (x, y) {\n      if (x < 0 || y < 0 || x >= width || y >= height)\n        return false;\n      if (map[y][x])\n        return true;\n      return false;\n    };\n    // 通过坐标x，y，当前最好的节点best和一个附加值（直线10，斜线14），返回一个新节点\n    var make = function (x, y, best, addition, direction) {\n      var t = {\n        x: x,\n        y: y,\n        g: best.g + addition\n      };\n      t.key = tag(t);\n      t.h = manhattan(t, end);\n      t.f = t.g + t.h;\n      t.front = best.front.slice();\n      t.front.push(best.key);\n      return t;\n    };\n\n    // 开启列表和关闭列表\n    var open = {};\n    var close = {};\n\n    //构建起始节点\n    open[tag(start)] = {\n      x: start.x,\n      y: start.y,\n      key: tag(start),\n      f: 0,\n      g: 0,\n      h: manhattan(start, end),\n      front: []\n    };\n\n    while (Object.keys(open).length) {\n      // 找到F值最小的节点\n      var best = null;\n      for (let key in open) {\n        if (best == null || open[key].f < best.f) {\n          best = open[key];\n        }\n      }\n      // 从开启列表中删除，加入关闭列表\n      delete open[best.key];\n      close[best.key] = best;\n\n      // 如果这个最好的节点就是结尾节点，则返回\n      if (best.x == end.x && best.y == end.y) {\n        best.front.push(tag(end));\n        var result = [];\n        for (let i = 0; i < best.front.length; i++) {\n          var m = best.front[i].match(/(\\d+)-(\\d+)/);\n          if (m) {\n            result.push({\n              x: parseInt(m[1]),\n              y: parseInt(m[2])\n            });\n          }\n        }\n        return result;\n      }\n\n      // 记录上下左右，和四个斜方向的可能值\n      var possible = [];\n\n      if (valid(best.x, best.y - 1)) { // 验证up\n        possible.push(make(best.x, best.y - 1, best, 10));\n      }\n      if (valid(best.x, best.y + 1)) { // 验证down\n        possible.push(make(best.x, best.y + 1, best, 10));\n      }\n      if (valid(best.x - 1, best.y)) { // 验证left\n        possible.push(make(best.x - 1, best.y, best, 10));\n      }\n      if (valid(best.x + 1, best.y)) { // 验证right\n        possible.push(make(best.x + 1, best.y, best, 10));\n      }\n\n      // 去除已经在开启列表和关闭列表中的\n      possible.forEach(function (element) {\n        var t = tag(element);\n        if (open[t]) return;\n        if (close[t]) return;\n        open[t] = element;\n      });\n\n    } // while\n\n    return null;\n  }\n\n})(Game);\n"]}