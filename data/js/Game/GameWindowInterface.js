"use strict";

/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

(function () {
  "use strict";

  var win = Game.windows.interface = Game.Window.create("interfaceWindow");

  win.html = "\n    <div id=\"interfaceWindowBar\"></div>\n\n    <div style=\"position: absolute; bottom: 10px; left: 20px; width: 100px; height: 60px;\">\n      <div style=\"width: 100px; height: 20px; margin: 5px 0; border: 1px solid gray; background-color: white;\">\n        <div id=\"interfaceWindowHP\" style=\"width: 100%; height: 100%; background-color: green;\"></div>\n      </div>\n      <div style=\"width: 100px; height: 20px; margin: 5px 0; border: 1px solid gray; background-color: white;\">\n        <div id=\"interfaceWindowSP\" style=\"width: 100%; height: 100%; background-color: blue;\"></div>\n      </div>\n    </div>\n\n    <span id=\"interfaceWindowDatetime\"></span>\n    <span id=\"interfaceWindowMap\"></span>\n\n    <button id=\"interfaceWindowUse\" class=\"interfaceWindowButton\"></button>\n    <button id=\"interfaceWindowMenu\" class=\"interfaceWindowButton\"></button>\n  ";

  win.css = "\n\n    #interfaceWindowBar {\n      text-align: center;\n      position: absolute;\n      bottom: 10px;\n      width: 100%;\n      height: 60px;\n    }\n\n    .interfaceWindow {\n      /** 让interface窗口的主要窗口，不接受事件 */\n      pointer-events: none;\n    }\n\n    button.interfaceWindowButton {\n      margin-left: 3px;\n      margin-right: 3px;\n      width: 60px;\n      height: 60px;\n      border: 4px solid gray;\n      border-radius: 10px;\n      background-color: rgba(100, 100, 100, 0.5);\n      display: inline-block;\n      /** 让interface窗口的按钮，接受事件 */\n      pointer-events: auto;\n      background-repeat: no-repeat;\n      background-size: cover;\n    }\n\n    button.interfaceWindowButton:hover {\n      opacity: 0.5;\n    }\n\n    button.interfaceWindowButton > img {\n      width: 100%;\n      height: 100%;\n    }\n\n    #interfaceWindowMap {\n      position: absolute;\n      top: 35px;\n      left: 5px;\n      background-color: rgba(100, 100, 100, 0.7);\n      padding: 2px;\n    }\n\n    #interfaceWindowDatetime {\n      position: absolute;\n      top: 10px;\n      left: 5px;\n      background-color: rgba(100, 100, 100, 0.7);\n      padding: 2px;\n    }\n\n    button#interfaceWindowUse {\n      position: absolute;\n      top: 5px;\n      right: 85px;\n      visibility: hidden;\n      background-image: url(\"image/hint.png\");\n    }\n\n    button#interfaceWindowMenu {\n      position: absolute;\n      top: 5px;\n      right: 5px;\n      background-image: url(\"image/setting.png\");\n    }\n\n    interfaceWindowButton:disabled {\n      cursor: default;\n      pointer-events: none;\n      background-color: gray;\n      opacity: 0.5;\n    }\n\n    .interfaceWindowButtonText {\n      position: absolute;\n      background-color: white;\n      margin-left: -26px;\n      margin-top: 12px;\n    }\n  ";

  // 使用按钮
  var interfaceWindowUse = win.querySelector("button#interfaceWindowUse");
  // 技能栏按钮组
  var interfaceWindowBar = win.querySelector("div#interfaceWindowBar");
  // 地图信息
  var interfaceWindowMap = win.querySelector("#interfaceWindowMap");
  // 选项菜单
  var interfaceWindowMenu = win.querySelector("button#interfaceWindowMenu");
  // 玩家的hp
  var interfaceWindowHP = win.querySelector("#interfaceWindowHP");
  // 玩家的sp
  var interfaceWindowSP = win.querySelector("#interfaceWindowSP");

  win.assign("hideUse", function () {
    interfaceWindowUse.style.visibility = "hidden";
  });

  win.assign("showUse", function () {
    interfaceWindowUse.style.visibility = "visible";
  });

  win.on("active", function () {
    Game.start();
  });

  win.on("deactive", function () {
    Game.pause();
  });

  win.whenUp(["esc"], function (key) {
    if (Game.windows.interface.atop) {
      setTimeout(function () {
        interfaceWindowMenu.click();
      }, 20);
    }
  });

  function InitInterfaceBar() {
    var buttonCount = 8;
    var buttonHTML = "";
    for (var i = 0; i < buttonCount; i++) {
      var line = "";
      line += "<button data-index=\"" + i + "\" class=\"interfaceWindowButton\">";
      line += "<label data-index=\"" + i + "\" class=\"interfaceWindowButtonText\"></label>";
      line += "</button>\n";
      buttonHTML += line;
    }
    interfaceWindowBar.innerHTML = buttonHTML;
  }

  setInterval(function () {
    if (Game.hero && Game.paused == false) {
      Game.hero.data.time++;
      Game.windows.interface.datetime();
    }
  }, 1000);

  InitInterfaceBar();
  var buttons = win.querySelectorAll(".interfaceWindowButton");
  var buttonTexts = win.querySelectorAll(".interfaceWindowButtonText");

  interfaceWindowBar.addEventListener("click", function (event) {
    var index = event.target.getAttribute("data-index");
    if (index) {
      var element = Game.hero.data.bar[index];
      if (element) {
        if (element.type == "skill") {
          var cooldown = Game.hero.fire(element.id);
          if (cooldown) {
            event.target.disabled = true;
            setTimeout(function () {
              event.target.disabled = false;
            }, cooldown);
          }
        } else if (element.type == "item") {
          var itemId = element.id;
          var item = Game.items[itemId];
          item.heroUse();
          Game.windows.interface.refresh();
        }
      }
    }
  });

  win.whenUp(["1", "2", "3", "4", "5", "6", "7", "8"], function (key) {
    var num = parseInt(key);
    if (Number.isInteger(num) && num >= 0 && num < buttons.length) {
      buttons[num - 1].click();
    }
  });

  win.whenUp(["e", "E", "space", "enter"], function (key) {
    if (Game.windows.interface.showing) {
      if (Game.hintObject && Game.hintObject.heroUse) {
        Game.hintObject.heroUse();
      }
    }
  });

  interfaceWindowUse.addEventListener("click", function (event) {
    if (Game.hintObject && Game.hintObject.heroUse) {
      Game.hintObject.heroUse();
    }
  });

  win.assign("status", function () {
    if (Game.hero) {
      var hp = Game.hero.data.hp / Game.hero.data.$hp;
      var sp = Game.hero.data.sp / Game.hero.data.$sp;
      interfaceWindowHP.style.width = hp * 100 + "%";
      interfaceWindowSP.style.width = sp * 100 + "%";
      if (hp >= 0.5) {
        interfaceWindowHP.style.backgroundColor = "green";
      } else if (hp >= 0.25) {
        interfaceWindowHP.style.backgroundColor = "yellow";
      } else {
        interfaceWindowHP.style.backgroundColor = "red";
      }
    }
  });

  win.assign("datetime", function () {
    if (Game.hero && Game.hero.data && Number.isInteger(Game.hero.data.time)) {
      var YEARMIN = 60 * 24 * 30 * 12;
      var MONTHMIN = 60 * 24 * 30;
      var DAYMIN = 60 * 24;
      var HOURMIN = 60;
      var datetime = win.querySelector("#interfaceWindowDatetime");
      var time = Game.hero.data.time;
      var year = Math.floor(time / YEARMIN);
      time = time % YEARMIN;
      var month = Math.floor(time / MONTHMIN);
      time = time % MONTHMIN;
      var day = Math.floor(time / DAYMIN);
      time = time % DAYMIN;
      var hour = Math.floor(time / HOURMIN);
      time = time % HOURMIN;
      var minute = time;
      year++;
      month++;
      day++;
      hour = hour.toString();
      while (hour.length < 2) {
        hour = "0" + hour;
      }minute = minute.toString();
      while (minute.length < 2) {
        minute = "0" + minute;
      }datetime.textContent = month + "月" + day + "日 " + hour + ":" + minute;

      var type = Game.area.map.data.type;

      if (type == "indoor") {
        // do nothing
        Game.stage.filter("brightness", 0.0);
      } else if (type == "outdoor") {
        // 室外
        if (hour >= 20 || hour < 4) {
          // 20:00 to 4:00
          Game.stage.filter("brightness", -0.15);
        } else if (hour >= 4 && hour < 6) {
          Game.stage.filter("brightness", -0.1);
        } else if (hour >= 6 && hour < 8) {
          Game.stage.filter("brightness", -0.05);
        } else if (hour >= 8 && hour < 10) {
          Game.stage.filter("brightness", 0.0);
        } else if (hour >= 10 && hour < 12) {
          Game.stage.filter("brightness", 0.05);
        } else if (hour >= 12 && hour < 14) {
          Game.stage.filter("brightness", 0.0);
        } else if (hour >= 14 && hour < 16) {
          Game.stage.filter("brightness", 0.0);
        } else if (hour >= 16 && hour < 18) {
          Game.stage.filter("brightness", -0.05);
        } else if (hour >= 18 && hour < 20) {
          Game.stage.filter("brightness", -0.1);
        }
      } else if (type == "cave") {
        // caves are dark
        Game.stage.filter("brightness", -0.15);
      }
    }
  });

  win.assign("refresh", function () {
    for (var i = 0; i < 8; i++) {
      var element = Game.hero.data.bar[i];
      var button = buttons[i];
      var text = buttonTexts[i];
      button.disabled = false;
      text.disabled = false;

      if (element) {
        var id = element.id;
        var type = element.type;
        if (type == "skill") {
          var skill = Game.skills[id];
          button.style.backgroundImage = "url(\"" + skill.icon.src + "\")";
          text.textContent = skill.data.cost;
        } else if (type == "item") {
          var item = Game.items[id];
          button.style.backgroundImage = "url(\"" + item.icon.src + "\")";
          if (Game.hero.data.items[id]) {
            text.textContent = Game.hero.data.items[id];
          } else {
            text.textContent = "0";
            button.disabled = true;
            text.disabled = true;
          }
        }
      } else {
        // empty bar element
        text.textContent = "";
        button.style.backgroundImage = "";
      }
    }

    interfaceWindowMap.textContent = Game.area.map.data.name;
  });

  interfaceWindowMenu.addEventListener("click", function (event) {
    Game.windows.sysmenu.show();
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dJbnRlcmZhY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQzs7QUFFekUsS0FBRyxDQUFDLElBQUksZzRCQWlCUCxDQUFDOztBQUVGLEtBQUcsQ0FBQyxHQUFHLHF5REFtRk47OztBQUFDLEFBR0YsTUFBSSxrQkFBa0IsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLDJCQUEyQixDQUFDOztBQUFDLEFBRXhFLE1BQUksa0JBQWtCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyx3QkFBd0IsQ0FBQzs7QUFBQyxBQUVyRSxNQUFJLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMscUJBQXFCLENBQUM7O0FBQUMsQUFFbEUsTUFBSSxtQkFBbUIsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLDRCQUE0QixDQUFDOztBQUFDLEFBRTFFLE1BQUksaUJBQWlCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxvQkFBb0IsQ0FBQzs7QUFBQyxBQUVoRSxNQUFJLGlCQUFpQixHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsb0JBQW9CLENBQUMsQ0FBQzs7QUFFaEUsS0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsWUFBWTtBQUNoQyxzQkFBa0IsQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHLFFBQVEsQ0FBQztHQUNoRCxDQUFDLENBQUM7O0FBRUgsS0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsWUFBWTtBQUNoQyxzQkFBa0IsQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQztHQUNqRCxDQUFDLENBQUM7O0FBRUgsS0FBRyxD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Q25DO0tBQ0Y7O0FBRUQsc0JBQWtCLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7R0FDMUQsQ0FBQyxDQUFDOztBQUVILHFCQUFtQixDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUssRUFBRTtBQUM3RCxRQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztHQUM3QixDQUFDLENBQUM7Q0FHSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93SW50ZXJmYWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IHdpbiA9IEdhbWUud2luZG93cy5pbnRlcmZhY2UgPSBHYW1lLldpbmRvdy5jcmVhdGUoXCJpbnRlcmZhY2VXaW5kb3dcIik7XG5cbiAgd2luLmh0bWwgPSBgXG4gICAgPGRpdiBpZD1cImludGVyZmFjZVdpbmRvd0JhclwiPjwvZGl2PlxuXG4gICAgPGRpdiBzdHlsZT1cInBvc2l0aW9uOiBhYnNvbHV0ZTsgYm90dG9tOiAxMHB4OyBsZWZ0OiAyMHB4OyB3aWR0aDogMTAwcHg7IGhlaWdodDogNjBweDtcIj5cbiAgICAgIDxkaXYgc3R5bGU9XCJ3aWR0aDogMTAwcHg7IGhlaWdodDogMjBweDsgbWFyZ2luOiA1cHggMDsgYm9yZGVyOiAxcHggc29saWQgZ3JheTsgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XCI+XG4gICAgICAgIDxkaXYgaWQ9XCJpbnRlcmZhY2VXaW5kb3dIUFwiIHN0eWxlPVwid2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgYmFja2dyb3VuZC1jb2xvcjogZ3JlZW47XCI+PC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgc3R5bGU9XCJ3aWR0aDogMTAwcHg7IGhlaWdodDogMjBweDsgbWFyZ2luOiA1cHggMDsgYm9yZGVyOiAxcHggc29saWQgZ3JheTsgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XCI+XG4gICAgICAgIDxkaXYgaWQ9XCJpbnRlcmZhY2VXaW5kb3dTUFwiIHN0eWxlPVwid2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgYmFja2dyb3VuZC1jb2xvcjogYmx1ZTtcIj48L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuXG4gICAgPHNwYW4gaWQ9XCJpbnRlcmZhY2VXaW5kb3dEYXRldGltZVwiPjwvc3Bhbj5cbiAgICA8c3BhbiBpZD1cImludGVyZmFjZVdpbmRvd01hcFwiPjwvc3Bhbj5cblxuICAgIDxidXR0b24gaWQ9XCJpbnRlcmZhY2VXaW5kb3dVc2VcIiBjbGFzcz1cImludGVyZmFjZVdpbmRvd0J1dHRvblwiPjwvYnV0dG9uPlxuICAgIDxidXR0b24gaWQ9XCJpbnRlcmZhY2VXaW5kb3dNZW51XCIgY2xhc3M9XCJpbnRlcmZhY2VXaW5kb3dCdXR0b25cIj48L2J1dHRvbj5cbiAgYDtcblxuICB3aW4uY3NzID0gYFxuXG4gICAgI2ludGVyZmFjZVdpbmRvd0JhciB7XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICBib3R0b206IDEwcHg7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogNjBweDtcbiAgICB9XG5cbiAgICAuaW50ZXJmYWNlV2luZG93IHtcbiAgICAgIC8qKiDorqlpbnRlcmZhY2Xnqpflj6PnmoTkuLvopoHnqpflj6PvvIzkuI3mjqXlj5fkuovku7YgKi9cbiAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lO1xuICAgIH1cblxuICAgIGJ1dHRvbi5pbnRlcmZhY2VXaW5kb3dCdXR0b24ge1xuICAgICAgbWFyZ2luLWxlZnQ6IDNweDtcbiAgICAgIG1hcmdpbi1yaWdodDogM3B4O1xuICAgICAgd2lkdGg6IDYwcHg7XG4gICAgICBoZWlnaHQ6IDYwcHg7XG4gICAgICBib3JkZXI6IDRweCBzb2xpZCBncmF5O1xuICAgICAgYm9yZGVyLXJhZGl1czogMTBweDtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMTAwLCAxMDAsIDEwMCwgMC41KTtcbiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICAgIC8qKiDorqlpbnRlcmZhY2Xnqpflj6PnmoTmjInpkq7vvIzmjqXlj5fkuovku7YgKi9cbiAgICAgIHBvaW50ZXItZXZlbnRzOiBhdXRvO1xuICAgICAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDtcbiAgICAgIGJhY2tncm91bmQtc2l6ZTogY292ZXI7XG4gICAgfVxuXG4gICAgYnV0dG9uLmludGVyZmFjZVdpbmRvd0J1dHRvbjpob3ZlciB7XG4gICAgICBvcGFjaXR5OiAwLjU7XG4gICAgfVxuXG4gICAgYnV0dG9uLmludGVyZmFjZVdpbmRvd0J1dHRvbiA+IGltZyB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGhlaWdodDogMTAwJTtcbiAgICB9XG5cbiAgICAjaW50ZXJmYWNlV2luZG93TWFwIHtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIHRvcDogMzVweDtcbiAgICAgIGxlZnQ6IDVweDtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMTAwLCAxMDAsIDEwMCwgMC43KTtcbiAgICAgIHBhZGRpbmc6IDJweDtcbiAgICB9XG5cbiAgICAjaW50ZXJmYWNlV2luZG93RGF0ZXRpbWUge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgdG9wOiAxMHB4O1xuICAgICAgbGVmdDogNXB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgxMDAsIDEwMCwgMTAwLCAwLjcpO1xuICAgICAgcGFkZGluZzogMnB4O1xuICAgIH1cblxuICAgIGJ1dHRvbiNpbnRlcmZhY2VXaW5kb3dVc2Uge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgdG9wOiA1cHg7XG4gICAgICByaWdodDogODVweDtcbiAgICAgIHZpc2liaWxpdHk6IGhpZGRlbjtcbiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChcImltYWdlL2hpbnQucG5nXCIpO1xuICAgIH1cblxuICAgIGJ1dHRvbiNpbnRlcmZhY2VXaW5kb3dNZW51IHtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIHRvcDogNXB4O1xuICAgICAgcmlnaHQ6IDVweDtcbiAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybChcImltYWdlL3NldHRpbmcucG5nXCIpO1xuICAgIH1cblxuICAgIGludGVyZmFjZVdpbmRvd0J1dHRvbjpkaXNhYmxlZCB7XG4gICAgICBjdXJzb3I6IGRlZmF1bHQ7XG4gICAgICBwb2ludGVyLWV2ZW50czogbm9uZTtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IGdyYXk7XG4gICAgICBvcGFjaXR5OiAwLjU7XG4gICAgfVxuXG4gICAgLmludGVyZmFjZVdpbmRvd0J1dHRvblRleHQge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XG4gICAgICBtYXJnaW4tbGVmdDogLTI2cHg7XG4gICAgICBtYXJnaW4tdG9wOiAxMnB4O1xuICAgIH1cbiAgYDtcblxuICAvLyDkvb/nlKjmjInpkq5cbiAgbGV0IGludGVyZmFjZVdpbmRvd1VzZSA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI2ludGVyZmFjZVdpbmRvd1VzZVwiKTtcbiAgLy8g5oqA6IO95qCP5oyJ6ZKu57uEXG4gIGxldCBpbnRlcmZhY2VXaW5kb3dCYXIgPSB3aW4ucXVlcnlTZWxlY3RvcihcImRpdiNpbnRlcmZhY2VXaW5kb3dCYXJcIik7XG4gIC8vIOWcsOWbvuS/oeaBr1xuICBsZXQgaW50ZXJmYWNlV2luZG93TWFwID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjaW50ZXJmYWNlV2luZG93TWFwXCIpO1xuICAvLyDpgInpobnoj5zljZVcbiAgbGV0IGludGVyZmFjZVdpbmRvd01lbnUgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNpbnRlcmZhY2VXaW5kb3dNZW51XCIpO1xuICAvLyDnjqnlrrbnmoRocFxuICBsZXQgaW50ZXJmYWNlV2luZG93SFAgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNpbnRlcmZhY2VXaW5kb3dIUFwiKTtcbiAgLy8g546p5a6255qEc3BcbiAgbGV0IGludGVyZmFjZVdpbmRvd1NQID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjaW50ZXJmYWNlV2luZG93U1BcIik7XG5cbiAgd2luLmFzc2lnbihcImhpZGVVc2VcIiwgZnVuY3Rpb24gKCkge1xuICAgIGludGVyZmFjZVdpbmRvd1VzZS5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgfSk7XG5cbiAgd2luLmFzc2lnbihcInNob3dVc2VcIiwgZnVuY3Rpb24gKCkge1xuICAgIGludGVyZmFjZVdpbmRvd1VzZS5zdHlsZS52aXNpYmlsaXR5ID0gXCJ2aXNpYmxlXCI7XG4gIH0pO1xuXG4gIHdpbi5vbihcImFjdGl2ZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgR2FtZS5zdGFydCgpO1xuICB9KTtcblxuICB3aW4ub24oXCJkZWFjdGl2ZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgR2FtZS5wYXVzZSgpO1xuICB9KVxuXG4gIHdpbi53aGVuVXAoW1wiZXNjXCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgaWYgKEdhbWUud2luZG93cy5pbnRlcmZhY2UuYXRvcCkge1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGludGVyZmFjZVdpbmRvd01lbnUuY2xpY2soKTtcbiAgICAgIH0sIDIwKTtcbiAgICB9XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIEluaXRJbnRlcmZhY2VCYXIgKCkge1xuICAgIGxldCBidXR0b25Db3VudCA9IDg7XG4gICAgbGV0IGJ1dHRvbkhUTUwgPSBcIlwiO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnV0dG9uQ291bnQ7IGkrKykge1xuICAgICAgbGV0IGxpbmUgPSBcIlwiO1xuICAgICAgbGluZSArPSBgPGJ1dHRvbiBkYXRhLWluZGV4PVwiJHtpfVwiIGNsYXNzPVwiaW50ZXJmYWNlV2luZG93QnV0dG9uXCI+YDtcbiAgICAgIGxpbmUgKz0gYDxsYWJlbCBkYXRhLWluZGV4PVwiJHtpfVwiIGNsYXNzPVwiaW50ZXJmYWNlV2luZG93QnV0dG9uVGV4dFwiPjwvbGFiZWw+YFxuICAgICAgbGluZSArPSBgPC9idXR0b24+XFxuYDtcbiAgICAgIGJ1dHRvbkhUTUwgKz0gbGluZTtcbiAgICB9XG4gICAgaW50ZXJmYWNlV2luZG93QmFyLmlubmVySFRNTCA9IGJ1dHRvbkhUTUw7XG4gIH1cblxuICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgaWYgKEdhbWUuaGVybyAmJiBHYW1lLnBhdXNlZCA9PSBmYWxzZSkge1xuICAgICAgR2FtZS5oZXJvLmRhdGEudGltZSsrO1xuICAgICAgR2FtZS53aW5kb3dzLmludGVyZmFjZS5kYXRldGltZSgpO1xuICAgIH1cbiAgfSwgMTAwMCk7XG5cbiAgSW5pdEludGVyZmFjZUJhcigpO1xuICBsZXQgYnV0dG9ucyA9IHdpbi5xdWVyeVNlbGVjdG9yQWxsKFwiLmludGVyZmFjZVdpbmRvd0J1dHRvblwiKTtcbiAgbGV0IGJ1dHRvblRleHRzID0gd2luLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuaW50ZXJmYWNlV2luZG93QnV0dG9uVGV4dFwiKTtcblxuICBpbnRlcmZhY2VXaW5kb3dCYXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIGxldCBpbmRleCA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWluZGV4XCIpO1xuICAgIGlmIChpbmRleCkge1xuICAgICAgbGV0IGVsZW1lbnQgPSBHYW1lLmhlcm8uZGF0YS5iYXJbaW5kZXhdO1xuICAgICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQudHlwZSA9PSBcInNraWxsXCIpIHtcbiAgICAgICAgICBsZXQgY29vbGRvd24gPSBHYW1lLmhlcm8uZmlyZShlbGVtZW50LmlkKTtcbiAgICAgICAgICBpZiAoY29vbGRvd24pIHtcbiAgICAgICAgICAgIGV2ZW50LnRhcmdldC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9LCBjb29sZG93bik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQudHlwZSA9PSBcIml0ZW1cIikge1xuICAgICAgICAgIGxldCBpdGVtSWQgPSBlbGVtZW50LmlkO1xuICAgICAgICAgIGxldCBpdGVtID0gR2FtZS5pdGVtc1tpdGVtSWRdO1xuICAgICAgICAgIGl0ZW0uaGVyb1VzZSgpO1xuICAgICAgICAgIEdhbWUud2luZG93cy5pbnRlcmZhY2UucmVmcmVzaCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICB3aW4ud2hlblVwKFtcIjFcIiwgXCIyXCIsIFwiM1wiLCBcIjRcIiwgXCI1XCIsIFwiNlwiLCBcIjdcIiwgXCI4XCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgbGV0IG51bSA9IHBhcnNlSW50KGtleSk7XG4gICAgaWYgKE51bWJlci5pc0ludGVnZXIobnVtKSAmJiBudW0gPj0gMCAmJiBudW0gPCBidXR0b25zLmxlbmd0aCkge1xuICAgICAgYnV0dG9uc1tudW0gLSAxXS5jbGljaygpO1xuICAgIH1cbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJlXCIsIFwiRVwiLCBcInNwYWNlXCIsIFwiZW50ZXJcIl0sIGZ1bmN0aW9uIChrZXkpIHtcbiAgICBpZiAoR2FtZS53aW5kb3dzLmludGVyZmFjZS5zaG93aW5nKSB7XG4gICAgICBpZiAoR2FtZS5oaW50T2JqZWN0ICYmIEdhbWUuaGludE9iamVjdC5oZXJvVXNlKSB7XG4gICAgICAgIEdhbWUuaGludE9iamVjdC5oZXJvVXNlKCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBpbnRlcmZhY2VXaW5kb3dVc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIGlmIChHYW1lLmhpbnRPYmplY3QgJiYgR2FtZS5oaW50T2JqZWN0Lmhlcm9Vc2UpIHtcbiAgICAgIEdhbWUuaGludE9iamVjdC5oZXJvVXNlKCk7XG4gICAgfVxuICB9KTtcblxuICB3aW4uYXNzaWduKFwic3RhdHVzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoR2FtZS5oZXJvKSB7XG4gICAgICBsZXQgaHAgPSBHYW1lLmhlcm8uZGF0YS5ocCAvIEdhbWUuaGVyby5kYXRhLiRocDtcbiAgICAgIGxldCBzcCA9IEdhbWUuaGVyby5kYXRhLnNwIC8gR2FtZS5oZXJvLmRhdGEuJHNwO1xuICAgICAgaW50ZXJmYWNlV2luZG93SFAuc3R5bGUud2lkdGggPSBgJHtocCoxMDB9JWA7XG4gICAgICBpbnRlcmZhY2VXaW5kb3dTUC5zdHlsZS53aWR0aCA9IGAke3NwKjEwMH0lYDtcbiAgICAgIGlmIChocCA+PSAwLjUpIHtcbiAgICAgICAgaW50ZXJmYWNlV2luZG93SFAuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJncmVlblwiO1xuICAgICAgfSBlbHNlIGlmIChocCA+PSAwLjI1KSB7XG4gICAgICAgIGludGVyZmFjZVdpbmRvd0hQLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpbnRlcmZhY2VXaW5kb3dIUC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJlZFwiO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgd2luLmFzc2lnbihcImRhdGV0aW1lXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoR2FtZS5oZXJvICYmIEdhbWUuaGVyby5kYXRhICYmIE51bWJlci5pc0ludGVnZXIoR2FtZS5oZXJvLmRhdGEudGltZSkpIHtcbiAgICAgIGxldCBZRUFSTUlOID0gNjAqMjQqMzAqMTI7XG4gICAgICBsZXQgTU9OVEhNSU4gPSA2MCoyNCozMDtcbiAgICAgIGxldCBEQVlNSU4gPSA2MCoyNDtcbiAgICAgIGxldCBIT1VSTUlOID0gNjA7XG4gICAgICBsZXQgZGF0ZXRpbWUgPSB3aW4ucXVlcnlTZWxlY3RvcihcIiNpbnRlcmZhY2VXaW5kb3dEYXRldGltZVwiKTtcbiAgICAgIGxldCB0aW1lID0gR2FtZS5oZXJvLmRhdGEudGltZTtcbiAgICAgIGxldCB5ZWFyID0gTWF0aC5mbG9vcih0aW1lL1lFQVJNSU4pO1xuICAgICAgdGltZSA9IHRpbWUgJSBZRUFSTUlOO1xuICAgICAgbGV0IG1vbnRoID0gTWF0aC5mbG9vcih0aW1lL01PTlRITUlOKTtcbiAgICAgIHRpbWUgPSB0aW1lICUgTU9OVEhNSU47XG4gICAgICBsZXQgZGF5ID0gTWF0aC5mbG9vcih0aW1lL0RBWU1JTik7XG4gICAgICB0aW1lID0gdGltZSAlIERBWU1JTjtcbiAgICAgIGxldCBob3VyID0gTWF0aC5mbG9vcih0aW1lL0hPVVJNSU4pO1xuICAgICAgdGltZSA9IHRpbWUgJSBIT1VSTUlOO1xuICAgICAgbGV0IG1pbnV0ZSA9IHRpbWU7XG4gICAgICB5ZWFyKys7XG4gICAgICBtb250aCsrO1xuICAgICAgZGF5Kys7XG4gICAgICBob3VyID0gaG91ci50b1N0cmluZygpO1xuICAgICAgd2hpbGUgKGhvdXIubGVuZ3RoIDwgMikgaG91ciA9IFwiMFwiK2hvdXI7XG4gICAgICBtaW51dGUgPSBtaW51dGUudG9TdHJpbmcoKTtcbiAgICAgIHdoaWxlIChtaW51dGUubGVuZ3RoIDwgMikgbWludXRlID0gXCIwXCIrbWludXRlO1xuICAgICAgZGF0ZXRpbWUudGV4dENvbnRlbnQgPSBgJHttb250aH3mnIgke2RheX3ml6UgJHtob3VyfToke21pbnV0ZX1gO1xuXG4gICAgICB2YXIgdHlwZSA9IEdhbWUuYXJlYS5tYXAuZGF0YS50eXBlO1xuXG4gICAgICBpZiAodHlwZSA9PSBcImluZG9vclwiKSB7XG4gICAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICAgICAgR2FtZS5zdGFnZS5maWx0ZXIoXCJicmlnaHRuZXNzXCIsIDAuMCk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJvdXRkb29yXCIpIHtcbiAgICAgICAgLy8g5a6k5aSWXG4gICAgICAgIGlmIChob3VyID49IDIwIHx8IGhvdXIgPCA0KSB7IC8vIDIwOjAwIHRvIDQ6MDBcbiAgICAgICAgICBHYW1lLnN0YWdlLmZpbHRlcihcImJyaWdodG5lc3NcIiwgLTAuMTUpO1xuICAgICAgICB9IGVsc2UgaWYgKGhvdXIgPj0gNCAmJiBob3VyIDwgNikge1xuICAgICAgICAgIEdhbWUuc3RhZ2UuZmlsdGVyKFwiYnJpZ2h0bmVzc1wiLCAtMC4xKTtcbiAgICAgICAgfSBlbHNlIGlmIChob3VyID49IDYgJiYgaG91ciA8IDgpIHtcbiAgICAgICAgICBHYW1lLnN0YWdlLmZpbHRlcihcImJyaWdodG5lc3NcIiwgLTAuMDUpO1xuICAgICAgICB9IGVsc2UgaWYgKGhvdXIgPj0gOCAmJiBob3VyIDwgMTApIHtcbiAgICAgICAgICBHYW1lLnN0YWdlLmZpbHRlcihcImJyaWdodG5lc3NcIiwgMC4wKTtcbiAgICAgICAgfSBlbHNlIGlmIChob3VyID49IDEwICYmIGhvdXIgPCAxMikge1xuICAgICAgICAgIEdhbWUuc3RhZ2UuZmlsdGVyKFwiYnJpZ2h0bmVzc1wiLCAwLjA1KTtcbiAgICAgICAgfSBlbHNlIGlmIChob3VyID49IDEyICYmIGhvdXIgPCAxNCkge1xuICAgICAgICAgIEdhbWUuc3RhZ2UuZmlsdGVyKFwiYnJpZ2h0bmVzc1wiLCAwLjApO1xuICAgICAgICB9IGVsc2UgaWYgKGhvdXIgPj0gMTQgJiYgaG91ciA8IDE2KSB7XG4gICAgICAgICAgR2FtZS5zdGFnZS5maWx0ZXIoXCJicmlnaHRuZXNzXCIsIDAuMCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaG91ciA+PSAxNiAmJiBob3VyIDwgMTgpIHtcbiAgICAgICAgICBHYW1lLnN0YWdlLmZpbHRlcihcImJyaWdodG5lc3NcIiwgLTAuMDUpO1xuICAgICAgICB9IGVsc2UgaWYgKGhvdXIgPj0gMTggJiYgaG91ciA8IDIwKSB7XG4gICAgICAgICAgR2FtZS5zdGFnZS5maWx0ZXIoXCJicmlnaHRuZXNzXCIsIC0wLjEpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJjYXZlXCIpIHtcbiAgICAgICAgLy8gY2F2ZXMgYXJlIGRhcmtcbiAgICAgICAgR2FtZS5zdGFnZS5maWx0ZXIoXCJicmlnaHRuZXNzXCIsIC0wLjE1KTtcbiAgICAgIH1cblxuICAgIH1cbiAgfSk7XG5cbiAgd2luLmFzc2lnbihcInJlZnJlc2hcIiwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7XG4gICAgICBsZXQgZWxlbWVudCA9IEdhbWUuaGVyby5kYXRhLmJhcltpXTtcbiAgICAgIGxldCBidXR0b24gPSBidXR0b25zW2ldO1xuICAgICAgbGV0IHRleHQgPSBidXR0b25UZXh0c1tpXTtcbiAgICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgdGV4dC5kaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgICBpZiAoZWxlbWVudCkge1xuICAgICAgICBsZXQgaWQgPSBlbGVtZW50LmlkO1xuICAgICAgICBsZXQgdHlwZSA9IGVsZW1lbnQudHlwZTtcbiAgICAgICAgaWYgKHR5cGUgPT0gXCJza2lsbFwiKSB7XG4gICAgICAgICAgbGV0IHNraWxsID0gR2FtZS5za2lsbHNbaWRdO1xuICAgICAgICAgIGJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKFwiJHtza2lsbC5pY29uLnNyY31cIilgO1xuICAgICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBza2lsbC5kYXRhLmNvc3Q7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcIml0ZW1cIikge1xuICAgICAgICAgIGxldCBpdGVtID0gR2FtZS5pdGVtc1tpZF07XG4gICAgICAgICAgYnV0dG9uLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoXCIke2l0ZW0uaWNvbi5zcmN9XCIpYDtcbiAgICAgICAgICBpZiAoR2FtZS5oZXJvLmRhdGEuaXRlbXNbaWRdKSB7XG4gICAgICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gR2FtZS5oZXJvLmRhdGEuaXRlbXNbaWRdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gXCIwXCI7XG4gICAgICAgICAgICBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGV4dC5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBlbXB0eSBiYXIgZWxlbWVudFxuICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gXCJcIjtcbiAgICAgICAgYnV0dG9uLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IFwiXCI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaW50ZXJmYWNlV2luZG93TWFwLnRleHRDb250ZW50ID0gR2FtZS5hcmVhLm1hcC5kYXRhLm5hbWU7XG4gIH0pO1xuXG4gIGludGVyZmFjZVdpbmRvd01lbnUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIEdhbWUud2luZG93cy5zeXNtZW51LnNob3coKTtcbiAgfSk7XG5cblxufSkoKTtcbiJdfQ==
