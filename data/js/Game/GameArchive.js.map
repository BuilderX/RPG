{"version":3,"sources":["src/Game/GameArchive.js"],"names":[],"mappings":"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","file":"src/Game/GameArchive.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  Game.Archive = {};\n\n  Game.Archive.remove = function (id) {\n    if (window.localStorage.getItem(id)) {\n      window.localStorage.removeItem(id);\n    }\n  };\n\n  // 返回所有存档，Object格式\n  Game.Archive.list = function () {\n    var keys = [];\n    for (let key in window.localStorage) {\n      if (key.match(/^SAVE_(\\d+)$/)) {\n        keys.push(parseInt(key.match(/^SAVE_(\\d+)$/)[1]));\n      }\n    }\n    keys.sort();\n    keys.reverse();\n    return keys;\n  };\n\n  // 返回最新存档，Object格式\n  Game.Archive.last = function () {\n    var list = Game.Archive.list();\n    if (list.length > 0) {\n      var last = list[0];\n      return JSON.parse(window.localStorage.getItem(`SAVE_${last}`));\n    } else {\n      throw new Error(\"Game.Archive.last Error\");\n    }\n  };\n\n  Game.Archive.clear = function () {\n    for (let key in window.localStorage) {\n      if (key.match(/^SAVE_(\\d+)$/)) {\n        window.localStorage.removeItem(key);\n      }\n    }\n  };\n\n  Game.Archive.save = function (data) {\n    var now = new Date();\n    var id = now.getTime();\n\n    data.id = id;\n    data.name = data.hero.name;\n    data.date = now.toLocaleString();\n\n    window.localStorage.setItem(`SAVE_${id}`, JSON.stringify(data));\n  };\n\n  Game.Archive.get = function (id) {\n    if (id && window.localStorage.getItem(id)) {\n      return JSON.parse(window.localStorage.getItem(id));\n    }\n    return null;\n  };\n\n  Game.Archive.load = function (id) {\n    var data = Game.Archive.get(id);\n    if (!data) {\n      data = Game.Archive.last();\n    }\n\n    if (data) {\n\n      Game.windows.loading.execute(\"begin\");\n\n      var heroData = data.hero;\n\n      Game.drawHero(heroData.custom, function (heroImage) {\n        heroData.image = heroImage;\n        Game.hero = new Game.Actor(heroData);\n\n        Game.hero.on(\"complete\", function () {\n\n          Game.loadArea(heroData.area, function (area) {\n\n            Game.area = area;\n            area.map.draw(Game.layers.mapLayer);\n\n            if (!Game.hero.data.x && !Game.hero.data.x) {\n              if (area.map.data.entry.x && area.map.data.entry.y) {\n                Game.hero.data.x = area.map.data.entry.x;\n                Game.hero.data.y = area.map.data.entry.y;\n              } else {\n                throw new Error(\"Invalid Hero Position\");\n              }\n            }\n\n            area.actors.add(Game.hero);\n            Game.hero.draw(Game.layers.actorLayer);\n            Game.hero.focus();\n            Game.windows.main.hide();\n            Game.windows.interface.show();\n            Game.start();\n\n            Game.windows.loading.execute(\"end\");\n          });\n        });\n\n      });\n\n    } else {\n      console.error(\"id:\", id);\n      throw \"Invalid id, Game.Archive.load\";\n    }\n      //return archive[id];\n\n  };\n})();\n"]}