{"version":3,"sources":["../../../src/Game/GameActorMonster.js"],"names":[],"mappings":"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","file":"GameActorMonster.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  let internal = Sprite.Namespace();\n\n  /**\n    英雄类\n    属性：\n      this.sprite 精灵\n  */\n  Game.assign(\"ActorMonster\", class GameActorMonster extends Game.Actor {\n    constructor (actorData) {\n      super(actorData);\n      let privates = internal(this);\n      privates.ai = null;\n      privates.attacking = false;\n    }\n\n    damage (attacker, skill) {\n      super.damage(attacker, skill);\n      let privates = internal(this);\n\n      if (privates.attacking == false) {\n        this.goto(attacker.x, attacker.y, \"walk\");\n      }\n    }\n\n    erase () {\n      let privates = internal(this);\n      super.erase();\n\n      if (privates.ai) {\n        Sprite.Ticker.off(\"tick\", privates.ai);\n        privates.ai = null;\n      }\n    }\n\n    draw () {\n      let privates = internal(this);\n      super.draw();\n\n      let dodo = Sprite.rand(30, 60);\n\n      privates.ai = Sprite.Ticker.on(\"tick\", (event) => {\n\n        if (Game.paused) return;\n\n        let tickCount = event.data;\n\n        if (tickCount % 20 == 0) {\n          let barChanged = false;\n\n          if (this.data.hp < this.data.$hp && privates.attacking == false) {\n            this.data.hp++;\n            barChanged = true;\n          }\n\n          if (this.data.sp < this.data.$sp) {\n            this.data.sp++;\n            barChanged = true;\n          }\n\n          if (barChanged) {\n            this.refreshBar();\n          }\n        }\n\n        if (privates.attacking) {\n          if (tickCount % dodo == 0) {\n            if (\n              Game.hero &&\n              this.facePosition.x == Game.hero.x &&\n              this.facePosition.y == Game.hero.y\n            ) {\n              if (this.y == Game.hero.y) { // left or right\n                if (this.x < Game.hero.x) { // left\n                  this.fire(this.data.skills[0], \"right\");\n                } else { // right\n                  this.fire(this.data.skills[0], \"left\");\n                }\n              } else { // up or down\n                if (this.y < Game.hero.y) { // up\n                  this.fire(this.data.skills[0], \"down\");\n                } else { // down\n                  this.fire(this.data.skills[0], \"up\");\n                }\n              }\n            }\n          } else if (Game.hero && Game.hero.distance(this) < 12) {\n            this.goto(Game.hero.x, Game.hero.y, \"walk\");\n          } else {\n            privates.attacking = false;\n            if (Game.hero.beAttacking.has(this)) {\n              Game.hero.beAttacking.delete(this);\n            }\n          }\n        } else {\n          if (tickCount % dodo == 0) {\n            if (Game.hero && Game.hero.distance(this) < 8) {\n              this.goto(Game.hero.x, Game.hero.y, \"walk\");\n              privates.attacking = true;\n              Game.hero.beAttacking.add(this);\n            } else if (this.data.mode == \"patrol\") {\n              if (Math.random() > 0.3) {\n                this.stop();\n                return;\n              }\n              let directions = [\"down\", \"left\", \"right\", \"up\"];\n              this.go(\"walk\",\n                directions[Math.floor(Math.random() * directions.length)],\n                () => {\n                  this.stop();\n                });\n            }\n          }\n        } // not attacking\n\n\n      });\n\n\n    }\n\n\n  });\n\n\n})();\n"]}