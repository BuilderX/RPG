{"version":3,"sources":["src/Sprite/SpriteText.js"],"names":[],"mappings":"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","file":"src/Sprite/SpriteText.js","sourcesContent":["/*\n\n2D Game Sprite Library, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n/// @file SpriteText.js\n/// @namespace Sprite\n/// class Sprite.Text\n\n(function (Sprite) {\n  \"use strict\";\n\n  var textCanvas = document.createElement(\"canvas\");\n  textCanvas.width = 1;\n  textCanvas.height = 1;\n  var textContext = textCanvas.getContext(\"2d\");\n\n  Sprite.Text = class Text extends Sprite.Display {\n    constructor (config) {\n      super();\n      this._config = config;\n      this._text = config.text || \"Hello World!\";\n      this._maxWidth = config.maxWidth || 1000;\n      this._color = config.color || \"black\";\n      this._fontSize = config.fontSize || 14;\n      this._fontFamily = config.fontFamily || \"Ariel\";\n      this._image = null;\n      this.generate();\n    }\n\n    clone () {\n      var text = new Text(this._config);\n      text.x = this.x;\n      text.y = this.y;\n      text.centerX = this.centerX;\n      text.centerY = this.centerY;\n      text.scaleX = this.scaleX;\n      text.scaleY = this.scaleY;\n      return text;\n    }\n\n    get svg () {\n      return this._svg;\n    }\n\n    set svg (value) {\n      throw new TypeError(\"Sprite.Text.svg readonly\");\n    }\n\n    get text () {\n      return this._text;\n    }\n\n    set text (value) {\n      this._text = value;\n      this.generate();\n    }\n\n    get width () {\n      return this._width;\n    }\n\n    set width (value) {\n      this._width = value;\n      this.generate();\n    }\n\n    get height () {\n      return this._height;\n    }\n\n    set height (value) {\n      this._height = value;\n      this.generate();\n    }\n\n    get color () {\n      return this._color;\n    }\n\n    set color (value) {\n      this._color = value;\n      this.generate();\n    }\n\n    get fontSize () {\n      return this._fontSize;\n    }\n\n    set fontSize (value) {\n      this._fontSize = value;\n      this.generate();\n    }\n\n    get fontFamily () {\n      return this._fontFamily;\n    }\n\n    set fontFamily (value) {\n      this._fontFamily = value;\n      this.generate();\n    }\n\n    generate () {\n      textContext.font = this._fontSize + \"px \" + this._fontFamily;\n      // \"龍\" is the max-width & max-height Chinese word I think\n      var lineHeight = Math.ceil(textContext.measureText(\"龍\").width * 1.2);\n      this._width = 0;\n\n      // find the real-maximum-width of multiline text, base user's maxWidth\n      var lines = [];\n      var lineText = \"\";\n      for (let i = 0; i < this._text.length; i++) {\n        if (textContext.measureText(lineText + this._text[i]).width > this._maxWidth) {\n          lines.push(lineText);\n          lineText = this._text[i];\n        } else {\n          lineText += this._text[i];\n        }\n        if (textContext.measureText(lineText).width > this._width)\n          this._width = Math.ceil(textContext.measureText(lineText).width);\n      }\n\n      if (lineText.length) {\n        lines.push(lineText);\n      }\n\n      this._height = lines.length * lineHeight;\n\n      var canvas = document.createElement(\"canvas\");\n      canvas.width = this._width;\n      canvas.height = this._height;\n      var context = canvas.getContext(\"2d\");\n      context.font = this._fontSize + \"px \" + this._fontFamily;\n      context.fillStyle = this._color;\n      context.textAlign = \"center\";\n      context.textBaseline = \"top\";\n      // draw each line\n      lines.forEach((element, index) => {\n        context.fillText(element, canvas.width/2, index*lineHeight)\n      });\n\n      this._image = canvas;\n    }\n\n    draw (context) {\n      if (this._image && this._image.width > 0 && this._image.height > 0) {\n        this.drawImage(\n          context,\n          this._image,\n          0,\n          0,\n          this._image.width,\n          this._image.height\n        );\n      }\n    }\n  }\n\n\n})(Sprite);\n"]}