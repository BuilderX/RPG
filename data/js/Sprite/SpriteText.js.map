{"version":3,"sources":["src/Sprite/SpriteText.js"],"names":[],"mappings":"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","file":"src/Sprite/SpriteText.js","sourcesContent":["/*\n\n2D Game Sprite Library, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n/**\n * @fileoverview Define the Sprite.Text to show text in game\n * @author mail@qhduan.com (QH Duan)\n */\n\n (function () {\n   \"use strict\";\n\n  let internal = Sprite.Namespace();\n\n  let textCanvas = document.createElement(\"canvas\");\n  textCanvas.width = 1;\n  textCanvas.height = 1;\n  let textContext = textCanvas.getContext(\"2d\");\n\n  /**\n   * Class Sprite.Text, contain text\n   * @class\n   * @extends Sprite.Display\n   */\n  Sprite.register(\"Text\", class SpriteText extends Sprite.Display {\n    /**\n     * construct Sprite.Text\n     * @constructor\n     */\n    constructor (config) {\n      super();\n      internal(this).text = config.text || \"Invalid Text\";\n      internal(this).maxWidth = config.maxWidth || 1000;\n      internal(this).color = config.color || \"black\";\n      internal(this).fontSize = config.fontSize || 14;\n      internal(this).fontFamily = config.fontFamily || \"Ariel\";\n      internal(this).image = null;\n      this.generate();\n    }\n\n    clone () {\n      let text = new Text({\n        text: internal(this).text,\n        maxWidth: internal(this).maxWidth,\n        color: internal(this).color,\n        fontSize: internal(this).fontSize,\n        fontFamily: internal(this).fontFamily\n      });\n      text.x = this.x;\n      text.y = this.y;\n      text.centerX = this.centerX;\n      text.centerY = this.centerY;\n      return text;\n    }\n\n    get text () {\n      return internal(this).text;\n    }\n\n    set text (value) {\n      if (value != this.text) {\n        internal(this).text = value;\n        this.generate();\n      }\n    }\n\n    get width () {\n      return internal(this).width;\n    }\n\n    set width (value) {\n      if (value != this.width) {\n        internal(this).width = value;\n        this.generate();\n      }\n    }\n\n    get height () {\n      return internal(this).height;\n    }\n\n    set height (value) {\n      if (value != this.height) {\n        internal(this).height = value;\n        this.generate();\n      }\n    }\n\n    get color () {\n      return internal(this).color;\n    }\n\n    set color (value) {\n      if (value != this.color) {\n        internal(this).color = value;\n        this.generate();\n      }\n    }\n\n    get fontSize () {\n      return internal(this).fontSize;\n    }\n\n    set fontSize (value) {\n      if (value != this.fontSize) {\n        internal(this).fontSize = value;\n        this.generate();\n      }\n    }\n\n    get fontFamily () {\n      return internal(this).fontFamily;\n    }\n\n    set fontFamily (value) {\n      if (value != this.fontFamily) {\n        internal(this).fontFamily = value;\n        this.generate();\n      }\n    }\n\n    generate () {\n      textContext.font = this.fontSize + \"px \" + internal(this).fontFamily;\n      // \"龍\" is the max-width & max-height Chinese word I think\n      let lineHeight = Math.ceil(textContext.measureText(\"龍\").width * 1.2);\n      internal(this).width = 0;\n\n      // find the real-maximum-width of multiline text, base user's maxWidth\n      let lines = [];\n      let lineText = \"\";\n      for (let i = 0; i < this.text.length; i++) {\n        if (textContext.measureText(lineText + this.text[i]).width > this.maxWidth) {\n          lines.push(lineText);\n          lineText = this.text[i];\n        } else {\n          lineText += this.text[i];\n        }\n        if (textContext.measureText(lineText).width > this.width)\n          internal(this).width = Math.ceil(textContext.measureText(lineText).width);\n      }\n\n      if (lineText.length) {\n        lines.push(lineText);\n      }\n\n      this.height = lines.length * lineHeight;\n\n      let canvas = document.createElement(\"canvas\");\n      canvas.width = this.width;\n      canvas.height = this.height;\n      let context = canvas.getContext(\"2d\");\n      context.font = this.fontSize + \"px \" + this.fontFamily;\n      context.fillStyle = this.color;\n      context.textAlign = \"center\";\n      context.textBaseline = \"top\";\n      // draw each line\n      lines.forEach((element, index) => {\n        context.fillText(element, canvas.width/2, index*lineHeight)\n      });\n\n      internal(this).image = canvas;\n    }\n\n    draw (context) {\n      let image = internal(this).image;\n      if ( image && image.width > 0 && image.height > 0) {\n        this.drawImage(\n          context,\n          image,\n          0,\n          0,\n          image.width,\n          image.height\n        );\n      }\n    }\n  });\n\n\n})();\n"]}