{"version":3,"sources":["src/Game/Game.js"],"names":[],"mappings":"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","file":"src/Game/Game.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  let internal = Sprite.Namespace();\n\n    // root级别api入口\n  class GameCore {\n\n    constructor () {\n      let privates = internal(this);\n      privates.items = {};\n      privates.skills = {};\n      privates.sounds = {};\n      privates.layers = {};\n      privates.windows = {};\n      privates.config = { // 保存所有设置（默认设置）\n        width: 800, // 渲染窗口的原始大小\n        height: 450,\n        scale: true, // 如果不拉伸，那么无论浏览器窗口多大，都是原始大小；拉伸则按比例填满窗口\n        fps: 35, // 锁定fps到指定数值，如果设置为<=0，则不限制\n      };\n      privates.paused = true;\n      privates.stage = null;\n    }\n\n    assign (name, object) {\n      Object.defineProperty(this, name, {\n        enumerable: false,\n        configurable: false,\n        writable: false,\n        value: object\n      });\n      return this;\n    }\n\n    /** 设置游戏暂停标志为false，启动游戏主循环，接受输入 */\n    start () {\n      internal(this).paused = false;\n    }\n\n    /** 暂停游戏 */\n    pause () {\n      internal(this).paused = true;\n    }\n\n    get paused () {\n      return internal(this).paused;\n    }\n\n    set paused (value) {\n      throw new Error(\"Game.paused readonly, use Game.pause() instead\");\n    }\n\n    get windows () {\n      return internal(this).windows;\n    }\n\n    set windows (value) {\n      throw new Error(\"Game.windows readonly\");\n    }\n\n    get config () {\n      return internal(this).config;\n    }\n\n    set config (value) {\n      throw new Error(\"Game.config readonly\");\n    }\n\n    get items () {\n      return internal(this).items;\n    }\n\n    set items (value) {\n      throw new Error(\"Game.items readonly\");\n    }\n\n    get skills () {\n      return internal(this).skills;\n    }\n\n    set skills (value) {\n      throw new Error(\"Game.skills readonly\");\n    }\n\n    get sounds () {\n      return internal(this).sounds;\n    }\n\n    set sounds (value) {\n      throw new Error(\"Game.sounds readonly\");\n    }\n\n    get layers () {\n      return internal(this).layers;\n    }\n\n    set layers (value) {\n      throw new Error(\"Game.layers readonly\");\n    }\n\n    get stage () {\n      return internal(this).stage;\n    }\n\n    set stage (value) {\n      throw new Error(\"Game.stage readonly\");\n    }\n\n    /** 清理舞台，即删除舞台上所有元素 */\n    clearStage () {\n      for (let actor of Game.area.actors) {\n        actor.erase();\n      }\n      for (let bag of Game.area.bags) {\n        bag.erase();\n      }\n      for (let child of this.layers.mapLayer.children) {\n        child.clear();\n      }\n      for (let child of this.layers.mapHideLayer.children) {\n        child.clear();\n      }\n      for (let layer of internal(this).stage.children) {\n        layer.clear();\n      }\n    }\n\n    /** 游戏初始化 */\n    init () {\n      let privates = internal(this);\n      // 舞台\n      privates.stage = new Sprite.Stage(privates.config.width, privates.config.height);\n      // 建立一个可以自动伸缩的窗口，并将舞台加入其中\n      privates.windows.stage = Game.Window.create(\"stage\")\n        .appendChild(privates.stage.canvas)\n        .show();\n\n      // 地图层\n      privates.layers.mapLayer = new Sprite.Container();\n      privates.layers.mapLayer.name = \"mapLayer\";\n      // 地图层 - 2\n      privates.layers.mapHideLayer = new Sprite.Container();\n      privates.layers.mapHideLayer.name = \"mapHideLayer\";\n      // 物品层\n      privates.layers.itemLayer = new Sprite.Container();\n      privates.layers.itemLayer.name = \"itemLayer\";\n      // 人物层，包括玩家\n      privates.layers.actorLayer = new Sprite.Container();\n      privates.layers.actorLayer.name = \"actorLayer\";\n      // 信息层\n      privates.layers.infoLayer = new Sprite.Container();\n      privates.layers.infoLayer.name = \"inforLayer\";\n      // 技能效果层\n      privates.layers.skillLayer = new Sprite.Container();\n      privates.layers.skillLayer.name = \"skillLayer\";\n      // 对话层\n      privates.layers.dialogueLayer = new Sprite.Container();\n      privates.layers.dialogueLayer.name = \"dialogueLayer\";\n\n      privates.stage.appendChild(\n        privates.layers.mapLayer,\n        privates.layers.mapHideLayer,\n        privates.layers.itemLayer,\n        privates.layers.actorLayer,\n        privates.layers.infoLayer,\n        privates.layers.skillLayer,\n        privates.layers.dialogueLayer\n      );\n\n      // 调整人物层顺序，也就是上方的人物会被下方的人物遮盖，例如\n      /**\n       * AA BB\n       * AA BB\n       * 这样人物A和B都不干涉，但是A的位置如果在B的上面，并且紧挨着就变成了\n       * AA\n       * BB\n       * BB\n       * 这样人物A的下半身就被人物B遮盖，这就是进行排序，否则如果变成\n       * AA\n       * AA\n       * BB\n       * 这样就是B的上半身被人物A遮盖，这就很奇怪\n       */\n      privates.stage.on(\"beforeDraw\", function () {\n        if (Game.hero) {\n          Game.layers.actorLayer.children.sort(function (a, b) {\n            if (a.y < b.y) return -1;\n            if (a.y > b.y) return 1;\n            return 0;\n          });\n        }\n      });\n\n      /*\n      setInterval(() => {\n        if (Game.paused == false) {\n          Game.stage.update();\n        }\n      }, 0);\n      */\n      Sprite.Ticker.on(\"tick\", () => {\n        if (Game.paused == false) {\n          Game.stage.update();\n        }\n      });\n\n      /*\n      let updateNext = false;\n      Game.stage.on(\"change\", function () {\n        updateNext = true;\n      });\n      Sprite.Ticker.on(\"tick\", function () {\n       if (Game.paused == false && updateNext) {\n         Game.stage.update();\n         updateNext = false;\n       }\n      });\n      */\n\n      let fpsElement = document.createElement(\"div\");\n      fpsElement.style.position = \"absolute\";\n      fpsElement.style.left = \"0\";\n      fpsElement.style.top = \"0\";\n      fpsElement.style.color = \"white\";\n      fpsElement.style.zIndex = 999999;\n      document.body.appendChild(fpsElement);\n\n      let fps = 0;\n      let start = new Date().getTime();\n      privates.stage.on(\"afterDraw\", function () {\n        fps++;\n      });\n      setInterval(function () {\n        let now = new Date().getTime();\n        let f = fps / ((now - start)/1000);\n        fps = 0;\n        start = now;\n        fpsElement.textContent = f.toFixed(1);\n      }, 1000);\n\n      console.log(\"RPG Game Flying!\");\n    }\n  };\n\n  let Game = window.Game = new GameCore();\n\n  // under node-webkit\n  if (window.require) {\n    Game.config.scale = true;\n  }\n\n  function GameBootstrap () {\n    if (document.readyState == \"complete\") {\n      Game.init();\n      Game.Input.init();\n      Game.windows.main.show();\n      return true;\n    }\n    return false;\n  }\n\n  if (GameBootstrap() == false) {\n    document.addEventListener(\"readystatechange\", function () {\n      GameBootstrap();\n    });\n  }\n\n})();\n"]}