/*

A-RPG Game, Built using JavaScript ES6
Copyright (C) 2015 qhduan(http://qhduan.com)

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/

"use strict";

(function () {
  "use strict";

  var win = Game.windows.buy = Game.Window.create("buyWindow");

  win.html = "\n  <div class=\"window-box\">\n    <div id=\"buyWindowItemBar\">\n\n      <button id=\"buyWindowClose\" class=\"brownButton\">关闭</button>\n      <button id=\"buyWindowSell\" class=\"brownButton\">卖出</button>\n\n      <button id=\"buyWindowAll\" class=\"brownButton\">全部</button>\n      <button id=\"buyWindowWeapon\" class=\"brownButton\">武器</button>\n      <button id=\"buyWindowArmor\" class=\"brownButton\">护甲</button>\n      <button id=\"buyWindowPotion\" class=\"brownButton\">药水</button>\n      <button id=\"buyWindowMaterial\" class=\"brownButton\">材料</button>\n      <button id=\"buyWindowBook\" class=\"brownButton\">书籍</button>\n      <button id=\"buyWindowMisc\" class=\"brownButton\">其他</button>\n    </div>\n\n    <span id=\"buyWindowGold\"></span>\n\n    <div style=\"overflow: auto; height: 300px;\">\n      <table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n        <thead>\n          <tr>\n            <td style=\"width: 40px;\"></td>\n            <td style=\"width: 120px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td></td>\n            <td style=\"width: 60px;\"></td>\n          </tr>\n        </thead>\n        <tbody id=\"buyWindowTable\"></tbody>\n      </table>\n    </div>\n  </div>\n  ";

  win.css = "\n    #buyWindowItemBar > button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n      margin-left: 5px;\n      margin-right: 5px;\n      margin-top: 0px;\n      margin-bottom: 5px;\n    }\n\n    #buyWindowClose {\n      float: right;\n    }\n\n    #buyWindowStatus {\n      float: right;\n    }\n\n    .buyWindow table {\n      width: 100%;\n    }\n\n    .buyWindow table img {\n      width: 100%;\n      height: 100%;\n    }\n\n    .buyWindow table button {\n      width: 60px;\n      height: 40px;\n      font-size: 16px;\n    }\n\n    #buyWindowGold {\n      position: absolute;\n      right: 100px;\n      bottom: 30px;\n      font-size: 20px;\n      color: black;\n    }\n  ";

  var buyWindowClose = win.querySelector("button#buyWindowClose");
  var buyWindowSell = win.querySelector("button#buyWindowSell");

  var buyWindowAll = win.querySelector("button#buyWindowAll");
  var buyWindowWeapon = win.querySelector("button#buyWindowWeapon");
  var buyWindowArmor = win.querySelector("button#buyWindowArmor");
  var buyWindowPotion = win.querySelector("button#buyWindowPotion");
  var buyWindowMaterial = win.querySelector("button#buyWindowMaterial");
  var buyWindowBook = win.querySelector("button#buyWindowBook");
  var buyWindowMisc = win.querySelector("button#buyWindowMisc");

  var buyWindowGold = win.querySelector("span#buyWindowGold");
  var buyWindowTable = win.querySelector("#buyWindowTable");

  var lastItems = null;
  var lastFilter = null;
  var lastSelect = -1;

  buyWindowClose.addEventListener("click", function () {
    win.hide();
  });

  buyWindowSell.addEventListener("click", function () {
    win.hide();
    Game.windows.sell.open(lastItems);
  });

  win.whenUp(["tab"], function () {
    setTimeout(function () {
      win.hide();
      Game.windows.sell.open(lastItems);
    }, 20);
  });

  buyWindowAll.addEventListener("click", function (event) {
    win.open(lastItems, null);
  });

  buyWindowWeapon.addEventListener("click", function (event) {
    win.open(lastItems, "sword|spear|bow");
  });

  buyWindowArmor.addEventListener("click", function (event) {
    win.open(lastItems, "head|body|feet");
  });

  buyWindowPotion.addEventListener("click", function (event) {
    win.open(lastItems, "potion");
  });

  buyWindowMaterial.addEventListener("click", function (event) {
    win.open(lastItems, "material");
  });

  buyWindowBook.addEventListener("click", function (event) {
    win.open(lastItems, "book|scroll|letter");
  });

  buyWindowMisc.addEventListener("click", function (event) {
    win.open(lastItems, "misc");
  });

  win.assign("open", function (items, filter, select) {

    if (typeof select == "undefined") {
      select = -1;
    }

    lastItems = items;
    lastFilter = filter;
    lastSelect = select;

    buyWindowGold.textContent = Game.hero.data.gold + "G";

    var defaultColor = "white";
    var activeColor = "yellow";

    buyWindowAll.style.color = defaultColor;
    buyWindowWeapon.style.color = defaultColor;
    buyWindowArmor.style.color = defaultColor;
    buyWindowPotion.style.color = defaultColor;
    buyWindowMaterial.style.color = defaultColor;
    buyWindowBook.style.color = defaultColor;
    buyWindowMisc.style.color = defaultColor;

    if (filter == null) {
      buyWindowAll.style.color = activeColor;
    } else if (filter.match(/sword/)) {
      buyWindowWeapon.style.color = activeColor;
    } else if (filter.match(/head/)) {
      buyWindowArmor.style.color = activeColor;
    } else if (filter.match(/potion/)) {
      buyWindowPotion.style.color = activeColor;
    } else if (filter.match(/material/)) {
      buyWindowMaterial.style.color = activeColor;
    } else if (filter.match(/book/)) {
      buyWindowBook.style.color = activeColor;
    } else if (filter.match(/misc/)) {
      buyWindowMisc.style.color = activeColor;
    }

    var index = 0;
    var table = "";
    Sprite.each(items, function (itemCount, itemId) {
      var item = Game.items[itemId];

      if (filter && filter.indexOf(item.data.type) == -1) return;

      var line = "";

      if (select == index) {
        line += "<tr style=\"background-color: green;\">\n";
      } else {
        line += "<tr>\n";
      }

      if (item.icon) {
        line += "  <td><img alt=\"\" src=\"" + item.icon.src + "\"></td>\n";
      } else {
        line += "  <td> </td>\n";
      }
      line += "  <td>" + item.data.name + "</td>\n";
      line += "  <td style=\"text-align: center;\">" + Math.ceil(item.data.value * 1.2) + "G</td>\n";
      line += "  <td style=\"text-align: center;\">" + itemCount + "</td>\n";
      line += "  <td>" + item.data.description + "</td>\n";

      if (Math.ceil(item.data.value * 1.2) > Game.hero.data.gold || items[itemId] <= 0) {
        line += "  <td><button disabled style=\"Opacity: 0.5;\" class=\"brownButton\">买入</button></td>\n";
      } else {
        line += "  <td><button data-id=\"" + itemId + "\" class=\"brownButton\">买入</button></td>\n";
      }

      line += "</tr>\n";
      table += line;
      index++;
    });

    buyWindowTable.innerHTML = table;
    win.show();
  });

  win.whenUp(["enter"], function () {
    var buttons = buyWindowTable.querySelectorAll("button");
    if (lastSelect >= 0 && lastSelect < buttons.length) {
      buttons[lastSelect].click();
    }
  });

  win.whenUp(["up", "down"], function (key) {
    var count = buyWindowTable.querySelectorAll("button").length;
    if (count <= 0) return;

    if (lastSelect == -1) {
      if (key == "down") {
        win.open(lastItems, lastFilter, 0);
      } else if (key == "up") {
        win.open(lastItems, lastFilter, count - 1);
      }
    } else {
      if (key == "down") {
        var select = lastSelect + 1;
        if (select >= count) {
          select = 0;
        }
        win.open(lastItems, lastFilter, select);
      } else if (key == "up") {
        var select = lastSelect - 1;
        if (select < 0) {
          select = count - 1;
        }
        win.open(lastItems, lastFilter, select);
      }
    }
  });

  win.whenUp(["esc"], function () {
    setTimeout(function () {
      win.hide();
    }, 20);
  });

  win.whenUp(["left", "right"], function (key) {
    if (key == "right") {
      var filter = lastFilter;
      if (filter == null) {
        filter = "sword|spear|bow";
      } else if (filter.match(/sword/)) {
        filter = "head|body|feet";
      } else if (filter.match(/head/)) {
        filter = "potion";
      } else if (filter.match(/potion/)) {
        filter = "material";
      } else if (filter.match(/material/)) {
        filter = "book|scroll|letter";
      } else if (filter.match(/book/)) {
        filter = "misc";
      } else if (filter.match(/misc/)) {
        filter = null;
      }
      win.open(lastItems, filter);
    } else if (key == "left") {
      var filter = lastFilter;
      if (filter == null) {
        filter = "misc";
      } else if (filter.match(/sword/)) {
        filter = null;
      } else if (filter.match(/head/)) {
        filter = "sword|spear|bow";
      } else if (filter.match(/potion/)) {
        filter = "head|body|feet";
      } else if (filter.match(/material/)) {
        filter = "potion";
      } else if (filter.match(/book/)) {
        filter = "material";
      } else if (filter.match(/misc/)) {
        filter = "book|scroll|letter";
      }
      win.open(lastItems, filter);
    }
  });

  buyWindowTable.addEventListener("click", function (event) {
    var itemId = event.target.getAttribute("data-id");
    if (itemId && lastItems.hasOwnProperty(itemId)) {
      var item = Game.items[itemId];

      Game.hero.data.gold -= Math.ceil(item.data.value * 1.2);
      if (Game.hero.data.items[itemId]) {
        Game.hero.data.items[itemId]++;
      } else {
        Game.hero.data.items[itemId] = 1;
      }

      lastItems[itemId]--;

      if (lastItems[itemId] == 0) {
        delete lastItems[itemId];
      }

      win.open(lastItems, lastFilter);
    }
  });
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HYW1lL0dhbWVXaW5kb3dCdXkuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQSxDQUFDLFlBQVk7QUFDWCxjQUFZLENBQUM7O0FBRWIsTUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7O0FBRTdELEtBQUcsQ0FBQyxJQUFJLGd4Q0FrQ1AsQ0FBQzs7QUFFRixLQUFHLENBQUMsR0FBRyxpc0JBeUNOLENBQUM7O0FBRUYsTUFBSSxjQUFjLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ2hFLE1BQUksYUFBYSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUMsQ0FBQzs7QUFFOUQsTUFBSSxZQUFZLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzVELE1BQUksZUFBZSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUNsRSxNQUFJLGNBQWMsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFDaEUsTUFBSSxlQUFlLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0FBQ2xFLE1BQUksaUJBQWlCLEdBQUcsR0FBRyxDQUFDLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ3RFLE1BQUksYUFBYSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUM5RCxNQUFJLGFBQWEsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLHNCQUFzQixDQUFDLENBQUM7O0FBRTlELE1BQUksYUFBYSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUM1RCxNQUFJLGNB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QUFDLEVBQUU7QUFDMUIsZUFBTyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7T0FDMUI7O0FBRUQsU0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUM7S0FDakM7R0FDRixDQUFDLENBQUM7Q0FFSixDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJHYW1lV2luZG93QnV5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuQS1SUEcgR2FtZSwgQnVpbHQgdXNpbmcgSmF2YVNjcmlwdCBFUzZcbkNvcHlyaWdodCAoQykgMjAxNSBxaGR1YW4oaHR0cDovL3FoZHVhbi5jb20pXG5cblRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG5pdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxudGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbihhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG5cblRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2Zcbk1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbkdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG5cbllvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlXG5hbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cblxuKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgbGV0IHdpbiA9IEdhbWUud2luZG93cy5idXkgPSBHYW1lLldpbmRvdy5jcmVhdGUoXCJidXlXaW5kb3dcIik7XG5cbiAgd2luLmh0bWwgPSBgXG4gIDxkaXYgY2xhc3M9XCJ3aW5kb3ctYm94XCI+XG4gICAgPGRpdiBpZD1cImJ1eVdpbmRvd0l0ZW1CYXJcIj5cblxuICAgICAgPGJ1dHRvbiBpZD1cImJ1eVdpbmRvd0Nsb3NlXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuWFs+mXrTwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ1eVdpbmRvd1NlbGxcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5Y2W5Ye6PC9idXR0b24+XG5cbiAgICAgIDxidXR0b24gaWQ9XCJidXlXaW5kb3dBbGxcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5YWo6YOoPC9idXR0b24+XG4gICAgICA8YnV0dG9uIGlkPVwiYnV5V2luZG93V2VhcG9uXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuatpuWZqDwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ1eVdpbmRvd0FybW9yXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuaKpOeUsjwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ1eVdpbmRvd1BvdGlvblwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7oja/msLQ8L2J1dHRvbj5cbiAgICAgIDxidXR0b24gaWQ9XCJidXlXaW5kb3dNYXRlcmlhbFwiIGNsYXNzPVwiYnJvd25CdXR0b25cIj7mnZDmlpk8L2J1dHRvbj5cbiAgICAgIDxidXR0b24gaWQ9XCJidXlXaW5kb3dCb29rXCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuS5puexjTwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBpZD1cImJ1eVdpbmRvd01pc2NcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5YW25LuWPC9idXR0b24+XG4gICAgPC9kaXY+XG5cbiAgICA8c3BhbiBpZD1cImJ1eVdpbmRvd0dvbGRcIj48L3NwYW4+XG5cbiAgICA8ZGl2IHN0eWxlPVwib3ZlcmZsb3c6IGF1dG87IGhlaWdodDogMzAwcHg7XCI+XG4gICAgICA8dGFibGUgYm9yZGVyPVwiMVwiIGNlbGxzcGFjaW5nPVwiMFwiIGNlbGxwYWRkaW5nPVwiMFwiPlxuICAgICAgICA8dGhlYWQ+XG4gICAgICAgICAgPHRyPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwid2lkdGg6IDQwcHg7XCI+PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiAxMjBweDtcIj48L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwid2lkdGg6IDMwcHg7XCI+PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiAzMHB4O1wiPjwvdGQ+XG4gICAgICAgICAgICA8dGQ+PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cIndpZHRoOiA2MHB4O1wiPjwvdGQ+XG4gICAgICAgICAgPC90cj5cbiAgICAgICAgPC90aGVhZD5cbiAgICAgICAgPHRib2R5IGlkPVwiYnV5V2luZG93VGFibGVcIj48L3Rib2R5PlxuICAgICAgPC90YWJsZT5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIGA7XG5cbiAgd2luLmNzcyA9IGBcbiAgICAjYnV5V2luZG93SXRlbUJhciA+IGJ1dHRvbiB7XG4gICAgICB3aWR0aDogNjBweDtcbiAgICAgIGhlaWdodDogNDBweDtcbiAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICAgIG1hcmdpbi1sZWZ0OiA1cHg7XG4gICAgICBtYXJnaW4tcmlnaHQ6IDVweDtcbiAgICAgIG1hcmdpbi10b3A6IDBweDtcbiAgICAgIG1hcmdpbi1ib3R0b206IDVweDtcbiAgICB9XG5cbiAgICAjYnV5V2luZG93Q2xvc2Uge1xuICAgICAgZmxvYXQ6IHJpZ2h0O1xuICAgIH1cblxuICAgICNidXlXaW5kb3dTdGF0dXMge1xuICAgICAgZmxvYXQ6IHJpZ2h0O1xuICAgIH1cblxuICAgIC5idXlXaW5kb3cgdGFibGUge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgfVxuXG4gICAgLmJ1eVdpbmRvdyB0YWJsZSBpbWcge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgfVxuXG4gICAgLmJ1eVdpbmRvdyB0YWJsZSBidXR0b24ge1xuICAgICAgd2lkdGg6IDYwcHg7XG4gICAgICBoZWlnaHQ6IDQwcHg7XG4gICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgfVxuXG4gICAgI2J1eVdpbmRvd0dvbGQge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgcmlnaHQ6IDEwMHB4O1xuICAgICAgYm90dG9tOiAzMHB4O1xuICAgICAgZm9udC1zaXplOiAyMHB4O1xuICAgICAgY29sb3I6IGJsYWNrO1xuICAgIH1cbiAgYDtcblxuICBsZXQgYnV5V2luZG93Q2xvc2UgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dDbG9zZVwiKTtcbiAgbGV0IGJ1eVdpbmRvd1NlbGwgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dTZWxsXCIpO1xuXG4gIGxldCBidXlXaW5kb3dBbGwgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dBbGxcIik7XG4gIGxldCBidXlXaW5kb3dXZWFwb24gPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dXZWFwb25cIik7XG4gIGxldCBidXlXaW5kb3dBcm1vciA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI2J1eVdpbmRvd0FybW9yXCIpO1xuICBsZXQgYnV5V2luZG93UG90aW9uID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24jYnV5V2luZG93UG90aW9uXCIpO1xuICBsZXQgYnV5V2luZG93TWF0ZXJpYWwgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dNYXRlcmlhbFwiKTtcbiAgbGV0IGJ1eVdpbmRvd0Jvb2sgPSB3aW4ucXVlcnlTZWxlY3RvcihcImJ1dHRvbiNidXlXaW5kb3dCb29rXCIpO1xuICBsZXQgYnV5V2luZG93TWlzYyA9IHdpbi5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uI2J1eVdpbmRvd01pc2NcIik7XG5cbiAgbGV0IGJ1eVdpbmRvd0dvbGQgPSB3aW4ucXVlcnlTZWxlY3RvcihcInNwYW4jYnV5V2luZG93R29sZFwiKTtcbiAgbGV0IGJ1eVdpbmRvd1RhYmxlID0gd2luLnF1ZXJ5U2VsZWN0b3IoXCIjYnV5V2luZG93VGFibGVcIik7XG5cbiAgbGV0IGxhc3RJdGVtcyA9IG51bGw7XG4gIGxldCBsYXN0RmlsdGVyID0gbnVsbDtcbiAgbGV0IGxhc3RTZWxlY3QgPSAtMTtcblxuICBidXlXaW5kb3dDbG9zZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgIHdpbi5oaWRlKCk7XG4gIH0pO1xuXG4gIGJ1eVdpbmRvd1NlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICB3aW4uaGlkZSgpO1xuICAgIEdhbWUud2luZG93cy5zZWxsLm9wZW4obGFzdEl0ZW1zKTtcbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJ0YWJcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHdpbi5oaWRlKCk7XG4gICAgICBHYW1lLndpbmRvd3Muc2VsbC5vcGVuKGxhc3RJdGVtcyk7XG4gICAgfSwgMjApO1xuICB9KTtcblxuICBidXlXaW5kb3dBbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgbnVsbCk7XG4gIH0pO1xuXG4gIGJ1eVdpbmRvd1dlYXBvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4obGFzdEl0ZW1zLCBcInN3b3JkfHNwZWFyfGJvd1wiKTtcbiAgfSk7XG5cbiAgYnV5V2luZG93QXJtb3IuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgXCJoZWFkfGJvZHl8ZmVldFwiKTtcbiAgfSk7XG5cbiAgYnV5V2luZG93UG90aW9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4ub3BlbihsYXN0SXRlbXMsIFwicG90aW9uXCIpO1xuICB9KTtcblxuICBidXlXaW5kb3dNYXRlcmlhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgd2luLm9wZW4obGFzdEl0ZW1zLCBcIm1hdGVyaWFsXCIpO1xuICB9KTtcblxuICBidXlXaW5kb3dCb29rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4ub3BlbihsYXN0SXRlbXMsIFwiYm9va3xzY3JvbGx8bGV0dGVyXCIpO1xuICB9KTtcblxuICBidXlXaW5kb3dNaXNjLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB3aW4ub3BlbihsYXN0SXRlbXMsIFwibWlzY1wiKTtcbiAgfSk7XG5cbiAgd2luLmFzc2lnbihcIm9wZW5cIiwgZnVuY3Rpb24gKGl0ZW1zLCBmaWx0ZXIsIHNlbGVjdCkge1xuXG4gICAgaWYgKHR5cGVvZiBzZWxlY3QgPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgc2VsZWN0ID0gLTE7XG4gICAgfVxuXG4gICAgbGFzdEl0ZW1zID0gaXRlbXM7XG4gICAgbGFzdEZpbHRlciA9IGZpbHRlcjtcbiAgICBsYXN0U2VsZWN0ID0gc2VsZWN0O1xuXG4gICAgYnV5V2luZG93R29sZC50ZXh0Q29udGVudCA9IEdhbWUuaGVyby5kYXRhLmdvbGQgKyBcIkdcIjtcblxuICAgIGxldCBkZWZhdWx0Q29sb3IgPSBcIndoaXRlXCI7XG4gICAgbGV0IGFjdGl2ZUNvbG9yID0gXCJ5ZWxsb3dcIjtcblxuICAgIGJ1eVdpbmRvd0FsbC5zdHlsZS5jb2xvciA9IGRlZmF1bHRDb2xvcjtcbiAgICBidXlXaW5kb3dXZWFwb24uc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgYnV5V2luZG93QXJtb3Iuc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgYnV5V2luZG93UG90aW9uLnN0eWxlLmNvbG9yID0gZGVmYXVsdENvbG9yO1xuICAgIGJ1eVdpbmRvd01hdGVyaWFsLnN0eWxlLmNvbG9yID0gZGVmYXVsdENvbG9yO1xuICAgIGJ1eVdpbmRvd0Jvb2suc3R5bGUuY29sb3IgPSBkZWZhdWx0Q29sb3I7XG4gICAgYnV5V2luZG93TWlzYy5zdHlsZS5jb2xvciA9IGRlZmF1bHRDb2xvcjtcblxuICAgIGlmIChmaWx0ZXIgPT0gbnVsbCkge1xuICAgICAgYnV5V2luZG93QWxsLnN0eWxlLmNvbG9yID0gYWN0aXZlQ29sb3I7XG4gICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3N3b3JkLykpIHtcbiAgICAgIGJ1eVdpbmRvd1dlYXBvbi5zdHlsZS5jb2xvciA9IGFjdGl2ZUNvbG9yO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9oZWFkLykpIHtcbiAgICAgIGJ1eVdpbmRvd0FybW9yLnN0eWxlLmNvbG9yID0gYWN0aXZlQ29sb3I7XG4gICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3BvdGlvbi8pKSB7XG4gICAgICBidXlXaW5kb3dQb3Rpb24uc3R5bGUuY29sb3IgPSBhY3RpdmVDb2xvcjtcbiAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvbWF0ZXJpYWwvKSkge1xuICAgICAgYnV5V2luZG93TWF0ZXJpYWwuc3R5bGUuY29sb3IgPSBhY3RpdmVDb2xvcjtcbiAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvYm9vay8pKSB7XG4gICAgICBidXlXaW5kb3dCb29rLnN0eWxlLmNvbG9yID0gYWN0aXZlQ29sb3I7XG4gICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21pc2MvKSkge1xuICAgICAgYnV5V2luZG93TWlzYy5zdHlsZS5jb2xvciA9IGFjdGl2ZUNvbG9yO1xuICAgIH1cblxuICAgIGxldCBpbmRleCA9IDA7XG4gICAgbGV0IHRhYmxlID0gXCJcIjtcbiAgICBTcHJpdGUuZWFjaChpdGVtcywgZnVuY3Rpb24gKGl0ZW1Db3VudCwgaXRlbUlkKSB7XG4gICAgICBsZXQgaXRlbSA9IEdhbWUuaXRlbXNbaXRlbUlkXTtcblxuICAgICAgaWYgKGZpbHRlciAmJiBmaWx0ZXIuaW5kZXhPZihpdGVtLmRhdGEudHlwZSkgPT0gLTEpXG4gICAgICAgIHJldHVybjtcblxuICAgICAgbGV0IGxpbmUgPSBcIlwiO1xuXG4gICAgICBpZiAoc2VsZWN0ID09IGluZGV4KSB7XG4gICAgICAgIGxpbmUgKz0gYDx0ciBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IGdyZWVuO1wiPlxcbmA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsaW5lICs9IGA8dHI+XFxuYDtcbiAgICAgIH1cblxuXG4gICAgICBpZiAoaXRlbS5pY29uKSB7XG4gICAgICAgIGxpbmUgKz0gYCAgPHRkPjxpbWcgYWx0PVwiXCIgc3JjPVwiJHtpdGVtLmljb24uc3JjfVwiPjwvdGQ+XFxuYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpbmUgKz0gYCAgPHRkPiA8L3RkPlxcbmA7XG4gICAgICB9XG4gICAgICBsaW5lICs9IGAgIDx0ZD4ke2l0ZW0uZGF0YS5uYW1lfTwvdGQ+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPHRkIHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyO1wiPiR7TWF0aC5jZWlsKGl0ZW0uZGF0YS52YWx1ZSAqIDEuMil9RzwvdGQ+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPHRkIHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyO1wiPiR7aXRlbUNvdW50fTwvdGQ+XFxuYDtcbiAgICAgIGxpbmUgKz0gYCAgPHRkPiR7aXRlbS5kYXRhLmRlc2NyaXB0aW9ufTwvdGQ+XFxuYDtcblxuICAgICAgaWYgKE1hdGguY2VpbChpdGVtLmRhdGEudmFsdWUgKiAxLjIpID4gR2FtZS5oZXJvLmRhdGEuZ29sZCB8fCBpdGVtc1tpdGVtSWRdIDw9IDApIHtcbiAgICAgICAgbGluZSArPSBgICA8dGQ+PGJ1dHRvbiBkaXNhYmxlZCBzdHlsZT1cIk9wYWNpdHk6IDAuNTtcIiBjbGFzcz1cImJyb3duQnV0dG9uXCI+5Lmw5YWlPC9idXR0b24+PC90ZD5cXG5gO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGluZSArPSBgICA8dGQ+PGJ1dHRvbiBkYXRhLWlkPVwiJHtpdGVtSWR9XCIgY2xhc3M9XCJicm93bkJ1dHRvblwiPuS5sOWFpTwvYnV0dG9uPjwvdGQ+XFxuYDtcbiAgICAgIH1cblxuICAgICAgbGluZSArPSBcIjwvdHI+XFxuXCI7XG4gICAgICB0YWJsZSArPSBsaW5lO1xuICAgICAgaW5kZXgrKztcbiAgICB9KTtcblxuICAgIGJ1eVdpbmRvd1RhYmxlLmlubmVySFRNTCA9IHRhYmxlO1xuICAgIHdpbi5zaG93KCk7XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1wiZW50ZXJcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgYnV0dG9ucyA9IGJ1eVdpbmRvd1RhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b25cIik7XG4gICAgaWYgKGxhc3RTZWxlY3QgPj0gMCAmJiBsYXN0U2VsZWN0IDwgYnV0dG9ucy5sZW5ndGgpIHtcbiAgICAgIGJ1dHRvbnNbbGFzdFNlbGVjdF0uY2xpY2soKTtcbiAgICB9XG4gIH0pO1xuXG4gIHdpbi53aGVuVXAoW1widXBcIiwgXCJkb3duXCJdLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgbGV0IGNvdW50ID0gYnV5V2luZG93VGFibGUucXVlcnlTZWxlY3RvckFsbChcImJ1dHRvblwiKS5sZW5ndGg7XG4gICAgaWYgKGNvdW50IDw9IDApIHJldHVybjtcblxuICAgIGlmIChsYXN0U2VsZWN0ID09IC0xKSB7XG4gICAgICBpZiAoa2V5ID09IFwiZG93blwiKSB7XG4gICAgICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgbGFzdEZpbHRlciwgMCk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PSBcInVwXCIpIHtcbiAgICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBsYXN0RmlsdGVyLCBjb3VudCAtIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoa2V5ID09IFwiZG93blwiKSB7XG4gICAgICAgIGxldCBzZWxlY3QgPSBsYXN0U2VsZWN0ICsgMTtcbiAgICAgICAgaWYgKHNlbGVjdCA+PSBjb3VudCkge1xuICAgICAgICAgIHNlbGVjdCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBsYXN0RmlsdGVyLCBzZWxlY3QpO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT0gXCJ1cFwiKSB7XG4gICAgICAgIGxldCBzZWxlY3QgPSBsYXN0U2VsZWN0IC0gMTtcbiAgICAgICAgaWYgKHNlbGVjdCA8IDApIHtcbiAgICAgICAgICBzZWxlY3QgPSBjb3VudCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBsYXN0RmlsdGVyLCBzZWxlY3QpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgd2luLndoZW5VcChbXCJlc2NcIl0sIGZ1bmN0aW9uICgpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHdpbi5oaWRlKCk7XG4gICAgfSwgMjApO1xuICB9KTtcblxuICB3aW4ud2hlblVwKFtcImxlZnRcIiwgXCJyaWdodFwiXSwgZnVuY3Rpb24gKGtleSkge1xuICAgIGlmIChrZXkgPT0gXCJyaWdodFwiKSB7XG4gICAgICBsZXQgZmlsdGVyID0gbGFzdEZpbHRlcjtcbiAgICAgIGlmIChmaWx0ZXIgPT0gbnVsbCkge1xuICAgICAgICBmaWx0ZXIgPSBcInN3b3JkfHNwZWFyfGJvd1wiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3N3b3JkLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJoZWFkfGJvZHl8ZmVldFwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL2hlYWQvKSkge1xuICAgICAgICBmaWx0ZXIgPSBcInBvdGlvblwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL3BvdGlvbi8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwibWF0ZXJpYWxcIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9tYXRlcmlhbC8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwiYm9va3xzY3JvbGx8bGV0dGVyXCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvYm9vay8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwibWlzY1wiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21pc2MvKSkge1xuICAgICAgICBmaWx0ZXIgPSBudWxsO1xuICAgICAgfVxuICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBmaWx0ZXIpO1xuICAgIH0gZWxzZSBpZiAoa2V5ID09IFwibGVmdFwiKSB7XG4gICAgICBsZXQgZmlsdGVyID0gbGFzdEZpbHRlcjtcbiAgICAgIGlmIChmaWx0ZXIgPT0gbnVsbCkge1xuICAgICAgICBmaWx0ZXIgPSBcIm1pc2NcIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9zd29yZC8pKSB7XG4gICAgICAgIGZpbHRlciA9IG51bGw7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvaGVhZC8pKSB7XG4gICAgICAgIGZpbHRlciA9IFwic3dvcmR8c3BlYXJ8Ym93XCI7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlci5tYXRjaCgvcG90aW9uLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJoZWFkfGJvZHl8ZmVldFwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21hdGVyaWFsLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJwb3Rpb25cIjtcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyLm1hdGNoKC9ib29rLykpIHtcbiAgICAgICAgZmlsdGVyID0gXCJtYXRlcmlhbFwiO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXIubWF0Y2goL21pc2MvKSkge1xuICAgICAgICBmaWx0ZXIgPSBcImJvb2t8c2Nyb2xsfGxldHRlclwiO1xuICAgICAgfVxuICAgICAgd2luLm9wZW4obGFzdEl0ZW1zLCBmaWx0ZXIpO1xuICAgIH1cbiAgfSk7XG5cbiAgYnV5V2luZG93VGFibGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgIGxldCBpdGVtSWQgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiKTtcbiAgICBpZiAoaXRlbUlkICYmIGxhc3RJdGVtcy5oYXNPd25Qcm9wZXJ0eShpdGVtSWQpKSB7XG4gICAgICBsZXQgaXRlbSA9IEdhbWUuaXRlbXNbaXRlbUlkXTtcblxuICAgICAgR2FtZS5oZXJvLmRhdGEuZ29sZCAtPSBNYXRoLmNlaWwoaXRlbS5kYXRhLnZhbHVlICogMS4yKTtcbiAgICAgIGlmIChHYW1lLmhlcm8uZGF0YS5pdGVtc1tpdGVtSWRdKSB7XG4gICAgICAgIEdhbWUuaGVyby5kYXRhLml0ZW1zW2l0ZW1JZF0rKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIEdhbWUuaGVyby5kYXRhLml0ZW1zW2l0ZW1JZF0gPSAxO1xuICAgICAgfVxuXG4gICAgICBsYXN0SXRlbXNbaXRlbUlkXS0tO1xuXG4gICAgICBpZiAobGFzdEl0ZW1zW2l0ZW1JZF0gPT0gMCkge1xuICAgICAgICBkZWxldGUgbGFzdEl0ZW1zW2l0ZW1JZF07XG4gICAgICB9XG5cbiAgICAgIHdpbi5vcGVuKGxhc3RJdGVtcywgbGFzdEZpbHRlcik7XG4gICAgfVxuICB9KTtcblxufSkoKTtcbiJdfQ==
