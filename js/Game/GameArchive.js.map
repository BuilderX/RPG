{"version":3,"sources":["../../../src/Game/GameArchive.js"],"names":[],"mappings":"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","file":"GameArchive.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  Game.assign(\"Archive\", class GameArchive {\n\n    static remove (id) {\n      if (window.localStorage.getItem(id)) {\n        window.localStorage.removeItem(id);\n      }\n    }\n\n    // 返回所有存档，Object格式\n    static list () {\n      let keys = [];\n      for (let key in window.localStorage) {\n        if (key.match(/^SAVE_(\\d+)$/)) {\n          keys.push(parseInt(key.match(/^SAVE_(\\d+)$/)[1]));\n        }\n      }\n      keys.sort();\n      keys.reverse();\n      return keys;\n    }\n\n    // 返回最新存档，Object格式\n    static last () {\n      let list = Game.Archive.list();\n      if (list.length > 0) {\n        let last = list[0];\n        return JSON.parse(window.localStorage.getItem(`SAVE_${last}`));\n      } else {\n        return null;\n      }\n    }\n\n    static clear () {\n      for (let key in window.localStorage) {\n        if (key.match(/^SAVE_(\\d+)$/)) {\n          window.localStorage.removeItem(key);\n        }\n      }\n    }\n\n    static save (data) {\n      let now = new Date();\n      let id = now.getTime();\n\n      data.id = id;\n      data.name = data.hero.name;\n      data.date = now.toLocaleString();\n\n      window.localStorage.setItem(`SAVE_${id}`, JSON.stringify(data));\n    }\n\n    static get (id) {\n      if (id && window.localStorage.getItem(id)) {\n        return JSON.parse(window.localStorage.getItem(id));\n      }\n      return null;\n    }\n\n    static load (id) {\n      let data = Game.Archive.get(id);\n      if (!data) {\n        data = Game.Archive.last();\n      }\n\n      if (data) {\n\n        if (Game.windows.interface.showing) {\n          Game.windows.interface.hide();\n        }\n        Game.windows.main.hide();\n\n        Game.windows.loading.begin();\n\n        setTimeout(function () {\n          let heroData = data.hero;\n\n          Game.drawHero(heroData.custom).then(function (heroImage) {\n            heroData.image = heroImage;\n            Game.hero = new Game.ActorHero(heroData);\n\n            Game.hero.on(\"complete\", function () {\n\n              Game.hero.gotoArea(heroData.area, heroData.x, heroData.y);\n\n            });\n\n          });\n        }, 20);\n\n      } else {\n        console.error(\"id:\", id);\n        throw new Error(\"Invalid id, Game.Archive.load\");\n      }\n    }\n\n  });\n\n})();\n"]}