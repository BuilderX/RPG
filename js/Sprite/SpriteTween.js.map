{"version":3,"sources":["../../../src/Sprite/SpriteTween.js"],"names":[],"mappings":"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","file":"SpriteTween.js","sourcesContent":["/*\n\n2D Game Sprite Library, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n/*\n\nSprite.Tween.get(Game.hero)\n.promise(function () {\n  return new Promise(function (resolve) {\n    Game.hero.goto(Game.hero.x, Game.hero.y + 5,\"walk\", resolve);\n  })\n})\n.wait(2000)\n.promise(function () {\n  return new Promise(function (resolve) {\n    Game.hero.goto(Game.hero.x + 5, Game.hero.y, \"walk\", resolve);\n  })\n})\n.to({alpha: 0}, 500)\n.wait(500)\n.to({alpha: 1}, 500)\n.call(function () {\n  Game.popup(Game.hero.sprite, \"hello\", 0, -50);\n})\n.wait(2000)\n.call(function () {\n  console.log(\"ok\");\n});\n\n\n*/\n\n\n/**\n * @fileoverview Sprite.Tween\n * @author mail@qhduan.com (QH Duan)\n */\n\n(function () {\n \"use strict\";\n\n  let internal = Sprite.Namespace();\n\n  Sprite.assign(\"Tween\", class SpriteTween extends Sprite.Event {\n\n    static get (object) {\n      return new Sprite.Tween(object);\n    }\n\n    constructor (object) {\n      super();\n      let privates = internal(this);\n      privates.object = object;\n      privates.callback = null;\n      privates.action = [];\n      privates.doing = false;\n    }\n\n    nextAction () {\n      let privates = internal(this);\n      if (privates.doing == false && privates.action.length > 0) {\n        let action = privates.action[0];\n        privates.action.splice(0, 1);\n        switch (action.type) {\n          case \"to\":\n            this.toAction(action.attributes, action.time);\n            break;\n          case \"wait\":\n            this.waitAction(action.time);\n            break;\n          case \"call\":\n            this.callAction(action.callback);\n            break;\n          case \"promise\":\n            this.promiseAction(action.callback);\n            break;\n          default:\n            console.error(action);\n            throw new Error(\"Sprite.Tween got invalid action\");\n        }\n      }\n    }\n\n    toAction (attributes, time) {\n      let privates = internal(this);\n      privates.doing = true;\n\n      let splice = Math.min(100, time);\n      let t = time / splice;\n      let step = {};\n\n      for (let key in attributes) {\n        if (Number.isFinite(attributes[key])) {\n          step[key] = attributes[key] - privates.object[key];\n          step[key] /= splice;\n        }\n      }\n\n      let count = 0;\n      let inter = setInterval(() => {\n        count++;\n        if (count >= splice) {\n          for (let key in attributes) {\n            privates.object[key] = attributes[key];\n          }\n          clearInterval(inter);\n          privates.doing = false;\n          this.nextAction();\n        } else {\n          for (let key in step) {\n            privates.object[key] += step[key];\n          }\n        }\n      }, t);\n    }\n\n    to (attributes, time) {\n      internal(this).action.push({\n        type: \"to\",\n        attributes: attributes,\n        time: time\n      });\n      this.nextAction();\n      return this;\n    }\n\n    promiseAction (callback) {\n      this.doing = true;\n      callback().then(() => {\n        this.doing = false;\n        this.nextAction();\n      });\n    }\n\n    promise (callback) {\n      internal(this).action.push({\n        type: \"promise\",\n        callback: callback\n      });\n      this.nextAction();\n      return this;\n    }\n\n    callAction (callback) {\n      this.doing = true;\n      callback();\n      this.doing = false;\n      this.nextAction();\n    }\n\n    call (callback) {\n      internal(this).action.push({\n        type: \"call\",\n        callback: callback\n      });\n      this.nextAction();\n      return this;\n    }\n\n    waitAction (time) {\n      let privates = internal(this);\n      privates.doing = true;\n      setTimeout(() => {\n        privates.doing = false;\n        this.nextAction();\n      }, time);\n    }\n\n    wait (time) {\n      internal(this).action.push({\n        type: \"wait\",\n        time: time\n      });\n      this.nextAction();\n      return this;\n    }\n  });\n\n})();\n"]}