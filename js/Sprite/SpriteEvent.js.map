{"version":3,"sources":["src/Sprite/SpriteEvent.js"],"names":[],"mappings":"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","file":"src/Sprite/SpriteEvent.js","sourcesContent":["/*\n\n2D Game Sprite Library, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n/**\n * @fileoverview Class Sprite.Event\n * @author mail@qhduan.com (QH Duan)\n */\n\n(function () {\n \"use strict\";\n\n  let internal = Sprite.Namespace();\n\n  /**\n   * Class Sprite.Event, hold all events emit, bubble\n   * @class\n   */\n  Sprite.assign(\"Event\", class SpriteEvent {\n    /**\n     * construct Sprite.Event\n     * @constructor\n     */\n    constructor () {\n      let privates = internal(this);\n      /**\n       * Contain all event and its' listeners\n       @type {Object}\n       @private\n       */\n      privates.listeners = new Map();\n      /**\n       * Contain an event is once or not\n       * @type {Object}\n       * @private\n       */\n      privates.once = new Map();\n      /**\n       * Parent of this object\n       * @type {Object}\n       */\n      privates.parent = null;\n    }\n    /**\n     * @return {Object} parent we hold, an object or null\n     */\n    get parent () {\n      let privates = internal(this);\n      return privates.parent;\n    }\n    /**\n     * Set parent of object\n     * @param {Object} value New parent value, or null\n     */\n    set parent (value) {\n      let privates = internal(this);\n      privates.parent = value;\n    }\n    /**\n     * Register an event\n     * @param {string} event The event type, eg. \"click\"\n     * @param {function} listener The callback function when event fired\n     */\n    on (event, listener) {\n      let privates = internal(this);\n      // If event is an once event, when some client register this event after event fired, we just return it\n      if (privates.once.has(event)) {\n        listener({\n          type: event,\n          target: this,\n          data: privates.once.get(event)\n        });\n        return null;\n      } else {\n        if (privates.listeners.has(event) == false) {\n          privates.listeners.set(event, new Map());\n        }\n\n        let id = Sprite.uuid();\n        privates.listeners.get(event).set(id, listener);\n        return id;\n      }\n    }\n    /**\n     * Remove an event Register\n     * @param {string} event The event type you want to remove. eg. \"click\"\n     * @param {string} id The id of event, the id is what returned by \"on\" function\n     */\n    off (event, id) {\n      let privates = internal(this);\n      if (privates.listeners.has(event) && privates.listeners.get(event).has(id)) {\n        privates.listeners.get(event).delete(id);\n        if (privates.listeners.get(event).size <= 0) {\n          privates.listeners.delete(event);\n        }\n        return true;\n      }\n      return false;\n    }\n    /**\n     * Fire an event from children\n     * @param {string} event Event type\n     * @param {Object} target Event target\n     * @param {Object} data Data\n     */\n    emitBubble (event, target, data) {\n      let privates = internal(this);\n      let bubble = true;\n\n      if (privates.listeners.has(event)) {\n        for (let listener of privates.listeners.get(event).values()) {\n          if (listener({ type: event, target: target, data: data }) === false) {\n            // If client return just \"false\", stop propagation\n            bubble = false;\n          }\n        }\n      }\n\n      if (privates.parent && bubble == true) {\n        privates.parent.emitBubble(event, target, data);\n      }\n    }\n    /**\n     * Fire an event\n     * @param {string} event The event type you want to fire\n     * @param {boolean} once Whether or not the event is once, if true, the event fire should only once, like \"complete\"\n     * @param {Object} data The data to listener, undefined or null is OK\n     */\n    emit (event, once, data) {\n      let privates = internal(this);\n      if (once) {\n        if (typeof data != \"undefined\") {\n          privates.once.set(event, data);\n        } else {\n          privates.once.set(event, null);\n        }\n      }\n\n      // wheter or not bubble the event, default true\n      let bubble = true;\n\n      if (privates.listeners.has(event)) {\n        for (let listener of privates.listeners.get(event).values()) {\n          if (listener({ type: event, target: this, data: data }) === false) {\n            // If client return just \"false\", stop propagation\n            bubble = false;\n          }\n        }\n      }\n\n      if (privates.parent && bubble == true) {\n        privates.parent.emitBubble(event, this, data);\n      }\n    }\n  });\n\n\n})();\n"]}