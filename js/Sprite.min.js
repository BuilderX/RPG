"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"assign",value:function(a,b){return Object.defineProperty(this,a,{enumerable:!1,configurable:!1,writable:!1,value:b}),this}}]),a}(),b=window.Sprite=new a;b.assign("Namespace",function(){var a=new WeakMap;return function(b){return 0==a.has(b)&&a.set(b,{}),a.get(b)}}),b.assign("rand",function(a,b){var c=b-a;return c*=Math.random(),a+Math.floor(c)}),b.assign("copy",function(a){return JSON.parse(JSON.stringify(a))}),b.assign("each",function(a,b){if(a.forEach)a.forEach(b);else for(var c in a)b(a[c],c,a)}),b.assign("uuid",function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/x|y/g,function(a){var b=Math.floor(16*Math.random());return"x"==a?b.toString(16):(3&b|8).toString(16)})}),b.assign("btoa",function(a){return window.btoa(unescape(encodeURIComponent(a)))}),b.assign("atob",function(a){return decodeURIComponent(escape(window.atob(a)))})}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=Sprite.Namespace();Sprite.assign("Canvas",function(){function b(c,d){_classCallCheck(this,b);var e=a(this),f=document.createElement("canvas");f.width=c||640,f.height=d||480;var g=f.getContext("2d");if(!g)throw new Error("Sprite.Canvas canvas is not supported");console.log("canvas inited"),e.color="#000000",e.canvas=f,e.context=g,e.alpha=1,e.filter=new Map,this.filter("brightness",0),this.filter("contrast",0)}return _createClass(b,null,[{key:"support",value:function(){var a=document.createElement("canvas"),b=a.getContext("2d");return b?!0:!1}}]),_createClass(b,[{key:"filter",value:function(b,c){var d=a(this);return Number.isFinite(c)?("brightness"==b&&(c+=1),"contrast"==b&&(c+=1),d.filter.get(b)!=c&&!function(){d.filter.set(b,c);var a=[];d.filter.forEach(function(b,c,d){a.push(c+"("+b+")")}),a=a.join(" "),d.canvas.style.filter=a,d.canvas.style.webkitFilter=a}(),void 0):d.filter.get(b)}},{key:"drawImage",value:function(){var b=a(this);b.context.globalAlpha=this.alpha,b.context.drawImage.apply(b.context,arguments)}},{key:"release",value:function(){}},{key:"clear",value:function(){var b=a(this);b.context.fillStyle=b.color,b.context.fillRect(0,0,this.width,this.height)}},{key:"color",get:function(){return a(this).color},set:function(b){if(!b.match(/^#([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])$/))throw console.error(b,this),new Error("Sprite.Canvas invalid color value");a(this).color=b}},{key:"alpha",get:function(){return a(this).alpha},set:function(b){if(!(Number.isFinite(b)&&b>=0&&1>=b))throw console.error(b,this),new Error("Sprite.Canvas got invalid alpha number");a(this).alpha=b}},{key:"width",get:function(){return a(this).canvas.width},set:function(b){if(!(Number.isFinite(b)&&b>0&&1e4>b))throw console.error(b,this),new Error("Sprite.Canvas got invalid width number");a(this).canvas.width=b}},{key:"height",get:function(){return a(this).canvas.height},set:function(b){var c=a(this);if(!(Number.isFinite(b)&&b>0&&1e4>b))throw console.error(b,this),new Error("Sprite.Canvas got invalid height number");b!=c.canvas.height&&(c.canvas.height=b)}},{key:"canvas",get:function(){return a(this).canvas},set:function(a){throw new Error("Sprite.Canvas.canvas cannot write")}}]),b}())}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){function a(a){return a>0&&0===(a-1&a)}var b=Sprite.Namespace(),c="\n  precision mediump float;\n  attribute vec2 a_texCoord;\n  varying vec2 texCoord;\n\n  attribute vec2 aVertex;\n  uniform vec2 resolution;\n\n  uniform vec4 position;\n\n  void main(void) {\n     vec2 a = aVertex * (position.zw / resolution) + (position.xy / resolution);\n     vec2 b = a * 2.0 - 1.0;\n\n     gl_Position = vec4(b * vec2(1.0, -1.0), 0.0, 1.0);\n     texCoord = a_texCoord;\n  }",d="\n  precision mediump float;\n\n  uniform vec4 crop;\n  uniform float brightness;\n  uniform float alpha;\n  uniform float contrast;\n\n  uniform sampler2D image;\n\n  // the texCoords passed in from the vertex shader.\n  varying vec2 texCoord;\n\n  void main(void) {\n\n     vec4 color = texture2D(image,\n       vec2(texCoord.x * crop.z, texCoord.y * crop.w) + crop.xy).rgba;\n\n     if (contrast != 0.0) {\n       if (contrast > 0.0) {\n         color.xyz = (color.xyz - 0.5) / (1.0 - contrast) + 0.5;\n       } else {\n         color.xyz = (color.xyz - 0.5) * (1.0 + contrast) + 0.5;\n       }\n     }\n\n     if (brightness != 0.0) {\n       color.xyz += brightness;\n     }\n     if (alpha != 1.0) {\n       color.a *=  alpha;\n     }\n\n     gl_FragColor = color;\n  }";Sprite.assign("Webgl",function(){function e(a,f){_classCallCheck(this,e);var g=b(this),h=document.createElement("canvas");h.width=a||640,h.height=f||480;var i={antialias:!1,preserveDrawingBuffer:!0},j=h.getContext("webgl",i);if(j||(j=h.getContext("experimental-webgl",i)),g.gl=j,!j)throw new Error("Sprite.Webgl webgl is not supported");g.color=[0,0,0],g.filter=new Map,g.textureCache=new Map,g.canvas=h,g.maxTextureSize=j.getParameter(j.MAX_TEXTURE_SIZE),j.viewport(0,0,h.width,h.height);var k=j.createShader(j.VERTEX_SHADER),l=j.createShader(j.FRAGMENT_SHADER);j.shaderSource(k,c),j.shaderSource(l,d),j.compileShader(k),j.compileShader(l);var m=j.createProgram();j.attachShader(m,k),j.attachShader(m,l),j.linkProgram(m),j.useProgram(m),j.cullFace(j.BACK),j.frontFace(j.CW),j.enable(j.CULL_FACE),j.enable(j.BLEND),j.disable(j.DEPTH_TEST),j.blendFunc(j.SRC_ALPHA,j.ONE_MINUS_SRC_ALPHA),g.cropLoc=j.getUniformLocation(m,"crop"),g.brightnessLoc=j.getUniformLocation(m,"brightness"),g.contrastLoc=j.getUniformLocation(m,"contrast"),g.alphaLoc=j.getUniformLocation(m,"alpha"),g.resolutionLoc=j.getUniformLocation(m,"resolution"),j.uniform2f(g.resolutionLoc,h.width,h.height),g.positionLoc=j.getUniformLocation(m,"position"),g.tLoc=j.getAttribLocation(m,"a_texCoord"),j.enableVertexAttribArray(g.tLoc),g.texCoordBuffer=j.createBuffer(),j.bindBuffer(j.ARRAY_BUFFER,g.texCoordBuffer),j.vertexAttribPointer(g.tLoc,2,j.FLOAT,!1,0,0),j.bufferData(j.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),j.STATIC_DRAW),g.vLoc=j.getAttribLocation(m,"aVertex"),j.enableVertexAttribArray(g.vLoc),g.vertexBuff=j.createBuffer(),j.bindBuffer(j.ARRAY_BUFFER,g.vertexBuff),j.bufferData(j.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),j.STATIC_DRAW),j.enableVertexAttribArray(g.vLoc),j.vertexAttribPointer(g.vLoc,2,j.FLOAT,!1,0,0),g.currentTexture=null,this.filter("brightness",0),this.filter("contrast",0),this.alpha=1,console.log("webgl inited. max texture size: %d",j.getParameter(j.MAX_TEXTURE_SIZE))}return _createClass(e,null,[{key:"support",value:function(){var a=document.createElement("canvas"),b=a.getContext("webgl");return b||a.getContext("experimental-webgl"),b?!0:!1}}]),_createClass(e,[{key:"drawImage9",value:function(a,c,d,e,f,g,h,i,j){var k=b(this),l=k.gl,m=this.createTexture(l,a);k.currentTexture!=m&&(l.bindTexture(l.TEXTURE_2D,m),k.currentTexture=m),l.uniform4f(k.cropLoc,c/a.width,d/a.height,e/a.width,f/a.height),l.uniform4f(k.positionLoc,g,h,i,j),l.drawArrays(l.TRIANGLE_FAN,0,4)}},{key:"release",value:function(){var a=b(this),c=!0,d=!1,e=void 0;try{for(var f,g=a.textureCache.values()[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;a.gl.deleteTexture(h)}}catch(i){d=!0,e=i}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}a.textureCache=new Map}},{key:"createTexture",value:function(c,d){var e=b(this);if(e.textureCache.has(d))return e.textureCache.get(d);c.activeTexture(c.TEXTURE0);var f=c.createTexture();return c.bindTexture(c.TEXTURE_2D,f),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),a(d.width)&&a(d.height)?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.generateMipmap(c.TEXTURE_2D)):c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.bindTexture(c.TEXTURE_2D,null),e.textureCache.set(d,f),f}},{key:"drawImage",value:function(a,b,c,d,e,f,g,h,i){if(9==arguments.length);else if(5==arguments.length)f=b,g=c,h=d,i=e,b=0,c=0,d=a.width,e=a.height;else{if(3!=arguments.length)throw console.error(arguments,this),new Error("Sprite.Webgl.drawImage invalid arguments");f=b,g=c,h=a.width,i=a.height,b=0,c=0,d=a.width,e=a.height}this.drawImage9(a,b,c,d,e,f,g,h,i)}},{key:"filter",value:function(a,c){var d=b(this),e=d.gl;return Number.isFinite(c)?(d.filter.set(a,c),e.uniform1f(d.brightnessLoc,d.filter.get("brightness")),e.uniform1f(d.contrastLoc,d.filter.get("contrast")),void 0):d.get(a)}},{key:"clear",value:function(){var a=b(this),c=a.gl,d=a.color;c.clearColor(d[0],d[1],d[2],1),c.clear(c.COLOR_BUFFER_BIT)}},{key:"alpha",get:function(){var a=b(this);return a.alpha},set:function(a){var c=b(this),d=c.gl;if(!(Number.isFinite(a)&&!isNaN(a)&&a>=0&&1>=a))throw console.error(a,this),new Error("Sprite.Webgl got invalid alpha number");a!=c.alpha&&(c.alpha=a,d.uniform1f(c.alphaLoc,c.alpha))}},{key:"color",get:function(){var a=b(this),c=a.color,d=c[0].toString(16),e=c[1].toString(16),f=c[2].toString(16);return d.length<2&&(d="0"+d),e.length<2&&(e="0"+e),f.length<2&&(f="0"+f),"#"+d+e+f},set:function(a){var c=b(this),d=a.match(/^#([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])$/);if(!d)throw console.error(a,this),new Error("Sprite.Webgl.color invalid color format");var e=d[1],f=d[2],g=d[3];c.color[0]=parseInt(e,16),c.color[1]=parseInt(f,16),c.color[2]=parseInt(g,16)}},{key:"width",get:function(){var a=b(this);return a.canvas.width},set:function(a){var c=b(this);if(!(Number.isFinite(a)&&!isNaN(a)&&a>0&&4096>=a))throw console.error(a,this),new Error("Sprite.Webgl got invalid width number");a!=c.canvas.width&&(c.canvas.width=a,c.gl.viewport(0,0,c.canvas.width,c.canvas.height),c.gl.uniform2f(c.resolutionLoc,c.canvas.width,c.canvas.height))}},{key:"height",get:function(){var a=b(this);return a.canvas.height},set:function(a){var c=b(this);if(!(Number.isFinite(a)&&!isNaN(a)&&a>0&&4096>=a))throw console.error(a,this),new Error("Sprite.Webgl got invalid height number");a!=c.canvas.height&&(c.canvas.height=a,c.gl.viewport(0,0,c.canvas.width,c.canvas.height),c.gl.uniform2f(resolutionLoc,c.canvas.width,c.canvas.height))}},{key:"canvas",get:function(){return b(this).canvas},set:function(a){throw console.error(a,this),new Error("Sprite.Webgl.canvas cannot write")}}]),e}())}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=Sprite.Namespace();Sprite.assign("Event",function(){function b(){_classCallCheck(this,b);var c=a(this);c.listeners=new Map,c.once=new Map,c.parent=null}return _createClass(b,[{key:"on",value:function(b,c){var d=a(this);if(d.once.has(b))return c({type:b,target:this,data:d.once.get(b)}),null;0==d.listeners.has(b)&&d.listeners.set(b,new Map);var e=Sprite.uuid();return d.listeners.get(b).set(e,c),e}},{key:"off",value:function(b,c){var d=a(this);return d.listeners.has(b)&&d.listeners.get(b).has(c)?(d.listeners.get(b)["delete"](c),d.listeners.get(b).size<=0&&d.listeners["delete"](b),!0):!1}},{key:"emitBubble",value:function(b,c,d){var e=a(this),f=!0;if(e.listeners.has(b)){var g=!0,h=!1,i=void 0;try{for(var j,k=e.listeners.get(b).values()[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value;l({type:b,target:c,data:d})===!1&&(f=!1)}}catch(m){h=!0,i=m}finally{try{!g&&k["return"]&&k["return"]()}finally{if(h)throw i}}}e.parent&&1==f&&e.parent.emitBubble(b,c,d)}},{key:"emit",value:function(b,c,d){var e=a(this);c&&("undefined"!=typeof d?e.once.set(b,d):e.once.set(b,null));var f=!0;if(e.listeners.has(b)){var g=!0,h=!1,i=void 0;try{for(var j,k=e.listeners.get(b).values()[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value;l({type:b,target:this,data:d})===!1&&(f=!1)}}catch(m){h=!0,i=m}finally{try{!g&&k["return"]&&k["return"]()}finally{if(h)throw i}}}e.parent&&1==f&&e.parent.emitBubble(b,this,d)}},{key:"parent",get:function(){var b=a(this);return b.parent},set:function(b){var c=a(this);c.parent=b}}]),b}())}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};!function(){var a=Sprite.Namespace();Sprite.assign("Tween",function(b){function c(b){_classCallCheck(this,c),_get(Object.getPrototypeOf(c.prototype),"constructor",this).call(this);var d=a(this);d.object=b,d.callback=null,d.action=[],d.doing=!1}return _inherits(c,b),_createClass(c,null,[{key:"get",value:function(a){return new Sprite.Tween(a)}}]),_createClass(c,[{key:"nextAction",value:function(){var b=a(this);if(0==b.doing&&b.action.length>0){var c=b.action[0];switch(b.action.splice(0,1),c.type){case"to":this.toAction(c.attributes,c.time);break;case"wait":this.waitAction(c.time);break;case"call":this.callAction(c.callback);break;case"promise":this.promiseAction(c.callback);break;default:throw console.error(c),new Error("Sprite.Tween got invalid action")}}}},{key:"toAction",value:function(b,c){var d=this,e=a(this);e.doing=!0;var f=Math.min(100,c),g=c/f,h={};for(var i in b)Number.isFinite(b[i])&&(h[i]=b[i]-e.object[i],h[i]/=f);var j=0,k=setInterval(function(){if(j++,j>=f){for(var a in b)e.object[a]=b[a];clearInterval(k),e.doing=!1,d.nextAction()}else for(var a in h)e.object[a]+=h[a]},g)}},{key:"to",value:function(b,c){return a(this).action.push({type:"to",attributes:b,time:c}),this.nextAction(),this}},{key:"promiseAction",value:function(a){var b=this;this.doing=!0,a().then(function(){b.doing=!1,b.nextAction()})}},{key:"promise",value:function(b){return a(this).action.push({type:"promise",callback:b}),this.nextAction(),this}},{key:"callAction",value:function(a){this.doing=!0,a(),this.doing=!1,this.nextAction()}},{key:"call",value:function(b){return a(this).action.push({type:"call",callback:b}),this.nextAction(),this}},{key:"waitAction",value:function(b){var c=this,d=a(this);d.doing=!0,setTimeout(function(){d.doing=!1,c.nextAction()},b)}},{key:"wait",value:function(b){return a(this).action.push({type:"wait",time:b}),this.nextAction(),this}}]),c}(Sprite.Event))}(),function(){function a(d,e,f){var g=null;if(d.match(/js$/))g="js";else if(d.match(/jpg$|jpeg$|png$|bmp$|gif$/i))g="image";else if(d.match(/wav$|mp3$|ogg$/i))g="audio";else{if(!d.match(/json$/i))throw console.error(d),new Error("Fetch got an invalid url");g="json"}var h=function(a){if(b.set(d,a),"json"==g&&(a=Sprite.copy(a)),e&&e(a),c.has(d)){var f=c.get(d),h=!0,i=!1,j=void 0;try{for(var k,l=f[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m&&m(a)}}catch(n){i=!0,j=n}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}c["delete"](d)}};if(b.has(d))return void h(b.get(d));if(c.has(d))return void c.get(d).push(e);c.set(d,[]);var i=new XMLHttpRequest;switch(i.open("GET",d,!0),i.timeout=15e3,g){case"js":i.responseType="text";break;case"image":i.responseType="blob";break;case"audio":i.responseType="blob";break;case"json":i.responseType="json";break;default:throw console.error(g,d),new Error("Fetch something wrong")}"function"!=typeof e&&(e=function(){}),i.ontimeout=function(){if(f)throw console.error(d),new Error("Sprite.Loader.Fetch timeout twice");a(d,e,!0)};var j=!1;i.onreadystatechange=function(){if(4==i.readyState&&!j){if(j=!0,!i.response)throw console.error(i.response,i.readyState,i.status,i.statusText),new Error("Sprite.Loader.Fetch Error");if("js"==g){var a=null;try{a=new Function(i.response)}catch(b){throw console.error(i.response,d),b}h(a)}else if("image"==g)!function(){var a=i.response,b=new Image;b.onload=function(){b.onload=null,h(b)},b.src=window.URL.createObjectURL(a)}();else if("audio"==g)!function(){var a=i.response,b=new Audio;b.oncanplay=function(){b.oncanplay=null,h(b)},b.src=window.URL.createObjectURL(a)}();else if("json"==g){var c=i.response;if(!c)throw console.error(d),new Error("Sprite.Loader invalid json");h(c)}}},i.send()}var b=(Sprite.Namespace(),new Map),c=new Map;Sprite.assign("load",function(){var b=Array.prototype.slice.call(arguments);return new Promise(function(c,d){var e=[],f=!0,g=!1,h=void 0;try{for(var i,j=b[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value;if("string"==typeof k)e.push(k);else{if(!(k instanceof Array))throw console.error(k,b),new Error("Sprite.load got invalid argument");var l=!0,m=!1,n=void 0;try{for(var o,p=k[Symbol.iterator]();!(l=(o=p.next()).done);l=!0){var q=o.value;e.push(q)}}catch(r){m=!0,n=r}finally{try{!l&&p["return"]&&p["return"]()}finally{if(m)throw n}}}}}catch(r){g=!0,h=r}finally{try{!f&&j["return"]&&j["return"]()}finally{if(g)throw h}}var s=0,t=[];t.length=e.length;var u=function(){s++,s>=t.length&&c(t)};e.forEach(function(b,c){a(b,function(a){t[c]=a,u()})})})})}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};!function(){var a=0,b=function(b){function c(){_classCallCheck(this,c),_get(Object.getPrototypeOf(c.prototype),"constructor",this).call(this),this.tick()}return _inherits(c,b),_createClass(c,[{key:"tick",value:function(){var b=this;a++,this.emit("tick",!1,a),window.requestAnimationFrame(function(){b.tick()})}},{key:"after",value:function(a,b){var c=this,d=0,e=this.on("tick",function(){d++,d>=a&&(c.off("tick",e),b&&b())});return e}},{key:"clearAfter",value:function(a){this.off("tick",a)}},{key:"whiles",value:function(a,b){var c=this,d=0,e=this.on("tick",function(){d++,d>=a?(b&&b(!0),c.off("tick",e)):b&&b(!1)});return e}},{key:"clearWhiles",value:function(a){this.off("tick",a)}}]),c}(Sprite.Event);Sprite.assign("Ticker",new b)}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};!function(){var a=Sprite.Namespace(),b=document.createElement("canvas");b.width=1,b.height=1;var c=b.getContext("2d");c.clearRect(0,0,1,1);var d=c.getImageData(0,0,1,1).data;Sprite.assign("Display",function(b){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this);var b=a(this);b.x=0,b.y=0,b.centerX=0,b.centerY=0,b.alpha=1,b.visible=!0,b.width=0,b.height=0}return _inherits(e,b),_createClass(e,[{key:"draw",value:function(a){throw console.error("sub-class should override this function"),new Error("Invalid call Sprite.Display.draw")}},{key:"hitTest",value:function(a,b){c.clearRect(0,0,1,1),c.save(),c.translate(-a,-b),this.draw(c),c.restore();var e=c.getImageData(0,0,1,1).data;return d[0]!=e[0]||d[1]!=e[1]||d[2]!=e[2]?!0:!1}},{key:"drawPosition",value:function(){for(var a=this.centerX,b=this.centerY,c=this.x,d=this.y,e=this.alpha,f=this.parent;f;){if(a+=f.centerX,b+=f.centerY,c+=f.x,d+=f.y,e*=f.alpha,.001>=e)return null;if(0==f.visible)return null;f=f.parent}return{x:c-a,y:d-b,alpha:e}}},{key:"drawImage",value:function(a,b,c,d,e,f){if(!(1!=this.visible||this.alpha<.01)){var g=this.drawPosition();if(g){a.alpha=g.alpha;try{a.drawImage(b,c,d,e,f,g.x,g.y,e,f)}catch(h){throw console.error(b,c,d,e,f,g.x,g.y,e,f),h}}}}},{key:"width",get:function(){return a(this).width},set:function(b){a(this).width=b}},{key:"height",get:function(){return a(this).height},set:function(b){a(this).height=b}},{key:"x",get:function(){return a(this).x},set:function(b){var c=a(this);if(!Number.isFinite(b))throw console.error(b,this),new Error("Sprite.Display.set x : invalid argument");b!=c.x&&(c.x=Math.floor(b),this.emit("change"))}},{key:"y",get:function(){return a(this).y},set:function(b){var c=a(this);if(!Number.isFinite(b))throw console.error(b,this),new Error("Sprite.Display.set y : invalid argument");b!=c.y&&(c.y=Math.floor(b),this.emit("change"))}},{key:"centerX",get:function(){return a(this).centerX},set:function(b){var c=a(this);if(!Number.isFinite(b))throw console.error(b,this),new Error("Sprite.Display.set centerX : invalid argument");b!=c.centerX&&(c.centerX=Math.floor(b),this.emit("change"))}},{key:"centerY",get:function(){return a(this).centerY},set:function(b){var c=a(this);if(!Number.isFinite(b))throw console.error(b,this),new Error("Sprite.Display.set centerY : invalid argument");b!=c.centerY&&(c.centerY=Math.floor(b),this.emit("change"))}},{key:"alpha",get:function(){var b=a(this);return b.alpha},set:function(b){var c=a(this);if(!Number.isFinite(b)||!(b>=0||1>=b))throw console.error(b,this),new Error("Sprite.Display.set alpha : invalid argument");b!=c.alpha&&(c.alpha=b,this.emit("change"))}},{key:"visible",get:function(){var b=a(this);return b.visible},set:function(b){var c=a(this);b!=c.visible&&(c.visible=b,this.emit("change"))}}]),e}(Sprite.Event))}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};!function(){var a=Sprite.Namespace();Sprite.assign("Container",function(b){function c(){_classCallCheck(this,c),_get(Object.getPrototypeOf(c.prototype),"constructor",this).call(this);var b=a(this);b.children=[],b.cacheCanvas=null}return _inherits(c,b),_createClass(c,[{key:"findMinMax",value:function(){var a=null,b=null,c=null,d=null,e=!0,f=!1,g=void 0;try{for(var h,i=this.children[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;if(j.findMinMax){var k=j.findMinMax();(null===a||a>k.minX)&&(a=k.minX),(null===b||b>k.minY)&&(b=k.minY),(null===c||c<k.maxX)&&(c=k.maxX),(null===d||d<k.maxY)&&(d=k.maxY)}else(null===a||a>j.x)&&(a=j.x),(null===b||b>j.y)&&(b=j.y),j.width&&j.height&&((null===c||c<j.x+j.width)&&(c=j.x+j.width),(null===d||d<j.y+j.height)&&(d=j.y+j.height))}}catch(l){f=!0,g=l}finally{try{!e&&i["return"]&&i["return"]()}finally{if(f)throw g}}return{minX:a,minY:b,maxX:c,maxY:d}}},{key:"clearCache",value:function(){var b=a(this);b.cacheCanvas=null,b.cacheX&&delete b.cacheX,b.cacheY&&delete b.cacheY,b.cacheWidth&&delete b.cacheWidth,b.cacheHeight&&delete b.cacheHeight}},{key:"cache",value:function(b,c,d,e){var f=a(this);f.cacheCanvas&&this.clearCache();var g=this.parent;this.parent=null;var h=this.findMinMax();if(!(h&&Number.isFinite(h.minX)&&Number.isFinite(h.minY)&&Number.isFinite(h.maxX)&&Number.isFinite(h.maxY)))throw console.error(h),new Error("Sprite.Container.cache cannot work something wrong");var i=h.maxX-h.minX,j=h.maxY-h.minY,k=document.createElement("canvas");k.width=i,k.height=j;var l=k.getContext("2d");l.save(),l.translate(-h.minX,-h.minY),this.draw(l),l.restore(),f.cacheX=h.minX,f.cacheY=h.minY,f.cacheWidth=i,f.cacheHeight=j,f.cacheCanvas=k,this.parent=g}},{key:"hitTest",value:function(b,d){a(this);if(this.cacheCanvas)return _get(Object.getPrototypeOf(c.prototype),"hitTest",this).call(this,b,d);var e=[],f=!0,g=!1,h=void 0;try{for(var i,j=this.children[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value,l=k.hitTest(b,d);l instanceof Array?e=e.concat(l):l===!0&&e.push(k)}}catch(m){g=!0,h=m}finally{try{!f&&j["return"]&&j["return"]()}finally{if(g)throw h}}return e}},{key:"draw",value:function(b){var c=a(this);if(!(this.alpha<.01||1!=this.visible))if(this.cacheCanvas){var d=this.x,e=this.y;this.x+=c.cacheX,this.y+=c.cacheY,this.drawImage(b,this.cacheCanvas,0,0,this.cacheCanvas.width,this.cacheCanvas.height),this.x=d,this.y=e}else if(this.children.length>0){var f=!0,g=!1,h=void 0;try{for(var i,j=this.children[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value;1==k.visible&&k.alpha>=.01&&k.draw(b)}}catch(l){g=!0,h=l}finally{try{!f&&j["return"]&&j["return"]()}finally{if(g)throw h}}}}},{key:"hasChild",value:function(a){return-1!=this.children.indexOf(a)?!0:!1}},{key:"appendChild",value:function(){var a=Array.prototype.slice.call(arguments);if(a.length<=0)throw new Error("Sprite.Container.appendChild got an invalid arguments");var b=!0,c=!1,d=void 0;try{for(var e,f=a[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;if(g instanceof Sprite.Display==0)throw console.error(g),new Error("Sprite.Container.appendChild only accept Sprite.Display or it's sub-class");g.parent=this,this.children.push(g)}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}this.emit("addedChildren")}},{key:"appendChildAt",value:function(){var a=Array.prototype.slice.call(arguments);if(a.length<=1)throw console.log(arguments,this),new TypeError("Sprite.Container.appendChildAt has an invalid arguments");for(var b=a[0],c=1,d=a.length;d>c;c++){if(a[c]instanceof Sprite.Display==0)throw console.error(a[c]),new Error("Sprite.Container.appendChildAt only can accept Sprite.Display or it's sub-class");a[c].parent=this,this.children.splice(b,0,a[c])}this.emit("addedChildren")}},{key:"removeChild",value:function(a){var b=this.children.indexOf(a);
return-1!=b?(this.children[b].parent=null,this.children.splice(b,1),this.emit("removedChildren"),!0):!1}},{key:"clear",value:function(){var b=a(this),c=!0,d=!1,e=void 0;try{for(var f,g=b.children[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;h.parent=null}}catch(i){d=!0,e=i}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}b.children=[],this.clearCache(),this.emit("removedChildren")}},{key:"children",get:function(){return a(this).children},set:function(a){throw new Error("Sprite.Container.children readonly")}},{key:"cacheCanvas",get:function(){return a(this).cacheCanvas},set:function(a){throw new Error("Sprite.Container.cacheCanvas readonly")}},{key:"cacheX",get:function(){return a(this).cacheX},set:function(a){throw new Error("Sprite.Container.cacheX readonly")}},{key:"cacheY",get:function(){return a(this).cacheY},set:function(a){throw new Error("Sprite.Container.cacheY readonly")}}]),c}(Sprite.Display))}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};!function(){var a=Sprite.Namespace();Sprite.assign("Stage",function(b){function c(b,d){_classCallCheck(this,c),_get(Object.getPrototypeOf(c.prototype),"constructor",this).call(this);var e=a(this);if(!e.renderer&&Sprite.Webgl.support()&&(e.renderer=new Sprite.Webgl(b,d),e.rendererType="webgl"),!e.renderer&&Sprite.Canvas.support()&&(e.renderer=new Sprite.Canvas(b,d),e.rendererType="canvas"),!e.renderer)throw new Error("Sprite.Stage all renderer not support");e.color="#000000"}return _inherits(c,b),_createClass(c,[{key:"releaseRenderer",value:function(){a(this).renderer.release()}},{key:"filter",value:function(b,c){return a(this).renderer.filter(b,c)}},{key:"findHit",value:function(a){var b=this.hitTest(this.mouseX,this.mouseY);return b.reverse(),b.length?b:null}},{key:"clear",value:function(){a(this).renderer.clear()}},{key:"update",value:function(){this.emit("beforeDraw"),this.draw(this.renderer),this.emit("afterDraw")}},{key:"draw",value:function(a){if(this.children.length<=0)return!1;this.clear();var b=!0,c=!1,d=void 0;try{for(var e,f=this.children[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g.draw(a)}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}}},{key:"renderer",get:function(){return a(this).renderer},set:function(a){throw new Error("Sprite.Stage renderer readonly")}},{key:"rendererType",get:function(){return a(this).rendererType},set:function(a){throw new Error("Sprite.Stage.rendererType readonly")}},{key:"width",get:function(){return a(this).renderer.width},set:function(b){a(this).renderer.width=b}},{key:"height",get:function(){return a(this).renderer.height},set:function(b){a(this).renderer.height=b}},{key:"color",get:function(){return a(this).renderer.color},set:function(b){a(this).renderer.color=b}},{key:"canvas",get:function(){return this.renderer.canvas},set:function(a){throw new Error("Sprite.Stage.canvas readonly")}}]),c}(Sprite.Container))}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};!function(){var a=Sprite.Namespace(),b=document.createElement("canvas");b.width=1,b.height=1;var c=b.getContext("2d");Sprite.assign("Text",function(b){function d(b){_classCallCheck(this,d),_get(Object.getPrototypeOf(d.prototype),"constructor",this).call(this);var c=a(this);c.text=b.text||"Invalid Text",c.maxWidth=b.maxWidth||1e3,c.color=b.color||"black",c.fontSize=b.fontSize||14,c.fontFamily=b.fontFamily||"Ariel",c.image=null,this.generate()}return _inherits(d,b),_createClass(d,[{key:"clone",value:function(){var b=a(this),c=new Text({text:b.text,maxWidth:b.maxWidth,color:b.color,fontSize:b.fontSize,fontFamily:b.fontFamily});return c.x=this.x,c.y=this.y,c.centerX=this.centerX,c.centerY=this.centerY,c.alpha=this.alpha,c.visible=this.visible,c}},{key:"generate",value:function(){var b=a(this);c.font=this.fontSize+"px "+b.fontFamily;var d=Math.ceil(1.2*c.measureText("龍").width);this.width=0;for(var e=[],f="",g=0,h=this.text.length;h>g;g++)c.measureText(f+this.text[g]).width>this.maxWidth?(e.push(f),f=this.text[g]):f+=this.text[g],c.measureText(f).width>this.width&&(this.width=Math.ceil(c.measureText(f).width));f.length&&e.push(f),this.height=e.length*d;var i=document.createElement("canvas");i.width=this.width,i.height=this.height;var j=i.getContext("2d");j.font=this.fontSize+"px "+this.fontFamily,j.fillStyle=this.color,j.textAlign="center",j.textBaseline="top",e.forEach(function(a,b){j.fillText(a,i.width/2,b*d)}),b.image=null,b.image=i}},{key:"draw",value:function(b){var c=a(this),d=c.image;d&&d.width>0&&d.height>0&&this.drawImage(b,d,0,0,d.width,d.height)}},{key:"text",get:function(){var b=a(this);return b.text},set:function(b){var c=a(this);b!=this.text&&(c.text=b,this.generate())}},{key:"color",get:function(){var b=a(this);return b.color},set:function(b){var c=a(this);b!=this.color&&(c.color=b,this.generate())}},{key:"fontSize",get:function(){var b=a(this);return b.fontSize},set:function(b){var c=a(this);b!=this.fontSize&&(c.fontSize=b,this.generate())}},{key:"fontFamily",get:function(){return a(this).fontFamily},set:function(b){var c=a(this);b!=c.fontFamily&&(c.fontFamily=b,this.generate())}}]),d}(Sprite.Display))}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};!function(){var a=Sprite.Namespace();Sprite.assign("Frame",function(b){function c(b,d,e,f,g){_classCallCheck(this,c),_get(Object.getPrototypeOf(c.prototype),"constructor",this).call(this);var h=a(this);h.image=b,h.sx=d,h.sy=e,this.width=f,this.height=g}return _inherits(c,b),_createClass(c,[{key:"print",value:function(){console.log(a(this))}},{key:"clone",value:function(){var a=new Sprite.Frame(this.image,this.sx,this.sy,this.width,this.height);return a.x=this.x,a.y=this.y,a.parent=this.parent,a}},{key:"draw",value:function(a){this.drawImage(a,this.image,this.sx,this.sy,this.width,this.height)}},{key:"image",get:function(){var b=a(this);return b.image},set:function(a){throw new Error("Sprite.Frame.image readonly")}},{key:"sx",get:function(){var b=a(this);return b.sx},set:function(a){throw new Error("Sprite.Frame.sx readonly")}},{key:"sy",get:function(){var b=a(this);return b.sy},set:function(a){throw new Error("Sprite.Frame.sy readonly")}}]),c}(Sprite.Display))}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};!function(){var a=Sprite.Namespace();Sprite.assign("Sheet",function(b){function c(b){_classCallCheck(this,c),_get(Object.getPrototypeOf(c.prototype),"constructor",this).call(this);var d=a(this);if(!b.images||!b.images.length||!Number.isFinite(b.width)||b.width<=0||b.width>4096||!Number.isFinite(b.height)||b.height<=0||b.height>4096)throw console.error(b),new Error("Sprite.Sheet.constructor get invalid arguments");d.images=b.images,d.tilewidth=b.width,this.width=b.width,d.tileheight=b.height,this.height=b.height,d.animations=b.animations||{},d.currentAnimation=null,d.currentFrame=0,d.animationTimer=null,d.frameCount=0;var e=!0,f=!1,g=void 0;try{for(var h,i=d.images[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;if(!(j instanceof Image||j.getContext&&j.getContext("2d")))throw console.error(j,d,this),new Error("Sprite.Sheet got invalid image, not Image or Canvas");if(j.width<=0||!Number.isFinite(j.width)||j.height<=0||!Number.isFinite(j.height))throw console.error(j,d,this),new Error("Sprite.Sheet got invalid image, invalid width or height");var k=Math.floor(j.width/d.tilewidth),l=Math.floor(j.height/d.tileheight);d.frameCount+=k*l}}catch(m){f=!0,g=m}finally{try{!e&&i["return"]&&i["return"]()}finally{if(f)throw g}}}return _inherits(c,b),_createClass(c,[{key:"clone",value:function(){var b=a(this),c=new Sprite.Sheet({images:b.images,width:b.tilewidth,height:b.tileheight,animations:b.animations});return c.x=this.x,c.y=this.y,c.centerX=this.centerX,c.centerY=this.centerY,c.play(this.currentFrame),c.alpha=this.alpha,c.visible=this.visible,c}},{key:"play",value:function(b){var c=this,d=a(this);if(d.animationTimer&&(clearInterval(d.animationTimer),d.animationTimer=null),Number.isInteger(b))d.currentFrame=b,this.emit("change");else{if("string"!=typeof b)throw console.error(b,a(this).animations,this),new Error("Sprite.Sheet.play has an invalid argument");var e=function(){var a=d.animations[b];if(!a)throw console.error(a,d.animations,b),new Error("Sprite.Sheet.play invalid animation");if(Number.isFinite(a))return d.currentAnimation=b,{v:c.play(a)};var e=null,f=null,g=null,h=null;if(a instanceof Array?(e=a[0],f=a[1],g=a[2],h=a[3]):a.frames&&a.frames instanceof Array&&(e=a.frames[0],f=a.frames[a.frames.length-1],g=a.next,h=a.speed),!Number.isFinite(e)||0>e||e>=d.frameCount||!Number.isFinite(f)||0>f||f>=d.frameCount||!Number.isFinite(h)||0>=h)throw console.error(e,f,h,c),new Error("Sprite.Sheet.play Invalid animation data");d.currentAnimation=b,d.currentFrame=e,c.emit("change"),d.animationTimer=setInterval(function(){d.currentFrame++,d.currentFrame>f&&(clearInterval(d.animationTimer),d.animationTimer=null,g&&g.length&&d.animations[g]?c.play(g):d.currentFrame--,c.emit("animationend")),c.emit("change")},h)}();if("object"==typeof e)return e.v}}},{key:"getFrame",value:function(b){var c=a(this);if(Number.isInteger(b)||(b=c.currentFrame),0>b||b>=c.frameCount)throw console.error(b,c,this),new Error("Sprite.Sheet.getFrame index out of range");var d=null,e=!0,f=!1,g=void 0;try{for(var h,i=c.images[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value,k=Math.floor(j.width/c.tilewidth),l=Math.floor(j.height/c.tileheight);if(k*l>b){var m=Math.floor(b/k),n=b-k*m;d=new Sprite.Frame(j,n*c.tilewidth,m*c.tileheight,c.tilewidth,c.tileheight),d.parent=this;break}b-=k*l}}catch(o){f=!0,g=o}finally{try{!e&&i["return"]&&i["return"]()}finally{if(f)throw g}}if(!d)throw console.error(b,c,this),new Error("Sprite.Sheet.getFrame unknown error");return d}},{key:"draw",value:function(b){if(!(0==this.visible||this.alpha<=.01)){var c=(a(this),this.getFrame(this.currentFrame));if(!c||!c.image)throw console.error(c,this.currentFrame,this),new Error("Sprite.Sheet.draw invalid frame");c.draw(b)}}},{key:"paused",get:function(){var b=a(this);return b.animationTimer?!1:!0},set:function(a){throw new Error("Sprite.Sheet.paused readonly")}},{key:"currentFrame",get:function(){var b=a(this);return b.currentFrame},set:function(a){throw new Error("Sprite.Sheet.currentFrame readonly")}},{key:"currentAnimation",get:function(){var b=a(this);return b.currentAnimation},set:function(a){throw new Error("Sprite.Sheet.currentAnimation readonly")}}]),c}(Sprite.Display))}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a={tab:9,enter:13,shift:16,esc:27,space:32,left:37,up:38,right:39,down:40,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122},b=new Map;window.addEventListener("keydown",function(a){a=a||window.event;var c=a.keyCode;b.set(c,!0)}),window.addEventListener("keyup",function(a){a=a||window.event;var c=a.keyCode;b.has(c)&&b["delete"](c)}),Sprite.assign("Input",function(){function c(){_classCallCheck(this,c)}return _createClass(c,null,[{key:"isPressed",value:function(c){if(Number.isFinite(c))return b.has(c)?!0:!1;if("string"==typeof c)return c=a[c],b.has(c)?!0:!1;throw console.error(c),new Error("Sprite.Input.isPressed got invalid argument")}},{key:"whenPress",value:function(b,c){if(!c)throw console.error(c),new Error("Sprite.Input.whenPress got invalid arguments");window.addEventListener("keypress",function(d){d=d||window.event;var e=d.keyCode,f=!0,g=!1,h=void 0;try{for(var i,j=b[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value,l=a[k];l&&l==e&&c(k)}}catch(m){g=!0,h=m}finally{try{!f&&j["return"]&&j["return"]()}finally{if(g)throw h}}})}},{key:"whenDown",value:function(b,c){if(!c)throw console.error(c),new Error("Sprite.Input.whenDown got invalid arguments");window.addEventListener("keydown",function(d){d=d||window.event;var e=d.keyCode,f=!0,g=!1,h=void 0;try{for(var i,j=b[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value,l=a[k];l&&l==e&&c(k)}}catch(m){g=!0,h=m}finally{try{!f&&j["return"]&&j["return"]()}finally{if(g)throw h}}})}},{key:"whenUp",value:function(b,c){if(!c)throw console.error(c),new Error("Sprite.Input.whenUp got invalid arguments");window.addEventListener("keyup",function(d){d=d||window.event;var e=d.keyCode,f=!0,g=!1,h=void 0;try{for(var i,j=b[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value,l=a[k];l&&l==e&&c(k)}}catch(m){g=!0,h=m}finally{try{!f&&j["return"]&&j["return"]()}finally{if(g)throw h}}})}}]),c}())}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};!function(){var a=Sprite.Namespace();Sprite.assign("Shape",function(b){function c(){_classCallCheck(this,c),_get(Object.getPrototypeOf(c.prototype),"constructor",this).call(this);var b=a(this);b.children=[],this.width=0,this.height=0,b.image=null}return _inherits(c,b),_createClass(c,[{key:"clone",value:function(){var b=a(this),c=new Sprite.Shape;return a(c).children=b.children.slice(),a(c).image=b.image,c.width=this.width,c.height=this.height,c.x=this.x,c.y=this.y,c.centerX=this.centerX,c.centerY=this.centerY,c}},{key:"clear",value:function(){var b=a(this);return b.children=[],this.width=0,this.height=0,this.generate(),this}},{key:"makeConfig",value:function(a,b){if(b)for(var c in b)a[c]=b[c];var d=[];for(var c in a)d.push(c+'="'+a[c]+'"');return d.join(" ")}},{key:"rect",value:function(b){var c=a(this),d={x:0,y:0,width:10,height:10,stroke:"black","stroke-width":1,fill:"white","fill-opacity":1,"stroke-opacity":1,opacity:1};c.children.push("<rect "+this.makeConfig(d,b)+" />"),d.x+d.width>this.width&&(this.width=d.x+d.width),d.y+d.height>this.height&&(this.height=d.y+d.height),this.generate()}},{key:"circle",value:function(b){var c=a(this),d={cx:10,cy:10,r:10,stroke:"black","stroke-width":1,fill:"white","fill-opacity":1,"stroke-opacity":1,opacity:1};c.children.push("<circle "+this.makeConfig(d,b)+" />"),d.cx+d.r>this.width&&(this.width=d.cx+d.r),d.cy+d.r>this.height&&(this.height=d.cy+d.r),this.generate()}},{key:"ellipse",value:function(b){var c=a(this),d={cx:10,cy:10,rx:5,ry:10,stroke:"black","stroke-width":1,fill:"white","fill-opacity":1,"stroke-opacity":1,opacity:1};c.children.push("<ellipse "+this.makeConfig(d,b)+" />"),d.cx+d.rx>this.width&&(this.width=d.cx+d.rx),d.cy+d.ry>this.height&&(this.height=d.cy+d.ry),this.generate()}},{key:"line",value:function(b){var c=a(this),d={x1:10,y1:10,x2:20,y2:20,stroke:"black","stroke-width":1,"stroke-opacity":1,opacity:1};c.children.push("<line "+this.makeConfig(d,b)+" />"),Math.max(d.x1,d.x2)>this.width&&(this.width=Math.max(d.x1,d.x2)),Math.max(d.y1,d.y2)>this.height&&(this.height=Math.max(d.y1,d.y2)),this.generate()}},{key:"polyline",value:function(b){var c=a(this),d={points:"20, 20, 30, 20, 30, 30, 20, 30",stroke:"black","stroke-width":1,fill:"white","fill-opacity":1,"stroke-opacity":1,opacity:1};c.children.push("<polyline "+this.makeConfig(d,b)+" />");var e=-1;d.points.split(/, /).forEach(function(a){var b=parseInt(a);!isNaN(b)&&b>e&&(e=b)}),-1!=e&&e>this.width&&(this.width=e),-1!=e&&e>this.height&&(this.height=e),this.generate()}},{key:"polygon",value:function(b){var c=a(this),d={points:"20,20 30,20 30,30 20,30",stroke:"black","stroke-width":1,fill:"white","fill-opacity":1,"stroke-opacity":1,opacity:1};c.children.push("<polyline "+this.makeConfig(d,b)+" />");var e=-1,f=-1;d.points.split(/,| /).forEach(function(a,b){var c=parseInt(a);b%2==0?c>e&&(e=c):c>f&&(f=c)}),e>0&&e>this.width&&(this.width=e),f>0&&f>this.height&&(this.height=f),this.generate()}},{key:"generate",value:function(){var b=this,c=a(this),d='<?xml version="1.0"?>\n<svg width="'+this.width+'" height="'+this.height+'" '+('style="width: '+this.width+"px; height: "+this.height+'px;" ')+'xmlns="http://www.w3.org/2000/svg" version="1.1">\n',e=!0,f=!1,g=void 0;try{for(var h,i=c.children[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;d+="  "+j+"\n"}}catch(k){f=!0,g=k}finally{try{!e&&i["return"]&&i["return"]()}finally{if(f)throw g}}d+="</svg>";var l=new Blob([d],{type:"image/svg+xml;charset=utf-8"}),m=window.URL.createObjectURL(l),n=new Image;n.src=m;var o=function(){c.image=n,window.URL.revokeObjectURL(m),b.emit("change")};n.complete?o():n.onload=o}},{key:"draw",value:function(b){var c=a(this),d=c.image;d instanceof Image&&d.width>0&&d.height>0&&this.drawImage(b,d,0,0,d.width,d.height,0,0,d.width,d.height)}}]),c}(Sprite.Display))}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;h=j=i=void 0,d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0}};!function(){var a=Sprite.Namespace();Sprite.assign("Bitmap",function(b){function c(b){if(_classCallCheck(this,c),_get(Object.getPrototypeOf(c.prototype),"constructor",this).call(this),!(b instanceof Image||b.getContext&&b.getContext("2d")))throw console.error(b,this),new Error("Sprite.Bitmap got invalid image, not Image or Canvas");if(b.width<=0||!Number.isFinite(b.width)||b.height<=0||!Number.isFinite(b.height))throw console.error(b),new Error("Sprite.Bitmap got invalid image, invalid width or height");a(this).image=b}return _inherits(c,b),_createClass(c,[{key:"clone",value:function(){var b=new Sprite.Bitmap(a(this).image);return b.x=this.x,b.y=this.y,b.centerX=this.centerX,b.centerY=this.centerY,b.alpha=this.alpha,b.visible=this.visible,b}},{key:"draw",value:function(b){if(!(this.alpha<=.01||1!=this.visible)){var c=a(this).image;this.drawImage(b,c,0,0,c.width,c.height)}}},{key:"image",get:function(){return a(this).image},set:function(a){throw console.error(this),new Error("Sprite.Bitmap.image readonly")}},{key:"width",get:function(){return a(this).image.width},set:function(a){throw console.error(this),new Error("Sprite.Bitmap.width readonly")}},{key:"height",get:function(){return a(this).image.height},set:function(a){throw console.error(this),new Error("Sprite.Bitmap.height readonly")}}]),c}(Sprite.Display))}();