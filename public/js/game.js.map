{"version":3,"sources":["public/src/game.js"],"names":[],"mappings":"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","file":"public/src/game.js","sourcesContent":["/*\n\nA-RPG Game, Built using Node.js + JavaScript + ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n(function () {\n  \"use strict\";\n\n  // root级别api入口\n  var Game = window.Game = {\n    items: {}, // 物品的缓冲\n    resources: {}, // 保存所有音频，图像等，结构为 { src: object }\n    config: { // 保存所有设置（默认设置）\n      walk: 4, // 角色行走速度\n      run: 8, // 角色跑动速度\n      width: 800, // 渲染窗口的原始大小\n      height: 450,\n      scale: false, // 如果不拉伸，那么无论浏览器窗口多大，都是原始大小；拉伸则按比例填满窗口\n    }\n  };\n\n  // 如果为true，则在下一次tick事件后会调用stage.update，然后再自动置为false\n  var updateStageNextTick = false;\n\n  Game.update = function () {\n    //updateStageNextTick = true;\n  };\n\n  Game.preload = function (resources, callback) {\n\n    // image.json中包含一些游戏无论如何都需要的图片，所以必须加载\n    resources = [\"/image.json\"].concat(Object.keys(resources));\n\n    // 排除已经有了的图片\n    resources = resources.filter(function (element) {\n      if (Game.resources.hasOwnProperty(element))\n        return false;\n      return true;\n    });\n\n    // 如果所有图片都有了，就立刻回调\n    if (resources.length <= 0) {\n      return callback();\n    }\n\n    // 进度条\n    var con = document.getElementById(\"ProgressBar\");\n    var bar = document.getElementById(\"ProgressBarInner\");\n    var second = 0;\n    var opacity = 100;\n    var start = new Date().getTime();\n    con.style.zIndex = 999;\n    con.style.opacity = 1;\n    bar.style.width = \"20%\";\n    bar.innerHTML = \"\";\n\n    // 新建队列\n    var queue = new Sprite.Loader();\n\n    // 向进度条反馈进度\n    queue.on(\"progress\", function (event) {\n      var progress = queue.progress;\n      var now = new Date().getTime();\n\n      var second = (now - start) / 1000;\n\n      progress *= 80;\n      progress += 20;\n      progress = progress.toFixed(0) + \"%\";\n\n      // 更新进度条\n      bar.style.width = progress;\n      bar.innerHTML = second.toFixed(2) + \"s \" + progress;\n    });\n\n    queue.on(\"complete\", function() {\n\n      (function HideLoadingBar() {\n        opacity -= 10;\n        con.style.opacity = opacity / 100;\n        if (opacity <= 0) {\n          con.style.zIndex = -999;\n        } else {\n          setTimeout(HideLoadingBar, 25);\n        }\n      })();\n\n      resources.forEach(function (element) {\n        var obj = Sprite.Cache[element];\n        Game.resources[element] = obj;\n\n        // 把image.json中的base64 data uri的图片转换为DOM element\n        if (element == \"/image.json\") {\n          for (var key in obj) {\n            var image = new Image();\n            image.src = obj[key];\n            Game.resources[key] = image;\n          }\n        }\n\n      });\n      callback();\n    });\n\n    resources.forEach(function (element) {\n\n      if (element.indexOf(\".ogg\") != -1) {\n        var a = new Audio();\n        if (a.canPlayType(\"audio/ogg\").length) {\n          queue.add(element);\n        } else if (a.canPlayType(\"audio/mpeg\").length) {\n          queue.add(element.replace(\".ogg\", \".mp3\"));\n        }\n      } else {\n        queue.add(element);\n      }\n\n    });\n\n    queue.start();\n  };\n\n  Game.init = function () {\n\n    Game.stage = new Sprite.Stage(Game.config.width, Game.config.height);\n    document.body.appendChild(Game.stage.canvas);\n    Game.stage.canvas.style.position = \"fixed\";\n\n    Game.mapLayer = new Sprite.Container();\n    Game.mapLayer.name = \"mapLayer\";\n\n    Game.actorLayer = new Sprite.Container();\n    Game.actorLayer.name = \"actorLayer\";\n\n    Game.itemLayer = new Sprite.Container();\n    Game.itemLayer.name = \"itemLayer\";\n\n    Game.heroLayer = new Sprite.Container();\n    Game.heroLayer.name = \"heroLayer\";\n\n    Game.spellLayer = new Sprite.Container();\n    Game.spellLayer.name = \"spellLayer\";\n\n    Game.dialogueLayer = new Sprite.Container();\n    Game.dialogueLayer.name = \"dialogueLayer\";\n\n    Game.uiLayer = new Sprite.Container();\n    Game.uiLayer.name = \"uiLayer\";\n\n    Game.stage.appendChild(\n      Game.mapLayer,\n      Game.actorLayer,\n      Game.itemLayer,\n      Game.heroLayer,\n      Game.spellLayer,\n      Game.dialogueLayer,\n      Game.uiLayer\n    );\n\n    /*\n    Sprite.Ticker.on(\"tick\", function () {\n      if (updateStageNextTick) {\n        Game.stage.update();\n        updateStageNextTick = false;\n      }\n    });\n    */\n\n    var fps = 0;\n    var start = new Date().getTime();\n\n    function update () {\n      if (Game.stage.update())\n        fps++;\n\n      //window.requestAnimationFrame(update);\n    }\n\n    setInterval(function () {\n      var now = new Date().getTime();\n      var f = fps / ((now - start)/1000);\n      fps = 0;\n      start = now;\n      //console.log(f);\n      document.getElementById(\"fps\").innerHTML = f.toFixed(2);\n    }, 500);\n\n    setInterval(update, 20);\n    //window.requestAnimationFrame(update);\n\n    console.log(\"RPG Game Flying!\");\n  };\n\n\n\n})();\n"]}