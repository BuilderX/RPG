{"version":3,"sources":["public/src/archive.js"],"names":[],"mappings":"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","file":"public/src/archive.js","sourcesContent":["/*\n\nA-RPG Game, Built using Node.js + JavaScript + ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n(function () {\n  Game.archive = {};\n\n  // 返回所有存档，Object格式\n  Game.archive.list = function () {\n    var keys = [];\n    for (var key in window.localStorage) {\n      if (key.match(/^SAVE_(\\d+)$/)) {\n        keys.push(parseInt(key.match(/^SAVE_(\\d+)$/)[1]));\n      }\n    }\n    keys.sort();\n    return keys;\n  };\n\n  // 返回最新存档，Object格式\n  Game.archive.last = function () {\n    var list = Game.archive.list();\n    if (list.length > 0) {\n      var last = list[list.length - 1];\n      return JSON.parse(window.localStorage.getItem(`SAVE_${last}`));\n    } else {\n      throw new Error(\"Game.archive.last Error\");\n    }\n  };\n\n  Game.archive.clear = function () {\n    for (var key in window.localStorage) {\n      if (key.match(/^SAVE_(\\d+)$/)) {\n        window.localStorage.removeItem(key);\n      }\n    }\n  };\n\n  Game.archive.save = function (data) {\n    var now = new Date();\n    var id = now.getTime();\n\n    data.id = id;\n    data.name = data.hero.name;\n    data.date = now.toLocaleString();\n\n    window.localStorage.setItem(`SAVE_${id}`, JSON.stringify(data));\n  };\n\n  Game.archive.load = function (id) {\n    var data = null;\n    if (id && window.localStorage.getItem(id)) {\n      data = JSON.parse(window.localStorage.getItem(id));\n    } else {\n      data = Game.archive.last();\n    }\n\n    if (data) {\n      window.ShowGameWindow();\n\n      var heroData = data.hero;\n\n      Game.drawHero(heroData.custom, function (heroImage) {\n        heroData.image = heroImage;\n        Game.hero = new Game.ActorClass(heroData);\n\n        Game.loadArea(heroData.area, function (area) {\n          Game.area = area;\n          area.map.draw(Game.mapLayer);\n          Game.hero.draw(Game.heroLayer);\n          Game.hero.focus();\n          Game.initInput();\n        });\n\n      });\n      return;\n\n      Game.loadArea(heroData.area, function (area) {\n        Game.area = area;\n\n        area.map.draw(Game.mapLayer);\n\n        for (var key in area.actors) {\n          area.actors[key].draw(Game.actorLayer);\n        }\n\n        for (var key in area.heros) {\n          if (key == data.success.heroId)\n            area.heros[key].draw(Game.playerLayer);\n          else\n            area.heros[key].draw(Game.heroLayer);\n        }\n\n        for (var key in area.heros) {\n          if (key == data.success.heroId) {\n            Game.hero = area.heros[key];\n            Game.hero.focus();\n\n            Game.ui.initBottomBar();\n\n            Game.update();\n            break;\n          }\n        }\n      });\n    } else {\n      console.error(\"id:\", id);\n      throw \"Invalid id, Game.archive.load\";\n    }\n      //return archive[id];\n\n  };\n})();\n"]}