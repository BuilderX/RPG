{"version":3,"sources":["public/src/hero.js"],"names":[],"mappings":"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","file":"public/src/hero.js","sourcesContent":["/*\n\nOnline A-RPG Game, Built using Node.js + createjs\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n(function () {\n  \"use strict\";\n\n  // 合并图片\n  // 把images中的所有图片按顺序draw到一个canvas上面，然后用canvas.toDataURL返回一张叠好的图片\n  function CombineHeroImage (images, address, width, height, callback) {\n    var canvas = document.createElement(\"canvas\");\n    canvas.height = height;\n    canvas.width = width;\n    var context = canvas.getContext(\"2d\");\n    context.clearRect(0, 0, width, height);\n\n    for (var i = 0; i < images.length; i++) {\n      var img = images[i];\n      context.drawImage(\n        img, 0, 0, img.width, img.height,\n        0, 0, width, height\n      );\n    }\n\n    var img = new Image();\n    img.onload = function () {\n      callback(img);\n    };\n    img.src = canvas.toDataURL();\n  }\n\n  // 把多张图片合成一张，并返回\n  Game.drawHero = function (heroCustom, callback) {\n    Game.io.get(\"/hero/generate\", heroCustom, function (ret) {\n      var need = [];\n\n      for (var key in ret) {\n        if (Game.resources.hasOwnProperty(ret[key]) == false) {\n          need.push(ret[key]);\n        }\n      }\n\n      function ImageComplete () {\n        var images = [];\n\n        if (ret.body) images.push(Game.resources[ret.body]);\n        if (ret.eyes) images.push(Game.resources[ret.eyes]);\n        if (ret.shirts) images.push(Game.resources[ret.shirts]);\n        if (ret.pants) images.push(Game.resources[ret.pants]);\n        if (ret.shoes) images.push(Game.resources[ret.shoes]);\n        if (ret.armorchest) images.push(Game.resources[ret.armorchest]);\n        if (ret.armorarm) images.push(Game.resources[ret.armorarm]);\n        if (ret.armorlegs) images.push(Game.resources[ret.armorlegs]);\n        if (ret.armorfeet) images.push(Game.resources[ret.armorfeet]);\n        if (ret.hair) images.push(Game.resources[ret.hair]);\n        if (ret.head) images.push(Game.resources[ret.head]);\n        if (ret.armorhelms) images.push(Game.resources[ret.armorhelms]);\n        if (ret.weapons) images.push(Game.resources[ret.weapons]);\n\n        CombineHeroImage(images, ret, heroCustom.width, heroCustom.height, callback);\n      }\n\n      if (need.length) {\n        var queue = new createjs.LoadQueue(true);\n        queue.on(\"complete\", function () {\n          need.forEach(function (element) {\n            Game.resources[element] = queue.getResult(element);\n          });\n          ImageComplete();\n        });\n        need.forEach(function (element) {\n          queue.loadFile({src: element});\n        });\n      } else {\n        ImageComplete();\n      }\n    });\n  };\n\n})();\n"]}