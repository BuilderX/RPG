{"version":3,"sources":["public/src/area.js"],"names":[],"mappings":"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","file":"public/src/area.js","sourcesContent":["/*\n\nOnline A-RPG Game, Built using Node.js + createjs\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n(function () {\n  \"use strict\";\n\n  // 加载区域，把括地图，角色，物品\n  Game.loadArea = function (id, callback) {\n    Game.io.get(\"/area/get\", {\n      id: id\n    }, function (ret) {\n\n      if (ret.map) {\n        var mapData = ret.map;\n\n        Game.preload(ret.resources, function () {\n\n          mapData.tilesets.forEach(function (element) {\n            element.image = Game.resources[element.image];\n          });\n\n          var count = 0;\n          // 当area的actors和items都加载完成后回调\n          var AreaComplete = function () {\n            count++;\n            if (count >= 0){\n              var mapObj = new Game.MapClass(mapData);\n              ret.map = mapObj;\n              mapObj.on(\"complete\", function () {\n                callback(ret);\n              });\n            }\n          };\n\n          count = 0;\n          count -= Object.keys(ret.heros).length;\n          count -= Object.keys(ret.actors).length;\n          count -= Object.keys(ret.items).length;\n\n          // 处理地图中的hero\n          for (var key in ret.heros) {\n            (function (key, heroData) {\n              Game.drawHero(heroData.custom, function (heroImage) {\n                heroData.image = heroImage;\n                var heroObj = new Game.ActorClass(heroData);\n                ret.heros[key] = heroObj;\n\n                for (var i = 0; i < heroObj.data.items.length; i++) {\n                  if (heroObj.data.items[i])\n                    heroObj.data.items[i] = new Game.ItemClass(heroObj.data.items[i]);\n                }\n\n                for (var equipment in heroObj.data.equipment) {\n                  if (heroObj.data.equipment[equipment])\n                    heroObj.data.equipment[equipment] = new Game.ItemClass(heroObj.data.equipment[equipment]);\n                }\n\n                heroObj.on(\"complete\", AreaComplete);\n              });\n            })(key, ret.heros[key]);\n          }\n\n          // 处理地图角色（NPC或怪物）\n          for (var key in ret.actors) {\n            var actorObj = new Game.ActorClass(ret.actors[key]);\n            ret.actors[key] = actorObj;\n            actorObj.on(\"complete\", AreaComplete);\n          }\n\n          // 处理地图物品，可能出现的物品\n          for (var key in ret.items) {\n            var itemObj = new Game.ItemClass(ret.items[key]);\n            ret.items[key] = itemObj;\n            itemObj.on(\"complete\", AreaComplete);\n          }\n\n        });\n\n      } else {\n        console.log(ret.error || \"Unknown Error\");\n      }\n    });\n  };\n\n})();\n"]}