!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="/",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2);r(i)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),n(3);var i=n(8),o=r(i),a=n(27),l=r(a),u=n(30),s=r(u),d=n(31),c=r(d),f=n(37),h=r(f),p=n(38),y=r(p),w=n(43),v=r(w),g=n(44),b=r(g),m=n(46),x=r(m),k=n(47),A=r(k),E=n(48),S=r(E),W=n(49),C=r(W),O=n(50),M=r(O),T=n(28),P=r(T),_=n(51),L=r(_),B=n(52),j=r(B),I=n(33),q=r(I),U=n(53),F=r(U),N=n(57),R=r(N),D=n(61),G=r(D),z=n(65),Y=r(z),H=n(71),X=r(H),Q=n(75),V=r(Q),J=n(80),Z=r(J),K=n(84),$=r(K),ee=n(88),te=r(ee),ne=n(92),re=r(ne),ie=n(96),oe=r(ie),ae=n(100),le=r(ae),ue=n(104),se=r(ue),de=n(108),ce=r(de),fe=n(112),he=r(fe),pe=n(116),ye=r(pe),we=n(120),ve=r(we);o["default"].assign("Actor",l["default"]),o["default"].assign("ActorAlly",s["default"]),o["default"].assign("ActorHero",c["default"]),o["default"].assign("ActorMonster",h["default"]),o["default"].assign("ActorNPC",y["default"]),o["default"].assign("ActorPet",v["default"]),o["default"].assign("Archive",b["default"]),o["default"].assign("Area",x["default"]),o["default"].assign("Astar",A["default"]),o["default"].assign("Input",S["default"]),o["default"].assign("Item",C["default"]),o["default"].assign("Map",M["default"]),o["default"].assign("Quest",P["default"]),o["default"].assign("Register",L["default"]),o["default"].assign("Skill",j["default"]),o["default"].assign("Window",q["default"]),o["default"].windows.archive=F["default"],o["default"].windows.buy=R["default"],o["default"].windows.dialogue=G["default"],o["default"].windows["interface"]=Y["default"],o["default"].windows.inventory=X["default"],o["default"].windows.loading=V["default"],o["default"].windows.main=Z["default"],o["default"].windows.map=$["default"],o["default"].windows.over=te["default"],o["default"].windows.pickup=re["default"],o["default"].windows.quest=oe["default"],o["default"].windows.register=le["default"],o["default"].windows.sell=se["default"],o["default"].windows.setting=ce["default"],o["default"].windows.skill=he["default"],o["default"].windows.status=ye["default"],o["default"].windows.sysmenu=ve["default"],o["default"].init();var ge=q["default"].create("stageWindow");ge.appendChild(o["default"].stage.canvas),o["default"].windows.stage=ge,ge.show(),S["default"].init(),Z["default"].show(),window.Game=o["default"],t["default"]=o["default"]},function(e,t,n){var r=n(4);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"body,html{overflow:hidden;margin:0;background-color:#000}*{cursor:url("+n(6)+"),auto;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}button{outline:0}button:active,button:focus,button:hover{outline:none}button::-moz-focus-inner{border:0}.game-window{position:fixed;top:0;left:0;display:none;width:800px;height:450px;z-index:10}.window-box{position:absolute;top:0;left:0;width:760px;height:390px;padding:10px;overflow-y:auto;background-color:hsla(30,61%,85%,.85);border:20px solid rgba(134,93,52,.85)}.brownButton{box-shadow:inset 0 1px 0 0 #a6827e;background:-webkit-gradient(linear,left top,left bottom,color-stop(.05,#7d5d3b),color-stop(1,#634b30));background:-webkit-linear-gradient(top,#7d5d3b 5%,#634b30);background:linear-gradient(180deg,#7d5d3b 5%,#634b30);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#7d5d3b',endColorstr='#634b30',GradientType=0);background-color:#7d5d3b;border-radius:3px;border:1px solid #54381e;display:inline-block;color:#fff;font-family:Arial;padding:2px 4px;text-decoration:none;text-shadow:0 1px 0 #4d3534}.brownButton:disabled{opacity:.4}.brownButton:hover{background:-webkit-gradient(linear,left top,left bottom,color-stop(.05,#634b30),color-stop(1,#7d5d3b));background:-webkit-linear-gradient(top,#634b30 5%,#7d5d3b);background:linear-gradient(180deg,#634b30 5%,#7d5d3b);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#634b30',endColorstr='#7d5d3b',GradientType=0);background-color:#634b30}",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<t.length;i++){var a=t[i];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},function(e,t){e.exports="data:image/gif;base64,R0lGODlhIAAgAPcAAAAAAP////v7/O3t7tnb3gIDBAQFBgUGBzEzNcfLz+Hk58LExmJjZNze4Orr7OPk5XuBhmpucaClqc7T19LW2QkMDgsOECksLqassLrAxLS6vsfKzOLl597h493g4trd39HU1mBrchMYG05ibSAnKzI7QCAlKERNUkBHS254fmFqb2RtckFGSXiBhoKLkJmip3V8gKKrsJ6nrJWcoKCnq3d8f3Z7fn6Dhr3EyLi/w7G4vJKXmqitsLq/wrS5vMrP0gsPERggJAYICUxgak1ha05hawgKC0JSWlNmcCMrLztITzxJUC44PUlYYHSMmERRWB8lKF9xelRkbF9weVZmbm2AikxZYGV1fR0hI298g2JudGVxd3eEi2lzeHF7gDM3OYiSl4yWm4WNkWhucWZsbyMlJpScoH6Eh4GHisDIzI6Ul5edoMPJzMHHyqCkplJUVba6vNXZ287S1MnNz9ba3Onr7Ojq6+bo6eXn6OPl5uLk5U1ibE5jbTA9QyIrL1ZsdiMsMC04PSUuMktdZURPVFNeY0NMUHmIj2p1eoOOk4CJjX+IjKCprau0uKqzt6avs6StsaOssK63uxwmKhQbHhUcHyErLzA+RCIsMDpJTyYwNCcxNSkzNzdDSCQrLkRQVT5ITGl5gFhkaTc+QVpkaGlwc52nq4SLjpWcn7G4u8jP0r7FyIyRk4qPkYeMjra7vdHW2NDV18/U1sjNzyArLzZDSERSV1NhZjlBRFZhZUlRVH+HipmhpKGprKmxtBYcHgsODzE9QTI+QhATFDxFSH+Ii5ukp6CprJ+lp8/V1+fq6+Pm5+Hk5eDj5N/i493g4dzf4Nve3zE4OoKJiwoOD8fLzNvf4Nre39fb3Nba2wECAgIDAzQ1NePm5vDy8vHy8u7v752env39/WBgYB0dHQEBAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAOYALAAAAAAgACAAAAj/AH8BAPDLnMGDCBMqXAigS5cZbwqaA1Cu4sKLCQFAcThj4LYgokQZqzQxCACMDAV1UaWqI4AgQ1IYG9jJJEqFAATVAKGq0ZsKMBOZBNCp08mbCHPWQKUqnJBftGixOgMjDBgER5Ea1CbISxdDrdQoiAVrFQ4MMhJl1QoAmCBaTlz5WIMDhzgBNyClMKr14MBcu1ChieBmALgH35bx4ssWwLhyunbtQAVnwYABDdLw4iVqLUYA5KwQsSCNzI7AYlDpmCCOg6zObPkQ4QYACwpSpUqJafNDTzcHOv4Io4YUwB4iVYgVoATKho1XPaA565AtWRhhw28CwERkSCgauMqw/1jRoseca3mYsdHBpYkwICgB+Lk0ZMShVH6+hBiDCFuzDszMgQYXRwQzCRCeJWVJH5cUYQoDF3QSQjHIVDgHM8zQ0QsXhXRoRIIGyYdJJrfYokkno6igghQ8OOOBM9H40osxaHRYCIgTAWCCJwAY4AcJSkhxiiRxfHDHHdas0gsaTH6CY4gDASACFIFIYMYjPTRDAB51NHONI9OgUYsWT/oFwDCBXCGBJDlkeYcddjyzwTGLnDJImWYGIgUEjUTSQ5bKeGNHNb0o8gIheIZ4ACdKqOACIzH82YwycG6gyCYD9QXAJn5QEYULkGiQAQVy2PHCJptMkqhfmwhyggqfaj2gwSwJnIrpqn4l4QcTSyDxRBayoipCpn355YcfJZSwhQpToEpssUkBcmwgUT4LbVLV4nrtttx26+23FwUEADs="},function(e,t,n){function r(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=h[r.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](r.parts[o]);for(;o<r.parts.length;o++)i.parts.push(s(r.parts[o],t))}else{for(var a=[],o=0;o<r.parts.length;o++)a.push(s(r.parts[o],t));h[r.id]={id:r.id,refs:1,parts:a}}}}function i(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r],o=i[0],a=i[1],l=i[2],u=i[3],s={css:a,media:l,sourceMap:u};n[o]?n[o].parts.push(s):t.push(n[o]={id:o,parts:[s]})}return t}function o(e,t){var n=w(),r=b[b.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),b.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function a(e){e.parentNode.removeChild(e);var t=b.indexOf(e);t>=0&&b.splice(t,1)}function l(e){var t=document.createElement("style");return t.type="text/css",o(e,t),t}function u(e){var t=document.createElement("link");return t.rel="stylesheet",o(e,t),t}function s(e,t){var n,r,i;if(t.singleton){var o=g++;n=v||(v=l(t)),r=d.bind(null,n,o,!1),i=d.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=u(t),r=f.bind(null,n),i=function(){a(n),n.href&&URL.revokeObjectURL(n.href)}):(n=l(t),r=c.bind(null,n),i=function(){a(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}function d(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=m(t,i);else{var o=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function c(e,t){var n=t.css,r=t.media;t.sourceMap;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function f(e,t){var n=t.css,r=(t.media,t.sourceMap);r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var i=new Blob([n],{type:"text/css"}),o=e.href;e.href=URL.createObjectURL(i),o&&URL.revokeObjectURL(o)}var h={},p=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},y=p(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),w=p(function(){return document.head||document.getElementsByTagName("head")[0]}),v=null,g=0,b=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=y()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var n=i(e);return r(n,t),function(e){for(var o=[],a=0;a<n.length;a++){var l=n[a],u=h[l.id];u.refs--,o.push(u)}if(e){var s=i(e);r(s,t)}for(var a=0;a<o.length;a++){var u=o[a];if(0===u.refs){for(var d=0;d<u.parts.length;d++)u.parts[d]();delete h[u.id]}}}};var m=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(9),l=r(a),u=l["default"].Util.namespace(),s=function(){function e(){i(this,e);var t=u(this);t.items={},t.skills={},t.sounds={},t.layers={},t.windows={},t.config={width:800,height:450,scale:!0,fps:35},t.paused=!0,t.stage=null,window.require&&(t.config.scale=!0)}return o(e,[{key:"addBag",value:function(e,t){return new Promise(function(n,r){var i=!0,o=!1,a=void 0;try{for(var l,u=d.area.bags[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var s=l.value;if(s.hitTest(e,t))return n(s)}}catch(c){o=!0,a=c}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw a}}d.Item.load("bag").then(function(r){r.x=e,r.y=t,r.inner={},r.draw(),d.area.bags.add(r),n(r)})})}},{key:"assign",value:function(e,t){return Object.defineProperty(this,e,{enumerable:!1,configurable:!1,writable:!1,value:t}),this}},{key:"start",value:function(){u(this).paused=!1}},{key:"pause",value:function(){u(this).paused=!0}},{key:"clearStage",value:function(){if(d.area){var e=!0,t=!1,n=void 0;try{for(var r,i=d.area.actors[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;o.erase()}}catch(a){t=!0,n=a}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw n}}var l=!0,u=!1,s=void 0;try{for(var c,f=d.area.bags[Symbol.iterator]();!(l=(c=f.next()).done);l=!0){var h=c.value;h.erase()}}catch(a){u=!0,s=a}finally{try{!l&&f["return"]&&f["return"]()}finally{if(u)throw s}}}this.layers.mapLayer.clear();var p=!0,y=!1,w=void 0;try{for(var v,g=this.stage.children[Symbol.iterator]();!(p=(v=g.next()).done);p=!0){var b=v.value;b.clear()}}catch(a){y=!0,w=a}finally{try{!p&&g["return"]&&g["return"]()}finally{if(y)throw w}}this.stage.releaseRenderer()}},{key:"init",value:function(){var e=this,t=u(this);t.stage=new l["default"].Stage(t.config.width,t.config.height),t.layers.mapLayer=new l["default"].Container,t.layers.mapLayer.name="mapLayer",t.layers.itemLayer=new l["default"].Container,t.layers.itemLayer.name="itemLayer",t.layers.actorLayer=new l["default"].Container,t.layers.actorLayer.name="actorLayer",t.layers.infoLayer=new l["default"].Container,t.layers.infoLayer.name="inforLayer",t.layers.skillLayer=new l["default"].Container,t.layers.skillLayer.name="skillLayer",t.layers.dialogueLayer=new l["default"].Container,t.layers.dialogueLayer.name="dialogueLayer",t.stage.appendChild(t.layers.mapLayer,t.layers.itemLayer,t.layers.actorLayer,t.layers.infoLayer,t.layers.skillLayer,t.layers.dialogueLayer),t.stage.on("beforeDraw",function(){d.hero&&d.layers.actorLayer.children.sort(function(e,t){return e.y<t.y?-1:e.y>t.y?1:0})}),l["default"].Ticker.on("tick",function(){0==e.paused&&e.stage.update()});var n=document.createElement("div");n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.color="white",n.style.zIndex=999999,document.body.appendChild(n);var r=0,i=Date.now();t.stage.on("afterDraw",function(){r++}),setInterval(function(){var e=Date.now(),t=r/((e-i)/1e3);r=0,i=e,n.textContent=t.toFixed(1)},1e3),console.log("Elliorwis 0.2.0 Flying!")}},{key:"paused",get:function(){return u(this).paused},set:function(e){throw new Error("Game.paused readonly, use Game.pause() instead")}},{key:"windows",get:function(){return u(this).windows},set:function(e){throw new Error("Game.windows readonly")}},{key:"config",get:function(){return u(this).config},set:function(e){throw new Error("Game.config readonly")}},{key:"items",get:function(){return u(this).items},set:function(e){throw new Error("Game.items readonly")}},{key:"skills",get:function(){return u(this).skills},set:function(e){throw new Error("Game.skills readonly")}},{key:"sounds",get:function(){return u(this).sounds},set:function(e){throw new Error("Game.sounds readonly")}},{key:"layers",get:function(){return u(this).layers},set:function(e){throw new Error("Game.layers readonly")}},{key:"stage",get:function(){return u(this).stage},set:function(e){throw new Error("Game.stage readonly")}}]),e}(),d=new s;console.log("Game Base Constructed"),t["default"]=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),o=r(i),a=n(11),l=r(a),u=n(15),s=r(u),d=n(16),c=r(d),f=n(13),h=r(f),p=n(14),y=r(p),w=n(17),v=r(w),g=n(18),b=r(g),m=n(19),x=r(m),k=n(20),A=r(k),E=n(21),S=r(E),W=n(22),C=r(W),O=n(24),M=r(O),T=n(25),P=r(T),_=n(26),L=r(_),B=n(12),j=r(B),I=n(23),q=r(I);o["default"].assign("Bitmap",l["default"]),o["default"].assign("Canvas",s["default"]),o["default"].assign("Container",c["default"]),o["default"].assign("Display",h["default"]),o["default"].assign("Event",y["default"]),o["default"].assign("Frame",v["default"]),o["default"].assign("Input",b["default"]),o["default"].assign("Loader",x["default"]),o["default"].assign("Shape",A["default"]),o["default"].assign("Sheet",S["default"]),o["default"].assign("Stage",C["default"]),o["default"].assign("Text",M["default"]),o["default"].assign("Ticker",P["default"]),o["default"].assign("Tween",L["default"]),o["default"].assign("Util",j["default"]),o["default"].assign("Webgl",q["default"]),t["default"]=o["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){n(this,e)}return r(e,[{key:"assign",value:function(e,t){return Object.defineProperty(this,e,{enumerable:!1,configurable:!1,writable:!1,value:t}),this}}]),e}(),o=new i;t["default"]=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),s=r(u),d=n(13),c=r(d),f=s["default"].namespace(),h=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this));if(!(e instanceof Image||e.getContext&&e.getContext("2d")))throw console.error(e,n),new Error("SpriteBitmap got invalid image, not Image or Canvas");if(e.width<=0||!Number.isFinite(e.width)||e.height<=0||!Number.isFinite(e.height))throw console.error(e),new Error("SpriteBitmap got invalid image, invalid width or height");return f(n).image=e,n}return a(t,e),l(t,[{key:"clone",value:function(){var e=new t(f(this).image);return e.x=this.x,e.y=this.y,e.centerX=this.centerX,e.centerY=this.centerY,e.alpha=this.alpha,e.visible=this.visible,e}},{key:"draw",value:function(e){if(!(this.alpha<=.01||1!=this.visible)){var t=f(this).image;this.drawImage(e,t,0,0,t.width,t.height)}}},{key:"image",get:function(){return f(this).image},set:function(e){throw console.error(this),new Error("SpriteBitmap.image readonly")}},{key:"width",get:function(){return f(this).image.width},set:function(e){throw console.error(this),new Error("SpriteBitmap.width readonly")}},{key:"height",get:function(){return f(this).image.height},set:function(e){throw console.error(this),new Error("SpriteBitmap.height readonly")}}]),t}(c["default"]);t["default"]=h},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){n(this,e)}return r(e,null,[{key:"timeout",value:function(e){return new Promise(function(t,n){setTimeout(t,e)})}},{key:"namespace",value:function(){var e=new WeakMap;return function(t){return 0==e.has(t)&&e.set(t,{}),e.get(t)}}},{key:"uuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/x|y/g,function(e){var t=Math.floor(16*Math.random());return"x"==e?t.toString(16):(3&t|8).toString(16)})}},{key:"copy",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"btoa",value:function(e){return window.btoa(unescape(encodeURIComponent(e)))}},{key:"atob",value:function(e){return decodeURIComponent(escape(window.atob(e)))}},{key:"randInt",value:function(e,t){var n=t-e;return n*=Math.random(),e+Math.floor(n)}}]),e}();t["default"]=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),s=r(u),d=n(14),c=r(d),f=s["default"].namespace(),h=document.createElement("canvas");h.width=1,h.height=1;var p=h.getContext("2d");p.clearRect(0,0,1,1);var y=p.getImageData(0,0,1,1).data,w=function(e){function t(){i(this,t);var e=o(this,Object.getPrototypeOf(t).call(this)),n=f(e);return n.x=0,n.y=0,n.centerX=0,n.centerY=0,n.alpha=1,n.visible=!0,n.width=0,n.height=0,e}return a(t,e),l(t,[{key:"draw",value:function(e){throw console.error("sub-class should override this function"),new Error("Invalid call SpriteDisplay.draw")}},{key:"hitTest",value:function(e,t){p.clearRect(0,0,1,1),p.save(),p.translate(-e,-t),this.draw(p),p.restore();var n=p.getImageData(0,0,1,1).data;return y[0]!=n[0]||y[1]!=n[1]||y[2]!=n[2]?!0:!1}},{key:"drawPosition",value:function(){for(var e=this.centerX,t=this.centerY,n=this.x,r=this.y,i=this.alpha,o=this.parent;o;){if(e+=o.centerX,t+=o.centerY,n+=o.x,r+=o.y,i*=o.alpha,.001>=i)return null;if(0==o.visible)return null;o=o.parent}return{x:n-e,y:r-t,alpha:i}}},{key:"drawImage",value:function(e,t,n,r,i,o){if(!(1!=this.visible||this.alpha<.01)){var a=this.drawPosition();if(a){e.alpha=a.alpha;try{e.drawImage(t,n,r,i,o,a.x,a.y,i,o)}catch(l){throw console.error(t,n,r,i,o,a.x,a.y,i,o),l}}}}},{key:"width",get:function(){return f(this).width},set:function(e){f(this).width=e}},{key:"height",get:function(){return f(this).height},set:function(e){f(this).height=e}},{key:"x",get:function(){return f(this).x},set:function(e){var t=f(this);if(!Number.isFinite(e))throw console.error(e,this),new Error("SpriteDisplay.set x : invalid argument");e!=t.x&&(t.x=Math.floor(e),this.emit("change"))}},{key:"y",get:function(){return f(this).y},set:function(e){var t=f(this);if(!Number.isFinite(e))throw console.error(e,this),new Error("SpriteDisplay.set y : invalid argument");e!=t.y&&(t.y=Math.floor(e),this.emit("change"))}},{key:"centerX",get:function(){return f(this).centerX},set:function(e){var t=f(this);if(!Number.isFinite(e))throw console.error(e,this),new Error("SpriteDisplay.set centerX : invalid argument");e!=t.centerX&&(t.centerX=Math.floor(e),this.emit("change"))}},{key:"centerY",get:function(){return f(this).centerY},set:function(e){var t=f(this);if(!Number.isFinite(e))throw console.error(e,this),new Error("SpriteDisplay.set centerY : invalid argument");e!=t.centerY&&(t.centerY=Math.floor(e),this.emit("change"))}},{key:"alpha",get:function(){var e=f(this);return e.alpha},set:function(e){var t=f(this);if(!Number.isFinite(e)||!(e>=0||1>=e))throw console.error(e,this),new Error("SpriteDisplay.set alpha : invalid argument");e!=t.alpha&&(t.alpha=e,this.emit("change"))}},{key:"visible",get:function(){var e=f(this);return e.visible},set:function(e){var t=f(this);e!=t.visible&&(t.visible=e,this.emit("change"))}}]),t}(c["default"]);t["default"]=w},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),l=r(a),u=l["default"].namespace(),s=function(){function e(){i(this,e);var t=u(this);t.listeners=new Map,t.once=new Map,t.parent=null}return o(e,[{key:"on",value:function(e,t){var n=u(this);if(n.once.has(e))return t({type:e,target:this,data:n.once.get(e)}),null;0==n.listeners.has(e)&&n.listeners.set(e,new Map);var r=l["default"].uuid();return n.listeners.get(e).set(r,t),r}},{key:"off",value:function(e,t){var n=u(this);return n.listeners.has(e)&&n.listeners.get(e).has(t)?(n.listeners.get(e)["delete"](t),n.listeners.get(e).size<=0&&n.listeners["delete"](e),!0):!1}},{key:"emitBubble",value:function(e,t,n){var r=u(this),i=!0;if(r.listeners.has(e)){var o=!0,a=!1,l=void 0;try{for(var s,d=r.listeners.get(e).values()[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;c({type:e,target:t,data:n})===!1&&(i=!1)}}catch(f){a=!0,l=f}finally{try{!o&&d["return"]&&d["return"]()}finally{if(a)throw l}}}r.parent&&1==i&&r.parent.emitBubble(e,t,n)}},{key:"emit",value:function(e,t,n){var r=u(this);t&&("undefined"!=typeof n?r.once.set(e,n):r.once.set(e,null));var i=!0;if(r.listeners.has(e)){var o=!0,a=!1,l=void 0;try{for(var s,d=r.listeners.get(e).values()[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;c({type:e,target:this,data:n})===!1&&(i=!1)}}catch(f){a=!0,l=f}finally{try{!o&&d["return"]&&d["return"]()}finally{if(a)throw l}}}r.parent&&1==i&&r.parent.emitBubble(e,this,n)}},{key:"parent",get:function(){var e=u(this);return e.parent},set:function(e){var t=u(this);t.parent=e}}]),e}();t["default"]=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(12),l=r(a),u=l["default"].namespace(),s=function(){function e(t,n){i(this,e);var r=u(this),o=document.createElement("canvas");o.width=t||640,o.height=n||480;var a=o.getContext("2d");if(!a)throw new Error("SpriteCanvas canvas is not supported");console.log("SpriteCanvas 2d inited"),r.color="#000000",r.canvas=o,r.context=a,r.alpha=1,r.filter=new Map,this.filter("brightness",0),this.filter("contrast",0)}return o(e,null,[{key:"support",value:function(){var e=document.createElement("canvas");return e.getContext("2d")?!0:!1}}]),o(e,[{key:"filter",value:function(e,t){var n=u(this);return Number.isFinite(t)?("brightness"==e&&(t+=1),"contrast"==e&&(t+=1),n.filter.get(e)!=t&&!function(){n.filter.set(e,t);var r=[];n.filter.forEach(function(e,t,n){r.push(t+"("+e+")")}),r=r.join(" "),n.canvas.style.filter=r,n.canvas.style.webkitFilter=r}(),void 0):n.filter.get(e)}},{key:"drawImage",value:function(){var e=u(this);e.context.globalAlpha=this.alpha,e.context.drawImage.apply(e.context,arguments)}},{key:"release",value:function(){}},{key:"clear",value:function(){var e=u(this);e.context.fillStyle=e.color,e.context.fillRect(0,0,this.width,this.height)}},{key:"color",get:function(){return u(this).color},set:function(e){if(!e.match(/^#([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])$/))throw console.error(e,this),new Error("SpriteCanvas invalid color value");u(this).color=e}},{key:"alpha",get:function(){return u(this).alpha},set:function(e){if(!(Number.isFinite(e)&&e>=0&&1>=e))throw console.error(e,this),new Error("SpriteCanvas got invalid alpha number");u(this).alpha=e}},{key:"width",get:function(){return u(this).canvas.width},set:function(e){if(!(Number.isFinite(e)&&e>0&&1e4>e))throw console.error(e,this),new Error("SpriteCanvas got invalid width number");u(this).canvas.width=e}},{key:"height",get:function(){return u(this).canvas.height},set:function(e){var t=u(this);if(!(Number.isFinite(e)&&e>0&&1e4>e))throw console.error(e,this),new Error("SpriteCanvas got invalid height number");e!=t.canvas.height&&(t.canvas.height=e)}},{key:"canvas",get:function(){return u(this).canvas},set:function(e){throw new Error("SpriteCanvas.canvas cannot write")}}]),e}();t["default"]=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function y(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:y(i,t,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(12),d=r(s),c=n(13),f=r(c),h=d["default"].namespace(),p=function(e){function t(){i(this,t);var e=o(this,Object.getPrototypeOf(t).call(this)),n=h(e);return n.children=[],n.cacheCanvas=null,e}return a(t,e),l(t,[{key:"clearCache",value:function(){h(this).cacheCanvas=null}},{key:"cache",value:function(e,t){var n=h(this);n.cacheCanvas&&this.clearCache();var r=this.parent;this.parent=null;var i=document.createElement("canvas");i.width=e,i.height=t;var o=i.getContext("2d");this.draw(o),n.cacheCanvas=i,this.parent=r}},{key:"hitTest",value:function(e,n){h(this);if(this.cacheCanvas)return u(Object.getPrototypeOf(t.prototype),"hitTest",this).call(this,e,n);var r=[],i=!0,o=!1,a=void 0;try{for(var l,s=this.children[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var d=l.value,c=d.hitTest(e,n);c instanceof Array?r=r.concat(c):c===!0&&r.push(d)}}catch(f){o=!0,a=f}finally{try{!i&&s["return"]&&s["return"]()}finally{if(o)throw a}}return r}},{key:"draw",value:function(e){var t=h(this);if(!(this.alpha<.01||1!=this.visible))if(this.cacheCanvas){var n=this.x,r=this.y;this.x+=t.cacheX,this.y+=t.cacheY,this.drawImage(e,this.cacheCanvas,0,0,this.cacheCanvas.width,this.cacheCanvas.height),this.x=n,this.y=r}else if(this.children.length>0){var i=!0,o=!1,a=void 0;try{for(var l,u=this.children[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var s=l.value;1==s.visible&&s.alpha>=.01&&s.draw(e)}}catch(d){o=!0,a=d}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw a}}}}},{key:"hasChild",value:function(e){return-1!=this.children.indexOf(e)?!0:!1}},{key:"appendChild",value:function(){var e=Array.prototype.slice.call(arguments);if(e.length<=0)throw new Error("SpriteContainer.appendChild got an invalid arguments");var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(a instanceof f["default"]==0)throw console.error(a),new Error("SpriteContainer.appendChild only accept SpriteDisplay or it's sub-class");a.parent=this,this.children.push(a)}}catch(l){n=!0,r=l}finally{try{!t&&o["return"]&&o["return"]()}finally{if(n)throw r}}this.emit("addedChildren")}},{key:"appendChildAt",value:function(){var e=Array.prototype.slice.call(arguments);if(e.length<=1)throw console.log(arguments,this),new TypeError("SpriteContainer.appendChildAt has an invalid arguments");for(var t=e[0],n=1,r=e.length;r>n;n++){if(e[n]instanceof f["default"]==0)throw console.error(e[n]),new Error("SpriteContainer.appendChildAt only can accept SpriteDisplay or it's sub-class");e[n].parent=this,this.children.splice(t,0,e[n])}this.emit("addedChildren")}},{key:"removeChild",value:function(e){var t=this.children.indexOf(e);return-1!=t?(this.children[t].parent=null,this.children.splice(t,1),this.emit("removedChildren"),!0):!1}},{key:"clear",value:function(){var e=h(this),t=!0,n=!1,r=void 0;try{for(var i,o=e.children[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;a.parent=null}}catch(l){n=!0,r=l}finally{try{!t&&o["return"]&&o["return"]();
}finally{if(n)throw r}}e.children=[],this.clearCache(),this.emit("removedChildren")}},{key:"children",get:function(){return h(this).children},set:function(e){throw new Error("SpriteContainer.children readonly")}},{key:"cacheCanvas",get:function(){return h(this).cacheCanvas},set:function(e){throw new Error("SpriteContainer.cacheCanvas readonly")}},{key:"cacheX",get:function(){return h(this).cacheX},set:function(e){throw new Error("SpriteContainer.cacheX readonly")}},{key:"cacheY",get:function(){return h(this).cacheY},set:function(e){throw new Error("SpriteContainer.cacheY readonly")}}]),t}(f["default"]);t["default"]=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),s=r(u),d=n(13),c=r(d),f=s["default"].namespace(),h=function(e){function t(e,n,r,a,l){i(this,t);var u=o(this,Object.getPrototypeOf(t).call(this)),s=f(u);return s.image=e,s.sx=n,s.sy=r,u.width=a,u.height=l,u}return a(t,e),l(t,[{key:"print",value:function(){console.log(f(this))}},{key:"clone",value:function(){var e=new t(this.image,this.sx,this.sy,this.width,this.height);return e.x=this.x,e.y=this.y,e.parent=this.parent,e}},{key:"draw",value:function(e){this.drawImage(e,this.image,this.sx,this.sy,this.width,this.height)}},{key:"image",get:function(){var e=f(this);return e.image},set:function(e){throw new Error("SpriteFrame.image readonly")}},{key:"sx",get:function(){var e=f(this);return e.sx},set:function(e){throw new Error("SpriteFrame.sx readonly")}},{key:"sy",get:function(){var e=f(this);return e.sy},set:function(e){throw new Error("SpriteFrame.sy readonly")}}]),t}(c["default"]);t["default"]=h},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i={tab:9,enter:13,shift:16,esc:27,space:32,left:37,up:38,right:39,down:40,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122},o=new Map;window.addEventListener("keydown",function(e){e=e||window.event;var t=e.keyCode;o.set(t,!0)}),window.addEventListener("keyup",function(e){e=e||window.event;var t=e.keyCode;o.has(t)&&o["delete"](t)});var a=function(){function e(){n(this,e)}return r(e,null,[{key:"isPressed",value:function(e){if(Number.isFinite(e))return o.has(e)?!0:!1;if("string"==typeof e)return e=i[e],o.has(e)?!0:!1;throw console.error(e),new Error("SpriteInput.isPressed got invalid argument")}},{key:"whenPress",value:function(e,t){if(!t)throw console.error(t),new Error("SpriteInput.whenPress got invalid arguments");window.addEventListener("keypress",function(n){n=n||window.event;var r=n.keyCode,o=!0,a=!1,l=void 0;try{for(var u,s=e[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var d=u.value,c=i[d];c&&c==r&&t(d)}}catch(f){a=!0,l=f}finally{try{!o&&s["return"]&&s["return"]()}finally{if(a)throw l}}})}},{key:"whenDown",value:function(e,t){if(!t)throw console.error(t),new Error("SpriteInput.whenDown got invalid arguments");window.addEventListener("keydown",function(n){n=n||window.event;var r=n.keyCode,o=!0,a=!1,l=void 0;try{for(var u,s=e[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var d=u.value,c=i[d];c&&c==r&&t(d)}}catch(f){a=!0,l=f}finally{try{!o&&s["return"]&&s["return"]()}finally{if(a)throw l}}})}},{key:"whenUp",value:function(e,t){if(!t)throw console.error(t),new Error("SpriteInput.whenUp got invalid arguments");window.addEventListener("keyup",function(n){n=n||window.event;var r=n.keyCode,o=!0,a=!1,l=void 0;try{for(var u,s=e[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var d=u.value,c=i[d];c&&c==r&&t(d)}}catch(f){a=!0,l=f}finally{try{!o&&s["return"]&&s["return"]()}finally{if(a)throw l}}})}}]),e}();t["default"]=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2],r=null;if(e.match(/js$/))r="js";else if(e.match(/jpg$|jpeg$|png$|bmp$|gif$/i))r="image";else if(e.match(/wav$|mp3$|ogg$/i))r="audio";else{if(!e.match(/json$/i))throw console.error(e),new Error("Fetch got an invalid url");r="json"}var i=function(n){if(s.set(e,n),"json"==r&&(n=u["default"].copy(n)),t&&t(n),d.has(e)){var i=d.get(e),o=!0,a=!1,l=void 0;try{for(var c,f=i[Symbol.iterator]();!(o=(c=f.next()).done);o=!0){var h=c.value;h&&h(n)}}catch(p){a=!0,l=p}finally{try{!o&&f["return"]&&f["return"]()}finally{if(a)throw l}}d["delete"](e)}};if(s.has(e))return void i(s.get(e));if(!n){if(d.has(e))return void d.get(e).push(t);d.set(e,[])}var a=new XMLHttpRequest;switch(a.open("GET",e,!0),a.timeout=1e4,r){case"js":a.responseType="text";break;case"image":a.responseType="arraybuffer";break;case"audio":a.responseType="arraybuffer";break;case"json":a.responseType="json";break;default:throw console.error(r,e),new Error("Fetch something wrong")}"function"!=typeof t&&(t=function(){}),a.ontimeout=function(){if(n>=2)throw console.error(e),alert("资源"+e+"超时没有加载成功！"),new Error("SpriteLoader.Fetch timeout 3 times");console.error("SpriteLoader.Fetch timeout try again, ",n+1," ",e),setTimeout(function(){o(e,t,n+1)},50)};var l=!1;a.onreadystatechange=function(){if(4==a.readyState&&!l)if(l=!0,a.response){if("js"==r){var u=null;try{u=new Function(a.response)}catch(s){throw console.error(a.response,e),s}i(u)}else if("image"==r)!function(){var e=a.response,t=new Image;t.onload=function(){t.onload=null,i(t)},t.src=window.URL.createObjectURL(new window.Blob([e]))}();else if("audio"==r)!function(){var e=a.response,t=new Audio;t.oncanplay=function(){t.oncanplay=null,i(t)},t.src=window.URL.createObjectURL(new window.Blob([e]))}();else if("json"==r){var d=a.response;if(!d)throw console.error(e),new Error("SpriteLoader invalid json");i(d)}}else{if(console.error("url: ",e),console.error("response: ",a.response," readyState: ",a.readyState," status: ",a.status," statusText: ",a.statusText),n>=2)throw console.error(e),alert("资源"+e+"错误没有加载成功！"),new Error("SpriteLoader.Fetch error 3 times");console.error("SpriteLoader.Fetch error try again, ",n+1," ",e),setTimeout(function(){o(e,t,n+1)},50)}},a.send()}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var l=n(12),u=r(l),s=(u["default"].namespace(),new Map),d=new Map,c=function(){function e(){i(this,e)}return a(e,null,[{key:"load",value:function(){var e=Array.prototype.slice.call(arguments);return new Promise(function(t,n){var r=[],i=!0,a=!1,l=void 0;try{for(var u,s=e[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var d=u.value;if("string"==typeof d)r.push(d);else{if(!(d instanceof Array))throw console.error(d,e),new Error("SpriteLoader.load got invalid argument");var c=!0,f=!1,h=void 0;try{for(var p,y=d[Symbol.iterator]();!(c=(p=y.next()).done);c=!0){var w=p.value;r.push(w)}}catch(v){f=!0,h=v}finally{try{!c&&y["return"]&&y["return"]()}finally{if(f)throw h}}}}}catch(v){a=!0,l=v}finally{try{!i&&s["return"]&&s["return"]()}finally{if(a)throw l}}var g=0,b=[];b.length=r.length;var m=function(){g++,g>=b.length&&t(b)};r.forEach(function(e,t){o(e,function(e){b[t]=e,m()})})})}}]),e}();t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),s=r(u),d=n(13),c=r(d),f=s["default"].namespace(),h=function(e){function t(){i(this,t);var e=o(this,Object.getPrototypeOf(t).call(this)),n=f(e);return n.children=[],e.width=0,e.height=0,n.image=null,e}return a(t,e),l(t,[{key:"clone",value:function(){var e=f(this),n=new t;return f(n).children=e.children.slice(),f(n).image=e.image,n.width=this.width,n.height=this.height,n.x=this.x,n.y=this.y,n.centerX=this.centerX,n.centerY=this.centerY,n}},{key:"clear",value:function(){var e=f(this);return e.children=[],this.width=0,this.height=0,this.generate(),this}},{key:"makeConfig",value:function(e,t){if(t)for(var n in t)e[n]=t[n];var r=[];for(var n in e)r.push(n+'="'+e[n]+'"');return r.join(" ")}},{key:"rect",value:function(e){var t=f(this),n={x:0,y:0,width:10,height:10,stroke:"black","stroke-width":1,fill:"white","fill-opacity":1,"stroke-opacity":1,opacity:1};t.children.push("<rect "+this.makeConfig(n,e)+" />"),n.x+n.width>this.width&&(this.width=n.x+n.width),n.y+n.height>this.height&&(this.height=n.y+n.height),this.generate()}},{key:"circle",value:function(e){var t=f(this),n={cx:10,cy:10,r:10,stroke:"black","stroke-width":1,fill:"white","fill-opacity":1,"stroke-opacity":1,opacity:1};t.children.push("<circle "+this.makeConfig(n,e)+" />"),n.cx+n.r>this.width&&(this.width=n.cx+n.r),n.cy+n.r>this.height&&(this.height=n.cy+n.r),this.generate()}},{key:"ellipse",value:function(e){var t=f(this),n={cx:10,cy:10,rx:5,ry:10,stroke:"black","stroke-width":1,fill:"white","fill-opacity":1,"stroke-opacity":1,opacity:1};t.children.push("<ellipse "+this.makeConfig(n,e)+" />"),n.cx+n.rx>this.width&&(this.width=n.cx+n.rx),n.cy+n.ry>this.height&&(this.height=n.cy+n.ry),this.generate()}},{key:"line",value:function(e){var t=f(this),n={x1:10,y1:10,x2:20,y2:20,stroke:"black","stroke-width":1,"stroke-opacity":1,opacity:1};t.children.push("<line "+this.makeConfig(n,e)+" />"),Math.max(n.x1,n.x2)>this.width&&(this.width=Math.max(n.x1,n.x2)),Math.max(n.y1,n.y2)>this.height&&(this.height=Math.max(n.y1,n.y2)),this.generate()}},{key:"polyline",value:function(e){var t=f(this),n={points:"20, 20, 30, 20, 30, 30, 20, 30",stroke:"black","stroke-width":1,fill:"white","fill-opacity":1,"stroke-opacity":1,opacity:1};t.children.push("<polyline "+this.makeConfig(n,e)+" />");var r=-1;n.points.split(/, /).forEach(function(e){var t=parseInt(e);!isNaN(t)&&t>r&&(r=t)}),-1!=r&&r>this.width&&(this.width=r),-1!=r&&r>this.height&&(this.height=r),this.generate()}},{key:"polygon",value:function(e){var t=f(this),n={points:"20,20 30,20 30,30 20,30",stroke:"black","stroke-width":1,fill:"white","fill-opacity":1,"stroke-opacity":1,opacity:1};t.children.push("<polyline "+this.makeConfig(n,e)+" />");var r=-1,i=-1;n.points.split(/,| /).forEach(function(e,t){var n=parseInt(e);t%2==0?n>r&&(r=n):n>i&&(i=n)}),r>0&&r>this.width&&(this.width=r),i>0&&i>this.height&&(this.height=i),this.generate()}},{key:"generate",value:function(){var e=this,t=f(this),n='<?xml version="1.0"?>\n<svg width="'+this.width+'" height="'+this.height+'" '+('style="width: '+this.width+"px; height: "+this.height+'px;" ')+'xmlns="http://www.w3.org/2000/svg" version="1.1">\n',r=!0,i=!1,o=void 0;try{for(var a,l=t.children[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;n+="  "+u+"\n"}}catch(s){i=!0,o=s}finally{try{!r&&l["return"]&&l["return"]()}finally{if(i)throw o}}n+="</svg>";var d=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),c=window.URL.createObjectURL(d),h=new Image;h.src=c;var p=function(){t.image=h,window.URL.revokeObjectURL(c),e.emit("change")};h.complete?p():h.onload=p}},{key:"draw",value:function(e){var t=f(this),n=t.image;n instanceof Image&&n.width>0&&n.height>0&&this.drawImage(e,n,0,0,n.width,n.height,0,0,n.width,n.height)}}]),t}(c["default"]);t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=n(12),d=r(s),c=n(13),f=r(c),h=n(17),p=r(h),y=d["default"].namespace(),w=function(e){function t(e){o(this,t);var n=a(this,Object.getPrototypeOf(t).call(this)),r=y(n);if(!e.images||!e.images.length||!Number.isFinite(e.width)||e.width<=0||e.width>4096||!Number.isFinite(e.height)||e.height<=0||e.height>4096)throw console.error(e),new Error("SpriteSheet.constructor get invalid arguments");r.images=e.images,r.tilewidth=e.width,n.width=e.width,r.tileheight=e.height,n.height=e.height,r.animations=e.animations||{},r.currentAnimation=null,r.currentFrame=0,r.animationTimer=null,r.frameCount=0;var i=!0,l=!1,u=void 0;try{for(var s,d=r.images[Symbol.iterator]();!(i=(s=d.next()).done);i=!0){var c=s.value;if(!(c instanceof Image||c.getContext&&c.getContext("2d")))throw console.error(c,r,n),new Error("SpriteSheet got invalid image, not Image or Canvas");if(c.width<=0||!Number.isFinite(c.width)||c.height<=0||!Number.isFinite(c.height))throw console.error(c,r,n),new Error("SpriteSheet got invalid image, invalid width or height");var f=Math.floor(c.width/r.tilewidth),h=Math.floor(c.height/r.tileheight);r.frameCount+=f*h}}catch(p){l=!0,u=p}finally{try{!i&&d["return"]&&d["return"]()}finally{if(l)throw u}}return n}return l(t,e),u(t,[{key:"clone",value:function(){var e=y(this),n=new t({images:e.images,width:e.tilewidth,height:e.tileheight,animations:e.animations});return n.x=this.x,n.y=this.y,n.centerX=this.centerX,n.centerY=this.centerY,n.play(this.currentFrame),n.alpha=this.alpha,n.visible=this.visible,n}},{key:"play",value:function(e){var t=this,n=y(this);if(n.animationTimer&&(clearInterval(n.animationTimer),n.animationTimer=null),Number.isInteger(e))n.currentFrame=e,this.emit("change");else{if("string"!=typeof e)throw console.error(e,y(this).animations,this),new Error("SpriteSheet.play has an invalid argument");var r=function(){var r=n.animations[e];if(!r)throw console.error(r,n.animations,e),new Error("SpriteSheet.play invalid animation");if(Number.isFinite(r))return n.currentAnimation=e,{v:t.play(r)};var i=null,o=null,a=null,l=null;if(r instanceof Array?(i=r[0],o=r[1],a=r[2],l=r[3]):r.frames&&r.frames instanceof Array&&(i=r.frames[0],o=r.frames[r.frames.length-1],a=r.next,l=r.speed),!Number.isFinite(i)||0>i||i>=n.frameCount||!Number.isFinite(o)||0>o||o>=n.frameCount||!Number.isFinite(l)||0>=l)throw console.error(i,o,l,t),new Error("SpriteSheet.play Invalid animation data");n.currentAnimation=e,n.currentFrame=i,t.emit("change"),n.animationTimer=setInterval(function(){n.currentFrame++,n.currentFrame>o&&(clearInterval(n.animationTimer),n.animationTimer=null,a&&a.length&&n.animations[a]?t.play(a):n.currentFrame--,t.emit("animationend")),t.emit("change")},l)}();if("object"===("undefined"==typeof r?"undefined":i(r)))return r.v}}},{key:"getFrame",value:function(e){var t=y(this);if(Number.isInteger(e)||(e=t.currentFrame),0>e||e>=t.frameCount)throw console.error(e,t,this),new Error("SpriteSheet.getFrame index out of range");var n=null,r=!0,i=!1,o=void 0;try{for(var a,l=t.images[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value,s=Math.floor(u.width/t.tilewidth),d=Math.floor(u.height/t.tileheight);if(s*d>e){var c=Math.floor(e/s),f=e-s*c;n=new p["default"](u,f*t.tilewidth,c*t.tileheight,t.tilewidth,t.tileheight),n.parent=this;break}e-=s*d}}catch(h){i=!0,o=h}finally{try{!r&&l["return"]&&l["return"]()}finally{if(i)throw o}}if(!n)throw console.error(e,t,this),new Error("SpriteSheet.getFrame unknown error");return n}},{key:"draw",value:function(e){if(!(0==this.visible||this.alpha<=.01)){var t=(y(this),this.getFrame(this.currentFrame));if(!t||!t.image)throw console.error(t,this.currentFrame,this),new Error("SpriteSheet.draw invalid frame");t.draw(e)}}},{key:"paused",get:function(){var e=y(this);return e.animationTimer?!1:!0},set:function(e){throw new Error("SpriteSheet.paused readonly")}},{key:"currentFrame",get:function(){var e=y(this);return e.currentFrame},set:function(e){throw new Error("SpriteSheet.currentFrame readonly")}},{key:"currentAnimation",get:function(){var e=y(this);return e.currentAnimation},set:function(e){throw new Error("SpriteSheet.currentAnimation readonly")}}]),t}(f["default"]);t["default"]=w},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),s=r(u),d=n(16),c=r(d),f=n(15),h=r(f),p=n(23),y=r(p),w=s["default"].namespace(),v=function(e){function t(e,n){i(this,t);var r=o(this,Object.getPrototypeOf(t).call(this)),a=w(r);if(!a.renderer&&y["default"].support()&&(a.renderer=new y["default"](e,n),a.rendererType="webgl"),!a.renderer&&h["default"].support()&&(a.renderer=new h["default"](e,n),a.rendererType="canvas"),!a.renderer)throw new Error("SpriteStage all renderer not support");return a.color="#000000",r}return a(t,e),l(t,[{key:"releaseRenderer",value:function(){w(this).renderer.release()}},{key:"filter",value:function(e,t){return w(this).renderer.filter(e,t)}},{key:"findHit",value:function(e){var t=this.hitTest(this.mouseX,this.mouseY);return t.reverse(),t.length?t:null}},{key:"clear",value:function(){w(this).renderer.clear()}},{key:"update",value:function(){this.emit("beforeDraw"),this.draw(this.renderer),this.emit("afterDraw")}},{key:"draw",value:function(e){if(this.children.length<=0)return!1;this.clear();var t=!0,n=!1,r=void 0;try{for(var i,o=this.children[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;a.draw(e)}}catch(l){n=!0,r=l}finally{try{!t&&o["return"]&&o["return"]()}finally{if(n)throw r}}}},{key:"renderer",get:function(){return w(this).renderer},set:function(e){throw new Error("SpriteStage renderer readonly")}},{key:"rendererType",get:function(){return w(this).rendererType},set:function(e){throw new Error("SpriteStage.rendererType readonly")}},{key:"width",get:function(){return w(this).renderer.width},set:function(e){w(this).renderer.width=e}},{key:"height",get:function(){return w(this).renderer.height},set:function(e){w(this).renderer.height=e}},{key:"color",get:function(){return w(this).renderer.color},set:function(e){w(this).renderer.color=e}},{key:"canvas",get:function(){return this.renderer.canvas},set:function(e){throw new Error("SpriteStage.canvas readonly")}}]),t}(c["default"]);t["default"]=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return e>0&&0===(e-1&e)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var l=n(12),u=r(l),s=u["default"].namespace(),d="\nprecision mediump float;\nattribute vec2 a_texCoord;\nvarying vec2 v_texCoord;\n\nattribute vec2 aVertex;\nuniform vec2 resolution;\n\nuniform vec4 position;\n\nvoid main(void) {\n   vec2 a = aVertex * (position.zw / resolution) + (position.xy / resolution);\n   vec2 b = a * 2.0 - 1.0;\n\n   gl_Position = vec4(b * vec2(1.0, -1.0), 0.0, 1.0);\n   v_texCoord = a_texCoord;\n}",c="\nprecision mediump float;\n\nuniform vec4 crop;\nuniform float brightness;\nuniform float alpha;\nuniform float contrast;\n\nuniform sampler2D image;\n\n// the texCoords passed in from the vertex shader.\nvarying vec2 v_texCoord;\n\nvoid main(void) {\n\n  vec2 t = v_texCoord;\n  t.x *= crop.z;\n  t.y *= crop.w;\n  t += crop.xy;\n\n   vec4 color = texture2D(image, t).rgba;\n\n   if (contrast != 0.0) {\n     if (contrast > 0.0) {\n       color.xyz = (color.xyz - 0.5) / (1.0 - contrast) + 0.5;\n     } else {\n       color.xyz = (color.xyz - 0.5) * (1.0 + contrast) + 0.5;\n     }\n   }\n\n   if (brightness != 0.0) {\n     color.xyz += brightness;\n   }\n\n   if (alpha != 1.0) {\n     color.a *=  alpha;\n   }\n\n   gl_FragColor = color;\n}",f=function(){function e(t,n){i(this,e);var r=s(this),o=document.createElement("canvas");o.width=t||640,o.height=n||480;var a={antialias:!1,preserveDrawingBuffer:!0},l=o.getContext("webgl",a);if(l||(l=o.getContext("experimental-webgl",a)),r.gl=l,!l)throw new Error("SpriteWebgl webgl is not supported");r.color=[0,0,0],r.filter=new Map,r.textureCache=new Map,r.canvas=o,r.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),l.viewport(0,0,o.width,o.height);var u=l.createShader(l.VERTEX_SHADER),f=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(u,d),l.shaderSource(f,c),l.compileShader(u),l.compileShader(f);var h=l.createProgram();l.attachShader(h,u),l.attachShader(h,f),l.linkProgram(h),l.useProgram(h),l.cullFace(l.BACK),l.frontFace(l.CW),l.enable(l.CULL_FACE),l.enable(l.BLEND),l.disable(l.DEPTH_TEST),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA),r.cropLoc=l.getUniformLocation(h,"crop"),r.brightnessLoc=l.getUniformLocation(h,"brightness"),r.contrastLoc=l.getUniformLocation(h,"contrast"),r.alphaLoc=l.getUniformLocation(h,"alpha"),r.resolutionLoc=l.getUniformLocation(h,"resolution"),l.uniform2f(r.resolutionLoc,o.width,o.height),r.positionLoc=l.getUniformLocation(h,"position"),r.tLoc=l.getAttribLocation(h,"a_texCoord"),l.enableVertexAttribArray(r.tLoc),r.texCoordBuffer=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,r.texCoordBuffer),l.vertexAttribPointer(r.tLoc,2,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),l.STATIC_DRAW),r.vLoc=l.getAttribLocation(h,"aVertex"),l.enableVertexAttribArray(r.vLoc),r.vertexBuff=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,r.vertexBuff),l.bufferData(l.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),l.STATIC_DRAW),l.enableVertexAttribArray(r.vLoc),l.vertexAttribPointer(r.vLoc,2,l.FLOAT,!1,0,0),r.currentTexture=null,this.filter("brightness",0),this.filter("contrast",0),this.alpha=1,console.log("SpriteWebgl inited, max texture size: %d",l.getParameter(l.MAX_TEXTURE_SIZE))}return a(e,null,[{key:"support",value:function(){var e=document.createElement("canvas");return e.getContext("webgl")||e.getContext("experimental-webgl")?!0:!1}}]),a(e,[{key:"drawImage9",value:function(e,t,n,r,i,o,a,l,u){var d=s(this),c=d.gl,f=this.createTexture(c,e);d.currentTexture!=f&&(c.bindTexture(c.TEXTURE_2D,f),d.currentTexture=f),c.uniform4f(d.cropLoc,t/e.width,n/e.height,r/e.width,i/e.height),c.uniform4f(d.positionLoc,o,a,l,u),c.drawArrays(c.TRIANGLE_FAN,0,4)}},{key:"release",value:function(){var e=s(this),t=!0,n=!1,r=void 0;try{for(var i,o=e.textureCache.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;e.gl.deleteTexture(a)}}catch(l){n=!0,r=l}finally{try{!t&&o["return"]&&o["return"]()}finally{if(n)throw r}}e.textureCache=new Map}},{key:"createTexture",value:function(e,t){var n=s(this);if(n.textureCache.has(t))return n.textureCache.get(t);e.activeTexture(e.TEXTURE0);var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),o(t.width)&&o(t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.bindTexture(e.TEXTURE_2D,null),n.textureCache.set(t,r),r}},{key:"drawImage",value:function(e,t,n,r,i,o,a,l,u){if(9==arguments.length);else if(5==arguments.length)o=t,a=n,l=r,u=i,t=0,n=0,r=e.width,i=e.height;else{if(3!=arguments.length)throw console.error(arguments,this),new Error("SpriteWebgl.drawImage invalid arguments");o=t,a=n,l=e.width,u=e.height,t=0,n=0,r=e.width,i=e.height}this.drawImage9(e,t,n,r,i,o,a,l,u)}},{key:"filter",value:function(e,t){var n=s(this),r=n.gl;return Number.isFinite(t)?(n.filter.set(e,t),r.uniform1f(n.brightnessLoc,n.filter.get("brightness")),r.uniform1f(n.contrastLoc,n.filter.get("contrast")),void 0):n.get(e)}},{key:"clear",value:function(){var e=s(this),t=e.gl,n=e.color;t.clearColor(n[0],n[1],n[2],1),t.clear(t.COLOR_BUFFER_BIT)}},{key:"alpha",get:function(){var e=s(this);return e.alpha},set:function(e){var t=s(this),n=t.gl;if(!(Number.isFinite(e)&&!isNaN(e)&&e>=0&&1>=e))throw console.error(e,this),new Error("SpriteWebgl got invalid alpha number");e!=t.alpha&&(t.alpha=e,n.uniform1f(t.alphaLoc,t.alpha))}},{key:"color",get:function(){var e=s(this),t=e.color,n=t[0].toString(16),r=t[1].toString(16),i=t[2].toString(16);return n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),i.length<2&&(i="0"+i),"#"+n+r+i},set:function(e){var t=s(this),n=e.match(/^#([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])([\da-fA-F][\da-fA-F])$/);if(!n)throw console.error(e,this),new Error("SpriteWebgl.color invalid color format");var r=n[1],i=n[2],o=n[3];t.color[0]=parseInt(r,16),t.color[1]=parseInt(i,16),t.color[2]=parseInt(o,16)}},{key:"width",get:function(){var e=s(this);return e.canvas.width},set:function(e){var t=s(this);if(!(Number.isFinite(e)&&!isNaN(e)&&e>0&&4096>=e))throw console.error(e,this),new Error("SpriteWebgl got invalid width number");e!=t.canvas.width&&(t.canvas.width=e,t.gl.viewport(0,0,t.canvas.width,t.canvas.height),t.gl.uniform2f(t.resolutionLoc,t.canvas.width,t.canvas.height))}},{key:"height",get:function(){var e=s(this);return e.canvas.height},set:function(e){var t=s(this);if(!(Number.isFinite(e)&&!isNaN(e)&&e>0&&4096>=e))throw console.error(e,this),new Error("SpriteWebgl got invalid height number");e!=t.canvas.height&&(t.canvas.height=e,t.gl.viewport(0,0,t.canvas.width,t.canvas.height),t.gl.uniform2f(resolutionLoc,t.canvas.width,t.canvas.height))}},{key:"canvas",get:function(){return s(this).canvas},set:function(e){throw console.error(e,this),new Error("SpriteWebgl.canvas cannot write")}}]),e}();t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),s=r(u),d=n(13),c=r(d),f=s["default"].namespace(),h=document.createElement("canvas");h.width=1,h.height=1;var p=h.getContext("2d"),y=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this)),r=f(n);return r.text=e.text||"Invalid Text",r.maxWidth=e.maxWidth||1e3,r.color=e.color||"black",r.fontSize=e.fontSize||14,r.fontFamily=e.fontFamily||"Ariel",r.image=null,n.generate(),n}return a(t,e),l(t,[{key:"clone",value:function(){var e=f(this),t=new Text({text:e.text,maxWidth:e.maxWidth,color:e.color,fontSize:e.fontSize,fontFamily:e.fontFamily});return t.x=this.x,t.y=this.y,t.centerX=this.centerX,t.centerY=this.centerY,t.alpha=this.alpha,t.visible=this.visible,t}},{key:"generate",value:function(){var e=f(this);p.font=this.fontSize+"px "+e.fontFamily;var t=Math.ceil(1.2*p.measureText("龍").width);this.width=0;for(var n=[],r="",i=0,o=this.text.length;o>i;i++)p.measureText(r+this.text[i]).width>this.maxWidth?(n.push(r),r=this.text[i]):r+=this.text[i],p.measureText(r).width>this.width&&(this.width=Math.ceil(p.measureText(r).width));r.length&&n.push(r),this.height=n.length*t;var a=document.createElement("canvas");a.width=this.width,a.height=this.height;var l=a.getContext("2d");l.font=this.fontSize+"px "+this.fontFamily,l.fillStyle=this.color,l.textAlign="center",l.textBaseline="top",n.forEach(function(e,n){l.fillText(e,a.width/2,n*t)}),e.image=null,e.image=a}},{key:"draw",value:function(e){var t=f(this),n=t.image;n&&n.width>0&&n.height>0&&this.drawImage(e,n,0,0,n.width,n.height)}},{key:"text",get:function(){var e=f(this);return e.text},set:function(e){var t=f(this);e!=this.text&&(t.text=e,this.generate())}},{key:"color",get:function(){var e=f(this);return e.color},set:function(e){var t=f(this);e!=this.color&&(t.color=e,this.generate())}},{key:"fontSize",get:function(){var e=f(this);return e.fontSize},set:function(e){var t=f(this);e!=this.fontSize&&(t.fontSize=e,this.generate())}},{key:"fontFamily",get:function(){return f(this).fontFamily;
},set:function(e){var t=f(this);e!=t.fontFamily&&(t.fontFamily=e,this.generate())}}]),t}(c["default"]);t["default"]=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),s=r(u),d=n(14),c=r(d),f=(s["default"].namespace(),0),h=function(e){function t(){i(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e.tick(),e}return a(t,e),l(t,[{key:"tick",value:function(){var e=this;f++,this.emit("tick",!1,f),window.requestAnimationFrame(function(){e.tick()})}},{key:"after",value:function(e,t){var n=this,r=0,i=this.on("tick",function(){r++,r>=e&&(n.off("tick",i),t&&t())});return i}},{key:"clearAfter",value:function(e){this.off("tick",e)}},{key:"whiles",value:function(e,t){var n=this,r=0,i=this.on("tick",function(){r++,r>=e?(t&&t(!0),n.off("tick",i)):t&&t(!1)});return i}},{key:"clearWhiles",value:function(e){this.off("tick",e)}}]),t}(c["default"]),p=new h;t["default"]=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),s=r(u),d=n(14),c=r(d),f=s["default"].namespace(),h=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this)),r=f(n);return r.object=e,r.callback=null,r.action=[],r.doing=!1,n}return a(t,e),l(t,null,[{key:"get",value:function(e){return new t(e)}}]),l(t,[{key:"nextAction",value:function(){var e=f(this);if(0==e.doing&&e.action.length>0){var t=e.action[0];switch(e.action.splice(0,1),t.type){case"to":this.toAction(t.attributes,t.time);break;case"wait":this.waitAction(t.time);break;case"call":this.callAction(t.callback);break;case"promise":this.promiseAction(t.callback);break;default:throw console.error(t),new Error("SpriteTween got invalid action")}}}},{key:"toAction",value:function(e,t){var n=this,r=f(this);r.doing=!0;var i=Math.min(100,t),o=t/i,a={};for(var l in e)Number.isFinite(e[l])&&(a[l]=e[l]-r.object[l],a[l]/=i);var u=0,s=setInterval(function(){if(u++,u>=i){for(var t in e)r.object[t]=e[t];clearInterval(s),r.doing=!1,n.nextAction()}else for(var t in a)r.object[t]+=a[t]},o)}},{key:"to",value:function(e,t){return f(this).action.push({type:"to",attributes:e,time:t}),this.nextAction(),this}},{key:"promiseAction",value:function(e){var t=this;this.doing=!0,e().then(function(){t.doing=!1,t.nextAction()})}},{key:"promise",value:function(e){return f(this).action.push({type:"promise",callback:e}),this.nextAction(),this}},{key:"callAction",value:function(e){this.doing=!0,e(),this.doing=!1,this.nextAction()}},{key:"call",value:function(e){return f(this).action.push({type:"call",callback:e}),this.nextAction(),this}},{key:"waitAction",value:function(e){var t=this,n=f(this);n.doing=!0,setTimeout(function(){n.doing=!1,t.nextAction()},e)}},{key:"wait",value:function(e){return f(this).action.push({type:"wait",time:e}),this.nextAction(),this}}]),t}(c["default"]);t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(9),s=r(u),d=n(8),c=r(d),f=n(28),h=r(f),p=n(29),y=r(p),w=s["default"].Util.namespace(),v=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this)),r=w(n);if(r.data=e,n.makeInfoBox(),n.data.image instanceof Array)n.init(n.data.image);else{if("string"!=typeof n.data.image)throw console.error(n.id,n.data,n.data.image,n),new Error("Invalid Actor Image");s["default"].Loader.load("actor/"+n.data.image).then(function(e){n.init(e)})}return n}return a(t,e),l(t,null,[{key:"load",value:function(e){return new Promise(function(t,n){s["default"].Loader.load("actor/"+e+".js").then(function(n){var r=n[0]();r.id=e;var i=null;if("npc"==r.type)i=new c["default"].ActorNPC(r);else if("monster"==r.type)i=new c["default"].ActorMonster(r);else if("ally"==r.type)i=new c["default"].ActorAlly(r);else{if("pet"!=r.type)throw console.error(r.type,r),new Error("Game.Actor.load invalid actor type");i=new c["default"].ActorPet(r)}i.on("complete",function(){t(i)})})})}}]),l(t,[{key:"init",value:function(e){var t=this,n=w(this),r=n.data,i=!0,o=!1,a=void 0;try{for(var l,u=e[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var d=l.value;if(!(d instanceof Image||d.getContext&&d.getContext("2d")))throw console.error(d,e,this),new Error("Game.Actor got invalid image, not Image or Canvas")}}catch(f){o=!0,a=f}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw a}}var p=new s["default"].Sheet({images:e,width:r.tilewidth,height:r.tileheight,animations:r.animations});if(!Number.isInteger(r.centerX)||!Number.isInteger(r.centerY))throw console.log(r),new Error("Game.Actor invalid centerX/centerY");p.centerX=r.centerX,p.centerY=r.centerY,p.play("facedown"),n.sprite=p,p.on("change",function(){n.infoBox.x=p.x,n.infoBox.y=p.y-p.centerY-20});var y=-1,v=function(){y++,y>=0&&(t.calculate(),t.refreshBar(),t.emit("complete",!0))};if(r.quest&&(n.quest=[],n.quest.length=r.quest.length,r.quest.forEach(function(e,t){y--,h["default"].load(e).then(function(e){n.quest.push(e),v()})})),r.skills&&r.skills.forEach(function(e){y--,c["default"].Skill.load(e).then(function(){v()})}),r.equipment)for(var g in r.equipment){var b=r.equipment[g];b&&(y--,c["default"].Item.load(b).then(function(){v()}))}if(r.items)for(var b in r.items)y--,c["default"].Item.load(b).then(function(){v()});v()}},{key:"popup",value:function(e){(0,y["default"])(this.sprite,e,0,-50)}},{key:"makeInfoBox",value:function(){var e=w(this),t=new s["default"].Text({text:e.data.name,maxWidth:200,color:"white",fontSize:12});if(t.centerY=Math.floor(t.height/2),t.centerX=Math.floor(t.width/2),t.x=0,t.y=0,e.infoBox=new s["default"].Container,"hero"!=e.data.type){var n=new s["default"].Shape;n.centerX=15,n.centerY=2,n.x=0,n.y=9;var r=new s["default"].Shape;r.centerX=15,r.centerY=2,r.x=0,r.y=12,n.rect({x:0,y:0,width:30,height:3,"fill-opacity":0}),r.rect({x:0,y:0,width:30,height:3,"fill-opacity":0}),e.hpbar=new s["default"].Shape,e.hpbar.centerX=15,e.hpbar.centerY=2,e.hpbar.x=0,e.hpbar.y=9,e.mpbar=new s["default"].Shape,e.mpbar.centerX=15,e.mpbar.centerY=2,e.mpbar.x=0,e.mpbar.y=12,e.infoBox.appendChild(t,n,r,e.hpbar,e.mpbar)}}},{key:"calculate",value:function(){var e=w(this).data;e.$str&&e.$dex&&e.$con&&e.$int&&e.$cha&&(e.str=e.$str,e.dex=e.$dex,e.con=e.$con,e["int"]=e.$int,e.cha=e.$cha,e.$hp=5*e.con,e.$sp=5*e["int"],e.atk=Math.floor(.25*e.str),e.matk=Math.floor(.25*e["int"]),e.def=0,e.mdef=0,e.critical=.005*e.dex,e.dodge=.005*e.dex,e.hp=e.$hp,e.sp=e.$sp,e.buff&&e.nerf&&(e.buff.forEach(function(e){}),e.nerf.forEach(function(e){})))}},{key:"refreshBar",value:function(){var e=w(this);if(e.hpbar&&e.mpbar){var t="green";this.data.hp/this.data.$hp<.25?t="red":this.data.hp/this.data.$hp<.5&&(t="yellow"),e.hpbar.clear().rect({x:1,y:1,width:Math.floor(this.data.hp/this.data.$hp*28),height:2,fill:t,"stroke-width":0}),e.mpbar.clear().rect({x:1,y:1,width:Math.floor(this.data.sp/this.data.$sp*28),height:2,fill:"blue","stroke-width":0})}}},{key:"distance",value:function(){var e=null,t=null;if(2==arguments.length&&Number.isFinite(arguments[0])&&Number.isFinite(arguments[1]))e=arguments[0],t=arguments[1];else{if(1!=arguments.length||!Number.isFinite(arguments[0].x)||!Number.isFinite(arguments[0].y))throw console.error(arguments),new Error("Game.Actor.distance Invalid arguments");e=arguments[0].x,t=arguments[0].y}var n=0;return n+=Math.pow(this.x-e,2),n+=Math.pow(this.y-t,2),n=Math.sqrt(n)}},{key:"decreaseHP",value:function(e){this.data.hp-=e,this.refreshBar()}},{key:"decreaseSP",value:function(e){this.data.sp-=e,this.refreshBar()}},{key:"dead",value:function(e){var t=this;this.data.hp<=0&&("hero"==this.data.type?c["default"].windows.over.open("你被"+e.data.name+"打死了"):!function(){t.erase(),c["default"].area.actors["delete"](t);var n=t.data.items||{gold:1};c["default"].addBag(t.x,t.y).then(function(e){for(var t in n)e.inner.hasOwnProperty(t)?e.inner[t]+=n[t]:e.inner[t]=n[t]}),e.emit("kill",!1,t)}())}},{key:"flash",value:function(){var e=this;this.sprite.alpha=.5,s["default"].Ticker.after(10,function(){e.sprite.alpha=1})}},{key:"damage",value:function(e,t){this.emit("damaged");var n=t.power,r=t.type,i="white";"hero"==this.data.type&&(i="red"),"normal"==r?(n+=e.data.atk,n-=this.data.def,n=Math.max(0,n)):(n+=e.data.matk,n-this.data.mdef,n=Math.max(0,n));var o=null,a=null;Math.random()<this.data.dodge?(a="dodge",o=new s["default"].Text({text:"miss",color:i,fontSize:16})):Math.random()<e.data.critical?(a="critical",n*=2,o=new s["default"].Text({text:"-"+n,color:i,fontSize:32}),this.flash(),this.decreaseHP(n)):(a="hit",o=new s["default"].Text({text:"-"+n,color:i,fontSize:16}),this.flash(),this.decreaseHP(n)),"dodge"!=a&&this!=c["default"].hero&&c["default"].sounds.hurt&&(c["default"].sounds.hurt.load(),c["default"].sounds.hurt.volume=.2,c["default"].sounds.hurt.play()),o.centerX=Math.floor(o.width/2),o.centerY=Math.floor(o.height),o.x=this.sprite.x,o.y=this.sprite.y,o.x+=s["default"].rand(-10,10),c["default"].layers.actorLayer.appendChild(o);var l=s["default"].rand(1,3);s["default"].Ticker.whiles(100,function(e){o.y-=l,e&&c["default"].layers.actorLayer.removeChild(o)}),this.dead(e)}},{key:"play",value:function(e,t){Number.isFinite(t)||(t=0),("undefined"==typeof this.animationPriority||1==this.sprite.paused)&&(this.animationPriority=-1),this.data.animations.hasOwnProperty(e)&&t>=this.animationPriority&&e!=this.sprite.currentAnimation&&(this.animationPriority=t,this.sprite.play(e))}},{key:"stop",value:function(){if(this.sprite.currentAnimation&&(this.sprite.paused&&!this.sprite.currentAnimation.match(/face/)||this.sprite.currentAnimation.match(/walk|run/)))switch(this.direction){case"up":this.sprite.play("faceup");break;case"down":this.sprite.play("facedown");break;case"left":this.sprite.play("faceleft");break;case"right":this.sprite.play("faceright")}}},{key:"fire",value:function(e,t){var n=this;if(this.attacking)return 0;var r=c["default"].skills[e];if(!r)return 0;var i=Date.now();return Number.isFinite(this.lastAttack)&&Number.isFinite(this.lastAttackCooldown)&&i-this.lastAttack<this.lastAttackCooldown?0:r.data.cost>this.data.sp?0:(t||(t=this.direction),"hero"==this.type&&r.data.condition&&0==r.data.condition()?0:(this.lastAttack=i,this.lastAttackCooldown=r.data.cooldown,this.attacking=!0,this.going&&(this.going=!1),c["default"].Input.clearDest(),this.data.sp-=r.data.cost,this.refreshBar(),r.fire(this,t,function(e){n.attacking=!1,e.length>0&&e[0].damage(n,r),n.emit("change")}),r.data.cooldown))}},{key:"goto",value:function(e,t,n){var r=this;return new Promise(function(i,o){if(r.going)return r.goingNext=function(){r["goto"](e,t,n).then(i)},!1;var a=r.checkCollision(e,t);if(a)if(r.x==e){if(r.y-t==-1)return r.stop(),r.face("down"),i(),!1;if(r.y-t==1)return r.stop(),r.face("up"),i(),!1}else if(r.y==t){if(r.x-e==-1)return r.stop(),r.face("right"),i(),!1;if(r.x-e==1)return r.stop(),r.face("left"),i(),!1}var l=[];0==r.checkCollision(e,t-1)&&l.push({x:e,y:t-1,after:"down"}),0==r.checkCollision(e,t+1)&&l.push({x:e,y:t+1,after:"up"}),0==r.checkCollision(e-1,t)&&l.push({x:e-1,y:t,after:"right"}),0==r.checkCollision(e+1,t)&&l.push({x:e+1,y:t,after:"left"});var u=!0,s=!1,d=void 0;try{for(var f,h=l[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var p=f.value;p.distance=r.distance(p.x,p.y)}}catch(y){s=!0,d=y}finally{try{!u&&h["return"]&&h["return"]()}finally{if(s)throw d}}l.sort(function(e,t){return e.distance-t.distance}),0==r.checkCollision(e,t)&&l.splice(0,0,{x:e,y:t});var w=0,v=!1,g=function b(){if(w<l.length)!function(){var e=l[w];w++,c["default"].Astar.getPath({x:r.x,y:r.y},e).then(function(t){if(r.gettingPath=!1,r.goingNext){var o=r.goingNext;return r.goingNext=null,r.going=!1,r==c["default"].hero&&c["default"].Input.clearDest(),void o()}if(!r.going){if(t){if(r==c["default"].hero)c["default"].Input.setDest(e.x,e.y);else if(t.length>30)return;return void r.gotoPath(t,n,e.after).then(i)}return b()}})}();else if(0==v){v=!0;var o=[];0==r.checkCollision(e-1,t-1)&&o.push({x:e-1,y:t-1,after:"right"}),0==r.checkCollision(e+1,t-1)&&o.push({x:e+1,y:t-1,after:"left"}),0==r.checkCollision(e-1,t+1)&&o.push({x:e-1,y:t+1,after:"right"}),0==r.checkCollision(e+1,t+1)&&o.push({x:e+1,y:t+1,after:"left"}),0==r.checkCollision(e,t-2)&&o.push({x:e,y:t-2,after:"down"}),0==r.checkCollision(e,t+2)&&o.push({x:e,y:t+2,after:"up"}),0==r.checkCollision(e-2,t)&&o.push({x:e-2,y:t,after:"right"}),0==r.checkCollision(e+2,t)&&o.push({x:e+2,y:t,after:"left"});var a=!0,u=!1,s=void 0;try{for(var d,f=o[Symbol.iterator]();!(a=(d=f.next()).done);a=!0){var h=d.value;h.distance=r.distance(h.x,h.y)}}catch(p){u=!0,s=p}finally{try{!a&&f["return"]&&f["return"]()}finally{if(u)throw s}}o.sort(function(e,t){return e.distance-t.distance}),o.length&&(w=0,l=o,b())}};return g()})}},{key:"gotoPath",value:function(e,t,n){var r=this;return new Promise(function(i,o){r.going=!0;var a=1,l=function u(){if(c["default"].paused)return r.stop(),r.going=!1,void(r==c["default"].hero&&c["default"].Input.clearDest());if(r.goingNext){var o=r.goingNext;return r.goingNext=null,r.going=!1,r==c["default"].hero&&c["default"].Input.clearDest(),void o()}if(a<e.length){var l={x:r.x,y:r.y},s=e[a],d=null;if(s.x==l.x?s.y>l.y?d="down":s.y<l.y&&(d="up"):s.y==l.y&&(s.x>l.x?d="right":s.x<l.x&&(d="left")),d){var f=r.direction;d!=f&&(r.stop(),r.face(d)),r.go(t,d).then(function(){u()}),a++}}else n&&(r.stop(),r.face(n)),r==c["default"].hero&&c["default"].Input.clearDest(),r.going=!1,i()};l()})}},{key:"face",value:function(e){var t="face"+e;this.animation!=t&&(this.sprite.play(t),this.emit("change"))}},{key:"checkCollision",value:function(e,t){if(0>e||0>t||e>=c["default"].area.map.data.width||t>=c["default"].area.map.data.height)return!0;if(c["default"].area.map.hitTest(e,t))return!0;if(c["default"].area.actors){var n=!0,r=!1,i=void 0;try{for(var o,a=c["default"].area.actors[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var l=o.value;if(l!=this&&l.hitTest(e,t))return!0}}catch(u){r=!0,i=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw i}}}if(c["default"].area.items){var s=!0,d=!1,f=void 0;try{for(var h,p=c["default"].area.items[Symbol.iterator]();!(s=(h=p.next()).done);s=!0){var y=h.value;if(y.hitTest(e,t))return!0}}catch(u){d=!0,f=u}finally{try{!s&&p["return"]&&p["return"]()}finally{if(d)throw f}}}return!1}},{key:"hitTest",value:function(e,t){if(this.data.hitArea&&this.data.hitArea instanceof Array){var n=!0,r=!1,i=void 0;try{for(var o,a=this.data.hitArea[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var l=o.value;if(e==this.x+l[0]&&t==this.y+l[1])return!0}}catch(u){r=!0,i=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw i}}return!1}throw console.error(this.data),new Error("Game.Actor.hitTest invalid data")}},{key:"go",value:function(e,t){var n=this;return new Promise(function(r,i){if(!c["default"].paused&&!(0==n.sprite.paused&&n.sprite.currentAnimation.match(/skillcast|thrust|slash|shoot/)||n.walking||n.attacking)){if(n.direction!=t)return n.walking=!0,n.stop(),n.face(t),void s["default"].Ticker.after(4,function(){n.walking=!1});var o=n.facePosition;0==n.checkCollision(o.x,o.y)&&!function(){n.walking=!0;var i=n.data.x,a=n.data.y;n.data.x=o.x,n.data.y=o.y;var l=[3,3,2,3,3,2,3,3,2,3,3,2];"run"==e&&(l=[4,4,4,4,4,4,4,4]);var u=s["default"].Ticker.whiles(l.length,function(e){if(c["default"].paused)return n.data.x=i,n.data.y=a,n.walking=!1,n.emit("change"),s["default"].Ticker.clearWhiles(u),void r();if(e)n.x=o.x,n.y=o.y,n.walking=!1,n.emit("change"),r();else switch(t){case"up":n.sprite.y-=l.pop();break;case"down":n.sprite.y+=l.pop();break;case"left":n.sprite.x-=l.pop();break;case"right":n.sprite.x+=l.pop()}});n.play(e+t,1)}()}})}},{key:"erase",value:function(){var e=w(this);c["default"].layers.actorLayer.removeChild(this.sprite),c["default"].layers.infoLayer.removeChild(e.infoBox)}},{key:"draw",value:function(){var e=w(this);if(!Number.isInteger(this.x)||!Number.isInteger(this.y))throw console.error(this.data.x,this.data.y,this.data),new Error("Game.Actor.draw invalid data.x/data.y");this.x=this.data.x,this.y=this.data.y,w(this).infoBox.x=this.sprite.x,w(this).infoBox.y=this.sprite.y-this.sprite.centerY-20,c["default"].layers.actorLayer.appendChild(this.sprite),c["default"].layers.infoLayer.appendChild(e.infoBox)}},{key:"focus",value:function(){var e=w(this);e.infoBox.x=this.sprite.x,e.infoBox.y=this.sprite.y-this.sprite.centerY-20,c["default"].stage.centerX=Math.round(this.sprite.x-c["default"].config.width/2),c["default"].stage.centerY=Math.round(this.sprite.y-c["default"].config.height/2)}},{key:"data",get:function(){var e=w(this);return e.data},set:function(e){throw new Error("Game.Actor.data readonly")}},{key:"id",get:function(){return w(this).data.id},set:function(e){throw new Error("Game.Actor.id readonly")}},{key:"type",get:function(){return w(this).data.type},set:function(e){throw new Error("Game.Actor.type readonly")}},{key:"sprite",get:function(){var e=w(this);return e.sprite},set:function(e){throw new Error("Game.Actor.sprite readonly")}},{key:"quest",get:function(){var e=w(this);return e.quest?e.quest:null},set:function(e){throw new Error("Game.Actor.quests readonly")}},{key:"x",get:function(){return this.data.x},set:function(e){if(!Number.isFinite(e)||!Number.isInteger(e))throw console.error(e,w(this),this),new Error("Game.Actor got invalid x, x has to be a number and integer");this.data.x=e,this.sprite.x=32*e+16}},{key:"y",get:function(){return this.data.y},set:function(e){if(!Number.isFinite(e)||!Number.isInteger(e))throw console.error(e,w(this),this),new Error("Game.Actor got invalid y, y has to be a number and integer");this.data.y=e,this.sprite.y=32*e+16}},{key:"visible",get:function(){return this.sprite.visible},set:function(e){this.sprite.visible=e,w(this).infoBox.visible=e}},{key:"alpha",get:function(){return this.sprite.alpha},set:function(e){if(!(Number.isFinite(e)&&e>=0&&1>=e))throw console.error(e,this),new Error("Game.Actor.alpha got invalid value");this.sprite.alpha=e,w(this).infoBox.alpha=e}},{key:"position",get:function(){return{x:this.x,y:this.y}},set:function(e){throw new Error("Game.Actor.position readonly")}},{key:"direction",get:function(){return this.sprite.currentAnimation.match(/up|left|down|right/)[0]},set:function(e){throw new Error("Game.Actor.direction readonly")}},{key:"facePosition",get:function(){var e=this.position;switch(this.direction){case"up":e.y-=1;break;case"down":e.y+=1;break;case"left":e.x-=1;break;case"right":e.x+=1}return e},set:function(e){throw new Error("Game.Actor.facePosition readonly")}}]),t}(s["default"].Event);t["default"]=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(9),l=r(a),u=n(8),s=(r(u),l["default"].Util.namespace(),function(){function e(){i(this,e)}return o(e,null,[{key:"load",value:function(e){return new Promise(function(t,n){l["default"].Loader.load("quest/"+e+".js").then(function(n){var r=n[0]();r.id=e,t(r)})})}},{key:"isComplete",value:function(e){if(e.target&&e.target.kill){var t=!0,n=!1,r=void 0;try{for(var i,o=e.target.kill[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(a.current<a.need)return!1}}catch(l){n=!0,r=l}finally{try{!t&&o["return"]&&o["return"]()}finally{if(n)throw r}}}return!0}}]),e}());t["default"]=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){var n=arguments.length<=2||void 0===arguments[2]?0:arguments[2],r=arguments.length<=3||void 0===arguments[3]?0:arguments[3];if(s.has(e)){var i=s.get(e);u["default"].layers.dialogueLayer.removeChild(i.container),clearInterval(i.timer),s["delete"](e)}var o=new a["default"].Text({text:t,maxWidth:200}),l=o.width,d=o.height,c=Math.round((l+10)/2),f=new a["default"].Shape;f.polygon({points:"0,0 "+(l+10)+",0 "+(l+10)+","+(d+10)+" "+(c+5)+","+(d+10)+" "+c+","+(d+15)+" "+(c-5)+","+(d+10)+" 0,"+(d+10)+" 0,0",fill:"white"});var h=new a["default"].Container;h.appendChild(f,o),o.x=5,o.y=5,h.x=e.x+n,h.y=e.y+r,h.centerX=c,h.centerY=d+15,u["default"].layers.dialogueLayer.appendChild(h),e instanceof a["default"].Event&&e.on("change",function(){h.x=e.x+n,h.y=e.y+r});var p=setTimeout(function(){if(s.has(e)){var t=s.get(e);u["default"].layers.dialogueLayer.removeChild(t.container),s["delete"](e)}},3e3);s.set(e,{container:h,timer:p})}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=n(9),a=r(o),l=n(8),u=r(l),s=(a["default"].Util.namespace(),new Map)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=n(9),u=r(l),s=n(8),d=(r(s),n(27)),c=r(d),f=(u["default"].Util.namespace(),function(e){function t(e){return i(this,t),o(this,Object.getPrototypeOf(t).call(this,e))}return a(t,e),t}(c["default"]));t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function b(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:b(i,t,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(9),d=r(s),c=n(8),f=r(c),h=n(27),p=r(h),y=n(32),w=r(y),v=d["default"].Util.namespace(),g=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e)),r=v(n);return r.ai=null,r.beAttacking=new Set,n.on("kill",function(e){var t=e.data;n.beAttacking.has(t)&&n.beAttacking["delete"](t),t.data.exp?n.data.exp+=t.data.exp:n.data.exp+=1;var r=!0,i=!1,o=void 0;try{for(var a,l=n.data.currentQuest[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var u=a.value;if(u.target&&u.target.kill){var s=!0,d=!1,c=void 0;try{for(var f,h=u.target.kill[Symbol.iterator]();!(s=(f=h.next()).done);s=!0){var p=f.value;t.id==p.id&&p.current<p.need&&p.current++}}catch(y){d=!0,c=y}finally{try{!s&&h["return"]&&h["return"]()}finally{if(d)throw c}}}}}catch(y){i=!0,o=y}finally{try{!r&&l["return"]&&l["return"]()}finally{if(i)throw o}}}),n.on("change",function(){n.whenOnto(),n.whenTouch()}),setInterval(function(){f["default"].paused||(n.whenOnto(),n.whenTouch())},500),n}return a(t,e),l(t,[{key:"hasItem",value:function(e,t){(0==Number.isFinite(t)||0>=t)&&(t=1);for(var n in this.data.items)if(n==e)return this.data.items[n]>=t?!0:!1;return!1}},{key:"hasQuest",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.data.currentQuest[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(e==a.id)return!0}}catch(l){n=!0,r=l}finally{try{!t&&o["return"]&&o["return"]()}finally{if(n)throw r}}var u=!0,s=!1,d=void 0;try{for(var c,f=this.data.completeQuest[Symbol.iterator]();!(u=(c=f.next()).done);u=!0){var a=c.value;if(e==a.id)return!0}}catch(l){s=!0,d=l}finally{try{!u&&f["return"]&&f["return"]()}finally{if(s)throw d}}return!1}},{key:"damage",value:function(e,n){var r=this;u(Object.getPrototypeOf(t.prototype),"damage",this).call(this,e,n);var i=[],o=!0,a=!1,l=void 0;try{for(var s,d=f["default"].area.actors[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;c!=this&&"monster"==c.data.type&&1==c.distance(this)&&i.push(c)}}catch(h){a=!0,l=h}finally{try{!o&&d["return"]&&d["return"]()}finally{if(a)throw l}}i.length&&!function(){var e=!1,t=r.facePosition;i.forEach(function(n){n.hitTest(t.x,t.y)&&(e=!0)}),0==e&&r["goto"](i[0].x,i[0].y)}()}},{key:"erase",value:function(){var e=v(this);u(Object.getPrototypeOf(t.prototype),"erase",this).call(this),e.ai&&(d["default"].Ticker.off("tick",e.ai),e.ai=null)}},{key:"refreshBar",value:function(){u(Object.getPrototypeOf(t.prototype),"refreshBar",this).call(this),f["default"].windows["interface"].status(this.data.hp/this.data.$hp,this.data.sp/this.data.$sp)}},{key:"draw",value:function(){var e=this,n=v(this);u(Object.getPrototypeOf(t.prototype),"draw",this).call(this),n.ai=d["default"].Ticker.on("tick",function(t){var n=t.data;if(n%16==0){var r=!1;e.data.hp<e.data.$hp&&e.beAttacking.size<=0&&(e.data.hp++,r=!0),e.data.sp<e.data.$sp&&(e.data.sp++,r=!0),r&&(e.refreshBar(),f["default"].windows.status.atop&&f["default"].windows.status.update())}})}},{key:"gotoArea",value:function(e,t,n){var r=v(this);r.beAttacking=new Set,d["default"].Util.timeout(5).then(function(){return f["default"].pause(),f["default"].windows["interface"].hide(),f["default"].windows.stage.hide(),f["default"].windows.loading.begin(),f["default"].windows.loading.update("30%"),d["default"].Util.timeout(5)}).then(function(){return f["default"].clearStage(),f["default"].Area.load(e)}).then(function(e){return f["default"].area=e,f["default"].windows.loading.update("50%"),d["default"].Util.timeout(5)}).then(function(){return f["default"].hero.data.area=e,f["default"].hero.draw(),f["default"].hero.x=t,f["default"].hero.y=n,f["default"].area.actors.add(f["default"].hero),f["default"].area.map.draw(),f["default"].windows.loading.update("80%"),d["default"].Util.timeout(5)}).then(function(){return f["default"].hero.x=t,f["default"].hero.y=n,f["default"].hero.data.time+=60,f["default"].windows.loading.end(),f["default"].windows["interface"].datetime(),f["default"].windows["interface"].refresh(),f["default"].start(),f["default"].windows.loading.update("100%"),d["default"].Util.timeout(5)}).then(function(){f["default"].stage.update(),f["default"].windows.stage.show(),f["default"].windows["interface"].show()})}},{key:"findUnder",value:function(e){var t=this.position,n=null;if(e instanceof Array||e instanceof Set)n=e;else if(e instanceof Map)n=e.values();else{n=[];for(var r in e)n.push(e[r])}var i=!0,o=!1,a=void 0;try{for(var l,u=n[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var s=l.value;if(s!=this){if(s.hitTest&&s.hitTest(t.x,t.y))return s;if(s.points){var d=!0,c=!1,f=void 0;try{for(var h,p=s.points[Symbol.iterator]();!(d=(h=p.next()).done);d=!0){var y=h.value;if(y.x==t.x&&y.y==t.y)return s}}catch(w){c=!0,f=w}finally{try{!d&&p["return"]&&p["return"]()}finally{if(c)throw f}}}else if(Number.isFinite(s.x)&&Number.isFinite(s.y)&&s.x==t.x&&s.y==t.y)return s}}}catch(w){o=!0,a=w}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw a}}return null}},{key:"findFace",value:function(e){var t=this.facePosition,n=null;if(e instanceof Array||e instanceof Set)n=e;else if(e instanceof Map)n=e.values();else{n=[];for(var r in e)n.push(e[r])}var i=!0,o=!1,a=void 0;try{for(var l,u=n[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var s=l.value;if(s!=this&&s.heroUse){if(s.hitTest&&s.hitTest(t.x,t.y))return s;if(s.points){var d=!0,c=!1,f=void 0;try{for(var h,p=s.points[Symbol.iterator]();!(d=(h=p.next()).done);d=!0){var y=h.value;if(y.x==t.x&&y.y==t.y)return s}}catch(w){c=!0,f=w}finally{try{!d&&p["return"]&&p["return"]()}finally{if(c)throw f}}}else if(Number.isFinite(s.x)&&Number.isFinite(s.y)&&s.x==t.x&&s.y==t.y)return s}}}catch(w){o=!0,a=w}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw a}}return null}},{key:"whenOnto",value:function(){if(f["default"].area&&f["default"].area.onto){var e=this.findUnder(f["default"].area.onto);e&&e.execute&&e.execute()}}},{key:"whenTouch",value:function(){if(f["default"].area&&f["default"].area.touch){var e=f["default"].hero.facePosition,t=this.findUnder(f["default"].area.actors)||this.findUnder(f["default"].area.bags)||this.findUnder(f["default"].area.items)||this.findUnder(f["default"].area.touch)||this.findFace(f["default"].area.actors)||this.findFace(f["default"].area.bags)||this.findFace(f["default"].area.items)||this.findFace(f["default"].area.touch);!t&&f["default"].area.map.hitWater(e.x,e.y)&&(t={type:"water",heroUse:function(){(0,w["default"])({"喝水":"drink","钓鱼":"fish"}).then(function(e){switch(e){case"drink":f["default"].hero.popup("drink");break;case"fish":f["default"].hero.popup("fish")}})}}),t?(f["default"].hintObject=t,
f["default"].windows["interface"].showUse()):(f["default"].hintObject=null,f["default"].windows["interface"].hideUse())}}},{key:"beAttacking",get:function(){return v(this).beAttacking},set:function(e){throw new Error("Game.hero.beAttacking readonly")}}]),t}(p["default"]);t["default"]=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){return new Promise(function(t,n){var r=a["default"].create("choiceWindow");r.css=u["default"],r.html=d["default"],r.show();var i=r.querySelector("#choiceWindowButtonContainer"),o=r.querySelector("#choiceWindowNo"),l=[];Object.keys(e).forEach(function(n){var o=e[n],a=document.createElement("button");a.textContent=l.length+1+". "+n,a.classList.add("brownButton"),i.appendChild(a),l.push(a),a.addEventListener("click",function(){r.hide(),r.destroy(),t(o)})}),o.addEventListener("click",function(){r.hide(),r.destroy(),t(null)}),r.whenUp(["esc"],function(){setTimeout(function(){o.click()},20)}),r.whenUp(["1","2","3","4","5","6","7","8","9"],function(e){var t=parseInt(e)-1,n=l[t];n&&n.click()})})}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=n(33),a=r(o),l=n(34),u=r(l),s=n(36),d=r(s)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(){var e=window.innerWidth,t=window.innerHeight,n=1,r=0,i=0;if(0==f["default"].config.scale)r=Math.floor((e-f["default"].config.width)/2),i=Math.floor((t-f["default"].config.height)/2);else{var o=f["default"].config.width/f["default"].config.height,a=e,l=a/o;l>t&&(l=t,a=l*o),a=Math.floor(a),l=Math.floor(l),r=Math.floor((e-a)/2),i=Math.floor((t-l)/2),n=Math.min(a/f["default"].config.width,l/f["default"].config.height)}var u=w.style;u.left=r+"px",u.top=i+"px",u.transformOrigin="left top 0",u.webkitTransformOrigin="left top 0",u.transform="scale("+n+", "+n+") translateZ(0)",u.webkitTransform="scale("+n+", "+n+") translateZ(0)",u.filter="none",u.webkitFilter="blur(0px)"}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=n(9),d=r(s),c=n(8),f=r(c),h=d["default"].Util.namespace(),p=new Set,y=227,w=document.createElement("div");w.style.width=f["default"].config.width+"px",w.style.height=f["default"].config.height+"px",w.style.position="fixed",document.body.appendChild(w);var v=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this)),r=h(n);return r.id=e,r.css=document.createElement("style"),r.html=document.createElement("div"),r.index=-1,r.elements={},r.html.id="GW"+Math.random().toString(16).substr(2),r.html.classList.add(e),r.html.classList.add("game-window"),r.html.style.display="none",w.appendChild(r.html),document.head.appendChild(r.css),r.html.addEventListener("mousedown",function(e){var t=e.clientX,r=e.clientY,i=null,o=null,a=null;if(w.style.left){var l=w.style.left.match(/(\d+)px/);l&&(i=parseInt(l[1]))}if(w.style.top){var l=w.style.top.match(/(\d+)px/);l&&(o=parseInt(l[1]))}if(w.style.transform){var l=w.style.transform.match(/scale\(([\d\.]+), ([\d\.]+)\)/);a=l?parseFloat(l[1]):1}else a=1;Number.isFinite(i)&&Number.isFinite(o)&&Number.isFinite(a)&&(t-=i,r-=o,t/=a,r/=a,n.emit("mousedown",!1,{x:t,y:r}))}),p.add(n),n}return a(t,e),u(t,null,[{key:"create",value:function(e){var n=new t(e);return n}}]),u(t,[{key:"destroy",value:function(){var e=h(this);this.showing&&this.hide(),e.html&&(e.html.parentNode.removeChild(e.html),e.html=null),e.css&&(document.head.removeChild(e.css),e.css=null),p.has(this)&&p["delete"](this)}},{key:"whenPress",value:function(e,t){var n=this;return d["default"].Input.whenPress(e,function(e){n.atop&&t(e)}),this}},{key:"whenUp",value:function(e,t){var n=this;return d["default"].Input.whenUp(e,function(e){n.atop&&t(e)}),this}},{key:"whenDown",value:function(e,t){var n=this;return d["default"].Input.whenDown(e,function(e){n.atop&&t(e)}),this}},{key:"assign",value:function(e,t){return Object.defineProperty(this,e,{enumerable:!1,configurable:!1,writable:!1,value:t}),this}},{key:"show",value:function(){var e=h(this);if(l(),0==this.showing&&e.html){this.emit("beforeShow");var t=!0,n=!1,r=void 0;try{for(var i,o=p[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;a.atop&&a.emit("deactive")}}catch(u){n=!0,r=u}finally{try{!t&&o["return"]&&o["return"]()}finally{if(n)throw r}}e.index=y,e.html.style.zIndex=e.index,e.html.style.display="block",y++,this.emit("afterShow"),this.emit("active")}return this}},{key:"hide",value:function(){var e=h(this);if(e.html){this.emit("beforeHide"),e.index=-1,this.emit("afterHide"),this.emit("deactive"),e&&e.html&&(e.html.style.zIndex=e.index,e.html.style.display="none");var t=!0,n=!1,r=void 0;try{for(var i,o=p[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;a.atop&&a.emit("active")}}catch(l){n=!0,r=l}finally{try{!t&&o["return"]&&o["return"]()}finally{if(n)throw r}}}return this}},{key:"querySelector",value:function(e){return h(this).html.querySelector(e)}},{key:"querySelectorAll",value:function(e){return h(this).html.querySelectorAll(e)}},{key:"appendChild",value:function(e){return h(this).html.appendChild(e),this}},{key:"removeChild",value:function(e){return h(this).html.removeChild(e),this}},{key:"index",get:function(){return h(this).index},set:function(e){throw console.error(this),new Error("GameWindow.index readonly")}},{key:"showing",get:function(){var e=h(this);return e.html&&"none"!=e.html.style.display?!0:!1},set:function(e){throw new Error("GameWindow.showing readonly")}},{key:"atop",get:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=p[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(o.showing&&o.index>this.index)return!1}}catch(a){t=!0,n=a}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw n}}return!0},set:function(e){throw new Error("GameWindow.atop readonly")}},{key:"html",get:function(){return h(this).html.innerHTML},set:function(e){h(this).html.innerHTML=e}},{key:"css",get:function(){return h(this).css.innerHTML},set:function(e){h(this).css.innerHTML=e}},{key:"elements",get:function(){return h(this).elements},set:function(e){throw new Error("GameWindow.elements readonly")}}]),t}(d["default"].Event);t["default"]=v,l(),window.addEventListener("resize",function(){l()})},function(e,t,n){var r=n(35);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,".choiceWindow,.choiceWindow div{text-align:center}button#choiceWindowNo{position:absolute;right:100px;top:50px;width:100px;height:60px;font-size:30px}#choiceWindowTable button{margin:5px auto;min-width:300px;min-height:60px;font-size:30px;display:block}",""])},function(e,t){e.exports='<div class=window-box><button id=choiceWindowNo class=brownButton>取消</button><div style="width: 100%; height: 100%"><div style="height: 370px; overflow-y: auto; text-align: center"><table id=choiceWindowTable style="width: 100%; height: 370px"><tbody><tr><td id=choiceWindowButtonContainer></table></div></div></div>'},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function v(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:v(i,t,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(9),d=r(s),c=n(8),f=r(c),h=n(27),p=r(h),y=d["default"].Util.namespace(),w=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e)),r=y(n);return r.ai=null,r.attacking=!1,n}return a(t,e),l(t,[{key:"damage",value:function(e,n){u(Object.getPrototypeOf(t.prototype),"damage",this).call(this,e,n);var r=y(this);0==r.attacking&&this["goto"](e.x,e.y,"walk")}},{key:"erase",value:function(){var e=y(this);u(Object.getPrototypeOf(t.prototype),"erase",this).call(this),e.ai&&(d["default"].Ticker.off("tick",e.ai),e.ai=null)}},{key:"draw",value:function(){var e=this,n=y(this);u(Object.getPrototypeOf(t.prototype),"draw",this).call(this);var r=d["default"].rand(30,60);n.ai=d["default"].Ticker.on("tick",function(t){if(!f["default"].paused){var i=t.data;if(i%20==0){var o=!1;e.data.hp<e.data.$hp&&0==n.attacking&&(e.data.hp++,o=!0),e.data.sp<e.data.$sp&&(e.data.sp++,o=!0),o&&e.refreshBar()}if(n.attacking)i%r==0?f["default"].hero&&e.facePosition.x==f["default"].hero.x&&e.facePosition.y==f["default"].hero.y&&(e.y==f["default"].hero.y?e.x<f["default"].hero.x?e.fire(e.data.skills[0],"right"):e.fire(e.data.skills[0],"left"):e.y<f["default"].hero.y?e.fire(e.data.skills[0],"down"):e.fire(e.data.skills[0],"up")):f["default"].hero&&f["default"].hero.distance(e)<12?e["goto"](f["default"].hero.x,f["default"].hero.y,"walk"):(n.attacking=!1,f["default"].hero.beAttacking.has(e)&&f["default"].hero.beAttacking["delete"](e));else if(i%r==0)if(f["default"].hero&&f["default"].hero.distance(e)<8)e["goto"](f["default"].hero.x,f["default"].hero.y,"walk"),n.attacking=!0,f["default"].hero.beAttacking.add(e);else if("patrol"==e.data.mode){if(Math.random()>.3)return void e.stop();var a=["down","left","right","up"];e.go("walk",a[Math.floor(Math.random()*a.length)]).then(function(){e.stop()})}}})}}]),t}(p["default"]);t["default"]=w},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(9),s=r(u),d=n(8),c=r(d),f=n(27),h=r(f),p=n(39),y=r(p),w=n(32),v=r(w),g=(s["default"].Util.namespace(),function(e){function t(e){return i(this,t),o(this,Object.getPrototypeOf(t).call(this,e))}return a(t,e),l(t,[{key:"heroUse",value:function(){var e=this,t=this.data,n={},r={};if(t.contact){var i=!0,o=!1,a=void 0;try{for(var l,u=t.contact[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var s=l.value,d=!0;if("function"==typeof s.condition)try{d=s.condition()}catch(f){throw console.error(this.id,this.data),console.error(s.condition),console.error(s.condition.toString()),f}d&&(n[s.name]=s.name,r[s.name]=s)}}catch(h){o=!0,a=h}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw a}}}var p=null;this.quest&&(p=this.quest.filter(function(e){return c["default"].hero.hasQuest(e.id)?!1:!0}),p&&p.length&&(n["任务"]="quest"));var w=null;if(c["default"].hero.data.currentQuest.length){w=[];var g=!0,b=!1,m=void 0;try{for(var x,k=c["default"].hero.data.currentQuest[Symbol.iterator]();!(g=(x=k.next()).done);g=!0){var A=x.value;console.log(c["default"].Quest.isComplete(A),A.to,this.id),A.to==this.id&&c["default"].Quest.isComplete(A)&&w.push(A)}}catch(h){b=!0,m=h}finally{try{!g&&k["return"]&&k["return"]()}finally{if(b)throw m}}w.length>0&&(n["完成任务"]="completeQuest")}t.trade&&t.items&&(n["交易"]="trade"),Object.keys(n).length<=0||(0,v["default"])(n).then(function(n){switch(n){case"trade":e.heroUse(),c["default"].windows.buy.open(t.items);break;case"quest":var i={};p.forEach(function(e,t){i[e.name]=t}),(0,v["default"])(i).then(function(t){Number.isInteger(t)?!function(){var n=p[t];(0,y["default"])({message:n.before,yes:"接受任务",no:"拒绝"}).then(function(){c["default"].hero.data.currentQuest.push(n),e.heroUse()})["catch"](function(){e.heroUse()})}():e.heroUse()});break;case"completeQuest":var o={};w.forEach(function(e,t){o[e.name]=t}),(0,v["default"])(o).then(function(n){if(Number.isInteger(n)){var r=w[n];c["default"].hero.data.currentQuest.splice(c["default"].hero.data.currentQuest.indexOf(r),1),c["default"].hero.data.completeQuest.push(r),e.heroUse(),c["default"].dialogue([r.finish],t.name),r.reward&&(r.reward.gold&&(c["default"].hero.data.gold+=r.reward.gold),r.reward.exp&&(c["default"].hero.data.exp+=r.reward.exp))}});break;default:r[n]&&(e.heroUse(),c["default"].dialogue(r[n].content,t.name))}})}}]),t}(h["default"]));t["default"]=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){return new Promise(function(t,n){var r=a["default"].create("confirmWindow");r.css=u["default"],r.html=d["default"],r.show();var i=r.querySelector("#confirmWindowMessage"),o=r.querySelector("#confirmWindowYes"),l=r.querySelector("#confirmWindowNo");if("string"==typeof e)i.textContent=e;else{if(!e.message)throw new Error("Confirm got invalid arguments");i.textContent=e.message,e.yes&&(o.textContent=e.yes),e.no&&(l.textContent=e.no)}r.whenUp(["esc"],function(){setTimeout(function(){l.click()},20)}),r.whenUp(["y","Y"],function(){o.click()}),r.whenUp(["n","N"],function(){l.click()}),o.addEventListener("click",function(){r.destroy(),t()}),l.addEventListener("click",function(){r.destroy(),n()})})}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=n(33),a=r(o),l=n(40),u=r(l),s=n(42),d=r(s)},function(e,t,n){var r=n(41);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,".confirmWindow{text-align:center}.confirmWindow table{width:100%;height:100%}.confirmWindow span{font-size:16px}.confirmWindow button{width:100px;height:60px;font-size:16px;margin:20px}#confirmWindowMessage{color:#000;font-size:20px}",""])},function(e,t){e.exports='<div class=window-box><div style="width: 100%; height: 100%"><table><tr><td><span id=confirmWindowMessage></span><tr><td><button id=confirmWindowYes class=brownButton>确定</button> <button id=confirmWindowNo class=brownButton>取消</button></table></div></div>'},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=n(9),u=r(l),s=n(8),d=(r(s),n(27)),c=r(d),f=(u["default"].Util.namespace(),function(e){function t(e){return i(this,t),o(this,Object.getPrototypeOf(t).call(this,e))}return a(t,e),t}(c["default"]));t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(9),l=r(a),u=n(8),s=r(u),d=n(45),c=r(d),f=(l["default"].Util.namespace(),function(){function e(){i(this,e)}return o(e,null,[{key:"remove",value:function(e){window.localStorage.getItem(e)&&window.localStorage.removeItem(e)}},{key:"list",value:function(){var e=[];for(var t in window.localStorage)t.match(/^SAVE_(\d+)$/)&&e.push(parseInt(t.match(/^SAVE_(\d+)$/)[1]));return e.sort(),e.reverse(),e}},{key:"last",value:function(){var t=e.list();if(t.length>0){var n=t[0];return JSON.parse(window.localStorage.getItem("SAVE_"+n))}return null}},{key:"clear",value:function(){for(var e in window.localStorage)e.match(/^SAVE_(\d+)$/)&&window.localStorage.removeItem(e)}},{key:"save",value:function(e){var t=new Date,n=t.getTime();e.id=n,e.name=e.hero.name,e.date=t.toLocaleString(),window.localStorage.setItem("SAVE_"+n,JSON.stringify(e))}},{key:"get",value:function(e){return e&&window.localStorage.getItem(e)?JSON.parse(window.localStorage.getItem(e)):null}},{key:"load",value:function(t){var n=e.get(t);if(n||(n=e.last()),!n)throw console.error("id:",t),new Error("Invalid id, GameArchive.load");s["default"].windows["interface"].showing&&s["default"].windows["interface"].hide(),s["default"].windows.main.hide(),s["default"].windows.loading.begin(),setTimeout(function(){var e=n.hero;(0,c["default"])(e.custom).then(function(t){e.image=t,s["default"].hero=new s["default"].ActorHero(e),s["default"].hero.on("complete",function(){s["default"].hero.gotoArea(e.area,e.x,e.y)})})},20)}}]),e}());t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){return new Promise(function(r,i){var o=document.createElement("canvas");o.height=n,o.width=t;var a=o.getContext("2d");a.clearRect(0,0,t,n);for(var l=e.length-1,u=0;l>u;u++){var s=e[u];a.drawImage(s,0,0,s.width,s.height,0,0,t,n)}var d=null,c=null,f=new Set;d=new Image,d.src=o.toDataURL("image/png"),f.add(new Promise(function(e,t){d.complete?e():d.onload=function(){e()}})),a.drawImage(e[l],0,0,e[l].width,e[l].height,0,0,t,n),c=new Image,c.src=o.toDataURL("image/png"),f.add(new Promise(function(e,t){c.complete?e():c.onload=function(){e()}})),Promise.all(f).then(function(){r([d,c])})})}function o(e){return"string"==typeof e&&e.length>0?!0:!1}function a(e){return new Promise(function(t,n){var r="hero",a=[];o(e.sex)&&o(e.body)&&(a.push(r+"/body/"+e.sex+"/"+e.body+".png"),o(e.eyes)&&a.push(r+"/body/"+e.sex+"/eyes/"+e.eyes+".png"),o(e.shirts)&&a.push(r+"/shirts/"+e.sex+"/"+e.shirts+".png"),o(e.pants)&&a.push(r+"/pants/"+e.sex+"/"+e.pants+".png"),o(e.shoes)&&a.push(r+"/shoes/"+e.sex+"/"+e.shoes+".png"),o(e.armorchest)&&a.push(r+"/armor/chest/"+e.sex+"/"+e.armorchest+".png"),o(e.armorarm)&&a.push(r+"/armor/arm/"+e.sex+"/"+e.armorarm+".png"),o(e.armorlegs)&&a.push(r+"/armor/legs/"+e.sex+"/"+e.armorlegs+".png"),o(e.armorfeet)&&a.push(r+"/armor/feet/"+e.sex+"/"+e.armorfeet+".png"),o(e.hair)&&o(e.haircolor)&&a.push(r+"/hair/"+e.sex+"/"+e.hair+"/"+e.haircolor+".png"),o(e.head)&&a.push(r+"/head/"+e.sex+"/"+e.head+".png"),o(e.armorhelms)&&a.push(r+"/armor/helms/"+e.sex+"/"+e.armorhelms+".png"),a.push(r+"/weapons/"+e.sex+"/weapons.png")),u["default"].Loader.load(a).then(function(n){i(n,e.width,e.height).then(function(e){t(e)})})})}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var l=n(9),u=r(l);u["default"].Util.namespace()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){return new Promise(function(e,t){var n=new Set,r={hurt:"sound/effect/hurt.ogg"};for(var i in r)n.add(function(e,t){return new Promise(function(n,r){c["default"].sounds&&c["default"].sounds[e]?n():s["default"].Loader.load(t).then(function(t){c["default"].sounds[e]=t[0],n()})})}(i,r[i]));var o=["bag","gold"];o.forEach(function(e){n.add(new Promise(function(t,n){c["default"].items&&c["default"].items[e]?t():c["default"].Item.load(e).then(function(e){t()})}))}),Promise.all(n).then(e,t)})}var a=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){i=!0,o=u}finally{try{!r&&l["return"]&&l["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(9),s=r(u),d=n(8),c=r(d),f=(s["default"].Util.namespace(),function(){function e(){i(this,e)}return l(e,null,[{key:"load",value:function(e){return new Promise(function(t,n){Promise.all([c["default"].Map.load(e),o()]).then(function(e){var t=a(e,1),n=t[0];return{actors:new Set,bags:new Set,items:new Set,touch:[],onto:[],map:n}}).then(function(e){var n=new Set;if(e.map.data.actors&&e.map.data.actors.forEach(function(t){n.add(c["default"].Actor.load(t.id).then(function(n){for(var r in t)n.data[r]=t[r];e.actors.add(n),n.draw()}))}),e.map.spawnMonster&&e.map.spawnMonster.list&&e.map.spawnMonster.count)for(var r in e.map.spawnMonster.list)n.add(c["default"].Actor.load(r));if(e.map.spawnItem&&e.map.spawnItem.list&&e.map.spawnItem.count)for(var i in e.map.spawnItem.list)n.add(c["default"].Item.load(i));e.map.data.onto&&e.map.data.onto.forEach(function(t){e.onto.push(t)}),e.map.data.touch&&e.map.data.touch.forEach(function(t){e.touch.push(t)}),Promise.all(n).then(function(){t(e)})})})}}]),e}());t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n,r){return Math.abs(e-n)+Math.abs(t-r)}function a(e,t,n,r,i){var a={key:1e4*e+t,x:e,y:t,g:r.g+i,h:o(e,t,n.x,n.y),front:[]};a.f=a.g+a.h;var l=r.front.length;a.front.length=l;for(var u=0;l>u;u++)a.front[u]=r.front[u];return a.front.push(r.x),a.front.push(r.y),a}function l(e,t,n){var r=new p(function(e){return e.f}),i=new Set,l=new Set,u={key:1e4*t.x+t.y,x:t.x,y:t.y,f:0,g:0,h:o(t.x,t.y,n.x,n.y),front:[]};i.add(u.key),r.push(u);for(var s=function(t,n,o,u){if(!e(t,n)){var s=1e4*t+n;i.has(s)||l.has(s)||(i.add(s),r.push(a(t,n,o,u,10)))}};r.size;){var d=r.pop();if(r["delete"](d),i["delete"](d.key),l.add(d.key),d.x==n.x&&d.y==n.y){for(var c=[],f=0,h=d.front.length;h>f;f+=2)c.push({x:d.front[f],y:d.front[f+1]});return c.push({x:n.x,y:n.y}),c}s(d.x,d.y-1,n,d),s(d.x,d.y+1,n,d),s(d.x-1,d.y,n,d),s(d.x+1,d.y,n,d)}return null}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=n(9),d=r(s),c=n(8),f=r(c),h=(d["default"].Util.namespace(),function(){function e(){i(this,e)}return u(e,null,[{key:"getPath",value:function(e,t){return new Promise(function(n,r){var i={},o=!0,a=!1,u=void 0;try{for(var s,d=f["default"].area.actors[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;(c.x!=e.x||c.y!=e.y)&&(i[1e4*c.x+c.y]=!0)}}catch(h){a=!0,u=h}finally{try{!o&&d["return"]&&d["return"]()}finally{if(a)throw u}}var p=l(function(e,t){if(0>e||e>=f["default"].area.map.col)return!0;if(0>t||t>=f["default"].area.map.row)return!0;var n=1e4*e+t;return f["default"].area.map.blockedMap[n]?!0:i[n]?!0:!1},e,t);n(p)})}}]),e}());t["default"]=h;var p=function(){function e(t){i(this,e),this.content=[],this.scoreFunction=t,this.scores=new Map}return u(e,[{key:"push",value:function(e){this.scores.set(e,this.scoreFunction(e)),this.content.push(e),this.bubbleUp(this.content.length-1)}},{key:"pop",value:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e}},{key:"delete",value:function(e){for(var t=0,n=this.content.length;n>t;t++)if(this.content[t]==e){this.scores["delete"](this.content[t]);var r=this.content.pop();if(t==n-1)break;this.content[t]=r,this.bubbleUp(t),this.sinkDown(t);break}}},{key:"bubbleUp",value:function(e){for(var t=this.content[e],n=this.scores.get(t);e>0;){var r=Math.floor((e+1)/2)-1,i=this.content[r];if(n>=this.scores.get(i))break;this.content[r]=t,this.content[e]=i,e=r}}},{key:"sinkDown",value:function(e){for(var t=this.content.length,n=this.content[e],r=this.scores.get(n);;){var i=2*(e+1),o=i-1,a=null,l=void 0,u=void 0;if(t>o){var s=this.content[o];l=this.scores.get(s),r>l&&(a=o)}if(t>i){var d=this.content[i];u=this.scores.get(d),(null==a?r:l)>u&&(a=i)}if(null==a)break;this.content[e]=this.content[a],this.content[a]=n,e=a}}},{key:"size",get:function(){return this.content.length},set:function(e){throw new Error("BinaryHeap.size readonly")}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){if(!d["default"].paused){var e="run";u["default"].Input.isPressed("shift")&&(e="walk"),u["default"].Input.isPressed("left")?d["default"].hero.go(e,"left").then(o):u["default"].Input.isPressed("up")?d["default"].hero.go(e,"up").then(o):u["default"].Input.isPressed("right")?d["default"].hero.go(e,"right").then(o):u["default"].Input.isPressed("down")&&d["default"].hero.go(e,"down").then(o)}}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var l=n(9),u=r(l),s=n(8),d=r(s),c=(u["default"].Util.namespace(),null),f=function(){function e(){i(this,e)}return a(e,null,[{key:"clearDest",value:function(){c.visible=!1}},{key:"setDest",value:function(e,t){c.x=32*e+16,c.y=32*t+16,c.visible=!0}},{key:"init",value:function(){c=new u["default"].Shape,c.circle({cx:5,cy:5,r:5,stroke:"red",fill:"green"}),c.visible=!1,c.centerX=5,c.centerY=5,d["default"].windows.stage.on("mousedown",function(e){var t=e.data;t.x+=d["default"].stage.centerX,t.y+=d["default"].stage.centerY,t.x=Math.floor(t.x/32),t.y=Math.floor(t.y/32),d["default"].layers.infoLayer.hasChild(c)||d["default"].layers.infoLayer.appendChild(c),(d["default"].hero.x!=t.x||d["default"].hero.y!=t.y)&&d["default"].hero["goto"](t.x,t.y,"run").then(function(){c.visible=!1,d["default"].hintObject&&d["default"].hintObject.heroUse&&d["default"].hintObject.heroUse()})}),u["default"].Ticker.on("tick",function(){d["default"].paused||d["default"].hero&&d["default"].area&&d["default"].area.map&&(o(),d["default"].hero.walking||d["default"].hero.stop(),d["default"].hero.focus())})}}]),e}();t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(9),s=r(u),d=n(8),c=r(d),f=s["default"].Util.namespace(),h=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this)),r=f(n);return r.data=e,r.inner=null,n.data.x&&n.data.y||(n.data.x=0,n.data.y=0),n.data.image?s["default"].Loader.load("item/"+n.data.image).then(function(e){var t=e[0];if(r.icon=t,r.bitmap=new s["default"].Bitmap(t),r.bitmap.x=32*n.data.x+16,r.bitmap.y=32*n.data.y+16,r.bitmap.name=n.id,!Number.isInteger(n.data.centerX)||!Number.isInteger(n.data.centerY))throw console.log(n.data),new Error("Game.Item invalid centerX/centerY");r.bitmap.centerX=n.data.centerX,r.bitmap.centerY=n.data.centerY,n.emit("complete",!0)}):n.emit("complete",!0),n}return a(t,e),l(t,null,[{key:"load",value:function(e){return new Promise(function(t,n){s["default"].Loader.load("item/"+e+".js").then(function(n){var r=n[0]();r.id=e;var i=new c["default"].Item(r);c["default"].items[e]=i,i.on("complete",function(){t(i)})})})}}]),l(t,[{key:"hitTest",value:function(e,t){if(this.data.hitArea&&this.data.hitArea instanceof Array){var n=!0,r=!1,i=void 0;try{for(var o,a=this.data.hitArea[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var l=o.value;if(e==this.x+l[0]&&t==this.y+l[1])return!0}}catch(u){r=!0,i=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw i}}return!1}throw console.error(this.data),new Error("Game.Actor.hitTest invalid data")}},{key:"heroUse",value:function(){if(this.inner&&(this.data.pickupCondition?this.data.pickupCondition()&&c["default"].windows.pickup.open(this):c["default"].windows.pickup.open(this)),"function"==typeof this.data.use&&this.data.use(),"potion"==this.data.type){for(var e in this.data.potion){var t=this.data.potion[e];"hp"==e&&!function(){c["default"].hero.data.hp=Math.min(c["default"].hero.data.hp+t,c["default"].hero.data.$hp);var e=new s["default"].Text({text:"hp+"+t,color:"black",fontSize:20});e.centerX=Math.floor(e.width/2),e.centerY=Math.floor(e.height),e.x=c["default"].hero.sprite.x,e.y=c["default"].hero.sprite.y,c["default"].layers.actorLayer.appendChild(e),s["default"].Ticker.whiles(100,function(t){e.y-=3,t&&c["default"].layers.actorLayer.removeChild(e)})}()}c["default"].hero.data.items[this.id]--,c["default"].hero.data.items[this.id]<=0&&delete c["default"].hero.data.items[this.id]}}},{key:"erase",value:function(e){c["default"].layers.itemLayer.removeChild(f(this).bitmap)}},{key:"draw",value:function(){c["default"].layers.itemLayer.appendChild(f(this).bitmap)}},{key:"id",get:function(){return f(this).data.id},set:function(e){throw new Error("Game.Item.id readonly")}},{key:"icon",get:function(){return f(this).bitmap?f(this).bitmap.image:null},set:function(e){throw new Error("Game.Item.icon readonly")}},{key:"data",get:function(){return f(this).data},set:function(e){throw console.error(this),new Error("Game.Item.data readonly")}},{key:"inner",get:function(){
return f(this).inner},set:function(e){f(this).inner=e}},{key:"x",get:function(){return f(this).data.x},set:function(e){var t=f(this);t.data.x=e,t.bitmap.x=32*e+16}},{key:"y",get:function(){return f(this).data.y},set:function(e){var t=f(this);t.data.y=e,t.bitmap.y=32*e+16}},{key:"visible",get:function(){return f(this).bitmap.visible},set:function(e){f(this).bitmap.visible=e}},{key:"alpha",get:function(){return f(this).bitmap.alpha},set:function(e){if(!(Number.isFinite(e)&&e>=0&&1>=e))throw console.error(e,this),new Error("Game.Item.alpha got invalid value");f(this).bitmap.alpha=e}},{key:"position",get:function(){return{x:this.x,y:this.y}},set:function(e){throw console.error(this.data),new Error("Game.Item.position readonly")}}]),t}(s["default"].Event);t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){i=!0,o=u}finally{try{!r&&l["return"]&&l["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=n(9),d=r(s),c=n(8),f=r(c),h=d["default"].Util.namespace(),p=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this)),r=h(n);r.data=e;var a=[],l=!0,u=!1,s=void 0;try{for(var c,f=r.data.tilesets[Symbol.iterator]();!(l=(c=f.next()).done);l=!0){var p=c.value;a.push("map/"+p.image)}}catch(y){u=!0,s=y}finally{try{!l&&f["return"]&&f["return"]()}finally{if(u)throw s}}return d["default"].Loader.load(a).then(function(e){r.data.tilesets=null,r.sheet=new d["default"].Sheet({images:e,width:r.data.tilewidth,height:r.data.tileheight}),r.waterMap={},r.blockedMap={},r.layers=[];var t=!0,i=!1,o=void 0;try{for(var a,l=r.data.layers[Symbol.iterator]();!(t=(a=l.next()).done);t=!0){var u=a.value,s=null;"block"!=u.name&&(s=new d["default"].Container,s.name=u.name,r.layers.push(s));for(var c=n.col,f=n.row,h=0;f>h;h++)for(var p=0;c>p;p++){var y=p+h*c,w=1e4*p+h,v=u.data[y]-1;if(v>=0)if("block"==u.name)r.blockedMap[w]=!0;else{var g=r.sheet.getFrame(v);g.x=p*r.data.tilewidth,g.y=h*r.data.tileheight,s.appendChild(g),"water"==u.name&&(r.waterMap[w]=!0)}}}}catch(b){i=!0,o=b}finally{try{!t&&l["return"]&&l["return"]()}finally{if(i)throw o}}n.emit("complete",!0)}),n}return a(t,e),u(t,[{key:"hitTest",value:function(e,t){return h(this).blockedMap[1e4*e+t]?!0:!1}},{key:"hitWater",value:function(e,t){return h(this).waterMap[1e4*e+t]?!0:!1}},{key:"blockedMap",get:function(){return h(this).blockedMap},set:function(e){throw new Error("Game.Map.blockedMap readonly")}}],[{key:"load",value:function(e){return new Promise(function(t,n){d["default"].Loader.load("map/"+e+".json","map/"+e+".js").then(function(n){var r=l(n,2),i=r[0],o=r[1];o=o(),i.id=e;for(var a in o){if(i.hasOwnProperty(a))throw console.log(a,i[a],o[a],o,i),new Error("Game.loadArea invalid data");i[a]=o[a]}var u=new f["default"].Map(i);u.on("complete",function(){t(u)})})})}}]),u(t,[{key:"tile",value:function(e,t){if(Number.isFinite(e)&&Number.isFinite(t))return{x:Math.floor(e/this.data.tilewidth),y:Math.floor(t/this.data.tileheight)};throw console.error(e,t,this.data),new Error("Game.Map.tile got invalid arguments")}},{key:"draw",value:function(){var e=this,t=h(this);f["default"].layers.mapLayer.clear(),t.layers.forEach(function(e,n){var r=t.data.layers[n];Number.isFinite(r.opacity)&&(e.alpha=r.opacity),f["default"].layers.mapLayer.appendChild(e)}),t.layers=null,t.data.layers=null,f["default"].layers.mapLayer.cache(this.width,this.height);var n=new d["default"].Bitmap(f["default"].layers.mapLayer.cacheCanvas);f["default"].layers.mapLayer.clear(),f["default"].layers.mapLayer.appendChild(n);var r=document.createElement("canvas");r.width=8*this.col,r.height=8*this.row;var i=r.getContext("2d");i.drawImage(n.image,0,0,n.width,n.height,0,0,r.width,r.height),t.minimap=r,t.data.bgm;var o={};if(t.data.actors){var a=!0,l=!1,u=void 0;try{for(var s,c=t.data.actors[Symbol.iterator]();!(a=(s=c.next()).done);a=!0){var p=s.value;o[1e4*p.x+p.y]=!0}}catch(y){l=!0,u=y}finally{try{!a&&c["return"]&&c["return"]()}finally{if(l)throw u}}}if(t.data.spawnMonster&&t.data.spawnMonster.list&&t.data.spawnMonster.count)for(var w=0,v=t.data.spawnMonster.count;v>w;w++){var g=null,b=0,m=Math.random();for(var x in t.data.spawnMonster.list)if(b+=t.data.spawnMonster.list[x],b>m){g=x;break}g||(g=Object.keys(t.data.spawnMonster.list)[0]),f["default"].Actor.load(g).then(function(t){for(var n=void 0,r=void 0;;)if(n=d["default"].rand(0,e.col),r=d["default"].rand(0,e.row),!e.hitTest(n,r)&&!o[1e4*n+r])break;o[1e4*n+r]=!0,t.x=n,t.y=r,f["default"].area.actors.add(t),t.draw()})}if(t.data.spawnItem&&t.data.spawnItem.list&&t.data.spawnItem.count)for(var k=function(n,r){var i=null,a=0,l=Math.random();for(var u in t.data.spawnItem.list)if(a+=t.data.spawnItem.list[u],a>l){i=u;break}i||(i=Object.keys(t.data.spawnItem.list)[0]),f["default"].Item.load(i).then(function(t){for(var n=void 0,r=void 0;;)if(n=d["default"].rand(0,e.col),r=d["default"].rand(0,e.row),!e.hitTest(n,r)&&!o[1e4*n+r])break;o[1e4*n+r]=!0,t.x=n,t.y=r,t.inner={},t.inner[i]=1,f["default"].area.items.add(t),t.draw()})},w=0,v=t.data.spawnItem.count;v>w;w++)k(w,v)}},{key:"data",get:function(){return h(this).data},set:function(e){throw new Error("Game.Map.data readonly")}},{key:"id",get:function(){return h(this).id},set:function(e){throw new Error("Game.Map.id readonly")}},{key:"width",get:function(){return this.data.width*this.data.tilewidth},set:function(e){throw new Error("Game.Map.width readonly")}},{key:"height",get:function(){return this.data.height*this.data.tileheight},set:function(e){throw new Error("Game.Map.height readonly")}},{key:"col",get:function(){return this.data.width},set:function(e){throw new Error("Game.Map.col readonly")}},{key:"row",get:function(){return this.data.height},set:function(e){throw new Error("Game.Map.row readonly")}},{key:"minimap",get:function(){return h(this).minimap},set:function(e){throw new Error("Game.Map.minimap readonly")}}]),t}(d["default"].Event);t["default"]=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){Array.from(document.querySelectorAll(".registerWindow #registerWindowDisplaySelect select")).forEach(function(e){var t=e.getAttribute("data-type"),n=e.value;"malehair"==t||"femalehair"==t?"male"==v.sex&&"malehair"==t?v.hair=n:"female"==v.sex&&"femalehair"==t&&(v.hair=n):v.hasOwnProperty(t)&&(v[t]=n)}),"male"==v.sex?(document.getElementById("customMaleHair").style.display="block",document.getElementById("customFemaleHair").style.display="none"):(document.getElementById("customMaleHair").style.display="none",document.getElementById("customFemaleHair").style.display="block"),l()}function a(){Array.from(document.querySelectorAll(".registerWindow #registerWindowPersonal select")).forEach(function(e){var t=e.value,n=e.getAttribute("data-type");g[n]=t});var e=f["default"].windows.register.querySelector("#registerWindowBelief"),t=f["default"].windows.register.querySelector("#registerWindowClass");e.textContent=b[g.belief],t.textContent=m[g["class"]]}function l(){var e=document.querySelector(".registerWindow canvas"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),document.getElementById("loading").innerHTML="Loading",(0,p["default"])(v).then(function(e){var n=e[0];t.drawImage(n,0,0,n.width,n.height),document.getElementById("loading").innerHTML=""})}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=n(9),d=r(s),c=n(8),f=r(c),h=n(45),p=r(h),y=(d["default"].Util.namespace(),!1),w=function(){function e(){i(this,e)}return u(e,null,[{key:"reg",value:function(){y||(y=!0,Array.from(f["default"].windows.register.querySelectorAll("#registerWindowDisplaySelect select")).forEach(function(e){e.addEventListener("change",function(){o()})}),Array.from(f["default"].windows.register.querySelectorAll("#registerWindowPersonal select")).forEach(function(e){e.addEventListener("change",function(){a()})})),Array.from(f["default"].windows.register.querySelectorAll("select")).forEach(function(e){e.selectedIndex=0}),o(),a(),document.querySelector("#registerHeroName").value="",f["default"].windows.register.show()}},{key:"submit",value:function(){var e=document.getElementById("registerHeroName").value;return e.trim().length<=0?void alert("Invalid Name"):(g.id="hero_"+e,g.name=e,g.custom=v,g.tilewidth=v.tilewidth,g.tileheight=v.tileheight,f["default"].Archive.save({hero:g}),f["default"].windows.register.hide(),void f["default"].Archive.load())}}]),e}();t["default"]=w;var v={sex:"male",body:"light",eyes:"blue",hair:"",haircolor:"black",head:"",shirts:"",pants:"",shoes:"",armorchest:"",armorarm:"",armorlegs:"",armorhelms:"",armorfeet:""};v.width=832,v.height=1344,v.width*=.8125,v.height*=.9375,v.tilewidth=v.width/13,v.tileheight=v.height/21;var g=null,b={None:"信仰决定了神对你的祝福，当然没有信仰也是一种信仰，但你将无法享受神的祝福",Elen:"艾琳 - 知识女神",Enlon:"恩朗 - 死亡主宰",Minare:"密娜 - 丰收女神",Achiel:"阿切奥 - 保护之神",Racha:"拉克 - 魔法女神",Aestor:"阿斯托 - 盗贼之神",Hielach:"赫拉克 - 财富之神",Alik:"阿丽克 - 治愈女神",Amarien:"阿玛恩 - 力量之神"},m={warrior:"战士是艾利韦斯最常见的冒险职业，擅长使用剑和枪",archer:"弓箭手擅长远程攻击，一般使用弓箭作为武器",wizard:"魔法师擅长使用魔法进行远程攻击",priest:"牧师擅长治疗，也会使用神术",bard:"吟游诗人的表演可以鼓舞士气或者削弱敌人的士气",thief:"盗贼总是躲藏在阴影中",business:"商人擅长交易和说服，帮助你更快的获得资金"};g={level:1,exp:0,type:"hero",belief:"None","class":"warrior",time:120868410,$str:10,$dex:10,$con:10,$int:10,$cha:10,str:0,dex:0,"int":0,con:0,cha:0,$hp:0,$sp:0,critical:0,dodge:0,hp:0,sp:0,$atk:0,$def:0,$matk:0,$mdef:0,atk:0,def:0,matk:0,mdef:0,buff:[],nerf:[],currentQuest:[],completeQuest:[],area:"fystone",x:18,y:15,centerX:26,centerY:55,hitArea:[[0,0]],skills:["fist.l1","sword.l1","spear.l1","bow.l1","fire.l1"],bar:[{id:"sword.l1",type:"skill"},{id:"bow.l1",type:"skill"},null,null,null,null,null,{id:"potion.healWeak",type:"item"}],equipment:{head:null,body:"cloth.normal",feet:"shoes.normal",weapon:"sword.iron",neck:null,ring:null},items:{"sword.iron":1,"spear.iron":1,"bow.wood":1,"cloth.normal":1,"shoes.normal":1,"potion.healWeak":5,"book.gameAdventure":1,"book.elliorwisHistory":1},gold:0,animations:{spellcastup:[0,6,"",40],spellcastleft:[13,19,"",40],spellcastdown:[26,32,"",40],spellcastright:[39,45,"",40],walkup:[104,112,"walkup",70],walkleft:[117,125,"walkleft",70],walkdown:[130,138,"walkdown",70],walkright:[143,151,"walkright",70],meleeup:[156,161,"",40],meleeleft:[169,174,"",40],meleedown:[182,187,"",40],meleeright:[195,200,"",40],thrustup:[325,332,"",40],thrustleft:[338,345,"",40],thrustdown:[351,358,"",40],thrustright:[364,371,"",40],runup:[378,385,"runup",30],runleft:[391,398,"runleft",30],rundown:[404,411,"rundown",30],runright:[417,424,"runright",30],slashup:[429,434,"",40],slashleft:[442,447,"",40],slashdown:[455,460,"",40],slashright:[468,473,"",40],shootup:[481,493,"",40],shootleft:[494,506,"",40],shootdown:[507,519,"",40],shootright:[520,532,"",40],hurt:[260,265,"",60],dead:265,faceup:104,faceleft:117,facedown:130,faceright:143}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=n(9),s=r(u),d=n(8),c=r(d),f=s["default"].Util.namespace(),h=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this)),r=f(n);return r.data=e,s["default"].Loader.load("skill/"+n.data.image,"skill/"+n.data.icon,"skill/"+n.data.sound).then(function(e){var t=e[0];r.icon=e[1],r.sound=e[2];var i=new s["default"].Sheet({images:[t],width:n.data.tilewidth,height:n.data.tileheight,animations:n.data.animations});i.centerX=Math.floor(n.data.tilewidth/2),i.centerY=Math.floor(n.data.tileheight/2),n.data.alpha&&(i.alpha=n.data.alpha),r.sprite=i,n.emit("complete",!0)}),n}return a(t,e),l(t,null,[{key:"load",value:function(e){return new Promise(function(t,n){s["default"].Loader.load("skill/"+e+".js").then(function(n){var r=n[0](),i=new c["default"].Skill(r);c["default"].skills[e]=i,i.on("complete",function(){t(i)})})})}}]),l(t,[{key:"fire",value:function(e,t,n){var r=this,i=f(this);i.sound&&(i.sound.load(),i.sound.play());var o="attack"+t,a=this.data.animations[o],l=i.sprite.clone();if(l.x=32*e.facePosition.x+16,l.y=32*e.facePosition.y+16,!Number.isFinite(a.centerX)||!Number.isFinite(a.centerY))throw console.error(a,this.data),new Error("Game.Skill.fire invalid centerX/centerY");l.centerX=a.centerX,l.centerY=a.centerY;var u=0,d=[],h=function(){var t=c["default"].area.map.tile(l.x,l.y),n=!0,r=!1,i=void 0;try{for(var o,a=c["default"].area.actors[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var u=o.value;u!=e&&d.length<=0&&u.hitTest(t.x,t.y)&&d.push(u)}}catch(s){r=!0,i=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw i}}},p=s["default"].Ticker.on("tick",function(){switch(r.data.distance>0&&(u+=4),o){case"attackdown":l.y+=u;break;case"attackleft":l.x-=u;break;case"attackright":l.x+=u;break;case"attackup":l.y-=u}h();var e=c["default"].area.map.tile(l.x,l.y);c["default"].area.map.hitTest(e.x,e.y)&&y(),d.length>0&&y(),r.data.distance>0&&u>=r.data.distance&&y()}),y=function(){if(s["default"].Ticker.off("tick",p),d.length>0&&r.data.animations.hitted){var e=d[0];l.x=e.sprite.x,l.y=e.sprite.y,l.play("hitted"),1==l.paused?c["default"].layers.skillLayer.removeChild(l):l.on("animationend",function(){c["default"].layers.skillLayer.removeChild(l)})}else 1==l.paused?c["default"].layers.skillLayer.removeChild(l):l.on("animationend",function(){c["default"].layers.skillLayer.removeChild(l)});n&&n(d)};c["default"].layers.skillLayer.appendChild(l),l.play(o),this.data.animations[o].actor&&e.data.animations[this.data.animations[o].actor]?e.play(this.data.animations[o].actor,3):(e.play("face"+t,0),e.play("attack"+t,3))}},{key:"id",get:function(){return f(this).data.id},set:function(e){throw new Error("Game.Skill.id readonly")}},{key:"icon",get:function(){return f(this).icon},set:function(e){throw new Error("Game.Skill.icon readonly")}},{key:"data",get:function(){return f(this).data},set:function(e){throw console.error(this),new Error("Game.Skill.data readonly")}},{key:"power",get:function(){if(Number.isFinite(this.data.power))return this.data.power;if("string"==typeof this.data.power){var e=this.data.power.match(/(\d+)d(\d+)/);if(!e)throw console.error(this.data.power,this.data),new Error("Sprite.Skill got invalid power data");for(var t=parseInt(e[1]),n=parseInt(e[2]),r=0,i=0;t>i;i++)r+=s["default"].rand(0,n)+1;return r}throw console.error(this.data.power,this.data),new Error("Game.Skill.power invalid power")},set:function(e){throw new Error("Game.Skill.power readonly")}},{key:"type",get:function(){return this.data.type},set:function(e){throw new Error("Game.Skill.type readonly")}}]),t}(s["default"].Event);t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(54),s=r(u),d=n(56),c=r(d),f=l["default"].create("archiveWindow"),h=f;t["default"]=h,f.css=s["default"],f.html=c["default"];var p=f.querySelector("button#archiveWindowSave"),y=f.querySelector("button#archiveWindowClose"),w=f.querySelector("#archiveWindowTable");p.addEventListener("click",function(){var e=document.createElement("canvas");e.width=80,e.height=45;var t=e.getContext("2d");t.drawImage(o["default"].stage.canvas,0,0,o["default"].stage.canvas.width,o["default"].stage.canvas.height,0,0,80,45),o["default"].Archive.save({hero:o["default"].hero.data,screenshot:e.toDataURL("image/jpeg")}),f.open()}),y.addEventListener("click",function(){f.hide(),o["default"].windows["interface"].showing||o["default"].windows.main.show()}),f.whenUp(["esc"],function(e){setTimeout(function(){y.click()},20)}),f.assign("open",function(){o["default"].windows["interface"].showing&&o["default"].hero?p.style.visibility="visible":p.style.visibility="hidden";var e="",t=o["default"].Archive.list();t.forEach(function(t){var n='<div class="archiveWindowItem">\n',r=o["default"].Archive.get("SAVE_"+t);n+='  <button data-type="remove" data-id="SAVE_'+t+'" class="brownButton" style="float: right;">删除</button>\n',n+='  <button data-type="load" data-id="SAVE_'+t+'" class="brownButton" style="float: right;">读取</button>\n',n+='  <img alt="" src="'+(r.screenshot||"")+'" width="80" height="45" style="display: inline-block; margin: 5px;">\n',n+='  <label style="font-size: 20px; margin: 10px;">'+r.name+"</label>\n",n+='  <label style="margin: 10px;">'+r.date+"</label>\n",n+="</div>\n",e+=n}),w.innerHTML=e,o["default"].windows.archive.show()}),w.addEventListener("click",function(e){var t=e.target.getAttribute("data-type"),n=e.target.getAttribute("data-id");t&&n&&("remove"==t?(o["default"].Archive.remove(n),f.open()):"load"==t&&(o["default"].Archive.load(n),f.hide()))})},function(e,t,n){var r=n(55);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"#archiveWindowTable{width:100%;overflow-y:auto;height:320px}.archiveWindowItem{border:1px solid gray;border-radius:10px;margin:10px}.archiveWindowItem>button{width:100px;height:40px;border-radius:5px}#archiveWindowItemBar button{width:100px;height:30px;font-size:16px;display:block;margin-bottom:5px}#archiveWindowClose{float:right}",""])},function(e,t){e.exports="<div class=window-box><div id=archiveWindowItemBar><button id=archiveWindowClose class=brownButton>关闭</button> <button id=archiveWindowSave class=brownButton>保存</button></div><div id=archiveWindowTable></div></div>"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(58),s=r(u),d=n(60),c=r(d),f=l["default"].create("buyWindow"),h=f;t["default"]=h,f.css=s["default"],f.html=c["default"];var p=f.querySelector("button#buyWindowClose"),y=f.querySelector("button#buyWindowSell"),w=f.querySelector("button#buyWindowAll"),v=f.querySelector("button#buyWindowWeapon"),g=f.querySelector("button#buyWindowArmor"),b=f.querySelector("button#buyWindowPotion"),m=f.querySelector("button#buyWindowMaterial"),x=f.querySelector("button#buyWindowBook"),k=f.querySelector("button#buyWindowMisc"),A=f.querySelector("span#buyWindowGold"),E=f.querySelector("#buyWindowTable"),S=null,W=null,C=-1;p.addEventListener("click",function(){f.hide()}),y.addEventListener("click",function(){f.hide(),o["default"].windows.sell.open(S)}),f.whenUp(["tab"],function(){setTimeout(function(){f.hide(),o["default"].windows.sell.open(S)},20)}),w.addEventListener("click",function(e){f.open(S,null)}),v.addEventListener("click",function(e){f.open(S,"sword|spear|bow")}),g.addEventListener("click",function(e){f.open(S,"head|body|feet")}),b.addEventListener("click",function(e){f.open(S,"potion")}),m.addEventListener("click",function(e){f.open(S,"material")}),x.addEventListener("click",function(e){f.open(S,"book|scroll|letter")}),k.addEventListener("click",function(e){f.open(S,"misc")}),f.assign("open",function(e,t,n){"undefined"==typeof n&&(n=-1),S=e,W=t,C=n,A.textContent=o["default"].hero.data.gold+"G";var r="white",i="yellow";w.style.color=r,v.style.color=r,g.style.color=r,b.style.color=r,m.style.color=r,x.style.color=r,k.style.color=r,null==t?w.style.color=i:t.match(/sword/)?v.style.color=i:t.match(/head/)?g.style.color=i:t.match(/potion/)?b.style.color=i:t.match(/material/)?m.style.color=i:t.match(/book/)?x.style.color=i:t.match(/misc/)&&(k.style.color=i);var a=0,l="";Object.keys(e).forEach(function(r){var i=e[r],u=o["default"].items[r];if(!t||-1!=t.indexOf(u.data.type)){var s="";s+=n==a?'<tr style="background-color: green;">\n':"<tr>\n",s+=u.icon?'  <td style="text-align: center;"><img alt="" src="'+u.icon.src+'"></td>\n':"  <td> </td>\n",s+="  <td>"+u.data.name+"</td>\n",s+='  <td style="text-align: center;">'+Math.ceil(1.2*u.data.value)+"G</td>\n",s+='  <td style="text-align: center;">'+i+"</td>\n",s+="  <td>"+u.data.description+"</td>\n",s+=Math.ceil(1.2*u.data.value)>o["default"].hero.data.gold||e[r]<=0?'  <td><button disabled style="Opacity: 0.5;" class="brownButton">买入</button></td>\n':'  <td><button data-id="'+r+'" class="brownButton">买入</button></td>\n',s+="</tr>\n",l+=s,a++}}),E.innerHTML=l,f.show()}),f.whenUp(["enter"],function(){var e=E.querySelectorAll("button");C>=0&&C<e.length&&e[C].click()}),f.whenUp(["up","down"],function(e){var t=E.querySelectorAll("button").length;if(!(0>=t))if(-1==C)"down"==e?f.open(S,W,0):"up"==e&&f.open(S,W,t-1);else if("down"==e){var n=C+1;n>=t&&(n=0),f.open(S,W,n)}else if("up"==e){var n=C-1;0>n&&(n=t-1),f.open(S,W,n)}}),f.whenUp(["esc"],function(){setTimeout(function(){f.hide()},20)}),f.whenUp(["left","right"],function(e){if("right"==e){var t=W;null==t?t="sword|spear|bow":t.match(/sword/)?t="head|body|feet":t.match(/head/)?t="potion":t.match(/potion/)?t="material":t.match(/material/)?t="book|scroll|letter":t.match(/book/)?t="misc":t.match(/misc/)&&(t=null),f.open(S,t)}else if("left"==e){var t=W;null==t?t="misc":t.match(/sword/)?t=null:t.match(/head/)?t="sword|spear|bow":t.match(/potion/)?t="head|body|feet":t.match(/material/)?t="potion":t.match(/book/)?t="material":t.match(/misc/)&&(t="book|scroll|letter"),f.open(S,t)}}),E.addEventListener("click",function(e){var t=e.target.getAttribute("data-id");if(t&&S.hasOwnProperty(t)){var n=o["default"].items[t];o["default"].hero.data.gold-=Math.ceil(1.2*n.data.value),o["default"].hero.data.items[t]?o["default"].hero.data.items[t]++:o["default"].hero.data.items[t]=1,S[t]--,0==S[t]&&delete S[t],f.open(S,W)}})},function(e,t,n){var r=n(59);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"#buyWindowTable tr:nth-child(odd){background-color:hsla(0,0%,75%,.6)}#buyWindowItemBar>button{width:60px;height:40px;font-size:16px;margin:0 5px 5px}#buyWindowClose,#buyWindowStatus{float:right}.buyWindow table{width:100%}.buyWindow table button{width:60px;height:40px;font-size:16px}#buyWindowGold{position:absolute;right:100px;bottom:30px;font-size:20px;color:#000}",""])},function(e,t){e.exports='<div class=window-box><div id=buyWindowItemBar><button id=buyWindowClose class=brownButton>关闭</button> <button id=buyWindowSell class=brownButton>卖出</button> <button id=buyWindowAll class=brownButton>全部</button> <button id=buyWindowWeapon class=brownButton>武器</button> <button id=buyWindowArmor class=brownButton>护甲</button> <button id=buyWindowPotion class=brownButton>药水</button> <button id=buyWindowMaterial class=brownButton>材料</button> <button id=buyWindowBook class=brownButton>书籍</button> <button id=buyWindowMisc class=brownButton>其他</button></div><span id=buyWindowGold></span><div style="overflow: auto; height: 300px"><table border=0><thead><tr><td style="width: 40px"><td style="width: 120px"><td style="width: 30px"><td style="width: 30px"><td><td style="width: 60px"><tbody id=buyWindowTable></table></div></div>'},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){m.textContent=w[v],v++,v>=w.length&&(g.style.display="none",b.style.display="block")}Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),a=r(o),l=n(33),u=r(l),s=n(62),d=r(s),c=n(64),f=r(c),h=u["default"].create("dialogueWindow"),p=h;t["default"]=p,h.css=d["default"],h.html=f["default"];var y=h.querySelector("#dialogueWindowSpeaker"),w=[],v=0,g=document.getElementById("dialogueWindowNext"),b=document.getElementById("dialogueWindowClose"),m=document.getElementById("dialogueWindowContent");g.addEventListener("click",function(){i()}),b.addEventListener("click",function(){setTimeout(function(){a["default"].windows.dialogue.hide(),w=[],v=0},20)}),a["default"].dialogue=function(e,t){g.style.display="block",b.style.display="none",t&&t.length?y.textContent=t+"：":y.textContent="",w=e,v=0,i(),a["default"].windows.dialogue.show()},h.whenUp(["enter","space","esc"],function(){a["default"].windows.dialogue.showing&&("none"!=g.style.display?g.click():"none"!=b.style.display&&b.click())})},function(e,t,n){var r=n(63);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,".dialogueWindow table,dialogueWindow.tbody,dialogueWindow td,dialogueWindow tr{margin:0;padding:0;width:100%;height:100%;text-align:center}#dialogueWindowSpeaker{position:absolute;left:50px;top:50px;font-size:30px;font-weight:700}.dialogueWindow button{width:120px;height:60px;font-size:16px;position:absolute}#dialogueWindowClose,#dialogueWindowNext{bottom:50px;right:100px}#dialogueWindowContent{margin-left:50px;margin-right:50px;max-width:600px;font-size:24px;text-align:center}",""])},function(e,t){e.exports='<div class=window-box><div style="width: 100%; height: 100%"><span id=dialogueWindowSpeaker></span><table><tbody><tr><td><div id=dialogueWindowContent></div></table><button id=dialogueWindowNext style="display: block" class=brownButton>继续</button> <button id=dialogueWindowClose style="display: none" class=brownButton>结束</button></div></div>'},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){for(var e=8,t="",n=0;e>n;n++){var r="";r+='<button data-index="'+n+'" class="interfaceWindowButton">',r+='<label data-index="'+n+'" class="interfaceWindowButtonText"></label>',r+="</button>\n",t+=r}w.innerHTML=t}Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),a=r(o),l=n(33),u=r(l),s=n(66),d=r(s),c=n(70),f=r(c),h=u["default"].create("interfaceWindow"),p=h;t["default"]=p,h.css=d["default"],h.html=f["default"];var y=h.querySelector("button#interfaceWindowUse"),w=h.querySelector("div#interfaceWindowBar"),v=h.querySelector("#interfaceWindowMap"),g=h.querySelector("button#interfaceWindowMenu"),b=h.querySelector("#interfaceWindowHP"),m=h.querySelector("#interfaceWindowSP");h.assign("hideUse",function(){y.style.visibility="hidden"}),h.assign("showUse",function(){y.style.visibility="visible"}),h.on("active",function(){a["default"].start()}),h.on("deactive",function(){a["default"].pause()}),h.whenUp(["esc"],function(e){a["default"].windows["interface"].atop&&setTimeout(function(){g.click()},20)}),setInterval(function(){a["default"].hero&&0==a["default"].paused&&(a["default"].hero.data.time++,a["default"].windows["interface"].datetime())},1e3),i();var x=h.querySelectorAll(".interfaceWindowButton"),k=h.querySelectorAll(".interfaceWindowButtonText");w.addEventListener("click",function(e){var t=e.target.getAttribute("data-index");if(t){var n=a["default"].hero.data.bar[t];if(n)if("skill"==n.type){var r=a["default"].hero.fire(n.id);r&&(e.target.disabled=!0,setTimeout(function(){e.target.disabled=!1},r))}else if("item"==n.type){var i=n.id,o=a["default"].items[i];o.heroUse(),a["default"].windows["interface"].refresh()}}}),h.whenUp(["1","2","3","4","5","6","7","8"],function(e){var t=parseInt(e);Number.isInteger(t)&&t>=0&&t<x.length&&x[t-1].click()}),h.whenUp(["e","E","space","enter"],function(e){a["default"].windows["interface"].showing&&a["default"].hintObject&&a["default"].hintObject.heroUse&&a["default"].hintObject.heroUse()}),y.addEventListener("click",function(e){a["default"].hintObject&&a["default"].hintObject.heroUse&&a["default"].hintObject.heroUse()}),h.assign("status",function(){if(a["default"].hero){var e=a["default"].hero.data.hp/a["default"].hero.data.$hp,t=a["default"].hero.data.sp/a["default"].hero.data.$sp;b.style.width=100*e+"%",m.style.width=100*t+"%",e>=.5?b.style.backgroundColor="green":e>=.25?b.style.backgroundColor="yellow":b.style.backgroundColor="red"}}),h.assign("datetime",function(){if(a["default"].hero&&a["default"].hero.data&&Number.isInteger(a["default"].hero.data.time)){var e=518400,t=43200,n=1440,r=60,i=h.querySelector("#interfaceWindowDatetime"),o=a["default"].hero.data.time,l=Math.floor(o/e);o%=e;var u=Math.floor(o/t);o%=t;var s=Math.floor(o/n);o%=n;var d=Math.floor(o/r);o%=r;var c=o;for(l++,u++,s++,d=d.toString();d.length<2;)d="0"+d;for(c=c.toString();c.length<2;)c="0"+c;i.textContent=u+"月"+s+"日 "+d+":"+c;var f=a["default"].area.map.data.type;"indoor"==f?a["default"].stage.filter("brightness",0):"outdoor"==f?d>=20||4>d?a["default"].stage.filter("brightness",-.15):d>=4&&6>d?a["default"].stage.filter("brightness",-.1):d>=6&&8>d?a["default"].stage.filter("brightness",-.05):d>=8&&10>d?a["default"].stage.filter("brightness",0):d>=10&&12>d?a["default"].stage.filter("brightness",.05):d>=12&&14>d?a["default"].stage.filter("brightness",0):d>=14&&16>d?a["default"].stage.filter("brightness",0):d>=16&&18>d?a["default"].stage.filter("brightness",-.05):d>=18&&20>d&&a["default"].stage.filter("brightness",-.1):"cave"==f&&a["default"].stage.filter("brightness",-.15)}}),h.assign("refresh",function(){for(var e=0;8>e;e++){var t=a["default"].hero.data.bar[e],n=x[e],r=k[e];if(n.disabled=!1,r.disabled=!1,t){var i=t.id,o=t.type;if("skill"==o){var l=a["default"].skills[i];n.style.backgroundImage='url("'+l.icon.src+'")',r.textContent=l.data.cost}else if("item"==o){var u=a["default"].items[i];n.style.backgroundImage='url("'+u.icon.src+'")',a["default"].hero.data.items[i]?r.textContent=a["default"].hero.data.items[i]:(r.textContent="0",n.disabled=!0,r.disabled=!0)}}else r.textContent="",n.style.backgroundImage=""}v.textContent=a["default"].area.map.data.name}),g.addEventListener("click",function(e){a["default"].windows.sysmenu.show()})},function(e,t,n){var r=n(67);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"#interfaceWindowBar{text-align:center;position:absolute;bottom:10px;width:100%;height:60px}.interfaceWindow{pointer-events:none}button.interfaceWindowButton{margin-left:3px;margin-right:3px;width:60px;height:60px;border:4px solid gray;border-radius:10px;background-color:hsla(0,0%,39%,.5);display:inline-block;pointer-events:auto;background-repeat:no-repeat;background-size:cover}button.interfaceWindowButton:hover{opacity:.5}button.interfaceWindowButton>img{width:100%;height:100%}#interfaceWindowMap{top:35px}#interfaceWindowDatetime,#interfaceWindowMap{position:absolute;left:5px;background-color:hsla(0,0%,39%,.7);padding:2px}#interfaceWindowDatetime{top:10px}button#interfaceWindowUse{position:absolute;top:5px;right:85px;visibility:hidden;background-image:url("+n(68)+")}button#interfaceWindowMenu{position:absolute;top:5px;right:5px;background-image:url("+n(69)+")}interfaceWindowButton:disabled{cursor:default;pointer-events:none;background-color:gray;opacity:.5}.interfaceWindowButtonText{position:absolute;background-color:#fff;margin-left:-26px;margin-top:12px}",""]);
},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wUcCQAzTZI5lAAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAADASURBVFjD7ZbJDsMwCEQzyP//y9NLFbmtF8A49GDOCW9YNOa6TiQHnP8xKicCgEsMWMHkXAsANQsacA9agzTftJhlBNdUO53dO0clhLUI2QkfdJEtAdvgIxHiWbJAEbcAJvkQJdsJj4ASuVArHUBSAz58ktbqNFY8sWZIz6M7D8piufh5EyToPnDBH1lCz2vYTG6Zt+UeKI72WffDdBHxu8LO7MJuwuJZnMhlheL43GpSsjK/3QIesWfJhJ/4i3gBSiBGOyDB6kMAAAAASUVORK5CYII="},function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAiCAYAAAA6RwvCAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQffBR0IFQhyUjv2AAABRElEQVRYw+1XwQrCMAxtwi6ePXiQOS/+/weJoA4RD/5C5kEDJTZt09UxcIEdrGnymvdIU+cWq2in/o5yDRFhUhCIOCDicOrv8AG14rUpQcAHxMDJxe+dNWZjqQARgXPOEdGA+GbleLl9+RLR1dt3JqJ9NSASTK5/ri/kBuSTH7qtWgk26XPoti51ALCAGGMpMJAqawxEu1l/rfWPZ7JSIUCqRogINI4ZQChp7D8NRBE17WYdPbXml6IGLTznguCKhKjLBuI3qFpCZa3J2FFqtOSWauTsk1RhSEys7l9ZSC/oZmLzBVJToCnhJsUqN5UKNtRLtOYWFKv/1RIuC9T/ijViaVLW6kHJzVt618TafFMy1HAS6+0bG67mP4/MbkKTVHFArVJ+UrmnWme1DM5W/2ZsUL/PKE+L3778QjPF5C+9xf7KXmSZECb9GPh+AAAAAElFTkSuQmCC"},function(e,t){e.exports='<div id=interfaceWindowBar></div><div style="position: absolute; bottom: 10px; left: 20px; width: 100px; height: 60px"><div style="width: 100px; height: 20px; margin: 5px 0; border: 1px solid gray; background-color: white"><div id=interfaceWindowHP style="width: 100%; height: 100%; background-color: green"></div></div><div style="width: 100px; height: 20px; margin: 5px 0; border: 1px solid gray; background-color: white"><div id=interfaceWindowSP style="width: 100%; height: 100%; background-color: blue"></div></div></div><span id=interfaceWindowDatetime></span> <span id=interfaceWindowMap></span> <button id=interfaceWindowUse class=interfaceWindowButton></button> <button id=interfaceWindowMenu class=interfaceWindowButton></button>'},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(32),s=r(u),d=n(72),c=r(d),f=n(74),h=r(f),p=l["default"].create("inventoryWindow"),y=p;t["default"]=y,p.css=c["default"],p.html=h["default"];var w=p.querySelector("button#inventoryWindowClose"),v=p.querySelector("button#inventoryWindowStatus"),g=p.querySelector("button#inventoryWindowAll"),b=p.querySelector("button#inventoryWindowWeapon"),m=p.querySelector("button#inventoryWindowArmor"),x=p.querySelector("button#inventoryWindowPotion"),k=p.querySelector("button#inventoryWindowMaterial"),A=p.querySelector("button#inventoryWindowBook"),E=p.querySelector("button#inventoryWindowMisc"),S=p.querySelector("span#inventoryWindowGold"),W=p.querySelector("#inventoryWindowTable");w.addEventListener("click",function(e){p.hide()}),v.addEventListener("click",function(e){p.hide(),o["default"].windows.status.open()}),p.whenUp(["tab"],function(){setTimeout(function(){p.hide(),o["default"].windows.status.open()},20)}),g.addEventListener("click",function(e){p.open()}),b.addEventListener("click",function(e){p.open("sword|spear|bow")}),m.addEventListener("click",function(e){p.open("head|body|feet")}),x.addEventListener("click",function(e){p.open("potion")}),k.addEventListener("click",function(e){p.open("material")}),A.addEventListener("click",function(e){p.open("book|scroll|letter")}),E.addEventListener("click",function(e){p.open("misc")});var C=null,O=-1;p.assign("open",function(e,t){"undefined"==typeof t&&(t=-1),C=e,O=t;var n="white",r="yellow";g.style.color=n,b.style.color=n,m.style.color=n,x.style.color=n,k.style.color=n,A.style.color=n,E.style.color=n,null==e?g.style.color=r:e.match(/sword/)?b.style.color=r:e.match(/head/)?m.style.color=r:e.match(/potion/)?x.style.color=r:e.match(/material/)?k.style.color=r:e.match(/book/)?A.style.color=r:e.match(/misc/)&&(E.style.color=r),S.textContent=o["default"].hero.data.gold+"G";var i="",a=0,l=Object.keys(o["default"].hero.data.items);l.sort(),l.forEach(function(n){var r=o["default"].hero.data.items[n],l=o["default"].items[n],u=null;if(Object.keys(o["default"].hero.data.equipment).forEach(function(e){var t=o["default"].hero.data.equipment[e];t==l.id&&(u=e)}),!e||-1!=e.indexOf(l.data.type)){var s="";s+=t==a?'<tr style="background-color: green;">\n':"<tr>\n",s+=l.icon?'  <td style="text-align: center;"><img alt="" src="'+l.icon.src+'"></td>\n':"  <td> </td>\n",s+="  <td>"+(u?"*":"")+l.data.name+"</td>\n",s+='  <td style="text-align: center;">'+l.data.value+"G</td>\n",s+='  <td style="text-align: center;">'+r+"</td>\n",s+="  <td>"+l.data.description+"</td>\n",s+='  <td><button data-id="'+n+'" class="brownButton">操作</button></td>\n',s+="</tr>\n",i+=s,a++}}),W.innerHTML=i,p.show()}),p.whenUp(["enter"],function(){var e=W.querySelectorAll("button");O>=0&&O<e.length&&e[O].click()}),p.whenUp(["up","down"],function(e){var t=W.querySelectorAll("button").length;if(-1==O)"down"==e?p.open(C,0):"up"==e&&p.open(C,t-1);else if("down"==e){var n=O+1;n>=t&&(n=0),p.open(C,n)}else if("up"==e){var n=O-1;0>n&&(n=t-1),p.open(C,n)}}),W.addEventListener("click",function(e){var t=e.target.getAttribute("data-id");t&&o["default"].hero.data.items.hasOwnProperty(t)&&!function(){var e=o["default"].items[t],n=o["default"].hero.data.items[t],r=null;Object.keys(o["default"].hero.data.equipment).forEach(function(t){var n=o["default"].hero.data.equipment[t];n==e.id&&(r=t)});var i={};e.data.type.match(/potion/)?(i["使用"]="use",i["快捷键"]="shortcut"):e.data.type.match(/sword|spear|bow|head|body|feet|neck|ring/)?r?i["卸下"]="takeoff":i["装备"]="puton":e.data.type.match(/book/)&&(i["阅读"]="read"),i["丢弃"]="drop",(0,s["default"])(i).then(function(i){switch(i){case"puton":var a=e.data.type;return a.match(/sword|spear|bow/)&&(a="weapon"),o["default"].hero.data.equipment[a]=e.id,p.open(C);case"takeoff":return e.data.type.match(/sword|spear|bow/)?o["default"].hero.data.equipment.weapon=null:o["default"].hero.data.equipment[e.data.type]=null,p.open(C);case"use":e.heroUse&&e.heroUse();break;case"read":e.heroUse&&e.heroUse();break;case"drop":return r&&(o["default"].hero.data.equipment[r]=null),o["default"].addBag(o["default"].hero.x,o["default"].hero.y).then(function(e){e.inner.hasOwnProperty(t)?e.inner[t]+=n:e.inner[t]=n}),delete o["default"].hero.data.items[t],o["default"].hero.data.bar.forEach(function(e,n,r){e&&e.id==t&&(r[n]=null)}),o["default"].windows["interface"].refresh(),p.open(C);case"shortcut":(0,s["default"])({1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7},function(t){Number.isFinite(t)&&t>=0&&(o["default"].hero.data.bar[t]={id:e.id,type:"item"},o["default"].windows["interface"].refresh())})}})}()}),p.whenUp(["esc"],function(){setTimeout(function(){p.hide()},20)}),p.whenUp(["left","right"],function(e){if("right"==e){var t=C;null==t?t="sword|spear|bow":t.match(/sword/)?t="head|body|feet":t.match(/head/)?t="potion":t.match(/potion/)?t="material":t.match(/material/)?t="book|scroll|letter":t.match(/book/)?t="misc":t.match(/misc/)&&(t=null),p.open(t,-1)}else if("left"==e){var t=C;null==t?t="misc":t.match(/sword/)?t=null:t.match(/head/)?t="sword|spear|bow":t.match(/potion/)?t="head|body|feet":t.match(/material/)?t="potion":t.match(/book/)?t="material":t.match(/misc/)&&(t="book|scroll|letter"),p.open(t,-1)}})},function(e,t,n){var r=n(73);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"#inventoryWindowItemBar{height:50px}#inventoryWindowItemBar>button{width:60px;height:40px;font-size:16px;margin:0 5px 5px}#inventoryWindowClose,#inventoryWindowStatus{float:right}.inventoryWindow table{width:100%}.inventoryWindow table button{width:60px;height:40px;font-size:16px}#inventoryWindowTable tr:nth-child(odd){background-color:hsla(0,0%,75%,.6)}#inventoryWindowGold{position:absolute;right:100px;bottom:10px;font-size:20px;color:#000;font-weight:700}",""])},function(e,t){e.exports='<div class=window-box><div id=inventoryWindowItemBar><button id=inventoryWindowClose class=brownButton>关闭</button> <button id=inventoryWindowStatus class=brownButton>状态</button> <button id=inventoryWindowAll class=brownButton>全部</button> <button id=inventoryWindowWeapon class=brownButton>武器</button> <button id=inventoryWindowArmor class=brownButton>护甲</button> <button id=inventoryWindowPotion class=brownButton>药水</button> <button id=inventoryWindowMaterial class=brownButton>材料</button> <button id=inventoryWindowBook class=brownButton>书籍</button> <button id=inventoryWindowMisc class=brownButton>其他</button></div><span id=inventoryWindowGold></span><div style="overflow: auto; height: 310px"><table border=0><thead><tr><td style="width: 40px; text-align: center"><td style="width: 120px"><td style="width: 30px"><td style="width: 30px"><td><td style="width: 60px"><tbody id=inventoryWindowTable></table></div></div>'},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=(r(i),n(33)),a=r(o),l=n(76),u=r(l),s=n(78),d=r(s),c=a["default"].create("loadingWindow"),f=c;t["default"]=f,c.css=u["default"],c.html=d["default"];var h=c.querySelector("#loadingWindowProgress"),p=c.querySelector("#loadingWindowText"),y=["打开游戏菜单之后，游戏是暂停的，你可以在这时思考下战斗策略","记得出门带着矿工锄和采药铲，或许能从其中赚点小钱","职业、信仰、技能，都可以任意改变，但是必须付出代价","你的信仰决定了神对你的祝福，还有某些人或者组织对你的看法","信仰是可以改变的，不过艾利韦斯的居民并不喜欢总是改变自己信仰的人","艾利韦斯信仰自由，没有信仰也是一种信仰，但是你享受不到任何神的祝福"];c.assign("begin",function(){h.innerHTML="",p.textContent=y[Math.floor(Math.random()*y.length)],c.show()}),c.assign("update",function(e){h.innerHTML=e}),c.assign("end",function(){c.hide()})},function(e,t,n){var r=n(77);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,".loadingWindow{text-align:center}#loadingWindowLoadingIcon{width:50px;height:50px;margin-top:15px;margin-bottom:10px;animation:loadingAnimation 1s linear infinite}@keyframes loadingAnimation{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}#loadingWindowBox{width:500px;height:300px;border-radius:25px;position:fixed;top:75px;left:150px;background-color:gray}.loadingWindow label{color:#fff;font-size:48px}#loadingWindowText{color:#fff}",""])},function(e,t,n){e.exports="<div id=loadingWindowBox><img id=loadingWindowLoadingIcon src="+n(79)+" alt=loading><br><label>请稍等...<small id=loadingWindowProgress></small></label><br><h5 id=loadingWindowText></h5></div>"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyBpZD0ibG9hZGluZ0ljb24iIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjUwIiBmaWxsPSIjODA4MDgwIiAvPgogIDxwYXRoIGQ9Ik01MCw1MCBoLTQwIGE0MCw0MCAwIDEsMCA0MCwtNDAgeiIgZmlsbD0id2hpdGUiIC8+CiAgPHBhdGggZD0iTTQ5LDQ5IGgtMzAgYTMwLDMwIDAgMSwwIDMwLC0zMCB6IiBmaWxsPSIjODA4MDgwIiAvPgo8L3N2Zz4K"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(81),s=r(u),d=n(83),c=r(d),f=l["default"].create("mainWindow"),h=f;t["default"]=h,f.css=s["default"],f.html=c["default"];var p=f.querySelector("#mainWindowContinue"),y=f.querySelector("#mainWindowNew"),w=f.querySelector("#mainWindowLoad"),v=f.querySelector("#mainWindowFullscreen");v.addEventListener("click",function(e){o["default"].windows.setting.toggle()}),f.on("beforeShow",function(){o["default"].Archive.last()?p.style.visibility="visible":p.style.visibility="hidden"}),p.addEventListener("click",function(e){f.hide(),setTimeout(function(){o["default"].Archive.load()},20)}),y.addEventListener("click",function(e){f.hide(),o["default"].Register.reg()}),w.addEventListener("click",function(e){f.hide(),o["default"].windows.archive.open()})},function(e,t,n){var r=n(82);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"#mainWindowBox{text-align:center;height:412px;background-color:hsla(30,61%,85%,.85);border:20px solid rgba(134,93,52,.85)}#mainWindowFullscreen{position:absolute;left:640px;top:30px}.mainWindow h1{font-size:60px}.mainWindow h1,.mainWindow h4{margin-bottom:0}.mainWindow button{width:120px;height:60px;margin-top:10px}",""])},function(e,t){e.exports="<div id=mainWindowBox><h1>Elliorwis</h1><h4>艾利韦斯</h4><br><button id=mainWindowContinue class=brownButton>继续旅程</button><br><button id=mainWindowNew class=brownButton>新的旅程</button><br><button id=mainWindowLoad class=brownButton>读取进度</button><br><button id=mainWindowFullscreen class=brownButton>全屏</button></div>"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(85),s=r(u),d=n(87),c=r(d),f=l["default"].create("mapWindow"),h=f;t["default"]=h,f.css=s["default"],f.html=c["default"];var p=f.querySelector("#mapWindowClose"),y=f.querySelector("#mapWindowMap");p.addEventListener("click",function(e){o["default"].windows.map.hide()}),f.whenUp(["esc"],function(e){setTimeout(function(){p.click()},20)}),f.on("beforeShow",function(e){if(o["default"].stage&&o["default"].area&&o["default"].area.map){var t={x:o["default"].stage.x,y:o["default"].stage.y,centerX:o["default"].stage.centerX,centerY:o["default"].stage.centerY};o["default"].stage.x=0,o["default"].stage.y=0,o["default"].stage.centerX=0,o["default"].stage.centerY=0;var n=document.createElement("canvas");n.width=o["default"].area.map.width,n.height=o["default"].area.map.height;var r=n.getContext("2d");o["default"].stage.draw(r);var i=document.createElement("canvas");i.width=Math.floor(n.width/8),i.height=Math.floor(n.height/8);var a=i.getContext("2d");a.drawImage(n,0,0,n.width,n.height,0,0,i.width,i.height),r=null,n=null,y.innerHTML="",y.appendChild(i),o["default"].stage.x=t.x,o["default"].stage.y=t.y,o["default"].stage.centerX=t.centerX,o["default"].stage.centerY=t.centerY}})},function(e,t,n){var r=n(86);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,".mapWindow table,.mapWindow tbody,.mapWindow td,.mapWindow tr{width:100%;height:100%;magrin:0;padding:0}.mapWindow{text-align:center}#mapWindowClose{position:absolute;right:50px;top:50px;width:120px;height:60px;font-size:16px}#mapWindowMap canvas,#mapWindowMap img{max-width:700px;max-height:320px}",""])},function(e,t){e.exports="<div class=window-box><button id=mapWindowClose class=brownButton>关闭</button><table><tbody><tr><td><div id=mapWindowMap></div></table></div>"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(89),s=r(u),d=n(91),c=r(d),f=l["default"].create("overWindow"),h=f;t["default"]=h,f.css=s["default"],f.html=c["default"];var p=f.querySelector("#overWindowMessage"),y=f.querySelector("#overWindowReason"),w=["不幸的事情终于发生了……即便你的内心曾对神灵祈祷","不幸的事情终于发生了……你就知道自己今天不应该穿白色的袜子","不幸的事情终于发生了……明明还没有体验过天伦之乐","不幸的事情终于发生了……你的墓碑上写着：“下次不能随便踢小动物”","不幸的事情终于发生了……你感觉自己的身体变轻了…轻了…轻了…","不幸的事情终于发生了……你摸了摸自己的脖子，似乎找不到脑袋了，于是你一赌气","不幸的事情终于发生了……你的墓碑上写着：“下次再也不把治疗药水借给别人了”","不幸的事情终于发生了……曾经有一瓶治疗药水摆在你面前，而你没有珍惜","不幸的事情终于发生了……你回想起曾经在广阔的原野上尽情的奔跑","不幸的事情终于发生了……不过好消息是你再也不用减肥了","不幸的事情终于发生了……下次在冒险前一定要吃饱饭"];f.assign("open",function(e){e?y.textContent=e:y.innerHTML="",p.textContent=w[Math.floor(Math.random()*w.length)],o["default"].windows.stage.hide(),o["default"].windows["interface"].hide(),f.show()}),overWindowClose.addEventListener("click",function(e){o["default"].clearStage(),f.hide(),o["default"].windows.main.show()})},function(e,t,n){var r=n(90);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,".overWindow table,.overWindow tbody,.overWindow td,.overWindow tr{width:100%;height:100%;magrin:0;padding:0}.overWindow{text-align:center}#overWindowClose{position:absolute;right:50px;top:50px;width:120px;height:60px;font-size:16px}#overWindowMap canvas,#overWindowMap img{max-width:700px;max-height:320px}",""])},function(e,t){e.exports="<div class=window-box><button id=overWindowClose class=brownButton>返回主菜单</button><table><tbody><tr><td><div><h1 id=overWindowMessage></h1><h2 id=overWindowReason></h2></div></table></div>"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(93),s=r(u),d=n(95),c=r(d),f=l["default"].create("pickupWindow"),h=f;t["default"]=h,f.css=s["default"],f.html=c["default"];var p=f.querySelector("button#pickupWindowClose"),y=f.querySelector("button#pickupWindowAll"),w=f.querySelector("#pickupWindowTable"),v=null,g=-1;p.addEventListener("click",function(e){o["default"].windows.pickup.hide()}),y.addEventListener("click",function(e){var t=v;t&&t.inner&&Object.keys(t.inner).length>0&&(Object.keys(t.inner).forEach(function(e){var n=inner[e];"gold"==e?o["default"].hero.data.gold+=n:o["default"].hero.data.items[e]?o["default"].hero.data.items[e]+=n:o["default"].hero.data.items[e]=n,delete t.inner[e]}),o["default"].windows.pickup.open(t))}),f.whenUp(["a","A"],function(e){y.click()}),f.whenUp(["esc"],function(e){setTimeout(function(){f.hide()},20)}),f.whenUp(["1","2","3","4","5","6","7","8","9"],function(e){for(var t=w.querySelectorAll("button"),n=0,r=t.length;r>n;n++){var i=t[n].getAttribute("data-index");i&&i==e&&t[n].click()}}),f.assign("open",function(e,t){if("undefined"==typeof t&&(t=-1),g=t,!e.inner||Object.keys(e.inner).length<=0)return o["default"].area.bags.has(e)&&(e.erase(),o["default"].area.bags["delete"](e)),o["default"].area.items.has(e)&&(e.erase(),o["default"].area.items["delete"](e)),void o["default"].windows.pickup.hide();v=e;var n=1,r="";Object.keys(e.inner).forEach(function(i){var a=e.inner[i],l=o["default"].items[i],u="";u+=t==n-1?'<tr style="background-color: green;">\n':"<tr>\n",u+=l.icon?'  <td style="text-align: center;"><img alt="" src="'+l.icon.src+'"></td>\n':"  <td> </td>\n",u+="  <td>"+l.data.name+"</td>\n",u+='  <td style="text-align: center;">'+l.data.value+"G</td>\n",u+='  <td style="text-align: center;">'+a+"</td>\n",u+="  <td>"+l.data.description+"</td>\n",u+='  <td><button data-id="'+i+'" data-index="'+n+'" class="brownButton">'+(9>=n?n:"")+" 拿取</button></td>\n",u+="</tr>\n",r+=u,n++}),w.innerHTML=r,o["default"].windows.pickup.show()}),f.whenUp(["enter"],function(){var e=w.querySelectorAll("button");g>=0&&g<e.length&&e[g].click()}),f.whenUp(["up","down"],function(e){var t=w.querySelectorAll("button").length;if(-1==g)"down"==e?f.open(v,0):"up"==e&&f.open(v,t-1);else if("down"==e){var n=g+1;n>=t&&(n=0),f.open(v,n)}else if("up"==e){var n=g-1;0>n&&(n=t-1),f.open(v,n)}}),w.addEventListener("click",function(e){var t=e.target.getAttribute("data-id");if(t&&v.inner&&v.inner.hasOwnProperty(t)){var n=v.inner[t];"gold"==t?o["default"].hero.data.gold+=n:o["default"].hero.data.items.hasOwnProperty(t)?o["default"].hero.data.items[t]+=n:o["default"].hero.data.items[t]=n,delete v.inner[t],f.open(v)}})},function(e,t,n){var r=n(94);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"#pickupWindowTable tr:nth-child(odd){background-color:hsla(0,0%,75%,.6)}.pickupWindow table{width:100%}.pickupWindow button{width:60px;height:40px;font-size:16}",""])},function(e,t){e.exports='<div class=window-box><button id=pickupWindowClose class=brownButton>关闭</button> <button id=pickupWindowAll class=brownButton>A 全部</button><table border=0><thead><tr><td style="width: 40px"><td style="width: 120px"><td style="width: 30px"><td style="width: 30px"><td><td style="width: 60px"><tbody id=pickupWindowTable></table></div>'},function(e,n,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=r(8),a=i(o),l=r(33),u=i(l),s=r(97),d=i(s),c=r(99),f=i(c),h=u["default"].create("questWindow"),p=h;n["default"]=p,h.css=d["default"],h.html=f["default"];var y=h.querySelector("#questWindowClose"),w=h.querySelector("#questWindowCurrent"),v=h.querySelector("#questWindowPast"),g=h.querySelector("#questWindowTable");y.addEventListener("click",function(){h.hide()}),h.whenUp(["esc"],function(e){setTimeout(function(){y.click()},20)}),w.addEventListener("click",function(){h.hide(),h.current()}),v.addEventListener("click",function(){h.hide(),h.past()}),h.assign("current",function(){w.disabled=!0,v.disabled=!1;var e="",n=a["default"].hero.data.currentQuest;n.forEach(function(n){var r=a["default"].Quest.isComplete(n),i='<div class="questWindowItem">\n';if(i+='  <label style="font-size: 20px; margin: 10px;">'+n.name+(r?"[已完成]":"[未完成]")+"</label>\n",i+='  <div style="margin: 10px;">简介：'+n.description+"</div>\n",n.reward&&(i+='  <div style="margin: 10px;">任务奖励：',n.reward.gold&&(i+='<label style="margin-right: 20px;">金币：'+n.reward.gold+"</label>"),n.reward.exp&&(i+='<label style="margin-right: 20px;">经验：'+n.reward.exp+"</label>"),i+="  </div>"),n.target&&"kill"==n.target.kill){var o=!0,l=!1,u=void 0;try{for(var s,d=n.target.kill[Symbol.iterator]();!(o=(s=d.next()).done);o=!0){var c=s.value;i+='<div style="margin: 10px;">'+c.name+"："+c.current+" / "+t.need+"</div>"}}catch(f){l=!0,u=f}finally{try{!o&&d["return"]&&d["return"]()}finally{if(l)throw u}}}i+='  <label style="margin: 10px;">给予人：'+n.fromMap+" 的 "+n.fromName+"</label>\n",i+='  <label style="margin: 10px;">交付人：'+n.toMap+" 的 "+n.toName+"</label>\n",i+="</div>\n",e+=i}),e.length<=0&&(e="<div><label>没有正在进行的任务</label></div>"),g.innerHTML=e,h.show()}),h.assign("past",function(){w.disabled=!1,v.disabled=!0;var e="",n=a["default"].hero.data.completeQuest;n.forEach(function(n){var r='<div class="questWindowItem">\n';if(r+='  <label style="font-size: 20px; margin: 10px;">'+n.name+"[已完成]</label>\n",r+='  <div style="margin: 10px;">简介：'+n.description+"</div>\n",n.reward&&(r+='  <div style="margin: 10px;">任务奖励：',n.reward.gold&&(r+='<label style="margin-right: 20px;">金币：'+n.reward.gold+"</label>"),n.reward.exp&&(r+='<label style="margin-right: 20px;">经验：'+n.reward.exp+"</label>"),r+="  </div>"),n.target&&"kill"==n.target.type){var i=!0,o=!1,a=void 0;try{for(var l,u=n.target.kill[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var s=l.value;r+='<div style="margin: 10px;">'+s.name+"："+s.current+" / "+t.need+"</div>"}}catch(d){o=!0,a=d}finally{try{!i&&u["return"]&&u["return"]()}finally{if(o)throw a}}}r+='  <label style="margin: 10px;">给予人：'+n.fromMap+" 的 "+n.fromName+"</label>\n",r+='  <label style="margin: 10px;">交付人：'+n.toMap+" 的 "+n.toName+"</label>\n",r+="</div>\n",e+=r}),e.length<=0&&(e="<div><label>没有已完成任务</label></div>"),g.innerHTML=e,h.show()}),g.addEventListener("click",function(e){var t=e.target.getAttribute("data-id");t&&("remove"==type?(a["default"].Archive.remove(t),h.open()):"load"==type&&(a["default"].Archive.load(t),h.hide()))})},function(e,t,n){var r=n(98);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"#questWindowTable{width:100%;overflow-y:auto;height:320px}.questWindowItem{border:1px solid gray;border-radius:10px;margin:10px}.questWindowItem>button{width:100px;height:40px;border-radius:5px}#questWindowItemBar button{width:100px;height:30px;font-size:16px;margin-bottom:5px}#questWindowClose{float:right}",""])},function(e,t){e.exports="<div class=window-box><div id=questWindowItemBar><button id=questWindowClose class=brownButton>关闭</button> <button id=questWindowCurrent class=brownButton>当前任务</button> <button id=questWindowPast class=brownButton>已完成</button></div><div id=questWindowTable></div></div>"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(101),s=r(u),d=n(103),c=r(d),f=l["default"].create("registerWindow"),h=f;t["default"]=h,f.css=s["default"],f.html=c["default"];var p=f.querySelector("#submit"),y=f.querySelector("#back");p.addEventListener("click",function(){o["default"].Register.submit()}),y.addEventListener("click",function(){f.hide(),o["default"].windows.main.show()})},function(e,t,n){var r=n(102);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,".registerWindow{text-align:center;height:412px;background-color:hsla(30,61%,85%,.85);border:20px solid rgba(134,93,52,.85)}.registerWindow hr{width:90%}.registerWindow input{width:240px;height:40px;border-radius:5px;text-align:center;font-size:16px;background-color:#d5ab63;margin:10px}.registerWindow label{font-size:20px;color:#fff}.registerWindow select{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:200px;height:40px;border-radius:5px;text-align:center;font-size:16px;background-color:#d5ab63;margin:10px}.registerWindow #registerWindowDisplay{position:fixed;height:250px;width:64px;left:80px;top:25px;transform:scale(1.4);-webkit-transform:scale(1.4);transform-origin:left top 0;-webkit-transform-origin:left top 0}.registerWindow #registerWindowContainer{overflow-x:hidden;overflow-y:scroll;left:200px;top:20px;width:620px;height:410px;position:fixed}.registerWindow #registerWindowBelief,.registerWindow #registerWindowClass{text-align:center;width:100%}.registerWindow #back,.registerWindow #submit{width:100px;height:60px}",""])},function(e,t){e.exports='<div id=registerWindowContainer><div id=registerWindowDisplaySelect><div><label>性别</label><select data-type=sex><option value=male>男性<option value=female>女性</select></div><div><label>皮肤</label><select data-type=body><option value=light>粉白<option value=dark>深色<option value=dark2>更深<option value=tanned>黄白<option value=tanned2>黄灰</select></div><div><label>眼睛</label><select data-type=eyes><option value=blue>蓝色<option value=brown>棕色<option value=gray>灰色<option value=green>绿色<option value=orange>橙色<option value=purple>紫色<option value=red>红色<option value=yellow>黄色</select></div><div id=customMaleHair><label>头发</label><select data-type=malehair><option value="">无<option value=bedhead>Bedhead<option value=long>Long<option value=longhawk>Longhawk<option value=messy1>messy1<option value=messy2>messy2<option value=mohawk>Mohawk<option value=page>Page<option value=parted>Parted<option value=plain>Plain<option value=shorthawk>Shorthawk</select></div><div id=customFemaleHair style="display: none"><label>头发</label><select data-type=femalehair><option value="">无<option value=bangs>bangs<option value=bangslong>bangslong<option value=bangslong2>bangslong2<option value=bunches>bunches<option value=loose>loose<option value=pixie>pixie<option value=ponytail>ponytail<option value=ponytail2>ponytail2<option value=princess>princess<option value=shoulderl>shoulderl<option value=shoulderr>shoulderr<option value=swoop>swoop<option value=unkempt>unkempt</select></div><div><label>发色</label><select data-type=haircolor><option value=black>Black<option value=blonde>Blonde<option value=blonde2>blonde2<option value=blue>blue<option value=blue2>blue2<option value=brown>brown<option value=brown2>brown2<option value=brunette>brunette<option value=brunette2>brunette2<option value=dark-blonde>dark-blonde<option value=gold>gold<option value=gray>gray<option value=gray2>gray2<option value=green>green<option value=green2>green2<option value=light-blonde>light-blonde<option value=light-blonde2>light-blonde2<option value=pink>pink<option value=pink2>pink2<option value=purple>purple<option value=raven>raven<option value=raven2>raven2<option value=redhead>redhead<option value=redhead2>redhead2<option value=ruby-red>ruby-red<option value=white>white<option value=white-blonde>white-blonde<option value=white-blonde2>white-blonde2<option value=white.centerYan>white.centerYan</select></div><div><label>帽子</label><select data-type=head><option value="">无<option value=chainhat>chainhat<option value=chain_hood>chain_hood<option value=cloth_hood>cloth_hood<option value=leather_cap>leather_cap<option value=red>red</select></div><div><label>上衣</label><select data-type=shirts><option value="">无<option value=brown>brown<option value=maroon>maroon<option value=teal>teal<option value=white>white</select></div><div><label>裤子</label><select data-type=pants><option value="">无<option value=magenta>magenta<option value=red>red<option value=teal>teal<option value=white>white</select></div><div><label>鞋子</label><select data-type=shoes><option value="">无<option value=black>black<option value=brown>brown<option value=maroon>maroon</select></div><div><label>头盔</label><select data-type=armorhelms><option value="">无<option value=golden>黄金<option value=metal>白银</select></div><div><label>胸甲</label><select data-type=armorchest><option value="">无<option value=golden>黄金<option value=metal>白银</select></div><div><label>臂甲</label><select data-type=armorarm><option value="">无<option value=golden>黄金<option value=metal>白银</select></div><div><label>腿甲</label><select data-type=armorlegs><option value="">无<option value=golden>黄金<option value=metal>白银</select></div><div><label>足甲</label><select data-type=armorfeet><option value="">无<option value=golden>黄金<option value=metal>白银</select></div></div><hr><div id=registerWindowPersonal><div><label>信仰</label><select id=registerWindowBeliefChoice data-type=belief><option value=None>无信仰<option value=Elen>艾琳 - 知识女神<option value=Enlon>恩朗 - 死亡主宰<option value=Minare>密娜 - 丰收女神<option value=Achiel>阿切奥 - 保护之神<option value=Racha>拉克 - 魔法女神<option value=Aestor>阿斯托 - 盗贼之神<option value=Hielach>赫拉克 - 财富之神<option value=Alik>阿丽克 - 治愈女神<option value=Amarien>阿玛恩 - 力量之神</select><div id=registerWindowBelief></div></div><div><label>职业</label><select id=registerWindowClassChoice data-type=class><option value=warrior>战士<option value=archer>弓箭手<option value=wizard>魔法师<option value=priest>牧师<option value=bard>吟游诗人<option value=thief>盗贼<option value=business>商人</select><div id=registerWindowClass></div></div><div style="padding-top: 20px"><input id=registerHeroName placeholder=名字></div></div><div style="padding-bottom: 20px; padding-top: 10px"><button id=submit class=brownButton>完成</button> <button id=back class=brownButton>返回</button></div></div><div id=registerWindowDisplay><label id=loading>正在载入预览</label><br><canvas width=64 height=250></canvas></div>';
},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(105),s=r(u),d=n(107),c=r(d),f=l["default"].create("sellWindow"),h=f;t["default"]=h,f.css=s["default"],f.html=c["default"];var p=f.querySelector("button#sellWindowClose"),y=f.querySelector("button#sellWindowBuy"),w=f.querySelector("button#sellWindowAll"),v=f.querySelector("button#sellWindowWeapon"),g=f.querySelector("button#sellWindowArmor"),b=f.querySelector("button#sellWindowPotion"),m=f.querySelector("button#sellWindowMaterial"),x=f.querySelector("button#sellWindowBook"),k=f.querySelector("button#sellWindowMisc"),A=f.querySelector("span#sellWindowGold"),E=f.querySelector("#sellWindowTable"),S=null,W=null,C=-1;p.addEventListener("click",function(){f.hide()}),y.addEventListener("click",function(){f.hide(),o["default"].windows.buy.open(S)}),f.whenUp(["tab"],function(){setTimeout(function(){f.hide(),o["default"].windows.buy.open(S)},20)}),w.addEventListener("click",function(e){f.open(S,null)}),v.addEventListener("click",function(e){f.open(S,"sword|spear|bow")}),g.addEventListener("click",function(e){f.open(S,"head|body|feet")}),b.addEventListener("click",function(e){f.open(S,"potion")}),m.addEventListener("click",function(e){f.open(S,"material")}),x.addEventListener("click",function(e){f.open(S,"book|scroll|letter")}),k.addEventListener("click",function(e){f.open(S,"misc")}),f.assign("open",function(e,t,n){"undefined"==typeof n&&(n=-1),S=e,W=t,C=n,A.textContent=o["default"].hero.data.gold+"G";var r="white",i="yellow";w.style.color=r,v.style.color=r,g.style.color=r,b.style.color=r,m.style.color=r,x.style.color=r,k.style.color=r,null==t?w.style.color=i:t.match(/sword/)?v.style.color=i:t.match(/head/)?g.style.color=i:t.match(/potion/)?b.style.color=i:t.match(/material/)?m.style.color=i:t.match(/book/)?x.style.color=i:t.match(/misc/)&&(k.style.color=i);var a=0,l="";Object.keys(o["default"].hero.data.items).forEach(function(e){var r=o["default"].hero.data.items[e],i=o["default"].items[e];if(!t||-1!=t.indexOf(i.data.type)){var u="";u+=n==a?'<tr style="background-color: green;">\n':"<tr>\n",u+=i.icon?'  <td style="text-align: center;"><img alt="" src="'+i.icon.src+'"></td>\n':"  <td> </td>\n",u+="  <td>"+i.data.name+"</td>\n",u+='  <td style="text-align: center;">'+Math.ceil(.8*i.data.value)+"G</td>\n",u+='  <td style="text-align: center;">'+r+"</td>\n",u+="  <td>"+i.data.description+"</td>\n",u+='  <td><button data-id="'+e+'" class="brownButton">卖出</button></td>\n',u+="</tr>\n",l+=u,a++}}),E.innerHTML=l,f.show()}),f.whenUp(["enter"],function(){var e=E.querySelectorAll("button");C>=0&&C<e.length&&e[C].click()}),f.whenUp(["up","down"],function(e){var t=E.querySelectorAll("button").length;if(!(0>=t))if(-1==C)"down"==e?f.open(S,W,0):"up"==e&&f.open(S,W,t-1);else if("down"==e){var n=C+1;n>=t&&(n=0),f.open(S,W,n)}else if("up"==e){var n=C-1;0>n&&(n=t-1),f.open(S,W,n)}}),f.whenUp(["esc"],function(){setTimeout(function(){f.hide()},20)}),f.whenUp(["left","right"],function(e){if("right"==e){var t=W;null==t?t="sword":t.match(/sword/)?t="head":t.match(/head/)?t="potion":t.match(/potion/)?t="material":t.match(/material/)?t="book":t.match(/book/)?t="misc":t.match(/misc/)&&(t=null),f.open(S,t)}else if("left"==e){var t=W;null==t?t="misc":t.match(/sword/)?t=null:t.match(/head/)?t="sword":t.match(/potion/)?t="head":t.match(/material/)?t="potion":t.match(/book/)?t="material":t.match(/misc/)&&(t="book"),f.open(S,t)}}),E.addEventListener("click",function(e){var t=e.target.getAttribute("data-id");if(t&&o["default"].hero.data.items.hasOwnProperty(t)){var n=o["default"].items[t],r=o["default"].hero.data.items[t];S.hasOwnProperty(t)?S[t]++:S[t]=1,1==r?(o["default"].hero.data.bar.forEach(function(e,n,r){e&&e.id==t&&(r[n]=null)}),Object.keys(o["default"].hero.data.equipment).forEach(function(e){var n=o["default"].hero.data.equipment[e];n==t&&(o["default"].hero.data.equipment[e]=null)}),delete o["default"].hero.data.items[t]):o["default"].hero.data.items[t]--,o["default"].hero.data.gold+=Math.ceil(.8*n.data.value),o["default"].windows["interface"].refresh(),f.open(S,W)}})},function(e,t,n){var r=n(106);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"#sellWindowTable tr:nth-child(odd){background-color:hsla(0,0%,75%,.6)}#sellWindowItemBar>button{width:60px;height:40px;font-size:16px;margin:0 5px 5px}#sellWindowClose,#sellWindowStatus{float:right}.sellWindow table{width:100%}.sellWindow table button{width:60px;height:40px;font-size:16px}#sellWindowGold{position:absolute;right:100px;bottom:30px;font-size:20px;color:#000}",""])},function(e,t){e.exports='<div class=window-box><div id=sellWindowItemBar><button id=sellWindowClose class=brownButton>关闭</button> <button id=sellWindowBuy class=brownButton>买入</button> <button id=sellWindowAll class=brownButton>全部</button> <button id=sellWindowWeapon class=brownButton>武器</button> <button id=sellWindowArmor class=brownButton>护甲</button> <button id=sellWindowPotion class=brownButton>药水</button> <button id=sellWindowMaterial class=brownButton>材料</button> <button id=sellWindowBook class=brownButton>书籍</button> <button id=sellWindowMisc class=brownButton>其他</button></div><span id=sellWindowGold></span><div style="overflow: auto; height: 300px"><table border=0><thead><tr><td style="width: 40px"><td style="width: 120px"><td style="width: 30px"><td style="width: 30px"><td><td style="width: 60px"><tbody id=sellWindowTable></table></div></div>'},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(39),s=r(u),d=n(32),c=r(d),f=n(109),h=r(f),p=n(111),y=r(p),w=l["default"].create("settingWindow"),v=w;t["default"]=v,w.css=h["default"],w.html=y["default"];var g=w.querySelector("#settingWindowShortcut"),b=w.querySelector("#settingWindowShortcutAll"),m=w.querySelector("#settingWindowClose"),x=w.querySelector("#settingWindowScale"),k=w.querySelector("#settingWindowFullscreen"),A=w.querySelector("#settingWindowRendererType");g.addEventListener("click",function(e){(0,c["default"])({1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7}).then(function(e){Number.isFinite(e)&&(o["default"].hero.data.bar[e]=null,o["default"].windows["interface"].refresh())})}),b.addEventListener("click",function(e){(0,s["default"])("确定要删除所有快捷栏图表吗？").then(function(){for(var e=0;8>e;e++)o["default"].hero.data.bar[e]=null;o["default"].windows["interface"].refresh()})["catch"](function(){})}),w.on("beforeShow",function(){A.textContent=o["default"].stage.rendererType}),m.addEventListener("click",function(e){w.hide()}),x.addEventListener("click",function(e){o["default"].config.scale=!o["default"].config.scale,w.show()}),w.whenUp(["esc"],function(e){m.click()}),w.assign("toggle",function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}),k.addEventListener("click",function(e){w.toggle()})},function(e,t,n){var r=n(110);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"#settingWindowBox{width:100%;height:360px}#settingWindowBox button{width:120px;height:60px;font-size:16px;display:block}#settingWindowClose{width:60px;height:40px;font-size:16px;float:right}",""])},function(e,t){e.exports="<div class=window-box><button id=settingWindowClose class=brownButton>关闭</button><div id=settingWindowRendererType></div><div id=settingWindowBox><button id=settingWindowFullscreen class=brownButton>全屏</button> <button id=settingWindowScale class=brownButton>缩放</button> <button id=settingWindowShortcut class=brownButton>清除快捷栏</button> <button id=settingWindowShortcutAll class=brownButton>清除全部快捷栏</button></div></div>"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(39),s=r(u),d=n(32),c=r(d),f=n(113),h=r(f),p=n(115),y=r(p),w=l["default"].create("skillWindow"),v=w;t["default"]=v,w.css=h["default"],w.html=y["default"];var g=w.querySelector("button#skillWindowClose"),b=w.querySelector("#skillWindowTable"),m=-1;g.addEventListener("click",function(e){w.hide()}),w.whenUp(["esc"],function(e){setTimeout(function(){w.hide()},20)}),w.assign("open",function(e){"undefined"==typeof e&&(e=-1),m=e;var t=0,n="";o["default"].hero.data.skills.forEach(function(r){var i=o["default"].skills[r],a="";a+=e==t?'<tr style="background-color: green;">\n':"<tr>\n",a+='  <td><img alt="" src="'+i.icon.src+'"></td>\n',a+="  <td>"+i.data.name+"</td>\n",a+="  <td>"+i.data.description+"</td>\n",a+='  <td><button data-id="'+r+'" class="brownButton skillWindowManage">管理</button></td>\n',a+="</tr>\n",n+=a,t++}),b.innerHTML=n,o["default"].windows.skill.show()}),w.whenUp(["enter"],function(){var e=w.querySelectorAll(".skillWindowManage");m>=0&&m<e.length&&e[m].click()}),w.whenUp(["up","down"],function(e){var t=w.querySelectorAll(".skillWindowManage").length;if(-1==m)"down"==e?w.open(0):"up"==e&&w.open(t-1);else if("down"==e){var n=m+1;n>=t&&(n=0),w.open(n)}else if("up"==e){var n=m-1;0>n&&(n=t-1),w.open(n)}}),b.addEventListener("click",function(e){var t=e.target.getAttribute("data-id"),n=o["default"].hero.data.skills.indexOf(t);t&&o["default"].skills.hasOwnProperty(t)&&-1!=n&&!function(){var e=o["default"].skills[t],r={};r["快捷栏"]="shortcut",r["遗忘"]="remove",e.data.next&&(r["升级"]="levelup"),(0,c["default"])(r).then(function(r){switch(r){case"shortcut":(0,c["default"])({1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7}).then(function(e){Number.isFinite(e)&&e>=0&&(o["default"].hero.data.bar[e]={id:t,type:"skill"},o["default"].windows["interface"].refresh())});break;case"levelup":if(e.data.next){var i=[];if(o["default"].hero.data.gold<e.data.next.gold&&i.push("金币不足，需要金币"+e.data.next.gold+"，当前您有金币"+o["default"].hero.data.gold),o["default"].hero.data.exp<e.data.next.exp&&i.push("经验不足，需要经验"+e.data.next.exp+"，当前您有经验"+o["default"].hero.data.exp),i.length)return void o["default"].dialogue(i);(0,s["default"])("确定要升级这个技能吗？共需要金币"+e.data.next.gold+"，经验"+e.data.next.exp).then(function(){var t=e.data.next.id;o["default"].hero.data.skills.splice(n,1),o["default"].hero.data.skills.push(t),o["default"].hero.data.gold-=e.data.next.gold,o["default"].hero.data.exp-=e.data.next.exp,o["default"].windows.loading.begin(),o["default"].Skill.load(t).then(function(e){o["default"].windows.loading.end(),w.open()})})["catch"](function(){})}break;case"remove":(0,s["default"])("真的要遗忘 "+e.data.name+" 技能吗？").then(function(){o["default"].hero.data.bar.forEach(function(e,n,r){e&&e.id==t&&(r[n]=null)}),o["default"].hero.data.skills.splice(n,1),o["default"].windows["interface"].refresh(),w.open()})["catch"](function(){})}})}()})},function(e,t,n){var r=n(114);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,".skillWindow table{width:100%}.skillWindow tr:nth-child(odd){background-color:hsla(0,0%,75%,.6)}.skillWindow table img{width:100%;height:100%}#skillWindowItemBar button,.skillWindow button{width:60px;height:40px;font-size:16px}#skillWindowItemBar button{margin:0 5px 5px}#skillWindowClose{float:right}",""])},function(e,t){e.exports='<div class=window-box><div id=skillWindowItemBar><button id=skillWindowClose class=brownButton>关闭</button></div><table border=0><thead><tr><th style="width: 40px"><th style="width: 120px"><th><th style="width: 60px"><tbody id=skillWindowTable></table></div>'},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),o=(r(i),n(8)),a=r(o),l=n(33),u=r(l),s=n(117),d=r(s),c=n(119),f=r(c),h=u["default"].create("statusWindow"),p=h;t["default"]=p,h.css=d["default"],h.html=f["default"];var y={head:h.querySelector("#equipment-head"),body:h.querySelector("#equipment-body"),feet:h.querySelector("#equipment-feet"),weapon:h.querySelector("#equipment-weapon"),neck:h.querySelector("#equipment-neck"),ring:h.querySelector("#equipment-ring")},w={head:h.querySelector("#equipmentButton-head"),body:h.querySelector("#equipmentButton-body"),feet:h.querySelector("#equipmentButton-feet"),weapon:h.querySelector("#equipmentButton-weapon"),neck:h.querySelector("#equipmentButton-neck"),ring:h.querySelector("#equipmentButton-ring")},v=-1;Object.keys(w).forEach(function(e){var t=w[e];t.addEventListener("click",function(){a["default"].hero.data.equipment[e]?a["default"].hero.data.equipment[e]=null:"weapon"==e?a["default"].windows.inventory.open("sword|spear|bow"):a["default"].windows.inventory.open("head|body|feet"),h.update()})});var g=h.querySelector("#heroName"),b=h.querySelector("#heroHP"),m=h.querySelector("#heroSP"),x=h.querySelector("#heroLevel"),k=h.querySelector("#heroEXP"),A=h.querySelector("#heroSTR"),E=h.querySelector("#heroDEX"),S=h.querySelector("#heroCON"),W=h.querySelector("#heroINT"),C=h.querySelector("#heroCHA"),O=h.querySelector("#heroATK"),M=h.querySelector("#heroDEF"),T=h.querySelector("#heroMATK"),P=h.querySelector("#heroMDEF"),_=h.querySelector("button#statusWindowClose"),L=h.querySelector("button#statusWindowInventory"),B=h.querySelector("#statusWindowEquipmentTable");_.addEventListener("click",function(e){h.hide()}),L.addEventListener("click",function(e){h.hide(),a["default"].windows.inventory.open()}),h.whenUp(["tab"],function(){setTimeout(function(){h.hide(),a["default"].windows.inventory.open()},20)}),h.whenUp(["esc"],function(e){setTimeout(function(){h.hide()},20)}),h.assign("update",function(e){"undefined"==typeof e&&(e=-1),v=e,g.textContent="名字："+a["default"].hero.data.name,b.textContent="生命力："+a["default"].hero.data.hp+"/"+a["default"].hero.data.$hp,m.textContent="精神力："+a["default"].hero.data.sp+"/"+a["default"].hero.data.$sp,x.textContent="等级："+a["default"].hero.data.level,k.textContent="经验："+a["default"].hero.data.exp,A.textContent="力量："+a["default"].hero.data.str,E.textContent="敏捷："+a["default"].hero.data.dex,S.textContent="耐力："+a["default"].hero.data.con,W.textContent="智力："+a["default"].hero.data["int"],C.textContent="魅力："+a["default"].hero.data.cha,O.textContent="攻击："+a["default"].hero.data.atk,M.textContent="防御："+a["default"].hero.data.def,T.textContent="魔法攻击："+a["default"].hero.data.matk,P.textContent="魔法防御："+a["default"].hero.data.mdef;for(var t=B.querySelectorAll("tr"),n=0,r=t.length;r>n;n++)e==n?t[n].style.backgroundColor="green":t[n].style.backgroundColor="";Object.keys(a["default"].hero.data.equipment).forEach(function(e){var t=a["default"].hero.data.equipment[e],n=a["default"].items[t],r=w[e];if(t){var i="";i+='<img alt="" src="'+n.icon.src+'">',i+="<span>"+n.data.name+"</span>",y[e].innerHTML=i,r.textContent="卸下"}else y[e].innerHTML="",r.textContent="装备"})}),h.whenUp(["enter"],function(){var e=B.querySelectorAll("button");v>=0&&v<e.length&&e[v].click()}),h.whenUp(["up","down"],function(e){var t=B.querySelectorAll("button").length;if(-1==v)"down"==e?h.open(0):"up"==e&&h.open(t-1);else if("down"==e){var n=v+1;n>=t&&(n=0),h.open(n)}else if("up"==e){var n=v-1;0>n&&(n=t-1),h.open(n)}}),h.assign("open",function(e){h.update(e),h.show()})},function(e,t,n){var r=n(118);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,"#statusWindowEquipmentTable tr:nth-child(odd){background-color:hsla(0,0%,75%,.6)}#heroName{font-size:24px;margin-left:240px}#statusWindowTable{width:50%}#statusWindowTable label{font-size:18px;margin-left:80px}#statusWindowEquipmentTable button{width:60px;height:40px}.statusWindowEquipmentText{width:60px;font-size:20px;text-align:center}.statusWindow label{display:block}#statusWindowItemBar button{width:60px;height:40px;font-size:16px;margin:0 5px 5px;text-align:center}#statusWindowClose,#statusWindowInventory{float:right}.statusWindow table{width:100%;height:320px}",""])},function(e,t){e.exports='<div class=window-box><div id=statusWindowItemBar><button id=statusWindowClose class=brownButton>关闭</button> <button id=statusWindowInventory class=brownButton>物品</button><label id=heroName></label></div><table border=0><tr><td id=statusWindowTable><label id=heroHP></label><label id=heroSP></label><label id=heroLevel></label><label id=heroEXP></label><label id=heroSTR></label><label id=heroDEX></label><label id=heroCON></label><label id=heroINT></label><label id=heroCHA></label><label id=heroATK></label><label id=heroDEF></label><label id=heroMATK></label><label id=heroMDEF></label><td style="width: 50%"><table id=statusWindowEquipmentTable border=0><tbody><tr><td class=statusWindowEquipmentText>头部<td id=equipment-head><td style="width: 60px"><button id=equipmentButton-head class=brownButton>卸下</button><tr><td class=statusWindowEquipmentText>身体<td id=equipment-body><td><button id=equipmentButton-body class=brownButton>卸下</button><tr><td class=statusWindowEquipmentText>足部<td id=equipment-feet><td><button id=equipmentButton-feet class=brownButton>卸下</button><tr><td class=statusWindowEquipmentText>武器<td id=equipment-weapon><td><button id=equipmentButton-weapon class=brownButton>卸下</button><tr><td class=statusWindowEquipmentText>项链<td id=equipment-neck><td><button id=equipmentButton-neck class=brownButton>卸下</button><tr><td class=statusWindowEquipmentText>戒指<td id=equipment-ring><td><button id=equipmentButton-ring class=brownButton>卸下</button></table></table></div>'},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=r(i),a=n(33),l=r(a),u=n(121),s=r(u),d=n(123),c=r(d),f=l["default"].create("sysmenuWindow"),h=f;t["default"]=h,f.css=s["default"],f.html=c["default"];var p=f.querySelector("button#sysmenuWindowInventory"),y=f.querySelector("button#sysmenuWindowStatus"),w=f.querySelector("button#sysmenuWindowSkill"),v=f.querySelector("button#sysmenuWindowQuest"),g=f.querySelector("button#sysmenuWindowMap"),b=f.querySelector("button#sysmenuWindowSetting"),m=f.querySelector("button#sysmenuWindowArchive"),x=f.querySelector("button#sysmenuWindowExit"),k=f.querySelector("button#sysmenuWindowClose");f.whenUp(["esc"],function(e){k.click()}),f.whenUp(["1","2","3","4","5","6","7","8"],function(e){switch(e){case"1":p.click();break;case"2":y.click();break;case"3":w.click();break;case"4":v.click();break;case"5":g.click();break;case"6":b.click();break;case"7":m.click();break;case"8":x.click()}}),p.addEventListener("click",function(e){f.hide(),o["default"].windows.inventory.open()}),y.addEventListener("click",function(e){f.hide(),o["default"].windows.status.open()}),w.addEventListener("click",function(e){f.hide(),o["default"].windows.skill.open()}),v.addEventListener("click",function(e){f.hide(),o["default"].windows.quest.current()}),g.addEventListener("click",function(e){f.hide(),o["default"].windows.map.show()}),b.addEventListener("click",function(e){f.hide(),o["default"].windows.setting.show()}),m.addEventListener("click",function(e){f.hide(),o["default"].windows.archive.open()}),x.addEventListener("click",function(e){o["default"].clearStage(),o["default"].windows["interface"].hide(),o["default"].windows.stage.hide(),f.hide(),o["default"].windows.main.show()}),k.addEventListener("click",function(e){f.hide()})},function(e,t,n){var r=n(122);"string"==typeof r&&(r=[[e.id,r,""]]);n(7)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(5)(),t.push([e.id,".sysmenuWindow{text-align:center}.sysmenuWindow table,.sysmenuWindow tbody,.sysmenuWindow td,.sysmenuWindow tr{width:100%;height:100%;margin:0;padding:0}.sysmenuWindow button{width:200px;height:60px;margin:2px;font-size:16px}.sysmenuWindow button#sysmenuWindowClose{position:absolute;right:50px;top:50px;width:120px;height:60px;font-size:16px}",""])},function(e,t){e.exports="<div class=window-box><button id=sysmenuWindowClose class=brownButton>关闭窗口</button><table><tbody><tr><td><button id=sysmenuWindowInventory class=brownButton>1、背包物品</button> <button id=sysmenuWindowStatus class=brownButton>2、状态装备</button><br><button id=sysmenuWindowSkill class=brownButton>3、查看技能</button> <button id=sysmenuWindowQuest class=brownButton>4、任务列表</button><br><button id=sysmenuWindowMap class=brownButton>5、迷你地图</button> <button id=sysmenuWindowSetting class=brownButton>6、游戏设置</button><br><button id=sysmenuWindowArchive class=brownButton>7、存档管理</button> <button id=sysmenuWindowExit class=brownButton>8、退出游戏</button><br></table></div>"}]);